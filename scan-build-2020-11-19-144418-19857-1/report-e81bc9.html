<!doctype html>
<html>
<head>
<title>builtin/add.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memset' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/real/c_git/git/builtin/add.c -->

<!-- FILENAME add.c -->

<!-- FUNCTIONNAME add_files_to_cache -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 5d55a50cbe026b33d6335c353502242f -->

<!-- BUGLINE 115 -->

<!-- BUGCOLUMN 2 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>builtin/add.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 115, column 2</a><br />Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name add.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I . -D HAVE_SYSINFO -D GIT_HOST_CPU="x86_64" -D HAVE_ALLOCA_H -D USE_CURL_FOR_IMAP_SEND -D SHA1_DC -D SHA1DC_NO_STANDARD_INCLUDES -D SHA1DC_INIT_SAFE_HASH_DEFAULT=0 -D SHA1DC_CUSTOM_INCLUDE_SHA1_C="cache.h" -D SHA1DC_CUSTOM_INCLUDE_UBC_CHECK_C="git-compat-util.h" -D SHA256_BLK -D HAVE_PATHS_H -D HAVE_DEV_TTY -D HAVE_CLOCK_GETTIME -D HAVE_CLOCK_MONOTONIC -D HAVE_GETDELIM -D PROCFS_EXECUTABLE_PATH="/proc/self/exe" -D FREAD_READS_DIRECTORIES -D NO_STRLCPY -D SHELL_PATH="/bin/sh" -D PAGER_ENV="LESS=FRX LV=-c" -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -fdebug-compilation-dir /tmp/real/c_git/git -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker deadcode -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-19-144418-19857-1 -x c builtin/add.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"115": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>* "git add" builtin command</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> <span class='comment'>* Copyright (C) 2006 Linus Torvalds</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#define USE_THE_INDEX_COMPATIBILITY_MACROS</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#include "cache.h"</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#include "config.h"</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include "builtin.h"</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include "lockfile.h"</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include "dir.h"</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include "pathspec.h"</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include "exec-cmd.h"</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include "cache-tree.h"</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include "run-command.h"</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "parse-options.h"</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include "diff.h"</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include "diffcore.h"</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include "revision.h"</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "bulk-checkin.h"</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include "strvec.h"</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include "submodule.h"</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include "add-interactive.h"</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> builtin_add_usage[] = {</td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git add [&lt;options&gt;] [--] &lt;pathspec&gt;..."</span>)<span class='macro_popup'>("git add [&lt;options&gt;] [--] &lt;pathspec&gt;...")</span></span>,</td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">	<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> patch_interactive, add_interactive, edit_interactive;</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> take_worktree_changes;</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> add_renormalize;</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> pathspec_file_nul;</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *pathspec_from_file;</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> legacy_stash_p; <span class='comment'>/* support for the scripted `git stash` */</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='keyword'>struct</span> update_callback_data {</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">	<span class='keyword'>int</span> flags;</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">	<span class='keyword'>int</span> add_errors;</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> chmod_pathspec(<span class='keyword'>struct</span> pathspec *pathspec, <span class='keyword'>char</span> flip)</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>; i++) {</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">		<span class='keyword'>struct</span> cache_entry *ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[i];</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">		<span class='keyword'>if</span> (pathspec &amp;&amp; !ce_path_match(&amp;the_index, ce, pathspec, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>chmod_cache_entry(ce, flip)<span class='macro_popup'>chmod_index_entry(&amp;the_index, (ce), (flip))</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">			fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"cannot chmod %cx '%s'\n"</span>, flip, ce-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> fix_unmerged_status(<span class='keyword'>struct</span> diff_filepair *p,</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">			       <span class='keyword'>struct</span> update_callback_data *data)</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">	<span class='keyword'>if</span> (p-&gt;status != <span class='macro'>DIFF_STATUS_UNMERGED<span class='macro_popup'>'U'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">		<span class='keyword'>return</span> p-&gt;status;</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">	<span class='keyword'>if</span> (!(data-&gt;flags &amp; <span class='macro'>ADD_CACHE_IGNORE_REMOVAL<span class='macro_popup'>8</span></span>) &amp;&amp; !p-&gt;two-&gt;mode)</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">		 <span class='comment'>* This is not an explicit add request, and the</span></td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">		 <span class='comment'>* path is missing from the working tree (deleted)</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>DIFF_STATUS_DELETED<span class='macro_popup'>'D'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">		 <span class='comment'>* Either an explicit add request, or path exists</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">		 <span class='comment'>* in the working tree.  An attempt to explicitly</span></td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">		 <span class='comment'>* add a path that does not exist in the working tree</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">		 <span class='comment'>* will be caught as an error by the caller immediately.</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>DIFF_STATUS_MODIFIED<span class='macro_popup'>'M'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> update_callback(<span class='keyword'>struct</span> diff_queue_struct *q,</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">			    <span class='keyword'>struct</span> diff_options *opt, <span class='keyword'>void</span> *cbdata)</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">	<span class='keyword'>struct</span> update_callback_data *data = cbdata;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">		<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *path = p-&gt;one-&gt;path;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">		<span class='keyword'>switch</span> (fix_unmerged_status(p, data)) {</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">		<span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">			die(_(<span class='string_literal'>"unexpected diff status %c"</span>), p-&gt;status);</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_MODIFIED<span class='macro_popup'>'M'</span></span>:</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_TYPE_CHANGED<span class='macro_popup'>'T'</span></span>:</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">			<span class='keyword'>if</span> (add_file_to_index(&amp;the_index, path,	data-&gt;flags)) {</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">				<span class='keyword'>if</span> (!(data-&gt;flags &amp; <span class='macro'>ADD_CACHE_IGNORE_ERRORS<span class='macro_popup'>4</span></span>))</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">					die(_(<span class='string_literal'>"updating files failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">				data-&gt;add_errors++;</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_DELETED<span class='macro_popup'>'D'</span></span>:</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">			<span class='keyword'>if</span> (data-&gt;flags &amp; <span class='macro'>ADD_CACHE_IGNORE_REMOVAL<span class='macro_popup'>8</span></span>)</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">				<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">			<span class='keyword'>if</span> (!(data-&gt;flags &amp; <span class='macro'>ADD_CACHE_PRETEND<span class='macro_popup'>2</span></span>))</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">				remove_file_from_index(&amp;the_index, path);</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">			<span class='keyword'>if</span> (data-&gt;flags &amp; (<span class='macro'>ADD_CACHE_PRETEND<span class='macro_popup'>2</span></span>|<span class='macro'>ADD_CACHE_VERBOSE<span class='macro_popup'>1</span></span>))</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">				printf(_(<span class='string_literal'>"remove '%s'\n"</span>), path);</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line"><span class='keyword'>int</span> add_files_to_cache(<span class='keyword'>const</span> <span class='keyword'>char</span> *prefix,</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">		       <span class='keyword'>const</span> <span class='keyword'>struct</span> pathspec *pathspec, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">	<span class='keyword'>struct</span> update_callback_data data;</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">	<span class='keyword'>struct</span> rev_info rev;</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">	<span class="mrange">memset</span>(&amp;data, 0, <span class='keyword'>sizeof</span>(data));</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:9ex; max-width:58em">Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">	data.flags = flags;</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">	repo_init_revisions(the_repository, &amp;rev, prefix);</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">	setup_revisions(0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;rev, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">	<span class='keyword'>if</span> (pathspec)</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">		copy_pathspec(&amp;rev.prune_data, pathspec);</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">	rev.diffopt.output_format = <span class='macro'>DIFF_FORMAT_CALLBACK<span class='macro_popup'>0x1000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">	rev.diffopt.format_callback = update_callback;</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">	rev.diffopt.format_callback_data = &amp;data;</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">	rev.diffopt.flags.override_submodule_config = 1;</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">	rev.max_count = 0; <span class='comment'>/* do not compare unmerged paths with stage #2 */</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">	run_diff_files(&amp;rev, <span class='macro'>DIFF_RACY_IS_MODIFIED<span class='macro_popup'>02</span></span>);</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">	clear_pathspec(&amp;rev.prune_data);</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">	<span class='keyword'>return</span> !!data.add_errors;</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> renormalize_tracked_files(<span class='keyword'>const</span> <span class='keyword'>struct</span> pathspec *pathspec, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">	<span class='keyword'>int</span> i, retval = 0;</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>; i++) {</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">		<span class='keyword'>struct</span> cache_entry *ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[i];</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>ce_stage(ce)<span class='macro_popup'>(((0x3000) &amp; (ce)-&gt;ce_flags) &gt;&gt; 12)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">			<span class='keyword'>continue</span>; <span class='comment'>/* do not touch unmerged paths */</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">		<span class='keyword'>if</span> (!<span class='macro'>S_ISREG(ce-&gt;ce_mode)<span class='macro_popup'>((((ce-&gt;ce_mode)) &amp; 0170000) == (0100000))</span></span> &amp;&amp; !<span class='macro'>S_ISLNK(ce-&gt;ce_mode)<span class='macro_popup'>((((ce-&gt;ce_mode)) &amp; 0170000) == (0120000))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">			<span class='keyword'>continue</span>; <span class='comment'>/* do not touch non blobs */</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">		<span class='keyword'>if</span> (pathspec &amp;&amp; !ce_path_match(&amp;the_index, ce, pathspec, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">		retval |= <span class='macro'>add_file_to_cache(ce-&gt;name, flags | ADD_CACHE_RENORMALIZE)<span class='macro_popup'>add_file_to_index(&amp;the_index, (ce-&gt;name), (flags | 64)<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">	<span class='keyword'>return</span> retval;</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *prune_directory(<span class='keyword'>struct</span> dir_struct *dir, <span class='keyword'>struct</span> pathspec *pathspec, <span class='keyword'>int</span> prefix)</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">	<span class='keyword'>char</span> *seen;</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">	<span class='keyword'>struct</span> dir_entry **src, **dst;</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">	seen = xcalloc(pathspec-&gt;nr, 1);</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">	src = dst = dir-&gt;entries;</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">	i = dir-&gt;nr;</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">	<span class='keyword'>while</span> (--i &gt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">		<span class='keyword'>struct</span> dir_entry *entry = *src++;</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">		<span class='keyword'>if</span> (dir_path_match(&amp;the_index, entry, pathspec, prefix, seen))</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">			*dst++ = entry;</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">	dir-&gt;nr = dst - dir-&gt;entries;</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">	add_pathspec_matches_against_index(pathspec, &amp;the_index, seen);</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">	<span class='keyword'>return</span> seen;</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> refresh(<span class='keyword'>int</span> verbose, <span class='keyword'>const</span> <span class='keyword'>struct</span> pathspec *pathspec)</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">	<span class='keyword'>char</span> *seen;</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">	seen = xcalloc(pathspec-&gt;nr, 1);</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">	refresh_index(&amp;the_index, verbose ? <span class='macro'>REFRESH_IN_PORCELAIN<span class='macro_popup'>0x0020</span></span> : <span class='macro'>REFRESH_QUIET<span class='macro_popup'>0x0004</span></span>,</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">		      pathspec, seen, _(<span class='string_literal'>"Unstaged changes after refreshing the index:"</span>));</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; pathspec-&gt;nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">		<span class='keyword'>if</span> (!seen[i])</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">			die(_(<span class='string_literal'>"pathspec '%s' did not match any files"</span>),</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">			    pathspec-&gt;items[i].match);</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">	free(seen);</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"><span class='keyword'>int</span> run_add_interactive(<span class='keyword'>const</span> <span class='keyword'>char</span> *revision, <span class='keyword'>const</span> <span class='keyword'>char</span> *patch_mode,</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">			<span class='keyword'>const</span> <span class='keyword'>struct</span> pathspec *pathspec)</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">	<span class='keyword'>int</span> status, i;</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">	<span class='keyword'>struct</span> strvec argv = <span class='macro'>STRVEC_INIT<span class='macro_popup'>{ empty_strvec, 0, 0 }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">	<span class='keyword'>int</span> use_builtin_add_i =</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">		git_env_bool(<span class='string_literal'>"GIT_TEST_ADD_I_USE_BUILTIN"</span>, -1);</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">	<span class='keyword'>if</span> (use_builtin_add_i &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">		<span class='keyword'>int</span> experimental;</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">		<span class='keyword'>if</span> (!git_config_get_bool(<span class='string_literal'>"add.interactive.usebuiltin"</span>,</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">					 &amp;use_builtin_add_i))</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">			; <span class='comment'>/* ok */</span></td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!git_config_get_bool(<span class='string_literal'>"feature.experimental"</span>, &amp;experimental) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">			 experimental)</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">			use_builtin_add_i = 1;</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">	<span class='keyword'>if</span> (use_builtin_add_i == 1) {</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">		<span class='keyword'>enum</span> add_p_mode mode;</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">		<span class='keyword'>if</span> (!patch_mode)</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">			<span class='keyword'>return</span> !!run_add_i(the_repository, pathspec);</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">		<span class='keyword'>if</span> (!strcmp(patch_mode, <span class='string_literal'>"--patch"</span>))</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">			mode = ADD_P_ADD;</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(patch_mode, <span class='string_literal'>"--patch=stash"</span>))</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">			mode = ADD_P_STASH;</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(patch_mode, <span class='string_literal'>"--patch=reset"</span>))</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">			mode = ADD_P_RESET;</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(patch_mode, <span class='string_literal'>"--patch=checkout"</span>))</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">			mode = ADD_P_CHECKOUT;</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(patch_mode, <span class='string_literal'>"--patch=worktree"</span>))</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">			mode = ADD_P_WORKTREE;</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">			die(<span class='string_literal'>"'%s' not supported"</span>, patch_mode);</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">		<span class='keyword'>return</span> !!run_add_p(the_repository, mode, revision, pathspec);</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">	strvec_push(&amp;argv, <span class='string_literal'>"add--interactive"</span>);</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">	<span class='keyword'>if</span> (patch_mode)</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">		strvec_push(&amp;argv, patch_mode);</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">	<span class='keyword'>if</span> (revision)</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">		strvec_push(&amp;argv, revision);</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">	strvec_push(&amp;argv, <span class='string_literal'>"--"</span>);</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; pathspec-&gt;nr; i++)</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">		<span class='comment'>/* pass original pathspec, to be re-parsed */</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">		strvec_push(&amp;argv, pathspec-&gt;items[i].original);</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">	status = run_command_v_opt(argv.v, <span class='macro'>RUN_GIT_CMD<span class='macro_popup'>2</span></span>);</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">	strvec_clear(&amp;argv);</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">	<span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"><span class='keyword'>int</span> interactive_add(<span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix, <span class='keyword'>int</span> patch)</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">	<span class='keyword'>struct</span> pathspec pathspec;</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">	parse_pathspec(&amp;pathspec, 0,</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">		       <span class='macro'>PATHSPEC_PREFER_FULL<span class='macro_popup'>(1&lt;&lt;1)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">		       <span class='macro'>PATHSPEC_SYMLINK_LEADING_PATH<span class='macro_popup'>(1&lt;&lt;3)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">		       <span class='macro'>PATHSPEC_PREFIX_ORIGIN<span class='macro_popup'>(1&lt;&lt;4)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">		       prefix, argv);</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">	<span class='keyword'>return</span> run_add_interactive(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">				   patch ? <span class='string_literal'>"--patch"</span> : <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">				   &amp;pathspec);</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> edit_patch(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">	<span class='keyword'>char</span> *file = git_pathdup(<span class='string_literal'>"ADD_EDIT.patch"</span>);</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *apply_argv[] = { <span class='string_literal'>"apply"</span>, <span class='string_literal'>"--recount"</span>, <span class='string_literal'>"--cached"</span>,</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">		<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> };</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">	<span class='keyword'>struct</span> child_process child = <span class='macro'>CHILD_PROCESS_INIT<span class='macro_popup'>{ ((void*)0), { empty_strvec, 0, 0 }, { empty_strvec, 0, 0 } }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">	<span class='keyword'>struct</span> rev_info rev;</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">	<span class='keyword'>int</span> out;</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">	<span class='keyword'>struct</span> stat st;</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">	apply_argv[3] = file;</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">	git_config(git_diff_basic_config, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>); <span class='comment'>/* no "diff" UI options */</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>read_cache()<span class='macro_popup'>repo_read_index(the_repository)</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">		die(_(<span class='string_literal'>"Could not read the index"</span>));</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">	repo_init_revisions(the_repository, &amp;rev, prefix);</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">	rev.diffopt.context = 7;</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">	argc = setup_revisions(argc, argv, &amp;rev, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">	rev.diffopt.output_format = <span class='macro'>DIFF_FORMAT_PATCH<span class='macro_popup'>0x0010</span></span>;</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">	rev.diffopt.use_color = 0;</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">	rev.diffopt.flags.ignore_dirty_submodules = 1;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">	out = open(file, <span class='macro'>O_CREAT<span class='macro_popup'>0100</span></span> | <span class='macro'>O_WRONLY<span class='macro_popup'>01</span></span> | <span class='macro'>O_TRUNC<span class='macro_popup'>01000</span></span>, 0666);</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">	<span class='keyword'>if</span> (out &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">		die(_(<span class='string_literal'>"Could not open '%s' for writing."</span>), file);</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">	rev.diffopt.file = xfdopen(out, <span class='string_literal'>"w"</span>);</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">	rev.diffopt.close_file = 1;</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">	<span class='keyword'>if</span> (run_diff_files(&amp;rev, 0))</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">		die(_(<span class='string_literal'>"Could not write patch"</span>));</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">	<span class='keyword'>if</span> (launch_editor(file, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">		die(_(<span class='string_literal'>"editing patch failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">	<span class='keyword'>if</span> (stat(file, &amp;st))</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">		die_errno(_(<span class='string_literal'>"Could not stat '%s'"</span>), file);</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">	<span class='keyword'>if</span> (!st.st_size)</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">		die(_(<span class='string_literal'>"Empty patch. Aborted."</span>));</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">	child.git_cmd = 1;</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">	child.argv = apply_argv;</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">	<span class='keyword'>if</span> (run_command(&amp;child))</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">		die(_(<span class='string_literal'>"Could not apply '%s'"</span>), file);</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">	unlink(file);</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">	free(file);</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> ignore_error[] =</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"><span class='macro'>N_(<span class='string_literal'>"The following paths are ignored by one of your .gitignore files:\n"</span>)<span class='macro_popup'>("The following paths are ignored by one of your .gitignore files:\n"<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> verbose, show_only, ignored_too, refresh_only;</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ignore_add_errors, intent_to_add, ignore_missing;</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> warn_on_embedded_repo = 1;</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line"><span class='directive'>#define <span class='macro'>ADDREMOVE_DEFAULT<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> addremove = <span class='macro'>ADDREMOVE_DEFAULT<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> addremove_explicit = -1; <span class='comment'>/* unspecified */</span></td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *chmod_arg;</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ignore_removal_cb(<span class='keyword'>const</span> <span class='keyword'>struct</span> option *opt, <span class='keyword'>const</span> <span class='keyword'>char</span> *arg, <span class='keyword'>int</span> unset)</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">	<span class='comment'>/* if we are told to ignore, we are not adding removals */</span></td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">	*(<span class='keyword'>int</span> *)opt-&gt;value = !unset ? 0 : 1;</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> option builtin_add_options[] = {</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">	<span class='macro'>OPT__DRY_RUN(&amp;show_only, N_(<span class='string_literal'>"dry run"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('n'), ("dry-run"), ((&amp;show_only)), ((void<br>*)0), ((("dry run"))), PARSE_OPT_NOARG | (0), ((void*)0), (1)<br> }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">	<span class='macro'>OPT__VERBOSE(&amp;verbose, N_(<span class='string_literal'>"be verbose"</span>))<span class='macro_popup'>{ OPTION_COUNTUP, ('v'), ("verbose"), ((&amp;verbose)), ((void<br>*)0), ((("be verbose"))), PARSE_OPT_NOARG|(0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">	<span class='macro'>OPT_GROUP(<span class='string_literal'>""</span>)<span class='macro_popup'>{ OPTION_GROUP, 0, ((void*)0), ((void*)0), ((void*)0), ("") }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">	<span class='macro'>OPT_BOOL('i', <span class='string_literal'>"interactive"</span>, &amp;add_interactive, N_(<span class='string_literal'>"interactive picking"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('i'), ("interactive"), (&amp;add_interactive<br>), ((void*)0), (("interactive picking")), PARSE_OPT_NOARG | (<br>0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">	<span class='macro'>OPT_BOOL('p', <span class='string_literal'>"patch"</span>, &amp;patch_interactive, N_(<span class='string_literal'>"select hunks interactively"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('p'), ("patch"), (&amp;patch_interactive),<br> ((void*)0), (("select hunks interactively")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">	<span class='macro'>OPT_BOOL('e', <span class='string_literal'>"edit"</span>, &amp;edit_interactive, N_(<span class='string_literal'>"edit current diff and apply"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('e'), ("edit"), (&amp;edit_interactive), (<br>(void*)0), (("edit current diff and apply")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">	<span class='macro'>OPT__FORCE(&amp;ignored_too, N_(<span class='string_literal'>"allow adding otherwise ignored files"</span>), 0)<span class='macro_popup'>{ OPTION_COUNTUP, ('f'), ("force"), ((&amp;ignored_too)), ((void<br>*)0), ((("allow adding otherwise ignored files"))), PARSE_OPT_NOARG<br>|((0)) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">	<span class='macro'>OPT_BOOL('u', <span class='string_literal'>"update"</span>, &amp;take_worktree_changes, N_(<span class='string_literal'>"update tracked files"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('u'), ("update"), (&amp;take_worktree_changes<br>), ((void*)0), (("update tracked files")), PARSE_OPT_NOARG | (<br>0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">	<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"renormalize"</span>, &amp;add_renormalize, N_(<span class='string_literal'>"renormalize EOL of tracked files (implies -u)"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("renormalize"), (&amp;add_renormalize<br>), ((void*)0), (("renormalize EOL of tracked files (implies -u)"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">	<span class='macro'>OPT_BOOL('N', <span class='string_literal'>"intent-to-add"</span>, &amp;intent_to_add, N_(<span class='string_literal'>"record only the fact that the path will be added later"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('N'), ("intent-to-add"), (&amp;intent_to_add<br>), ((void*)0), (("record only the fact that the path will be added later"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">	<span class='macro'>OPT_BOOL('A', <span class='string_literal'>"all"</span>, &amp;addremove_explicit, N_(<span class='string_literal'>"add changes from all tracked and untracked files"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('A'), ("all"), (&amp;addremove_explicit), (<br>(void*)0), (("add changes from all tracked and untracked files"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">	<span class='macro'>OPT_CALLBACK_F(0, <span class='string_literal'>"ignore-removal"</span>, &amp;addremove_explicit,<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("ignore-removal"), (&amp;addremove_explicit<br>), (((void*)0)), (("ignore paths removed in the working tree (same as --no-all)"<br>)), (PARSE_OPT_NOARG), (ignore_removal_cb) }</span></span></td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">	  <span class='macro'>NULL <span class='comment'>/* takes no arguments */</span>,<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("ignore-removal"), (&amp;addremove_explicit<br>), (((void*)0)), (("ignore paths removed in the working tree (same as --no-all)"<br>)), (PARSE_OPT_NOARG), (ignore_removal_cb) }</span></span></td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">	  <span class='macro'>N_(<span class='string_literal'>"ignore paths removed in the working tree (same as --no-all)"</span>),<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("ignore-removal"), (&amp;addremove_explicit<br>), (((void*)0)), (("ignore paths removed in the working tree (same as --no-all)"<br>)), (PARSE_OPT_NOARG), (ignore_removal_cb) }</span></span></td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">	  <span class='macro'>PARSE_OPT_NOARG, ignore_removal_cb)<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("ignore-removal"), (&amp;addremove_explicit<br>), (((void*)0)), (("ignore paths removed in the working tree (same as --no-all)"<br>)), (PARSE_OPT_NOARG), (ignore_removal_cb) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">	<span class='macro'>OPT_BOOL( 0 , <span class='string_literal'>"refresh"</span>, &amp;refresh_only, N_(<span class='string_literal'>"don't add, only refresh the index"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("refresh"), (&amp;refresh_only), ((void<br>*)0), (("don't add, only refresh the index")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">	<span class='macro'>OPT_BOOL( 0 , <span class='string_literal'>"ignore-errors"</span>, &amp;ignore_add_errors, N_(<span class='string_literal'>"just skip files which cannot be added because of errors"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-errors"), (&amp;ignore_add_errors<br>), ((void*)0), (("just skip files which cannot be added because of errors"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">	<span class='macro'>OPT_BOOL( 0 , <span class='string_literal'>"ignore-missing"</span>, &amp;ignore_missing, N_(<span class='string_literal'>"check if - even missing - files are ignored in dry run"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-missing"), (&amp;ignore_missing<br>), ((void*)0), (("check if - even missing - files are ignored in dry run"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">	<span class='macro'>OPT_STRING(0, <span class='string_literal'>"chmod"</span>, &amp;chmod_arg, <span class='string_literal'>"(+|-)x"</span>,<span class='macro_popup'>{ OPTION_STRING, (0), ("chmod"), (&amp;chmod_arg), ("(+|-)x")<br>, (("override the executable bit of the listed files")), (0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">		   <span class='macro'>N_(<span class='string_literal'>"override the executable bit of the listed files"</span>))<span class='macro_popup'>{ OPTION_STRING, (0), ("chmod"), (&amp;chmod_arg), ("(+|-)x")<br>, (("override the executable bit of the listed files")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">	<span class='macro'>OPT_HIDDEN_BOOL(0, <span class='string_literal'>"warn-embedded-repo"</span>, &amp;warn_on_embedded_repo,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("warn-embedded-repo"), (&amp;warn_on_embedded_repo<br>), ((void*)0), (("warn when adding an embedded repository")),<br> PARSE_OPT_NOARG | PARSE_OPT_HIDDEN, ((void*)0), 1}</span></span></td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">			<span class='macro'>N_(<span class='string_literal'>"warn when adding an embedded repository"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("warn-embedded-repo"), (&amp;warn_on_embedded_repo<br>), ((void*)0), (("warn when adding an embedded repository")),<br> PARSE_OPT_NOARG | PARSE_OPT_HIDDEN, ((void*)0), 1}</span></span>,</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">	<span class='macro'>OPT_HIDDEN_BOOL(0, <span class='string_literal'>"legacy-stash-p"</span>, &amp;legacy_stash_p,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("legacy-stash-p"), (&amp;legacy_stash_p<br>), ((void*)0), (("backend for `git stash -p`")), PARSE_OPT_NOARG<br> | PARSE_OPT_HIDDEN, ((void*)0), 1}</span></span></td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">			<span class='macro'>N_(<span class='string_literal'>"backend for `git stash -p`"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("legacy-stash-p"), (&amp;legacy_stash_p<br>), ((void*)0), (("backend for `git stash -p`")), PARSE_OPT_NOARG<br> | PARSE_OPT_HIDDEN, ((void*)0), 1}</span></span>,</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">	<span class='macro'>OPT_PATHSPEC_FROM_FILE(&amp;pathspec_from_file)<span class='macro_popup'>{ OPTION_FILENAME, (0), ("pathspec-from-file"), (&amp;pathspec_from_file<br>), ("file"), (("read pathspec from file")) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">	<span class='macro'>OPT_PATHSPEC_FILE_NUL(&amp;pathspec_file_nul)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("pathspec-file-nul"), (&amp;pathspec_file_nul<br>), ((void*)0), (("with --pathspec-from-file, pathspec elements are separated with NUL character"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">	<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> add_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"add.ignoreerrors"</span>) ||</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">	    !strcmp(var, <span class='string_literal'>"add.ignore-errors"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">		ignore_add_errors = git_config_bool(var, value);</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">	<span class='keyword'>return</span> git_default_config(var, value, cb);</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> embedded_advice[] = <span class='macro'>N_(<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"><span class='string_literal'><span class='macro'>"You've added another git repository inside your current repository.\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"><span class='string_literal'><span class='macro'>"Clones of the outer repository will not contain the contents of\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"><span class='string_literal'><span class='macro'>"the embedded repository and will not know how to obtain it.\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line"><span class='string_literal'><span class='macro'>"If you meant to add a submodule, use:\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line"><span class='string_literal'><span class='macro'>"\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line"><span class='string_literal'><span class='macro'>"	git submodule add &lt;url&gt; %s\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line"><span class='string_literal'><span class='macro'>"\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line"><span class='string_literal'><span class='macro'>"If you added this path by mistake, you can remove it from the\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line"><span class='string_literal'><span class='macro'>"index with:\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line"><span class='string_literal'><span class='macro'>"\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"><span class='string_literal'><span class='macro'>"	git rm --cached %s\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line"><span class='string_literal'><span class='macro'>"\n"<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line"><span class='string_literal'><span class='macro'>"See \"git help submodule\" for more information."<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line"><span class='macro'>)<span class='macro_popup'>("You've added another git repository inside your current repository.\n"<br>"Clones of the outer repository will not contain the contents of\n"<br>"the embedded repository and will not know how to obtain it.\n"<br>"If you meant to add a submodule, use:\n""\n""	git submodule add &lt;url&gt; %s\n"<br>"\n""If you added this path by mistake, you can remove it from the\n"<br>"index with:\n""\n""	git rm --cached %s\n""\n""See \"git help submodule\" for more information."<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> check_embedded_repo(<span class='keyword'>const</span> <span class='keyword'>char</span> *path)</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">	<span class='keyword'>struct</span> strbuf name = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">	<span class='keyword'>if</span> (!warn_on_embedded_repo)</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">	<span class='keyword'>if</span> (!ends_with(path, <span class='string_literal'>"/"</span>))</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">	<span class='comment'>/* Drop trailing slash for aesthetics */</span></td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">	strbuf_addstr(&amp;name, path);</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">	strbuf_strip_suffix(&amp;name, <span class='string_literal'>"/"</span>);</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">	warning(_(<span class='string_literal'>"adding embedded git repository: %s"</span>), name.buf);</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">	<span class='keyword'>if</span> (advice_add_embedded_repo) {</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">		advise(embedded_advice, name.buf, name.buf);</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">		<span class='comment'>/* there may be multiple entries; advise only once */</span></td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">		advice_add_embedded_repo = 0;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">	strbuf_release(&amp;name);</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> add_files(<span class='keyword'>struct</span> dir_struct *dir, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">	<span class='keyword'>int</span> i, exit_status = 0;</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">	<span class='keyword'>if</span> (dir-&gt;ignored_nr) {</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">		fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(ignore_error));</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; dir-&gt;ignored_nr; i++)</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">			fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"%s\n"</span>, dir-&gt;ignored[i]-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">		<span class='keyword'>if</span> (advice_add_ignored_file)</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">			advise(_(<span class='string_literal'>"Use -f if you really want to add them.\n"</span></td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">				<span class='string_literal'>"Turn this message off by running\n"</span></td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">				<span class='string_literal'>"\"git config advice.addIgnoredFile false\""</span>));</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">		exit_status = 1;</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; dir-&gt;nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">		<span class='keyword'>if</span> (add_file_to_index(&amp;the_index, dir-&gt;entries[i]-&gt;name, flags)) {</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">			<span class='keyword'>if</span> (!ignore_add_errors)</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">				die(_(<span class='string_literal'>"adding files failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">			exit_status = 1;</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">			check_embedded_repo(dir-&gt;entries[i]-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">	<span class='keyword'>return</span> exit_status;</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line"><span class='keyword'>int</span> cmd_add(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">	<span class='keyword'>int</span> exit_status = 0;</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">	<span class='keyword'>struct</span> pathspec pathspec;</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">	<span class='keyword'>struct</span> dir_struct dir;</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">	<span class='keyword'>int</span> flags;</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">	<span class='keyword'>int</span> add_new_files;</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">	<span class='keyword'>int</span> require_pathspec;</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">	<span class='keyword'>char</span> *seen = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">	<span class='keyword'>struct</span> lock_file lock_file = <span class='macro'>LOCK_INIT<span class='macro_popup'>{ ((void*)0) }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">	git_config(add_config, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">	argc = parse_options(argc, argv, prefix, builtin_add_options,</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">			  builtin_add_usage, PARSE_OPT_KEEP_ARGV0);</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">	<span class='keyword'>if</span> (patch_interactive)</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">		add_interactive = 1;</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">	<span class='keyword'>if</span> (add_interactive) {</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">		<span class='keyword'>if</span> (pathspec_from_file)</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with --interactive/--patch"</span>));</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">		<span class='macro'>exit(interactive_add(argv + 1, prefix, patch_interactive))<span class='macro_popup'>exit(trace2_cmd_exit_fl("builtin/add.c", 454, (interactive_add<br>(argv + 1, prefix, patch_interactive))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">	<span class='keyword'>if</span> (legacy_stash_p) {</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">		<span class='keyword'>struct</span> pathspec pathspec;</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">		parse_pathspec(&amp;pathspec, 0,</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">			<span class='macro'>PATHSPEC_PREFER_FULL<span class='macro_popup'>(1&lt;&lt;1)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">			<span class='macro'>PATHSPEC_SYMLINK_LEADING_PATH<span class='macro_popup'>(1&lt;&lt;3)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">			<span class='macro'>PATHSPEC_PREFIX_ORIGIN<span class='macro_popup'>(1&lt;&lt;4)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">			prefix, argv);</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">		<span class='keyword'>return</span> run_add_interactive(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='string_literal'>"--patch=stash"</span>, &amp;pathspec);</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">	<span class='keyword'>if</span> (edit_interactive) {</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">		<span class='keyword'>if</span> (pathspec_from_file)</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with --edit"</span>));</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">		<span class='keyword'>return</span>(edit_patch(argc, argv, prefix));</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">	argc--;</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">	argv++;</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">	<span class='keyword'>if</span> (0 &lt;= addremove_explicit)</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">		addremove = addremove_explicit;</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (take_worktree_changes &amp;&amp; <span class='macro'>ADDREMOVE_DEFAULT<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">		addremove = 0; <span class='comment'>/* "-u" was given but not "-A" */</span></td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">	<span class='keyword'>if</span> (addremove &amp;&amp; take_worktree_changes)</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">		die(_(<span class='string_literal'>"-A and -u are mutually incompatible"</span>));</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">	<span class='keyword'>if</span> (!show_only &amp;&amp; ignore_missing)</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">		die(_(<span class='string_literal'>"Option --ignore-missing can only be used together with --dry-run"</span>));</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">	<span class='keyword'>if</span> (chmod_arg &amp;&amp; ((chmod_arg[0] != '-' &amp;&amp; chmod_arg[0] != '+') ||</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">			  chmod_arg[1] != 'x' || chmod_arg[2]))</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">		die(_(<span class='string_literal'>"--chmod param '%s' must be either -x or +x"</span>), chmod_arg);</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">	add_new_files = !take_worktree_changes &amp;&amp; !refresh_only &amp;&amp; !add_renormalize;</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">	require_pathspec = !(take_worktree_changes || (0 &lt; addremove_explicit));</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">	<span class='macro'>hold_locked_index(&amp;lock_file, LOCK_DIE_ON_ERROR)<span class='macro_popup'>repo_hold_locked_index(the_repository, (&amp;lock_file), (1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">	 <span class='comment'>* Check the "pathspec '%s' did not match any files" block</span></td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">	 <span class='comment'>* below before enabling new magic.</span></td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">	parse_pathspec(&amp;pathspec, <span class='macro'>PATHSPEC_ATTR<span class='macro_popup'>(1&lt;&lt;6)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">		       <span class='macro'>PATHSPEC_PREFER_FULL<span class='macro_popup'>(1&lt;&lt;1)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">		       <span class='macro'>PATHSPEC_SYMLINK_LEADING_PATH<span class='macro_popup'>(1&lt;&lt;3)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">		       prefix, argv);</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">	<span class='keyword'>if</span> (pathspec_from_file) {</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">		<span class='keyword'>if</span> (pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with pathspec arguments"</span>));</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">		parse_pathspec_file(&amp;pathspec, <span class='macro'>PATHSPEC_ATTR<span class='macro_popup'>(1&lt;&lt;6)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">				    <span class='macro'>PATHSPEC_PREFER_FULL<span class='macro_popup'>(1&lt;&lt;1)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">				    <span class='macro'>PATHSPEC_SYMLINK_LEADING_PATH<span class='macro_popup'>(1&lt;&lt;3)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">				    prefix, pathspec_from_file, pathspec_file_nul);</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (pathspec_file_nul) {</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">		die(_(<span class='string_literal'>"--pathspec-file-nul requires --pathspec-from-file"</span>));</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">	<span class='keyword'>if</span> (require_pathspec &amp;&amp; pathspec.nr == 0) {</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">		fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Nothing specified, nothing added.\n"</span>));</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">		<span class='keyword'>if</span> (advice_add_empty_pathspec)</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">			advise( _(<span class='string_literal'>"Maybe you wanted to say 'git add .'?\n"</span></td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">				<span class='string_literal'>"Turn this message off by running\n"</span></td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">				<span class='string_literal'>"\"git config advice.addEmptyPathspec false\""</span>));</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">	<span class='keyword'>if</span> (!take_worktree_changes &amp;&amp; addremove_explicit &lt; 0 &amp;&amp; pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">		<span class='comment'>/* Turn "git add pathspec..." to "git add -A pathspec..." */</span></td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">		addremove = 1;</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">	flags = ((verbose ? <span class='macro'>ADD_CACHE_VERBOSE<span class='macro_popup'>1</span></span> : 0) |</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">		 (show_only ? <span class='macro'>ADD_CACHE_PRETEND<span class='macro_popup'>2</span></span> : 0) |</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">		 (intent_to_add ? <span class='macro'>ADD_CACHE_INTENT<span class='macro_popup'>16</span></span> : 0) |</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">		 (ignore_add_errors ? <span class='macro'>ADD_CACHE_IGNORE_ERRORS<span class='macro_popup'>4</span></span> : 0) |</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">		 (!(addremove || take_worktree_changes)</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">		  ? <span class='macro'>ADD_CACHE_IGNORE_REMOVAL<span class='macro_popup'>8</span></span> : 0));</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>read_cache_preload(&amp;pathspec)<span class='macro_popup'>repo_read_index_preload(the_repository, (&amp;pathspec), 0)</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">		die(_(<span class='string_literal'>"index file corrupt"</span>));</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">	die_in_unpopulated_submodule(&amp;the_index, prefix);</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">	die_path_inside_submodule(&amp;the_index, &amp;pathspec);</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">	dir_init(&amp;dir);</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">	<span class='keyword'>if</span> (add_new_files) {</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">		<span class='keyword'>int</span> baselen;</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">		<span class='comment'>/* Set up the default git porcelain excludes */</span></td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">		<span class='keyword'>if</span> (!ignored_too) {</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">			dir.flags |= DIR_COLLECT_IGNORED;</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">			setup_standard_excludes(&amp;dir);</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">		<span class='comment'>/* This picks up the paths that are not tracked */</span></td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">		baselen = fill_directory(&amp;dir, &amp;the_index, &amp;pathspec);</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">		<span class='keyword'>if</span> (pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">			seen = prune_directory(&amp;dir, &amp;pathspec, baselen);</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">	<span class='keyword'>if</span> (refresh_only) {</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">		refresh(verbose, &amp;pathspec);</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">		<span class='keyword'>goto</span> finish;</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">	<span class='keyword'>if</span> (pathspec.nr) {</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">		<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">		<span class='keyword'>if</span> (!seen)</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">			seen = find_pathspecs_matching_against_index(&amp;pathspec, &amp;the_index);</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">		 <span class='comment'>* file_exists() assumes exact match</span></td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">		<span class='macro'>GUARD_PATHSPEC(&amp;pathspec,<span class='macro_popup'>do { if ((&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;0) | (1&lt;&lt;<br>2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5))) die("BUG:%s:%d: unsupported magic %x"<br>, "builtin/add.c", 578, (&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;<br>0) | (1&lt;&lt;2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5<br>))); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">			       <span class='macro'>PATHSPEC_FROMTOP |<span class='macro_popup'>do { if ((&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;0) | (1&lt;&lt;<br>2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5))) die("BUG:%s:%d: unsupported magic %x"<br>, "builtin/add.c", 578, (&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;<br>0) | (1&lt;&lt;2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5<br>))); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">			       <span class='macro'>PATHSPEC_LITERAL |<span class='macro_popup'>do { if ((&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;0) | (1&lt;&lt;<br>2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5))) die("BUG:%s:%d: unsupported magic %x"<br>, "builtin/add.c", 578, (&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;<br>0) | (1&lt;&lt;2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5<br>))); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">			       <span class='macro'>PATHSPEC_GLOB |<span class='macro_popup'>do { if ((&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;0) | (1&lt;&lt;<br>2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5))) die("BUG:%s:%d: unsupported magic %x"<br>, "builtin/add.c", 578, (&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;<br>0) | (1&lt;&lt;2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5<br>))); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">			       <span class='macro'>PATHSPEC_ICASE |<span class='macro_popup'>do { if ((&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;0) | (1&lt;&lt;<br>2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5))) die("BUG:%s:%d: unsupported magic %x"<br>, "builtin/add.c", 578, (&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;<br>0) | (1&lt;&lt;2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5<br>))); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">			       <span class='macro'>PATHSPEC_EXCLUDE)<span class='macro_popup'>do { if ((&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;0) | (1&lt;&lt;<br>2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5))) die("BUG:%s:%d: unsupported magic %x"<br>, "builtin/add.c", 578, (&amp;pathspec)-&gt;magic &amp; ~((1&lt;&lt;<br>0) | (1&lt;&lt;2) | (1&lt;&lt;3) | (1&lt;&lt;4) | (1&lt;&lt;5<br>))); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; pathspec.nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">			<span class='keyword'>const</span> <span class='keyword'>char</span> *path = pathspec.items[i].match;</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">			<span class='keyword'>if</span> (pathspec.items[i].magic &amp; <span class='macro'>PATHSPEC_EXCLUDE<span class='macro_popup'>(1&lt;&lt;5)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">			<span class='keyword'>if</span> (!seen[i] &amp;&amp; path[0] &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">			    ((pathspec.items[i].magic &amp;</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">			      (<span class='macro'>PATHSPEC_GLOB<span class='macro_popup'>(1&lt;&lt;3)</span></span> | <span class='macro'>PATHSPEC_ICASE<span class='macro_popup'>(1&lt;&lt;4)</span></span>)) ||</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">			     !file_exists(path))) {</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">				<span class='keyword'>if</span> (ignore_missing) {</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">					<span class='keyword'>int</span> dtype = <span class='macro'>DT_UNKNOWN<span class='macro_popup'>DT_UNKNOWN</span></span>;</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">					<span class='keyword'>if</span> (is_excluded(&amp;dir, &amp;the_index, path, &amp;dtype))</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">						dir_add_ignored(&amp;dir, &amp;the_index,</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">								path, pathspec.items[i].len);</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">				} <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">					die(_(<span class='string_literal'>"pathspec '%s' did not match any files"</span>),</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">					    pathspec.items[i].original);</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">		free(seen);</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">	plug_bulk_checkin();</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">	<span class='keyword'>if</span> (add_renormalize)</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">		exit_status |= renormalize_tracked_files(&amp;pathspec, flags);</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">		exit_status |= add_files_to_cache(prefix, &amp;pathspec, flags);</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">	<span class='keyword'>if</span> (add_new_files)</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">		exit_status |= add_files(&amp;dir, flags);</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">	<span class='keyword'>if</span> (chmod_arg &amp;&amp; pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">		chmod_pathspec(&amp;pathspec, chmod_arg[0]);</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">	unplug_bulk_checkin();</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">finish:</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">	<span class='keyword'>if</span> (write_locked_index(&amp;the_index, &amp;lock_file,</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">			       <span class='macro'>COMMIT_LOCK<span class='macro_popup'>(1 &lt;&lt; 0)</span></span> | <span class='macro'>SKIP_IF_UNCHANGED<span class='macro_popup'>(1 &lt;&lt; 1)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">		die(_(<span class='string_literal'>"Unable to write new index file"</span>));</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">	dir_clear(&amp;dir);</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">	<span class='macro'>UNLEAK(pathspec)<span class='macro_popup'>do {} while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">	<span class='keyword'>return</span> exit_status;</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">}</td></tr>
</table></body></html>
