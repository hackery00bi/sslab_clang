<!doctype html>
<html>
<head>
<title>builtin/checkout.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memset' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/real/c_git/git/builtin/checkout.c -->

<!-- FILENAME checkout.c -->

<!-- FUNCTIONNAME cmd_restore -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 181a42e2cdeb3f80e1a216e2289bda04 -->

<!-- BUGLINE 1851 -->

<!-- BUGCOLUMN 2 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>builtin/checkout.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 1851, column 2</a><br />Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name checkout.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I . -D HAVE_SYSINFO -D GIT_HOST_CPU="x86_64" -D HAVE_ALLOCA_H -D USE_CURL_FOR_IMAP_SEND -D SHA1_DC -D SHA1DC_NO_STANDARD_INCLUDES -D SHA1DC_INIT_SAFE_HASH_DEFAULT=0 -D SHA1DC_CUSTOM_INCLUDE_SHA1_C="cache.h" -D SHA1DC_CUSTOM_INCLUDE_UBC_CHECK_C="git-compat-util.h" -D SHA256_BLK -D HAVE_PATHS_H -D HAVE_DEV_TTY -D HAVE_CLOCK_GETTIME -D HAVE_CLOCK_MONOTONIC -D HAVE_GETDELIM -D PROCFS_EXECUTABLE_PATH="/proc/self/exe" -D FREAD_READS_DIRECTORIES -D NO_STRLCPY -D SHELL_PATH="/bin/sh" -D PAGER_ENV="LESS=FRX LV=-c" -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -fdebug-compilation-dir /tmp/real/c_git/git -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker deadcode -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-19-144418-19857-1 -x c builtin/checkout.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"1851": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#define USE_THE_INDEX_COMPATIBILITY_MACROS</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#include "builtin.h"</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='directive'>#include "advice.h"</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='directive'>#include "blob.h"</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='directive'>#include "branch.h"</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#include "cache-tree.h"</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#include "checkout.h"</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#include "commit.h"</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include "config.h"</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include "diff.h"</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include "dir.h"</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include "ll-merge.h"</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include "lockfile.h"</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include "merge-recursive.h"</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include "object-store.h"</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "parse-options.h"</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include "refs.h"</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include "remote.h"</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include "resolve-undo.h"</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "revision.h"</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include "run-command.h"</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include "submodule.h"</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include "submodule-config.h"</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include "tree.h"</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include "tree-walk.h"</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include "unpack-trees.h"</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include "wt-status.h"</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='directive'>#include "xdiff-interface.h"</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> checkout_usage[] = {</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git checkout [&lt;options&gt;] &lt;branch&gt;"</span>)<span class='macro_popup'>("git checkout [&lt;options&gt;] &lt;branch&gt;")</span></span>,</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git checkout [&lt;options&gt;] [&lt;branch&gt;] -- &lt;file&gt;..."</span>)<span class='macro_popup'>("git checkout [&lt;options&gt;] [&lt;branch&gt;] -- &lt;file&gt;..."<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">	<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> switch_branch_usage[] = {</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git switch [&lt;options&gt;] [&lt;branch&gt;]"</span>)<span class='macro_popup'>("git switch [&lt;options&gt;] [&lt;branch&gt;]")</span></span>,</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">	<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> restore_usage[] = {</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git restore [&lt;options&gt;] [--source=&lt;branch&gt;] &lt;file&gt;..."</span>)<span class='macro_popup'>("git restore [&lt;options&gt;] [--source=&lt;branch&gt;] &lt;file&gt;..."<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">	<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"><span class='keyword'>struct</span> checkout_opts {</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">	<span class='keyword'>int</span> patch_mode;</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">	<span class='keyword'>int</span> quiet;</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">	<span class='keyword'>int</span> merge;</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">	<span class='keyword'>int</span> force;</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">	<span class='keyword'>int</span> force_detach;</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">	<span class='keyword'>int</span> implicit_detach;</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">	<span class='keyword'>int</span> writeout_stage;</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">	<span class='keyword'>int</span> overwrite_ignore;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">	<span class='keyword'>int</span> ignore_skipworktree;</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">	<span class='keyword'>int</span> ignore_other_worktrees;</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">	<span class='keyword'>int</span> show_progress;</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">	<span class='keyword'>int</span> count_checkout_paths;</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">	<span class='keyword'>int</span> overlay_mode;</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">	<span class='keyword'>int</span> dwim_new_local_branch;</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">	<span class='keyword'>int</span> discard_changes;</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">	<span class='keyword'>int</span> accept_ref;</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">	<span class='keyword'>int</span> accept_pathspec;</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">	<span class='keyword'>int</span> switch_branch_doing_nothing_is_ok;</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">	<span class='keyword'>int</span> only_merge_on_switching_branches;</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">	<span class='keyword'>int</span> can_switch_when_in_progress;</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">	<span class='keyword'>int</span> orphan_from_empty_tree;</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">	<span class='keyword'>int</span> empty_pathspec_ok;</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">	<span class='keyword'>int</span> checkout_index;</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">	<span class='keyword'>int</span> checkout_worktree;</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *ignore_unmerged_opt;</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">	<span class='keyword'>int</span> ignore_unmerged;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">	<span class='keyword'>int</span> pathspec_file_nul;</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *pathspec_from_file;</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *new_branch;</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *new_branch_force;</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *new_orphan_branch;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">	<span class='keyword'>int</span> new_branch_log;</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">	<span class='keyword'>enum</span> branch_track track;</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">	<span class='keyword'>struct</span> diff_options diff_options;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">	<span class='keyword'>char</span> *conflict_style;</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">	<span class='keyword'>int</span> branch_exists;</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *prefix;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">	<span class='keyword'>struct</span> pathspec pathspec;</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *from_treeish;</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">	<span class='keyword'>struct</span> tree *source_tree;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"><span class='keyword'>struct</span> branch_info {</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name; <span class='comment'>/* The short name used */</span></td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *path; <span class='comment'>/* The full name of a real branch */</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">	<span class='keyword'>struct</span> commit *commit; <span class='comment'>/* The named commit */</span></td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">	<span class='keyword'>char</span> *refname; <span class='comment'>/* The full name of the ref being checked out. */</span></td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">	<span class='keyword'>struct</span> object_id oid; <span class='comment'>/* The object ID of the commit being checked out. */</span></td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">	 <span class='comment'>* if not null the branch is detached because it's already</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">	 <span class='comment'>* checked out in this checkout</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">	<span class='keyword'>char</span> *checkout;</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> post_checkout_hook(<span class='keyword'>struct</span> commit *old_commit, <span class='keyword'>struct</span> commit *new_commit,</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">			      <span class='keyword'>int</span> changed)</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">	<span class='keyword'>return</span> run_hook_le(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='string_literal'>"post-checkout"</span>,</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">			   oid_to_hex(old_commit ? &amp;old_commit-&gt;object.oid : &amp;null_oid),</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">			   oid_to_hex(new_commit ? &amp;new_commit-&gt;object.oid : &amp;null_oid),</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">			   changed ? <span class='string_literal'>"1"</span> : <span class='string_literal'>"0"</span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">	<span class='comment'>/* "new_commit" can be NULL when checking out from the index before</span></td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">	   <span class='comment'>a commit exists. */</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> update_some(<span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid, <span class='keyword'>struct</span> strbuf *base,</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *pathname, <span class='keyword'>unsigned</span> mode, <span class='keyword'>int</span> stage, <span class='keyword'>void</span> *context)</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">	<span class='keyword'>int</span> len;</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">	<span class='keyword'>struct</span> cache_entry *ce;</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">	<span class='keyword'>int</span> pos;</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISDIR(mode)<span class='macro_popup'>((((mode)) &amp; 0170000) == (0040000))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>READ_TREE_RECURSIVE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">	len = base-&gt;len + strlen(pathname);</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">	ce = make_empty_cache_entry(&amp;the_index, len);</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">	oidcpy(&amp;ce-&gt;oid, oid);</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">	memcpy(ce-&gt;name, base-&gt;buf, base-&gt;len);</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">	memcpy(ce-&gt;name + base-&gt;len, pathname, len - base-&gt;len);</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">	ce-&gt;ce_flags = create_ce_flags(0) | <span class='macro'>CE_UPDATE<span class='macro_popup'>(1 &lt;&lt; 16)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">	ce-&gt;ce_namelen = len;</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">	ce-&gt;ce_mode = create_ce_mode(mode);</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">	 <span class='comment'>* If the entry is the same as the current index, we can leave the old</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">	 <span class='comment'>* entry in place. Whether it is UPTODATE or not, checkout_entry will</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">	 <span class='comment'>* do the right thing.</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">	pos = <span class='macro'>cache_name_pos(ce-&gt;name, ce-&gt;ce_namelen)<span class='macro_popup'>index_name_pos(&amp;the_index,(ce-&gt;name),(ce-&gt;ce_namelen<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">	<span class='keyword'>if</span> (pos &gt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">		<span class='keyword'>struct</span> cache_entry *old = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos];</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">		<span class='keyword'>if</span> (ce-&gt;ce_mode == old-&gt;ce_mode &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">		    !<span class='macro'>ce_intent_to_add(old)<span class='macro_popup'>((old)-&gt;ce_flags &amp; (1 &lt;&lt; 29))</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">		    oideq(&amp;ce-&gt;oid, &amp;old-&gt;oid)) {</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">			old-&gt;ce_flags |= <span class='macro'>CE_UPDATE<span class='macro_popup'>(1 &lt;&lt; 16)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">			discard_cache_entry(ce);</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">	<span class='macro'>add_cache_entry(ce, ADD_CACHE_OK_TO_ADD | ADD_CACHE_OK_TO_REPLACE)<span class='macro_popup'>add_index_entry(&amp;the_index, (ce), (1 | 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> read_tree_some(<span class='keyword'>struct</span> tree *tree, <span class='keyword'>const</span> <span class='keyword'>struct</span> pathspec *pathspec)</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">	read_tree_recursive(the_repository, tree, <span class='string_literal'>""</span>, 0, 0,</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">			    pathspec, update_some, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">	<span class='comment'>/* update the index with the given tree's info</span></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">	 <span class='comment'>* for all args, expanding wildcards, and exit</span></td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">	 <span class='comment'>* with any non-zero return code.</span></td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> skip_same_name(<span class='keyword'>const</span> <span class='keyword'>struct</span> cache_entry *ce, <span class='keyword'>int</span> pos)</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">	<span class='keyword'>while</span> (++pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">	       !strcmp(<span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos]-&gt;name, ce-&gt;name))</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">		; <span class='comment'>/* skip */</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">	<span class='keyword'>return</span> pos;</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> check_stage(<span class='keyword'>int</span> stage, <span class='keyword'>const</span> <span class='keyword'>struct</span> cache_entry *ce, <span class='keyword'>int</span> pos,</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">		       <span class='keyword'>int</span> overlay_mode)</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">	<span class='keyword'>while</span> (pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">	       !strcmp(<span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos]-&gt;name, ce-&gt;name)) {</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>ce_stage(active_cache[pos])<span class='macro_popup'>(((0x3000) &amp; ((the_index.cache)[pos])-&gt;ce_flags) &gt;&gt;<br> 12)</span></span> == stage)</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">		pos++;</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">	<span class='keyword'>if</span> (!overlay_mode)</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">	<span class='keyword'>if</span> (stage == 2)</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s' does not have our version"</span>), ce-&gt;name)<span class='macro_popup'>(error(_("path '%s' does not have our version"), ce-&gt;name)<br>, const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s' does not have their version"</span>), ce-&gt;name)<span class='macro_popup'>(error(_("path '%s' does not have their version"), ce-&gt;name<br>), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> check_stages(<span class='keyword'>unsigned</span> stages, <span class='keyword'>const</span> <span class='keyword'>struct</span> cache_entry *ce, <span class='keyword'>int</span> pos)</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">	<span class='keyword'>unsigned</span> seen = 0;</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name = ce-&gt;name;</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">	<span class='keyword'>while</span> (pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">		ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos];</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">		<span class='keyword'>if</span> (strcmp(name, ce-&gt;name))</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">		seen |= (1 &lt;&lt; <span class='macro'>ce_stage(ce)<span class='macro_popup'>(((0x3000) &amp; (ce)-&gt;ce_flags) &gt;&gt; 12)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">		pos++;</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">	<span class='keyword'>if</span> ((stages &amp; seen) != stages)</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s' does not have all necessary versions"</span>),<span class='macro_popup'>(error(_("path '%s' does not have all necessary versions"), name<br>), const_error())</span></span></td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">			     <span class='macro'>name)<span class='macro_popup'>(error(_("path '%s' does not have all necessary versions"), name<br>), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> checkout_stage(<span class='keyword'>int</span> stage, <span class='keyword'>const</span> <span class='keyword'>struct</span> cache_entry *ce, <span class='keyword'>int</span> pos,</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">			  <span class='keyword'>const</span> <span class='keyword'>struct</span> checkout *state, <span class='keyword'>int</span> *nr_checkouts,</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">			  <span class='keyword'>int</span> overlay_mode)</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">	<span class='keyword'>while</span> (pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">	       !strcmp(<span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos]-&gt;name, ce-&gt;name)) {</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>ce_stage(active_cache[pos])<span class='macro_popup'>(((0x3000) &amp; ((the_index.cache)[pos])-&gt;ce_flags) &gt;&gt;<br> 12)</span></span> == stage)</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">			<span class='keyword'>return</span> checkout_entry(<span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos], state,</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">					      <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, nr_checkouts);</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">		pos++;</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">	<span class='keyword'>if</span> (!overlay_mode) {</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">		unlink_entry(ce);</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">	<span class='keyword'>if</span> (stage == 2)</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s' does not have our version"</span>), ce-&gt;name)<span class='macro_popup'>(error(_("path '%s' does not have our version"), ce-&gt;name)<br>, const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s' does not have their version"</span>), ce-&gt;name)<span class='macro_popup'>(error(_("path '%s' does not have their version"), ce-&gt;name<br>), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> checkout_merged(<span class='keyword'>int</span> pos, <span class='keyword'>const</span> <span class='keyword'>struct</span> checkout *state, <span class='keyword'>int</span> *nr_checkouts)</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">	<span class='keyword'>struct</span> cache_entry *ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos];</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *path = ce-&gt;name;</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">	mmfile_t ancestor, ours, theirs;</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">	<span class='keyword'>int</span> status;</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">	<span class='keyword'>struct</span> object_id oid;</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">	mmbuffer_t result_buf;</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">	<span class='keyword'>struct</span> object_id threeway[3];</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">	<span class='keyword'>unsigned</span> mode = 0;</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">	<span class='keyword'>struct</span> ll_merge_options ll_opts;</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">	<span class='keyword'>int</span> renormalize = 0;</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">	memset(threeway, 0, <span class='keyword'>sizeof</span>(threeway));</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">	<span class='keyword'>while</span> (pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">		<span class='keyword'>int</span> stage;</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">		stage = <span class='macro'>ce_stage(ce)<span class='macro_popup'>(((0x3000) &amp; (ce)-&gt;ce_flags) &gt;&gt; 12)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">		<span class='keyword'>if</span> (!stage || strcmp(path, ce-&gt;name))</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">		oidcpy(&amp;threeway[stage - 1], &amp;ce-&gt;oid);</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">		<span class='keyword'>if</span> (stage == 2)</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">			mode = create_ce_mode(ce-&gt;ce_mode);</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">		pos++;</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">		ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos];</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">	<span class='keyword'>if</span> (is_null_oid(&amp;threeway[1]) || is_null_oid(&amp;threeway[2]))</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s' does not have necessary versions"</span>), path)<span class='macro_popup'>(error(_("path '%s' does not have necessary versions"), path)<br>, const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">	read_mmblob(&amp;ancestor, &amp;threeway[0]);</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">	read_mmblob(&amp;ours, &amp;threeway[1]);</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">	read_mmblob(&amp;theirs, &amp;threeway[2]);</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">	memset(&amp;ll_opts, 0, <span class='keyword'>sizeof</span>(ll_opts));</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">	git_config_get_bool(<span class='string_literal'>"merge.renormalize"</span>, &amp;renormalize);</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">	ll_opts.renormalize = renormalize;</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">	status = ll_merge(&amp;result_buf, path, &amp;ancestor, <span class='string_literal'>"base"</span>,</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">			  &amp;ours, <span class='string_literal'>"ours"</span>, &amp;theirs, <span class='string_literal'>"theirs"</span>,</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">			  state-&gt;istate, &amp;ll_opts);</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">	free(ancestor.ptr);</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">	free(ours.ptr);</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">	free(theirs.ptr);</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">	<span class='keyword'>if</span> (status &lt; 0 || !result_buf.ptr) {</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">		free(result_buf.ptr);</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"path '%s': cannot merge"</span>), path)<span class='macro_popup'>(error(_("path '%s': cannot merge"), path), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">	 <span class='comment'>* NEEDSWORK:</span></td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">	 <span class='comment'>* There is absolutely no reason to write this as a blob object</span></td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">	 <span class='comment'>* and create a phony cache entry.  This hack is primarily to get</span></td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">	 <span class='comment'>* to the write_entry() machinery that massages the contents to</span></td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">	 <span class='comment'>* work-tree format and writes out which only allows it for a</span></td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">	 <span class='comment'>* cache entry.  The code in write_entry() needs to be refactored</span></td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">	 <span class='comment'>* to allow us to feed a &lt;buffer, size, mode&gt; instead of a cache</span></td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">	 <span class='comment'>* entry.  Such a refactoring would help merge_recursive as well</span></td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">	 <span class='comment'>* (it also writes the merge result to the object database even</span></td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">	 <span class='comment'>* when it may contain conflicts).</span></td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">	<span class='keyword'>if</span> (write_object_file(result_buf.ptr, result_buf.size, blob_type, &amp;oid))</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">		die(_(<span class='string_literal'>"Unable to add merge result for '%s'"</span>), path);</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">	free(result_buf.ptr);</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">	ce = make_transient_cache_entry(mode, &amp;oid, path, 2);</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">	<span class='keyword'>if</span> (!ce)</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">		die(_(<span class='string_literal'>"make_cache_entry failed for path '%s'"</span>), path);</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">	status = checkout_entry(ce, state, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, nr_checkouts);</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">	discard_cache_entry(ce);</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">	<span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> mark_ce_for_checkout_overlay(<span class='keyword'>struct</span> cache_entry *ce,</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">					 <span class='keyword'>char</span> *ps_matched,</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">					 <span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts)</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">	ce-&gt;ce_flags &amp;= ~<span class='macro'>CE_MATCHED<span class='macro_popup'>(1 &lt;&lt; 26)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;ignore_skipworktree &amp;&amp; <span class='macro'>ce_skip_worktree(ce)<span class='macro_popup'>((ce)-&gt;ce_flags &amp; (1 &lt;&lt; 30))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;source_tree &amp;&amp; !(ce-&gt;ce_flags &amp; <span class='macro'>CE_UPDATE<span class='macro_popup'>(1 &lt;&lt; 16)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">		 <span class='comment'>* "git checkout tree-ish -- path", but this entry</span></td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">		 <span class='comment'>* is in the original index but is not in tree-ish</span></td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">		 <span class='comment'>* or does not match the pathspec; it will not be</span></td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">		 <span class='comment'>* checked out to the working tree.  We will not do</span></td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">		 <span class='comment'>* anything to this entry at all.</span></td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">	 <span class='comment'>* Either this entry came from the tree-ish we are</span></td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">	 <span class='comment'>* checking the paths out of, or we are checking out</span></td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">	 <span class='comment'>* of the index.</span></td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">	 <span class='comment'>* If it comes from the tree-ish, we already know it</span></td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">	 <span class='comment'>* matches the pathspec and could just stamp</span></td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">	 <span class='comment'>* CE_MATCHED to it from update_some(). But we still</span></td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">	 <span class='comment'>* need ps_matched and read_tree_recursive (and</span></td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">	 <span class='comment'>* eventually tree_entry_interesting) cannot fill</span></td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">	 <span class='comment'>* ps_matched yet. Once it can, we can avoid calling</span></td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">	 <span class='comment'>* match_pathspec() for _all_ entries when</span></td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">	 <span class='comment'>* opts-&gt;source_tree != NULL.</span></td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">	<span class='keyword'>if</span> (ce_path_match(&amp;the_index, ce, &amp;opts-&gt;pathspec, ps_matched))</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">		ce-&gt;ce_flags |= <span class='macro'>CE_MATCHED<span class='macro_popup'>(1 &lt;&lt; 26)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> mark_ce_for_checkout_no_overlay(<span class='keyword'>struct</span> cache_entry *ce,</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">					    <span class='keyword'>char</span> *ps_matched,</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">					    <span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts)</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">	ce-&gt;ce_flags &amp;= ~<span class='macro'>CE_MATCHED<span class='macro_popup'>(1 &lt;&lt; 26)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;ignore_skipworktree &amp;&amp; <span class='macro'>ce_skip_worktree(ce)<span class='macro_popup'>((ce)-&gt;ce_flags &amp; (1 &lt;&lt; 30))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">	<span class='keyword'>if</span> (ce_path_match(&amp;the_index, ce, &amp;opts-&gt;pathspec, ps_matched)) {</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">		ce-&gt;ce_flags |= <span class='macro'>CE_MATCHED<span class='macro_popup'>(1 &lt;&lt; 26)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;source_tree &amp;&amp; !(ce-&gt;ce_flags &amp; <span class='macro'>CE_UPDATE<span class='macro_popup'>(1 &lt;&lt; 16)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">			 <span class='comment'>* In overlay mode, but the path is not in</span></td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">			 <span class='comment'>* tree-ish, which means we should remove it</span></td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">			 <span class='comment'>* from the index and the working tree.</span></td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">			ce-&gt;ce_flags |= <span class='macro'>CE_REMOVE<span class='macro_popup'>(1 &lt;&lt; 17)</span></span> | <span class='macro'>CE_WT_REMOVE<span class='macro_popup'>(1 &lt;&lt; 22)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> checkout_worktree(<span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">			     <span class='keyword'>const</span> <span class='keyword'>struct</span> branch_info *info)</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">	<span class='keyword'>struct</span> checkout state = <span class='macro'>CHECKOUT_INIT<span class='macro_popup'>{ ((void*)0), "" }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">	<span class='keyword'>int</span> nr_checkouts = 0, nr_unmerged = 0;</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">	<span class='keyword'>int</span> errs = 0;</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">	<span class='keyword'>int</span> pos;</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">	state.force = 1;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">	state.refresh_cache = 1;</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">	state.istate = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">	init_checkout_metadata(&amp;state.meta, info-&gt;refname,</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">			       info-&gt;commit ? &amp;info-&gt;commit-&gt;object.oid : &amp;info-&gt;oid,</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">			       <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">	enable_delayed_checkout(&amp;state);</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">	<span class='keyword'>for</span> (pos = 0; pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>; pos++) {</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">		<span class='keyword'>struct</span> cache_entry *ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos];</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">		<span class='keyword'>if</span> (ce-&gt;ce_flags &amp; <span class='macro'>CE_MATCHED<span class='macro_popup'>(1 &lt;&lt; 26)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">			<span class='keyword'>if</span> (!<span class='macro'>ce_stage(ce)<span class='macro_popup'>(((0x3000) &amp; (ce)-&gt;ce_flags) &gt;&gt; 12)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">				errs |= checkout_entry(ce, &amp;state,</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">						       <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;nr_checkouts);</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">			<span class='keyword'>if</span> (opts-&gt;writeout_stage)</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">				errs |= checkout_stage(opts-&gt;writeout_stage,</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">						       ce, pos,</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">						       &amp;state,</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">						       &amp;nr_checkouts, opts-&gt;overlay_mode);</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">				errs |= checkout_merged(pos, &amp;state,</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">							&amp;nr_unmerged);</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">			pos = skip_same_name(ce, pos) - 1;</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">	remove_marked_cache_entries(&amp;the_index, 1);</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">	remove_scheduled_dirs();</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">	errs |= finish_delayed_checkout(&amp;state, &amp;nr_checkouts);</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;count_checkout_paths) {</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">		<span class='keyword'>if</span> (nr_unmerged)</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">			fprintf_ln(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, Q_(<span class='string_literal'>"Recreated %d merge conflict"</span>,</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">					      <span class='string_literal'>"Recreated %d merge conflicts"</span>,</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">					      nr_unmerged),</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">				   nr_unmerged);</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;source_tree)</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">			fprintf_ln(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, Q_(<span class='string_literal'>"Updated %d path from %s"</span>,</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">					      <span class='string_literal'>"Updated %d paths from %s"</span>,</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">					      nr_checkouts),</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">				   nr_checkouts,</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">				   <span class='macro'>find_unique_abbrev(&amp;opts-&gt;source_tree-&gt;object.oid,<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;opts-&gt;source_tree<br>-&gt;object.oid, default_abbrev)</span></span></td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">						      <span class='macro'>DEFAULT_ABBREV)<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;opts-&gt;source_tree<br>-&gt;object.oid, default_abbrev)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!nr_unmerged || nr_checkouts)</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">			fprintf_ln(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, Q_(<span class='string_literal'>"Updated %d path from the index"</span>,</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">					      <span class='string_literal'>"Updated %d paths from the index"</span>,</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">					      nr_checkouts),</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">				   nr_checkouts);</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">	<span class='keyword'>return</span> errs;</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> checkout_paths(<span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">			  <span class='keyword'>const</span> <span class='keyword'>struct</span> branch_info *new_branch_info)</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">	<span class='keyword'>int</span> pos;</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>char</span> *ps_matched;</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">	<span class='keyword'>struct</span> object_id rev;</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">	<span class='keyword'>struct</span> commit *head;</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">	<span class='keyword'>int</span> errs = 0;</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">	<span class='keyword'>struct</span> lock_file lock_file = <span class='macro'>LOCK_INIT<span class='macro_popup'>{ ((void*)0) }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">	<span class='keyword'>int</span> checkout_index;</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">	<span class='macro'>trace2_cmd_mode(opts-&gt;patch_mode ? <span class='string_literal'>"patch"</span> : <span class='string_literal'>"path"</span>)<span class='macro_popup'>trace2_cmd_mode_fl("builtin/checkout.c", 428, (opts-&gt;patch_mode<br> ? "patch" : "path"))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;track != BRANCH_TRACK_UNSPECIFIED)</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with updating paths"</span>), <span class='string_literal'>"--track"</span>);</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_branch_log)</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with updating paths"</span>), <span class='string_literal'>"-l"</span>);</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;ignore_unmerged &amp;&amp; opts-&gt;patch_mode)</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with updating paths"</span>),</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">		    opts-&gt;ignore_unmerged_opt);</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;force_detach)</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with updating paths"</span>), <span class='string_literal'>"--detach"</span>);</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;merge &amp;&amp; opts-&gt;patch_mode)</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with %s"</span>), <span class='string_literal'>"--merge"</span>, <span class='string_literal'>"--patch"</span>);</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;ignore_unmerged &amp;&amp; opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">		    opts-&gt;ignore_unmerged_opt, <span class='string_literal'>"-m"</span>);</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_branch)</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">		die(_(<span class='string_literal'>"Cannot update paths and switch to branch '%s' at the same time."</span>),</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">		    opts-&gt;new_branch);</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;checkout_worktree &amp;&amp; !opts-&gt;checkout_index)</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">		die(_(<span class='string_literal'>"neither '%s' or '%s' is specified"</span>),</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">		    <span class='string_literal'>"--staged"</span>, <span class='string_literal'>"--worktree"</span>);</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;checkout_worktree &amp;&amp; !opts-&gt;from_treeish)</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">		die(_(<span class='string_literal'>"'%s' must be used when '%s' is not specified"</span>),</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">		    <span class='string_literal'>"--worktree"</span>, <span class='string_literal'>"--source"</span>);</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;checkout_index &amp;&amp; !opts-&gt;checkout_worktree &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">	    opts-&gt;writeout_stage)</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">		die(_(<span class='string_literal'>"'%s' or '%s' cannot be used with %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">		    <span class='string_literal'>"--ours"</span>, <span class='string_literal'>"--theirs"</span>, <span class='string_literal'>"--staged"</span>);</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;checkout_index &amp;&amp; !opts-&gt;checkout_worktree &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">	    opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">		die(_(<span class='string_literal'>"'%s' or '%s' cannot be used with %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">		    <span class='string_literal'>"--merge"</span>, <span class='string_literal'>"--conflict"</span>, <span class='string_literal'>"--staged"</span>);</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;patch_mode) {</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *patch_mode;</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;checkout_index &amp;&amp; opts-&gt;checkout_worktree)</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">			patch_mode = <span class='string_literal'>"--patch=checkout"</span>;</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;checkout_index &amp;&amp; !opts-&gt;checkout_worktree)</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">			patch_mode = <span class='string_literal'>"--patch=reset"</span>;</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!opts-&gt;checkout_index &amp;&amp; opts-&gt;checkout_worktree)</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">			patch_mode = <span class='string_literal'>"--patch=worktree"</span>;</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">			<span class='macro'>BUG(<span class='string_literal'>"either flag must have been set, worktree=%d, index=%d"</span>,<span class='macro_popup'>BUG_fl("builtin/checkout.c", 483, "either flag must have been set, worktree=%d, index=%d"<br>, opts-&gt;checkout_worktree, opts-&gt;checkout_index)</span></span></td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">			    <span class='macro'>opts-&gt;checkout_worktree, opts-&gt;checkout_index)<span class='macro_popup'>BUG_fl("builtin/checkout.c", 483, "either flag must have been set, worktree=%d, index=%d"<br>, opts-&gt;checkout_worktree, opts-&gt;checkout_index)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">		<span class='keyword'>return</span> run_add_interactive(new_branch_info-&gt;name, patch_mode, &amp;opts-&gt;pathspec);</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">	repo_hold_locked_index(the_repository, &amp;lock_file, <span class='macro'>LOCK_DIE_ON_ERROR<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>read_cache_preload(&amp;opts-&gt;pathspec)<span class='macro_popup'>repo_read_index_preload(the_repository, (&amp;opts-&gt;pathspec<br>), 0)</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"index file corrupt"</span>))<span class='macro_popup'>(error(_("index file corrupt")), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;source_tree)</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">		read_tree_some(opts-&gt;source_tree, &amp;opts-&gt;pathspec);</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">	ps_matched = xcalloc(opts-&gt;pathspec.nr, 1);</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">	 <span class='comment'>* Make sure all pathspecs participated in locating the paths</span></td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">	 <span class='comment'>* to be checked out.</span></td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">	<span class='keyword'>for</span> (pos = 0; pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>; pos++)</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;overlay_mode)</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">			mark_ce_for_checkout_overlay(<span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos],</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">						     ps_matched,</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">						     opts);</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">			mark_ce_for_checkout_no_overlay(<span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos],</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">							ps_matched,</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">							opts);</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">	<span class='keyword'>if</span> (report_path_error(ps_matched, &amp;opts-&gt;pathspec)) {</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">		free(ps_matched);</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">	free(ps_matched);</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">	<span class='comment'>/* "checkout -m path" to recreate conflicted state */</span></td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">		unmerge_marked_index(&amp;the_index);</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">	<span class='comment'>/* Any unmerged paths? */</span></td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">	<span class='keyword'>for</span> (pos = 0; pos &lt; <span class='macro'>active_nr<span class='macro_popup'>(the_index.cache_nr)</span></span>; pos++) {</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>struct</span> cache_entry *ce = <span class='macro'>active_cache<span class='macro_popup'>(the_index.cache)</span></span>[pos];</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">		<span class='keyword'>if</span> (ce-&gt;ce_flags &amp; <span class='macro'>CE_MATCHED<span class='macro_popup'>(1 &lt;&lt; 26)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">			<span class='keyword'>if</span> (!<span class='macro'>ce_stage(ce)<span class='macro_popup'>(((0x3000) &amp; (ce)-&gt;ce_flags) &gt;&gt; 12)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">			<span class='keyword'>if</span> (opts-&gt;ignore_unmerged) {</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">				<span class='keyword'>if</span> (!opts-&gt;quiet)</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">					warning(_(<span class='string_literal'>"path '%s' is unmerged"</span>), ce-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">			} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;writeout_stage) {</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">				errs |= check_stage(opts-&gt;writeout_stage, ce, pos, opts-&gt;overlay_mode);</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">			} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;merge) {</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">				errs |= check_stages((1&lt;&lt;2) | (1&lt;&lt;3), ce, pos);</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">			} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">				errs = 1;</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">				<span class='macro'>error(_(<span class='string_literal'>"path '%s' is unmerged"</span>), ce-&gt;name)<span class='macro_popup'>(error(_("path '%s' is unmerged"), ce-&gt;name), const_error(<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">			pos = skip_same_name(ce, pos) - 1;</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">	<span class='keyword'>if</span> (errs)</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">	<span class='comment'>/* Now we are committed to check them out */</span></td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;checkout_worktree)</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">		errs |= checkout_worktree(opts, new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">		remove_marked_cache_entries(&amp;the_index, 1);</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">	 <span class='comment'>* Allow updating the index when checking out from the index.</span></td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">	 <span class='comment'>* This is to save new stat info.</span></td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;checkout_worktree &amp;&amp; !opts-&gt;checkout_index &amp;&amp; !opts-&gt;source_tree)</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">		checkout_index = 1;</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">		checkout_index = opts-&gt;checkout_index;</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">	<span class='keyword'>if</span> (checkout_index) {</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">		<span class='keyword'>if</span> (write_locked_index(&amp;the_index, &amp;lock_file, <span class='macro'>COMMIT_LOCK<span class='macro_popup'>(1 &lt;&lt; 0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">			die(_(<span class='string_literal'>"unable to write new index file"</span>));</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">		 <span class='comment'>* NEEDSWORK: if --worktree is not specified, we</span></td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">		 <span class='comment'>* should save stat info of checked out files in the</span></td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">		 <span class='comment'>* index to avoid the next (potentially costly)</span></td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">		 <span class='comment'>* refresh. But it's a bit tricker to do...</span></td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">		rollback_lock_file(&amp;lock_file);</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">	read_ref_full(<span class='string_literal'>"HEAD"</span>, 0, &amp;rev, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">	head = lookup_commit_reference_gently(the_repository, &amp;rev, 1);</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">	errs |= post_checkout_hook(head, head, 0);</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">	<span class='keyword'>return</span> errs;</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_local_changes(<span class='keyword'>struct</span> object *head,</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">			       <span class='keyword'>const</span> <span class='keyword'>struct</span> diff_options *opts)</td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">	<span class='keyword'>struct</span> rev_info rev;</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">	<span class='comment'>/* I think we want full paths, even if we're in a subdirectory. */</span></td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">	repo_init_revisions(the_repository, &amp;rev, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">	rev.diffopt.flags = opts-&gt;flags;</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">	rev.diffopt.output_format |= <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='macro_popup'>0x0200</span></span>;</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">	diff_setup_done(&amp;rev.diffopt);</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">	add_pending_object(&amp;rev, head, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">	run_diff_index(&amp;rev, 0);</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> describe_detached_head(<span class='keyword'>const</span> <span class='keyword'>char</span> *msg, <span class='keyword'>struct</span> commit *commit)</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">	<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>parse_commit(commit)<span class='macro_popup'>repo_parse_commit(the_repository, commit)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">		pp_commit_easy(CMIT_FMT_ONELINE, commit, &amp;sb);</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">	<span class='keyword'>if</span> (print_sha1_ellipsis()) {</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">		fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"%s %s... %s\n"</span>, msg,</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">			<span class='macro'>find_unique_abbrev(&amp;commit-&gt;object.oid, DEFAULT_ABBREV)<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;commit-&gt;object<br>.oid, default_abbrev)</span></span>, sb.buf);</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">		fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"%s %s %s\n"</span>, msg,</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">			<span class='macro'>find_unique_abbrev(&amp;commit-&gt;object.oid, DEFAULT_ABBREV)<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;commit-&gt;object<br>.oid, default_abbrev)</span></span>, sb.buf);</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">	strbuf_release(&amp;sb);</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> reset_tree(<span class='keyword'>struct</span> tree *tree, <span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *o,</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">		      <span class='keyword'>int</span> worktree, <span class='keyword'>int</span> *writeout_error,</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">		      <span class='keyword'>struct</span> branch_info *info)</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">	<span class='keyword'>struct</span> unpack_trees_options opts;</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">	<span class='keyword'>struct</span> tree_desc tree_desc;</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">	memset(&amp;opts, 0, <span class='keyword'>sizeof</span>(opts));</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">	opts.head_idx = -1;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">	opts.update = worktree;</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">	opts.skip_unmerged = !worktree;</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">	opts.reset = 1;</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">	opts.merge = 1;</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">	opts.fn = oneway_merge;</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">	opts.verbose_update = o-&gt;show_progress;</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">	opts.src_index = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">	opts.dst_index = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">	init_checkout_metadata(&amp;opts.meta, info-&gt;refname,</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">			       info-&gt;commit ? &amp;info-&gt;commit-&gt;object.oid : &amp;null_oid,</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">			       <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">	parse_tree(tree);</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">	init_tree_desc(&amp;tree_desc, tree-&gt;buffer, tree-&gt;size);</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">	<span class='keyword'>switch</span> (unpack_trees(1, &amp;tree_desc, &amp;opts)) {</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">	<span class='keyword'>case</span> -2:</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">		*writeout_error = 1;</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">		 <span class='comment'>* We return 0 nevertheless, as the index is all right</span></td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">		 <span class='comment'>* and more importantly we have made best efforts to</span></td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">		 <span class='comment'>* update paths in the work tree, and we cannot revert</span></td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">		 <span class='comment'>* them.</span></td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">		<span class='comment'>/* fallthrough */</span></td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">	<span class='keyword'>case</span> 0:</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">		<span class='keyword'>return</span> 128;</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> setup_branch_path(<span class='keyword'>struct</span> branch_info *branch)</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">	 <span class='comment'>* If this is a ref, resolve it; otherwise, look up the OID for our</span></td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">	 <span class='comment'>* expression.  Failure here is okay.</span></td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">	<span class='keyword'>if</span> (!dwim_ref(branch-&gt;name, strlen(branch-&gt;name), &amp;branch-&gt;oid, &amp;branch-&gt;refname, 0))</td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">		repo_get_oid_committish(the_repository, branch-&gt;name, &amp;branch-&gt;oid);</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">	strbuf_branchname(&amp;buf, branch-&gt;name, <span class='macro'>INTERPRET_BRANCH_LOCAL<span class='macro_popup'>(1&lt;&lt;0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">	<span class='keyword'>if</span> (strcmp(buf.buf, branch-&gt;name))</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">		branch-&gt;name = xstrdup(buf.buf);</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">	strbuf_splice(&amp;buf, 0, 0, <span class='string_literal'>"refs/heads/"</span>, 11);</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">	branch-&gt;path = strbuf_detach(&amp;buf, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> merge_working_tree(<span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">			      <span class='keyword'>struct</span> branch_info *old_branch_info,</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">			      <span class='keyword'>struct</span> branch_info *new_branch_info,</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">			      <span class='keyword'>int</span> *writeout_error)</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">	<span class='keyword'>int</span> ret;</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">	<span class='keyword'>struct</span> lock_file lock_file = <span class='macro'>LOCK_INIT<span class='macro_popup'>{ ((void*)0) }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">	<span class='keyword'>struct</span> tree *new_tree;</td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">	<span class='macro'>hold_locked_index(&amp;lock_file, LOCK_DIE_ON_ERROR)<span class='macro_popup'>repo_hold_locked_index(the_repository, (&amp;lock_file), (1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>read_cache_preload(NULL)<span class='macro_popup'>repo_read_index_preload(the_repository, (((void*)0)), 0)</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"index file corrupt"</span>))<span class='macro_popup'>(error(_("index file corrupt")), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">	<span class='macro'>resolve_undo_clear()<span class='macro_popup'>resolve_undo_clear_index(&amp;the_index)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_orphan_branch &amp;&amp; opts-&gt;orphan_from_empty_tree) {</td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">		<span class='keyword'>if</span> (new_branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">			<span class='macro'>BUG(<span class='string_literal'>"'switch --orphan' should never accept a commit as starting point"</span>)<span class='macro_popup'>BUG_fl("builtin/checkout.c", 680, "'switch --orphan' should never accept a commit as starting point"<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">		new_tree = parse_tree_indirect(<span class='macro'>the_hash_algo<span class='macro_popup'>the_repository-&gt;hash_algo</span></span>-&gt;empty_tree);</td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">	} <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">		new_tree = <span class='macro'>get_commit_tree(new_branch_info-&gt;commit)<span class='macro_popup'>repo_get_commit_tree(the_repository, new_branch_info-&gt;commit<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;discard_changes) {</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">		ret = reset_tree(new_tree, opts, 1, writeout_error, new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">		<span class='keyword'>if</span> (ret)</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">			<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">		<span class='keyword'>struct</span> tree_desc trees[2];</td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">		<span class='keyword'>struct</span> tree *tree;</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">		<span class='keyword'>struct</span> unpack_trees_options topts;</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">		memset(&amp;topts, 0, <span class='keyword'>sizeof</span>(topts));</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">		topts.head_idx = -1;</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">		topts.src_index = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">		topts.dst_index = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">		setup_unpack_trees_porcelain(&amp;topts, <span class='string_literal'>"checkout"</span>);</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">		<span class='macro'>refresh_cache(REFRESH_QUIET)<span class='macro_popup'>refresh_index(&amp;the_index, (0x0004), ((void*)0), ((void*)0<br>), ((void*)0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>unmerged_cache()<span class='macro_popup'>unmerged_index(&amp;the_index)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line">			<span class='macro'>error(_(<span class='string_literal'>"you need to resolve your current index first"</span>))<span class='macro_popup'>(error(_("you need to resolve your current index first")), const_error<br>())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">			<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">		<span class='comment'>/* 2-way merge to the new branch */</span></td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">		topts.initial_checkout = <span class='macro'>is_cache_unborn()<span class='macro_popup'>is_index_unborn(&amp;the_index)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line">		topts.update = 1;</td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">		topts.merge = 1;</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">		topts.quiet = opts-&gt;merge &amp;&amp; old_branch_info-&gt;commit;</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">		topts.verbose_update = opts-&gt;show_progress;</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">		topts.fn = twoway_merge;</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">		init_checkout_metadata(&amp;topts.meta, new_branch_info-&gt;refname,</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">				       new_branch_info-&gt;commit ?</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">				       &amp;new_branch_info-&gt;commit-&gt;object.oid :</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">				       &amp;new_branch_info-&gt;oid, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;overwrite_ignore) {</td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">			topts.dir = xcalloc(1, <span class='keyword'>sizeof</span>(*topts.dir));</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">			topts.dir-&gt;flags |= DIR_SHOW_IGNORED;</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">			setup_standard_excludes(topts.dir);</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">		tree = parse_tree_indirect(old_branch_info-&gt;commit ?</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">					   &amp;old_branch_info-&gt;commit-&gt;object.oid :</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">					   <span class='macro'>the_hash_algo<span class='macro_popup'>the_repository-&gt;hash_algo</span></span>-&gt;empty_tree);</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">		init_tree_desc(&amp;trees[0], tree-&gt;buffer, tree-&gt;size);</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">		parse_tree(new_tree);</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">		tree = new_tree;</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">		init_tree_desc(&amp;trees[1], tree-&gt;buffer, tree-&gt;size);</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">		ret = unpack_trees(2, trees, &amp;topts);</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">		clear_unpack_trees_porcelain(&amp;topts);</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">		<span class='keyword'>if</span> (ret == -1) {</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">			 <span class='comment'>* Unpack couldn't do a trivial merge; either</span></td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">			 <span class='comment'>* give up or do a real merge, depending on</span></td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">			 <span class='comment'>* whether the merge flag was used.</span></td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">			<span class='keyword'>struct</span> tree *work;</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">			<span class='keyword'>struct</span> tree *old_tree;</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">			<span class='keyword'>struct</span> merge_options o;</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">			<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">			<span class='keyword'>struct</span> strbuf old_commit_shortname = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">			<span class='keyword'>if</span> (!opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">				<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">			 <span class='comment'>* Without old_branch_info-&gt;commit, the below is the same as</span></td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">			 <span class='comment'>* the two-tree unpack we already tried and failed.</span></td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">			<span class='keyword'>if</span> (!old_branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">				<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">			old_tree = <span class='macro'>get_commit_tree(old_branch_info-&gt;commit)<span class='macro_popup'>repo_get_commit_tree(the_repository, old_branch_info-&gt;commit<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">			<span class='keyword'>if</span> (repo_index_has_changes(the_repository, old_tree, &amp;sb))</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">				die(_(<span class='string_literal'>"cannot continue with staged changes in "</span></td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">				      <span class='string_literal'>"the following files:\n%s"</span>), sb.buf);</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">			strbuf_release(&amp;sb);</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">			<span class='comment'>/* Do more real merge */</span></td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">			 <span class='comment'>* We update the index fully, then write the</span></td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">			 <span class='comment'>* tree from the index, then merge the new</span></td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">			 <span class='comment'>* branch with the current tree, with the old</span></td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">			 <span class='comment'>* branch as the base. Then we reset the index</span></td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">			 <span class='comment'>* (but not the working tree) to the new</span></td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">			 <span class='comment'>* branch, leaving the working tree as the</span></td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">			 <span class='comment'>* merged version, but skipping unmerged</span></td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">			 <span class='comment'>* entries in the index.</span></td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">			add_files_to_cache(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">			init_merge_options(&amp;o, the_repository);</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">			o.verbosity = 0;</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">			work = write_in_core_index_as_tree(the_repository);</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">			ret = reset_tree(new_tree,</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">					 opts, 1,</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">					 writeout_error, new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">			<span class='keyword'>if</span> (ret)</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">				<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">			o.ancestor = old_branch_info-&gt;name;</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">			<span class='keyword'>if</span> (old_branch_info-&gt;name == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">				strbuf_add_unique_abbrev(&amp;old_commit_shortname,</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">							 &amp;old_branch_info-&gt;commit-&gt;object.oid,</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">							 <span class='macro'>DEFAULT_ABBREV<span class='macro_popup'>default_abbrev</span></span>);</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">				o.ancestor = old_commit_shortname.buf;</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line">			o.branch1 = new_branch_info-&gt;name;</td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">			o.branch2 = <span class='string_literal'>"local"</span>;</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line">			ret = merge_trees(&amp;o,</td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">					  new_tree,</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line">					  work,</td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">					  old_tree);</td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">			<span class='keyword'>if</span> (ret &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">				<span class='macro'>exit(128)<span class='macro_popup'>exit(trace2_cmd_exit_fl("builtin/checkout.c", 798, (128)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">			ret = reset_tree(new_tree,</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">					 opts, 0,</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">					 writeout_error, new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">			strbuf_release(&amp;o.obuf);</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">			strbuf_release(&amp;old_commit_shortname);</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">			<span class='keyword'>if</span> (ret)</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">				<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>active_cache_tree<span class='macro_popup'>(the_index.cache_tree)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">		<span class='macro'>active_cache_tree<span class='macro_popup'>(the_index.cache_tree)</span></span> = cache_tree();</td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">	<span class='keyword'>if</span> (!cache_tree_fully_valid(<span class='macro'>active_cache_tree<span class='macro_popup'>(the_index.cache_tree)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line">		cache_tree_update(&amp;the_index, <span class='macro'>WRITE_TREE_SILENT<span class='macro_popup'>8</span></span> | <span class='macro'>WRITE_TREE_REPAIR<span class='macro_popup'>16</span></span>);</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">	<span class='keyword'>if</span> (write_locked_index(&amp;the_index, &amp;lock_file, <span class='macro'>COMMIT_LOCK<span class='macro_popup'>(1 &lt;&lt; 0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">		die(_(<span class='string_literal'>"unable to write new index file"</span>));</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;discard_changes &amp;&amp; !opts-&gt;quiet &amp;&amp; new_branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">		show_local_changes(&amp;new_branch_info-&gt;commit-&gt;object, &amp;opts-&gt;diff_options);</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> report_tracking(<span class='keyword'>struct</span> branch_info *new_branch_info)</td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">	<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">	<span class='keyword'>struct</span> branch *branch = branch_get(new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">	<span class='keyword'>if</span> (!format_tracking_info(branch, &amp;sb, AHEAD_BEHIND_FULL))</td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">	fputs(sb.buf, <span class='macro'>stdout<span class='macro_popup'>stdout</span></span>);</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">	strbuf_release(&amp;sb);</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> update_refs_for_switch(<span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">				   <span class='keyword'>struct</span> branch_info *old_branch_info,</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">				   <span class='keyword'>struct</span> branch_info *new_branch_info)</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">	<span class='keyword'>struct</span> strbuf msg = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *old_desc, *reflog_msg;</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_branch) {</td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;new_orphan_branch) {</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">			<span class='keyword'>char</span> *refname;</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">			refname = mkpathdup(<span class='string_literal'>"refs/heads/%s"</span>, opts-&gt;new_orphan_branch);</td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">			<span class='keyword'>if</span> (opts-&gt;new_branch_log &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">			    !should_autocreate_reflog(refname)) {</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">				<span class='keyword'>int</span> ret;</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">				<span class='keyword'>struct</span> strbuf err = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">				ret = safe_create_reflog(refname, 1, &amp;err);</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">				<span class='keyword'>if</span> (ret) {</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">					fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Can not do reflog for '%s': %s\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">						opts-&gt;new_orphan_branch, err.buf);</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">					strbuf_release(&amp;err);</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">					free(refname);</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line">					<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">				}</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">				strbuf_release(&amp;err);</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line">			free(refname);</td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">			create_branch(the_repository,</td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">				      opts-&gt;new_branch, new_branch_info-&gt;name,</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">				      opts-&gt;new_branch_force ? 1 : 0,</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">				      opts-&gt;new_branch_force ? 1 : 0,</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">				      opts-&gt;new_branch_log,</td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line">				      opts-&gt;quiet,</td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">				      opts-&gt;track);</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">		new_branch_info-&gt;name = opts-&gt;new_branch;</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">		setup_branch_path(new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">	old_desc = old_branch_info-&gt;name;</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">	<span class='keyword'>if</span> (!old_desc &amp;&amp; old_branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">		old_desc = oid_to_hex(&amp;old_branch_info-&gt;commit-&gt;object.oid);</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">	reflog_msg = getenv(<span class='string_literal'>"GIT_REFLOG_ACTION"</span>);</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">	<span class='keyword'>if</span> (!reflog_msg)</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">		strbuf_addf(&amp;msg, <span class='string_literal'>"checkout: moving from %s to %s"</span>,</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">			old_desc ? old_desc : <span class='string_literal'>"(invalid)"</span>, new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">		strbuf_insertstr(&amp;msg, 0, reflog_msg);</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">	<span class='keyword'>if</span> (!strcmp(new_branch_info-&gt;name, <span class='string_literal'>"HEAD"</span>) &amp;&amp; !new_branch_info-&gt;path &amp;&amp; !opts-&gt;force_detach) {</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">		<span class='comment'>/* Nothing to do. */</span></td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;force_detach || !new_branch_info-&gt;path) {	<span class='comment'>/* No longer on any branch. */</span></td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">		update_ref(msg.buf, <span class='string_literal'>"HEAD"</span>, &amp;new_branch_info-&gt;commit-&gt;object.oid, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">			   <span class='macro'>REF_NO_DEREF<span class='macro_popup'>(1 &lt;&lt; 0)</span></span>, UPDATE_REFS_DIE_ON_ERR);</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">		<span class='keyword'>if</span> (!opts-&gt;quiet) {</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">			<span class='keyword'>if</span> (old_branch_info-&gt;path &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">			    advice_detached_head &amp;&amp; !opts-&gt;force_detach)</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">				detach_advice(new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line">			describe_detached_head(_(<span class='string_literal'>"HEAD is now at"</span>), new_branch_info-&gt;commit);</td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (new_branch_info-&gt;path) {	<span class='comment'>/* Switch branches. */</span></td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">		<span class='keyword'>if</span> (create_symref(<span class='string_literal'>"HEAD"</span>, new_branch_info-&gt;path, msg.buf) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line">			die(_(<span class='string_literal'>"unable to update HEAD"</span>));</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">		<span class='keyword'>if</span> (!opts-&gt;quiet) {</td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line">			<span class='keyword'>if</span> (old_branch_info-&gt;path &amp;&amp; !strcmp(new_branch_info-&gt;path, old_branch_info-&gt;path)) {</td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">				<span class='keyword'>if</span> (opts-&gt;new_branch_force)</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">					fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Reset branch '%s'\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">						new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">				<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">					fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Already on '%s'\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">						new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">			} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;new_branch) {</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">				<span class='keyword'>if</span> (opts-&gt;branch_exists)</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">					fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Switched to and reset branch '%s'\n"</span>), new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">				<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">					fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Switched to a new branch '%s'\n"</span>), new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">			} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">				fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Switched to branch '%s'\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">					new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">		<span class='keyword'>if</span> (old_branch_info-&gt;path &amp;&amp; old_branch_info-&gt;name) {</td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">			<span class='keyword'>if</span> (!ref_exists(old_branch_info-&gt;path) &amp;&amp; reflog_exists(old_branch_info-&gt;path))</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">				delete_reflog(old_branch_info-&gt;path);</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line">	remove_branch_state(the_repository, !opts-&gt;quiet);</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">	strbuf_release(&amp;msg);</td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;quiet &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">	    (new_branch_info-&gt;path || (!opts-&gt;force_detach &amp;&amp; !strcmp(new_branch_info-&gt;name, <span class='string_literal'>"HEAD"</span>))))</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">		report_tracking(new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> add_pending_uninteresting_ref(<span class='keyword'>const</span> <span class='keyword'>char</span> *refname,</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">					 <span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid,</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">					 <span class='keyword'>int</span> flags, <span class='keyword'>void</span> *cb_data)</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">	add_pending_oid(cb_data, refname, oid, <span class='macro'>UNINTERESTING<span class='macro_popup'>(1u&lt;&lt;1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> describe_one_orphan(<span class='keyword'>struct</span> strbuf *sb, <span class='keyword'>struct</span> commit *commit)</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">	strbuf_addstr(sb, <span class='string_literal'>"  "</span>);</td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">	strbuf_add_unique_abbrev(sb, &amp;commit-&gt;object.oid, <span class='macro'>DEFAULT_ABBREV<span class='macro_popup'>default_abbrev</span></span>);</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">	strbuf_addch(sb, ' ');</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>parse_commit(commit)<span class='macro_popup'>repo_parse_commit(the_repository, commit)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">		pp_commit_easy(CMIT_FMT_ONELINE, commit, sb);</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">	strbuf_addch(sb, '\n');</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line"><span class='directive'>#define <span class='macro'>ORPHAN_CUTOFF<span class='macro_popup'>4</span></span> 4</span></td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> suggest_reattach(<span class='keyword'>struct</span> commit *commit, <span class='keyword'>struct</span> rev_info *revs)</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">	<span class='keyword'>struct</span> commit *c, *last = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">	<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line">	<span class='keyword'>int</span> lost = 0;</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">	<span class='keyword'>while</span> ((c = get_revision(revs)) != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">		<span class='keyword'>if</span> (lost &lt; <span class='macro'>ORPHAN_CUTOFF<span class='macro_popup'>4</span></span>)</td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">			describe_one_orphan(&amp;sb, c);</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">		last = c;</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">		lost++;</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>ORPHAN_CUTOFF<span class='macro_popup'>4</span></span> &lt; lost) {</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">		<span class='keyword'>int</span> more = lost - <span class='macro'>ORPHAN_CUTOFF<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">		<span class='keyword'>if</span> (more == 1)</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line">			describe_one_orphan(&amp;sb, last);</td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">			strbuf_addf(&amp;sb, _(<span class='string_literal'>" ... and %d more.\n"</span>), more);</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">	fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>,</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">		Q_(</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">		<span class='comment'>/* The singular version */</span></td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line">		<span class='string_literal'>"Warning: you are leaving %d commit behind, "</span></td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line">		<span class='string_literal'>"not connected to\n"</span></td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">		<span class='string_literal'>"any of your branches:\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">		<span class='string_literal'>"%s\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">		<span class='comment'>/* The plural version */</span></td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">		<span class='string_literal'>"Warning: you are leaving %d commits behind, "</span></td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">		<span class='string_literal'>"not connected to\n"</span></td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line">		<span class='string_literal'>"any of your branches:\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">		<span class='string_literal'>"%s\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">		<span class='comment'>/* Give ngettext() the count */</span></td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">		lost),</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">		lost,</td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">		sb.buf);</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">	strbuf_release(&amp;sb);</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">	<span class='keyword'>if</span> (advice_detached_head)</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">		fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>,</td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">			Q_(</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">			<span class='comment'>/* The singular version */</span></td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">			<span class='string_literal'>"If you want to keep it by creating a new branch, "</span></td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">			<span class='string_literal'>"this may be a good time\nto do so with:\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">			<span class='string_literal'>" git branch &lt;new-branch-name&gt; %s\n\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">			<span class='comment'>/* The plural version */</span></td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">			<span class='string_literal'>"If you want to keep them by creating a new branch, "</span></td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">			<span class='string_literal'>"this may be a good time\nto do so with:\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">			<span class='string_literal'>" git branch &lt;new-branch-name&gt; %s\n\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">			<span class='comment'>/* Give ngettext() the count */</span></td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">			lost),</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">			<span class='macro'>find_unique_abbrev(&amp;commit-&gt;object.oid, DEFAULT_ABBREV)<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;commit-&gt;object<br>.oid, default_abbrev)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line"> <span class='comment'>* We are about to leave commit that was at the tip of a detached</span></td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line"> <span class='comment'>* HEAD.  If it is not reachable from any ref, this is the last chance</span></td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line"> <span class='comment'>* for the user to do so without resorting to reflog.</span></td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> orphaned_commit_warning(<span class='keyword'>struct</span> commit *old_commit, <span class='keyword'>struct</span> commit *new_commit)</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">	<span class='keyword'>struct</span> rev_info revs;</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">	<span class='keyword'>struct</span> object *object = &amp;old_commit-&gt;object;</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">	repo_init_revisions(the_repository, &amp;revs, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">	setup_revisions(0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;revs, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">	object-&gt;flags &amp;= ~<span class='macro'>UNINTERESTING<span class='macro_popup'>(1u&lt;&lt;1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">	add_pending_object(&amp;revs, object, oid_to_hex(&amp;object-&gt;oid));</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">	for_each_ref(add_pending_uninteresting_ref, &amp;revs);</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">	<span class='keyword'>if</span> (new_commit)</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">		add_pending_oid(&amp;revs, <span class='string_literal'>"HEAD"</span>,</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">				&amp;new_commit-&gt;object.oid,</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">				<span class='macro'>UNINTERESTING<span class='macro_popup'>(1u&lt;&lt;1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">	<span class='keyword'>if</span> (prepare_revision_walk(&amp;revs))</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">		die(_(<span class='string_literal'>"internal error in revision walk"</span>));</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">	<span class='keyword'>if</span> (!(old_commit-&gt;object.flags &amp; <span class='macro'>UNINTERESTING<span class='macro_popup'>(1u&lt;&lt;1)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">		suggest_reattach(old_commit, &amp;revs);</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">		describe_detached_head(_(<span class='string_literal'>"Previous HEAD position was"</span>), old_commit);</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">	<span class='comment'>/* Clean up objects used, as they will be reused. */</span></td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line">	clear_commit_marks_all(<span class='macro'>ALL_REV_FLAGS<span class='macro_popup'>(((1u&lt;&lt;11)-1) | (1u&lt;&lt;25) | (1u&lt;&lt;26) | (1u&lt;&lt;<br>15))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> switch_branches(<span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">			   <span class='keyword'>struct</span> branch_info *new_branch_info)</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line">	<span class='keyword'>int</span> ret = 0;</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">	<span class='keyword'>struct</span> branch_info old_branch_info;</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">	<span class='keyword'>void</span> *path_to_free;</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">	<span class='keyword'>struct</span> object_id rev;</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">	<span class='keyword'>int</span> flag, writeout_error = 0;</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">	<span class='keyword'>int</span> do_merge = 1;</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">	<span class='macro'>trace2_cmd_mode(<span class='string_literal'>"branch"</span>)<span class='macro_popup'>trace2_cmd_mode_fl("builtin/checkout.c", 1045, ("branch"))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">	memset(&amp;old_branch_info, 0, <span class='keyword'>sizeof</span>(old_branch_info));</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">	old_branch_info.path = path_to_free = resolve_refdup(<span class='string_literal'>"HEAD"</span>, 0, &amp;rev, &amp;flag);</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">	<span class='keyword'>if</span> (old_branch_info.path)</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">		old_branch_info.commit = lookup_commit_reference_gently(the_repository, &amp;rev, 1);</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">	<span class='keyword'>if</span> (!(flag &amp; <span class='macro'>REF_ISSYMREF<span class='macro_popup'>0x01</span></span>))</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">		old_branch_info.path = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">	<span class='keyword'>if</span> (old_branch_info.path)</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">		skip_prefix(old_branch_info.path, <span class='string_literal'>"refs/heads/"</span>, &amp;old_branch_info.name);</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_orphan_branch &amp;&amp; opts-&gt;orphan_from_empty_tree) {</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">		<span class='keyword'>if</span> (new_branch_info-&gt;name)</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">			<span class='macro'>BUG(<span class='string_literal'>"'switch --orphan' should never accept a commit as starting point"</span>)<span class='macro_popup'>BUG_fl("builtin/checkout.c", 1059, "'switch --orphan' should never accept a commit as starting point"<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">		new_branch_info-&gt;commit = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">		new_branch_info-&gt;name = <span class='string_literal'>"(empty)"</span>;</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">		do_merge = 1;</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">	<span class='keyword'>if</span> (!new_branch_info-&gt;name) {</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">		new_branch_info-&gt;name = <span class='string_literal'>"HEAD"</span>;</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">		new_branch_info-&gt;commit = old_branch_info.commit;</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">		<span class='keyword'>if</span> (!new_branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">			die(_(<span class='string_literal'>"You are on a branch yet to be born"</span>));</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">		parse_commit_or_die(new_branch_info-&gt;commit);</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;only_merge_on_switching_branches)</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">			do_merge = 0;</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">	<span class='keyword'>if</span> (do_merge) {</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">		ret = merge_working_tree(opts, &amp;old_branch_info, new_branch_info, &amp;writeout_error);</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">		<span class='keyword'>if</span> (ret) {</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">			free(path_to_free);</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">			<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;quiet &amp;&amp; !old_branch_info.path &amp;&amp; old_branch_info.commit &amp;&amp; new_branch_info-&gt;commit != old_branch_info.commit)</td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">		orphaned_commit_warning(old_branch_info.commit, new_branch_info-&gt;commit);</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">	update_refs_for_switch(opts, &amp;old_branch_info, new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">	ret = post_checkout_hook(old_branch_info.commit, new_branch_info-&gt;commit, 1);</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">	free(path_to_free);</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">	<span class='keyword'>return</span> ret || writeout_error;</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> git_checkout_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.ignoresubmodules"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">		<span class='keyword'>struct</span> checkout_opts *opts = cb;</td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line">		handle_ignore_submodules_arg(&amp;opts-&gt;diff_options, value);</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">	<span class='keyword'>if</span> (starts_with(var, <span class='string_literal'>"submodule."</span>))</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">		<span class='keyword'>return</span> git_default_submodule_config(var, value, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">	<span class='keyword'>return</span> git_xmerge_config(var, value, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> setup_new_branch_info_and_source_tree(</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">	<span class='keyword'>struct</span> branch_info *new_branch_info,</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">	<span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">	<span class='keyword'>struct</span> object_id *rev,</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *arg)</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line">	<span class='keyword'>struct</span> tree **source_tree = &amp;opts-&gt;source_tree;</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">	<span class='keyword'>struct</span> object_id branch_rev;</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">	new_branch_info-&gt;name = arg;</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">	setup_branch_path(new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">	<span class='keyword'>if</span> (!check_refname_format(new_branch_info-&gt;path, 0) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">	    !read_ref(new_branch_info-&gt;path, &amp;branch_rev))</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">		oidcpy(rev, &amp;branch_rev);</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">		free((<span class='keyword'>char</span> *)new_branch_info-&gt;path);</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">		new_branch_info-&gt;path = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; <span class='comment'>/* not an existing branch */</span></td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">	new_branch_info-&gt;commit = lookup_commit_reference_gently(the_repository, rev, 1);</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">	<span class='keyword'>if</span> (!new_branch_info-&gt;commit) {</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">		<span class='comment'>/* not a commit */</span></td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">		*source_tree = parse_tree_indirect(rev);</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">		parse_commit_or_die(new_branch_info-&gt;commit);</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">		*source_tree = <span class='macro'>get_commit_tree(new_branch_info-&gt;commit)<span class='macro_popup'>repo_get_commit_tree(the_repository, new_branch_info-&gt;commit<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *parse_remote_branch(<span class='keyword'>const</span> <span class='keyword'>char</span> *arg,</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">				       <span class='keyword'>struct</span> object_id *rev,</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line">				       <span class='keyword'>int</span> could_be_checkout_paths)</td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line">	<span class='keyword'>int</span> num_matches = 0;</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *remote = unique_tracking_name(arg, rev, &amp;num_matches);</td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line">	<span class='keyword'>if</span> (remote &amp;&amp; could_be_checkout_paths) {</td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">		die(_(<span class='string_literal'>"'%s' could be both a local file and a tracking branch.\n"</span></td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">			<span class='string_literal'>"Please use -- (and optionally --no-guess) to disambiguate"</span>),</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">		    arg);</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">	<span class='keyword'>if</span> (!remote &amp;&amp; num_matches &gt; 1) {</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">	    <span class='keyword'>if</span> (advice_checkout_ambiguous_remote_branch_name) {</td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">		    advise(_(<span class='string_literal'>"If you meant to check out a remote tracking branch on, e.g. 'origin',\n"</span></td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">			     <span class='string_literal'>"you can do so by fully qualifying the name with the --track option:\n"</span></td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">			     <span class='string_literal'>"\n"</span></td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">			     <span class='string_literal'>"    git checkout --track origin/&lt;name&gt;\n"</span></td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">			     <span class='string_literal'>"\n"</span></td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">			     <span class='string_literal'>"If you'd like to always have checkouts of an ambiguous &lt;name&gt; prefer\n"</span></td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">			     <span class='string_literal'>"one remote, e.g. the 'origin' remote, consider setting\n"</span></td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">			     <span class='string_literal'>"checkout.defaultRemote=origin in your config."</span>));</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">	    die(_(<span class='string_literal'>"'%s' matched multiple (%d) remote tracking branches"</span>),</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">		arg, num_matches);</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">	<span class='keyword'>return</span> remote;</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_branchname_arg(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv,</td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">				<span class='keyword'>int</span> dwim_new_local_branch_ok,</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">				<span class='keyword'>struct</span> branch_info *new_branch_info,</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">				<span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">				<span class='keyword'>struct</span> object_id *rev)</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> **new_branch = &amp;opts-&gt;new_branch;</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">	<span class='keyword'>int</span> argcount = 0;</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *arg;</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">	<span class='keyword'>int</span> dash_dash_pos;</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">	<span class='keyword'>int</span> has_dash_dash = 0;</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">	 <span class='comment'>* case 1: git checkout &lt;ref&gt; -- [&lt;paths&gt;]</span></td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">	 <span class='comment'>*   &lt;ref&gt; must be a valid tree, everything after the '--' must be</span></td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">	 <span class='comment'>*   a path.</span></td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">	 <span class='comment'>* case 2: git checkout -- [&lt;paths&gt;]</span></td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">	 <span class='comment'>*   everything after the '--' must be paths.</span></td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">	 <span class='comment'>* case 3: git checkout &lt;something&gt; [--]</span></td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">	 <span class='comment'>*   (a) If &lt;something&gt; is a commit, that is to</span></td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">	 <span class='comment'>*       switch to the branch or detach HEAD at it.  As a special case,</span></td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">	 <span class='comment'>*       if &lt;something&gt; is A...B (missing A or B means HEAD but you can</span></td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">	 <span class='comment'>*       omit at most one side), and if there is a unique merge base</span></td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">	 <span class='comment'>*       between A and B, A...B names that merge base.</span></td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">	 <span class='comment'>*   (b) If &lt;something&gt; is _not_ a commit, either "--" is present</span></td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">	 <span class='comment'>*       or &lt;something&gt; is not a path, no -t or -b was given, and</span></td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">	 <span class='comment'>*       and there is a tracking branch whose name is &lt;something&gt;</span></td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">	 <span class='comment'>*       in one and only one remote (or if the branch exists on the</span></td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line">	 <span class='comment'>*       remote named in checkout.defaultRemote), then this is a</span></td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">	 <span class='comment'>*       short-hand to fork local &lt;something&gt; from that</span></td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">	 <span class='comment'>*       remote-tracking branch.</span></td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">	 <span class='comment'>*   (c) Otherwise, if "--" is present, treat it like case (1).</span></td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">	 <span class='comment'>*   (d) Otherwise :</span></td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">	 <span class='comment'>*       - if it's a reference, treat it like case (1)</span></td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">	 <span class='comment'>*       - else if it's a path, treat it like case (2)</span></td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">	 <span class='comment'>*       - else: fail.</span></td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">	 <span class='comment'>* case 4: git checkout &lt;something&gt; &lt;paths&gt;</span></td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">	 <span class='comment'>*   The first argument must not be ambiguous.</span></td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">	 <span class='comment'>*   - If it's *only* a reference, treat it like case (1).</span></td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">	 <span class='comment'>*   - If it's only a path, treat it like case (2).</span></td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">	 <span class='comment'>*   - else: fail.</span></td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">	<span class='keyword'>if</span> (!argc)</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;accept_pathspec) {</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line">		<span class='keyword'>if</span> (argc &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line">			die(_(<span class='string_literal'>"only one reference expected"</span>));</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">		has_dash_dash = 1; <span class='comment'>/* helps disambiguate */</span></td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">	arg = argv[0];</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">	dash_dash_pos = -1;</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; argc; i++) {</td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;accept_pathspec &amp;&amp; !strcmp(argv[i], <span class='string_literal'>"--"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">			dash_dash_pos = i;</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">	<span class='keyword'>if</span> (dash_dash_pos == 0)</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">		<span class='keyword'>return</span> 1; <span class='comment'>/* case (2) */</span></td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (dash_dash_pos == 1)</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">		has_dash_dash = 1; <span class='comment'>/* case (3) or (1) */</span></td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (dash_dash_pos &gt;= 2)</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">		die(_(<span class='string_literal'>"only one reference expected, %d given."</span>), dash_dash_pos);</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">	opts-&gt;count_checkout_paths = !opts-&gt;quiet &amp;&amp; !has_dash_dash;</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">	<span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-"</span>))</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">		arg = <span class='string_literal'>"@{-1}"</span>;</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>get_oid_mb(arg, rev)<span class='macro_popup'>repo_get_oid_mb(the_repository, arg, rev)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">		 <span class='comment'>* Either case (3) or (4), with &lt;something&gt; not being</span></td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">		 <span class='comment'>* a commit, or an attempt to use case (1) with an</span></td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">		 <span class='comment'>* invalid ref.</span></td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">		 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">		 <span class='comment'>* It's likely an error, but we need to find out if</span></td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">		 <span class='comment'>* we should auto-create the branch, case (3).(b).</span></td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">		<span class='keyword'>int</span> recover_with_dwim = dwim_new_local_branch_ok;</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">		<span class='keyword'>int</span> could_be_checkout_paths = !has_dash_dash &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">			check_filename(opts-&gt;prefix, arg);</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">		<span class='keyword'>if</span> (!has_dash_dash &amp;&amp; !no_wildcard(arg))</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">			recover_with_dwim = 0;</td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">		 <span class='comment'>* Accept "git checkout foo", "git checkout foo --"</span></td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">		 <span class='comment'>* and "git switch foo" as candidates for dwim.</span></td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">		<span class='keyword'>if</span> (!(argc == 1 &amp;&amp; !has_dash_dash) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">		    !(argc == 2 &amp;&amp; has_dash_dash) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">		    opts-&gt;accept_pathspec)</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">			recover_with_dwim = 0;</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">		<span class='keyword'>if</span> (recover_with_dwim) {</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">			<span class='keyword'>const</span> <span class='keyword'>char</span> *remote = parse_remote_branch(arg, rev,</td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">								 could_be_checkout_paths);</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">			<span class='keyword'>if</span> (remote) {</td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">				*new_branch = arg;</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">				arg = remote;</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">				<span class='comment'>/* DWIMmed to create local branch, case (3).(b) */</span></td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">			} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">				recover_with_dwim = 0;</td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">		<span class='keyword'>if</span> (!recover_with_dwim) {</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">			<span class='keyword'>if</span> (has_dash_dash)</td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">				die(_(<span class='string_literal'>"invalid reference: %s"</span>), arg);</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">			<span class='keyword'>return</span> argcount;</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">	<span class='comment'>/* we can't end up being in (2) anymore, eat the argument */</span></td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">	argcount++;</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">	argv++;</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line">	argc--;</td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">	setup_new_branch_info_and_source_tree(new_branch_info, opts, rev, arg);</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;source_tree)                   <span class='comment'>/* case (1): want a tree */</span></td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line">		die(_(<span class='string_literal'>"reference is not a tree: %s"</span>), arg);</td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">	<span class='keyword'>if</span> (!has_dash_dash) {	<span class='comment'>/* case (3).(d) -&gt; (1) */</span></td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line">		 <span class='comment'>* Do not complain the most common case</span></td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line">		 <span class='comment'>*	git checkout branch</span></td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line">		 <span class='comment'>* even if there happen to be a file called 'branch';</span></td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">		 <span class='comment'>* it would be extremely annoying.</span></td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">		<span class='keyword'>if</span> (argc)</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">			verify_non_filename(opts-&gt;prefix, arg);</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;accept_pathspec) {</td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line">		argcount++;</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">		argv++;</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">		argc--;</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">	<span class='keyword'>return</span> argcount;</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> switch_unborn_to_new_branch(<span class='keyword'>const</span> <span class='keyword'>struct</span> checkout_opts *opts)</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">	<span class='keyword'>int</span> status;</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">	<span class='keyword'>struct</span> strbuf branch_ref = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">	<span class='macro'>trace2_cmd_mode(<span class='string_literal'>"unborn"</span>)<span class='macro_popup'>trace2_cmd_mode_fl("builtin/checkout.c", 1330, ("unborn"))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;new_branch)</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">		die(_(<span class='string_literal'>"You are on a branch yet to be born"</span>));</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">	strbuf_addf(&amp;branch_ref, <span class='string_literal'>"refs/heads/%s"</span>, opts-&gt;new_branch);</td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">	status = create_symref(<span class='string_literal'>"HEAD"</span>, branch_ref.buf, <span class='string_literal'>"checkout -b"</span>);</td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">	strbuf_release(&amp;branch_ref);</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;quiet)</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">		fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, _(<span class='string_literal'>"Switched to a new branch '%s'\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">			opts-&gt;new_branch);</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">	<span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> die_expecting_a_branch(<span class='keyword'>const</span> <span class='keyword'>struct</span> branch_info *branch_info)</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">	<span class='keyword'>struct</span> object_id oid;</td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">	<span class='keyword'>char</span> *to_free;</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">	<span class='keyword'>if</span> (dwim_ref(branch_info-&gt;name, strlen(branch_info-&gt;name), &amp;oid, &amp;to_free, 0) == 1) {</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *ref = to_free;</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">		<span class='keyword'>if</span> (skip_prefix(ref, <span class='string_literal'>"refs/tags/"</span>, &amp;ref))</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">			die(_(<span class='string_literal'>"a branch is expected, got tag '%s'"</span>), ref);</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">		<span class='keyword'>if</span> (skip_prefix(ref, <span class='string_literal'>"refs/remotes/"</span>, &amp;ref))</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">			die(_(<span class='string_literal'>"a branch is expected, got remote branch '%s'"</span>), ref);</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">		die(_(<span class='string_literal'>"a branch is expected, got '%s'"</span>), ref);</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">	<span class='keyword'>if</span> (branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">		die(_(<span class='string_literal'>"a branch is expected, got commit '%s'"</span>), branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">	 <span class='comment'>* This case should never happen because we already die() on</span></td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line">	 <span class='comment'>* non-commit, but just in case.</span></td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">	die(_(<span class='string_literal'>"a branch is expected, got '%s'"</span>), branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> die_if_some_operation_in_progress(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line">	<span class='keyword'>struct</span> wt_status_state state;</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line">	memset(&amp;state, 0, <span class='keyword'>sizeof</span>(state));</td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">	wt_status_get_state(the_repository, &amp;state, 0);</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">	<span class='keyword'>if</span> (state.merge_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">		die(_(<span class='string_literal'>"cannot switch branch while merging\n"</span></td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">		      <span class='string_literal'>"Consider \"git merge --quit\" "</span></td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">		      <span class='string_literal'>"or \"git worktree add\"."</span>));</td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">	<span class='keyword'>if</span> (state.am_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">		die(_(<span class='string_literal'>"cannot switch branch in the middle of an am session\n"</span></td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">		      <span class='string_literal'>"Consider \"git am --quit\" "</span></td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">		      <span class='string_literal'>"or \"git worktree add\"."</span>));</td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">	<span class='keyword'>if</span> (state.rebase_interactive_in_progress || state.rebase_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">		die(_(<span class='string_literal'>"cannot switch branch while rebasing\n"</span></td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">		      <span class='string_literal'>"Consider \"git rebase --quit\" "</span></td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">		      <span class='string_literal'>"or \"git worktree add\"."</span>));</td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">	<span class='keyword'>if</span> (state.cherry_pick_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">		die(_(<span class='string_literal'>"cannot switch branch while cherry-picking\n"</span></td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">		      <span class='string_literal'>"Consider \"git cherry-pick --quit\" "</span></td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">		      <span class='string_literal'>"or \"git worktree add\"."</span>));</td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">	<span class='keyword'>if</span> (state.revert_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">		die(_(<span class='string_literal'>"cannot switch branch while reverting\n"</span></td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line">		      <span class='string_literal'>"Consider \"git revert --quit\" "</span></td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">		      <span class='string_literal'>"or \"git worktree add\"."</span>));</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">	<span class='keyword'>if</span> (state.bisect_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">		warning(_(<span class='string_literal'>"you are switching branch while bisecting"</span>));</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> checkout_branch(<span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">			   <span class='keyword'>struct</span> branch_info *new_branch_info)</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">		die(_(<span class='string_literal'>"paths cannot be used with switching branches"</span>));</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;patch_mode)</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with switching branches"</span>),</td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line">		    <span class='string_literal'>"--patch"</span>);</td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;overlay_mode != -1)</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with switching branches"</span>),</td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line">		    <span class='string_literal'>"--[no]-overlay"</span>);</td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;writeout_stage)</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with switching branches"</span>),</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">		    <span class='string_literal'>"--ours/--theirs"</span>);</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;force &amp;&amp; opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with '%s'"</span>), <span class='string_literal'>"-f"</span>, <span class='string_literal'>"-m"</span>);</td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;discard_changes &amp;&amp; opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with '%s'"</span>), <span class='string_literal'>"--discard-changes"</span>, <span class='string_literal'>"--merge"</span>);</td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;force_detach &amp;&amp; opts-&gt;new_branch)</td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">		die(_(<span class='string_literal'>"'%s' cannot be used with '%s'"</span>),</td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">		    <span class='string_literal'>"--detach"</span>, <span class='string_literal'>"-b/-B/--orphan"</span>);</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_orphan_branch) {</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;track != BRANCH_TRACK_UNSPECIFIED)</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">			die(_(<span class='string_literal'>"'%s' cannot be used with '%s'"</span>), <span class='string_literal'>"--orphan"</span>, <span class='string_literal'>"-t"</span>);</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;orphan_from_empty_tree &amp;&amp; new_branch_info-&gt;name)</td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">			die(_(<span class='string_literal'>"'%s' cannot take &lt;start-point&gt;"</span>), <span class='string_literal'>"--orphan"</span>);</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;force_detach) {</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;track != BRANCH_TRACK_UNSPECIFIED)</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">			die(_(<span class='string_literal'>"'%s' cannot be used with '%s'"</span>), <span class='string_literal'>"--detach"</span>, <span class='string_literal'>"-t"</span>);</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;track == BRANCH_TRACK_UNSPECIFIED)</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">		opts-&gt;track = git_branch_track;</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">	<span class='keyword'>if</span> (new_branch_info-&gt;name &amp;&amp; !new_branch_info-&gt;commit)</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">		die(_(<span class='string_literal'>"Cannot switch branch to a non-commit '%s'"</span>),</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">		    new_branch_info-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;switch_branch_doing_nothing_is_ok &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">	    !new_branch_info-&gt;name &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line">	    !opts-&gt;new_branch &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">	    !opts-&gt;force_detach)</td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">		die(_(<span class='string_literal'>"missing branch or commit argument"</span>));</td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;implicit_detach &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">	    !opts-&gt;force_detach &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">	    !opts-&gt;new_branch &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">	    !opts-&gt;new_branch_force &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">	    new_branch_info-&gt;name &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">	    !new_branch_info-&gt;path)</td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">		die_expecting_a_branch(new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;can_switch_when_in_progress)</td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">		die_if_some_operation_in_progress();</td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">	<span class='keyword'>if</span> (new_branch_info-&gt;path &amp;&amp; !opts-&gt;force_detach &amp;&amp; !opts-&gt;new_branch &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">	    !opts-&gt;ignore_other_worktrees) {</td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">		<span class='keyword'>int</span> flag;</td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">		<span class='keyword'>char</span> *head_ref = resolve_refdup(<span class='string_literal'>"HEAD"</span>, 0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;flag);</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">		<span class='keyword'>if</span> (head_ref &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">		    (!(flag &amp; <span class='macro'>REF_ISSYMREF<span class='macro_popup'>0x01</span></span>) || strcmp(head_ref, new_branch_info-&gt;path)))</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">			die_if_checked_out(new_branch_info-&gt;path, 1);</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">		free(head_ref);</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">	<span class='keyword'>if</span> (!new_branch_info-&gt;commit &amp;&amp; opts-&gt;new_branch) {</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">		<span class='keyword'>struct</span> object_id rev;</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line">		<span class='keyword'>int</span> flag;</td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">		<span class='keyword'>if</span> (!read_ref_full(<span class='string_literal'>"HEAD"</span>, 0, &amp;rev, &amp;flag) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">		    (flag &amp; <span class='macro'>REF_ISSYMREF<span class='macro_popup'>0x01</span></span>) &amp;&amp; is_null_oid(&amp;rev))</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">			<span class='keyword'>return</span> switch_unborn_to_new_branch(opts);</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">	<span class='keyword'>return</span> switch_branches(opts, new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> option *add_common_options(<span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">					 <span class='keyword'>struct</span> option *prevopts)</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line">	<span class='keyword'>struct</span> option options[] = {</td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line">		<span class='macro'>OPT__QUIET(&amp;opts-&gt;quiet, N_(<span class='string_literal'>"suppress progress reporting"</span>))<span class='macro_popup'>{ OPTION_COUNTUP, ('q'), ("quiet"), ((&amp;opts-&gt;quiet)), (<br>(void*)0), ((("suppress progress reporting"))), PARSE_OPT_NOARG<br>|(0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line">		<span class='macro'>OPT_CALLBACK_F(0, <span class='string_literal'>"recurse-submodules"</span>, NULL,<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("recurse-submodules"), (((void*)0)),<br> ("checkout"), ("control recursive updating of submodules"), (<br>PARSE_OPT_OPTARG), (option_parse_recurse_submodules_worktree_updater<br>) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line">			    <span class='string_literal'><span class='macro'>"checkout"</span>, <span class='string_literal'>"control recursive updating of submodules"</span>,<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("recurse-submodules"), (((void*)0)),<br> ("checkout"), ("control recursive updating of submodules"), (<br>PARSE_OPT_OPTARG), (option_parse_recurse_submodules_worktree_updater<br>) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line">			    <span class='macro'>PARSE_OPT_OPTARG, option_parse_recurse_submodules_worktree_updater)<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("recurse-submodules"), (((void*)0)),<br> ("checkout"), ("control recursive updating of submodules"), (<br>PARSE_OPT_OPTARG), (option_parse_recurse_submodules_worktree_updater<br>) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"progress"</span>, &amp;opts-&gt;show_progress, N_(<span class='string_literal'>"force progress reporting"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("progress"), (&amp;opts-&gt;show_progress<br>), ((void*)0), (("force progress reporting")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">		<span class='macro'>OPT_BOOL('m', <span class='string_literal'>"merge"</span>, &amp;opts-&gt;merge, N_(<span class='string_literal'>"perform a 3-way merge with the new branch"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('m'), ("merge"), (&amp;opts-&gt;merge), ((<br>void*)0), (("perform a 3-way merge with the new branch")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">		<span class='macro'>OPT_STRING(0, <span class='string_literal'>"conflict"</span>, &amp;opts-&gt;conflict_style, N_(<span class='string_literal'>"style"</span>),<span class='macro_popup'>{ OPTION_STRING, (0), ("conflict"), (&amp;opts-&gt;conflict_style<br>), (("style")), (("conflict style (merge or diff3)")), (0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"conflict style (merge or diff3)"</span>))<span class='macro_popup'>{ OPTION_STRING, (0), ("conflict"), (&amp;opts-&gt;conflict_style<br>), (("style")), (("conflict style (merge or diff3)")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">	<span class='keyword'>struct</span> option *newopts = parse_options_concat(prevopts, options);</td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">	free(prevopts);</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">	<span class='keyword'>return</span> newopts;</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> option *add_common_switch_branch_options(</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">	<span class='keyword'>struct</span> checkout_opts *opts, <span class='keyword'>struct</span> option *prevopts)</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">	<span class='keyword'>struct</span> option options[] = {</td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">		<span class='macro'>OPT_BOOL('d', <span class='string_literal'>"detach"</span>, &amp;opts-&gt;force_detach, N_(<span class='string_literal'>"detach HEAD at named commit"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('d'), ("detach"), (&amp;opts-&gt;force_detach<br>), ((void*)0), (("detach HEAD at named commit")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">		<span class='macro'>OPT_SET_INT('t', <span class='string_literal'>"track"</span>,  &amp;opts-&gt;track, N_(<span class='string_literal'>"set upstream info for new branch"</span>),<span class='macro_popup'>{ OPTION_SET_INT, ('t'), ("track"), (&amp;opts-&gt;track), ((<br>void*)0), (("set upstream info for new branch")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (BRANCH_TRACK_EXPLICIT) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">			<span class='macro'>BRANCH_TRACK_EXPLICIT)<span class='macro_popup'>{ OPTION_SET_INT, ('t'), ("track"), (&amp;opts-&gt;track), ((<br>void*)0), (("set upstream info for new branch")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (BRANCH_TRACK_EXPLICIT) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">		<span class='macro'>OPT__FORCE(&amp;opts-&gt;force, N_(<span class='string_literal'>"force checkout (throw away local modifications)"</span>),<span class='macro_popup'>{ OPTION_COUNTUP, ('f'), ("force"), ((&amp;opts-&gt;force)), (<br>(void*)0), ((("force checkout (throw away local modifications)"<br>))), PARSE_OPT_NOARG|((PARSE_OPT_NOCOMPLETE)) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">			   <span class='macro'>PARSE_OPT_NOCOMPLETE)<span class='macro_popup'>{ OPTION_COUNTUP, ('f'), ("force"), ((&amp;opts-&gt;force)), (<br>(void*)0), ((("force checkout (throw away local modifications)"<br>))), PARSE_OPT_NOARG|((PARSE_OPT_NOCOMPLETE)) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">		<span class='macro'>OPT_STRING(0, <span class='string_literal'>"orphan"</span>, &amp;opts-&gt;new_orphan_branch, N_(<span class='string_literal'>"new-branch"</span>), N_(<span class='string_literal'>"new unparented branch"</span>))<span class='macro_popup'>{ OPTION_STRING, (0), ("orphan"), (&amp;opts-&gt;new_orphan_branch<br>), (("new-branch")), (("new unparented branch")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">		<span class='macro'>OPT_BOOL_F(0, <span class='string_literal'>"overwrite-ignore"</span>, &amp;opts-&gt;overwrite_ignore,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("overwrite-ignore"), (&amp;opts-&gt;overwrite_ignore<br>), ((void*)0), (("update ignored files (default)")), PARSE_OPT_NOARG<br> | (PARSE_OPT_NOCOMPLETE), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"update ignored files (default)"</span>),<span class='macro_popup'>{ OPTION_SET_INT, (0), ("overwrite-ignore"), (&amp;opts-&gt;overwrite_ignore<br>), ((void*)0), (("update ignored files (default)")), PARSE_OPT_NOARG<br> | (PARSE_OPT_NOCOMPLETE), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line">			   <span class='macro'>PARSE_OPT_NOCOMPLETE)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("overwrite-ignore"), (&amp;opts-&gt;overwrite_ignore<br>), ((void*)0), (("update ignored files (default)")), PARSE_OPT_NOARG<br> | (PARSE_OPT_NOCOMPLETE), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"ignore-other-worktrees"</span>, &amp;opts-&gt;ignore_other_worktrees,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-other-worktrees"), (&amp;opts<br>-&gt;ignore_other_worktrees), ((void*)0), (("do not check if another worktree is holding the given ref"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"do not check if another worktree is holding the given ref"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-other-worktrees"), (&amp;opts<br>-&gt;ignore_other_worktrees), ((void*)0), (("do not check if another worktree is holding the given ref"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">	<span class='keyword'>struct</span> option *newopts = parse_options_concat(prevopts, options);</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">	free(prevopts);</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">	<span class='keyword'>return</span> newopts;</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> option *add_checkout_path_options(<span class='keyword'>struct</span> checkout_opts *opts,</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">						<span class='keyword'>struct</span> option *prevopts)</td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">	<span class='keyword'>struct</span> option options[] = {</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line">		<span class='macro'>OPT_SET_INT_F('2', <span class='string_literal'>"ours"</span>, &amp;opts-&gt;writeout_stage,<span class='macro_popup'>{ OPTION_SET_INT, ('2'), ("ours"), (&amp;opts-&gt;writeout_stage<br>), ((void*)0), (("checkout our version for unmerged files")),<br> PARSE_OPT_NOARG | (PARSE_OPT_NONEG), ((void*)0), (2) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">			      <span class='macro'>N_(<span class='string_literal'>"checkout our version for unmerged files"</span>),<span class='macro_popup'>{ OPTION_SET_INT, ('2'), ("ours"), (&amp;opts-&gt;writeout_stage<br>), ((void*)0), (("checkout our version for unmerged files")),<br> PARSE_OPT_NOARG | (PARSE_OPT_NONEG), ((void*)0), (2) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">			      <span class='macro'>2, PARSE_OPT_NONEG)<span class='macro_popup'>{ OPTION_SET_INT, ('2'), ("ours"), (&amp;opts-&gt;writeout_stage<br>), ((void*)0), (("checkout our version for unmerged files")),<br> PARSE_OPT_NOARG | (PARSE_OPT_NONEG), ((void*)0), (2) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">		<span class='macro'>OPT_SET_INT_F('3', <span class='string_literal'>"theirs"</span>, &amp;opts-&gt;writeout_stage,<span class='macro_popup'>{ OPTION_SET_INT, ('3'), ("theirs"), (&amp;opts-&gt;writeout_stage<br>), ((void*)0), (("checkout their version for unmerged files")<br>), PARSE_OPT_NOARG | (PARSE_OPT_NONEG), ((void*)0), (3) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">			      <span class='macro'>N_(<span class='string_literal'>"checkout their version for unmerged files"</span>),<span class='macro_popup'>{ OPTION_SET_INT, ('3'), ("theirs"), (&amp;opts-&gt;writeout_stage<br>), ((void*)0), (("checkout their version for unmerged files")<br>), PARSE_OPT_NOARG | (PARSE_OPT_NONEG), ((void*)0), (3) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">			      <span class='macro'>3, PARSE_OPT_NONEG)<span class='macro_popup'>{ OPTION_SET_INT, ('3'), ("theirs"), (&amp;opts-&gt;writeout_stage<br>), ((void*)0), (("checkout their version for unmerged files")<br>), PARSE_OPT_NOARG | (PARSE_OPT_NONEG), ((void*)0), (3) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">		<span class='macro'>OPT_BOOL('p', <span class='string_literal'>"patch"</span>, &amp;opts-&gt;patch_mode, N_(<span class='string_literal'>"select hunks interactively"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('p'), ("patch"), (&amp;opts-&gt;patch_mode<br>), ((void*)0), (("select hunks interactively")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"ignore-skip-worktree-bits"</span>, &amp;opts-&gt;ignore_skipworktree,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-skip-worktree-bits"), (&amp;opts<br>-&gt;ignore_skipworktree), ((void*)0), (("do not limit pathspecs to sparse entries only"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"do not limit pathspecs to sparse entries only"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-skip-worktree-bits"), (&amp;opts<br>-&gt;ignore_skipworktree), ((void*)0), (("do not limit pathspecs to sparse entries only"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">		<span class='macro'>OPT_PATHSPEC_FROM_FILE(&amp;opts-&gt;pathspec_from_file)<span class='macro_popup'>{ OPTION_FILENAME, (0), ("pathspec-from-file"), (&amp;opts-&gt;<br>pathspec_from_file), ("file"), (("read pathspec from file")) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">		<span class='macro'>OPT_PATHSPEC_FILE_NUL(&amp;opts-&gt;pathspec_file_nul)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("pathspec-file-nul"), (&amp;opts-&gt;<br>pathspec_file_nul), ((void*)0), (("with --pathspec-from-file, pathspec elements are separated with NUL character"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">	<span class='keyword'>struct</span> option *newopts = parse_options_concat(prevopts, options);</td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">	free(prevopts);</td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">	<span class='keyword'>return</span> newopts;</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line"><span class='comment'>/* create-branch option (either b or c) */</span></td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> cb_option = 'b';</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> checkout_main(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix,</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">			 <span class='keyword'>struct</span> checkout_opts *opts, <span class='keyword'>struct</span> option *options,</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">			 <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> usagestr[])</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">	<span class='keyword'>struct</span> branch_info new_branch_info;</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">	<span class='keyword'>int</span> parseopt_flags = 0;</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">	memset(&amp;new_branch_info, 0, <span class='keyword'>sizeof</span>(new_branch_info));</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">	opts-&gt;overwrite_ignore = 1;</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">	opts-&gt;prefix = prefix;</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">	opts-&gt;show_progress = -1;</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">	git_config(git_checkout_config, opts);</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">	opts-&gt;track = BRANCH_TRACK_UNSPECIFIED;</td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;accept_pathspec &amp;&amp; !opts-&gt;accept_ref)</td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">		<span class='macro'>BUG(<span class='string_literal'>"make up your mind, you need to take _something_"</span>)<span class='macro_popup'>BUG_fl("builtin/checkout.c", 1561, "make up your mind, you need to take _something_"<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;accept_pathspec &amp;&amp; opts-&gt;accept_ref)</td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">		parseopt_flags = PARSE_OPT_KEEP_DASHDASH;</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">	argc = parse_options(argc, argv, prefix, options,</td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">			     usagestr, parseopt_flags);</td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;show_progress &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;quiet)</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">			opts-&gt;show_progress = 0;</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">			opts-&gt;show_progress = isatty(2);</td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;conflict_style) {</td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">		opts-&gt;merge = 1; <span class='comment'>/* implied */</span></td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">		git_xmerge_config(<span class='string_literal'>"merge.conflictstyle"</span>, opts-&gt;conflict_style, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;force) {</td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">		opts-&gt;discard_changes = 1;</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line">		opts-&gt;ignore_unmerged_opt = <span class='string_literal'>"--force"</span>;</td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">		opts-&gt;ignore_unmerged = 1;</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">	<span class='keyword'>if</span> ((!!opts-&gt;new_branch + !!opts-&gt;new_branch_force + !!opts-&gt;new_orphan_branch) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">		die(_(<span class='string_literal'>"-%c, -%c and --orphan are mutually exclusive"</span>),</td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">				cb_option, <span class='macro'>toupper(cb_option)<span class='macro_popup'>sane_case((unsigned char)(cb_option), 0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;overlay_mode == 1 &amp;&amp; opts-&gt;patch_mode)</td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">		die(_(<span class='string_literal'>"-p and --overlay are mutually exclusive"</span>));</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;checkout_index &gt;= 0 || opts-&gt;checkout_worktree &gt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;checkout_index &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">			opts-&gt;checkout_index = 0;</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;checkout_worktree &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line">			opts-&gt;checkout_worktree = 0;</td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;checkout_index &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">			opts-&gt;checkout_index = -opts-&gt;checkout_index - 1;</td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;checkout_worktree &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">			opts-&gt;checkout_worktree = -opts-&gt;checkout_worktree - 1;</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;checkout_index &lt; 0 || opts-&gt;checkout_worktree &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">		<span class='macro'>BUG(<span class='string_literal'>"these flags should be non-negative by now"</span>)<span class='macro_popup'>BUG_fl("builtin/checkout.c", 1604, "these flags should be non-negative by now"<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">	 <span class='comment'>* convenient shortcut: "git restore --staged [--worktree]" equals</span></td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line">	 <span class='comment'>* "git restore --staged [--worktree] --source HEAD"</span></td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">	<span class='keyword'>if</span> (!opts-&gt;from_treeish &amp;&amp; opts-&gt;checkout_index)</td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">		opts-&gt;from_treeish = <span class='string_literal'>"HEAD"</span>;</td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">	 <span class='comment'>* From here on, new_branch will contain the branch to be checked out,</span></td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line">	 <span class='comment'>* and new_branch_force and new_orphan_branch will tell us which one of</span></td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">	 <span class='comment'>* -b/-B/-c/-C/--orphan is being used.</span></td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_branch_force)</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">		opts-&gt;new_branch = opts-&gt;new_branch_force;</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_orphan_branch)</td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">		opts-&gt;new_branch = opts-&gt;new_orphan_branch;</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">	<span class='comment'>/* --track without -c/-C/-b/-B/--orphan should DWIM */</span></td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;track != BRANCH_TRACK_UNSPECIFIED &amp;&amp; !opts-&gt;new_branch) {</td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *argv0 = argv[0];</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">		<span class='keyword'>if</span> (!argc || !strcmp(argv0, <span class='string_literal'>"--"</span>))</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">			die(_(<span class='string_literal'>"--track needs a branch name"</span>));</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">		skip_prefix(argv0, <span class='string_literal'>"refs/"</span>, &amp;argv0);</td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">		skip_prefix(argv0, <span class='string_literal'>"remotes/"</span>, &amp;argv0);</td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">		argv0 = strchr(argv0, '/');</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">		<span class='keyword'>if</span> (!argv0 || !argv0[1])</td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">			die(_(<span class='string_literal'>"missing branch name; try -%c"</span>), cb_option);</td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">		opts-&gt;new_branch = argv0 + 1;</td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">	 <span class='comment'>* Extract branch name from command line arguments, so</span></td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">	 <span class='comment'>* all that is left is pathspecs.</span></td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">	 <span class='comment'>* Handle</span></td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">	 <span class='comment'>*  1) git checkout &lt;tree&gt; -- [&lt;paths&gt;]</span></td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">	 <span class='comment'>*  2) git checkout -- [&lt;paths&gt;]</span></td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">	 <span class='comment'>*  3) git checkout &lt;something&gt; [&lt;paths&gt;]</span></td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">	 <span class='comment'>* including "last branch" syntax and DWIM-ery for names of</span></td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">	 <span class='comment'>* remote branches, erroring out for invalid or ambiguous cases.</span></td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">	<span class='keyword'>if</span> (argc &amp;&amp; opts-&gt;accept_ref) {</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">		<span class='keyword'>struct</span> object_id rev;</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">		<span class='keyword'>int</span> dwim_ok =</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">			!opts-&gt;patch_mode &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">			opts-&gt;dwim_new_local_branch &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line">			opts-&gt;track == BRANCH_TRACK_UNSPECIFIED &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">			!opts-&gt;new_branch;</td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">		<span class='keyword'>int</span> n = parse_branchname_arg(argc, argv, dwim_ok,</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">					     &amp;new_branch_info, opts, &amp;rev);</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">		argv += n;</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">		argc -= n;</td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!opts-&gt;accept_ref &amp;&amp; opts-&gt;from_treeish) {</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">		<span class='keyword'>struct</span> object_id rev;</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>get_oid_mb(opts-&gt;from_treeish, &amp;rev)<span class='macro_popup'>repo_get_oid_mb(the_repository, opts-&gt;from_treeish, &amp;rev<br>)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">			die(_(<span class='string_literal'>"could not resolve %s"</span>), opts-&gt;from_treeish);</td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">		setup_new_branch_info_and_source_tree(&amp;new_branch_info,</td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line">						      opts, &amp;rev,</td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">						      opts-&gt;from_treeish);</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line">		<span class='keyword'>if</span> (!opts-&gt;source_tree)</td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line">			die(_(<span class='string_literal'>"reference is not a tree: %s"</span>), opts-&gt;from_treeish);</td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line">	<span class='keyword'>if</span> (argc) {</td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">		parse_pathspec(&amp;opts-&gt;pathspec, 0,</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">			       opts-&gt;patch_mode ? <span class='macro'>PATHSPEC_PREFIX_ORIGIN<span class='macro_popup'>(1&lt;&lt;4)</span></span> : 0,</td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line">			       prefix, argv);</td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">		<span class='keyword'>if</span> (!opts-&gt;pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">			die(_(<span class='string_literal'>"invalid path specification"</span>));</td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">		 <span class='comment'>* Try to give more helpful suggestion.</span></td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">		 <span class='comment'>* new_branch &amp;&amp; argc &gt; 1 will be caught later.</span></td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;new_branch &amp;&amp; argc == 1 &amp;&amp; !new_branch_info.commit)</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line">			die(_(<span class='string_literal'>"'%s' is not a commit and a branch '%s' cannot be created from it"</span>),</td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">				argv[0], opts-&gt;new_branch);</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;force_detach)</td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">			die(_(<span class='string_literal'>"git checkout: --detach does not take a path argument '%s'"</span>),</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">			    argv[0]);</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;pathspec_from_file) {</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with pathspec arguments"</span>));</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;force_detach)</td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with --detach"</span>));</td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;patch_mode)</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with --patch"</span>));</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">		parse_pathspec_file(&amp;opts-&gt;pathspec, 0,</td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">				    0,</td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">				    prefix, opts-&gt;pathspec_from_file, opts-&gt;pathspec_file_nul);</td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (opts-&gt;pathspec_file_nul) {</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">		die(_(<span class='string_literal'>"--pathspec-file-nul requires --pathspec-from-file"</span>));</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">	opts-&gt;pathspec.recursive = 1;</td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;pathspec.nr) {</td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">		<span class='keyword'>if</span> (1 &lt; !!opts-&gt;writeout_stage + !!opts-&gt;force + !!opts-&gt;merge)</td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">			die(_(<span class='string_literal'>"git checkout: --ours/--theirs, --force and --merge are incompatible when\n"</span></td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line">			      <span class='string_literal'>"checking out of the index."</span>));</td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;accept_pathspec &amp;&amp; !opts-&gt;empty_pathspec_ok &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">		    !opts-&gt;patch_mode)	<span class='comment'>/* patch mode is special */</span></td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">			die(_(<span class='string_literal'>"you must specify path(s) to restore"</span>));</td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;new_branch) {</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">		<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">		<span class='keyword'>if</span> (opts-&gt;new_branch_force)</td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">			opts-&gt;branch_exists = validate_branchname(opts-&gt;new_branch, &amp;buf);</td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line">			opts-&gt;branch_exists =</td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">				validate_new_branchname(opts-&gt;new_branch, &amp;buf, 0);</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">		strbuf_release(&amp;buf);</td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line">	<span class='macro'>UNLEAK(opts)<span class='macro_popup'>do {} while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line">	<span class='keyword'>if</span> (opts-&gt;patch_mode || opts-&gt;pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">		<span class='keyword'>return</span> checkout_paths(opts, &amp;new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">		<span class='keyword'>return</span> checkout_branch(opts, &amp;new_branch_info);</td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line"><span class='keyword'>int</span> cmd_checkout(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">	<span class='keyword'>struct</span> checkout_opts opts;</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">	<span class='keyword'>struct</span> option *options;</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">	<span class='keyword'>struct</span> option checkout_options[] = {</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line">		<span class='macro'>OPT_STRING('b', NULL, &amp;opts.new_branch, N_(<span class='string_literal'>"branch"</span>),<span class='macro_popup'>{ OPTION_STRING, ('b'), (((void*)0)), (&amp;opts.new_branch),<br> (("branch")), (("create and checkout a new branch")), (0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"create and checkout a new branch"</span>))<span class='macro_popup'>{ OPTION_STRING, ('b'), (((void*)0)), (&amp;opts.new_branch),<br> (("branch")), (("create and checkout a new branch")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">		<span class='macro'>OPT_STRING('B', NULL, &amp;opts.new_branch_force, N_(<span class='string_literal'>"branch"</span>),<span class='macro_popup'>{ OPTION_STRING, ('B'), (((void*)0)), (&amp;opts.new_branch_force<br>), (("branch")), (("create/reset and checkout a branch")), (0<br>) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"create/reset and checkout a branch"</span>))<span class='macro_popup'>{ OPTION_STRING, ('B'), (((void*)0)), (&amp;opts.new_branch_force<br>), (("branch")), (("create/reset and checkout a branch")), (0<br>) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">		<span class='macro'>OPT_BOOL('l', NULL, &amp;opts.new_branch_log, N_(<span class='string_literal'>"create reflog for new branch"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('l'), (((void*)0)), (&amp;opts.new_branch_log<br>), ((void*)0), (("create reflog for new branch")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"guess"</span>, &amp;opts.dwim_new_local_branch,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("guess"), (&amp;opts.dwim_new_local_branch<br>), ((void*)0), (("second guess 'git checkout &lt;no-such-branch&gt;' (default)"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"second guess 'git checkout &lt;no-such-branch&gt;' (default)"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("guess"), (&amp;opts.dwim_new_local_branch<br>), ((void*)0), (("second guess 'git checkout &lt;no-such-branch&gt;' (default)"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"overlay"</span>, &amp;opts.overlay_mode, N_(<span class='string_literal'>"use overlay mode (default)"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("overlay"), (&amp;opts.overlay_mode),<br> ((void*)0), (("use overlay mode (default)")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">	<span class='keyword'>int</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">	memset(&amp;opts, 0, <span class='keyword'>sizeof</span>(opts));</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line">	opts.dwim_new_local_branch = 1;</td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">	opts.switch_branch_doing_nothing_is_ok = 1;</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">	opts.only_merge_on_switching_branches = 0;</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line">	opts.accept_ref = 1;</td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line">	opts.accept_pathspec = 1;</td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line">	opts.implicit_detach = 1;</td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line">	opts.can_switch_when_in_progress = 1;</td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">	opts.orphan_from_empty_tree = 0;</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">	opts.empty_pathspec_ok = 1;</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">	opts.overlay_mode = -1;</td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">	opts.checkout_index = -2;    <span class='comment'>/* default on */</span></td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">	opts.checkout_worktree = -2; <span class='comment'>/* default on */</span></td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">	<span class='keyword'>if</span> (argc == 3 &amp;&amp; !strcmp(argv[1], <span class='string_literal'>"-b"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">		 <span class='comment'>* User ran 'git checkout -b &lt;branch&gt;' and expects</span></td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">		 <span class='comment'>* the same behavior as 'git switch -c &lt;branch&gt;'.</span></td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">		opts.switch_branch_doing_nothing_is_ok = 0;</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">		opts.only_merge_on_switching_branches = 1;</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">	options = parse_options_dup(checkout_options);</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">	options = add_common_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">	options = add_common_switch_branch_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">	options = add_checkout_path_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">	ret = checkout_main(argc, argv, prefix, &amp;opts,</td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">			    options, checkout_usage);</td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">	<span class='macro'>FREE_AND_NULL(options)<span class='macro_popup'>do { free(options); (options) = ((void*)0); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line"><span class='keyword'>int</span> cmd_switch(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">	<span class='keyword'>struct</span> checkout_opts opts;</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">	<span class='keyword'>struct</span> option *options = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">	<span class='keyword'>struct</span> option switch_options[] = {</td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">		<span class='macro'>OPT_STRING('c', <span class='string_literal'>"create"</span>, &amp;opts.new_branch, N_(<span class='string_literal'>"branch"</span>),<span class='macro_popup'>{ OPTION_STRING, ('c'), ("create"), (&amp;opts.new_branch), (<br>("branch")), (("create and switch to a new branch")), (0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"create and switch to a new branch"</span>))<span class='macro_popup'>{ OPTION_STRING, ('c'), ("create"), (&amp;opts.new_branch), (<br>("branch")), (("create and switch to a new branch")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">		<span class='macro'>OPT_STRING('C', <span class='string_literal'>"force-create"</span>, &amp;opts.new_branch_force, N_(<span class='string_literal'>"branch"</span>),<span class='macro_popup'>{ OPTION_STRING, ('C'), ("force-create"), (&amp;opts.new_branch_force<br>), (("branch")), (("create/reset and switch to a branch")), (<br>0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"create/reset and switch to a branch"</span>))<span class='macro_popup'>{ OPTION_STRING, ('C'), ("force-create"), (&amp;opts.new_branch_force<br>), (("branch")), (("create/reset and switch to a branch")), (<br>0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"guess"</span>, &amp;opts.dwim_new_local_branch,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("guess"), (&amp;opts.dwim_new_local_branch<br>), ((void*)0), (("second guess 'git switch &lt;no-such-branch&gt;'"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"second guess 'git switch &lt;no-such-branch&gt;'"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("guess"), (&amp;opts.dwim_new_local_branch<br>), ((void*)0), (("second guess 'git switch &lt;no-such-branch&gt;'"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"discard-changes"</span>, &amp;opts.discard_changes,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("discard-changes"), (&amp;opts.discard_changes<br>), ((void*)0), (("throw away local modifications")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"throw away local modifications"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("discard-changes"), (&amp;opts.discard_changes<br>), ((void*)0), (("throw away local modifications")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">	<span class='keyword'>int</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">	memset(&amp;opts, 0, <span class='keyword'>sizeof</span>(opts));</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">	opts.dwim_new_local_branch = 1;</td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line">	opts.accept_ref = 1;</td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line">	opts.accept_pathspec = 0;</td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">	opts.switch_branch_doing_nothing_is_ok = 0;</td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">	opts.only_merge_on_switching_branches = 1;</td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">	opts.implicit_detach = 0;</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line">	opts.can_switch_when_in_progress = 0;</td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">	opts.orphan_from_empty_tree = 1;</td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line">	opts.overlay_mode = -1;</td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">	options = parse_options_dup(switch_options);</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line">	options = add_common_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">	options = add_common_switch_branch_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">	cb_option = 'c';</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">	ret = checkout_main(argc, argv, prefix, &amp;opts,</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">			    options, switch_branch_usage);</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">	<span class='macro'>FREE_AND_NULL(options)<span class='macro_popup'>do { free(options); (options) = ((void*)0); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line"><span class='keyword'>int</span> cmd_restore(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">	<span class='keyword'>struct</span> checkout_opts opts;</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">	<span class='keyword'>struct</span> option *options;</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">	<span class='keyword'>struct</span> option restore_options[] = {</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">		<span class='macro'>OPT_STRING('s', <span class='string_literal'>"source"</span>, &amp;opts.from_treeish, <span class='string_literal'>"&lt;tree-ish&gt;"</span>,<span class='macro_popup'>{ OPTION_STRING, ('s'), ("source"), (&amp;opts.from_treeish),<br> ("&lt;tree-ish&gt;"), (("which tree-ish to checkout from")),<br> (0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"which tree-ish to checkout from"</span>))<span class='macro_popup'>{ OPTION_STRING, ('s'), ("source"), (&amp;opts.from_treeish),<br> ("&lt;tree-ish&gt;"), (("which tree-ish to checkout from")),<br> (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line">		<span class='macro'>OPT_BOOL('S', <span class='string_literal'>"staged"</span>, &amp;opts.checkout_index,<span class='macro_popup'>{ OPTION_SET_INT, ('S'), ("staged"), (&amp;opts.checkout_index<br>), ((void*)0), (("restore the index")), PARSE_OPT_NOARG | (0)<br>, ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"restore the index"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('S'), ("staged"), (&amp;opts.checkout_index<br>), ((void*)0), (("restore the index")), PARSE_OPT_NOARG | (0)<br>, ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line">		<span class='macro'>OPT_BOOL('W', <span class='string_literal'>"worktree"</span>, &amp;opts.checkout_worktree,<span class='macro_popup'>{ OPTION_SET_INT, ('W'), ("worktree"), (&amp;opts.checkout_worktree<br>), ((void*)0), (("restore the working tree (default)")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line">			   <span class='macro'>N_(<span class='string_literal'>"restore the working tree (default)"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('W'), ("worktree"), (&amp;opts.checkout_worktree<br>), ((void*)0), (("restore the working tree (default)")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"ignore-unmerged"</span>, &amp;opts.ignore_unmerged,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-unmerged"), (&amp;opts.ignore_unmerged<br>), ((void*)0), (("ignore unmerged entries")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"ignore unmerged entries"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("ignore-unmerged"), (&amp;opts.ignore_unmerged<br>), ((void*)0), (("ignore unmerged entries")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"overlay"</span>, &amp;opts.overlay_mode, N_(<span class='string_literal'>"use overlay mode"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("overlay"), (&amp;opts.overlay_mode),<br> ((void*)0), (("use overlay mode")), PARSE_OPT_NOARG | (0), (<br>(void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line">	<span class='keyword'>int</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line">	<span class="mrange">memset</span>(&amp;opts, 0, <span class='keyword'>sizeof</span>(opts));</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:9ex; max-width:58em">Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line">	opts.accept_ref = 0;</td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line">	opts.accept_pathspec = 1;</td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">	opts.empty_pathspec_ok = 0;</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">	opts.overlay_mode = 0;</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">	opts.checkout_index = -1;    <span class='comment'>/* default off */</span></td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">	opts.checkout_worktree = -2; <span class='comment'>/* default on */</span></td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">	opts.ignore_unmerged_opt = <span class='string_literal'>"--ignore-unmerged"</span>;</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">	options = parse_options_dup(restore_options);</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line">	options = add_common_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">	options = add_checkout_path_options(&amp;opts, options);</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line">	ret = checkout_main(argc, argv, prefix, &amp;opts,</td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">			    options, restore_usage);</td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">	<span class='macro'>FREE_AND_NULL(options)<span class='macro_popup'>do { free(options); (options) = ((void*)0); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">}</td></tr>
</table></body></html>
