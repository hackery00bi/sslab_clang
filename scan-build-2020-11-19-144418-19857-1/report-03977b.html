<!doctype html>
<html>
<head>
<title>builtin/reset.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memset' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/real/c_git/git/builtin/reset.c -->

<!-- FILENAME reset.c -->

<!-- FUNCTIONNAME read_from_tree -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 9b037eea6c9e66bce0055f68718db7b3 -->

<!-- BUGLINE 161 -->

<!-- BUGCOLUMN 2 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>builtin/reset.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 161, column 2</a><br />Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name reset.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I . -D HAVE_SYSINFO -D GIT_HOST_CPU="x86_64" -D HAVE_ALLOCA_H -D USE_CURL_FOR_IMAP_SEND -D SHA1_DC -D SHA1DC_NO_STANDARD_INCLUDES -D SHA1DC_INIT_SAFE_HASH_DEFAULT=0 -D SHA1DC_CUSTOM_INCLUDE_SHA1_C="cache.h" -D SHA1DC_CUSTOM_INCLUDE_UBC_CHECK_C="git-compat-util.h" -D SHA256_BLK -D HAVE_PATHS_H -D HAVE_DEV_TTY -D HAVE_CLOCK_GETTIME -D HAVE_CLOCK_MONOTONIC -D HAVE_GETDELIM -D PROCFS_EXECUTABLE_PATH="/proc/self/exe" -D FREAD_READS_DIRECTORIES -D NO_STRLCPY -D SHELL_PATH="/bin/sh" -D PAGER_ENV="LESS=FRX LV=-c" -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -fdebug-compilation-dir /tmp/real/c_git/git -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker deadcode -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-19-144418-19857-1 -x c builtin/reset.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"161": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>* "git reset" builtin command</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> <span class='comment'>* Copyright (c) 2007 Carlos Rica</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"> <span class='comment'>* Based on git-reset.sh, which is</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> <span class='comment'>* Copyright (c) 2005, 2006 Linus Torvalds and Junio C Hamano</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#define USE_THE_INDEX_COMPATIBILITY_MACROS</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include "builtin.h"</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include "config.h"</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include "lockfile.h"</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include "tag.h"</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include "object.h"</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "pretty.h"</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include "run-command.h"</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include "refs.h"</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include "diff.h"</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "diffcore.h"</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include "tree.h"</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include "branch.h"</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include "parse-options.h"</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include "unpack-trees.h"</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include "cache-tree.h"</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include "submodule.h"</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include "submodule-config.h"</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='directive'>#define <span class='macro'>REFRESH_INDEX_DELAY_WARNING_IN_MS<span class='macro_popup'>(2 * 1000)</span></span> (2 * 1000)</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> git_reset_usage[] = {</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git reset [--mixed | --soft | --hard | --merge | --keep] [-q] [&lt;commit&gt;]"</span>)<span class='macro_popup'>("git reset [--mixed | --soft | --hard | --merge | --keep] [-q] [&lt;commit&gt;]"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git reset [-q] [&lt;tree-ish&gt;] [--] &lt;pathspec&gt;..."</span>)<span class='macro_popup'>("git reset [-q] [&lt;tree-ish&gt;] [--] &lt;pathspec&gt;..."<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git reset [-q] [--pathspec-from-file [--pathspec-file-nul]] [&lt;tree-ish&gt;]"</span>)<span class='macro_popup'>("git reset [-q] [--pathspec-from-file [--pathspec-file-nul]] [&lt;tree-ish&gt;]"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git reset --patch [&lt;tree-ish&gt;] [--] [&lt;pathspec&gt;...]"</span>)<span class='macro_popup'>("git reset --patch [&lt;tree-ish&gt;] [--] [&lt;pathspec&gt;...]"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">	<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='keyword'>enum</span> reset_type { MIXED, SOFT, HARD, MERGE, KEEP, NONE };</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *reset_type_names[] = {</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"mixed"</span>)<span class='macro_popup'>("mixed")</span></span>, <span class='macro'>N_(<span class='string_literal'>"soft"</span>)<span class='macro_popup'>("soft")</span></span>, <span class='macro'>N_(<span class='string_literal'>"hard"</span>)<span class='macro_popup'>("hard")</span></span>, <span class='macro'>N_(<span class='string_literal'>"merge"</span>)<span class='macro_popup'>("merge")</span></span>, <span class='macro'>N_(<span class='string_literal'>"keep"</span>)<span class='macro_popup'>("keep")</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>inline</span> <span class='keyword'>int</span> is_merge(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">	<span class='keyword'>return</span> !access(git_path_merge_head(the_repository), <span class='macro'>F_OK<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> reset_index(<span class='keyword'>const</span> <span class='keyword'>char</span> *ref, <span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid, <span class='keyword'>int</span> reset_type, <span class='keyword'>int</span> quiet)</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">	<span class='keyword'>int</span> i, nr = 0;</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">	<span class='keyword'>struct</span> tree_desc desc[2];</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">	<span class='keyword'>struct</span> tree *tree;</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">	<span class='keyword'>struct</span> unpack_trees_options opts;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">	<span class='keyword'>int</span> ret = -1;</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">	memset(&amp;opts, 0, <span class='keyword'>sizeof</span>(opts));</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">	opts.head_idx = 1;</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">	opts.src_index = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">	opts.dst_index = &amp;the_index;</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">	opts.fn = oneway_merge;</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">	opts.merge = 1;</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">	init_checkout_metadata(&amp;opts.meta, ref, oid, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">	<span class='keyword'>if</span> (!quiet)</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">		opts.verbose_update = 1;</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">	<span class='keyword'>switch</span> (reset_type) {</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">	<span class='keyword'>case</span> KEEP:</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">	<span class='keyword'>case</span> MERGE:</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">		opts.update = 1;</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">	<span class='keyword'>case</span> HARD:</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">		opts.update = 1;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">		<span class='comment'>/* fallthrough */</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">		opts.reset = 1;</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">	<span class='macro'>read_cache_unmerged()<span class='macro_popup'>repo_read_index_unmerged(the_repository)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">	<span class='keyword'>if</span> (reset_type == KEEP) {</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">		<span class='keyword'>struct</span> object_id head_oid;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>get_oid(<span class='string_literal'>"HEAD"</span>, &amp;head_oid)<span class='macro_popup'>repo_get_oid(the_repository, "HEAD", &amp;head_oid)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"You do not have a valid HEAD."</span>))<span class='macro_popup'>(error(_("You do not have a valid HEAD.")), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">		<span class='keyword'>if</span> (!fill_tree_descriptor(the_repository, desc + nr, &amp;head_oid))</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"Failed to find tree of HEAD."</span>))<span class='macro_popup'>(error(_("Failed to find tree of HEAD.")), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">		nr++;</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">		opts.fn = twoway_merge;</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">	<span class='keyword'>if</span> (!fill_tree_descriptor(the_repository, desc + nr, oid)) {</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">		<span class='macro'>error(_(<span class='string_literal'>"Failed to find tree of %s."</span>), oid_to_hex(oid))<span class='macro_popup'>(error(_("Failed to find tree of %s."), oid_to_hex(oid)), const_error<br>())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">		<span class='keyword'>goto</span> out;</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">	nr++;</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">	<span class='keyword'>if</span> (unpack_trees(nr, desc, &amp;opts))</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">		<span class='keyword'>goto</span> out;</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">	<span class='keyword'>if</span> (reset_type == MIXED || reset_type == HARD) {</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">		tree = parse_tree_indirect(oid);</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">		prime_cache_tree(the_repository, the_repository-&gt;index, tree);</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">	ret = 0;</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">out:</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; nr; i++)</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">		free((<span class='keyword'>void</span> *)desc[i].buffer);</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> print_new_head_line(<span class='keyword'>struct</span> commit *commit)</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">	printf(_(<span class='string_literal'>"HEAD is now at %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">		<span class='macro'>find_unique_abbrev(&amp;commit-&gt;object.oid, DEFAULT_ABBREV)<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;commit-&gt;object<br>.oid, default_abbrev)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">	pp_commit_easy(CMIT_FMT_ONELINE, commit, &amp;buf);</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">	<span class='keyword'>if</span> (buf.len &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">		printf(<span class='string_literal'>" %s"</span>, buf.buf);</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">	putchar('\n');</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">	strbuf_release(&amp;buf);</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> update_index_from_diff(<span class='keyword'>struct</span> diff_queue_struct *q,</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">		<span class='keyword'>struct</span> diff_options *opt, <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">	<span class='keyword'>int</span> intent_to_add = *(<span class='keyword'>int</span> *)data;</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">		<span class='keyword'>struct</span> diff_filespec *one = q-&gt;queue[i]-&gt;one;</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">		<span class='keyword'>int</span> is_missing = !(one-&gt;mode &amp;&amp; !is_null_oid(&amp;one-&gt;oid));</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">		<span class='keyword'>struct</span> cache_entry *ce;</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">		<span class='keyword'>if</span> (is_missing &amp;&amp; !intent_to_add) {</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">			<span class='macro'>remove_file_from_cache(one-&gt;path)<span class='macro_popup'>remove_file_from_index(&amp;the_index, (one-&gt;path))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">		ce = make_cache_entry(&amp;the_index, one-&gt;mode, &amp;one-&gt;oid, one-&gt;path,</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">				      0, 0);</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">		<span class='keyword'>if</span> (!ce)</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">			die(_(<span class='string_literal'>"make_cache_entry failed for path '%s'"</span>),</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">			    one-&gt;path);</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">		<span class='keyword'>if</span> (is_missing) {</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">			ce-&gt;ce_flags |= <span class='macro'>CE_INTENT_TO_ADD<span class='macro_popup'>(1 &lt;&lt; 29)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">			set_object_name_for_intent_to_add_entry(ce);</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">		<span class='macro'>add_cache_entry(ce, ADD_CACHE_OK_TO_ADD | ADD_CACHE_OK_TO_REPLACE)<span class='macro_popup'>add_index_entry(&amp;the_index, (ce), (1 | 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> read_from_tree(<span class='keyword'>const</span> <span class='keyword'>struct</span> pathspec *pathspec,</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">			  <span class='keyword'>struct</span> object_id *tree_oid,</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">			  <span class='keyword'>int</span> intent_to_add)</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">	<span class='keyword'>struct</span> diff_options opt;</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">	<span class="mrange">memset</span>(&amp;opt, 0, <span class='keyword'>sizeof</span>(opt));</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:9ex; max-width:58em">Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">	copy_pathspec(&amp;opt.pathspec, pathspec);</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">	opt.output_format = <span class='macro'>DIFF_FORMAT_CALLBACK<span class='macro_popup'>0x1000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">	opt.format_callback = update_index_from_diff;</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">	opt.format_callback_data = &amp;intent_to_add;</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">	opt.flags.override_submodule_config = 1;</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">	opt.repo = the_repository;</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">	<span class='keyword'>if</span> (do_diff_cache(tree_oid, &amp;opt))</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">	diffcore_std(&amp;opt);</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">	diff_flush(&amp;opt);</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">	clear_pathspec(&amp;opt.pathspec);</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> set_reflog_message(<span class='keyword'>struct</span> strbuf *sb, <span class='keyword'>const</span> <span class='keyword'>char</span> *action,</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">			       <span class='keyword'>const</span> <span class='keyword'>char</span> *rev)</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *rla = getenv(<span class='string_literal'>"GIT_REFLOG_ACTION"</span>);</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">	<span class='macro'>strbuf_reset(sb)<span class='macro_popup'>strbuf_setlen(sb, 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">	<span class='keyword'>if</span> (rla)</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">		strbuf_addf(sb, <span class='string_literal'>"%s: %s"</span>, rla, action);</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (rev)</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">		strbuf_addf(sb, <span class='string_literal'>"reset: moving to %s"</span>, rev);</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">		strbuf_addf(sb, <span class='string_literal'>"reset: %s"</span>, action);</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> die_if_unmerged_cache(<span class='keyword'>int</span> reset_type)</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">	<span class='keyword'>if</span> (is_merge() || <span class='macro'>unmerged_cache()<span class='macro_popup'>unmerged_index(&amp;the_index)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">		die(_(<span class='string_literal'>"Cannot do a %s reset in the middle of a merge."</span>),</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">		    _(reset_type_names[reset_type]));</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> parse_args(<span class='keyword'>struct</span> pathspec *pathspec,</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">		       <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix,</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">		       <span class='keyword'>int</span> patch_mode,</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">		       <span class='keyword'>const</span> <span class='keyword'>char</span> **rev_ret)</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *rev = <span class='string_literal'>"HEAD"</span>;</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">	<span class='keyword'>struct</span> object_id unused;</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">	 <span class='comment'>* Possible arguments are:</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">	 <span class='comment'>* git reset [-opts] [&lt;rev&gt;]</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">	 <span class='comment'>* git reset [-opts] &lt;tree&gt; [&lt;paths&gt;...]</span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">	 <span class='comment'>* git reset [-opts] &lt;tree&gt; -- [&lt;paths&gt;...]</span></td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">	 <span class='comment'>* git reset [-opts] -- [&lt;paths&gt;...]</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">	 <span class='comment'>* git reset [-opts] &lt;paths&gt;...</span></td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">	 <span class='comment'>* At this point, argv points immediately after [-opts].</span></td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">	<span class='keyword'>if</span> (argv[0]) {</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">		<span class='keyword'>if</span> (!strcmp(argv[0], <span class='string_literal'>"--"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">			argv++; <span class='comment'>/* reset to HEAD, possibly with paths */</span></td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (argv[1] &amp;&amp; !strcmp(argv[1], <span class='string_literal'>"--"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">			rev = argv[0];</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">			argv += 2;</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">		 <span class='comment'>* Otherwise, argv[0] could be either &lt;rev&gt; or &lt;paths&gt; and</span></td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">		 <span class='comment'>* has to be unambiguous. If there is a single argument, it</span></td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">		 <span class='comment'>* can not be a tree</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> ((!argv[1] &amp;&amp; !<span class='macro'>get_oid_committish(argv[0], &amp;unused)<span class='macro_popup'>repo_get_oid_committish(the_repository, argv[0], &amp;unused)</span></span>) ||</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">			 (argv[1] &amp;&amp; !<span class='macro'>get_oid_treeish(argv[0], &amp;unused)<span class='macro_popup'>repo_get_oid_treeish(the_repository, argv[0], &amp;unused)</span></span>)) {</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">			 <span class='comment'>* Ok, argv[0] looks like a commit/tree; it should not</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">			 <span class='comment'>* be a filename.</span></td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">			verify_non_filename(prefix, argv[0]);</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">			rev = *argv++;</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">			<span class='comment'>/* Otherwise we treat this as a filename */</span></td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">			verify_filename(prefix, argv[0], 1);</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">	*rev_ret = rev;</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>read_cache()<span class='macro_popup'>repo_read_index(the_repository)</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">		die(_(<span class='string_literal'>"index file corrupt"</span>));</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">	parse_pathspec(pathspec, 0,</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">		       <span class='macro'>PATHSPEC_PREFER_FULL<span class='macro_popup'>(1&lt;&lt;1)</span></span> |</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">		       (patch_mode ? <span class='macro'>PATHSPEC_PREFIX_ORIGIN<span class='macro_popup'>(1&lt;&lt;4)</span></span> : 0),</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">		       prefix, argv);</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> reset_refs(<span class='keyword'>const</span> <span class='keyword'>char</span> *rev, <span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid)</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">	<span class='keyword'>int</span> update_ref_status;</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">	<span class='keyword'>struct</span> strbuf msg = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">	<span class='keyword'>struct</span> object_id *orig = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, oid_orig,</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">		*old_orig = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, oid_old_orig;</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>get_oid(<span class='string_literal'>"ORIG_HEAD"</span>, &amp;oid_old_orig)<span class='macro_popup'>repo_get_oid(the_repository, "ORIG_HEAD", &amp;oid_old_orig)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">		old_orig = &amp;oid_old_orig;</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>get_oid(<span class='string_literal'>"HEAD"</span>, &amp;oid_orig)<span class='macro_popup'>repo_get_oid(the_repository, "HEAD", &amp;oid_orig)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">		orig = &amp;oid_orig;</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">		set_reflog_message(&amp;msg, <span class='string_literal'>"updating ORIG_HEAD"</span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">		update_ref(msg.buf, <span class='string_literal'>"ORIG_HEAD"</span>, orig, old_orig, 0,</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">			   UPDATE_REFS_MSG_ON_ERR);</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (old_orig)</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">		delete_ref(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='string_literal'>"ORIG_HEAD"</span>, old_orig, 0);</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">	set_reflog_message(&amp;msg, <span class='string_literal'>"updating HEAD"</span>, rev);</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">	update_ref_status = update_ref(msg.buf, <span class='string_literal'>"HEAD"</span>, oid, orig, 0,</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">				       UPDATE_REFS_MSG_ON_ERR);</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">	strbuf_release(&amp;msg);</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">	<span class='keyword'>return</span> update_ref_status;</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> git_reset_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"submodule.recurse"</span>))</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">		<span class='keyword'>return</span> git_default_submodule_config(var, value, cb);</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">	<span class='keyword'>return</span> git_default_config(var, value, cb);</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line"><span class='keyword'>int</span> cmd_reset(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">	<span class='keyword'>int</span> reset_type = NONE, update_ref_status = 0, quiet = 0;</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">	<span class='keyword'>int</span> patch_mode = 0, pathspec_file_nul = 0, unborn;</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *rev, *pathspec_from_file = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">	<span class='keyword'>struct</span> object_id oid;</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">	<span class='keyword'>struct</span> pathspec pathspec;</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">	<span class='keyword'>int</span> intent_to_add = 0;</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>struct</span> option options[] = {</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">		<span class='macro'>OPT__QUIET(&amp;quiet, N_(<span class='string_literal'>"be quiet, only report errors"</span>))<span class='macro_popup'>{ OPTION_COUNTUP, ('q'), ("quiet"), ((&amp;quiet)), ((void*)0<br>), ((("be quiet, only report errors"))), PARSE_OPT_NOARG|(0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">		<span class='macro'>OPT_SET_INT(0, <span class='string_literal'>"mixed"</span>, &amp;reset_type,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("mixed"), (&amp;reset_type), ((void*)<br>0), (("reset HEAD and index")), PARSE_OPT_NOARG | (0), ((void<br>*)0), (MIXED) }</span></span></td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">						<span class='macro'>N_(<span class='string_literal'>"reset HEAD and index"</span>), MIXED)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("mixed"), (&amp;reset_type), ((void*)<br>0), (("reset HEAD and index")), PARSE_OPT_NOARG | (0), ((void<br>*)0), (MIXED) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">		<span class='macro'>OPT_SET_INT(0, <span class='string_literal'>"soft"</span>, &amp;reset_type, N_(<span class='string_literal'>"reset only HEAD"</span>), SOFT)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("soft"), (&amp;reset_type), ((void*)0<br>), (("reset only HEAD")), PARSE_OPT_NOARG | (0), ((void*)0), (<br>SOFT) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">		<span class='macro'>OPT_SET_INT(0, <span class='string_literal'>"hard"</span>, &amp;reset_type,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("hard"), (&amp;reset_type), ((void*)0<br>), (("reset HEAD, index and working tree")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (HARD) }</span></span></td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">				<span class='macro'>N_(<span class='string_literal'>"reset HEAD, index and working tree"</span>), HARD)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("hard"), (&amp;reset_type), ((void*)0<br>), (("reset HEAD, index and working tree")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (HARD) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">		<span class='macro'>OPT_SET_INT(0, <span class='string_literal'>"merge"</span>, &amp;reset_type,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("merge"), (&amp;reset_type), ((void*)<br>0), (("reset HEAD, index and working tree")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (MERGE) }</span></span></td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">				<span class='macro'>N_(<span class='string_literal'>"reset HEAD, index and working tree"</span>), MERGE)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("merge"), (&amp;reset_type), ((void*)<br>0), (("reset HEAD, index and working tree")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (MERGE) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">		<span class='macro'>OPT_SET_INT(0, <span class='string_literal'>"keep"</span>, &amp;reset_type,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("keep"), (&amp;reset_type), ((void*)0<br>), (("reset HEAD but keep local changes")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (KEEP) }</span></span></td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">				<span class='macro'>N_(<span class='string_literal'>"reset HEAD but keep local changes"</span>), KEEP)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("keep"), (&amp;reset_type), ((void*)0<br>), (("reset HEAD but keep local changes")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (KEEP) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">		<span class='macro'>OPT_CALLBACK_F(0, <span class='string_literal'>"recurse-submodules"</span>, NULL,<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("recurse-submodules"), (((void*)0)),<br> ("reset"), ("control recursive updating of submodules"), (PARSE_OPT_OPTARG<br>), (option_parse_recurse_submodules_worktree_updater) }</span></span></td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">			    <span class='string_literal'><span class='macro'>"reset"</span>, <span class='string_literal'>"control recursive updating of submodules"</span>,<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("recurse-submodules"), (((void*)0)),<br> ("reset"), ("control recursive updating of submodules"), (PARSE_OPT_OPTARG<br>), (option_parse_recurse_submodules_worktree_updater) }</span></span></td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">			    <span class='macro'>PARSE_OPT_OPTARG, option_parse_recurse_submodules_worktree_updater)<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("recurse-submodules"), (((void*)0)),<br> ("reset"), ("control recursive updating of submodules"), (PARSE_OPT_OPTARG<br>), (option_parse_recurse_submodules_worktree_updater) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">		<span class='macro'>OPT_BOOL('p', <span class='string_literal'>"patch"</span>, &amp;patch_mode, N_(<span class='string_literal'>"select hunks interactively"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('p'), ("patch"), (&amp;patch_mode), ((void<br>*)0), (("select hunks interactively")), PARSE_OPT_NOARG | (0)<br>, ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">		<span class='macro'>OPT_BOOL('N', <span class='string_literal'>"intent-to-add"</span>, &amp;intent_to_add,<span class='macro_popup'>{ OPTION_SET_INT, ('N'), ("intent-to-add"), (&amp;intent_to_add<br>), ((void*)0), (("record only the fact that removed paths will be added later"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">				<span class='macro'>N_(<span class='string_literal'>"record only the fact that removed paths will be added later"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('N'), ("intent-to-add"), (&amp;intent_to_add<br>), ((void*)0), (("record only the fact that removed paths will be added later"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">		<span class='macro'>OPT_PATHSPEC_FROM_FILE(&amp;pathspec_from_file)<span class='macro_popup'>{ OPTION_FILENAME, (0), ("pathspec-from-file"), (&amp;pathspec_from_file<br>), ("file"), (("read pathspec from file")) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">		<span class='macro'>OPT_PATHSPEC_FILE_NUL(&amp;pathspec_file_nul)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("pathspec-file-nul"), (&amp;pathspec_file_nul<br>), ((void*)0), (("with --pathspec-from-file, pathspec elements are separated with NUL character"<br>)), PARSE_OPT_NOARG | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span></td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">	git_config(git_reset_config, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">	git_config_get_bool(<span class='string_literal'>"reset.quiet"</span>, &amp;quiet);</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">	argc = parse_options(argc, argv, prefix, options, git_reset_usage,</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">						PARSE_OPT_KEEP_DASHDASH);</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">	parse_args(&amp;pathspec, argv, prefix, patch_mode, &amp;rev);</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">	<span class='keyword'>if</span> (pathspec_from_file) {</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">		<span class='keyword'>if</span> (patch_mode)</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with --patch"</span>));</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">		<span class='keyword'>if</span> (pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">			die(_(<span class='string_literal'>"--pathspec-from-file is incompatible with pathspec arguments"</span>));</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">		parse_pathspec_file(&amp;pathspec, 0,</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">				    <span class='macro'>PATHSPEC_PREFER_FULL<span class='macro_popup'>(1&lt;&lt;1)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">				    prefix, pathspec_from_file, pathspec_file_nul);</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (pathspec_file_nul) {</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">		die(_(<span class='string_literal'>"--pathspec-file-nul requires --pathspec-from-file"</span>));</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">	unborn = !strcmp(rev, <span class='string_literal'>"HEAD"</span>) &amp;&amp; <span class='macro'>get_oid(<span class='string_literal'>"HEAD"</span>, &amp;oid)<span class='macro_popup'>repo_get_oid(the_repository, "HEAD", &amp;oid)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">	<span class='keyword'>if</span> (unborn) {</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">		<span class='comment'>/* reset on unborn branch: treat as reset to empty tree */</span></td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">		oidcpy(&amp;oid, <span class='macro'>the_hash_algo<span class='macro_popup'>the_repository-&gt;hash_algo</span></span>-&gt;empty_tree);</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!pathspec.nr &amp;&amp; !patch_mode) {</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">		<span class='keyword'>struct</span> commit *commit;</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>get_oid_committish(rev, &amp;oid)<span class='macro_popup'>repo_get_oid_committish(the_repository, rev, &amp;oid)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">			die(_(<span class='string_literal'>"Failed to resolve '%s' as a valid revision."</span>), rev);</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">		commit = lookup_commit_reference(the_repository, &amp;oid);</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">		<span class='keyword'>if</span> (!commit)</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">			die(_(<span class='string_literal'>"Could not parse object '%s'."</span>), rev);</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">		oidcpy(&amp;oid, &amp;commit-&gt;object.oid);</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">		<span class='keyword'>struct</span> tree *tree;</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>get_oid_treeish(rev, &amp;oid)<span class='macro_popup'>repo_get_oid_treeish(the_repository, rev, &amp;oid)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">			die(_(<span class='string_literal'>"Failed to resolve '%s' as a valid tree."</span>), rev);</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">		tree = parse_tree_indirect(&amp;oid);</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">		<span class='keyword'>if</span> (!tree)</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">			die(_(<span class='string_literal'>"Could not parse object '%s'."</span>), rev);</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">		oidcpy(&amp;oid, &amp;tree-&gt;object.oid);</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">	<span class='keyword'>if</span> (patch_mode) {</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">		<span class='keyword'>if</span> (reset_type != NONE)</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">			die(_(<span class='string_literal'>"--patch is incompatible with --{hard,mixed,soft}"</span>));</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">		<span class='macro'>trace2_cmd_mode(<span class='string_literal'>"patch-interactive"</span>)<span class='macro_popup'>trace2_cmd_mode_fl("builtin/reset.c", 362, ("patch-interactive"<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">		<span class='keyword'>return</span> run_add_interactive(rev, <span class='string_literal'>"--patch=reset"</span>, &amp;pathspec);</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">	<span class='comment'>/* git reset tree [--] paths... can be used to</span></td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">	 <span class='comment'>* load chosen paths from the tree into the index without</span></td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">	 <span class='comment'>* affecting the working tree nor HEAD. */</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">	<span class='keyword'>if</span> (pathspec.nr) {</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">		<span class='keyword'>if</span> (reset_type == MIXED)</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">			warning(_(<span class='string_literal'>"--mixed with paths is deprecated; use 'git reset -- &lt;paths&gt;' instead."</span>));</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (reset_type != NONE)</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">			die(_(<span class='string_literal'>"Cannot do %s reset with paths."</span>),</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">					_(reset_type_names[reset_type]));</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">	<span class='keyword'>if</span> (reset_type == NONE)</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">		reset_type = MIXED; <span class='comment'>/* by default */</span></td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">	<span class='keyword'>if</span> (pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">		<span class='macro'>trace2_cmd_mode(<span class='string_literal'>"path"</span>)<span class='macro_popup'>trace2_cmd_mode_fl("builtin/reset.c", 380, ("path"))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">		<span class='macro'>trace2_cmd_mode(reset_type_names[reset_type])<span class='macro_popup'>trace2_cmd_mode_fl("builtin/reset.c", 382, (reset_type_names[<br>reset_type]))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">	<span class='keyword'>if</span> (reset_type != SOFT &amp;&amp; (reset_type != MIXED || get_git_work_tree()))</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">		setup_work_tree();</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">	<span class='keyword'>if</span> (reset_type == MIXED &amp;&amp; is_bare_repository())</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">		die(_(<span class='string_literal'>"%s reset is not allowed in a bare repository"</span>),</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">		    _(reset_type_names[reset_type]));</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">	<span class='keyword'>if</span> (intent_to_add &amp;&amp; reset_type != MIXED)</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">		die(_(<span class='string_literal'>"-N can only be used with --mixed"</span>));</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">	<span class='comment'>/* Soft reset does not touch the index file nor the working tree</span></td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">	 <span class='comment'>* at all, but requires them in a good order.  Other resets reset</span></td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">	 <span class='comment'>* the index file to the tree object we are switching to. */</span></td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">	<span class='keyword'>if</span> (reset_type == SOFT || reset_type == KEEP)</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">		die_if_unmerged_cache(reset_type);</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">	<span class='keyword'>if</span> (reset_type != SOFT) {</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">		<span class='keyword'>struct</span> lock_file lock = <span class='macro'>LOCK_INIT<span class='macro_popup'>{ ((void*)0) }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">		<span class='macro'>hold_locked_index(&amp;lock, LOCK_DIE_ON_ERROR)<span class='macro_popup'>repo_hold_locked_index(the_repository, (&amp;lock), (1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">		<span class='keyword'>if</span> (reset_type == MIXED) {</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">			<span class='keyword'>int</span> flags = quiet ? <span class='macro'>REFRESH_QUIET<span class='macro_popup'>0x0004</span></span> : <span class='macro'>REFRESH_IN_PORCELAIN<span class='macro_popup'>0x0020</span></span>;</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">			<span class='keyword'>if</span> (read_from_tree(&amp;pathspec, &amp;oid, intent_to_add))</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">				<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">			the_index.updated_skipworktree = 1;</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">			<span class='keyword'>if</span> (!quiet &amp;&amp; get_git_work_tree()) {</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">				uint64_t t_begin, t_delta_in_ms;</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">				t_begin = getnanotime();</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">				refresh_index(&amp;the_index, flags, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">					      _(<span class='string_literal'>"Unstaged changes after reset:"</span>));</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">				t_delta_in_ms = (getnanotime() - t_begin) / 1000000;</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">				<span class='keyword'>if</span> (advice_reset_quiet_warning &amp;&amp; t_delta_in_ms &gt; <span class='macro'>REFRESH_INDEX_DELAY_WARNING_IN_MS<span class='macro_popup'>(2 * 1000)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">					printf(_(<span class='string_literal'>"\nIt took %.2f seconds to enumerate unstaged changes after reset.  You can\n"</span></td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">						<span class='string_literal'>"use '--quiet' to avoid this.  Set the config setting reset.quiet to true\n"</span></td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">						<span class='string_literal'>"to make this the default.\n"</span>), t_delta_in_ms / 1000.0);</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">				}</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">			<span class='keyword'>struct</span> object_id dummy;</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">			<span class='keyword'>char</span> *ref = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">			<span class='keyword'>int</span> err;</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">			dwim_ref(rev, strlen(rev), &amp;dummy, &amp;ref, 0);</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">			<span class='keyword'>if</span> (ref &amp;&amp; !starts_with(ref, <span class='string_literal'>"refs/"</span>))</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">				ref = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">			err = reset_index(ref, &amp;oid, reset_type, quiet);</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">			<span class='keyword'>if</span> (reset_type == KEEP &amp;&amp; !err)</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">				err = reset_index(ref, &amp;oid, MIXED, quiet);</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">			<span class='keyword'>if</span> (err)</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">				die(_(<span class='string_literal'>"Could not reset index file to revision '%s'."</span>), rev);</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">			free(ref);</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">		<span class='keyword'>if</span> (write_locked_index(&amp;the_index, &amp;lock, <span class='macro'>COMMIT_LOCK<span class='macro_popup'>(1 &lt;&lt; 0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">			die(_(<span class='string_literal'>"Could not write new index file."</span>));</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">	<span class='keyword'>if</span> (!pathspec.nr &amp;&amp; !unborn) {</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">		<span class='comment'>/* Any resets without paths update HEAD to the head being</span></td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">		 <span class='comment'>* switched to, saving the previous head in ORIG_HEAD before. */</span></td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">		update_ref_status = reset_refs(rev, &amp;oid);</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">		<span class='keyword'>if</span> (reset_type == HARD &amp;&amp; !update_ref_status &amp;&amp; !quiet)</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">			print_new_head_line(lookup_commit_reference(the_repository, &amp;oid));</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">	<span class='keyword'>if</span> (!pathspec.nr)</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">		remove_branch_state(the_repository, 0);</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">	<span class='keyword'>return</span> update_ref_status;</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">}</td></tr>
</table></body></html>
