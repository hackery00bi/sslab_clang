<!doctype html>
<html>
<head>
<title>builtin/branch.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memset' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/real/c_git/git/builtin/branch.c -->

<!-- FILENAME branch.c -->

<!-- FUNCTIONNAME print_ref_list -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT ec2e2a9e72104545e50021ba0e042837 -->

<!-- BUGLINE 417 -->

<!-- BUGCOLUMN 2 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>builtin/branch.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 417, column 2</a><br />Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name branch.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I . -D HAVE_SYSINFO -D GIT_HOST_CPU="x86_64" -D HAVE_ALLOCA_H -D USE_CURL_FOR_IMAP_SEND -D SHA1_DC -D SHA1DC_NO_STANDARD_INCLUDES -D SHA1DC_INIT_SAFE_HASH_DEFAULT=0 -D SHA1DC_CUSTOM_INCLUDE_SHA1_C="cache.h" -D SHA1DC_CUSTOM_INCLUDE_UBC_CHECK_C="git-compat-util.h" -D SHA256_BLK -D HAVE_PATHS_H -D HAVE_DEV_TTY -D HAVE_CLOCK_GETTIME -D HAVE_CLOCK_MONOTONIC -D HAVE_GETDELIM -D PROCFS_EXECUTABLE_PATH="/proc/self/exe" -D FREAD_READS_DIRECTORIES -D NO_STRLCPY -D SHELL_PATH="/bin/sh" -D PAGER_ENV="LESS=FRX LV=-c" -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -fdebug-compilation-dir /tmp/real/c_git/git -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker deadcode -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-19-144418-19857-1 -x c builtin/branch.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"417": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>* Builtin "git branch"</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> <span class='comment'>* Copyright (c) 2006 Kristian HÃ¸gsberg &lt;krh@redhat.com&gt;</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> <span class='comment'>* Based on git-branch.sh by Junio C Hamano.</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#include "cache.h"</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include "config.h"</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include "color.h"</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include "refs.h"</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include "commit.h"</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include "builtin.h"</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include "remote.h"</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include "parse-options.h"</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "branch.h"</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include "diff.h"</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include "revision.h"</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include "string-list.h"</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "column.h"</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include "utf8.h"</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include "wt-status.h"</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include "ref-filter.h"</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include "worktree.h"</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include "help.h"</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include "commit-reach.h"</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> builtin_branch_usage[] = {</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] [-r | -a] [--merged] [--no-merged]"</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] [-r | -a] [--merged] [--no-merged]"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] [-l] [-f] &lt;branch-name&gt; [&lt;start-point&gt;]"</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] [-l] [-f] &lt;branch-name&gt; [&lt;start-point&gt;]"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] [-r] (-d | -D) &lt;branch-name&gt;..."</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] [-r] (-d | -D) &lt;branch-name&gt;..."<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] (-m | -M) [&lt;old-branch&gt;] &lt;new-branch&gt;"</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] (-m | -M) [&lt;old-branch&gt;] &lt;new-branch&gt;"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] (-c | -C) [&lt;old-branch&gt;] &lt;new-branch&gt;"</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] (-c | -C) [&lt;old-branch&gt;] &lt;new-branch&gt;"<br>)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] [-r | -a] [--points-at]"</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] [-r | -a] [--points-at]")</span></span>,</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">	<span class='macro'>N_(<span class='string_literal'>"git branch [&lt;options&gt;] [-r | -a] [--format]"</span>)<span class='macro_popup'>("git branch [&lt;options&gt;] [-r | -a] [--format]")</span></span>,</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">	<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *head;</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> object_id head_oid;</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> branch_use_color = -1;</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> branch_colors[][<span class='macro'>COLOR_MAXLEN<span class='macro_popup'>75</span></span>] = {</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">	<span class='macro'>GIT_COLOR_RESET<span class='macro_popup'>"\033[m"</span></span>,</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">	<span class='macro'>GIT_COLOR_NORMAL<span class='macro_popup'>""</span></span>,       <span class='comment'>/* PLAIN */</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">	<span class='macro'>GIT_COLOR_RED<span class='macro_popup'>"\033[31m"</span></span>,          <span class='comment'>/* REMOTE */</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">	<span class='macro'>GIT_COLOR_NORMAL<span class='macro_popup'>""</span></span>,       <span class='comment'>/* LOCAL */</span></td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">	<span class='macro'>GIT_COLOR_GREEN<span class='macro_popup'>"\033[32m"</span></span>,        <span class='comment'>/* CURRENT */</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">	<span class='macro'>GIT_COLOR_BLUE<span class='macro_popup'>"\033[34m"</span></span>,         <span class='comment'>/* UPSTREAM */</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">	<span class='macro'>GIT_COLOR_CYAN<span class='macro_popup'>"\033[36m"</span></span>,         <span class='comment'>/* WORKTREE */</span></td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"><span class='keyword'>enum</span> color_branch {</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">	BRANCH_COLOR_RESET = 0,</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">	BRANCH_COLOR_PLAIN = 1,</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">	BRANCH_COLOR_REMOTE = 2,</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">	BRANCH_COLOR_LOCAL = 3,</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">	BRANCH_COLOR_CURRENT = 4,</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">	BRANCH_COLOR_UPSTREAM = 5,</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">	BRANCH_COLOR_WORKTREE = 6</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *color_branch_slots[] = {</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">	[BRANCH_COLOR_RESET]	= <span class='string_literal'>"reset"</span>,</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">	[BRANCH_COLOR_PLAIN]	= <span class='string_literal'>"plain"</span>,</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">	[BRANCH_COLOR_REMOTE]	= <span class='string_literal'>"remote"</span>,</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">	[BRANCH_COLOR_LOCAL]	= <span class='string_literal'>"local"</span>,</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">	[BRANCH_COLOR_CURRENT]	= <span class='string_literal'>"current"</span>,</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">	[BRANCH_COLOR_UPSTREAM] = <span class='string_literal'>"upstream"</span>,</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">	[BRANCH_COLOR_WORKTREE] = <span class='string_literal'>"worktree"</span>,</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> string_list output = <span class='macro'>STRING_LIST_INIT_DUP<span class='macro_popup'>{ ((void*)0), 0, 0, 1, ((void*)0) }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> colopts;</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line"><span class='macro'>define_list_config_array(color_branch_slots)<span class='macro_popup'>void list_config_color_branch_slots(struct string_list *list,<br> const char *prefix) { int i; for (i = 0; i &lt; (sizeof(color_branch_slots<br>) / sizeof((color_branch_slots)[0]) + (sizeof(char [1 - 2*!(!<br>__builtin_types_compatible_p(__typeof__(color_branch_slots), __typeof__<br>(&amp;(color_branch_slots)[0])))]) - 1)); i++) if (color_branch_slots<br>[i]) list_config_item(list, prefix, color_branch_slots[i]); }<br> struct string_list</span></span>;</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> git_branch_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *slot_name;</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">	<span class='keyword'>struct</span> ref_sorting **sorting_tail = (<span class='keyword'>struct</span> ref_sorting **)cb;</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"branch.sort"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">		<span class='keyword'>if</span> (!value)</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>config_error_nonbool(var)<span class='macro_popup'>(config_error_nonbool(var), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">		parse_ref_sorting(sorting_tail, value);</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">	<span class='keyword'>if</span> (starts_with(var, <span class='string_literal'>"column."</span>))</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">		<span class='keyword'>return</span> git_column_config(var, value, <span class='string_literal'>"branch"</span>, &amp;colopts);</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"color.branch"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">		branch_use_color = git_config_colorbool(var, value);</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">	<span class='keyword'>if</span> (skip_prefix(var, <span class='string_literal'>"color.branch."</span>, &amp;slot_name)) {</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">		<span class='keyword'>int</span> slot = <span class='macro'>LOOKUP_CONFIG(color_branch_slots, slot_name)<span class='macro_popup'>lookup_config(color_branch_slots, (sizeof(color_branch_slots)<br> / sizeof((color_branch_slots)[0]) + (sizeof(char [1 - 2*!(!__builtin_types_compatible_p<br>(__typeof__(color_branch_slots), __typeof__(&amp;(color_branch_slots<br>)[0])))]) - 1)), slot_name)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">		<span class='keyword'>if</span> (slot &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">		<span class='keyword'>if</span> (!value)</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>config_error_nonbool(var)<span class='macro_popup'>(config_error_nonbool(var), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">		<span class='keyword'>return</span> color_parse(value, branch_colors[slot]);</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">	<span class='keyword'>return</span> git_color_default_config(var, value, cb);</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *branch_get_color(<span class='keyword'>enum</span> color_branch ix)</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>want_color(branch_use_color)<span class='macro_popup'>want_color_fd(1, (branch_use_color))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">		<span class='keyword'>return</span> branch_colors[ix];</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">	<span class='keyword'>return</span> <span class='string_literal'>""</span>;</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> branch_merged(<span class='keyword'>int</span> kind, <span class='keyword'>const</span> <span class='keyword'>char</span> *name,</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">			 <span class='keyword'>struct</span> commit *rev, <span class='keyword'>struct</span> commit *head_rev)</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">	 <span class='comment'>* This checks whether the merge bases of branch and HEAD (or</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">	 <span class='comment'>* the other branch this branch builds upon) contains the</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">	 <span class='comment'>* branch, which means that the branch has already been merged</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">	 <span class='comment'>* safely to HEAD (or the other branch).</span></td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">	<span class='keyword'>struct</span> commit *reference_rev = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reference_name = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">	<span class='keyword'>void</span> *reference_name_to_free = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">	<span class='keyword'>int</span> merged;</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">	<span class='keyword'>if</span> (kind == <span class='macro'>FILTER_REFS_BRANCHES<span class='macro_popup'>0x0004</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">		<span class='keyword'>struct</span> branch *branch = branch_get(name);</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *upstream = branch_get_upstream(branch, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">		<span class='keyword'>struct</span> object_id oid;</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">		<span class='keyword'>if</span> (upstream &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">		    (reference_name = reference_name_to_free =</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">		     resolve_refdup(upstream, <span class='macro'>RESOLVE_REF_READING<span class='macro_popup'>0x01</span></span>,</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">				    &amp;oid, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)) != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">			reference_rev = lookup_commit_reference(the_repository,</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">								&amp;oid);</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">	<span class='keyword'>if</span> (!reference_rev)</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">		reference_rev = head_rev;</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">	merged = <span class='macro'>in_merge_bases(rev, reference_rev)<span class='macro_popup'>repo_in_merge_bases(the_repository, rev, reference_rev)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">	 <span class='comment'>* After the safety valve is fully redefined to "check with</span></td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">	 <span class='comment'>* upstream, if any, otherwise with HEAD", we should just</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">	 <span class='comment'>* return the result of the in_merge_bases() above without</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">	 <span class='comment'>* any of the following code, but during the transition period,</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">	 <span class='comment'>* a gentle reminder is in order.</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">	<span class='keyword'>if</span> ((head_rev != reference_rev) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">	    <span class='macro'>in_merge_bases(rev, head_rev)<span class='macro_popup'>repo_in_merge_bases(the_repository, rev, head_rev)</span></span> != merged) {</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">		<span class='keyword'>if</span> (merged)</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">			warning(_(<span class='string_literal'>"deleting branch '%s' that has been merged to\n"</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">				<span class='string_literal'>"         '%s', but not yet merged to HEAD."</span>),</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">				name, reference_name);</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">			warning(_(<span class='string_literal'>"not deleting branch '%s' that is not yet merged to\n"</span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">				<span class='string_literal'>"         '%s', even though it is merged to HEAD."</span>),</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">				name, reference_name);</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">	free(reference_name_to_free);</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">	<span class='keyword'>return</span> merged;</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> check_branch_commit(<span class='keyword'>const</span> <span class='keyword'>char</span> *branchname, <span class='keyword'>const</span> <span class='keyword'>char</span> *refname,</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">			       <span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid, <span class='keyword'>struct</span> commit *head_rev,</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">			       <span class='keyword'>int</span> kinds, <span class='keyword'>int</span> force)</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">	<span class='keyword'>struct</span> commit *rev = lookup_commit_reference(the_repository, oid);</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">	<span class='keyword'>if</span> (!rev) {</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">		<span class='macro'>error(_(<span class='string_literal'>"Couldn't look up commit object for '%s'"</span>), refname)<span class='macro_popup'>(error(_("Couldn't look up commit object for '%s'"), refname)<br>, const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">	<span class='keyword'>if</span> (!force &amp;&amp; !branch_merged(kinds, branchname, rev, head_rev)) {</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">		<span class='macro'>error(_(<span class='string_literal'>"The branch '%s' is not fully merged.\n"<span class='macro_popup'>(error(_("The branch '%s' is not fully merged.\n" "If you are sure you want to delete it, "<br> "run 'git branch -D %s'."), branchname, branchname), const_error<br>())</span></span></span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">		      <span class='string_literal'><span class='macro'>"If you are sure you want to delete it, "<span class='macro_popup'>(error(_("The branch '%s' is not fully merged.\n" "If you are sure you want to delete it, "<br> "run 'git branch -D %s'."), branchname, branchname), const_error<br>())</span></span></span></td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">		      <span class='string_literal'><span class='macro'>"run 'git branch -D %s'."</span>), branchname, branchname)<span class='macro_popup'>(error(_("The branch '%s' is not fully merged.\n" "If you are sure you want to delete it, "<br> "run 'git branch -D %s'."), branchname, branchname), const_error<br>())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> delete_branch_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *branchname)</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">	strbuf_addf(&amp;buf, <span class='string_literal'>"branch.%s"</span>, branchname);</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">	<span class='keyword'>if</span> (git_config_rename_section(buf.buf, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">		warning(_(<span class='string_literal'>"Update of config-file failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">	strbuf_release(&amp;buf);</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> delete_branches(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>int</span> force, <span class='keyword'>int</span> kinds,</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">			   <span class='keyword'>int</span> quiet)</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">	<span class='keyword'>struct</span> commit *head_rev = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">	<span class='keyword'>struct</span> object_id oid;</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">	<span class='keyword'>char</span> *name = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *fmt;</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">	<span class='keyword'>int</span> ret = 0;</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">	<span class='keyword'>int</span> remote_branch = 0;</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">	<span class='keyword'>struct</span> strbuf bname = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">	<span class='keyword'>unsigned</span> allowed_interpret;</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">	<span class='keyword'>switch</span> (kinds) {</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>FILTER_REFS_REMOTES<span class='macro_popup'>0x0008</span></span>:</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">		fmt = <span class='string_literal'>"refs/remotes/%s"</span>;</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">		<span class='comment'>/* For subsequent UI messages */</span></td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">		remote_branch = 1;</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">		allowed_interpret = <span class='macro'>INTERPRET_BRANCH_REMOTE<span class='macro_popup'>(1&lt;&lt;1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">		force = 1;</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>FILTER_REFS_BRANCHES<span class='macro_popup'>0x0004</span></span>:</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">		fmt = <span class='string_literal'>"refs/heads/%s"</span>;</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">		allowed_interpret = <span class='macro'>INTERPRET_BRANCH_LOCAL<span class='macro_popup'>(1&lt;&lt;0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">		die(_(<span class='string_literal'>"cannot use -a with -d"</span>));</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">	<span class='keyword'>if</span> (!force) {</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">		head_rev = lookup_commit_reference(the_repository, &amp;head_oid);</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">		<span class='keyword'>if</span> (!head_rev)</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">			die(_(<span class='string_literal'>"Couldn't look up commit object for HEAD"</span>));</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; argc; i++, <span class='macro'>strbuf_reset(&amp;bname)<span class='macro_popup'>strbuf_setlen(&amp;bname, 0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">		<span class='keyword'>char</span> *target = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">		<span class='keyword'>int</span> flags = 0;</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">		strbuf_branchname(&amp;bname, argv[i], allowed_interpret);</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">		free(name);</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">		name = mkpathdup(fmt, bname.buf);</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">		<span class='keyword'>if</span> (kinds == <span class='macro'>FILTER_REFS_BRANCHES<span class='macro_popup'>0x0004</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">			<span class='keyword'>const</span> <span class='keyword'>struct</span> worktree *wt =</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">				find_shared_symref(<span class='string_literal'>"HEAD"</span>, name);</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">			<span class='keyword'>if</span> (wt) {</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">				<span class='macro'>error(_(<span class='string_literal'>"Cannot delete branch '%s' "<span class='macro_popup'>(error(_("Cannot delete branch '%s' " "checked out at '%s'"),<br> bname.buf, wt-&gt;path), const_error())</span></span></span></td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">					<span class='string_literal'><span class='macro'>"checked out at '%s'"</span>),<span class='macro_popup'>(error(_("Cannot delete branch '%s' " "checked out at '%s'"),<br> bname.buf, wt-&gt;path), const_error())</span></span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">				      <span class='macro'>bname.buf, wt-&gt;path)<span class='macro_popup'>(error(_("Cannot delete branch '%s' " "checked out at '%s'"),<br> bname.buf, wt-&gt;path), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">				ret = 1;</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">		target = resolve_refdup(name,</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">					<span class='macro'>RESOLVE_REF_READING<span class='macro_popup'>0x01</span></span></td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">					| <span class='macro'>RESOLVE_REF_NO_RECURSE<span class='macro_popup'>0x02</span></span></td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">					| <span class='macro'>RESOLVE_REF_ALLOW_BAD_NAME<span class='macro_popup'>0x04</span></span>,</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">					&amp;oid, &amp;flags);</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">		<span class='keyword'>if</span> (!target) {</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">			<span class='macro'>error(remote_branch<span class='macro_popup'>(error(remote_branch ? _("remote-tracking branch '%s' not found."<br>) : _("branch '%s' not found."), bname.buf), const_error())</span></span></td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">			      <span class='macro'>? _(<span class='string_literal'>"remote-tracking branch '%s' not found."</span>)<span class='macro_popup'>(error(remote_branch ? _("remote-tracking branch '%s' not found."<br>) : _("branch '%s' not found."), bname.buf), const_error())</span></span></td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">			      <span class='macro'>: _(<span class='string_literal'>"branch '%s' not found."</span>), bname.buf)<span class='macro_popup'>(error(remote_branch ? _("remote-tracking branch '%s' not found."<br>) : _("branch '%s' not found."), bname.buf), const_error())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">			ret = 1;</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">		<span class='keyword'>if</span> (!(flags &amp; (<span class='macro'>REF_ISSYMREF<span class='macro_popup'>0x01</span></span>|<span class='macro'>REF_ISBROKEN<span class='macro_popup'>0x04</span></span>)) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">		    check_branch_commit(bname.buf, name, &amp;oid, head_rev, kinds,</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">					force)) {</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">			ret = 1;</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">			<span class='keyword'>goto</span> next;</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">		<span class='keyword'>if</span> (delete_ref(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, name, is_null_oid(&amp;oid) ? <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> : &amp;oid,</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">			       <span class='macro'>REF_NO_DEREF<span class='macro_popup'>(1 &lt;&lt; 0)</span></span>)) {</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">			<span class='macro'>error(remote_branch<span class='macro_popup'>(error(remote_branch ? _("Error deleting remote-tracking branch '%s'"<br>) : _("Error deleting branch '%s'"), bname.buf), const_error(<br>))</span></span></td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">			      <span class='macro'>? _(<span class='string_literal'>"Error deleting remote-tracking branch '%s'"</span>)<span class='macro_popup'>(error(remote_branch ? _("Error deleting remote-tracking branch '%s'"<br>) : _("Error deleting branch '%s'"), bname.buf), const_error(<br>))</span></span></td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">			      <span class='macro'>: _(<span class='string_literal'>"Error deleting branch '%s'"</span>),<span class='macro_popup'>(error(remote_branch ? _("Error deleting remote-tracking branch '%s'"<br>) : _("Error deleting branch '%s'"), bname.buf), const_error(<br>))</span></span></td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">			      <span class='macro'>bname.buf)<span class='macro_popup'>(error(remote_branch ? _("Error deleting remote-tracking branch '%s'"<br>) : _("Error deleting branch '%s'"), bname.buf), const_error(<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">			ret = 1;</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">			<span class='keyword'>goto</span> next;</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">		<span class='keyword'>if</span> (!quiet) {</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">			printf(remote_branch</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">			       ? _(<span class='string_literal'>"Deleted remote-tracking branch %s (was %s).\n"</span>)</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">			       : _(<span class='string_literal'>"Deleted branch %s (was %s).\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">			       bname.buf,</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">			       (flags &amp; <span class='macro'>REF_ISBROKEN<span class='macro_popup'>0x04</span></span>) ? <span class='string_literal'>"broken"</span></td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">			       : (flags &amp; <span class='macro'>REF_ISSYMREF<span class='macro_popup'>0x01</span></span>) ? target</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">			       : <span class='macro'>find_unique_abbrev(&amp;oid, DEFAULT_ABBREV)<span class='macro_popup'>repo_find_unique_abbrev(the_repository, &amp;oid, default_abbrev<br>)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">		delete_branch_config(bname.buf);</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">	next:</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">		free(target);</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">	free(name);</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">	strbuf_release(&amp;bname);</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> calc_maxwidth(<span class='keyword'>struct</span> ref_array *refs, <span class='keyword'>int</span> remote_bonus)</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">	<span class='keyword'>int</span> i, max = 0;</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; refs-&gt;nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">		<span class='keyword'>struct</span> ref_array_item *it = refs-&gt;items[i];</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *desc = it-&gt;refname;</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">		<span class='keyword'>int</span> w;</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">		skip_prefix(it-&gt;refname, <span class='string_literal'>"refs/heads/"</span>, &amp;desc);</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">		skip_prefix(it-&gt;refname, <span class='string_literal'>"refs/remotes/"</span>, &amp;desc);</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">		<span class='keyword'>if</span> (it-&gt;kind == <span class='macro'>FILTER_REFS_DETACHED_HEAD<span class='macro_popup'>0x0020</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">			<span class='keyword'>char</span> *head_desc = get_head_description();</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">			w = utf8_strwidth(head_desc);</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">			free(head_desc);</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">		} <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">			w = utf8_strwidth(desc);</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">		<span class='keyword'>if</span> (it-&gt;kind == <span class='macro'>FILTER_REFS_REMOTES<span class='macro_popup'>0x0008</span></span>)</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">			w += remote_bonus;</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">		<span class='keyword'>if</span> (w &gt; max)</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">			max = w;</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">	<span class='keyword'>return</span> max;</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *quote_literal_for_format(<span class='keyword'>const</span> <span class='keyword'>char</span> *s)</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">	<span class='macro'>strbuf_reset(&amp;buf)<span class='macro_popup'>strbuf_setlen(&amp;buf, 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">	<span class='keyword'>while</span> (*s) {</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *ep = strchrnul(s, '%');</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">		<span class='keyword'>if</span> (s &lt; ep)</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">			strbuf_add(&amp;buf, s, ep - s);</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">		<span class='keyword'>if</span> (*ep == '%') {</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">			strbuf_addstr(&amp;buf, <span class='string_literal'>"%%"</span>);</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">			s = ep + 1;</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">			s = ep;</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">	<span class='keyword'>return</span> buf.buf;</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *build_format(<span class='keyword'>struct</span> ref_filter *filter, <span class='keyword'>int</span> maxwidth, <span class='keyword'>const</span> <span class='keyword'>char</span> *remote_prefix)</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">	<span class='keyword'>struct</span> strbuf fmt = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">	<span class='keyword'>struct</span> strbuf local = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">	<span class='keyword'>struct</span> strbuf remote = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">	strbuf_addf(&amp;local, <span class='string_literal'>"%%(if)%%(HEAD)%%(then)* %s%%(else)%%(if)%%(worktreepath)%%(then)+ %s%%(else)  %s%%(end)%%(end)"</span>,</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">			branch_get_color(BRANCH_COLOR_CURRENT),</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">			branch_get_color(BRANCH_COLOR_WORKTREE),</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">			branch_get_color(BRANCH_COLOR_LOCAL));</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">	strbuf_addf(&amp;remote, <span class='string_literal'>"  %s"</span>,</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">		    branch_get_color(BRANCH_COLOR_REMOTE));</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">	<span class='keyword'>if</span> (filter-&gt;verbose) {</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">		<span class='keyword'>struct</span> strbuf obname = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">		<span class='keyword'>if</span> (filter-&gt;abbrev &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">			strbuf_addf(&amp;obname, <span class='string_literal'>"%%(objectname:short)"</span>);</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!filter-&gt;abbrev)</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">			strbuf_addf(&amp;obname, <span class='string_literal'>"%%(objectname)"</span>);</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">			strbuf_addf(&amp;obname, <span class='string_literal'>"%%(objectname:short=%d)"</span>, filter-&gt;abbrev);</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">		strbuf_addf(&amp;local, <span class='string_literal'>"%%(align:%d,left)%%(refname:lstrip=2)%%(end)"</span>, maxwidth);</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">		strbuf_addstr(&amp;local, branch_get_color(BRANCH_COLOR_RESET));</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">		strbuf_addf(&amp;local, <span class='string_literal'>" %s "</span>, obname.buf);</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">		<span class='keyword'>if</span> (filter-&gt;verbose &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">			strbuf_addf(&amp;local, <span class='string_literal'>"%%(if:notequals=*)%%(HEAD)%%(then)%%(if)%%(worktreepath)%%(then)(%s%%(worktreepath)%s) %%(end)%%(end)"</span>,</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">				    branch_get_color(BRANCH_COLOR_WORKTREE), branch_get_color(BRANCH_COLOR_RESET));</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">			strbuf_addf(&amp;local, <span class='string_literal'>"%%(if)%%(upstream)%%(then)[%s%%(upstream:short)%s%%(if)%%(upstream:track)"</span></td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">				    <span class='string_literal'>"%%(then): %%(upstream:track,nobracket)%%(end)] %%(end)%%(contents:subject)"</span>,</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">				    branch_get_color(BRANCH_COLOR_UPSTREAM), branch_get_color(BRANCH_COLOR_RESET));</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">			strbuf_addf(&amp;local, <span class='string_literal'>"%%(if)%%(upstream:track)%%(then)%%(upstream:track) %%(end)%%(contents:subject)"</span>);</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">		strbuf_addf(&amp;remote, <span class='string_literal'>"%%(align:%d,left)%s%%(refname:lstrip=2)%%(end)%s"</span></td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">			    <span class='string_literal'>"%%(if)%%(symref)%%(then) -&gt; %%(symref:short)"</span></td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">			    <span class='string_literal'>"%%(else) %s %%(contents:subject)%%(end)"</span>,</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">			    maxwidth, quote_literal_for_format(remote_prefix),</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">			    branch_get_color(BRANCH_COLOR_RESET), obname.buf);</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">		strbuf_release(&amp;obname);</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">		strbuf_addf(&amp;local, <span class='string_literal'>"%%(refname:lstrip=2)%s%%(if)%%(symref)%%(then) -&gt; %%(symref:short)%%(end)"</span>,</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">			    branch_get_color(BRANCH_COLOR_RESET));</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">		strbuf_addf(&amp;remote, <span class='string_literal'>"%s%%(refname:lstrip=2)%s%%(if)%%(symref)%%(then) -&gt; %%(symref:short)%%(end)"</span>,</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">			    quote_literal_for_format(remote_prefix),</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">			    branch_get_color(BRANCH_COLOR_RESET));</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">	strbuf_addf(&amp;fmt, <span class='string_literal'>"%%(if:notequals=refs/remotes)%%(refname:rstrip=-2)%%(then)%s%%(else)%s%%(end)"</span>, local.buf, remote.buf);</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">	strbuf_release(&amp;local);</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">	strbuf_release(&amp;remote);</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">	<span class='keyword'>return</span> strbuf_detach(&amp;fmt, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> print_ref_list(<span class='keyword'>struct</span> ref_filter *filter, <span class='keyword'>struct</span> ref_sorting *sorting, <span class='keyword'>struct</span> ref_format *format)</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">	<span class='keyword'>struct</span> ref_array array;</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">	<span class='keyword'>int</span> maxwidth = 0;</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *remote_prefix = <span class='string_literal'>""</span>;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">	<span class='keyword'>char</span> *to_free = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">	 <span class='comment'>* If we are listing more than just remote branches,</span></td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">	 <span class='comment'>* then remote branches will have a "remotes/" prefix.</span></td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">	 <span class='comment'>* We need to account for this in the width.</span></td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">	<span class='keyword'>if</span> (filter-&gt;kind != <span class='macro'>FILTER_REFS_REMOTES<span class='macro_popup'>0x0008</span></span>)</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">		remote_prefix = <span class='string_literal'>"remotes/"</span>;</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">	<span class="mrange">memset</span>(&amp;array, 0, <span class='keyword'>sizeof</span>(array));</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:9ex; max-width:58em">Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">	filter_refs(&amp;array, filter, filter-&gt;kind | <span class='macro'>FILTER_REFS_INCLUDE_BROKEN<span class='macro_popup'>0x0001</span></span>);</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">	<span class='keyword'>if</span> (filter-&gt;verbose)</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">		maxwidth = calc_maxwidth(&amp;array, strlen(remote_prefix));</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">	<span class='keyword'>if</span> (!format-&gt;format)</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">		format-&gt;format = to_free = build_format(filter, maxwidth, remote_prefix);</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">	format-&gt;use_color = branch_use_color;</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">	<span class='keyword'>if</span> (verify_ref_format(format))</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">		die(_(<span class='string_literal'>"unable to parse format string"</span>));</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">	ref_array_sort(sorting, &amp;array);</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; array.nr; i++) {</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">		<span class='keyword'>struct</span> strbuf out = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">		<span class='keyword'>struct</span> strbuf err = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">		<span class='keyword'>if</span> (format_ref_array_item(array.items[i], format, &amp;out, &amp;err))</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">			die(<span class='string_literal'>"%s"</span>, err.buf);</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">		<span class='keyword'>if</span> (column_active(colopts)) {</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">			<span class='macro'>assert(!filter-&gt;verbose &amp;&amp; <span class='string_literal'>"--column and --verbose are incompatible"</span>)<span class='macro_popup'>((void) sizeof ((!filter-&gt;verbose &amp;&amp; "--column and --verbose are incompatible"<br>) ? 1 : 0), __extension__ ({ if (!filter-&gt;verbose &amp;&amp;<br> "--column and --verbose are incompatible") ; else __assert_fail<br> ("!filter-&gt;verbose &amp;&amp; \"--column and --verbose are incompatible\""<br>, "builtin/branch.c", 439, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">			 <span class='comment'>/* format to a string_list to let print_columns() do its job */</span></td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">			string_list_append(&amp;output, out.buf);</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">			fwrite(out.buf, 1, out.len, <span class='macro'>stdout<span class='macro_popup'>stdout</span></span>);</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">			putchar('\n');</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">		strbuf_release(&amp;err);</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">		strbuf_release(&amp;out);</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">	ref_array_clear(&amp;array);</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">	free(to_free);</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> print_current_branch_name(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">	<span class='keyword'>int</span> flags;</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *refname = resolve_ref_unsafe(<span class='string_literal'>"HEAD"</span>, 0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;flags);</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *shortname;</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">	<span class='keyword'>if</span> (!refname)</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">		die(_(<span class='string_literal'>"could not resolve HEAD"</span>));</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!(flags &amp; <span class='macro'>REF_ISSYMREF<span class='macro_popup'>0x01</span></span>))</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(refname, <span class='string_literal'>"refs/heads/"</span>, &amp;shortname))</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">		puts(shortname);</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">		die(_(<span class='string_literal'>"HEAD (%s) points outside of refs/heads/"</span>), refname);</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> reject_rebase_or_bisect_branch(<span class='keyword'>const</span> <span class='keyword'>char</span> *target)</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">	<span class='keyword'>struct</span> worktree **worktrees = get_worktrees();</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">	<span class='keyword'>for</span> (i = 0; worktrees[i]; i++) {</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">		<span class='keyword'>struct</span> worktree *wt = worktrees[i];</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">		<span class='keyword'>if</span> (!wt-&gt;is_detached)</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">		<span class='keyword'>if</span> (is_worktree_being_rebased(wt, target))</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">			die(_(<span class='string_literal'>"Branch %s is being rebased at %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">			    target, wt-&gt;path);</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">		<span class='keyword'>if</span> (is_worktree_being_bisected(wt, target))</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">			die(_(<span class='string_literal'>"Branch %s is being bisected at %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">			    target, wt-&gt;path);</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">	free_worktrees(worktrees);</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> copy_or_rename_branch(<span class='keyword'>const</span> <span class='keyword'>char</span> *oldname, <span class='keyword'>const</span> <span class='keyword'>char</span> *newname, <span class='keyword'>int</span> copy, <span class='keyword'>int</span> force)</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">	<span class='keyword'>struct</span> strbuf oldref = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>, newref = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>, logmsg = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">	<span class='keyword'>struct</span> strbuf oldsection = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>, newsection = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *interpreted_oldname = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *interpreted_newname = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">	<span class='keyword'>int</span> recovery = 0;</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">	<span class='keyword'>if</span> (!oldname) {</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">		<span class='keyword'>if</span> (copy)</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">			die(_(<span class='string_literal'>"cannot copy the current branch while not on any."</span>));</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">			die(_(<span class='string_literal'>"cannot rename the current branch while not on any."</span>));</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">	<span class='keyword'>if</span> (strbuf_check_branch_ref(&amp;oldref, oldname)) {</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">		 <span class='comment'>* Bad name --- this could be an attempt to rename a</span></td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">		 <span class='comment'>* ref that we used to allow to be created by accident.</span></td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">		<span class='keyword'>if</span> (ref_exists(oldref.buf))</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">			recovery = 1;</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">			die(_(<span class='string_literal'>"Invalid branch name: '%s'"</span>), oldname);</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">	 <span class='comment'>* A command like "git branch -M currentbranch currentbranch" cannot</span></td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">	 <span class='comment'>* cause the worktree to become inconsistent with HEAD, so allow it.</span></td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">	<span class='keyword'>if</span> (!strcmp(oldname, newname))</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">		validate_branchname(newname, &amp;newref);</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">		validate_new_branchname(newname, &amp;newref, force);</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">	reject_rebase_or_bisect_branch(oldref.buf);</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">	<span class='keyword'>if</span> (!skip_prefix(oldref.buf, <span class='string_literal'>"refs/heads/"</span>, &amp;interpreted_oldname) ||</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">	    !skip_prefix(newref.buf, <span class='string_literal'>"refs/heads/"</span>, &amp;interpreted_newname)) {</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">		<span class='macro'>BUG(<span class='string_literal'>"expected prefix missing for refs"</span>)<span class='macro_popup'>BUG_fl("builtin/branch.c", 531, "expected prefix missing for refs"<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">	<span class='keyword'>if</span> (copy)</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">		strbuf_addf(&amp;logmsg, <span class='string_literal'>"Branch: copied %s to %s"</span>,</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">			    oldref.buf, newref.buf);</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">		strbuf_addf(&amp;logmsg, <span class='string_literal'>"Branch: renamed %s to %s"</span>,</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">			    oldref.buf, newref.buf);</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">	<span class='keyword'>if</span> (!copy &amp;&amp; rename_ref(oldref.buf, newref.buf, logmsg.buf))</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">		die(_(<span class='string_literal'>"Branch rename failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">	<span class='keyword'>if</span> (copy &amp;&amp; copy_existing_ref(oldref.buf, newref.buf, logmsg.buf))</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">		die(_(<span class='string_literal'>"Branch copy failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">	<span class='keyword'>if</span> (recovery) {</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">		<span class='keyword'>if</span> (copy)</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">			warning(_(<span class='string_literal'>"Created a copy of a misnamed branch '%s'"</span>),</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">				interpreted_oldname);</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">			warning(_(<span class='string_literal'>"Renamed a misnamed branch '%s' away"</span>),</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">				interpreted_oldname);</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">	<span class='keyword'>if</span> (!copy &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">	    replace_each_worktree_head_symref(oldref.buf, newref.buf, logmsg.buf))</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">		die(_(<span class='string_literal'>"Branch renamed to %s, but HEAD is not updated!"</span>), newname);</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">	strbuf_release(&amp;logmsg);</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">	strbuf_addf(&amp;oldsection, <span class='string_literal'>"branch.%s"</span>, interpreted_oldname);</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">	strbuf_release(&amp;oldref);</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">	strbuf_addf(&amp;newsection, <span class='string_literal'>"branch.%s"</span>, interpreted_newname);</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">	strbuf_release(&amp;newref);</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">	<span class='keyword'>if</span> (!copy &amp;&amp; git_config_rename_section(oldsection.buf, newsection.buf) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">		die(_(<span class='string_literal'>"Branch is renamed, but update of config-file failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">	<span class='keyword'>if</span> (copy &amp;&amp; strcmp(oldname, newname) &amp;&amp; git_config_copy_section(oldsection.buf, newsection.buf) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">		die(_(<span class='string_literal'>"Branch is copied, but update of config-file failed"</span>));</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">	strbuf_release(&amp;oldsection);</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">	strbuf_release(&amp;newsection);</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line"><span class='keyword'>static</span> <span class='macro'>GIT_PATH_FUNC(edit_description, <span class='string_literal'>"EDIT_DESCRIPTION"</span>)<span class='macro_popup'>const char *edit_description(void) { static char *ret; if (!ret<br>) ret = git_pathdup("EDIT_DESCRIPTION"); return ret; }</span></span></td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> edit_branch_description(<span class='keyword'>const</span> <span class='keyword'>char</span> *branch_name)</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">	<span class='keyword'>struct</span> strbuf name = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">	read_branch_desc(&amp;buf, branch_name);</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">	<span class='keyword'>if</span> (!buf.len || buf.buf[buf.len-1] != '\n')</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">		strbuf_addch(&amp;buf, '\n');</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">	strbuf_commented_addf(&amp;buf,</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">		    _(<span class='string_literal'>"Please edit the description for the branch\n"</span></td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">		      <span class='string_literal'>"  %s\n"</span></td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">		      <span class='string_literal'>"Lines starting with '%c' will be stripped.\n"</span>),</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">		    branch_name, comment_line_char);</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">	write_file_buf(edit_description(), buf.buf, buf.len);</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">	<span class='macro'>strbuf_reset(&amp;buf)<span class='macro_popup'>strbuf_setlen(&amp;buf, 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">	<span class='keyword'>if</span> (launch_editor(edit_description(), &amp;buf, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)) {</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">		strbuf_release(&amp;buf);</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">	strbuf_stripspace(&amp;buf, 1);</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">	strbuf_addf(&amp;name, <span class='string_literal'>"branch.%s.description"</span>, branch_name);</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">	git_config_set(name.buf, buf.len ? buf.buf : <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">	strbuf_release(&amp;name);</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">	strbuf_release(&amp;buf);</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line"><span class='keyword'>int</span> cmd_branch(<span class='keyword'>int</span> argc, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">	<span class='keyword'>int</span> delete = 0, rename = 0, copy = 0, force = 0, list = 0;</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">	<span class='keyword'>int</span> show_current = 0;</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">	<span class='keyword'>int</span> reflog = 0, edit_description = 0;</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">	<span class='keyword'>int</span> quiet = 0, unset_upstream = 0;</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *new_upstream = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">	<span class='keyword'>enum</span> branch_track track;</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">	<span class='keyword'>struct</span> ref_filter filter;</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">	<span class='keyword'>int</span> icase = 0;</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>struct</span> ref_sorting *sorting = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, **sorting_tail = &amp;sorting;</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">	<span class='keyword'>struct</span> ref_format format = <span class='macro'>REF_FORMAT_INIT<span class='macro_popup'>{ ((void*)0), 0, -1 }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">	<span class='keyword'>struct</span> option options[] = {</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">		<span class='macro'>OPT_GROUP(N_(<span class='string_literal'>"Generic options"</span>))<span class='macro_popup'>{ OPTION_GROUP, 0, ((void*)0), ((void*)0), ((void*)0), (("Generic options"<br>)) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">		<span class='macro'>OPT__VERBOSE(&amp;filter.verbose,<span class='macro_popup'>{ OPTION_COUNTUP, ('v'), ("verbose"), ((&amp;filter.verbose))<br>, ((void*)0), ((("show hash and subject, give twice for upstream branch"<br>))), PARSE_OPT_NOARG|(0) }</span></span></td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">			<span class='macro'>N_(<span class='string_literal'>"show hash and subject, give twice for upstream branch"</span>))<span class='macro_popup'>{ OPTION_COUNTUP, ('v'), ("verbose"), ((&amp;filter.verbose))<br>, ((void*)0), ((("show hash and subject, give twice for upstream branch"<br>))), PARSE_OPT_NOARG|(0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">		<span class='macro'>OPT__QUIET(&amp;quiet, N_(<span class='string_literal'>"suppress informational messages"</span>))<span class='macro_popup'>{ OPTION_COUNTUP, ('q'), ("quiet"), ((&amp;quiet)), ((void*)0<br>), ((("suppress informational messages"))), PARSE_OPT_NOARG|(<br>0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">		<span class='macro'>OPT_SET_INT('t', <span class='string_literal'>"track"</span>,  &amp;track, N_(<span class='string_literal'>"set up tracking mode (see git-pull(1))"</span>),<span class='macro_popup'>{ OPTION_SET_INT, ('t'), ("track"), (&amp;track), ((void*)0),<br> (("set up tracking mode (see git-pull(1))")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (BRANCH_TRACK_EXPLICIT) }</span></span></td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">			<span class='macro'>BRANCH_TRACK_EXPLICIT)<span class='macro_popup'>{ OPTION_SET_INT, ('t'), ("track"), (&amp;track), ((void*)0),<br> (("set up tracking mode (see git-pull(1))")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (BRANCH_TRACK_EXPLICIT) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">		<span class='macro'>OPT_SET_INT_F(0, <span class='string_literal'>"set-upstream"</span>, &amp;track, N_(<span class='string_literal'>"do not use"</span>),<span class='macro_popup'>{ OPTION_SET_INT, (0), ("set-upstream"), (&amp;track), ((void<br>*)0), (("do not use")), PARSE_OPT_NOARG | (PARSE_OPT_HIDDEN),<br> ((void*)0), (BRANCH_TRACK_OVERRIDE) }</span></span></td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">			<span class='macro'>BRANCH_TRACK_OVERRIDE, PARSE_OPT_HIDDEN)<span class='macro_popup'>{ OPTION_SET_INT, (0), ("set-upstream"), (&amp;track), ((void<br>*)0), (("do not use")), PARSE_OPT_NOARG | (PARSE_OPT_HIDDEN),<br> ((void*)0), (BRANCH_TRACK_OVERRIDE) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">		<span class='macro'>OPT_STRING('u', <span class='string_literal'>"set-upstream-to"</span>, &amp;new_upstream, N_(<span class='string_literal'>"upstream"</span>), N_(<span class='string_literal'>"change the upstream info"</span>))<span class='macro_popup'>{ OPTION_STRING, ('u'), ("set-upstream-to"), (&amp;new_upstream<br>), (("upstream")), (("change the upstream info")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"unset-upstream"</span>, &amp;unset_upstream, N_(<span class='string_literal'>"unset the upstream info"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("unset-upstream"), (&amp;unset_upstream<br>), ((void*)0), (("unset the upstream info")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">		<span class='macro'>OPT__COLOR(&amp;branch_use_color, N_(<span class='string_literal'>"use colored output"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("color"), ((&amp;branch_use_color)),<br> ("when"), ((("use colored output"))), PARSE_OPT_OPTARG, parse_opt_color_flag_cb<br>, (intptr_t)"always" }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">		<span class='macro'>OPT_SET_INT('r', <span class='string_literal'>"remotes"</span>,     &amp;filter.kind, N_(<span class='string_literal'>"act on remote-tracking branches"</span>),<span class='macro_popup'>{ OPTION_SET_INT, ('r'), ("remotes"), (&amp;filter.kind), ((void<br>*)0), (("act on remote-tracking branches")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (0x0008) }</span></span></td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">			<span class='macro'>FILTER_REFS_REMOTES)<span class='macro_popup'>{ OPTION_SET_INT, ('r'), ("remotes"), (&amp;filter.kind), ((void<br>*)0), (("act on remote-tracking branches")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (0x0008) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">		<span class='macro'>OPT_CONTAINS(&amp;filter.with_commit, N_(<span class='string_literal'>"print only branches that contain the commit"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, 0, "contains", (&amp;filter.with_commit), (<br>"commit"), (("print only branches that contain the commit")),<br> PARSE_OPT_LASTARG_DEFAULT | PARSE_OPT_NONEG, parse_opt_commits<br>, (intptr_t) "HEAD" }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">		<span class='macro'>OPT_NO_CONTAINS(&amp;filter.no_commit, N_(<span class='string_literal'>"print only branches that don't contain the commit"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, 0, "no-contains", (&amp;filter.no_commit),<br> ("commit"), (("print only branches that don't contain the commit"<br>)), PARSE_OPT_LASTARG_DEFAULT | PARSE_OPT_NONEG, parse_opt_commits<br>, (intptr_t) "HEAD" }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">		<span class='macro'>OPT_WITH(&amp;filter.with_commit, N_(<span class='string_literal'>"print only branches that contain the commit"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, 0, "with", (&amp;filter.with_commit), ("commit"<br>), (("print only branches that contain the commit")), PARSE_OPT_LASTARG_DEFAULT<br> | PARSE_OPT_HIDDEN | PARSE_OPT_NONEG, parse_opt_commits, (intptr_t<br>) "HEAD" }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">		<span class='macro'>OPT_WITHOUT(&amp;filter.no_commit, N_(<span class='string_literal'>"print only branches that don't contain the commit"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, 0, "without", (&amp;filter.no_commit), ("commit"<br>), (("print only branches that don't contain the commit")), PARSE_OPT_LASTARG_DEFAULT<br> | PARSE_OPT_HIDDEN | PARSE_OPT_NONEG, parse_opt_commits, (intptr_t<br>) "HEAD" }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">		<span class='macro'>OPT__ABBREV(&amp;filter.abbrev)<span class='macro_popup'>{ OPTION_CALLBACK, 0, "abbrev", (&amp;filter.abbrev), ("n"), (<br>"use &lt;n&gt; digits to display object names"), PARSE_OPT_OPTARG<br>, &amp;parse_opt_abbrev_cb, 0 }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">		<span class='macro'>OPT_GROUP(N_(<span class='string_literal'>"Specific git-branch actions:"</span>))<span class='macro_popup'>{ OPTION_GROUP, 0, ((void*)0), ((void*)0), ((void*)0), (("Specific git-branch actions:"<br>)) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">		<span class='macro'>OPT_SET_INT('a', <span class='string_literal'>"all"</span>, &amp;filter.kind, N_(<span class='string_literal'>"list both remote-tracking and local branches"</span>),<span class='macro_popup'>{ OPTION_SET_INT, ('a'), ("all"), (&amp;filter.kind), ((void*<br>)0), (("list both remote-tracking and local branches")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (0x0008 | 0x0004) }</span></span></td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">			<span class='macro'>FILTER_REFS_REMOTES | FILTER_REFS_BRANCHES)<span class='macro_popup'>{ OPTION_SET_INT, ('a'), ("all"), (&amp;filter.kind), ((void*<br>)0), (("list both remote-tracking and local branches")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (0x0008 | 0x0004) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">		<span class='macro'>OPT_BIT('d', <span class='string_literal'>"delete"</span>, &amp;delete, N_(<span class='string_literal'>"delete fully merged branch"</span>), 1)<span class='macro_popup'>{ OPTION_BIT, ('d'), ("delete"), (&amp;delete), ((void*)0), (<br>("delete fully merged branch")), PARSE_OPT_NOARG|(0), ((void*<br>)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">		<span class='macro'>OPT_BIT('D', NULL, &amp;delete, N_(<span class='string_literal'>"delete branch (even if not merged)"</span>), 2)<span class='macro_popup'>{ OPTION_BIT, ('D'), (((void*)0)), (&amp;delete), ((void*)0),<br> (("delete branch (even if not merged)")), PARSE_OPT_NOARG|(0<br>), ((void*)0), (2) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">		<span class='macro'>OPT_BIT('m', <span class='string_literal'>"move"</span>, &amp;rename, N_(<span class='string_literal'>"move/rename a branch and its reflog"</span>), 1)<span class='macro_popup'>{ OPTION_BIT, ('m'), ("move"), (&amp;rename), ((void*)0), (("move/rename a branch and its reflog"<br>)), PARSE_OPT_NOARG|(0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">		<span class='macro'>OPT_BIT('M', NULL, &amp;rename, N_(<span class='string_literal'>"move/rename a branch, even if target exists"</span>), 2)<span class='macro_popup'>{ OPTION_BIT, ('M'), (((void*)0)), (&amp;rename), ((void*)0),<br> (("move/rename a branch, even if target exists")), PARSE_OPT_NOARG<br>|(0), ((void*)0), (2) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">		<span class='macro'>OPT_BIT('c', <span class='string_literal'>"copy"</span>, &amp;copy, N_(<span class='string_literal'>"copy a branch and its reflog"</span>), 1)<span class='macro_popup'>{ OPTION_BIT, ('c'), ("copy"), (&amp;copy), ((void*)0), (("copy a branch and its reflog"<br>)), PARSE_OPT_NOARG|(0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">		<span class='macro'>OPT_BIT('C', NULL, &amp;copy, N_(<span class='string_literal'>"copy a branch, even if target exists"</span>), 2)<span class='macro_popup'>{ OPTION_BIT, ('C'), (((void*)0)), (&amp;copy), ((void*)0), (<br>("copy a branch, even if target exists")), PARSE_OPT_NOARG|(0<br>), ((void*)0), (2) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">		<span class='macro'>OPT_BOOL('l', <span class='string_literal'>"list"</span>, &amp;list, N_(<span class='string_literal'>"list branch names"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('l'), ("list"), (&amp;list), ((void*)0), (<br>("list branch names")), PARSE_OPT_NOARG | (0), ((void*)0), (1<br>) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"show-current"</span>, &amp;show_current, N_(<span class='string_literal'>"show current branch name"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("show-current"), (&amp;show_current),<br> ((void*)0), (("show current branch name")), PARSE_OPT_NOARG |<br> (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"create-reflog"</span>, &amp;reflog, N_(<span class='string_literal'>"create the branch's reflog"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("create-reflog"), (&amp;reflog), ((void<br>*)0), (("create the branch's reflog")), PARSE_OPT_NOARG | (0)<br>, ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">		<span class='macro'>OPT_BOOL(0, <span class='string_literal'>"edit-description"</span>, &amp;edit_description,<span class='macro_popup'>{ OPTION_SET_INT, (0), ("edit-description"), (&amp;edit_description<br>), ((void*)0), (("edit the description for the branch")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span></td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">			 <span class='macro'>N_(<span class='string_literal'>"edit the description for the branch"</span>))<span class='macro_popup'>{ OPTION_SET_INT, (0), ("edit-description"), (&amp;edit_description<br>), ((void*)0), (("edit the description for the branch")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">		<span class='macro'>OPT__FORCE(&amp;force, N_(<span class='string_literal'>"force creation, move/rename, deletion"</span>), PARSE_OPT_NOCOMPLETE)<span class='macro_popup'>{ OPTION_COUNTUP, ('f'), ("force"), ((&amp;force)), ((void*)0<br>), ((("force creation, move/rename, deletion"))), PARSE_OPT_NOARG<br>|((PARSE_OPT_NOCOMPLETE)) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">		<span class='macro'>OPT_MERGED(&amp;filter, N_(<span class='string_literal'>"print only branches that are merged"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, 0, "merged", (&amp;filter), ("commit"), ((<br>"print only branches that are merged")), PARSE_OPT_LASTARG_DEFAULT<br> | PARSE_OPT_NONEG, parse_opt_merge_filter, (intptr_t) "HEAD"<br> }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">		<span class='macro'>OPT_NO_MERGED(&amp;filter, N_(<span class='string_literal'>"print only branches that are not merged"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, 0, "no-merged", (&amp;filter), ("commit"),<br> (("print only branches that are not merged")), PARSE_OPT_LASTARG_DEFAULT<br> | PARSE_OPT_NONEG, parse_opt_merge_filter, (intptr_t) "HEAD"<br> }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">		<span class='macro'>OPT_COLUMN(0, <span class='string_literal'>"column"</span>, &amp;colopts, N_(<span class='string_literal'>"list branches in columns"</span>))<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("column"), (&amp;colopts), ("style")<br>, (("list branches in columns")), PARSE_OPT_OPTARG, parseopt_column_callback<br> }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">		<span class='macro'>OPT_REF_SORT(sorting_tail)<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("sort"), ((sorting_tail)), (("key"))<br>, (("field name to sort on")), (PARSE_OPT_NONEG), (parse_opt_ref_sorting<br>) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">		<span class='macro'>OPT_CALLBACK(0, <span class='string_literal'>"points-at"</span>, &amp;filter.points_at, N_(<span class='string_literal'>"object"</span>),<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("points-at"), (&amp;filter.points_at<br>), (("object")), (("print only branches of the object")), (0)<br>, (parse_opt_object_name) }</span></span></td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">			<span class='macro'>N_(<span class='string_literal'>"print only branches of the object"</span>), parse_opt_object_name)<span class='macro_popup'>{ OPTION_CALLBACK, (0), ("points-at"), (&amp;filter.points_at<br>), (("object")), (("print only branches of the object")), (0)<br>, (parse_opt_object_name) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">		<span class='macro'>OPT_BOOL('i', <span class='string_literal'>"ignore-case"</span>, &amp;icase, N_(<span class='string_literal'>"sorting and filtering are case insensitive"</span>))<span class='macro_popup'>{ OPTION_SET_INT, ('i'), ("ignore-case"), (&amp;icase), ((void<br>*)0), (("sorting and filtering are case insensitive")), PARSE_OPT_NOARG<br> | (0), ((void*)0), (1) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">		<span class='macro'>OPT_STRING(  0 , <span class='string_literal'>"format"</span>, &amp;format.format, N_(<span class='string_literal'>"format"</span>), N_(<span class='string_literal'>"format to use for the output"</span>))<span class='macro_popup'>{ OPTION_STRING, (0), ("format"), (&amp;format.format), (("format"<br>)), (("format to use for the output")), (0) }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">		<span class='macro'>OPT_END()<span class='macro_popup'>{ OPTION_END }</span></span>,</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">	};</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">	setup_ref_filter_porcelain_msg();</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">	memset(&amp;filter, 0, <span class='keyword'>sizeof</span>(filter));</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">	filter.kind = <span class='macro'>FILTER_REFS_BRANCHES<span class='macro_popup'>0x0004</span></span>;</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">	filter.abbrev = -1;</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">	<span class='keyword'>if</span> (argc == 2 &amp;&amp; !strcmp(argv[1], <span class='string_literal'>"-h"</span>))</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">		usage_with_options(builtin_branch_usage, options);</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">	git_config(git_branch_config, sorting_tail);</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">	track = git_branch_track;</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line">	head = resolve_refdup(<span class='string_literal'>"HEAD"</span>, 0, &amp;head_oid, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">	<span class='keyword'>if</span> (!head)</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line">		die(_(<span class='string_literal'>"Failed to resolve HEAD as a valid ref."</span>));</td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">	<span class='keyword'>if</span> (!strcmp(head, <span class='string_literal'>"HEAD"</span>))</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">		filter.detached = 1;</td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!skip_prefix(head, <span class='string_literal'>"refs/heads/"</span>, &amp;head))</td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">		die(_(<span class='string_literal'>"HEAD not found below refs/heads!"</span>));</td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">	argc = parse_options(argc, argv, prefix, options, builtin_branch_usage,</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">			     0);</td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">	<span class='keyword'>if</span> (!delete &amp;&amp; !rename &amp;&amp; !copy &amp;&amp; !edit_description &amp;&amp; !new_upstream &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">	    !show_current &amp;&amp; !unset_upstream &amp;&amp; argc == 0)</td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">		list = 1;</td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">	<span class='keyword'>if</span> (filter.with_commit || filter.no_commit ||</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">	    filter.reachable_from || filter.unreachable_from || filter.points_at.nr)</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">		list = 1;</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">	<span class='keyword'>if</span> (!!delete + !!rename + !!copy + !!new_upstream + !!show_current +</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">	    list + edit_description + unset_upstream &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">		usage_with_options(builtin_branch_usage, options);</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">	<span class='keyword'>if</span> (filter.abbrev == -1)</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">		filter.abbrev = <span class='macro'>DEFAULT_ABBREV<span class='macro_popup'>default_abbrev</span></span>;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line">	filter.ignore_case = icase;</td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line">	finalize_colopts(&amp;colopts, -1);</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">	<span class='keyword'>if</span> (filter.verbose) {</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>explicitly_enable_column(colopts)<span class='macro_popup'>(((colopts) &amp; 0x0040) &amp;&amp; column_active(colopts))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">			die(_(<span class='string_literal'>"--column and --verbose are incompatible"</span>));</td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">		colopts = 0;</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">	<span class='keyword'>if</span> (force) {</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">		delete *= 2;</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">		rename *= 2;</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">		copy *= 2;</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">	<span class='keyword'>if</span> (list)</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">		setup_auto_pager(<span class='string_literal'>"branch"</span>, 1);</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">	<span class='keyword'>if</span> (delete) {</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">		<span class='keyword'>if</span> (!argc)</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">			die(_(<span class='string_literal'>"branch name required"</span>));</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">		<span class='keyword'>return</span> delete_branches(argc, argv, delete &gt; 1, filter.kind, quiet);</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (show_current) {</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">		print_current_branch_name();</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (list) {</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">		<span class='comment'>/*  git branch --local also shows HEAD when it is detached */</span></td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">		<span class='keyword'>if</span> ((filter.kind &amp; <span class='macro'>FILTER_REFS_BRANCHES<span class='macro_popup'>0x0004</span></span>) &amp;&amp; filter.detached)</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">			filter.kind |= <span class='macro'>FILTER_REFS_DETACHED_HEAD<span class='macro_popup'>0x0020</span></span>;</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">		filter.name_patterns = argv;</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">		 <span class='comment'>* If no sorting parameter is given then we default to sorting</span></td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">		 <span class='comment'>* by 'refname'. This would give us an alphabetically sorted</span></td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">		 <span class='comment'>* array with the 'HEAD' ref at the beginning followed by</span></td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">		 <span class='comment'>* local branches 'refs/heads/...' and finally remote-tracking</span></td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">		 <span class='comment'>* branches 'refs/remotes/...'.</span></td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">		<span class='keyword'>if</span> (!sorting)</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">			sorting = ref_default_sorting();</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">		ref_sorting_icase_all(sorting, icase);</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">		print_ref_list(&amp;filter, sorting, &amp;format);</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">		print_columns(&amp;output, colopts, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">		string_list_clear(&amp;output, 0);</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (edit_description) {</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *branch_name;</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">		<span class='keyword'>struct</span> strbuf branch_ref = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">		<span class='keyword'>if</span> (!argc) {</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">			<span class='keyword'>if</span> (filter.detached)</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">				die(_(<span class='string_literal'>"Cannot give description to detached HEAD"</span>));</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">			branch_name = head;</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (argc == 1)</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">			branch_name = argv[0];</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">			die(_(<span class='string_literal'>"cannot edit description of more than one branch"</span>));</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">		strbuf_addf(&amp;branch_ref, <span class='string_literal'>"refs/heads/%s"</span>, branch_name);</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">		<span class='keyword'>if</span> (!ref_exists(branch_ref.buf)) {</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">			strbuf_release(&amp;branch_ref);</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">			<span class='keyword'>if</span> (!argc)</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">				<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"No commit on branch '%s' yet."</span>),<span class='macro_popup'>(error(_("No commit on branch '%s' yet."), branch_name), const_error<br>())</span></span></td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">					     <span class='macro'>branch_name)<span class='macro_popup'>(error(_("No commit on branch '%s' yet."), branch_name), const_error<br>())</span></span>;</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">				<span class='keyword'>return</span> <span class='macro'>error(_(<span class='string_literal'>"No branch named '%s'."</span>),<span class='macro_popup'>(error(_("No branch named '%s'."), branch_name), const_error(<br>))</span></span></td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">					     <span class='macro'>branch_name)<span class='macro_popup'>(error(_("No branch named '%s'."), branch_name), const_error(<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">		strbuf_release(&amp;branch_ref);</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">		<span class='keyword'>if</span> (edit_branch_description(branch_name))</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">			<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (copy) {</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">		<span class='keyword'>if</span> (!argc)</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">			die(_(<span class='string_literal'>"branch name required"</span>));</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (argc == 1)</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">			copy_or_rename_branch(head, argv[0], 1, copy &gt; 1);</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (argc == 2)</td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">			copy_or_rename_branch(argv[0], argv[1], 1, copy &gt; 1);</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">			die(_(<span class='string_literal'>"too many branches for a copy operation"</span>));</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (rename) {</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">		<span class='keyword'>if</span> (!argc)</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">			die(_(<span class='string_literal'>"branch name required"</span>));</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (argc == 1)</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">			copy_or_rename_branch(head, argv[0], 0, rename &gt; 1);</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (argc == 2)</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">			copy_or_rename_branch(argv[0], argv[1], 0, rename &gt; 1);</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">			die(_(<span class='string_literal'>"too many arguments for a rename operation"</span>));</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (new_upstream) {</td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">		<span class='keyword'>struct</span> branch *branch = branch_get(argv[0]);</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">		<span class='keyword'>if</span> (argc &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line">			die(_(<span class='string_literal'>"too many arguments to set new upstream"</span>));</td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">		<span class='keyword'>if</span> (!branch) {</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">			<span class='keyword'>if</span> (!argc || !strcmp(argv[0], <span class='string_literal'>"HEAD"</span>))</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">				die(_(<span class='string_literal'>"could not set upstream of HEAD to %s when "</span></td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">				      <span class='string_literal'>"it does not point to any branch."</span>),</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">				    new_upstream);</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">			die(_(<span class='string_literal'>"no such branch '%s'"</span>), argv[0]);</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">		<span class='keyword'>if</span> (!ref_exists(branch-&gt;refname))</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">			die(_(<span class='string_literal'>"branch '%s' does not exist"</span>), branch-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">		 <span class='comment'>* create_branch takes care of setting up the tracking</span></td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">		 <span class='comment'>* info and making sure new_upstream is correct</span></td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">		create_branch(the_repository, branch-&gt;name, new_upstream,</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line">			      0, 0, 0, quiet, BRANCH_TRACK_OVERRIDE);</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (unset_upstream) {</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">		<span class='keyword'>struct</span> branch *branch = branch_get(argv[0]);</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">		<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='macro_popup'>{ .alloc = 0, .len = 0, .buf = strbuf_slopbuf }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">		<span class='keyword'>if</span> (argc &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">			die(_(<span class='string_literal'>"too many arguments to unset upstream"</span>));</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">		<span class='keyword'>if</span> (!branch) {</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line">			<span class='keyword'>if</span> (!argc || !strcmp(argv[0], <span class='string_literal'>"HEAD"</span>))</td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">				die(_(<span class='string_literal'>"could not unset upstream of HEAD when "</span></td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line">				      <span class='string_literal'>"it does not point to any branch."</span>));</td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">			die(_(<span class='string_literal'>"no such branch '%s'"</span>), argv[0]);</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">		<span class='keyword'>if</span> (!branch_has_merge_config(branch))</td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">			die(_(<span class='string_literal'>"Branch '%s' has no upstream information"</span>), branch-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">		strbuf_addf(&amp;buf, <span class='string_literal'>"branch.%s.remote"</span>, branch-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">		git_config_set_multivar(buf.buf, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 1);</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">		<span class='macro'>strbuf_reset(&amp;buf)<span class='macro_popup'>strbuf_setlen(&amp;buf, 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line">		strbuf_addf(&amp;buf, <span class='string_literal'>"branch.%s.merge"</span>, branch-&gt;name);</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line">		git_config_set_multivar(buf.buf, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 1);</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">		strbuf_release(&amp;buf);</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (argc &gt; 0 &amp;&amp; argc &lt;= 2) {</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">		<span class='keyword'>if</span> (filter.kind != <span class='macro'>FILTER_REFS_BRANCHES<span class='macro_popup'>0x0004</span></span>)</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">			die(_(<span class='string_literal'>"The -a, and -r, options to 'git branch' do not take a branch name.\n"</span></td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">				  <span class='string_literal'>"Did you mean to use: -a|-r --list &lt;pattern&gt;?"</span>));</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">		<span class='keyword'>if</span> (track == BRANCH_TRACK_OVERRIDE)</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">			die(_(<span class='string_literal'>"the '--set-upstream' option is no longer supported. Please use '--track' or '--set-upstream-to' instead."</span>));</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">		create_branch(the_repository,</td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">			      argv[0], (argc == 2) ? argv[1] : head,</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">			      force, 0, reflog, quiet, track);</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">	} <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">		usage_with_options(builtin_branch_usage, options);</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">}</td></tr>
</table></body></html>
