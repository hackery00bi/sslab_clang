<!doctype html>
<html>
<head>
<title>screen.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'strcpy' is insecure as it does not provide bounding of the memory buffer. Replace unbounded copy functions with analogous functions that support length arguments such as 'strlcpy'. CWE-119 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'strcpy' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/sslab_clang/c_vim/vim/src/screen.c -->

<!-- FILENAME screen.c -->

<!-- FUNCTIONNAME win_redr_status_matches -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 4e08d0a0d01032dc07f6681e64fc7b04 -->

<!-- BUGLINE 1006 -->

<!-- BUGCOLUMN 6 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>screen.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 1006, column 6</a><br />Call to function 'strcpy' is insecure as it does not provide bounding of the memory buffer. Replace unbounded copy functions with analogous functions that support length arguments such as 'strlcpy'. CWE-119</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name screen.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I . -I proto -D HAVE_CONFIG_H -U _FORTIFY_SOURCE -D _FORTIFY_SOURCE=1 -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -fdebug-compilation-dir /tmp/sslab_clang/c_vim/vim/src -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-24-134443-313-1 -x c screen.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"1006": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/* vi:set ts=8 sts=4 sw=4 noet:</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>* VIM - Vi IMproved	by Bram Moolenaar</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> <span class='comment'>* Do ":help uganda"  in Vim to read copying and usage conditions.</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"> <span class='comment'>* Do ":help credits" in Vim to see a list of people who contributed.</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> <span class='comment'>* See README.txt for an overview of the Vim source code.</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"> <span class='comment'>* screen.c: Lower level code for displaying on the screen.</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"> <span class='comment'>* Output to the screen (console, terminal emulator or GUI window) is minimized</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"> <span class='comment'>* by remembering what is already on the screen, and only updating the parts</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"> <span class='comment'>* that changed.</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"> <span class='comment'>* ScreenLines[off]  Contains a copy of the whole screen, as it is currently</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"> <span class='comment'>*		     displayed (excluding text written by external commands).</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"> <span class='comment'>* ScreenAttrs[off]  Contains the associated attributes.</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"> <span class='comment'>* LineOffset[row]   Contains the offset into ScreenLines*[] and ScreenAttrs[]</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"> <span class='comment'>*		     for each line.</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> <span class='comment'>* LineWraps[row]    Flag for each line whether it wraps to the next line.</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> <span class='comment'>* For double-byte characters, two consecutive bytes in ScreenLines[] can form</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"> <span class='comment'>* one character which occupies two display cells.</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"> <span class='comment'>* For UTF-8 a multi-byte character is converted to Unicode and stored in</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"> <span class='comment'>* ScreenLinesUC[].  ScreenLines[] contains the first byte only.  For an ASCII</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"> <span class='comment'>* character without composing chars ScreenLinesUC[] will be 0 and</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> <span class='comment'>* ScreenLinesC[][] is not used.  When the character occupies two display</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"> <span class='comment'>* cells the next byte in ScreenLines[] is 0.</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"> <span class='comment'>* ScreenLinesC[][] contain up to 'maxcombine' composing characters</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"> <span class='comment'>* (drawn on top of the first character).  There is 0 after the last one used.</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"> <span class='comment'>* ScreenLines2[] is only used for euc-jp to store the second byte if the</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"> <span class='comment'>* first byte is 0x8e (single-width character).</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"> <span class='comment'>* The screen_*() functions write to the screen and handle updating</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"> <span class='comment'>* ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='directive'>#include "vim.h"</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> <span class='comment'>* The attributes that are actually active for writing to the screen.</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>	screen_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> screen_char_2(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> row, <span class='keyword'>int</span> col);</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> screenclear2(<span class='keyword'>void</span>);</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> lineclear(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> width, <span class='keyword'>int</span> attr);</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> lineinvalid(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> width);</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> win_do_lines(win_T *wp, <span class='keyword'>int</span> row, <span class='keyword'>int</span> line_count, <span class='keyword'>int</span> mayclear, <span class='keyword'>int</span> del, <span class='keyword'>int</span> clear_attr);</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> win_rest_invalid(win_T *wp);</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> msg_pos_mode(<span class='keyword'>void</span>);</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> recording_mode(<span class='keyword'>int</span> attr);</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='comment'>// Ugly global: overrule attribute used by screen_char()</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> screen_char_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='directive'>#if defined(FEAT_CONCEAL) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"> <span class='comment'>* Return TRUE if the cursor line in window "wp" may be concealed, according</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"> <span class='comment'>* to the 'concealcursor' option.</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">conceal_cursor_line(win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">    <span class='keyword'>int</span>		c;</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">    <span class='keyword'>if</span> (*wp-&gt;<span class='macro'>w_p_cocu<span class='macro_popup'>w_onebuf_opt.wo_cocu</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">    <span class='keyword'>if</span> (get_real_state() &amp; <span class='macro'>VISUAL<span class='macro_popup'>0x02</span></span>)</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">	c = 'v';</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (State &amp; <span class='macro'>INSERT<span class='macro_popup'>0x10</span></span>)</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">	c = 'i';</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (State &amp; <span class='macro'>NORMAL<span class='macro_popup'>0x01</span></span>)</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">	c = 'n';</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (State &amp; <span class='macro'>CMDLINE<span class='macro_popup'>0x08</span></span>)</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">	c = 'c';</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">    <span class='keyword'>return</span> vim_strchr(wp-&gt;<span class='macro'>w_p_cocu<span class='macro_popup'>w_onebuf_opt.wo_cocu</span></span>, c) != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"> <span class='comment'>* Check if the cursor line needs to be redrawn because of 'concealcursor'.</span></td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">conceal_check_cursor_line(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    <span class='keyword'>if</span> (curwin-&gt;<span class='macro'>w_p_cole<span class='macro_popup'>w_onebuf_opt.wo_cole</span></span> &gt; 0 &amp;&amp; conceal_cursor_line(curwin))</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">	need_cursor_line_redraw = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">	<span class='comment'>// Need to recompute cursor column, e.g., when starting Visual mode</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">	<span class='comment'>// without concealing.</span></td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">	curs_columns(<span class='macro'>TRUE<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line"> <span class='comment'>* Get 'wincolor' attribute for window "wp".  If not set and "wp" is a popup</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"> <span class='comment'>* window then get the "Pmenu" highlight attribute.</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">get_wcr_attr(win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">    <span class='keyword'>int</span> wcr_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">    <span class='keyword'>if</span> (*wp-&gt;<span class='macro'>w_p_wcr<span class='macro_popup'>w_onebuf_opt.wo_wcr</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">	wcr_attr = syn_name2attr(wp-&gt;<span class='macro'>w_p_wcr<span class='macro_popup'>w_onebuf_opt.wo_wcr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>WIN_IS_POPUP(wp)<span class='macro_popup'>((wp)-&gt;w_popup_flags != 0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">	<span class='keyword'>if</span> (wp-&gt;w_popup_flags &amp; <span class='macro'>POPF_INFO<span class='macro_popup'>0x80</span></span>)</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">	    wcr_attr = <span class='macro'>HL_ATTR(HLF_PSI)<span class='macro_popup'>highlight_attr[(int)(HLF_PSI)]</span></span>;    <span class='comment'>// PmenuSel</span></td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">	    wcr_attr = <span class='macro'>HL_ATTR(HLF_PNI)<span class='macro_popup'>highlight_attr[(int)(HLF_PNI)]</span></span>;    <span class='comment'>// Pmenu</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">    <span class='keyword'>return</span> wcr_attr;</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"> <span class='comment'>* Call screen_fill() with the columns adjusted for 'rightleft' if needed.</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"> <span class='comment'>* Return the new offset.</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">screen_fill_end(</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">	win_T *wp,</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">	<span class='keyword'>int</span>	c1,</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">	<span class='keyword'>int</span>	c2,</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">	<span class='keyword'>int</span>	off,</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">	<span class='keyword'>int</span>	width,</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">	<span class='keyword'>int</span>	row,</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">	<span class='keyword'>int</span>	endrow,</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">	<span class='keyword'>int</span>	attr)</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">    <span class='keyword'>int</span>	    nn = off + width;</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">    <span class='keyword'>if</span> (nn &gt; wp-&gt;w_width)</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">	nn = wp-&gt;w_width;</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;<span class='macro'>w_p_rl<span class='macro_popup'>w_onebuf_opt.wo_rl</span></span>)</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + endrow,</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">		<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span> - nn, (<span class='keyword'>int</span>)<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span> - off,</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">		c1, c2, attr);</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + endrow,</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">		wp-&gt;w_wincol + off, (<span class='keyword'>int</span>)wp-&gt;w_wincol + nn,</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">		c1, c2, attr);</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">    <span class='keyword'>return</span> nn;</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"> <span class='comment'>* Clear lines near the end the window and mark the unused lines with "c1".</span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"> <span class='comment'>* use "c2" as the filler character.</span></td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"> <span class='comment'>* When "draw_margin" is TRUE then draw the sign, fold and number columns.</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">win_draw_end(</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">    <span class='keyword'>int</span>		c1,</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">    <span class='keyword'>int</span>		c2,</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">    <span class='keyword'>int</span>		draw_margin,</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">    <span class='keyword'>int</span>		endrow,</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">    hlf_T	hl)</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">    <span class='keyword'>int</span>		n = 0;</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">    <span class='keyword'>int</span>		attr = <span class='macro'>HL_ATTR(hl)<span class='macro_popup'>highlight_attr[(int)(hl)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">    <span class='keyword'>int</span>		wcr_attr = get_wcr_attr(wp);</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">    attr = hl_combine_attr(wcr_attr, attr);</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">    <span class='keyword'>if</span> (draw_margin)</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"><span class='directive'>#ifdef FEAT_FOLDING</span></td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">	<span class='keyword'>int</span>	fdc = compute_foldcolumn(wp, 0);</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">	<span class='keyword'>if</span> (fdc &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">	    <span class='comment'>// draw the fold column</span></td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">	    n = screen_fill_end(wp, ' ', ' ', n, fdc,</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">		      row, endrow, hl_combine_attr(wcr_attr, <span class='macro'>HL_ATTR(HLF_FC)<span class='macro_popup'>highlight_attr[(int)(HLF_FC)]</span></span>));</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"><span class='directive'>#ifdef FEAT_SIGNS</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">	<span class='keyword'>if</span> (signcolumn_on(wp))</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">	    <span class='comment'>// draw the sign column</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">	    n = screen_fill_end(wp, ' ', ' ', n, 2,</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">		      row, endrow, hl_combine_attr(wcr_attr, <span class='macro'>HL_ATTR(HLF_SC)<span class='macro_popup'>highlight_attr[(int)(HLF_SC)]</span></span>));</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">	<span class='keyword'>if</span> ((wp-&gt;<span class='macro'>w_p_nu<span class='macro_popup'>w_onebuf_opt.wo_nu</span></span> || wp-&gt;<span class='macro'>w_p_rnu<span class='macro_popup'>w_onebuf_opt.wo_rnu</span></span>)</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">				  &amp;&amp; vim_strchr(p_cpo, <span class='macro'>CPO_NUMCOL<span class='macro_popup'>'n'</span></span>) == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">	    <span class='comment'>// draw the number column</span></td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">	    n = screen_fill_end(wp, ' ', ' ', n, number_width(wp) + 1,</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">		       row, endrow, hl_combine_attr(wcr_attr, <span class='macro'>HL_ATTR(HLF_N)<span class='macro_popup'>highlight_attr[(int)(HLF_N)]</span></span>));</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;<span class='macro'>w_p_rl<span class='macro_popup'>w_onebuf_opt.wo_rl</span></span>)</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + endrow,</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">		wp-&gt;w_wincol, <span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span> - 1 - n,</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">		c2, c2, attr);</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + endrow,</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">		<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span> - 1 - n, <span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span> - n,</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">		c1, c2, attr);</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + endrow,</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">		wp-&gt;w_wincol + n, (<span class='keyword'>int</span>)<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">		c1, c2, attr);</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">    set_empty_rows(wp, row);</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"><span class='directive'>#if defined(FEAT_FOLDING) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line"> <span class='comment'>* Compute the width of the foldcolumn.  Based on 'foldcolumn' and how much</span></td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"> <span class='comment'>* space is available for window "wp", minus "col".</span></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">compute_foldcolumn(win_T *wp, <span class='keyword'>int</span> col)</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">    <span class='keyword'>int</span> fdc = wp-&gt;<span class='macro'>w_p_fdc<span class='macro_popup'>w_onebuf_opt.wo_fdc</span></span>;</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">    <span class='keyword'>int</span> wmw = wp == curwin &amp;&amp; p_wmw == 0 ? 1 : p_wmw;</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    <span class='keyword'>int</span> wwidth = wp-&gt;w_width;</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">    <span class='keyword'>if</span> (fdc &gt; wwidth - (col + wmw))</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">	fdc = wwidth - (col + wmw);</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">    <span class='keyword'>return</span> fdc;</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"> <span class='comment'>* Fill the foldcolumn at "p" for window "wp".</span></td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"> <span class='comment'>* Only to be called when 'foldcolumn' &gt; 0.</span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">fill_foldcolumn(</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">    char_u	*p,</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">    <span class='keyword'>int</span>		closed,		<span class='comment'>// TRUE of FALSE</span></td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">    linenr_T	lnum)		<span class='comment'>// current line number</span></td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">    <span class='keyword'>int</span>		i = 0;</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">    <span class='keyword'>int</span>		level;</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">    <span class='keyword'>int</span>		first_level;</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">    <span class='keyword'>int</span>		empty;</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">    <span class='keyword'>int</span>		fdc = compute_foldcolumn(wp, 0);</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">    <span class='comment'>// Init to all spaces.</span></td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">    <span class='macro'>vim_memset(p, ' ', (size_t)fdc)<span class='macro_popup'>memset((p), (' '), ((size_t)fdc))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">    level = win_foldinfo.fi_level;</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">    <span class='keyword'>if</span> (level &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">	<span class='comment'>// If there is only one column put more info in it.</span></td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">	empty = (fdc == 1) ? 0 : 1;</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">	<span class='comment'>// If the column is too narrow, we start at the lowest level that</span></td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">	<span class='comment'>// fits and use numbers to indicated the depth.</span></td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">	first_level = level - fdc - closed + 1 + empty;</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">	<span class='keyword'>if</span> (first_level &lt; 1)</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">	    first_level = 1;</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">	<span class='keyword'>for</span> (i = 0; i + empty &lt; fdc; ++i)</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">	    <span class='keyword'>if</span> (win_foldinfo.fi_lnum == lnum</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">			      &amp;&amp; first_level + i &gt;= win_foldinfo.fi_low_level)</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">		p[i] = '-';</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (first_level == 1)</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">		p[i] = '|';</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (first_level + i &lt;= 9)</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">		p[i] = '0' + first_level + i;</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">		p[i] = '&gt;';</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">	    <span class='keyword'>if</span> (first_level + i == level)</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">    <span class='keyword'>if</span> (closed)</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">	p[i &gt;= fdc ? i - 1 : i] = '+';</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line"><span class='directive'>#endif // FEAT_FOLDING</span></td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line"> <span class='comment'>* Return if the composing characters at "off_from" and "off_to" differ.</span></td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line"> <span class='comment'>* Only to be used when ScreenLinesUC[off_from] != 0.</span></td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">comp_char_differs(<span class='keyword'>int</span> off_from, <span class='keyword'>int</span> off_to)</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">    <span class='keyword'>int</span>	    i;</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; Screen_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">	<span class='keyword'>if</span> (ScreenLinesC[i][off_from] != ScreenLinesC[i][off_to])</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">	    <span class='keyword'>return</span> <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">	<span class='keyword'>if</span> (ScreenLinesC[i][off_from] == 0)</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">	    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line"> <span class='comment'>* Check whether the given character needs redrawing:</span></td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"> <span class='comment'>* - the (first byte of the) character is different</span></td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"> <span class='comment'>* - the attributes are different</span></td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line"> <span class='comment'>* - the character is multi-byte and the next byte is different</span></td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line"> <span class='comment'>* - the character is two cells wide and the second cell differs.</span></td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">char_needs_redraw(<span class='keyword'>int</span> off_from, <span class='keyword'>int</span> off_to, <span class='keyword'>int</span> cols)</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">    <span class='keyword'>if</span> (cols &gt; 0</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">	    &amp;&amp; ((ScreenLines[off_from] != ScreenLines[off_to]</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">		    || ScreenAttrs[off_from] != ScreenAttrs[off_to])</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">		|| (enc_dbcs != 0</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">		    &amp;&amp; <span class='macro'>MB_BYTE2LEN(ScreenLines[off_from])<span class='macro_popup'>mb_bytelen_tab[ScreenLines[off_from]]</span></span> &gt; 1</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">		    &amp;&amp; (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; ScreenLines[off_from] == 0x8e</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">			? ScreenLines2[off_from] != ScreenLines2[off_to]</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">			: (cols &gt; 1 &amp;&amp; ScreenLines[off_from + 1]</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">						 != ScreenLines[off_to + 1])))</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">		|| (enc_utf8</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">		    &amp;&amp; (ScreenLinesUC[off_from] != ScreenLinesUC[off_to]</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">			|| (ScreenLinesUC[off_from] != 0</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">			    &amp;&amp; comp_char_differs(off_from, off_to))</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">			|| ((*mb_off2cells)(off_from, off_from + cols) &gt; 1</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">			    &amp;&amp; ScreenLines[off_from + 1]</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">						!= ScreenLines[off_to + 1])))))</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line"><span class='directive'>#if defined(<span class='macro'>FEAT_TERMINAL<span class='macro_popup'>1</span></span>) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line"> <span class='comment'>* Return the index in ScreenLines[] for the current screen line.</span></td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">screen_get_current_line_off()</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">    <span class='keyword'>return</span> (<span class='keyword'>int</span>)(current_ScreenLine - ScreenLines);</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line"> <span class='comment'>* Return TRUE if this position has a higher level popup or this cell is</span></td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"> <span class='comment'>* transparent in the current popup.</span></td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">blocked_by_popup(<span class='keyword'>int</span> row, <span class='keyword'>int</span> col)</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">    <span class='keyword'>int</span> off;</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">    <span class='keyword'>if</span> (!popup_visible)</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">    off = row * screen_Columns + col;</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">    <span class='keyword'>return</span> popup_mask[off] &gt; screen_zindex || popup_transparent[off];</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"> <span class='comment'>* Reset the highlighting.  Used before clearing the screen.</span></td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">reset_screen_attr(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">    <span class='keyword'>if</span> (gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">	<span class='comment'>// Use a code that will reset gui.highlight_mask in</span></td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">	<span class='comment'>// gui_stop_highlight().</span></td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">	screen_attr = <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span> + 1;</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">	<span class='comment'>// Use attributes that is very unlikely to appear in text.</span></td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">	screen_attr = <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span> | <span class='macro'>HL_UNDERLINE<span class='macro_popup'>0x08</span></span> | <span class='macro'>HL_INVERSE<span class='macro_popup'>0x01</span></span> | <span class='macro'>HL_STRIKETHROUGH<span class='macro_popup'>0x80</span></span>;</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line"> <span class='comment'>* Move one "cooked" screen line to the screen, but only the characters that</span></td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line"> <span class='comment'>* have actually changed.  Handle insert/delete character.</span></td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line"> <span class='comment'>* "coloff" gives the first column on the screen for this line.</span></td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line"> <span class='comment'>* "endcol" gives the columns where valid characters are.</span></td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line"> <span class='comment'>* "clear_width" is the width of the window.  It's &gt; 0 if the rest of the line</span></td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line"> <span class='comment'>* needs to be cleared, negative otherwise.</span></td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line"> <span class='comment'>* "flags" can have bits:</span></td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"> <span class='comment'>* SLF_POPUP	    popup window</span></td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line"> <span class='comment'>* SLF_RIGHTLEFT    rightleft window:</span></td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line"> <span class='comment'>*    When TRUE and "clear_width" &gt; 0, clear columns 0 to "endcol"</span></td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line"> <span class='comment'>*    When FALSE and "clear_width" &gt; 0, clear columns "endcol" to "clear_width"</span></td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">screen_line(</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">    <span class='keyword'>int</span>	    row,</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">    <span class='keyword'>int</span>	    coloff,</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">    <span class='keyword'>int</span>	    endcol,</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">    <span class='keyword'>int</span>	    clear_width,</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">    <span class='keyword'>int</span>	    flags <span class='macro'>UNUSED<span class='macro_popup'>__attribute__((unused))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">    <span class='keyword'>unsigned</span>	    off_from;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">    <span class='keyword'>unsigned</span>	    off_to;</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">    <span class='keyword'>unsigned</span>	    max_off_from;</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">    <span class='keyword'>unsigned</span>	    max_off_to;</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">    <span class='keyword'>int</span>		    col = 0;</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">    <span class='keyword'>int</span>		    hl;</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">    <span class='keyword'>int</span>		    force = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;	<span class='comment'>// force update rest of the line</span></td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">    <span class='keyword'>int</span>		    redraw_this		<span class='comment'>// bool: does character need redraw?</span></td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">				= <span class='macro'>TRUE<span class='macro_popup'>1</span></span>	<span class='comment'>// For GUI when while-loop empty</span></td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">				;</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">    <span class='keyword'>int</span>		    redraw_next;	<span class='comment'>// redraw_this for next character</span></td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">    <span class='keyword'>int</span>		    clear_next = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">    <span class='keyword'>int</span>		    char_cells;		<span class='comment'>// 1: normal char</span></td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">					<span class='comment'>// 2: occupies two display cells</span></td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line"><span class='directive'># define <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span> char_cells</span></td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">    <span class='comment'>// Check for illegal row and col, just in case.</span></td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">    <span class='keyword'>if</span> (row &gt;= Rows)</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">	row = Rows - 1;</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">    <span class='keyword'>if</span> (endcol &gt; Columns)</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">	endcol = Columns;</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line"><span class='directive'># ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">    clip_may_clear_selection(row, row);</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">    off_from = (<span class='keyword'>unsigned</span>)(current_ScreenLine - ScreenLines);</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">    off_to = LineOffset[row] + coloff;</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">    max_off_from = off_from + screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">    max_off_to = LineOffset[row] + screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">    <span class='keyword'>if</span> (flags &amp; <span class='macro'>SLF_RIGHTLEFT<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">	<span class='comment'>// Clear rest first, because it's left of the text.</span></td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">	<span class='keyword'>if</span> (clear_width &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">	    <span class='keyword'>while</span> (col &lt;= endcol &amp;&amp; ScreenLines[off_to] == ' '</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">		    &amp;&amp; ScreenAttrs[off_to] == 0</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">				  &amp;&amp; (!enc_utf8 || ScreenLinesUC[off_to] == 0))</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">		++off_to;</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">		++col;</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">	    <span class='keyword'>if</span> (col &lt;= endcol)</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">		screen_fill(row, row + 1, col + coloff,</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">					    endcol + coloff + 1, ' ', ' ', 0);</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">	col = endcol + 1;</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">	off_to = LineOffset[row] + col + coloff;</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">	off_from += col;</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">	endcol = (clear_width &gt; 0 ? clear_width : -clear_width);</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line"><span class='directive'>#endif // FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">    <span class='comment'>// First char of a popup window may go on top of the right half of a</span></td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">    <span class='comment'>// double-wide character. Clear the left half to avoid it getting the popup</span></td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">    <span class='comment'>// window background color.</span></td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">    <span class='keyword'>if</span> (coloff &gt; 0 &amp;&amp; enc_utf8</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">		   &amp;&amp; ScreenLines[off_to] == 0</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">		   &amp;&amp; ScreenLinesUC[off_to - 1] != 0</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">		   &amp;&amp; (*mb_char2cells)(ScreenLinesUC[off_to - 1]) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">	ScreenLines[off_to - 1] = ' ';</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">	ScreenLinesUC[off_to - 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">	screen_char(off_to - 1, row, col + coloff - 1);</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">    redraw_next = char_needs_redraw(off_from, off_to, endcol - col);</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">    <span class='keyword'>while</span> (col &lt; endcol)</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">	<span class='keyword'>if</span> (has_mbyte &amp;&amp; (col + 1 &lt; endcol))</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">	    char_cells = (*mb_off2cells)(off_from, max_off_from);</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">	    char_cells = 1;</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">	redraw_this = redraw_next;</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">	redraw_next = force || char_needs_redraw(off_from + <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>,</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">			      off_to + <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>, endcol - col - <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>);</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">	<span class='comment'>// If the next character was bold, then redraw the current character to</span></td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">	<span class='comment'>// remove any pixels that might have spilt over into us.  This only</span></td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">	<span class='comment'>// happens in the GUI.</span></td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">	<span class='keyword'>if</span> (redraw_next &amp;&amp; gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">	    hl = ScreenAttrs[off_to + <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>];</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">	    <span class='keyword'>if</span> (hl &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span>)</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">		hl = syn_attr2attr(hl);</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">	    <span class='keyword'>if</span> (hl &amp; <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span>)</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">		redraw_this = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">	<span class='keyword'>if</span> (blocked_by_popup(row, col + coloff))</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">	    redraw_this = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">	<span class='keyword'>if</span> (redraw_this)</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">	     <span class='comment'>* Special handling when 'xs' termcap flag set (hpterm):</span></td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">	     <span class='comment'>* Attributes for characters are stored at the position where the</span></td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">	     <span class='comment'>* cursor is when writing the highlighting code.  The</span></td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">	     <span class='comment'>* start-highlighting code must be written with the cursor on the</span></td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">	     <span class='comment'>* first highlighted character.  The stop-highlighting code must</span></td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">	     <span class='comment'>* be written with the cursor just after the last highlighted</span></td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">	     <span class='comment'>* character.</span></td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">	     <span class='comment'>* Overwriting a character doesn't remove its highlighting.  Need</span></td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">	     <span class='comment'>* to clear the rest of the line, and force redrawing it</span></td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">	     <span class='comment'>* completely.</span></td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">	    <span class='keyword'>if</span> (       p_wiv</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">		    &amp;&amp; !force</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">		    &amp;&amp; !gui.in_use</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">		    &amp;&amp; ScreenAttrs[off_to] != 0</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">		    &amp;&amp; ScreenAttrs[off_from] != ScreenAttrs[off_to])</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">		 <span class='comment'>* Need to remove highlighting attributes here.</span></td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">		windgoto(row, col + coloff);</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">		out_str(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>);		<span class='comment'>// clear rest of this screen line</span></td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">		screen_start();		<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">		force = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;		<span class='comment'>// force redraw of rest of the line</span></td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">		redraw_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;	<span class='comment'>// or else next char would miss out</span></td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">		 <span class='comment'>* If the previous character was highlighted, need to stop</span></td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">		 <span class='comment'>* highlighting at this character.</span></td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">		<span class='keyword'>if</span> (col + coloff &gt; 0 &amp;&amp; ScreenAttrs[off_to - 1] != 0)</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">		    screen_attr = ScreenAttrs[off_to - 1];</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">		    term_windgoto(row, col + coloff);</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">		    screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">		    screen_attr = 0;	    <span class='comment'>// highlighting has stopped</span></td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">	    <span class='keyword'>if</span> (enc_dbcs != 0)</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">		<span class='comment'>// Check if overwriting a double-byte with a single-byte or</span></td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">		<span class='comment'>// the other way around requires another character to be</span></td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">		<span class='comment'>// redrawn.  For UTF-8 this isn't needed, because comparing</span></td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">		<span class='comment'>// ScreenLinesUC[] is sufficient.</span></td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">		<span class='keyword'>if</span> (char_cells == 1</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">			&amp;&amp; col + 1 &lt; endcol</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">			&amp;&amp; (*mb_off2cells)(off_to, max_off_to) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">		    <span class='comment'>// Writing a single-cell character over a double-cell</span></td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">		    <span class='comment'>// character: need to redraw the next cell.</span></td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">		    ScreenLines[off_to + 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">		    redraw_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (char_cells == 2</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">			&amp;&amp; col + 2 &lt; endcol</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">			&amp;&amp; (*mb_off2cells)(off_to, max_off_to) == 1</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">			&amp;&amp; (*mb_off2cells)(off_to + 1, max_off_to) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">		    <span class='comment'>// Writing the second half of a double-cell character over</span></td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">		    <span class='comment'>// a double-cell character: need to redraw the second</span></td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">		    <span class='comment'>// cell.</span></td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">		    ScreenLines[off_to + 2] = 0;</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">		    redraw_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">		<span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span>)</td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">		    ScreenLines2[off_to] = ScreenLines2[off_from];</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">	    <span class='comment'>// When writing a single-width character over a double-width</span></td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">	    <span class='comment'>// character and at the end of the redrawn text, need to clear out</span></td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">	    <span class='comment'>// the right halve of the old character.</span></td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">	    <span class='comment'>// Also required when writing the right halve of a double-width</span></td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">	    <span class='comment'>// char over the left halve of an existing one.</span></td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">	    <span class='keyword'>if</span> (has_mbyte &amp;&amp; col + char_cells == endcol</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">		    &amp;&amp; ((char_cells == 1</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off_to, max_off_to) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">			|| (char_cells == 2</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off_to, max_off_to) == 1</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off_to + 1, max_off_to) &gt; 1)))</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">		clear_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">	    ScreenLines[off_to] = ScreenLines[off_from];</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">	    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">		ScreenLinesUC[off_to] = ScreenLinesUC[off_from];</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">		<span class='keyword'>if</span> (ScreenLinesUC[off_from] != 0)</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">		    <span class='keyword'>int</span>	    i;</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">		    <span class='keyword'>for</span> (i = 0; i &lt; Screen_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">			ScreenLinesC[i][off_to] = ScreenLinesC[i][off_from];</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">	    <span class='keyword'>if</span> (char_cells == 2)</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">		ScreenLines[off_to + 1] = ScreenLines[off_from + 1];</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line"><span class='directive'>#if defined(FEAT_GUI) || defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">	    <span class='comment'>// The bold trick makes a single column of pixels appear in the</span></td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">	    <span class='comment'>// next character.  When a bold character is removed, the next</span></td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">	    <span class='comment'>// character should be redrawn too.  This happens for our own GUI</span></td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">	    <span class='comment'>// and for some xterms.</span></td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">	    <span class='keyword'>if</span> (</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line"><span class='directive'># ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">		    gui.in_use</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line"><span class='directive'># if defined(FEAT_GUI) &amp;&amp; defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">		    ||</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line"><span class='directive'># ifdef <span class='macro'>UNIX<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">		    term_is_xterm</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">		    )</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">		hl = ScreenAttrs[off_to];</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">		<span class='keyword'>if</span> (hl &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span>)</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">		    hl = syn_attr2attr(hl);</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">		<span class='keyword'>if</span> (hl &amp; <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span>)</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">		    redraw_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">	    ScreenAttrs[off_to] = ScreenAttrs[off_from];</td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">	    <span class='comment'>// For simplicity set the attributes of second half of a</span></td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">	    <span class='comment'>// double-wide character equal to the first half.</span></td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">	    <span class='keyword'>if</span> (char_cells == 2)</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">		ScreenAttrs[off_to + 1] = ScreenAttrs[off_from];</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">	    <span class='keyword'>if</span> (enc_dbcs != 0 &amp;&amp; char_cells == 2)</td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">		screen_char_2(off_to, row, col + coloff);</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">		screen_char(off_to, row, col + coloff);</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (  p_wiv</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">		&amp;&amp; !gui.in_use</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">		&amp;&amp; col + coloff &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">	    <span class='keyword'>if</span> (ScreenAttrs[off_to] == ScreenAttrs[off_to - 1])</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">		 <span class='comment'>* Don't output stop-highlight when moving the cursor, it will</span></td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">		 <span class='comment'>* stop the highlighting when it should continue.</span></td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">		screen_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (screen_attr != 0)</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">		screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">	off_to += <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>;</td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">	off_from += <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>;</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">	col += <span class='macro'>CHAR_CELLS<span class='macro_popup'>char_cells</span></span>;</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">    <span class='keyword'>if</span> (clear_next)</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">	<span class='comment'>// Clear the second half of a double-wide character of which the left</span></td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">	<span class='comment'>// half was overwritten with a single-wide character.</span></td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">	ScreenLines[off_to] = ' ';</td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">	<span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">	    ScreenLinesUC[off_to] = 0;</td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line">	screen_char(off_to, row, col + coloff);</td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">    <span class='keyword'>if</span> (clear_width &gt; 0</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">		    &amp;&amp; !(flags &amp; <span class='macro'>SLF_RIGHTLEFT<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">				   )</td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">	<span class='keyword'>int</span> startCol = col;</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">	<span class='comment'>// blank out the rest of the line</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">	<span class='keyword'>while</span> (col &lt; clear_width &amp;&amp; ScreenLines[off_to] == ' '</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">						  &amp;&amp; ScreenAttrs[off_to] == 0</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">				  &amp;&amp; (!enc_utf8 || ScreenLinesUC[off_to] == 0))</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">	    ++off_to;</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">	    ++col;</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">	<span class='keyword'>if</span> (col &lt; clear_width)</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line">	     <span class='comment'>* In the GUI, clearing the rest of the line may leave pixels</span></td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">	     <span class='comment'>* behind if the first character cleared was bold.  Some bold</span></td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line">	     <span class='comment'>* fonts spill over the left.  In this case we redraw the previous</span></td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">	     <span class='comment'>* character too.  If we didn't skip any blanks above, then we</span></td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">	     <span class='comment'>* only redraw if the character wasn't already redrawn anyway.</span></td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">	    <span class='keyword'>if</span> (gui.in_use &amp;&amp; (col &gt; startCol || !redraw_this))</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line">		hl = ScreenAttrs[off_to];</td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">		<span class='keyword'>if</span> (hl &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span> || (hl &amp; <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span>))</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">		    <span class='keyword'>int</span> prev_cells = 1;</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">		    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">			<span class='comment'>// for utf-8, ScreenLines[char_offset + 1] == 0 means</span></td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">			<span class='comment'>// that its width is 2.</span></td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">			prev_cells = ScreenLines[off_to - 1] == 0 ? 2 : 1;</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">		    <span class='keyword'>else</span> <span class='keyword'>if</span> (enc_dbcs != 0)</td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">			<span class='comment'>// find previous character by counting from first</span></td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">			<span class='comment'>// column and get its width.</span></td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">			<span class='keyword'>unsigned</span> off = LineOffset[row];</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">			<span class='keyword'>unsigned</span> max_off = LineOffset[row] + screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">			<span class='keyword'>while</span> (off &lt; off_to)</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">			{</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">			    prev_cells = (*mb_off2cells)(off, max_off);</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">			    off += prev_cells;</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">		    <span class='keyword'>if</span> (enc_dbcs != 0 &amp;&amp; prev_cells &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">			screen_char_2(off_to - prev_cells, row,</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">						   col + coloff - prev_cells);</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">			screen_char(off_to - prev_cells, row,</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">						   col + coloff - prev_cells);</td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">	    screen_fill(row, row + 1, col + coloff, clear_width + coloff,</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">								 ' ', ' ', 0);</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">	    off_to += clear_width - col;</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">	    col = clear_width;</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">    <span class='keyword'>if</span> (clear_width &gt; 0</td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">	    &amp;&amp; !(flags &amp; <span class='macro'>SLF_POPUP<span class='macro_popup'>2</span></span>)  <span class='comment'>// no separator for popup window</span></td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">	    )</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">	<span class='comment'>// For a window that has a right neighbor, draw the separator char</span></td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line">	<span class='comment'>// right of the window contents.  But not on top of a popup window.</span></td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">	<span class='keyword'>if</span> (coloff + col &lt; Columns)</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">	    <span class='keyword'>if</span> (!blocked_by_popup(row, col + coloff))</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">		<span class='keyword'>int</span> c;</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">		c = fillchar_vsep(&amp;hl);</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">		<span class='keyword'>if</span> (ScreenLines[off_to] != (schar_T)c</td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">			|| (enc_utf8 &amp;&amp; (<span class='keyword'>int</span>)ScreenLinesUC[off_to]</td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">							!= (c &gt;= 0x80 ? c : 0))</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">			|| ScreenAttrs[off_to] != hl)</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">		    ScreenLines[off_to] = c;</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">		    ScreenAttrs[off_to] = hl;</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">		    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">			<span class='keyword'>if</span> (c &gt;= 0x80)</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">			{</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">			    ScreenLinesUC[off_to] = c;</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">			    ScreenLinesC[0][off_to] = 0;</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">			    ScreenLinesUC[off_to] = 0;</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">		    screen_char(off_to, row, col + coloff);</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">	    LineWraps[row] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line"><span class='directive'>#if defined(FEAT_RIGHTLEFT) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"> <span class='comment'>* Mirror text "str" for right-left displaying.</span></td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line"> <span class='comment'>* Only works for single-byte characters (e.g., numbers).</span></td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">rl_mirror(char_u *str)</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">    char_u	*p1, *p2;</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">    <span class='keyword'>int</span>		t;</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">    <span class='keyword'>for</span> (p1 = str, p2 = str + <span class='macro'>STRLEN(str)<span class='macro_popup'>strlen((char *)(str))</span></span> - 1; p1 &lt; p2; ++p1, --p2)</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">	t = *p1;</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">	*p1 = *p2;</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">	*p2 = t;</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line"> <span class='comment'>* Draw the verticap separator right of window "wp" starting with line "row".</span></td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">draw_vsep_win(win_T *wp, <span class='keyword'>int</span> row)</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">    <span class='keyword'>int</span>		hl;</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">    <span class='keyword'>int</span>		c;</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;w_vsep_width)</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line">	<span class='comment'>// draw the vertical separator right of this window</span></td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">	c = fillchar_vsep(&amp;hl);</td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + wp-&gt;w_height,</td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">		<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span>, <span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span> + 1,</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">		c, ' ', hl);</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line"><span class='directive'>#ifdef FEAT_WILDMENU</span></td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> skip_status_match_char(expand_T *xp, char_u *s);</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line"> <span class='comment'>* Get the length of an item as it will be shown in the status line.</span></td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">status_match_len(expand_T *xp, char_u *s)</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">    <span class='keyword'>int</span>	len = 0;</td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line"><span class='directive'>#ifdef FEAT_MENU</span></td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">    <span class='keyword'>int</span> emenu = (xp-&gt;xp_context == <span class='macro'>EXPAND_MENUS<span class='macro_popup'>11</span></span></td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">	    || xp-&gt;xp_context == <span class='macro'>EXPAND_MENUNAMES<span class='macro_popup'>21</span></span>);</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">    <span class='comment'>// Check for menu separators - replace with '|'.</span></td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">    <span class='keyword'>if</span> (emenu &amp;&amp; menu_is_separator(s))</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">    <span class='keyword'>while</span> (*s != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">	s += skip_status_match_char(xp, s);</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">	len += ptr2cells(s);</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">	<span class='macro'>MB_PTR_ADV(s)<span class='macro_popup'>s += (*mb_ptr2len)(s)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line">    <span class='keyword'>return</span> len;</td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line"> <span class='comment'>* Return the number of characters that should be skipped in a status match.</span></td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line"> <span class='comment'>* These are backslashes used for escaping.  Do show backslashes in help tags.</span></td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">skip_status_match_char(expand_T *xp, char_u *s)</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">    <span class='keyword'>if</span> ((rem_backslash(s) &amp;&amp; xp-&gt;xp_context != <span class='macro'>EXPAND_HELP<span class='macro_popup'>8</span></span>)</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line"><span class='directive'>#ifdef FEAT_MENU</span></td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line">	    || ((xp-&gt;xp_context == <span class='macro'>EXPAND_MENUS<span class='macro_popup'>11</span></span></td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">		    || xp-&gt;xp_context == <span class='macro'>EXPAND_MENUNAMES<span class='macro_popup'>21</span></span>)</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">			  &amp;&amp; (s[0] == '\t' || (s[0] == '\\' &amp;&amp; s[1] != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)))</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">	   )</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line"><span class='directive'>#ifndef BACKSLASH_IN_FILENAME</span></td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">	<span class='keyword'>if</span> (xp-&gt;xp_shell &amp;&amp; csh_like_shell() &amp;&amp; s[1] == '\\' &amp;&amp; s[2] == '!')</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">	    <span class='keyword'>return</span> 2;</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line"> <span class='comment'>* Show wildchar matches in the status line.</span></td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line"> <span class='comment'>* Show at least the "match" item.</span></td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line"> <span class='comment'>* We start at item 'first_match' in the list and show all matches that fit.</span></td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line"> <span class='comment'>* If inversion is possible we use it. Else '=' characters are used.</span></td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">win_redr_status_matches(</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">    expand_T	*xp,</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">    <span class='keyword'>int</span>		num_matches,</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line">    char_u	**matches,	<span class='comment'>// list of matches</span></td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line">    <span class='keyword'>int</span>		match,</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">    <span class='keyword'>int</span>		showtail)</td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line"><span class='directive'>#define <span class='macro'>L_MATCH(m)<span class='macro_popup'>(showtail ? sm_gettail(matches[m]) : matches[m])</span></span> (showtail ? sm_gettail(matches[m]) : matches[m])</span></td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">    <span class='keyword'>int</span>		row;</td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line">    char_u	*buf;</td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">    <span class='keyword'>int</span>		len;</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">    <span class='keyword'>int</span>		clen;		<span class='comment'>// length in screen cells</span></td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">    <span class='keyword'>int</span>		fillchar;</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">    <span class='keyword'>int</span>		attr;</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">    <span class='keyword'>int</span>		i;</td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">    <span class='keyword'>int</span>		highlight = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">    char_u	*selstart = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">    <span class='keyword'>int</span>		selstart_col = 0;</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">    char_u	*selend = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span>	first_match = 0;</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">    <span class='keyword'>int</span>		add_left = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">    char_u	*s;</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line"><span class='directive'>#ifdef FEAT_MENU</span></td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">    <span class='keyword'>int</span>		emenu;</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">    <span class='keyword'>int</span>		l;</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">    <span class='keyword'>if</span> (matches == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)	<span class='comment'>// interrupted completion?</span></td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">    <span class='keyword'>if</span> (has_mbyte)</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line">	buf = alloc(Columns * <span class='macro'>MB_MAXBYTES<span class='macro_popup'>21</span></span> + 1);</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">	buf = alloc(Columns + 1);</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">    <span class='keyword'>if</span> (buf == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line">    <span class='keyword'>if</span> (match == -1)	<span class='comment'>// don't show match but original text</span></td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">	match = 0;</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">	highlight = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">    <span class='comment'>// count 1 for the ending "&gt;"</span></td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">    clen = status_match_len(xp, <span class='macro'>L_MATCH(match)<span class='macro_popup'>(showtail ? sm_gettail(matches[match]) : matches[match])</span></span>) + 3;</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line">    <span class='keyword'>if</span> (match == 0)</td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">	first_match = 0;</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (match &lt; first_match)</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">	<span class='comment'>// jumping left, as far as we can go</span></td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">	first_match = match;</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">	add_left = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">	<span class='comment'>// check if match fits on the screen</span></td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line">	<span class='keyword'>for</span> (i = first_match; i &lt; match; ++i)</td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">	    clen += status_match_len(xp, <span class='macro'>L_MATCH(i)<span class='macro_popup'>(showtail ? sm_gettail(matches[i]) : matches[i])</span></span>) + 2;</td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">	<span class='keyword'>if</span> (first_match &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">	    clen += 2;</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">	<span class='comment'>// jumping right, put match at the left</span></td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">	<span class='keyword'>if</span> ((<span class='keyword'>long</span>)clen &gt; Columns)</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">	    first_match = match;</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">	    <span class='comment'>// if showing the last match, we can add some on the left</span></td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">	    clen = 2;</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">	    <span class='keyword'>for</span> (i = match; i &lt; num_matches; ++i)</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line">		clen += status_match_len(xp, <span class='macro'>L_MATCH(i)<span class='macro_popup'>(showtail ? sm_gettail(matches[i]) : matches[i])</span></span>) + 2;</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">		<span class='keyword'>if</span> ((<span class='keyword'>long</span>)clen &gt;= Columns)</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">		    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line">	    <span class='keyword'>if</span> (i == num_matches)</td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">		add_left = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">    <span class='keyword'>if</span> (add_left)</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">	<span class='keyword'>while</span> (first_match &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">	    clen += status_match_len(xp, <span class='macro'>L_MATCH(first_match - 1)<span class='macro_popup'>(showtail ? sm_gettail(matches[first_match - 1]) : matches[first_match<br> - 1])</span></span>) + 2;</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line">	    <span class='keyword'>if</span> ((<span class='keyword'>long</span>)clen &gt;= Columns)</td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">	    --first_match;</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">    fillchar = fillchar_status(&amp;attr, curwin);</td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line">    <span class='keyword'>if</span> (first_match == 0)</td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">	*buf = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">	len = 0;</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">	<span class='macro'>STRCPY(buf, <span class='string_literal'>"&lt; "</span>)<span class='macro_popup'>strcpy((char *)(buf), (char *)("&lt; "))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">	len = 2;</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    clen = len;</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">    i = first_match;</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">    <span class='keyword'>while</span> ((<span class='keyword'>long</span>)(clen + status_match_len(xp, <span class='macro'>L_MATCH(i)<span class='macro_popup'>(showtail ? sm_gettail(matches[i]) : matches[i])</span></span>) + 2) &lt; Columns)</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">	<span class='keyword'>if</span> (i == match)</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">	    selstart = buf + len;</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">	    selstart_col = clen;</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">	s = <span class='macro'>L_MATCH(i)<span class='macro_popup'>(showtail ? sm_gettail(matches[i]) : matches[i])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">	<span class='comment'>// Check for menu separators - replace with '|'</span></td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line"><span class='directive'>#ifdef FEAT_MENU</span></td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">	emenu = (xp-&gt;xp_context == <span class='macro'>EXPAND_MENUS<span class='macro_popup'>11</span></span></td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">		|| xp-&gt;xp_context == <span class='macro'>EXPAND_MENUNAMES<span class='macro_popup'>21</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">	<span class='keyword'>if</span> (emenu &amp;&amp; menu_is_separator(s))</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">	    <span class="mrange"><span class='macro'>STRCPY</span>(buf + len, transchar('|'))<span class='macro_popup'>strcpy((char *)(buf + len), (char *)(transchar('|')))</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:13ex; max-width:52em">Call to function 'strcpy' is insecure as it does not provide bounding of the memory buffer. Replace unbounded copy functions with analogous functions that support length arguments such as 'strlcpy'. CWE-119</div></td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">	    l = (<span class='keyword'>int</span>)<span class='macro'>STRLEN(buf + len)<span class='macro_popup'>strlen((char *)(buf + len))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">	    len += l;</td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">	    clen += l;</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">	    <span class='keyword'>for</span> ( ; *s != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>; ++s)</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">	    s += skip_status_match_char(xp, s);</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">	    clen += ptr2cells(s);</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">	    <span class='keyword'>if</span> (has_mbyte &amp;&amp; (l = (*mb_ptr2len)(s)) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">		<span class='macro'>STRNCPY(buf + len, s, l)<span class='macro_popup'>strncpy((char *)(buf + len), (char *)(s), (size_t)(l))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">		s += l - 1;</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">		len += l;</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">		<span class='macro'>STRCPY(buf + len, transchar_byte(*s))<span class='macro_popup'>strcpy((char *)(buf + len), (char *)(transchar_byte(*s)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">		len += (<span class='keyword'>int</span>)<span class='macro'>STRLEN(buf + len)<span class='macro_popup'>strlen((char *)(buf + len))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">	<span class='keyword'>if</span> (i == match)</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">	    selend = buf + len;</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line">	*(buf + len++) = ' ';</td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">	*(buf + len++) = ' ';</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">	clen += 2;</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">	<span class='keyword'>if</span> (++i == num_matches)</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">    <span class='keyword'>if</span> (i != num_matches)</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">	*(buf + len++) = '&gt;';</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">	++clen;</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">    buf[len] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">    row = cmdline_row - 1;</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">    <span class='keyword'>if</span> (row &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">	<span class='keyword'>if</span> (wild_menu_showing == 0)</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">	    <span class='keyword'>if</span> (msg_scrolled &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">		<span class='comment'>// Put the wildmenu just above the command line.  If there is</span></td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">		<span class='comment'>// no room, scroll the screen one line up.</span></td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">		<span class='keyword'>if</span> (cmdline_row == Rows - 1)</td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">		    screen_del_lines(0, 0, 1, (<span class='keyword'>int</span>)Rows, <span class='macro'>TRUE<span class='macro_popup'>1</span></span>, 0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">		    ++msg_scrolled;</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">		    ++cmdline_row;</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">		    ++row;</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">		wild_menu_showing = <span class='macro'>WM_SCROLLED<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">		<span class='comment'>// Create status line if needed by setting 'laststatus' to 2.</span></td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">		<span class='comment'>// Set 'winminheight' to zero to avoid that the window is</span></td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">		<span class='comment'>// resized.</span></td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">		<span class='keyword'>if</span> (lastwin-&gt;w_status_height == 0)</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">		    save_p_ls = p_ls;</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">		    save_p_wmh = p_wmh;</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">		    p_ls = 2;</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">		    p_wmh = 0;</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">		    last_status(<span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">		wild_menu_showing = <span class='macro'>WM_SHOWN<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">	screen_puts(buf, row, 0, attr);</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">	<span class='keyword'>if</span> (selstart != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; highlight)</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">	    *selend = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">	    screen_puts(selstart, row, selstart_col, <span class='macro'>HL_ATTR(HLF_WM)<span class='macro_popup'>highlight_attr[(int)(HLF_WM)]</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">	screen_fill(row, row + 1, clen, (<span class='keyword'>int</span>)Columns, fillchar, fillchar, attr);</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">    win_redraw_last_status(topframe);</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">    vim_free(buf);</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line"> <span class='comment'>* Return TRUE if the status line of window "wp" is connected to the status</span></td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line"> <span class='comment'>* line of the window right of it.  If not, then it's a vertical separator.</span></td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line"> <span class='comment'>* Only call if (wp-&gt;w_vsep_width != 0).</span></td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">stl_connected(win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">    frame_T	*fr;</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">    fr = wp-&gt;w_frame;</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">    <span class='keyword'>while</span> (fr-&gt;fr_parent != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">	<span class='keyword'>if</span> (fr-&gt;fr_parent-&gt;fr_layout == <span class='macro'>FR_COL<span class='macro_popup'>2</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">	    <span class='keyword'>if</span> (fr-&gt;fr_next != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">	    <span class='keyword'>if</span> (fr-&gt;fr_next != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">	fr = fr-&gt;fr_parent;</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line"> <span class='comment'>* Get the value to show for the language mappings, active 'keymap'.</span></td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">get_keymap_str(</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">    char_u	*fmt,	    <span class='comment'>// format string containing one %s item</span></td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">    char_u	*buf,	    <span class='comment'>// buffer for the result</span></td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line">    <span class='keyword'>int</span>		len)	    <span class='comment'>// length of buffer</span></td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">    char_u	*p;</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;w_buffer-&gt;b_p_iminsert != <span class='macro'>B_IMODE_LMAP<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line"><span class='directive'>#ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">	buf_T	*old_curbuf = curbuf;</td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">	win_T	*old_curwin = curwin;</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">	char_u	*s;</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">	curbuf = wp-&gt;w_buffer;</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">	curwin = wp;</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">	<span class='macro'>STRCPY(buf, <span class='string_literal'>"b:keymap_name"</span>)<span class='macro_popup'>strcpy((char *)(buf), (char *)("b:keymap_name"))</span></span>;	<span class='comment'>// must be writable</span></td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">	++emsg_skip;</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">	s = p = eval_to_string(buf, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">	--emsg_skip;</td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">	curbuf = old_curbuf;</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">	curwin = old_curwin;</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">	<span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || *p == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line"><span class='directive'>#ifdef FEAT_KEYMAP</span></td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">	    <span class='keyword'>if</span> (wp-&gt;w_buffer-&gt;b_kmap_state &amp; <span class='macro'>KEYMAP_LOADED<span class='macro_popup'>2</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">		p = wp-&gt;w_buffer-&gt;b_p_keymap;</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">		p = (char_u *)<span class='string_literal'>"lang"</span>;</td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">	<span class='keyword'>if</span> (vim_snprintf((<span class='keyword'>char</span> *)buf, len, (<span class='keyword'>char</span> *)fmt, p) &gt; len - 1)</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">	    buf[0] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line"><span class='directive'>#ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">	vim_free(s);</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">    <span class='keyword'>return</span> buf[0] != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line"><span class='directive'>#if defined(FEAT_STL_OPT) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line"> <span class='comment'>* Redraw the status line or ruler of window "wp".</span></td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line"> <span class='comment'>* When "wp" is NULL redraw the tab pages line from 'tabline'.</span></td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">win_redr_custom(</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">    <span class='keyword'>int</span>		draw_ruler)	<span class='comment'>// TRUE or FALSE</span></td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span>	entered = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">    <span class='keyword'>int</span>		attr;</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">    <span class='keyword'>int</span>		curattr;</td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">    <span class='keyword'>int</span>		row;</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">    <span class='keyword'>int</span>		col = 0;</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">    <span class='keyword'>int</span>		maxwidth;</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">    <span class='keyword'>int</span>		width;</td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">    <span class='keyword'>int</span>		n;</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">    <span class='keyword'>int</span>		len;</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">    <span class='keyword'>int</span>		fillchar;</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">    char_u	buf[<span class='macro'>MAXPATHL<span class='macro_popup'>4096</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">    char_u	*stl;</td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">    char_u	*p;</td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">    stl_hlrec_T *hltab;</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">    stl_hlrec_T *tabtab;</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">    <span class='keyword'>int</span>		use_sandbox = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">    win_T	*ewp;</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">    <span class='keyword'>int</span>		p_crb_save;</td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">    <span class='comment'>// There is a tiny chance that this gets called recursively: When</span></td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">    <span class='comment'>// redrawing a status line triggers redrawing the ruler or tabline.</span></td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">    <span class='comment'>// Avoid trouble by not allowing recursion.</span></td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">    <span class='keyword'>if</span> (entered)</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">    entered = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">    <span class='comment'>// setup environment for the task at hand</span></td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">    <span class='keyword'>if</span> (wp == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">	<span class='comment'>// Use 'tabline'.  Always at the first line of the screen.</span></td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">	stl = p_tal;</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">	row = 0;</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">	fillchar = ' ';</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">	attr = <span class='macro'>HL_ATTR(HLF_TPF)<span class='macro_popup'>highlight_attr[(int)(HLF_TPF)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">	maxwidth = Columns;</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line"><span class='directive'># ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">	use_sandbox = was_set_insecurely((char_u *)<span class='string_literal'>"tabline"</span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line">	row = <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + wp-&gt;w_height;</td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line">	fillchar = fillchar_status(&amp;attr, wp);</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">	maxwidth = wp-&gt;w_width;</td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">	<span class='keyword'>if</span> (draw_ruler)</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">	    stl = p_ruf;</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">	    <span class='comment'>// advance past any leading group spec - implicit in ru_col</span></td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">	    <span class='keyword'>if</span> (*stl == '%')</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">		<span class='keyword'>if</span> (*++stl == '-')</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">		    stl++;</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">		<span class='keyword'>if</span> (atoi((<span class='keyword'>char</span> *)stl))</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">		    <span class='keyword'>while</span> (<span class='macro'>VIM_ISDIGIT(*stl)<span class='macro_popup'>((unsigned)(*stl) - '0' &lt; 10)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">			stl++;</td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">		<span class='keyword'>if</span> (*stl++ != '(')</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">		    stl = p_ruf;</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">	    col = ru_col - (Columns - wp-&gt;w_width);</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">	    <span class='keyword'>if</span> (col &lt; (wp-&gt;w_width + 1) / 2)</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">		col = (wp-&gt;w_width + 1) / 2;</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">	    maxwidth = wp-&gt;w_width - col;</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">	    <span class='keyword'>if</span> (!wp-&gt;w_status_height)</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">		row = Rows - 1;</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">		--maxwidth;	<span class='comment'>// writing in last column may cause scrolling</span></td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">		fillchar = ' ';</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">		attr = 0;</td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line"><span class='directive'># ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">	    use_sandbox = was_set_insecurely((char_u *)<span class='string_literal'>"rulerformat"</span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">	    <span class='keyword'>if</span> (*wp-&gt;<span class='macro'>w_p_stl<span class='macro_popup'>w_onebuf_opt.wo_stl</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">		stl = wp-&gt;<span class='macro'>w_p_stl<span class='macro_popup'>w_onebuf_opt.wo_stl</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">		stl = p_stl;</td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line"><span class='directive'># ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">	    use_sandbox = was_set_insecurely((char_u *)<span class='string_literal'>"statusline"</span>,</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">					 *wp-&gt;<span class='macro'>w_p_stl<span class='macro_popup'>w_onebuf_opt.wo_stl</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> ? 0 : <span class='macro'>OPT_LOCAL<span class='macro_popup'>0x04</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">	col += wp-&gt;w_wincol;</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">    <span class='keyword'>if</span> (maxwidth &lt;= 0)</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">	<span class='keyword'>goto</span> theend;</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">    <span class='comment'>// Temporarily reset 'cursorbind', we don't want a side effect from moving</span></td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">    <span class='comment'>// the cursor away and back.</span></td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">    ewp = wp == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> ? curwin : wp;</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">    p_crb_save = ewp-&gt;<span class='macro'>w_p_crb<span class='macro_popup'>w_onebuf_opt.wo_crb</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">    ewp-&gt;<span class='macro'>w_p_crb<span class='macro_popup'>w_onebuf_opt.wo_crb</span></span> = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">    <span class='comment'>// Make a copy, because the statusline may include a function call that</span></td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">    <span class='comment'>// might change the option value and free the memory.</span></td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">    stl = vim_strsave(stl);</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">    width = build_stl_str_hl(ewp, buf, <span class='keyword'>sizeof</span>(buf),</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">				stl, use_sandbox,</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">				fillchar, maxwidth, &amp;hltab, &amp;tabtab);</td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">    vim_free(stl);</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">    ewp-&gt;<span class='macro'>w_p_crb<span class='macro_popup'>w_onebuf_opt.wo_crb</span></span> = p_crb_save;</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">    <span class='comment'>// Make all characters printable.</span></td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line">    p = transstr(buf);</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">    <span class='keyword'>if</span> (p != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">	vim_strncpy(buf, p, <span class='keyword'>sizeof</span>(buf) - 1);</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line">	vim_free(p);</td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line">    <span class='comment'>// fill up with "fillchar"</span></td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line">    len = (<span class='keyword'>int</span>)<span class='macro'>STRLEN(buf)<span class='macro_popup'>strlen((char *)(buf))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line">    <span class='keyword'>while</span> (width &lt; maxwidth &amp;&amp; len &lt; (<span class='keyword'>int</span>)<span class='keyword'>sizeof</span>(buf) - 1)</td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">	len += (*mb_char2bytes)(fillchar, buf + len);</td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">	++width;</td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line">    buf[len] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">     <span class='comment'>* Draw each snippet with the specified highlighting.</span></td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">    curattr = attr;</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">    p = buf;</td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line">    <span class='keyword'>for</span> (n = 0; hltab[n].start != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; n++)</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">	len = (<span class='keyword'>int</span>)(hltab[n].start - p);</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">	screen_puts_len(p, len, row, col, curattr);</td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">	col += vim_strnsize(p, len);</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">	p = hltab[n].start;</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line">	<span class='keyword'>if</span> (hltab[n].userhl == 0)</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">	    curattr = attr;</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (hltab[n].userhl &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">	    curattr = syn_id2attr(-hltab[n].userhl);</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line"><span class='directive'>#ifdef <span class='macro'>FEAT_TERMINAL<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp != curwin &amp;&amp; bt_terminal(wp-&gt;w_buffer)</td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">						   &amp;&amp; wp-&gt;w_status_height != 0)</td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">	    curattr = highlight_stltermnc[hltab[n].userhl - 1];</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; bt_terminal(wp-&gt;w_buffer)</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">						   &amp;&amp; wp-&gt;w_status_height != 0)</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">	    curattr = highlight_stlterm[hltab[n].userhl - 1];</td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp != curwin &amp;&amp; wp-&gt;w_status_height != 0)</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">	    curattr = highlight_stlnc[hltab[n].userhl - 1];</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">	    curattr = highlight_user[hltab[n].userhl - 1];</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">    screen_puts(p, row, col, curattr);</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">    <span class='keyword'>if</span> (wp == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">	<span class='comment'>// Fill the TabPageIdxs[] array for clicking in the tab pagesline.</span></td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">	col = 0;</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">	len = 0;</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">	p = buf;</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">	fillchar = 0;</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">	<span class='keyword'>for</span> (n = 0; tabtab[n].start != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; n++)</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">	    len += vim_strnsize(p, (<span class='keyword'>int</span>)(tabtab[n].start - p));</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">	    <span class='keyword'>while</span> (col &lt; len)</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">		TabPageIdxs[col++] = fillchar;</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">	    p = tabtab[n].start;</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">	    fillchar = tabtab[n].userhl;</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">	<span class='keyword'>while</span> (col &lt; Columns)</td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">	    TabPageIdxs[col++] = fillchar;</td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line">theend:</td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">    entered = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"><span class='directive'>#endif // FEAT_STL_OPT</span></td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line"> <span class='comment'>* Output a single character directly to the screen and update ScreenLines.</span></td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line">screen_putchar(<span class='keyword'>int</span> c, <span class='keyword'>int</span> row, <span class='keyword'>int</span> col, <span class='keyword'>int</span> attr)</td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">    char_u	buf[<span class='macro'>MB_MAXBYTES<span class='macro_popup'>21</span></span> + 1];</td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">    <span class='keyword'>if</span> (has_mbyte)</td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">	buf[(*mb_char2bytes)(c, buf)] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">	buf[0] = c;</td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">	buf[1] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">    screen_puts(buf, row, col, attr);</td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line"> <span class='comment'>* Get a single character directly from ScreenLines into "bytes[]".</span></td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line"> <span class='comment'>* Also return its attribute in *attrp;</span></td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line">screen_getbytes(<span class='keyword'>int</span> row, <span class='keyword'>int</span> col, char_u *bytes, <span class='keyword'>int</span> *attrp)</td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">    <span class='keyword'>unsigned</span> off;</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">    <span class='comment'>// safety check</span></td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">    <span class='keyword'>if</span> (ScreenLines != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; row &lt; screen_Rows &amp;&amp; col &lt; screen_Columns)</td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">	off = LineOffset[row] + col;</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">	*attrp = ScreenAttrs[off];</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">	bytes[0] = ScreenLines[off];</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">	bytes[1] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">	<span class='keyword'>if</span> (enc_utf8 &amp;&amp; ScreenLinesUC[off] != 0)</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">	    bytes[utfc_char2bytes(off, bytes)] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; ScreenLines[off] == 0x8e)</td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">	    bytes[0] = ScreenLines[off];</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">	    bytes[1] = ScreenLines2[off];</td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line">	    bytes[2] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (enc_dbcs &amp;&amp; <span class='macro'>MB_BYTE2LEN(bytes[0])<span class='macro_popup'>mb_bytelen_tab[bytes[0]]</span></span> &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">	    bytes[1] = ScreenLines[off + 1];</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">	    bytes[2] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line"> <span class='comment'>* Return TRUE if composing characters for screen posn "off" differs from</span></td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line"> <span class='comment'>* composing characters in "u8cc".</span></td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line"> <span class='comment'>* Only to be used when ScreenLinesUC[off] != 0.</span></td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">screen_comp_differs(<span class='keyword'>int</span> off, <span class='keyword'>int</span> *u8cc)</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">    <span class='keyword'>int</span>	    i;</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; Screen_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">	<span class='keyword'>if</span> (ScreenLinesC[i][off] != (u8char_T)u8cc[i])</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">	    <span class='keyword'>return</span> <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">	<span class='keyword'>if</span> (u8cc[i] == 0)</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">	    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line"> <span class='comment'>* Put string '*text' on the screen at position 'row' and 'col', with</span></td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line"> <span class='comment'>* attributes 'attr', and update ScreenLines[] and ScreenAttrs[].</span></td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line"> <span class='comment'>* Note: only outputs within one row, message is truncated at screen boundary!</span></td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line"> <span class='comment'>* Note: if ScreenLines[], row and/or col is invalid, nothing is done.</span></td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">screen_puts(</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">    char_u	*text,</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">    <span class='keyword'>int</span>		col,</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">    <span class='keyword'>int</span>		attr)</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">    screen_puts_len(text, -1, row, col, attr);</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line"> <span class='comment'>* Like screen_puts(), but output "text[len]".  When "len" is -1 output up to</span></td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line"> <span class='comment'>* a NUL.</span></td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">screen_puts_len(</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">    char_u	*text,</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">    <span class='keyword'>int</span>		textlen,</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">    <span class='keyword'>int</span>		col,</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">    <span class='keyword'>int</span>		attr)</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">    <span class='keyword'>unsigned</span>	off;</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">    char_u	*ptr = text;</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line">    <span class='keyword'>int</span>		len = textlen;</td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">    <span class='keyword'>int</span>		c;</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">    <span class='keyword'>unsigned</span>	max_off;</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">    <span class='keyword'>int</span>		mbyte_blen = 1;</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">    <span class='keyword'>int</span>		mbyte_cells = 1;</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">    <span class='keyword'>int</span>		u8c = 0;</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">    <span class='keyword'>int</span>		u8cc[<span class='macro'>MAX_MCO<span class='macro_popup'>6</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">    <span class='keyword'>int</span>		clear_next_cell = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line"><span class='directive'>#ifdef FEAT_ARABIC</span></td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">    <span class='keyword'>int</span>		prev_c = 0;		<span class='comment'>// previous Arabic character</span></td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">    <span class='keyword'>int</span>		pc, nc, nc1;</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">    <span class='keyword'>int</span>		pcc[<span class='macro'>MAX_MCO<span class='macro_popup'>6</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line">    <span class='keyword'>int</span>		force_redraw_this;</td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line">    <span class='keyword'>int</span>		force_redraw_next = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line">    <span class='keyword'>int</span>		need_redraw;</td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">    <span class='comment'>// Safety check. The check for negative row and column is to fix issue</span></td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">    <span class='comment'>// #4102. TODO: find out why row/col could be negative.</span></td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">    <span class='keyword'>if</span> (ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">	    || row &gt;= screen_Rows || row &lt; 0</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">	    || col &gt;= screen_Columns || col &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">    off = LineOffset[row] + col;</td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">    <span class='comment'>// When drawing over the right halve of a double-wide char clear out the</span></td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">    <span class='comment'>// left halve.  Only needed in a terminal.</span></td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">    <span class='keyword'>if</span> (has_mbyte &amp;&amp; col &gt; 0 &amp;&amp; col &lt; screen_Columns</td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">	    &amp;&amp; !gui.in_use</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">	    &amp;&amp; mb_fix_col(col, row) != col)</td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">	ScreenLines[off - 1] = ' ';</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">	ScreenAttrs[off - 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">	<span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">	    ScreenLinesUC[off - 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">	    ScreenLinesC[0][off - 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line">	<span class='comment'>// redraw the previous cell, make it empty</span></td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">	screen_char(off - 1, row, col - 1);</td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line">	<span class='comment'>// force the cell at "col" to be redrawn</span></td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">	force_redraw_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">    max_off = LineOffset[row] + screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">    <span class='keyword'>while</span> (col &lt; screen_Columns</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">	    &amp;&amp; (len &lt; 0 || (<span class='keyword'>int</span>)(ptr - text) &lt; len)</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line">	    &amp;&amp; *ptr != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">	c = *ptr;</td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">	<span class='comment'>// check if this is the first byte of a multibyte</span></td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">	<span class='keyword'>if</span> (has_mbyte)</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">	    <span class='keyword'>if</span> (enc_utf8 &amp;&amp; len &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">		mbyte_blen = utfc_ptr2len_len(ptr, (<span class='keyword'>int</span>)((text + len) - ptr));</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">		mbyte_blen = (*mb_ptr2len)(ptr);</td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">	    <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; c == 0x8e)</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">		mbyte_cells = 1;</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (enc_dbcs != 0)</td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">		mbyte_cells = mbyte_blen;</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">	    <span class='keyword'>else</span>	<span class='comment'>// enc_utf8</span></td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">		<span class='keyword'>if</span> (len &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">		    u8c = utfc_ptr2char_len(ptr, u8cc,</td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">						   (<span class='keyword'>int</span>)((text + len) - ptr));</td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">		    u8c = utfc_ptr2char(ptr, u8cc);</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">		mbyte_cells = utf_char2cells(u8c);</td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line"><span class='directive'>#ifdef FEAT_ARABIC</span></td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line">		<span class='keyword'>if</span> (p_arshape &amp;&amp; !p_tbidi &amp;&amp; <span class='macro'>ARABIC_CHAR(u8c)<span class='macro_popup'>(((u8c) &amp; 0xFF00) == 0x0600)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">		    <span class='comment'>// Do Arabic shaping.</span></td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">		    <span class='keyword'>if</span> (len &gt;= 0 &amp;&amp; (<span class='keyword'>int</span>)(ptr - text) + mbyte_blen &gt;= len)</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">			<span class='comment'>// Past end of string to be displayed.</span></td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">			nc = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">			nc1 = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">			nc = utfc_ptr2char_len(ptr + mbyte_blen, pcc,</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">				      (<span class='keyword'>int</span>)((text + len) - ptr - mbyte_blen));</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">			nc1 = pcc[0];</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">		    pc = prev_c;</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">		    prev_c = u8c;</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">		    u8c = arabic_shape(u8c, &amp;c, &amp;u8cc[0], nc, nc1, pc);</td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">		    prev_c = u8c;</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">		<span class='keyword'>if</span> (col + mbyte_cells &gt; screen_Columns)</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">		    <span class='comment'>// Only 1 cell left, but character requires 2 cells:</span></td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">		    <span class='comment'>// display a '&gt;' in the last column to avoid wrapping.</span></td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line">		    c = '&gt;';</td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">		    mbyte_cells = 1;</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">	force_redraw_this = force_redraw_next;</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">	force_redraw_next = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">	need_redraw = ScreenLines[off] != c</td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">		|| (mbyte_cells == 2</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">		    &amp;&amp; ScreenLines[off + 1] != (enc_dbcs ? ptr[1] : 0))</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">		|| (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span></td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">		    &amp;&amp; c == 0x8e</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line">		    &amp;&amp; ScreenLines2[off] != ptr[1])</td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">		|| (enc_utf8</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">		    &amp;&amp; (ScreenLinesUC[off] !=</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line">				(u8char_T)(c &lt; 0x80 &amp;&amp; u8cc[0] == 0 ? 0 : u8c)</td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">			|| (ScreenLinesUC[off] != 0</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">					  &amp;&amp; screen_comp_differs(off, u8cc))))</td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">		|| ScreenAttrs[off] != attr</td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">		|| exmode_active;</td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">	<span class='keyword'>if</span> ((need_redraw || force_redraw_this)</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">		&amp;&amp; !blocked_by_popup(row, col)</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">	   )</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line"><span class='directive'>#if defined(FEAT_GUI) || defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">	    <span class='comment'>// The bold trick makes a single row of pixels appear in the next</span></td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">	    <span class='comment'>// character.  When a bold character is removed, the next</span></td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">	    <span class='comment'>// character should be redrawn too.  This happens for our own GUI</span></td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">	    <span class='comment'>// and for some xterms.</span></td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">	    <span class='keyword'>if</span> (need_redraw &amp;&amp; ScreenLines[off] != ' ' &amp;&amp; (</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line"><span class='directive'># ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">		    gui.in_use</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line"><span class='directive'># if defined(FEAT_GUI) &amp;&amp; defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">		    ||</td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line"><span class='directive'># ifdef <span class='macro'>UNIX<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">		    term_is_xterm</td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line">		    ))</td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">		<span class='keyword'>int</span>	n = ScreenAttrs[off];</td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">		<span class='keyword'>if</span> (n &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">		    n = syn_attr2attr(n);</td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">		<span class='keyword'>if</span> (n &amp; <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">		    force_redraw_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">	    <span class='comment'>// When at the end of the text and overwriting a two-cell</span></td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line">	    <span class='comment'>// character with a one-cell character, need to clear the next</span></td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">	    <span class='comment'>// cell.  Also when overwriting the left halve of a two-cell char</span></td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">	    <span class='comment'>// with the right halve of a two-cell char.  Do this only once</span></td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">	    <span class='comment'>// (mb_off2cells() may return 2 on the right halve).</span></td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">	    <span class='keyword'>if</span> (clear_next_cell)</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">		clear_next_cell = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (has_mbyte</td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">		    &amp;&amp; (len &lt; 0 ? ptr[mbyte_blen] == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span></td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">					     : ptr + mbyte_blen &gt;= text + len)</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">		    &amp;&amp; ((mbyte_cells == 1 &amp;&amp; (*mb_off2cells)(off, max_off) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">			|| (mbyte_cells == 2</td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off, max_off) == 1</td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off + 1, max_off) &gt; 1)))</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">		clear_next_cell = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">	    <span class='comment'>// Make sure we never leave a second byte of a double-byte behind,</span></td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">	    <span class='comment'>// it confuses mb_off2cells().</span></td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">	    <span class='keyword'>if</span> (enc_dbcs</td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">		    &amp;&amp; ((mbyte_cells == 1 &amp;&amp; (*mb_off2cells)(off, max_off) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">			|| (mbyte_cells == 2</td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off, max_off) == 1</td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">			    &amp;&amp; (*mb_off2cells)(off + 1, max_off) &gt; 1)))</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">		ScreenLines[off + mbyte_blen] = 0;</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">	    ScreenLines[off] = c;</td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">	    ScreenAttrs[off] = attr;</td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">	    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">		<span class='keyword'>if</span> (c &lt; 0x80 &amp;&amp; u8cc[0] == 0)</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">		    ScreenLinesUC[off] = 0;</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">		    <span class='keyword'>int</span>	    i;</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">		    ScreenLinesUC[off] = u8c;</td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">		    <span class='keyword'>for</span> (i = 0; i &lt; Screen_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">			ScreenLinesC[i][off] = u8cc[i];</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">			<span class='keyword'>if</span> (u8cc[i] == 0)</td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">			    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line">		<span class='keyword'>if</span> (mbyte_cells == 2)</td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line">		    ScreenLines[off + 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">		    ScreenAttrs[off + 1] = attr;</td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">		screen_char(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (mbyte_cells == 2)</td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">		ScreenLines[off + 1] = ptr[1];</td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line">		ScreenAttrs[off + 1] = attr;</td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line">		screen_char_2(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; c == 0x8e)</td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line">		ScreenLines2[off] = ptr[1];</td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">		screen_char(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line">		screen_char(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">	<span class='keyword'>if</span> (has_mbyte)</td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">	    off += mbyte_cells;</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line">	    col += mbyte_cells;</td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">	    ptr += mbyte_blen;</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line">	    <span class='keyword'>if</span> (clear_next_cell)</td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">		<span class='comment'>// This only happens at the end, display one space next.</span></td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">		ptr = (char_u *)<span class='string_literal'>" "</span>;</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">		len = -1;</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">	    ++off;</td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">	    ++col;</td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">	    ++ptr;</td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line">    <span class='comment'>// If we detected the next character needs to be redrawn, but the text</span></td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">    <span class='comment'>// doesn't extend up to there, update the character here.</span></td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">    <span class='keyword'>if</span> (force_redraw_next &amp;&amp; col &lt; screen_Columns)</td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">	<span class='keyword'>if</span> (enc_dbcs != 0 &amp;&amp; dbcs_off2cells(off, max_off) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">	    screen_char_2(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">	    screen_char(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line"><span class='directive'>#if defined(FEAT_SEARCH_EXTRA) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line"> <span class='comment'>* Prepare for 'hlsearch' highlighting.</span></td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">start_search_hl(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">    <span class='keyword'>if</span> (p_hls &amp;&amp; !no_hlsearch)</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">	end_search_hl();  <span class='comment'>// just in case it wasn't called before</span></td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">	last_pat_prog(&amp;screen_search_hl.rm);</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line">	screen_search_hl.attr = <span class='macro'>HL_ATTR(HLF_L)<span class='macro_popup'>highlight_attr[(int)(HLF_L)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line"><span class='directive'># ifdef FEAT_RELTIME</span></td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">	<span class='comment'>// Set the time limit to 'redrawtime'.</span></td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">	profile_setlimit(p_rdt, &amp;screen_search_hl.tm);</td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line"> <span class='comment'>* Clean up for 'hlsearch' highlighting.</span></td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">end_search_hl(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line">    <span class='keyword'>if</span> (screen_search_hl.rm.regprog != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line">	vim_regfree(screen_search_hl.rm.regprog);</td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">	screen_search_hl.rm.regprog = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line">      <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">screen_start_highlight(<span class='keyword'>int</span> attr)</td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">    attrentry_T *aep = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">    screen_attr = attr;</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">    <span class='keyword'>if</span> (full_screen</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line"><span class='directive'>#ifdef MSWIN</span></td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">		    &amp;&amp; termcap_active</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">				       )</td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">	<span class='keyword'>if</span> (gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line">	    <span class='keyword'>char</span>	buf[20];</td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line">	    <span class='comment'>// The GUI handles this internally.</span></td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line">	    <span class='macro'>sprintf(buf, IF_EB(<span class='string_literal'>"\033|%dh"</span>, ESC_STR <span class='string_literal'>"|%dh"</span>), attr)<span class='macro_popup'>__builtin___sprintf_chk (buf, 1 - 1, __builtin_object_size (buf<br>, 1 &gt; 1), "\033|%dh", attr)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">	    <span class='macro'>OUT_STR(buf)<span class='macro_popup'>out_str((char_u *)(buf))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">	    <span class='keyword'>if</span> (attr &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span>)				<span class='comment'>// special HL attr.</span></td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>IS_CTERM<span class='macro_popup'>(t_colors &gt; 1 || p_tgc)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">		    aep = syn_cterm_attr2entry(attr);</td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line">		    aep = syn_term_attr2entry(attr);</td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">		<span class='keyword'>if</span> (aep == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)	    <span class='comment'>// did ":syntax clear"</span></td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">		    attr = 0;</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">		    attr = aep-&gt;ae_attr;</td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line"><span class='directive'>#if defined(FEAT_VTP) &amp;&amp; defined(FEAT_TERMGUICOLORS)</span></td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">	    <span class='keyword'>if</span> (use_vtp())</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">		<span class='macro'>guicolor_T<span class='macro_popup'>long</span></span>  defguifg, defguibg;</td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">		<span class='keyword'>int</span>	    defctermfg, defctermbg;</td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">		<span class='comment'>// If FG and BG are unset, the color is undefined when</span></td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">		<span class='comment'>// BOLD+INVERSE. Use Normal as the default value.</span></td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">		get_default_console_color(&amp;defctermfg, &amp;defctermbg, &amp;defguifg,</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">								    &amp;defguibg);</td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">		<span class='keyword'>if</span> (p_tgc)</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">		    <span class='keyword'>if</span> (aep == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || <span class='macro'>COLOR_INVALID(aep-&gt;ae_u.cterm.fg_rgb)<span class='macro_popup'>((aep-&gt;ae_u.cterm.fg_rgb) == ((long)0x1ffffff) || (aep-&gt;<br>ae_u.cterm.fg_rgb) == ((long)0x1fffffe))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">			term_fg_rgb_color(defguifg);</td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">		    <span class='keyword'>if</span> (aep == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || <span class='macro'>COLOR_INVALID(aep-&gt;ae_u.cterm.bg_rgb)<span class='macro_popup'>((aep-&gt;ae_u.cterm.bg_rgb) == ((long)0x1ffffff) || (aep-&gt;<br>ae_u.cterm.bg_rgb) == ((long)0x1fffffe))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">			term_bg_rgb_color(defguibg);</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (t_colors &gt;= 256)</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">		    <span class='keyword'>if</span> (aep == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || aep-&gt;ae_u.cterm.fg_color == 0)</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">			term_fg_color(defctermfg);</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">		    <span class='keyword'>if</span> (aep == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || aep-&gt;ae_u.cterm.bg_color == 0)</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">			term_bg_color(defctermbg);</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">	    <span class='keyword'>if</span> ((attr &amp; <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span>) &amp;&amp; *<span class='macro'>T_MD<span class='macro_popup'>(term_strings[(int)(KS_MD)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	<span class='comment'>// bold</span></td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">		out_str(<span class='macro'>T_MD<span class='macro_popup'>(term_strings[(int)(KS_MD)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (aep != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; cterm_normal_fg_bold &amp;&amp; (</td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">			p_tgc &amp;&amp; aep-&gt;ae_u.cterm.fg_rgb != <span class='macro'>CTERMCOLOR<span class='macro_popup'>((long)0x1fffffe)</span></span></td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">			  ? aep-&gt;ae_u.cterm.fg_rgb != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span></td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">			  :</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">			    t_colors &gt; 1 &amp;&amp; aep-&gt;ae_u.cterm.fg_color))</td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line">		<span class='comment'>// If the Normal FG color has BOLD attribute and the new HL</span></td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line">		<span class='comment'>// has a FG color defined, clear BOLD.</span></td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">		out_str(<span class='macro'>T_ME<span class='macro_popup'>(term_strings[(int)(KS_ME)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line">	    <span class='keyword'>if</span> ((attr &amp; <span class='macro'>HL_STANDOUT<span class='macro_popup'>0x20</span></span>) &amp;&amp; *<span class='macro'>T_SO<span class='macro_popup'>(term_strings[(int)(KS_SO)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	<span class='comment'>// standout</span></td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">		out_str(<span class='macro'>T_SO<span class='macro_popup'>(term_strings[(int)(KS_SO)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">	    <span class='keyword'>if</span> ((attr &amp; <span class='macro'>HL_UNDERCURL<span class='macro_popup'>0x10</span></span>) &amp;&amp; *<span class='macro'>T_UCS<span class='macro_popup'>(term_strings[(int)(KS_UCS)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>) <span class='comment'>// undercurl</span></td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">		out_str(<span class='macro'>T_UCS<span class='macro_popup'>(term_strings[(int)(KS_UCS)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">	    <span class='keyword'>if</span> (((attr &amp; <span class='macro'>HL_UNDERLINE<span class='macro_popup'>0x08</span></span>)	    <span class='comment'>// underline or undercurl</span></td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">			|| ((attr &amp; <span class='macro'>HL_UNDERCURL<span class='macro_popup'>0x10</span></span>) &amp;&amp; *<span class='macro'>T_UCS<span class='macro_popup'>(term_strings[(int)(KS_UCS)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">		    &amp;&amp; *<span class='macro'>T_US<span class='macro_popup'>(term_strings[(int)(KS_US)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">		out_str(<span class='macro'>T_US<span class='macro_popup'>(term_strings[(int)(KS_US)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">	    <span class='keyword'>if</span> ((attr &amp; <span class='macro'>HL_ITALIC<span class='macro_popup'>0x04</span></span>) &amp;&amp; *<span class='macro'>T_CZH<span class='macro_popup'>(term_strings[(int)(KS_CZH)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	<span class='comment'>// italic</span></td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">		out_str(<span class='macro'>T_CZH<span class='macro_popup'>(term_strings[(int)(KS_CZH)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">	    <span class='keyword'>if</span> ((attr &amp; <span class='macro'>HL_INVERSE<span class='macro_popup'>0x01</span></span>) &amp;&amp; *<span class='macro'>T_MR<span class='macro_popup'>(term_strings[(int)(KS_MR)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	<span class='comment'>// inverse (reverse)</span></td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">		out_str(<span class='macro'>T_MR<span class='macro_popup'>(term_strings[(int)(KS_MR)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">	    <span class='keyword'>if</span> ((attr &amp; <span class='macro'>HL_STRIKETHROUGH<span class='macro_popup'>0x80</span></span>) &amp;&amp; *<span class='macro'>T_STS<span class='macro_popup'>(term_strings[(int)(KS_STS)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	<span class='comment'>// strike</span></td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">		out_str(<span class='macro'>T_STS<span class='macro_popup'>(term_strings[(int)(KS_STS)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">	     <span class='comment'>* Output the color or start string after bold etc., in case the</span></td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">	     <span class='comment'>* bold etc. override the color setting.</span></td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line">	    <span class='keyword'>if</span> (aep != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line">		<span class='comment'>// When 'termguicolors' is set but fg or bg is unset,</span></td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">		<span class='comment'>// fall back to the cterm colors.   This helps for SpellBad,</span></td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">		<span class='comment'>// where the GUI uses a red undercurl.</span></td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">		<span class='keyword'>if</span> (p_tgc &amp;&amp; aep-&gt;ae_u.cterm.fg_rgb != <span class='macro'>CTERMCOLOR<span class='macro_popup'>((long)0x1fffffe)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.cterm.fg_rgb != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line">			term_fg_rgb_color(aep-&gt;ae_u.cterm.fg_rgb);</td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">		<span class='keyword'>if</span> (t_colors &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.cterm.fg_color)</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">			term_fg_color(aep-&gt;ae_u.cterm.fg_color - 1);</td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">		<span class='keyword'>if</span> (p_tgc &amp;&amp; aep-&gt;ae_u.cterm.bg_rgb != <span class='macro'>CTERMCOLOR<span class='macro_popup'>((long)0x1fffffe)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.cterm.bg_rgb != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line">			term_bg_rgb_color(aep-&gt;ae_u.cterm.bg_rgb);</td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">		<span class='keyword'>if</span> (t_colors &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.cterm.bg_color)</td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">			term_bg_color(aep-&gt;ae_u.cterm.bg_color - 1);</td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line">		<span class='keyword'>if</span> (p_tgc &amp;&amp; aep-&gt;ae_u.cterm.ul_rgb != <span class='macro'>CTERMCOLOR<span class='macro_popup'>((long)0x1fffffe)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.cterm.ul_rgb != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">			term_ul_rgb_color(aep-&gt;ae_u.cterm.ul_rgb);</td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">		<span class='keyword'>if</span> (t_colors &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.cterm.ul_color)</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line">			term_ul_color(aep-&gt;ae_u.cterm.ul_color - 1);</td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">		<span class='keyword'>if</span> (!<span class='macro'>IS_CTERM<span class='macro_popup'>(t_colors &gt; 1 || p_tgc)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">		    <span class='keyword'>if</span> (aep-&gt;ae_u.term.start != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line">			out_str(aep-&gt;ae_u.term.start);</td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line">      <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">screen_stop_highlight(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line">    <span class='keyword'>int</span>	    do_ME = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;	    <span class='comment'>// output T_ME code</span></td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line"><span class='directive'>#if defined(FEAT_VTP) &amp;&amp; defined(FEAT_TERMGUICOLORS)</span></td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line">    <span class='keyword'>int</span>	    do_ME_fg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, do_ME_bg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line">    <span class='keyword'>if</span> (screen_attr != 0</td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line"><span class='directive'>#ifdef MSWIN</span></td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">			&amp;&amp; termcap_active</td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">					   )</td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">	<span class='keyword'>if</span> (gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">	    <span class='keyword'>char</span>	buf[20];</td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">	    <span class='comment'>// use internal GUI code</span></td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">	    <span class='macro'>sprintf(buf, IF_EB(<span class='string_literal'>"\033|%dH"</span>, ESC_STR <span class='string_literal'>"|%dH"</span>), screen_attr)<span class='macro_popup'>__builtin___sprintf_chk (buf, 1 - 1, __builtin_object_size (buf<br>, 1 &gt; 1), "\033|%dH", screen_attr)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line">	    <span class='macro'>OUT_STR(buf)<span class='macro_popup'>out_str((char_u *)(buf))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line">	    <span class='keyword'>if</span> (screen_attr &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span>)			<span class='comment'>// special HL attr.</span></td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line">		attrentry_T *aep;</td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>IS_CTERM<span class='macro_popup'>(t_colors &gt; 1 || p_tgc)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">		    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">		     <span class='comment'>* Assume that t_me restores the original colors!</span></td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">		     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">		    aep = syn_cterm_attr2entry(screen_attr);</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line">		    <span class='keyword'>if</span> (aep != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; ((</td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">			    p_tgc &amp;&amp; aep-&gt;ae_u.cterm.fg_rgb != <span class='macro'>CTERMCOLOR<span class='macro_popup'>((long)0x1fffffe)</span></span></td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line">				? aep-&gt;ae_u.cterm.fg_rgb != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span></td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line"><span class='directive'># ifdef FEAT_VTP</span></td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line">				    ? !(do_ME_fg = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>) : (do_ME_fg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line">				:</td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">				aep-&gt;ae_u.cterm.fg_color) || (</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">			    p_tgc &amp;&amp; aep-&gt;ae_u.cterm.bg_rgb != <span class='macro'>CTERMCOLOR<span class='macro_popup'>((long)0x1fffffe)</span></span></td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">				? aep-&gt;ae_u.cterm.bg_rgb != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span></td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line"><span class='directive'># ifdef FEAT_VTP</span></td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line">				    ? !(do_ME_bg = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>) : (do_ME_bg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">				:</td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line">				aep-&gt;ae_u.cterm.bg_color)))</td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line">			do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line"><span class='directive'>#if defined(FEAT_VTP) &amp;&amp; defined(FEAT_TERMGUICOLORS)</span></td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line">		    <span class='keyword'>if</span> (use_vtp())</td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">			<span class='keyword'>if</span> (do_ME_fg &amp;&amp; do_ME_bg)</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">			    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line">			<span class='comment'>// FG and BG cannot be separated in T_ME, which is not</span></td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line">			<span class='comment'>// efficient.</span></td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line">			<span class='keyword'>if</span> (!do_ME &amp;&amp; do_ME_fg)</td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line">			    out_str((char_u *)<span class='string_literal'>"\033|39m"</span>); <span class='comment'>// restore FG</span></td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line">			<span class='keyword'>if</span> (!do_ME &amp;&amp; do_ME_bg)</td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line">			    out_str((char_u *)<span class='string_literal'>"\033|49m"</span>); <span class='comment'>// restore BG</span></td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">			<span class='comment'>// Process FG and BG at once.</span></td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">			<span class='keyword'>if</span> (!do_ME)</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">			    do_ME = do_ME_fg | do_ME_bg;</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">		    aep = syn_term_attr2entry(screen_attr);</td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">		    <span class='keyword'>if</span> (aep != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; aep-&gt;ae_u.term.stop != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">			<span class='keyword'>if</span> (<span class='macro'>STRCMP(aep-&gt;ae_u.term.stop, T_ME)<span class='macro_popup'>strcmp((char *)(aep-&gt;ae_u.term.stop), (char *)((term_strings<br>[(int)(KS_ME)])))</span></span> == 0)</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line">			    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line">			    out_str(aep-&gt;ae_u.term.stop);</td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">		<span class='keyword'>if</span> (aep == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)	    <span class='comment'>// did ":syntax clear"</span></td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">		    screen_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">		    screen_attr = aep-&gt;ae_attr;</td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">	     <span class='comment'>* Often all ending-codes are equal to T_ME.  Avoid outputting the</span></td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line">	     <span class='comment'>* same sequence several times.</span></td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">	    <span class='keyword'>if</span> (screen_attr &amp; <span class='macro'>HL_STANDOUT<span class='macro_popup'>0x20</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>STRCMP(T_SE, T_ME)<span class='macro_popup'>strcmp((char *)((term_strings[(int)(KS_SE)])), (char *)((term_strings<br>[(int)(KS_ME)])))</span></span> == 0)</td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">		    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line">		    out_str(<span class='macro'>T_SE<span class='macro_popup'>(term_strings[(int)(KS_SE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">	    <span class='keyword'>if</span> ((screen_attr &amp; <span class='macro'>HL_UNDERCURL<span class='macro_popup'>0x10</span></span>) &amp;&amp; *<span class='macro'>T_UCE<span class='macro_popup'>(term_strings[(int)(KS_UCE)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>STRCMP(T_UCE, T_ME)<span class='macro_popup'>strcmp((char *)((term_strings[(int)(KS_UCE)])), (char *)((term_strings<br>[(int)(KS_ME)])))</span></span> == 0)</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">		    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line">		    out_str(<span class='macro'>T_UCE<span class='macro_popup'>(term_strings[(int)(KS_UCE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line">	    <span class='keyword'>if</span> ((screen_attr &amp; <span class='macro'>HL_UNDERLINE<span class='macro_popup'>0x08</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">			    || ((screen_attr &amp; <span class='macro'>HL_UNDERCURL<span class='macro_popup'>0x10</span></span>) &amp;&amp; *<span class='macro'>T_UCE<span class='macro_popup'>(term_strings[(int)(KS_UCE)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>STRCMP(T_UE, T_ME)<span class='macro_popup'>strcmp((char *)((term_strings[(int)(KS_UE)])), (char *)((term_strings<br>[(int)(KS_ME)])))</span></span> == 0)</td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">		    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">		    out_str(<span class='macro'>T_UE<span class='macro_popup'>(term_strings[(int)(KS_UE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line">	    <span class='keyword'>if</span> (screen_attr &amp; <span class='macro'>HL_ITALIC<span class='macro_popup'>0x04</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>STRCMP(T_CZR, T_ME)<span class='macro_popup'>strcmp((char *)((term_strings[(int)(KS_CZR)])), (char *)((term_strings<br>[(int)(KS_ME)])))</span></span> == 0)</td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line">		    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">		    out_str(<span class='macro'>T_CZR<span class='macro_popup'>(term_strings[(int)(KS_CZR)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">	    <span class='keyword'>if</span> (screen_attr &amp; <span class='macro'>HL_STRIKETHROUGH<span class='macro_popup'>0x80</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>STRCMP(T_STE, T_ME)<span class='macro_popup'>strcmp((char *)((term_strings[(int)(KS_STE)])), (char *)((term_strings<br>[(int)(KS_ME)])))</span></span> == 0)</td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">		    do_ME = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line">		    out_str(<span class='macro'>T_STE<span class='macro_popup'>(term_strings[(int)(KS_STE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line">	    <span class='keyword'>if</span> (do_ME || (screen_attr &amp; (<span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span> | <span class='macro'>HL_INVERSE<span class='macro_popup'>0x01</span></span>)))</td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line">		out_str(<span class='macro'>T_ME<span class='macro_popup'>(term_strings[(int)(KS_ME)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">	    <span class='keyword'>if</span> (p_tgc)</td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line">		<span class='keyword'>if</span> (cterm_normal_fg_gui_color != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line">		    term_fg_rgb_color(cterm_normal_fg_gui_color);</td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line">		<span class='keyword'>if</span> (cterm_normal_bg_gui_color != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line">		    term_bg_rgb_color(cterm_normal_bg_gui_color);</td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line">		<span class='keyword'>if</span> (cterm_normal_ul_gui_color != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line">		    term_ul_rgb_color(cterm_normal_ul_gui_color);</td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">		<span class='keyword'>if</span> (t_colors &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">		    <span class='comment'>// set Normal cterm colors</span></td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">		    <span class='keyword'>if</span> (cterm_normal_fg_color != 0)</td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line">			term_fg_color(cterm_normal_fg_color - 1);</td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line">		    <span class='keyword'>if</span> (cterm_normal_bg_color != 0)</td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line">			term_bg_color(cterm_normal_bg_color - 1);</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line">		    <span class='keyword'>if</span> (cterm_normal_ul_color != 0)</td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line">			term_ul_color(cterm_normal_ul_color - 1);</td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line">		    <span class='keyword'>if</span> (cterm_normal_fg_bold)</td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line">			out_str(<span class='macro'>T_MD<span class='macro_popup'>(term_strings[(int)(KS_MD)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line">    screen_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line"> <span class='comment'>* Reset the colors for a cterm.  Used when leaving Vim.</span></td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line"> <span class='comment'>* The machine specific code may override this again.</span></td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line">reset_cterm_colors(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>IS_CTERM<span class='macro_popup'>(t_colors &gt; 1 || p_tgc)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">	<span class='comment'>// set Normal cterm colors</span></td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">	<span class='keyword'>if</span> (p_tgc ? (cterm_normal_fg_gui_color != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span></td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line">		 || cterm_normal_bg_gui_color != <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">		: (cterm_normal_fg_color &gt; 0 || cterm_normal_bg_color &gt; 0))</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">	<span class='keyword'>if</span> (cterm_normal_fg_color &gt; 0 || cterm_normal_bg_color &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">	    out_str(<span class='macro'>T_OP<span class='macro_popup'>(term_strings[(int)(KS_OP)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line">	    screen_attr = -1;</td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line">	<span class='keyword'>if</span> (cterm_normal_fg_bold)</td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">	    out_str(<span class='macro'>T_ME<span class='macro_popup'>(term_strings[(int)(KS_ME)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line">	    screen_attr = -1;</td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line"> <span class='comment'>* Put character ScreenLines["off"] on the screen at position "row" and "col",</span></td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line"> <span class='comment'>* using the attributes from ScreenAttrs["off"].</span></td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">screen_char(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> row, <span class='keyword'>int</span> col)</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">    <span class='keyword'>int</span>		attr;</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line">    <span class='comment'>// Check for illegal values, just in case (could happen just after</span></td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line">    <span class='comment'>// resizing).</span></td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line">    <span class='keyword'>if</span> (row &gt;= screen_Rows || col &gt;= screen_Columns)</td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line">    <span class='comment'>// Skip if under the popup menu.</span></td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line">    <span class='comment'>// Popup windows with zindex higher than POPUPMENU_ZINDEX go on top.</span></td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line">    <span class='keyword'>if</span> (pum_under_menu(row, col)</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line">	    &amp;&amp; screen_zindex &lt;= <span class='macro'>POPUPMENU_ZINDEX<span class='macro_popup'>100</span></span></td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line">	    )</td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line">    <span class='keyword'>if</span> (blocked_by_popup(row, col))</td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">    <span class='comment'>// Outputting a character in the last cell on the screen may scroll the</span></td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">    <span class='comment'>// screen up.  Only do it when the "xn" termcap property is set, otherwise</span></td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">    <span class='comment'>// mark the character invalid (update it when scrolled up).</span></td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line">    <span class='keyword'>if</span> (*<span class='macro'>T_XN<span class='macro_popup'>(term_strings[(int)(KS_XN)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span></td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">	    &amp;&amp; row == screen_Rows - 1 &amp;&amp; col == screen_Columns - 1</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line">	    <span class='comment'>// account for first command-line character in rightleft mode</span></td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line">	    &amp;&amp; !cmdmsg_rl</td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">       )</td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">	ScreenAttrs[off] = (sattr_T)-1;</td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">     <span class='comment'>* Stop highlighting first, so it's easier to move the cursor.</span></td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">    <span class='keyword'>if</span> (screen_char_attr != 0)</td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line">	attr = screen_char_attr;</td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line">	attr = ScreenAttrs[off];</td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line">    <span class='keyword'>if</span> (screen_attr != attr)</td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">	screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line">    windgoto(row, col);</td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line">    <span class='keyword'>if</span> (screen_attr != attr)</td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line">	screen_start_highlight(attr);</td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line">    <span class='keyword'>if</span> (enc_utf8 &amp;&amp; ScreenLinesUC[off] != 0)</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line">	char_u	    buf[<span class='macro'>MB_MAXBYTES<span class='macro_popup'>21</span></span> + 1];</td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line">	<span class='keyword'>if</span> (utf_ambiguous_width(ScreenLinesUC[off]))</td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line">	    <span class='keyword'>if</span> (*p_ambw == 'd'</td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">		    &amp;&amp; !gui.in_use</td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">		    )</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line">		<span class='comment'>// Clear the two screen cells. If the character is actually</span></td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line">		<span class='comment'>// single width it won't change the second cell.</span></td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line">		out_str((char_u *)<span class='string_literal'>"  "</span>);</td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line">		term_windgoto(row, col);</td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line">	    <span class='comment'>// not sure where the cursor is after drawing the ambiguous width</span></td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line">	    <span class='comment'>// character</span></td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">	    screen_cur_col = 9999;</td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (utf_char2cells(ScreenLinesUC[off]) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line">	    ++screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">	<span class='comment'>// Convert the UTF-8 character to bytes and write it.</span></td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">	buf[utfc_char2bytes(off, buf)] = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line">	out_str(buf);</td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line">	out_flush_check();</td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line">	out_char(ScreenLines[off]);</td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line">	<span class='comment'>// double-byte character in single-width cell</span></td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line">	<span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; ScreenLines[off] == 0x8e)</td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">	    out_char(ScreenLines2[off]);</td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line">    screen_cur_col++;</td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line"> <span class='comment'>* Used for enc_dbcs only: Put one double-wide character at ScreenLines["off"]</span></td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line"> <span class='comment'>* on the screen at position 'row' and 'col'.</span></td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line"> <span class='comment'>* The attributes of the first byte is used for all.  This is required to</span></td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line"> <span class='comment'>* output the two bytes of a double-byte character with nothing in between.</span></td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line">screen_char_2(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> row, <span class='keyword'>int</span> col)</td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">    <span class='comment'>// Check for illegal values (could be wrong when screen was resized).</span></td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line">    <span class='keyword'>if</span> (off + 1 &gt;= (<span class='keyword'>unsigned</span>)(screen_Rows * screen_Columns))</td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line">    <span class='comment'>// Outputting the last character on the screen may scrollup the screen.</span></td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line">    <span class='comment'>// Don't to it!  Mark the character invalid (update it when scrolled up)</span></td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">    <span class='keyword'>if</span> (row == screen_Rows - 1 &amp;&amp; col &gt;= screen_Columns - 2)</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">	ScreenAttrs[off] = (sattr_T)-1;</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">    <span class='comment'>// Output the first byte normally (positions the cursor), then write the</span></td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">    <span class='comment'>// second byte directly.</span></td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">    screen_char(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">    out_char(ScreenLines[off + 1]);</td></tr>
<tr class="codeline" data-linenumber="2215"><td class="num" id="LN2215">2215</td><td class="line">    ++screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="2216"><td class="num" id="LN2216">2216</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2217"><td class="num" id="LN2217">2217</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2218"><td class="num" id="LN2218">2218</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2219"><td class="num" id="LN2219">2219</td><td class="line"> <span class='comment'>* Draw a rectangle of the screen, inverted when "invert" is TRUE.</span></td></tr>
<tr class="codeline" data-linenumber="2220"><td class="num" id="LN2220">2220</td><td class="line"> <span class='comment'>* This uses the contents of ScreenLines[] and doesn't change it.</span></td></tr>
<tr class="codeline" data-linenumber="2221"><td class="num" id="LN2221">2221</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2222"><td class="num" id="LN2222">2222</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2223"><td class="num" id="LN2223">2223</td><td class="line">screen_draw_rectangle(</td></tr>
<tr class="codeline" data-linenumber="2224"><td class="num" id="LN2224">2224</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="2225"><td class="num" id="LN2225">2225</td><td class="line">    <span class='keyword'>int</span>		col,</td></tr>
<tr class="codeline" data-linenumber="2226"><td class="num" id="LN2226">2226</td><td class="line">    <span class='keyword'>int</span>		height,</td></tr>
<tr class="codeline" data-linenumber="2227"><td class="num" id="LN2227">2227</td><td class="line">    <span class='keyword'>int</span>		width,</td></tr>
<tr class="codeline" data-linenumber="2228"><td class="num" id="LN2228">2228</td><td class="line">    <span class='keyword'>int</span>		invert)</td></tr>
<tr class="codeline" data-linenumber="2229"><td class="num" id="LN2229">2229</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2230"><td class="num" id="LN2230">2230</td><td class="line">    <span class='keyword'>int</span>		r, c;</td></tr>
<tr class="codeline" data-linenumber="2231"><td class="num" id="LN2231">2231</td><td class="line">    <span class='keyword'>int</span>		off;</td></tr>
<tr class="codeline" data-linenumber="2232"><td class="num" id="LN2232">2232</td><td class="line">    <span class='keyword'>int</span>		max_off;</td></tr>
<tr class="codeline" data-linenumber="2233"><td class="num" id="LN2233">2233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2234"><td class="num" id="LN2234">2234</td><td class="line">    <span class='comment'>// Can't use ScreenLines unless initialized</span></td></tr>
<tr class="codeline" data-linenumber="2235"><td class="num" id="LN2235">2235</td><td class="line">    <span class='keyword'>if</span> (ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2236"><td class="num" id="LN2236">2236</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2237"><td class="num" id="LN2237">2237</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2238"><td class="num" id="LN2238">2238</td><td class="line">    <span class='keyword'>if</span> (invert)</td></tr>
<tr class="codeline" data-linenumber="2239"><td class="num" id="LN2239">2239</td><td class="line">	screen_char_attr = <span class='macro'>HL_INVERSE<span class='macro_popup'>0x01</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2240"><td class="num" id="LN2240">2240</td><td class="line">    <span class='keyword'>for</span> (r = row; r &lt; row + height; ++r)</td></tr>
<tr class="codeline" data-linenumber="2241"><td class="num" id="LN2241">2241</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2242"><td class="num" id="LN2242">2242</td><td class="line">	off = LineOffset[r];</td></tr>
<tr class="codeline" data-linenumber="2243"><td class="num" id="LN2243">2243</td><td class="line">	max_off = off + screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="2244"><td class="num" id="LN2244">2244</td><td class="line">	<span class='keyword'>for</span> (c = col; c &lt; col + width; ++c)</td></tr>
<tr class="codeline" data-linenumber="2245"><td class="num" id="LN2245">2245</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2246"><td class="num" id="LN2246">2246</td><td class="line">	    <span class='keyword'>if</span> (enc_dbcs != 0 &amp;&amp; dbcs_off2cells(off + c, max_off) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="2247"><td class="num" id="LN2247">2247</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2248"><td class="num" id="LN2248">2248</td><td class="line">		screen_char_2(off + c, r, c);</td></tr>
<tr class="codeline" data-linenumber="2249"><td class="num" id="LN2249">2249</td><td class="line">		++c;</td></tr>
<tr class="codeline" data-linenumber="2250"><td class="num" id="LN2250">2250</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2251"><td class="num" id="LN2251">2251</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2252"><td class="num" id="LN2252">2252</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2253"><td class="num" id="LN2253">2253</td><td class="line">		screen_char(off + c, r, c);</td></tr>
<tr class="codeline" data-linenumber="2254"><td class="num" id="LN2254">2254</td><td class="line">		<span class='keyword'>if</span> (utf_off2cells(off + c, max_off) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="2255"><td class="num" id="LN2255">2255</td><td class="line">		    ++c;</td></tr>
<tr class="codeline" data-linenumber="2256"><td class="num" id="LN2256">2256</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2257"><td class="num" id="LN2257">2257</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2258"><td class="num" id="LN2258">2258</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2259"><td class="num" id="LN2259">2259</td><td class="line">    screen_char_attr = 0;</td></tr>
<tr class="codeline" data-linenumber="2260"><td class="num" id="LN2260">2260</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2261"><td class="num" id="LN2261">2261</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2262"><td class="num" id="LN2262">2262</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2263"><td class="num" id="LN2263">2263</td><td class="line"> <span class='comment'>* Redraw the characters for a vertically split window.</span></td></tr>
<tr class="codeline" data-linenumber="2264"><td class="num" id="LN2264">2264</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2265"><td class="num" id="LN2265">2265</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2266"><td class="num" id="LN2266">2266</td><td class="line">redraw_block(<span class='keyword'>int</span> row, <span class='keyword'>int</span> end, win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="2267"><td class="num" id="LN2267">2267</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2268"><td class="num" id="LN2268">2268</td><td class="line">    <span class='keyword'>int</span>		col;</td></tr>
<tr class="codeline" data-linenumber="2269"><td class="num" id="LN2269">2269</td><td class="line">    <span class='keyword'>int</span>		width;</td></tr>
<tr class="codeline" data-linenumber="2270"><td class="num" id="LN2270">2270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2271"><td class="num" id="LN2271">2271</td><td class="line"><span class='directive'># ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="2272"><td class="num" id="LN2272">2272</td><td class="line">    clip_may_clear_selection(row, end - 1);</td></tr>
<tr class="codeline" data-linenumber="2273"><td class="num" id="LN2273">2273</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="2274"><td class="num" id="LN2274">2274</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2275"><td class="num" id="LN2275">2275</td><td class="line">    <span class='keyword'>if</span> (wp == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2276"><td class="num" id="LN2276">2276</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2277"><td class="num" id="LN2277">2277</td><td class="line">	col = 0;</td></tr>
<tr class="codeline" data-linenumber="2278"><td class="num" id="LN2278">2278</td><td class="line">	width = Columns;</td></tr>
<tr class="codeline" data-linenumber="2279"><td class="num" id="LN2279">2279</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2280"><td class="num" id="LN2280">2280</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2281"><td class="num" id="LN2281">2281</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2282"><td class="num" id="LN2282">2282</td><td class="line">	col = wp-&gt;w_wincol;</td></tr>
<tr class="codeline" data-linenumber="2283"><td class="num" id="LN2283">2283</td><td class="line">	width = wp-&gt;w_width;</td></tr>
<tr class="codeline" data-linenumber="2284"><td class="num" id="LN2284">2284</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2285"><td class="num" id="LN2285">2285</td><td class="line">    screen_draw_rectangle(row, col, end - row, width, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2286"><td class="num" id="LN2286">2286</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2287"><td class="num" id="LN2287">2287</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2288"><td class="num" id="LN2288">2288</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2289"><td class="num" id="LN2289">2289</td><td class="line">space_to_screenline(<span class='keyword'>int</span> off, <span class='keyword'>int</span> attr)</td></tr>
<tr class="codeline" data-linenumber="2290"><td class="num" id="LN2290">2290</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2291"><td class="num" id="LN2291">2291</td><td class="line">    ScreenLines[off] = ' ';</td></tr>
<tr class="codeline" data-linenumber="2292"><td class="num" id="LN2292">2292</td><td class="line">    ScreenAttrs[off] = attr;</td></tr>
<tr class="codeline" data-linenumber="2293"><td class="num" id="LN2293">2293</td><td class="line">    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="2294"><td class="num" id="LN2294">2294</td><td class="line">	ScreenLinesUC[off] = 0;</td></tr>
<tr class="codeline" data-linenumber="2295"><td class="num" id="LN2295">2295</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2296"><td class="num" id="LN2296">2296</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2297"><td class="num" id="LN2297">2297</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2298"><td class="num" id="LN2298">2298</td><td class="line"> <span class='comment'>* Fill the screen from 'start_row' to 'end_row', from 'start_col' to 'end_col'</span></td></tr>
<tr class="codeline" data-linenumber="2299"><td class="num" id="LN2299">2299</td><td class="line"> <span class='comment'>* with character 'c1' in first column followed by 'c2' in the other columns.</span></td></tr>
<tr class="codeline" data-linenumber="2300"><td class="num" id="LN2300">2300</td><td class="line"> <span class='comment'>* Use attributes 'attr'.</span></td></tr>
<tr class="codeline" data-linenumber="2301"><td class="num" id="LN2301">2301</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2302"><td class="num" id="LN2302">2302</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2303"><td class="num" id="LN2303">2303</td><td class="line">screen_fill(</td></tr>
<tr class="codeline" data-linenumber="2304"><td class="num" id="LN2304">2304</td><td class="line">	<span class='keyword'>int</span>	start_row,</td></tr>
<tr class="codeline" data-linenumber="2305"><td class="num" id="LN2305">2305</td><td class="line">	<span class='keyword'>int</span>	end_row,</td></tr>
<tr class="codeline" data-linenumber="2306"><td class="num" id="LN2306">2306</td><td class="line">	<span class='keyword'>int</span>	start_col,</td></tr>
<tr class="codeline" data-linenumber="2307"><td class="num" id="LN2307">2307</td><td class="line">	<span class='keyword'>int</span>	end_col,</td></tr>
<tr class="codeline" data-linenumber="2308"><td class="num" id="LN2308">2308</td><td class="line">	<span class='keyword'>int</span>	c1,</td></tr>
<tr class="codeline" data-linenumber="2309"><td class="num" id="LN2309">2309</td><td class="line">	<span class='keyword'>int</span>	c2,</td></tr>
<tr class="codeline" data-linenumber="2310"><td class="num" id="LN2310">2310</td><td class="line">	<span class='keyword'>int</span>	attr)</td></tr>
<tr class="codeline" data-linenumber="2311"><td class="num" id="LN2311">2311</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2312"><td class="num" id="LN2312">2312</td><td class="line">    <span class='keyword'>int</span>	    row;</td></tr>
<tr class="codeline" data-linenumber="2313"><td class="num" id="LN2313">2313</td><td class="line">    <span class='keyword'>int</span>	    col;</td></tr>
<tr class="codeline" data-linenumber="2314"><td class="num" id="LN2314">2314</td><td class="line">    <span class='keyword'>int</span>	    off;</td></tr>
<tr class="codeline" data-linenumber="2315"><td class="num" id="LN2315">2315</td><td class="line">    <span class='keyword'>int</span>	    end_off;</td></tr>
<tr class="codeline" data-linenumber="2316"><td class="num" id="LN2316">2316</td><td class="line">    <span class='keyword'>int</span>	    did_delete;</td></tr>
<tr class="codeline" data-linenumber="2317"><td class="num" id="LN2317">2317</td><td class="line">    <span class='keyword'>int</span>	    c;</td></tr>
<tr class="codeline" data-linenumber="2318"><td class="num" id="LN2318">2318</td><td class="line">    <span class='keyword'>int</span>	    norm_term;</td></tr>
<tr class="codeline" data-linenumber="2319"><td class="num" id="LN2319">2319</td><td class="line"><span class='directive'>#if defined(FEAT_GUI) || defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="2320"><td class="num" id="LN2320">2320</td><td class="line">    <span class='keyword'>int</span>	    force_next = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2321"><td class="num" id="LN2321">2321</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2322"><td class="num" id="LN2322">2322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2323"><td class="num" id="LN2323">2323</td><td class="line">    <span class='keyword'>if</span> (end_row &gt; screen_Rows)		<span class='comment'>// safety check</span></td></tr>
<tr class="codeline" data-linenumber="2324"><td class="num" id="LN2324">2324</td><td class="line">	end_row = screen_Rows;</td></tr>
<tr class="codeline" data-linenumber="2325"><td class="num" id="LN2325">2325</td><td class="line">    <span class='keyword'>if</span> (end_col &gt; screen_Columns)	<span class='comment'>// safety check</span></td></tr>
<tr class="codeline" data-linenumber="2326"><td class="num" id="LN2326">2326</td><td class="line">	end_col = screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="2327"><td class="num" id="LN2327">2327</td><td class="line">    <span class='keyword'>if</span> (ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2328"><td class="num" id="LN2328">2328</td><td class="line">	    || start_row &gt;= end_row</td></tr>
<tr class="codeline" data-linenumber="2329"><td class="num" id="LN2329">2329</td><td class="line">	    || start_col &gt;= end_col)	<span class='comment'>// nothing to do</span></td></tr>
<tr class="codeline" data-linenumber="2330"><td class="num" id="LN2330">2330</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2331"><td class="num" id="LN2331">2331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2332"><td class="num" id="LN2332">2332</td><td class="line">    <span class='comment'>// it's a "normal" terminal when not in a GUI or cterm</span></td></tr>
<tr class="codeline" data-linenumber="2333"><td class="num" id="LN2333">2333</td><td class="line">    norm_term = (</td></tr>
<tr class="codeline" data-linenumber="2334"><td class="num" id="LN2334">2334</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2335"><td class="num" id="LN2335">2335</td><td class="line">	    !gui.in_use &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2336"><td class="num" id="LN2336">2336</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2337"><td class="num" id="LN2337">2337</td><td class="line">	    !<span class='macro'>IS_CTERM<span class='macro_popup'>(t_colors &gt; 1 || p_tgc)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2338"><td class="num" id="LN2338">2338</td><td class="line">    <span class='keyword'>for</span> (row = start_row; row &lt; end_row; ++row)</td></tr>
<tr class="codeline" data-linenumber="2339"><td class="num" id="LN2339">2339</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2340"><td class="num" id="LN2340">2340</td><td class="line">	<span class='keyword'>if</span> (has_mbyte</td></tr>
<tr class="codeline" data-linenumber="2341"><td class="num" id="LN2341">2341</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2342"><td class="num" id="LN2342">2342</td><td class="line">		&amp;&amp; !gui.in_use</td></tr>
<tr class="codeline" data-linenumber="2343"><td class="num" id="LN2343">2343</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2344"><td class="num" id="LN2344">2344</td><td class="line">	   )</td></tr>
<tr class="codeline" data-linenumber="2345"><td class="num" id="LN2345">2345</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2346"><td class="num" id="LN2346">2346</td><td class="line">	    <span class='comment'>// When drawing over the right halve of a double-wide char clear</span></td></tr>
<tr class="codeline" data-linenumber="2347"><td class="num" id="LN2347">2347</td><td class="line">	    <span class='comment'>// out the left halve.  When drawing over the left halve of a</span></td></tr>
<tr class="codeline" data-linenumber="2348"><td class="num" id="LN2348">2348</td><td class="line">	    <span class='comment'>// double wide-char clear out the right halve.  Only needed in a</span></td></tr>
<tr class="codeline" data-linenumber="2349"><td class="num" id="LN2349">2349</td><td class="line">	    <span class='comment'>// terminal.</span></td></tr>
<tr class="codeline" data-linenumber="2350"><td class="num" id="LN2350">2350</td><td class="line">	    <span class='keyword'>if</span> (start_col &gt; 0 &amp;&amp; mb_fix_col(start_col, row) != start_col)</td></tr>
<tr class="codeline" data-linenumber="2351"><td class="num" id="LN2351">2351</td><td class="line">		screen_puts_len((char_u *)<span class='string_literal'>" "</span>, 1, row, start_col - 1, 0);</td></tr>
<tr class="codeline" data-linenumber="2352"><td class="num" id="LN2352">2352</td><td class="line">	    <span class='keyword'>if</span> (end_col &lt; screen_Columns &amp;&amp; mb_fix_col(end_col, row) != end_col)</td></tr>
<tr class="codeline" data-linenumber="2353"><td class="num" id="LN2353">2353</td><td class="line">		screen_puts_len((char_u *)<span class='string_literal'>" "</span>, 1, row, end_col, 0);</td></tr>
<tr class="codeline" data-linenumber="2354"><td class="num" id="LN2354">2354</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2355"><td class="num" id="LN2355">2355</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2356"><td class="num" id="LN2356">2356</td><td class="line">	 <span class='comment'>* Try to use delete-line termcap code, when no attributes or in a</span></td></tr>
<tr class="codeline" data-linenumber="2357"><td class="num" id="LN2357">2357</td><td class="line">	 <span class='comment'>* "normal" terminal, where a bold/italic space is just a</span></td></tr>
<tr class="codeline" data-linenumber="2358"><td class="num" id="LN2358">2358</td><td class="line">	 <span class='comment'>* space.</span></td></tr>
<tr class="codeline" data-linenumber="2359"><td class="num" id="LN2359">2359</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2360"><td class="num" id="LN2360">2360</td><td class="line">	did_delete = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2361"><td class="num" id="LN2361">2361</td><td class="line">	<span class='keyword'>if</span> (c2 == ' '</td></tr>
<tr class="codeline" data-linenumber="2362"><td class="num" id="LN2362">2362</td><td class="line">		&amp;&amp; end_col == Columns</td></tr>
<tr class="codeline" data-linenumber="2363"><td class="num" id="LN2363">2363</td><td class="line">		&amp;&amp; can_clear(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2364"><td class="num" id="LN2364">2364</td><td class="line">		&amp;&amp; (attr == 0</td></tr>
<tr class="codeline" data-linenumber="2365"><td class="num" id="LN2365">2365</td><td class="line">		    || (norm_term</td></tr>
<tr class="codeline" data-linenumber="2366"><td class="num" id="LN2366">2366</td><td class="line">			&amp;&amp; attr &lt;= <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span></td></tr>
<tr class="codeline" data-linenumber="2367"><td class="num" id="LN2367">2367</td><td class="line">			&amp;&amp; ((attr &amp; ~(<span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span> | <span class='macro'>HL_ITALIC<span class='macro_popup'>0x04</span></span>)) == 0))))</td></tr>
<tr class="codeline" data-linenumber="2368"><td class="num" id="LN2368">2368</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2369"><td class="num" id="LN2369">2369</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2370"><td class="num" id="LN2370">2370</td><td class="line">	     <span class='comment'>* check if we really need to clear something</span></td></tr>
<tr class="codeline" data-linenumber="2371"><td class="num" id="LN2371">2371</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2372"><td class="num" id="LN2372">2372</td><td class="line">	    col = start_col;</td></tr>
<tr class="codeline" data-linenumber="2373"><td class="num" id="LN2373">2373</td><td class="line">	    <span class='keyword'>if</span> (c1 != ' ')			<span class='comment'>// don't clear first char</span></td></tr>
<tr class="codeline" data-linenumber="2374"><td class="num" id="LN2374">2374</td><td class="line">		++col;</td></tr>
<tr class="codeline" data-linenumber="2375"><td class="num" id="LN2375">2375</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2376"><td class="num" id="LN2376">2376</td><td class="line">	    off = LineOffset[row] + col;</td></tr>
<tr class="codeline" data-linenumber="2377"><td class="num" id="LN2377">2377</td><td class="line">	    end_off = LineOffset[row] + end_col;</td></tr>
<tr class="codeline" data-linenumber="2378"><td class="num" id="LN2378">2378</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2379"><td class="num" id="LN2379">2379</td><td class="line">	    <span class='comment'>// skip blanks (used often, keep it fast!)</span></td></tr>
<tr class="codeline" data-linenumber="2380"><td class="num" id="LN2380">2380</td><td class="line">	    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="2381"><td class="num" id="LN2381">2381</td><td class="line">		<span class='keyword'>while</span> (off &lt; end_off &amp;&amp; ScreenLines[off] == ' '</td></tr>
<tr class="codeline" data-linenumber="2382"><td class="num" id="LN2382">2382</td><td class="line">			  &amp;&amp; ScreenAttrs[off] == 0 &amp;&amp; ScreenLinesUC[off] == 0)</td></tr>
<tr class="codeline" data-linenumber="2383"><td class="num" id="LN2383">2383</td><td class="line">		    ++off;</td></tr>
<tr class="codeline" data-linenumber="2384"><td class="num" id="LN2384">2384</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2385"><td class="num" id="LN2385">2385</td><td class="line">		<span class='keyword'>while</span> (off &lt; end_off &amp;&amp; ScreenLines[off] == ' '</td></tr>
<tr class="codeline" data-linenumber="2386"><td class="num" id="LN2386">2386</td><td class="line">						     &amp;&amp; ScreenAttrs[off] == 0)</td></tr>
<tr class="codeline" data-linenumber="2387"><td class="num" id="LN2387">2387</td><td class="line">		    ++off;</td></tr>
<tr class="codeline" data-linenumber="2388"><td class="num" id="LN2388">2388</td><td class="line">	    <span class='keyword'>if</span> (off &lt; end_off)		<span class='comment'>// something to be cleared</span></td></tr>
<tr class="codeline" data-linenumber="2389"><td class="num" id="LN2389">2389</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2390"><td class="num" id="LN2390">2390</td><td class="line">		col = off - LineOffset[row];</td></tr>
<tr class="codeline" data-linenumber="2391"><td class="num" id="LN2391">2391</td><td class="line">		screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="2392"><td class="num" id="LN2392">2392</td><td class="line">		term_windgoto(row, col);<span class='comment'>// clear rest of this screen line</span></td></tr>
<tr class="codeline" data-linenumber="2393"><td class="num" id="LN2393">2393</td><td class="line">		out_str(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2394"><td class="num" id="LN2394">2394</td><td class="line">		screen_start();		<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="2395"><td class="num" id="LN2395">2395</td><td class="line">		col = end_col - col;</td></tr>
<tr class="codeline" data-linenumber="2396"><td class="num" id="LN2396">2396</td><td class="line">		<span class='keyword'>while</span> (col--)		<span class='comment'>// clear chars in ScreenLines</span></td></tr>
<tr class="codeline" data-linenumber="2397"><td class="num" id="LN2397">2397</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="2398"><td class="num" id="LN2398">2398</td><td class="line">		    space_to_screenline(off, 0);</td></tr>
<tr class="codeline" data-linenumber="2399"><td class="num" id="LN2399">2399</td><td class="line">		    ++off;</td></tr>
<tr class="codeline" data-linenumber="2400"><td class="num" id="LN2400">2400</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="2401"><td class="num" id="LN2401">2401</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2402"><td class="num" id="LN2402">2402</td><td class="line">	    did_delete = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;		<span class='comment'>// the chars are cleared now</span></td></tr>
<tr class="codeline" data-linenumber="2403"><td class="num" id="LN2403">2403</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2404"><td class="num" id="LN2404">2404</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2405"><td class="num" id="LN2405">2405</td><td class="line">	off = LineOffset[row] + start_col;</td></tr>
<tr class="codeline" data-linenumber="2406"><td class="num" id="LN2406">2406</td><td class="line">	c = c1;</td></tr>
<tr class="codeline" data-linenumber="2407"><td class="num" id="LN2407">2407</td><td class="line">	<span class='keyword'>for</span> (col = start_col; col &lt; end_col; ++col)</td></tr>
<tr class="codeline" data-linenumber="2408"><td class="num" id="LN2408">2408</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2409"><td class="num" id="LN2409">2409</td><td class="line">	    <span class='keyword'>if</span> ((ScreenLines[off] != c</td></tr>
<tr class="codeline" data-linenumber="2410"><td class="num" id="LN2410">2410</td><td class="line">		    || (enc_utf8 &amp;&amp; (<span class='keyword'>int</span>)ScreenLinesUC[off]</td></tr>
<tr class="codeline" data-linenumber="2411"><td class="num" id="LN2411">2411</td><td class="line">						       != (c &gt;= 0x80 ? c : 0))</td></tr>
<tr class="codeline" data-linenumber="2412"><td class="num" id="LN2412">2412</td><td class="line">		    || ScreenAttrs[off] != attr</td></tr>
<tr class="codeline" data-linenumber="2413"><td class="num" id="LN2413">2413</td><td class="line"><span class='directive'>#if defined(FEAT_GUI) || defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="2414"><td class="num" id="LN2414">2414</td><td class="line">		    || force_next</td></tr>
<tr class="codeline" data-linenumber="2415"><td class="num" id="LN2415">2415</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2416"><td class="num" id="LN2416">2416</td><td class="line">		    )</td></tr>
<tr class="codeline" data-linenumber="2417"><td class="num" id="LN2417">2417</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2418"><td class="num" id="LN2418">2418</td><td class="line">		    <span class='comment'>// Skip if under a(nother) popup.</span></td></tr>
<tr class="codeline" data-linenumber="2419"><td class="num" id="LN2419">2419</td><td class="line">		    &amp;&amp; !blocked_by_popup(row, col)</td></tr>
<tr class="codeline" data-linenumber="2420"><td class="num" id="LN2420">2420</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2421"><td class="num" id="LN2421">2421</td><td class="line">	       )</td></tr>
<tr class="codeline" data-linenumber="2422"><td class="num" id="LN2422">2422</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2423"><td class="num" id="LN2423">2423</td><td class="line"><span class='directive'>#if defined(FEAT_GUI) || defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="2424"><td class="num" id="LN2424">2424</td><td class="line">		<span class='comment'>// The bold trick may make a single row of pixels appear in</span></td></tr>
<tr class="codeline" data-linenumber="2425"><td class="num" id="LN2425">2425</td><td class="line">		<span class='comment'>// the next character.  When a bold character is removed, the</span></td></tr>
<tr class="codeline" data-linenumber="2426"><td class="num" id="LN2426">2426</td><td class="line">		<span class='comment'>// next character should be redrawn too.  This happens for our</span></td></tr>
<tr class="codeline" data-linenumber="2427"><td class="num" id="LN2427">2427</td><td class="line">		<span class='comment'>// own GUI and for some xterms.</span></td></tr>
<tr class="codeline" data-linenumber="2428"><td class="num" id="LN2428">2428</td><td class="line">		<span class='keyword'>if</span> (</td></tr>
<tr class="codeline" data-linenumber="2429"><td class="num" id="LN2429">2429</td><td class="line"><span class='directive'># ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2430"><td class="num" id="LN2430">2430</td><td class="line">			gui.in_use</td></tr>
<tr class="codeline" data-linenumber="2431"><td class="num" id="LN2431">2431</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="2432"><td class="num" id="LN2432">2432</td><td class="line"><span class='directive'># if defined(FEAT_GUI) &amp;&amp; defined(<span class='macro'>UNIX<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="2433"><td class="num" id="LN2433">2433</td><td class="line">			||</td></tr>
<tr class="codeline" data-linenumber="2434"><td class="num" id="LN2434">2434</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="2435"><td class="num" id="LN2435">2435</td><td class="line"><span class='directive'># ifdef <span class='macro'>UNIX<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2436"><td class="num" id="LN2436">2436</td><td class="line">			term_is_xterm</td></tr>
<tr class="codeline" data-linenumber="2437"><td class="num" id="LN2437">2437</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="2438"><td class="num" id="LN2438">2438</td><td class="line">		   )</td></tr>
<tr class="codeline" data-linenumber="2439"><td class="num" id="LN2439">2439</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="2440"><td class="num" id="LN2440">2440</td><td class="line">		    <span class='keyword'>if</span> (ScreenLines[off] != ' '</td></tr>
<tr class="codeline" data-linenumber="2441"><td class="num" id="LN2441">2441</td><td class="line">			    &amp;&amp; (ScreenAttrs[off] &gt; <span class='macro'>HL_ALL<span class='macro_popup'>0xff</span></span></td></tr>
<tr class="codeline" data-linenumber="2442"><td class="num" id="LN2442">2442</td><td class="line">				|| ScreenAttrs[off] &amp; <span class='macro'>HL_BOLD<span class='macro_popup'>0x02</span></span>))</td></tr>
<tr class="codeline" data-linenumber="2443"><td class="num" id="LN2443">2443</td><td class="line">			force_next = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2444"><td class="num" id="LN2444">2444</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2445"><td class="num" id="LN2445">2445</td><td class="line">			force_next = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2446"><td class="num" id="LN2446">2446</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="2447"><td class="num" id="LN2447">2447</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2448"><td class="num" id="LN2448">2448</td><td class="line">		ScreenLines[off] = c;</td></tr>
<tr class="codeline" data-linenumber="2449"><td class="num" id="LN2449">2449</td><td class="line">		<span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="2450"><td class="num" id="LN2450">2450</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="2451"><td class="num" id="LN2451">2451</td><td class="line">		    <span class='keyword'>if</span> (c &gt;= 0x80)</td></tr>
<tr class="codeline" data-linenumber="2452"><td class="num" id="LN2452">2452</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="2453"><td class="num" id="LN2453">2453</td><td class="line">			ScreenLinesUC[off] = c;</td></tr>
<tr class="codeline" data-linenumber="2454"><td class="num" id="LN2454">2454</td><td class="line">			ScreenLinesC[0][off] = 0;</td></tr>
<tr class="codeline" data-linenumber="2455"><td class="num" id="LN2455">2455</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="2456"><td class="num" id="LN2456">2456</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2457"><td class="num" id="LN2457">2457</td><td class="line">			ScreenLinesUC[off] = 0;</td></tr>
<tr class="codeline" data-linenumber="2458"><td class="num" id="LN2458">2458</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="2459"><td class="num" id="LN2459">2459</td><td class="line">		ScreenAttrs[off] = attr;</td></tr>
<tr class="codeline" data-linenumber="2460"><td class="num" id="LN2460">2460</td><td class="line">		<span class='keyword'>if</span> (!did_delete || c != ' ')</td></tr>
<tr class="codeline" data-linenumber="2461"><td class="num" id="LN2461">2461</td><td class="line">		    screen_char(off, row, col);</td></tr>
<tr class="codeline" data-linenumber="2462"><td class="num" id="LN2462">2462</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2463"><td class="num" id="LN2463">2463</td><td class="line">	    ++off;</td></tr>
<tr class="codeline" data-linenumber="2464"><td class="num" id="LN2464">2464</td><td class="line">	    <span class='keyword'>if</span> (col == start_col)</td></tr>
<tr class="codeline" data-linenumber="2465"><td class="num" id="LN2465">2465</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2466"><td class="num" id="LN2466">2466</td><td class="line">		<span class='keyword'>if</span> (did_delete)</td></tr>
<tr class="codeline" data-linenumber="2467"><td class="num" id="LN2467">2467</td><td class="line">		    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2468"><td class="num" id="LN2468">2468</td><td class="line">		c = c2;</td></tr>
<tr class="codeline" data-linenumber="2469"><td class="num" id="LN2469">2469</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2470"><td class="num" id="LN2470">2470</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2471"><td class="num" id="LN2471">2471</td><td class="line">	<span class='keyword'>if</span> (end_col == Columns)</td></tr>
<tr class="codeline" data-linenumber="2472"><td class="num" id="LN2472">2472</td><td class="line">	    LineWraps[row] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2473"><td class="num" id="LN2473">2473</td><td class="line">	<span class='keyword'>if</span> (row == Rows - 1)		<span class='comment'>// overwritten the command line</span></td></tr>
<tr class="codeline" data-linenumber="2474"><td class="num" id="LN2474">2474</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2475"><td class="num" id="LN2475">2475</td><td class="line">	    redraw_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2476"><td class="num" id="LN2476">2476</td><td class="line">	    <span class='keyword'>if</span> (start_col == 0 &amp;&amp; end_col == Columns</td></tr>
<tr class="codeline" data-linenumber="2477"><td class="num" id="LN2477">2477</td><td class="line">		    &amp;&amp; c1 == ' ' &amp;&amp; c2 == ' ' &amp;&amp; attr == 0)</td></tr>
<tr class="codeline" data-linenumber="2478"><td class="num" id="LN2478">2478</td><td class="line">		clear_cmdline = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;	<span class='comment'>// command line has been cleared</span></td></tr>
<tr class="codeline" data-linenumber="2479"><td class="num" id="LN2479">2479</td><td class="line">	    <span class='keyword'>if</span> (start_col == 0)</td></tr>
<tr class="codeline" data-linenumber="2480"><td class="num" id="LN2480">2480</td><td class="line">		mode_displayed = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>; <span class='comment'>// mode cleared or overwritten</span></td></tr>
<tr class="codeline" data-linenumber="2481"><td class="num" id="LN2481">2481</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2482"><td class="num" id="LN2482">2482</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2483"><td class="num" id="LN2483">2483</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2484"><td class="num" id="LN2484">2484</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2485"><td class="num" id="LN2485">2485</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2486"><td class="num" id="LN2486">2486</td><td class="line"> <span class='comment'>* Check if there should be a delay.  Used before clearing or redrawing the</span></td></tr>
<tr class="codeline" data-linenumber="2487"><td class="num" id="LN2487">2487</td><td class="line"> <span class='comment'>* screen or the command line.</span></td></tr>
<tr class="codeline" data-linenumber="2488"><td class="num" id="LN2488">2488</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2489"><td class="num" id="LN2489">2489</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2490"><td class="num" id="LN2490">2490</td><td class="line">check_for_delay(<span class='keyword'>int</span> check_msg_scroll)</td></tr>
<tr class="codeline" data-linenumber="2491"><td class="num" id="LN2491">2491</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2492"><td class="num" id="LN2492">2492</td><td class="line">    <span class='keyword'>if</span> ((emsg_on_display || (check_msg_scroll &amp;&amp; msg_scroll))</td></tr>
<tr class="codeline" data-linenumber="2493"><td class="num" id="LN2493">2493</td><td class="line">	    &amp;&amp; !did_wait_return</td></tr>
<tr class="codeline" data-linenumber="2494"><td class="num" id="LN2494">2494</td><td class="line">	    &amp;&amp; emsg_silent == 0</td></tr>
<tr class="codeline" data-linenumber="2495"><td class="num" id="LN2495">2495</td><td class="line">	    &amp;&amp; !in_assert_fails)</td></tr>
<tr class="codeline" data-linenumber="2496"><td class="num" id="LN2496">2496</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2497"><td class="num" id="LN2497">2497</td><td class="line">	out_flush();</td></tr>
<tr class="codeline" data-linenumber="2498"><td class="num" id="LN2498">2498</td><td class="line">	ui_delay(1006L, <span class='macro'>TRUE<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2499"><td class="num" id="LN2499">2499</td><td class="line">	emsg_on_display = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2500"><td class="num" id="LN2500">2500</td><td class="line">	<span class='keyword'>if</span> (check_msg_scroll)</td></tr>
<tr class="codeline" data-linenumber="2501"><td class="num" id="LN2501">2501</td><td class="line">	    msg_scroll = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2502"><td class="num" id="LN2502">2502</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2503"><td class="num" id="LN2503">2503</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2504"><td class="num" id="LN2504">2504</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2505"><td class="num" id="LN2505">2505</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2506"><td class="num" id="LN2506">2506</td><td class="line"> <span class='comment'>* Init TabPageIdxs[] to zero: Clicking outside of tabs has no effect.</span></td></tr>
<tr class="codeline" data-linenumber="2507"><td class="num" id="LN2507">2507</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2508"><td class="num" id="LN2508">2508</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2509"><td class="num" id="LN2509">2509</td><td class="line">clear_TabPageIdxs(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="2510"><td class="num" id="LN2510">2510</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2511"><td class="num" id="LN2511">2511</td><td class="line">    <span class='keyword'>int</span>		scol;</td></tr>
<tr class="codeline" data-linenumber="2512"><td class="num" id="LN2512">2512</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2513"><td class="num" id="LN2513">2513</td><td class="line">    <span class='keyword'>for</span> (scol = 0; scol &lt; Columns; ++scol)</td></tr>
<tr class="codeline" data-linenumber="2514"><td class="num" id="LN2514">2514</td><td class="line">	TabPageIdxs[scol] = 0;</td></tr>
<tr class="codeline" data-linenumber="2515"><td class="num" id="LN2515">2515</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2516"><td class="num" id="LN2516">2516</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2517"><td class="num" id="LN2517">2517</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2518"><td class="num" id="LN2518">2518</td><td class="line"> <span class='comment'>* screen_valid -  allocate screen buffers if size changed</span></td></tr>
<tr class="codeline" data-linenumber="2519"><td class="num" id="LN2519">2519</td><td class="line"> <span class='comment'>*   If "doclear" is TRUE: clear screen if it has been resized.</span></td></tr>
<tr class="codeline" data-linenumber="2520"><td class="num" id="LN2520">2520</td><td class="line"> <span class='comment'>*	Returns TRUE if there is a valid screen to write to.</span></td></tr>
<tr class="codeline" data-linenumber="2521"><td class="num" id="LN2521">2521</td><td class="line"> <span class='comment'>*	Returns FALSE when starting up and screen not initialized yet.</span></td></tr>
<tr class="codeline" data-linenumber="2522"><td class="num" id="LN2522">2522</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2523"><td class="num" id="LN2523">2523</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="2524"><td class="num" id="LN2524">2524</td><td class="line">screen_valid(<span class='keyword'>int</span> doclear)</td></tr>
<tr class="codeline" data-linenumber="2525"><td class="num" id="LN2525">2525</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2526"><td class="num" id="LN2526">2526</td><td class="line">    screenalloc(doclear);	   <span class='comment'>// allocate screen buffers if size changed</span></td></tr>
<tr class="codeline" data-linenumber="2527"><td class="num" id="LN2527">2527</td><td class="line">    <span class='keyword'>return</span> (ScreenLines != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2528"><td class="num" id="LN2528">2528</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2529"><td class="num" id="LN2529">2529</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2530"><td class="num" id="LN2530">2530</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2531"><td class="num" id="LN2531">2531</td><td class="line"> <span class='comment'>* Resize the shell to Rows and Columns.</span></td></tr>
<tr class="codeline" data-linenumber="2532"><td class="num" id="LN2532">2532</td><td class="line"> <span class='comment'>* Allocate ScreenLines[] and associated items.</span></td></tr>
<tr class="codeline" data-linenumber="2533"><td class="num" id="LN2533">2533</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="2534"><td class="num" id="LN2534">2534</td><td class="line"> <span class='comment'>* There may be some time between setting Rows and Columns and (re)allocating</span></td></tr>
<tr class="codeline" data-linenumber="2535"><td class="num" id="LN2535">2535</td><td class="line"> <span class='comment'>* ScreenLines[].  This happens when starting up and when (manually) changing</span></td></tr>
<tr class="codeline" data-linenumber="2536"><td class="num" id="LN2536">2536</td><td class="line"> <span class='comment'>* the shell size.  Always use screen_Rows and screen_Columns to access items</span></td></tr>
<tr class="codeline" data-linenumber="2537"><td class="num" id="LN2537">2537</td><td class="line"> <span class='comment'>* in ScreenLines[].  Use Rows and Columns for positioning text etc. where the</span></td></tr>
<tr class="codeline" data-linenumber="2538"><td class="num" id="LN2538">2538</td><td class="line"> <span class='comment'>* final size of the shell is needed.</span></td></tr>
<tr class="codeline" data-linenumber="2539"><td class="num" id="LN2539">2539</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2540"><td class="num" id="LN2540">2540</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2541"><td class="num" id="LN2541">2541</td><td class="line">screenalloc(<span class='keyword'>int</span> doclear)</td></tr>
<tr class="codeline" data-linenumber="2542"><td class="num" id="LN2542">2542</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2543"><td class="num" id="LN2543">2543</td><td class="line">    <span class='keyword'>int</span>		    new_row, old_row;</td></tr>
<tr class="codeline" data-linenumber="2544"><td class="num" id="LN2544">2544</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2545"><td class="num" id="LN2545">2545</td><td class="line">    <span class='keyword'>int</span>		    old_Rows;</td></tr>
<tr class="codeline" data-linenumber="2546"><td class="num" id="LN2546">2546</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2547"><td class="num" id="LN2547">2547</td><td class="line">    win_T	    *wp;</td></tr>
<tr class="codeline" data-linenumber="2548"><td class="num" id="LN2548">2548</td><td class="line">    <span class='keyword'>int</span>		    outofmem = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2549"><td class="num" id="LN2549">2549</td><td class="line">    <span class='keyword'>int</span>		    len;</td></tr>
<tr class="codeline" data-linenumber="2550"><td class="num" id="LN2550">2550</td><td class="line">    schar_T	    *new_ScreenLines;</td></tr>
<tr class="codeline" data-linenumber="2551"><td class="num" id="LN2551">2551</td><td class="line">    u8char_T	    *new_ScreenLinesUC = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2552"><td class="num" id="LN2552">2552</td><td class="line">    u8char_T	    *new_ScreenLinesC[<span class='macro'>MAX_MCO<span class='macro_popup'>6</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2553"><td class="num" id="LN2553">2553</td><td class="line">    schar_T	    *new_ScreenLines2 = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2554"><td class="num" id="LN2554">2554</td><td class="line">    <span class='keyword'>int</span>		    i;</td></tr>
<tr class="codeline" data-linenumber="2555"><td class="num" id="LN2555">2555</td><td class="line">    sattr_T	    *new_ScreenAttrs;</td></tr>
<tr class="codeline" data-linenumber="2556"><td class="num" id="LN2556">2556</td><td class="line">    <span class='keyword'>unsigned</span>	    *new_LineOffset;</td></tr>
<tr class="codeline" data-linenumber="2557"><td class="num" id="LN2557">2557</td><td class="line">    char_u	    *new_LineWraps;</td></tr>
<tr class="codeline" data-linenumber="2558"><td class="num" id="LN2558">2558</td><td class="line">    <span class='keyword'>short</span>	    *new_TabPageIdxs;</td></tr>
<tr class="codeline" data-linenumber="2559"><td class="num" id="LN2559">2559</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2560"><td class="num" id="LN2560">2560</td><td class="line">    <span class='keyword'>short</span>	    *new_popup_mask;</td></tr>
<tr class="codeline" data-linenumber="2561"><td class="num" id="LN2561">2561</td><td class="line">    <span class='keyword'>short</span>	    *new_popup_mask_next;</td></tr>
<tr class="codeline" data-linenumber="2562"><td class="num" id="LN2562">2562</td><td class="line">    <span class='keyword'>char</span>	    *new_popup_transparent;</td></tr>
<tr class="codeline" data-linenumber="2563"><td class="num" id="LN2563">2563</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2564"><td class="num" id="LN2564">2564</td><td class="line">    tabpage_T	    *tp;</td></tr>
<tr class="codeline" data-linenumber="2565"><td class="num" id="LN2565">2565</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span>	    entered = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;		<span class='comment'>// avoid recursiveness</span></td></tr>
<tr class="codeline" data-linenumber="2566"><td class="num" id="LN2566">2566</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span>	    done_outofmem_msg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;	<span class='comment'>// did outofmem message</span></td></tr>
<tr class="codeline" data-linenumber="2567"><td class="num" id="LN2567">2567</td><td class="line">    <span class='keyword'>int</span>		    retry_count = 0;</td></tr>
<tr class="codeline" data-linenumber="2568"><td class="num" id="LN2568">2568</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2569"><td class="num" id="LN2569">2569</td><td class="line">retry:</td></tr>
<tr class="codeline" data-linenumber="2570"><td class="num" id="LN2570">2570</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2571"><td class="num" id="LN2571">2571</td><td class="line">     <span class='comment'>* Allocation of the screen buffers is done only when the size changes and</span></td></tr>
<tr class="codeline" data-linenumber="2572"><td class="num" id="LN2572">2572</td><td class="line">     <span class='comment'>* when Rows and Columns have been set and we have started doing full</span></td></tr>
<tr class="codeline" data-linenumber="2573"><td class="num" id="LN2573">2573</td><td class="line">     <span class='comment'>* screen stuff.</span></td></tr>
<tr class="codeline" data-linenumber="2574"><td class="num" id="LN2574">2574</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2575"><td class="num" id="LN2575">2575</td><td class="line">    <span class='keyword'>if</span> ((ScreenLines != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2576"><td class="num" id="LN2576">2576</td><td class="line">		&amp;&amp; Rows == screen_Rows</td></tr>
<tr class="codeline" data-linenumber="2577"><td class="num" id="LN2577">2577</td><td class="line">		&amp;&amp; Columns == screen_Columns</td></tr>
<tr class="codeline" data-linenumber="2578"><td class="num" id="LN2578">2578</td><td class="line">		&amp;&amp; enc_utf8 == (ScreenLinesUC != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2579"><td class="num" id="LN2579">2579</td><td class="line">		&amp;&amp; (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span>) == (ScreenLines2 != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2580"><td class="num" id="LN2580">2580</td><td class="line">		&amp;&amp; p_mco == Screen_mco)</td></tr>
<tr class="codeline" data-linenumber="2581"><td class="num" id="LN2581">2581</td><td class="line">	    || Rows == 0</td></tr>
<tr class="codeline" data-linenumber="2582"><td class="num" id="LN2582">2582</td><td class="line">	    || Columns == 0</td></tr>
<tr class="codeline" data-linenumber="2583"><td class="num" id="LN2583">2583</td><td class="line">	    || (!full_screen &amp;&amp; ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="2584"><td class="num" id="LN2584">2584</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2585"><td class="num" id="LN2585">2585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2586"><td class="num" id="LN2586">2586</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2587"><td class="num" id="LN2587">2587</td><td class="line">     <span class='comment'>* It's possible that we produce an out-of-memory message below, which</span></td></tr>
<tr class="codeline" data-linenumber="2588"><td class="num" id="LN2588">2588</td><td class="line">     <span class='comment'>* will cause this function to be called again.  To break the loop, just</span></td></tr>
<tr class="codeline" data-linenumber="2589"><td class="num" id="LN2589">2589</td><td class="line">     <span class='comment'>* return here.</span></td></tr>
<tr class="codeline" data-linenumber="2590"><td class="num" id="LN2590">2590</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2591"><td class="num" id="LN2591">2591</td><td class="line">    <span class='keyword'>if</span> (entered)</td></tr>
<tr class="codeline" data-linenumber="2592"><td class="num" id="LN2592">2592</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2593"><td class="num" id="LN2593">2593</td><td class="line">    entered = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2594"><td class="num" id="LN2594">2594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2595"><td class="num" id="LN2595">2595</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2596"><td class="num" id="LN2596">2596</td><td class="line">     <span class='comment'>* Note that the window sizes are updated before reallocating the arrays,</span></td></tr>
<tr class="codeline" data-linenumber="2597"><td class="num" id="LN2597">2597</td><td class="line">     <span class='comment'>* thus we must not redraw here!</span></td></tr>
<tr class="codeline" data-linenumber="2598"><td class="num" id="LN2598">2598</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2599"><td class="num" id="LN2599">2599</td><td class="line">    ++RedrawingDisabled;</td></tr>
<tr class="codeline" data-linenumber="2600"><td class="num" id="LN2600">2600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2601"><td class="num" id="LN2601">2601</td><td class="line">    win_new_shellsize();    <span class='comment'>// fit the windows in the new sized shell</span></td></tr>
<tr class="codeline" data-linenumber="2602"><td class="num" id="LN2602">2602</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2603"><td class="num" id="LN2603">2603</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_HAIKU</span></td></tr>
<tr class="codeline" data-linenumber="2604"><td class="num" id="LN2604">2604</td><td class="line">    vim_lock_screen();  <span class='comment'>// be safe, put it here</span></td></tr>
<tr class="codeline" data-linenumber="2605"><td class="num" id="LN2605">2605</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2606"><td class="num" id="LN2606">2606</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2607"><td class="num" id="LN2607">2607</td><td class="line">    comp_col();		<span class='comment'>// recompute columns for shown command and ruler</span></td></tr>
<tr class="codeline" data-linenumber="2608"><td class="num" id="LN2608">2608</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2609"><td class="num" id="LN2609">2609</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2610"><td class="num" id="LN2610">2610</td><td class="line">     <span class='comment'>* We're changing the size of the screen.</span></td></tr>
<tr class="codeline" data-linenumber="2611"><td class="num" id="LN2611">2611</td><td class="line">     <span class='comment'>* - Allocate new arrays for ScreenLines and ScreenAttrs.</span></td></tr>
<tr class="codeline" data-linenumber="2612"><td class="num" id="LN2612">2612</td><td class="line">     <span class='comment'>* - Move lines from the old arrays into the new arrays, clear extra</span></td></tr>
<tr class="codeline" data-linenumber="2613"><td class="num" id="LN2613">2613</td><td class="line">     <span class='comment'>*	 lines (unless the screen is going to be cleared).</span></td></tr>
<tr class="codeline" data-linenumber="2614"><td class="num" id="LN2614">2614</td><td class="line">     <span class='comment'>* - Free the old arrays.</span></td></tr>
<tr class="codeline" data-linenumber="2615"><td class="num" id="LN2615">2615</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="2616"><td class="num" id="LN2616">2616</td><td class="line">     <span class='comment'>* If anything fails, make ScreenLines NULL, so we don't do anything!</span></td></tr>
<tr class="codeline" data-linenumber="2617"><td class="num" id="LN2617">2617</td><td class="line">     <span class='comment'>* Continuing with the old ScreenLines may result in a crash, because the</span></td></tr>
<tr class="codeline" data-linenumber="2618"><td class="num" id="LN2618">2618</td><td class="line">     <span class='comment'>* size is wrong.</span></td></tr>
<tr class="codeline" data-linenumber="2619"><td class="num" id="LN2619">2619</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2620"><td class="num" id="LN2620">2620</td><td class="line">    <span class='macro'>FOR_ALL_TAB_WINDOWS(tp, wp)<span class='macro_popup'>for ((tp) = first_tabpage; (tp) != ((void*)0); (tp) = (tp)-&gt;<br>tp_next) for ((wp) = ((tp) == curtab) ? firstwin : (tp)-&gt;tp_firstwin<br>; (wp); (wp) = (wp)-&gt;w_next)</span></span></td></tr>
<tr class="codeline" data-linenumber="2621"><td class="num" id="LN2621">2621</td><td class="line">	win_free_lsize(wp);</td></tr>
<tr class="codeline" data-linenumber="2622"><td class="num" id="LN2622">2622</td><td class="line">    <span class='keyword'>if</span> (aucmd_win != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2623"><td class="num" id="LN2623">2623</td><td class="line">	win_free_lsize(aucmd_win);</td></tr>
<tr class="codeline" data-linenumber="2624"><td class="num" id="LN2624">2624</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2625"><td class="num" id="LN2625">2625</td><td class="line">    <span class='comment'>// global popup windows</span></td></tr>
<tr class="codeline" data-linenumber="2626"><td class="num" id="LN2626">2626</td><td class="line">    <span class='macro'>FOR_ALL_POPUPWINS(wp)<span class='macro_popup'>for ((wp) = first_popupwin; (wp) != ((void*)0); (wp) = (wp)-&gt;<br>w_next)</span></span></td></tr>
<tr class="codeline" data-linenumber="2627"><td class="num" id="LN2627">2627</td><td class="line">	win_free_lsize(wp);</td></tr>
<tr class="codeline" data-linenumber="2628"><td class="num" id="LN2628">2628</td><td class="line">    <span class='comment'>// tab-local popup windows</span></td></tr>
<tr class="codeline" data-linenumber="2629"><td class="num" id="LN2629">2629</td><td class="line">    <span class='macro'>FOR_ALL_TABPAGES(tp)<span class='macro_popup'>for (tp = first_tabpage; tp != ((void*)0); tp = tp-&gt;tp_next<br>)</span></span></td></tr>
<tr class="codeline" data-linenumber="2630"><td class="num" id="LN2630">2630</td><td class="line">	<span class='macro'>FOR_ALL_POPUPWINS_IN_TAB(tp, wp)<span class='macro_popup'>for ((wp) = (tp)-&gt;tp_first_popupwin; (wp) != ((void*)0); (<br>wp) = (wp)-&gt;w_next)</span></span></td></tr>
<tr class="codeline" data-linenumber="2631"><td class="num" id="LN2631">2631</td><td class="line">	    win_free_lsize(wp);</td></tr>
<tr class="codeline" data-linenumber="2632"><td class="num" id="LN2632">2632</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2633"><td class="num" id="LN2633">2633</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2634"><td class="num" id="LN2634">2634</td><td class="line">    new_ScreenLines = <span class='macro'>LALLOC_MULT(schar_T, (Rows + 1) * Columns)<span class='macro_popup'>(schar_T *)lalloc(sizeof(schar_T) * ((Rows + 1) * Columns), 0<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2635"><td class="num" id="LN2635">2635</td><td class="line">    <span class='macro'>vim_memset(new_ScreenLinesC, 0, <span class='keyword'>sizeof</span>(u8char_T *) * MAX_MCO)<span class='macro_popup'>memset((new_ScreenLinesC), (0), (sizeof(u8char_T *) * 6))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2636"><td class="num" id="LN2636">2636</td><td class="line">    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="2637"><td class="num" id="LN2637">2637</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2638"><td class="num" id="LN2638">2638</td><td class="line">	new_ScreenLinesUC = <span class='macro'>LALLOC_MULT(u8char_T, (Rows + 1) * Columns)<span class='macro_popup'>(u8char_T *)lalloc(sizeof(u8char_T) * ((Rows + 1) * Columns),<br> 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2639"><td class="num" id="LN2639">2639</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2640"><td class="num" id="LN2640">2640</td><td class="line">	    new_ScreenLinesC[i] = <span class='macro'>LALLOC_CLEAR_MULT(u8char_T,<span class='macro_popup'>(u8char_T *)lalloc_clear(sizeof(u8char_T) * ((Rows + 1) * Columns<br>), 0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2641"><td class="num" id="LN2641">2641</td><td class="line">							 <span class='macro'>(Rows + 1) * Columns)<span class='macro_popup'>(u8char_T *)lalloc_clear(sizeof(u8char_T) * ((Rows + 1) * Columns<br>), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2642"><td class="num" id="LN2642">2642</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2643"><td class="num" id="LN2643">2643</td><td class="line">    <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2644"><td class="num" id="LN2644">2644</td><td class="line">	new_ScreenLines2 = <span class='macro'>LALLOC_MULT(schar_T, (Rows + 1) * Columns)<span class='macro_popup'>(schar_T *)lalloc(sizeof(schar_T) * ((Rows + 1) * Columns), 0<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2645"><td class="num" id="LN2645">2645</td><td class="line">    new_ScreenAttrs = <span class='macro'>LALLOC_MULT(sattr_T, (Rows + 1) * Columns)<span class='macro_popup'>(sattr_T *)lalloc(sizeof(sattr_T) * ((Rows + 1) * Columns), 0<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2646"><td class="num" id="LN2646">2646</td><td class="line">    new_LineOffset = <span class='macro'>LALLOC_MULT(<span class='keyword'>unsigned</span>, Rows)<span class='macro_popup'>(unsigned *)lalloc(sizeof(unsigned) * (Rows), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2647"><td class="num" id="LN2647">2647</td><td class="line">    new_LineWraps = <span class='macro'>LALLOC_MULT(char_u, Rows)<span class='macro_popup'>(char_u *)lalloc(sizeof(char_u) * (Rows), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2648"><td class="num" id="LN2648">2648</td><td class="line">    new_TabPageIdxs = <span class='macro'>LALLOC_MULT(<span class='keyword'>short</span>, Columns)<span class='macro_popup'>(short *)lalloc(sizeof(short) * (Columns), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2649"><td class="num" id="LN2649">2649</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2650"><td class="num" id="LN2650">2650</td><td class="line">    new_popup_mask = <span class='macro'>LALLOC_MULT(<span class='keyword'>short</span>, Rows * Columns)<span class='macro_popup'>(short *)lalloc(sizeof(short) * (Rows * Columns), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2651"><td class="num" id="LN2651">2651</td><td class="line">    new_popup_mask_next = <span class='macro'>LALLOC_MULT(<span class='keyword'>short</span>, Rows * Columns)<span class='macro_popup'>(short *)lalloc(sizeof(short) * (Rows * Columns), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2652"><td class="num" id="LN2652">2652</td><td class="line">    new_popup_transparent = <span class='macro'>LALLOC_MULT(<span class='keyword'>char</span>, Rows * Columns)<span class='macro_popup'>(char *)lalloc(sizeof(char) * (Rows * Columns), 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2653"><td class="num" id="LN2653">2653</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2654"><td class="num" id="LN2654">2654</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2655"><td class="num" id="LN2655">2655</td><td class="line">    <span class='macro'>FOR_ALL_TAB_WINDOWS(tp, wp)<span class='macro_popup'>for ((tp) = first_tabpage; (tp) != ((void*)0); (tp) = (tp)-&gt;<br>tp_next) for ((wp) = ((tp) == curtab) ? firstwin : (tp)-&gt;tp_firstwin<br>; (wp); (wp) = (wp)-&gt;w_next)</span></span></td></tr>
<tr class="codeline" data-linenumber="2656"><td class="num" id="LN2656">2656</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2657"><td class="num" id="LN2657">2657</td><td class="line">	<span class='keyword'>if</span> (win_alloc_lines(wp) == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2658"><td class="num" id="LN2658">2658</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2659"><td class="num" id="LN2659">2659</td><td class="line">	    outofmem = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2660"><td class="num" id="LN2660">2660</td><td class="line">	    <span class='keyword'>goto</span> give_up;</td></tr>
<tr class="codeline" data-linenumber="2661"><td class="num" id="LN2661">2661</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2662"><td class="num" id="LN2662">2662</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2663"><td class="num" id="LN2663">2663</td><td class="line">    <span class='keyword'>if</span> (aucmd_win != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; aucmd_win-&gt;w_lines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2664"><td class="num" id="LN2664">2664</td><td class="line">					&amp;&amp; win_alloc_lines(aucmd_win) == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2665"><td class="num" id="LN2665">2665</td><td class="line">	outofmem = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2666"><td class="num" id="LN2666">2666</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2667"><td class="num" id="LN2667">2667</td><td class="line">    <span class='comment'>// global popup windows</span></td></tr>
<tr class="codeline" data-linenumber="2668"><td class="num" id="LN2668">2668</td><td class="line">    <span class='macro'>FOR_ALL_POPUPWINS(wp)<span class='macro_popup'>for ((wp) = first_popupwin; (wp) != ((void*)0); (wp) = (wp)-&gt;<br>w_next)</span></span></td></tr>
<tr class="codeline" data-linenumber="2669"><td class="num" id="LN2669">2669</td><td class="line">	<span class='keyword'>if</span> (win_alloc_lines(wp) == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2670"><td class="num" id="LN2670">2670</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2671"><td class="num" id="LN2671">2671</td><td class="line">	    outofmem = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2672"><td class="num" id="LN2672">2672</td><td class="line">	    <span class='keyword'>goto</span> give_up;</td></tr>
<tr class="codeline" data-linenumber="2673"><td class="num" id="LN2673">2673</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2674"><td class="num" id="LN2674">2674</td><td class="line">    <span class='comment'>// tab-local popup windows</span></td></tr>
<tr class="codeline" data-linenumber="2675"><td class="num" id="LN2675">2675</td><td class="line">    <span class='macro'>FOR_ALL_TABPAGES(tp)<span class='macro_popup'>for (tp = first_tabpage; tp != ((void*)0); tp = tp-&gt;tp_next<br>)</span></span></td></tr>
<tr class="codeline" data-linenumber="2676"><td class="num" id="LN2676">2676</td><td class="line">	<span class='macro'>FOR_ALL_POPUPWINS_IN_TAB(tp, wp)<span class='macro_popup'>for ((wp) = (tp)-&gt;tp_first_popupwin; (wp) != ((void*)0); (<br>wp) = (wp)-&gt;w_next)</span></span></td></tr>
<tr class="codeline" data-linenumber="2677"><td class="num" id="LN2677">2677</td><td class="line">	    <span class='keyword'>if</span> (win_alloc_lines(wp) == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2678"><td class="num" id="LN2678">2678</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2679"><td class="num" id="LN2679">2679</td><td class="line">		outofmem = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2680"><td class="num" id="LN2680">2680</td><td class="line">		<span class='keyword'>goto</span> give_up;</td></tr>
<tr class="codeline" data-linenumber="2681"><td class="num" id="LN2681">2681</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2682"><td class="num" id="LN2682">2682</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2683"><td class="num" id="LN2683">2683</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2684"><td class="num" id="LN2684">2684</td><td class="line">give_up:</td></tr>
<tr class="codeline" data-linenumber="2685"><td class="num" id="LN2685">2685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2686"><td class="num" id="LN2686">2686</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2687"><td class="num" id="LN2687">2687</td><td class="line">	<span class='keyword'>if</span> (new_ScreenLinesC[i] == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2688"><td class="num" id="LN2688">2688</td><td class="line">	    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2689"><td class="num" id="LN2689">2689</td><td class="line">    <span class='keyword'>if</span> (new_ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2690"><td class="num" id="LN2690">2690</td><td class="line">	    || (enc_utf8 &amp;&amp; (new_ScreenLinesUC == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || i != p_mco))</td></tr>
<tr class="codeline" data-linenumber="2691"><td class="num" id="LN2691">2691</td><td class="line">	    || (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; new_ScreenLines2 == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2692"><td class="num" id="LN2692">2692</td><td class="line">	    || new_ScreenAttrs == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2693"><td class="num" id="LN2693">2693</td><td class="line">	    || new_LineOffset == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2694"><td class="num" id="LN2694">2694</td><td class="line">	    || new_LineWraps == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2695"><td class="num" id="LN2695">2695</td><td class="line">	    || new_TabPageIdxs == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2696"><td class="num" id="LN2696">2696</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2697"><td class="num" id="LN2697">2697</td><td class="line">	    || new_popup_mask == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2698"><td class="num" id="LN2698">2698</td><td class="line">	    || new_popup_mask_next == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2699"><td class="num" id="LN2699">2699</td><td class="line">	    || new_popup_transparent == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2700"><td class="num" id="LN2700">2700</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2701"><td class="num" id="LN2701">2701</td><td class="line">	    || outofmem)</td></tr>
<tr class="codeline" data-linenumber="2702"><td class="num" id="LN2702">2702</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2703"><td class="num" id="LN2703">2703</td><td class="line">	<span class='keyword'>if</span> (ScreenLines != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || !done_outofmem_msg)</td></tr>
<tr class="codeline" data-linenumber="2704"><td class="num" id="LN2704">2704</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2705"><td class="num" id="LN2705">2705</td><td class="line">	    <span class='comment'>// guess the size</span></td></tr>
<tr class="codeline" data-linenumber="2706"><td class="num" id="LN2706">2706</td><td class="line">	    do_outofmem_msg((long_u)((Rows + 1) * Columns));</td></tr>
<tr class="codeline" data-linenumber="2707"><td class="num" id="LN2707">2707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2708"><td class="num" id="LN2708">2708</td><td class="line">	    <span class='comment'>// Remember we did this to avoid getting outofmem messages over</span></td></tr>
<tr class="codeline" data-linenumber="2709"><td class="num" id="LN2709">2709</td><td class="line">	    <span class='comment'>// and over again.</span></td></tr>
<tr class="codeline" data-linenumber="2710"><td class="num" id="LN2710">2710</td><td class="line">	    done_outofmem_msg = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2711"><td class="num" id="LN2711">2711</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2712"><td class="num" id="LN2712">2712</td><td class="line">	<span class='macro'>VIM_CLEAR(new_ScreenLines)<span class='macro_popup'>do { if ((new_ScreenLines) != ((void*)0)) { vim_free(new_ScreenLines<br>); (new_ScreenLines) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2713"><td class="num" id="LN2713">2713</td><td class="line">	<span class='macro'>VIM_CLEAR(new_ScreenLinesUC)<span class='macro_popup'>do { if ((new_ScreenLinesUC) != ((void*)0)) { vim_free(new_ScreenLinesUC<br>); (new_ScreenLinesUC) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2714"><td class="num" id="LN2714">2714</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2715"><td class="num" id="LN2715">2715</td><td class="line">	    <span class='macro'>VIM_CLEAR(new_ScreenLinesC[i])<span class='macro_popup'>do { if ((new_ScreenLinesC[i]) != ((void*)0)) { vim_free(new_ScreenLinesC<br>[i]); (new_ScreenLinesC[i]) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2716"><td class="num" id="LN2716">2716</td><td class="line">	<span class='macro'>VIM_CLEAR(new_ScreenLines2)<span class='macro_popup'>do { if ((new_ScreenLines2) != ((void*)0)) { vim_free(new_ScreenLines2<br>); (new_ScreenLines2) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2717"><td class="num" id="LN2717">2717</td><td class="line">	<span class='macro'>VIM_CLEAR(new_ScreenAttrs)<span class='macro_popup'>do { if ((new_ScreenAttrs) != ((void*)0)) { vim_free(new_ScreenAttrs<br>); (new_ScreenAttrs) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2718"><td class="num" id="LN2718">2718</td><td class="line">	<span class='macro'>VIM_CLEAR(new_LineOffset)<span class='macro_popup'>do { if ((new_LineOffset) != ((void*)0)) { vim_free(new_LineOffset<br>); (new_LineOffset) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2719"><td class="num" id="LN2719">2719</td><td class="line">	<span class='macro'>VIM_CLEAR(new_LineWraps)<span class='macro_popup'>do { if ((new_LineWraps) != ((void*)0)) { vim_free(new_LineWraps<br>); (new_LineWraps) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2720"><td class="num" id="LN2720">2720</td><td class="line">	<span class='macro'>VIM_CLEAR(new_TabPageIdxs)<span class='macro_popup'>do { if ((new_TabPageIdxs) != ((void*)0)) { vim_free(new_TabPageIdxs<br>); (new_TabPageIdxs) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2721"><td class="num" id="LN2721">2721</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2722"><td class="num" id="LN2722">2722</td><td class="line">	<span class='macro'>VIM_CLEAR(new_popup_mask)<span class='macro_popup'>do { if ((new_popup_mask) != ((void*)0)) { vim_free(new_popup_mask<br>); (new_popup_mask) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2723"><td class="num" id="LN2723">2723</td><td class="line">	<span class='macro'>VIM_CLEAR(new_popup_mask_next)<span class='macro_popup'>do { if ((new_popup_mask_next) != ((void*)0)) { vim_free(new_popup_mask_next<br>); (new_popup_mask_next) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2724"><td class="num" id="LN2724">2724</td><td class="line">	<span class='macro'>VIM_CLEAR(new_popup_transparent)<span class='macro_popup'>do { if ((new_popup_transparent) != ((void*)0)) { vim_free(new_popup_transparent<br>); (new_popup_transparent) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2725"><td class="num" id="LN2725">2725</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2726"><td class="num" id="LN2726">2726</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2727"><td class="num" id="LN2727">2727</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2728"><td class="num" id="LN2728">2728</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2729"><td class="num" id="LN2729">2729</td><td class="line">	done_outofmem_msg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2730"><td class="num" id="LN2730">2730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2731"><td class="num" id="LN2731">2731</td><td class="line">	<span class='keyword'>for</span> (new_row = 0; new_row &lt; Rows; ++new_row)</td></tr>
<tr class="codeline" data-linenumber="2732"><td class="num" id="LN2732">2732</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="2733"><td class="num" id="LN2733">2733</td><td class="line">	    new_LineOffset[new_row] = new_row * Columns;</td></tr>
<tr class="codeline" data-linenumber="2734"><td class="num" id="LN2734">2734</td><td class="line">	    new_LineWraps[new_row] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2735"><td class="num" id="LN2735">2735</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2736"><td class="num" id="LN2736">2736</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2737"><td class="num" id="LN2737">2737</td><td class="line">	     <span class='comment'>* If the screen is not going to be cleared, copy as much as</span></td></tr>
<tr class="codeline" data-linenumber="2738"><td class="num" id="LN2738">2738</td><td class="line">	     <span class='comment'>* possible from the old screen to the new one and clear the rest</span></td></tr>
<tr class="codeline" data-linenumber="2739"><td class="num" id="LN2739">2739</td><td class="line">	     <span class='comment'>* (used when resizing the window at the "--more--" prompt or when</span></td></tr>
<tr class="codeline" data-linenumber="2740"><td class="num" id="LN2740">2740</td><td class="line">	     <span class='comment'>* executing an external command, for the GUI).</span></td></tr>
<tr class="codeline" data-linenumber="2741"><td class="num" id="LN2741">2741</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2742"><td class="num" id="LN2742">2742</td><td class="line">	    <span class='keyword'>if</span> (!doclear)</td></tr>
<tr class="codeline" data-linenumber="2743"><td class="num" id="LN2743">2743</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="2744"><td class="num" id="LN2744">2744</td><td class="line">		(<span class='keyword'>void</span>)<span class='macro'>vim_memset(new_ScreenLines + new_row * Columns,<span class='macro_popup'>memset((new_ScreenLines + new_row * Columns), (' '), ((size_t<br>)Columns * sizeof(schar_T)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2745"><td class="num" id="LN2745">2745</td><td class="line">				      <span class='macro'>' ', (size_t)Columns * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memset((new_ScreenLines + new_row * Columns), (' '), ((size_t<br>)Columns * sizeof(schar_T)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2746"><td class="num" id="LN2746">2746</td><td class="line">		<span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="2747"><td class="num" id="LN2747">2747</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="2748"><td class="num" id="LN2748">2748</td><td class="line">		    (<span class='keyword'>void</span>)<span class='macro'>vim_memset(new_ScreenLinesUC + new_row * Columns,<span class='macro_popup'>memset((new_ScreenLinesUC + new_row * Columns), (0), ((size_t<br>)Columns * sizeof(u8char_T)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2749"><td class="num" id="LN2749">2749</td><td class="line">				       <span class='macro'>0, (size_t)Columns * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memset((new_ScreenLinesUC + new_row * Columns), (0), ((size_t<br>)Columns * sizeof(u8char_T)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2750"><td class="num" id="LN2750">2750</td><td class="line">		    <span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2751"><td class="num" id="LN2751">2751</td><td class="line">			(<span class='keyword'>void</span>)<span class='macro'>vim_memset(new_ScreenLinesC[i]<span class='macro_popup'>memset((new_ScreenLinesC[i] + new_row * Columns), (0), ((size_t<br>)Columns * sizeof(u8char_T)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2752"><td class="num" id="LN2752">2752</td><td class="line">							  <span class='macro'>+ new_row * Columns,<span class='macro_popup'>memset((new_ScreenLinesC[i] + new_row * Columns), (0), ((size_t<br>)Columns * sizeof(u8char_T)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2753"><td class="num" id="LN2753">2753</td><td class="line">				       <span class='macro'>0, (size_t)Columns * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memset((new_ScreenLinesC[i] + new_row * Columns), (0), ((size_t<br>)Columns * sizeof(u8char_T)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2754"><td class="num" id="LN2754">2754</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="2755"><td class="num" id="LN2755">2755</td><td class="line">		<span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2756"><td class="num" id="LN2756">2756</td><td class="line">		    (<span class='keyword'>void</span>)<span class='macro'>vim_memset(new_ScreenLines2 + new_row * Columns,<span class='macro_popup'>memset((new_ScreenLines2 + new_row * Columns), (0), ((size_t)<br>Columns * sizeof(schar_T)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2757"><td class="num" id="LN2757">2757</td><td class="line">				       <span class='macro'>0, (size_t)Columns * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memset((new_ScreenLines2 + new_row * Columns), (0), ((size_t)<br>Columns * sizeof(schar_T)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2758"><td class="num" id="LN2758">2758</td><td class="line">		(<span class='keyword'>void</span>)<span class='macro'>vim_memset(new_ScreenAttrs + new_row * Columns,<span class='macro_popup'>memset((new_ScreenAttrs + new_row * Columns), (0), ((size_t)Columns<br> * sizeof(sattr_T)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2759"><td class="num" id="LN2759">2759</td><td class="line">					<span class='macro'>0, (size_t)Columns * <span class='keyword'>sizeof</span>(sattr_T))<span class='macro_popup'>memset((new_ScreenAttrs + new_row * Columns), (0), ((size_t)Columns<br> * sizeof(sattr_T)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2760"><td class="num" id="LN2760">2760</td><td class="line">		old_row = new_row + (screen_Rows - Rows);</td></tr>
<tr class="codeline" data-linenumber="2761"><td class="num" id="LN2761">2761</td><td class="line">		<span class='keyword'>if</span> (old_row &gt;= 0 &amp;&amp; ScreenLines != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2762"><td class="num" id="LN2762">2762</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="2763"><td class="num" id="LN2763">2763</td><td class="line">		    <span class='keyword'>if</span> (screen_Columns &lt; Columns)</td></tr>
<tr class="codeline" data-linenumber="2764"><td class="num" id="LN2764">2764</td><td class="line">			len = screen_Columns;</td></tr>
<tr class="codeline" data-linenumber="2765"><td class="num" id="LN2765">2765</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2766"><td class="num" id="LN2766">2766</td><td class="line">			len = Columns;</td></tr>
<tr class="codeline" data-linenumber="2767"><td class="num" id="LN2767">2767</td><td class="line">		    <span class='comment'>// When switching to utf-8 don't copy characters, they</span></td></tr>
<tr class="codeline" data-linenumber="2768"><td class="num" id="LN2768">2768</td><td class="line">		    <span class='comment'>// may be invalid now.  Also when p_mco changes.</span></td></tr>
<tr class="codeline" data-linenumber="2769"><td class="num" id="LN2769">2769</td><td class="line">		    <span class='keyword'>if</span> (!(enc_utf8 &amp;&amp; ScreenLinesUC == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2770"><td class="num" id="LN2770">2770</td><td class="line">						       &amp;&amp; p_mco == Screen_mco)</td></tr>
<tr class="codeline" data-linenumber="2771"><td class="num" id="LN2771">2771</td><td class="line">			<span class='macro'>mch_memmove(new_ScreenLines + new_LineOffset[new_row],<span class='macro_popup'>memmove((char *)(new_ScreenLines + new_LineOffset[new_row]), (<br>char *)(ScreenLines + LineOffset[old_row]), (size_t)len * sizeof<br>(schar_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2772"><td class="num" id="LN2772">2772</td><td class="line">				<span class='macro'>ScreenLines + LineOffset[old_row],<span class='macro_popup'>memmove((char *)(new_ScreenLines + new_LineOffset[new_row]), (<br>char *)(ScreenLines + LineOffset[old_row]), (size_t)len * sizeof<br>(schar_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2773"><td class="num" id="LN2773">2773</td><td class="line">				<span class='macro'>(size_t)len * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memmove((char *)(new_ScreenLines + new_LineOffset[new_row]), (<br>char *)(ScreenLines + LineOffset[old_row]), (size_t)len * sizeof<br>(schar_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2774"><td class="num" id="LN2774">2774</td><td class="line">		    <span class='keyword'>if</span> (enc_utf8 &amp;&amp; ScreenLinesUC != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2775"><td class="num" id="LN2775">2775</td><td class="line">						       &amp;&amp; p_mco == Screen_mco)</td></tr>
<tr class="codeline" data-linenumber="2776"><td class="num" id="LN2776">2776</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="2777"><td class="num" id="LN2777">2777</td><td class="line">			<span class='macro'>mch_memmove(new_ScreenLinesUC + new_LineOffset[new_row],<span class='macro_popup'>memmove((char *)(new_ScreenLinesUC + new_LineOffset[new_row])<br>, (char *)(ScreenLinesUC + LineOffset[old_row]), (size_t)len *<br> sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2778"><td class="num" id="LN2778">2778</td><td class="line">				<span class='macro'>ScreenLinesUC + LineOffset[old_row],<span class='macro_popup'>memmove((char *)(new_ScreenLinesUC + new_LineOffset[new_row])<br>, (char *)(ScreenLinesUC + LineOffset[old_row]), (size_t)len *<br> sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2779"><td class="num" id="LN2779">2779</td><td class="line">				<span class='macro'>(size_t)len * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memmove((char *)(new_ScreenLinesUC + new_LineOffset[new_row])<br>, (char *)(ScreenLinesUC + LineOffset[old_row]), (size_t)len *<br> sizeof(u8char_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2780"><td class="num" id="LN2780">2780</td><td class="line">			<span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2781"><td class="num" id="LN2781">2781</td><td class="line">			    <span class='macro'>mch_memmove(new_ScreenLinesC[i]<span class='macro_popup'>memmove((char *)(new_ScreenLinesC[i] + new_LineOffset[new_row<br>]), (char *)(ScreenLinesC[i] + LineOffset[old_row]), (size_t)<br>len * sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2782"><td class="num" id="LN2782">2782</td><td class="line">						    <span class='macro'>+ new_LineOffset[new_row],<span class='macro_popup'>memmove((char *)(new_ScreenLinesC[i] + new_LineOffset[new_row<br>]), (char *)(ScreenLinesC[i] + LineOffset[old_row]), (size_t)<br>len * sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2783"><td class="num" id="LN2783">2783</td><td class="line">				<span class='macro'>ScreenLinesC[i] + LineOffset[old_row],<span class='macro_popup'>memmove((char *)(new_ScreenLinesC[i] + new_LineOffset[new_row<br>]), (char *)(ScreenLinesC[i] + LineOffset[old_row]), (size_t)<br>len * sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2784"><td class="num" id="LN2784">2784</td><td class="line">				<span class='macro'>(size_t)len * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memmove((char *)(new_ScreenLinesC[i] + new_LineOffset[new_row<br>]), (char *)(ScreenLinesC[i] + LineOffset[old_row]), (size_t)<br>len * sizeof(u8char_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2785"><td class="num" id="LN2785">2785</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="2786"><td class="num" id="LN2786">2786</td><td class="line">		    <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span> &amp;&amp; ScreenLines2 != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2787"><td class="num" id="LN2787">2787</td><td class="line">			<span class='macro'>mch_memmove(new_ScreenLines2 + new_LineOffset[new_row],<span class='macro_popup'>memmove((char *)(new_ScreenLines2 + new_LineOffset[new_row]),<br> (char *)(ScreenLines2 + LineOffset[old_row]), (size_t)len * sizeof<br>(schar_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2788"><td class="num" id="LN2788">2788</td><td class="line">				<span class='macro'>ScreenLines2 + LineOffset[old_row],<span class='macro_popup'>memmove((char *)(new_ScreenLines2 + new_LineOffset[new_row]),<br> (char *)(ScreenLines2 + LineOffset[old_row]), (size_t)len * sizeof<br>(schar_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2789"><td class="num" id="LN2789">2789</td><td class="line">				<span class='macro'>(size_t)len * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memmove((char *)(new_ScreenLines2 + new_LineOffset[new_row]),<br> (char *)(ScreenLines2 + LineOffset[old_row]), (size_t)len * sizeof<br>(schar_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2790"><td class="num" id="LN2790">2790</td><td class="line">		    <span class='macro'>mch_memmove(new_ScreenAttrs + new_LineOffset[new_row],<span class='macro_popup'>memmove((char *)(new_ScreenAttrs + new_LineOffset[new_row]), (<br>char *)(ScreenAttrs + LineOffset[old_row]), (size_t)len * sizeof<br>(sattr_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2791"><td class="num" id="LN2791">2791</td><td class="line">			    <span class='macro'>ScreenAttrs + LineOffset[old_row],<span class='macro_popup'>memmove((char *)(new_ScreenAttrs + new_LineOffset[new_row]), (<br>char *)(ScreenAttrs + LineOffset[old_row]), (size_t)len * sizeof<br>(sattr_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="2792"><td class="num" id="LN2792">2792</td><td class="line">			    <span class='macro'>(size_t)len * <span class='keyword'>sizeof</span>(sattr_T))<span class='macro_popup'>memmove((char *)(new_ScreenAttrs + new_LineOffset[new_row]), (<br>char *)(ScreenAttrs + LineOffset[old_row]), (size_t)len * sizeof<br>(sattr_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2793"><td class="num" id="LN2793">2793</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="2794"><td class="num" id="LN2794">2794</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="2795"><td class="num" id="LN2795">2795</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="2796"><td class="num" id="LN2796">2796</td><td class="line">	<span class='comment'>// Use the last line of the screen for the current line.</span></td></tr>
<tr class="codeline" data-linenumber="2797"><td class="num" id="LN2797">2797</td><td class="line">	current_ScreenLine = new_ScreenLines + Rows * Columns;</td></tr>
<tr class="codeline" data-linenumber="2798"><td class="num" id="LN2798">2798</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2799"><td class="num" id="LN2799">2799</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2800"><td class="num" id="LN2800">2800</td><td class="line">	<span class='macro'>vim_memset(new_popup_mask, 0, Rows * Columns * <span class='keyword'>sizeof</span>(<span class='keyword'>short</span>))<span class='macro_popup'>memset((new_popup_mask), (0), (Rows * Columns * sizeof(short)<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2801"><td class="num" id="LN2801">2801</td><td class="line">	<span class='macro'>vim_memset(new_popup_transparent, 0, Rows * Columns * <span class='keyword'>sizeof</span>(<span class='keyword'>char</span>))<span class='macro_popup'>memset((new_popup_transparent), (0), (Rows * Columns * sizeof<br>(char)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2802"><td class="num" id="LN2802">2802</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2803"><td class="num" id="LN2803">2803</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2804"><td class="num" id="LN2804">2804</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2805"><td class="num" id="LN2805">2805</td><td class="line">    free_screenlines();</td></tr>
<tr class="codeline" data-linenumber="2806"><td class="num" id="LN2806">2806</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2807"><td class="num" id="LN2807">2807</td><td class="line">    <span class='comment'>// NOTE: this may result in all pointers to become NULL.</span></td></tr>
<tr class="codeline" data-linenumber="2808"><td class="num" id="LN2808">2808</td><td class="line">    ScreenLines = new_ScreenLines;</td></tr>
<tr class="codeline" data-linenumber="2809"><td class="num" id="LN2809">2809</td><td class="line">    ScreenLinesUC = new_ScreenLinesUC;</td></tr>
<tr class="codeline" data-linenumber="2810"><td class="num" id="LN2810">2810</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2811"><td class="num" id="LN2811">2811</td><td class="line">	ScreenLinesC[i] = new_ScreenLinesC[i];</td></tr>
<tr class="codeline" data-linenumber="2812"><td class="num" id="LN2812">2812</td><td class="line">    Screen_mco = p_mco;</td></tr>
<tr class="codeline" data-linenumber="2813"><td class="num" id="LN2813">2813</td><td class="line">    ScreenLines2 = new_ScreenLines2;</td></tr>
<tr class="codeline" data-linenumber="2814"><td class="num" id="LN2814">2814</td><td class="line">    ScreenAttrs = new_ScreenAttrs;</td></tr>
<tr class="codeline" data-linenumber="2815"><td class="num" id="LN2815">2815</td><td class="line">    LineOffset = new_LineOffset;</td></tr>
<tr class="codeline" data-linenumber="2816"><td class="num" id="LN2816">2816</td><td class="line">    LineWraps = new_LineWraps;</td></tr>
<tr class="codeline" data-linenumber="2817"><td class="num" id="LN2817">2817</td><td class="line">    TabPageIdxs = new_TabPageIdxs;</td></tr>
<tr class="codeline" data-linenumber="2818"><td class="num" id="LN2818">2818</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2819"><td class="num" id="LN2819">2819</td><td class="line">    popup_mask = new_popup_mask;</td></tr>
<tr class="codeline" data-linenumber="2820"><td class="num" id="LN2820">2820</td><td class="line">    popup_mask_next = new_popup_mask_next;</td></tr>
<tr class="codeline" data-linenumber="2821"><td class="num" id="LN2821">2821</td><td class="line">    popup_transparent = new_popup_transparent;</td></tr>
<tr class="codeline" data-linenumber="2822"><td class="num" id="LN2822">2822</td><td class="line">    popup_mask_refresh = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2823"><td class="num" id="LN2823">2823</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2824"><td class="num" id="LN2824">2824</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2825"><td class="num" id="LN2825">2825</td><td class="line">    <span class='comment'>// It's important that screen_Rows and screen_Columns reflect the actual</span></td></tr>
<tr class="codeline" data-linenumber="2826"><td class="num" id="LN2826">2826</td><td class="line">    <span class='comment'>// size of ScreenLines[].  Set them before calling anything.</span></td></tr>
<tr class="codeline" data-linenumber="2827"><td class="num" id="LN2827">2827</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2828"><td class="num" id="LN2828">2828</td><td class="line">    old_Rows = screen_Rows;</td></tr>
<tr class="codeline" data-linenumber="2829"><td class="num" id="LN2829">2829</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2830"><td class="num" id="LN2830">2830</td><td class="line">    screen_Rows = Rows;</td></tr>
<tr class="codeline" data-linenumber="2831"><td class="num" id="LN2831">2831</td><td class="line">    screen_Columns = Columns;</td></tr>
<tr class="codeline" data-linenumber="2832"><td class="num" id="LN2832">2832</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2833"><td class="num" id="LN2833">2833</td><td class="line">    must_redraw = <span class='macro'>CLEAR<span class='macro_popup'>50</span></span>;	<span class='comment'>// need to clear the screen later</span></td></tr>
<tr class="codeline" data-linenumber="2834"><td class="num" id="LN2834">2834</td><td class="line">    <span class='keyword'>if</span> (doclear)</td></tr>
<tr class="codeline" data-linenumber="2835"><td class="num" id="LN2835">2835</td><td class="line">	screenclear2();</td></tr>
<tr class="codeline" data-linenumber="2836"><td class="num" id="LN2836">2836</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2837"><td class="num" id="LN2837">2837</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (gui.in_use</td></tr>
<tr class="codeline" data-linenumber="2838"><td class="num" id="LN2838">2838</td><td class="line">	    &amp;&amp; !gui.starting</td></tr>
<tr class="codeline" data-linenumber="2839"><td class="num" id="LN2839">2839</td><td class="line">	    &amp;&amp; ScreenLines != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2840"><td class="num" id="LN2840">2840</td><td class="line">	    &amp;&amp; old_Rows != Rows)</td></tr>
<tr class="codeline" data-linenumber="2841"><td class="num" id="LN2841">2841</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2842"><td class="num" id="LN2842">2842</td><td class="line">	gui_redraw_block(0, 0, (<span class='keyword'>int</span>)Rows - 1, (<span class='keyword'>int</span>)Columns - 1, 0);</td></tr>
<tr class="codeline" data-linenumber="2843"><td class="num" id="LN2843">2843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2844"><td class="num" id="LN2844">2844</td><td class="line">	<span class='comment'>// Adjust the position of the cursor, for when executing an external</span></td></tr>
<tr class="codeline" data-linenumber="2845"><td class="num" id="LN2845">2845</td><td class="line">	<span class='comment'>// command.</span></td></tr>
<tr class="codeline" data-linenumber="2846"><td class="num" id="LN2846">2846</td><td class="line">	<span class='keyword'>if</span> (msg_row &gt;= Rows)		<span class='comment'>// Rows got smaller</span></td></tr>
<tr class="codeline" data-linenumber="2847"><td class="num" id="LN2847">2847</td><td class="line">	    msg_row = Rows - 1;		<span class='comment'>// put cursor at last row</span></td></tr>
<tr class="codeline" data-linenumber="2848"><td class="num" id="LN2848">2848</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (Rows &gt; old_Rows)	<span class='comment'>// Rows got bigger</span></td></tr>
<tr class="codeline" data-linenumber="2849"><td class="num" id="LN2849">2849</td><td class="line">	    msg_row += Rows - old_Rows; <span class='comment'>// put cursor in same place</span></td></tr>
<tr class="codeline" data-linenumber="2850"><td class="num" id="LN2850">2850</td><td class="line">	<span class='keyword'>if</span> (msg_col &gt;= Columns)		<span class='comment'>// Columns got smaller</span></td></tr>
<tr class="codeline" data-linenumber="2851"><td class="num" id="LN2851">2851</td><td class="line">	    msg_col = Columns - 1;	<span class='comment'>// put cursor at last column</span></td></tr>
<tr class="codeline" data-linenumber="2852"><td class="num" id="LN2852">2852</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2853"><td class="num" id="LN2853">2853</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2854"><td class="num" id="LN2854">2854</td><td class="line">    clear_TabPageIdxs();</td></tr>
<tr class="codeline" data-linenumber="2855"><td class="num" id="LN2855">2855</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2856"><td class="num" id="LN2856">2856</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_HAIKU</span></td></tr>
<tr class="codeline" data-linenumber="2857"><td class="num" id="LN2857">2857</td><td class="line">    vim_unlock_screen();</td></tr>
<tr class="codeline" data-linenumber="2858"><td class="num" id="LN2858">2858</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2859"><td class="num" id="LN2859">2859</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2860"><td class="num" id="LN2860">2860</td><td class="line">    entered = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2861"><td class="num" id="LN2861">2861</td><td class="line">    --RedrawingDisabled;</td></tr>
<tr class="codeline" data-linenumber="2862"><td class="num" id="LN2862">2862</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2863"><td class="num" id="LN2863">2863</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2864"><td class="num" id="LN2864">2864</td><td class="line">     <span class='comment'>* Do not apply autocommands more than 3 times to avoid an endless loop</span></td></tr>
<tr class="codeline" data-linenumber="2865"><td class="num" id="LN2865">2865</td><td class="line">     <span class='comment'>* in case applying autocommands always changes Rows or Columns.</span></td></tr>
<tr class="codeline" data-linenumber="2866"><td class="num" id="LN2866">2866</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2867"><td class="num" id="LN2867">2867</td><td class="line">    <span class='keyword'>if</span> (starting == 0 &amp;&amp; ++retry_count &lt;= 3)</td></tr>
<tr class="codeline" data-linenumber="2868"><td class="num" id="LN2868">2868</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2869"><td class="num" id="LN2869">2869</td><td class="line">	apply_autocmds(EVENT_VIMRESIZED, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, curbuf);</td></tr>
<tr class="codeline" data-linenumber="2870"><td class="num" id="LN2870">2870</td><td class="line">	<span class='comment'>// In rare cases, autocommands may have altered Rows or Columns,</span></td></tr>
<tr class="codeline" data-linenumber="2871"><td class="num" id="LN2871">2871</td><td class="line">	<span class='comment'>// jump back to check if we need to allocate the screen again.</span></td></tr>
<tr class="codeline" data-linenumber="2872"><td class="num" id="LN2872">2872</td><td class="line">	<span class='keyword'>goto</span> retry;</td></tr>
<tr class="codeline" data-linenumber="2873"><td class="num" id="LN2873">2873</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2874"><td class="num" id="LN2874">2874</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2875"><td class="num" id="LN2875">2875</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2876"><td class="num" id="LN2876">2876</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2877"><td class="num" id="LN2877">2877</td><td class="line">free_screenlines(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="2878"><td class="num" id="LN2878">2878</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2879"><td class="num" id="LN2879">2879</td><td class="line">    <span class='keyword'>int</span>		i;</td></tr>
<tr class="codeline" data-linenumber="2880"><td class="num" id="LN2880">2880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2881"><td class="num" id="LN2881">2881</td><td class="line">    <span class='macro'>VIM_CLEAR(ScreenLinesUC)<span class='macro_popup'>do { if ((ScreenLinesUC) != ((void*)0)) { vim_free(ScreenLinesUC<br>); (ScreenLinesUC) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2882"><td class="num" id="LN2882">2882</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; Screen_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="2883"><td class="num" id="LN2883">2883</td><td class="line">	<span class='macro'>VIM_CLEAR(ScreenLinesC[i])<span class='macro_popup'>do { if ((ScreenLinesC[i]) != ((void*)0)) { vim_free(ScreenLinesC<br>[i]); (ScreenLinesC[i]) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2884"><td class="num" id="LN2884">2884</td><td class="line">    <span class='macro'>VIM_CLEAR(ScreenLines2)<span class='macro_popup'>do { if ((ScreenLines2) != ((void*)0)) { vim_free(ScreenLines2<br>); (ScreenLines2) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2885"><td class="num" id="LN2885">2885</td><td class="line">    <span class='macro'>VIM_CLEAR(ScreenLines)<span class='macro_popup'>do { if ((ScreenLines) != ((void*)0)) { vim_free(ScreenLines)<br>; (ScreenLines) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2886"><td class="num" id="LN2886">2886</td><td class="line">    <span class='macro'>VIM_CLEAR(ScreenAttrs)<span class='macro_popup'>do { if ((ScreenAttrs) != ((void*)0)) { vim_free(ScreenAttrs)<br>; (ScreenAttrs) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2887"><td class="num" id="LN2887">2887</td><td class="line">    <span class='macro'>VIM_CLEAR(LineOffset)<span class='macro_popup'>do { if ((LineOffset) != ((void*)0)) { vim_free(LineOffset); (<br>LineOffset) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2888"><td class="num" id="LN2888">2888</td><td class="line">    <span class='macro'>VIM_CLEAR(LineWraps)<span class='macro_popup'>do { if ((LineWraps) != ((void*)0)) { vim_free(LineWraps); (LineWraps<br>) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2889"><td class="num" id="LN2889">2889</td><td class="line">    <span class='macro'>VIM_CLEAR(TabPageIdxs)<span class='macro_popup'>do { if ((TabPageIdxs) != ((void*)0)) { vim_free(TabPageIdxs)<br>; (TabPageIdxs) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2890"><td class="num" id="LN2890">2890</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="2891"><td class="num" id="LN2891">2891</td><td class="line">    <span class='macro'>VIM_CLEAR(popup_mask)<span class='macro_popup'>do { if ((popup_mask) != ((void*)0)) { vim_free(popup_mask); (<br>popup_mask) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2892"><td class="num" id="LN2892">2892</td><td class="line">    <span class='macro'>VIM_CLEAR(popup_mask_next)<span class='macro_popup'>do { if ((popup_mask_next) != ((void*)0)) { vim_free(popup_mask_next<br>); (popup_mask_next) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2893"><td class="num" id="LN2893">2893</td><td class="line">    <span class='macro'>VIM_CLEAR(popup_transparent)<span class='macro_popup'>do { if ((popup_transparent) != ((void*)0)) { vim_free(popup_transparent<br>); (popup_transparent) = ((void*)0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2894"><td class="num" id="LN2894">2894</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2895"><td class="num" id="LN2895">2895</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2896"><td class="num" id="LN2896">2896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2897"><td class="num" id="LN2897">2897</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2898"><td class="num" id="LN2898">2898</td><td class="line">screenclear(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="2899"><td class="num" id="LN2899">2899</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2900"><td class="num" id="LN2900">2900</td><td class="line">    check_for_delay(<span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2901"><td class="num" id="LN2901">2901</td><td class="line">    screenalloc(<span class='macro'>FALSE<span class='macro_popup'>0</span></span>);	    <span class='comment'>// allocate screen buffers if size changed</span></td></tr>
<tr class="codeline" data-linenumber="2902"><td class="num" id="LN2902">2902</td><td class="line">    screenclear2();	    <span class='comment'>// clear the screen</span></td></tr>
<tr class="codeline" data-linenumber="2903"><td class="num" id="LN2903">2903</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2904"><td class="num" id="LN2904">2904</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2905"><td class="num" id="LN2905">2905</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2906"><td class="num" id="LN2906">2906</td><td class="line">screenclear2(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="2907"><td class="num" id="LN2907">2907</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2908"><td class="num" id="LN2908">2908</td><td class="line">    <span class='keyword'>int</span>	    i;</td></tr>
<tr class="codeline" data-linenumber="2909"><td class="num" id="LN2909">2909</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2910"><td class="num" id="LN2910">2910</td><td class="line">    <span class='keyword'>if</span> (starting == <span class='macro'>NO_SCREEN<span class='macro_popup'>2</span></span> || ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2911"><td class="num" id="LN2911">2911</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2912"><td class="num" id="LN2912">2912</td><td class="line">	    || (gui.in_use &amp;&amp; gui.starting)</td></tr>
<tr class="codeline" data-linenumber="2913"><td class="num" id="LN2913">2913</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2914"><td class="num" id="LN2914">2914</td><td class="line">	    )</td></tr>
<tr class="codeline" data-linenumber="2915"><td class="num" id="LN2915">2915</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2916"><td class="num" id="LN2916">2916</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2917"><td class="num" id="LN2917">2917</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="2918"><td class="num" id="LN2918">2918</td><td class="line">    <span class='keyword'>if</span> (!gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="2919"><td class="num" id="LN2919">2919</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2920"><td class="num" id="LN2920">2920</td><td class="line">	screen_attr = -1;	<span class='comment'>// force setting the Normal colors</span></td></tr>
<tr class="codeline" data-linenumber="2921"><td class="num" id="LN2921">2921</td><td class="line">    screen_stop_highlight();	<span class='comment'>// don't want highlighting here</span></td></tr>
<tr class="codeline" data-linenumber="2922"><td class="num" id="LN2922">2922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2923"><td class="num" id="LN2923">2923</td><td class="line"><span class='directive'>#ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="2924"><td class="num" id="LN2924">2924</td><td class="line">    <span class='comment'>// disable selection without redrawing it</span></td></tr>
<tr class="codeline" data-linenumber="2925"><td class="num" id="LN2925">2925</td><td class="line">    clip_scroll_selection(9999);</td></tr>
<tr class="codeline" data-linenumber="2926"><td class="num" id="LN2926">2926</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2927"><td class="num" id="LN2927">2927</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2928"><td class="num" id="LN2928">2928</td><td class="line">    <span class='comment'>// blank out ScreenLines</span></td></tr>
<tr class="codeline" data-linenumber="2929"><td class="num" id="LN2929">2929</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; Rows; ++i)</td></tr>
<tr class="codeline" data-linenumber="2930"><td class="num" id="LN2930">2930</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2931"><td class="num" id="LN2931">2931</td><td class="line">	lineclear(LineOffset[i], (<span class='keyword'>int</span>)Columns, 0);</td></tr>
<tr class="codeline" data-linenumber="2932"><td class="num" id="LN2932">2932</td><td class="line">	LineWraps[i] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2933"><td class="num" id="LN2933">2933</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2934"><td class="num" id="LN2934">2934</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2935"><td class="num" id="LN2935">2935</td><td class="line">    <span class='keyword'>if</span> (can_clear(<span class='macro'>T_CL<span class='macro_popup'>(term_strings[(int)(KS_CL)])</span></span>))</td></tr>
<tr class="codeline" data-linenumber="2936"><td class="num" id="LN2936">2936</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2937"><td class="num" id="LN2937">2937</td><td class="line">	out_str(<span class='macro'>T_CL<span class='macro_popup'>(term_strings[(int)(KS_CL)])</span></span>);		<span class='comment'>// clear the display</span></td></tr>
<tr class="codeline" data-linenumber="2938"><td class="num" id="LN2938">2938</td><td class="line">	clear_cmdline = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2939"><td class="num" id="LN2939">2939</td><td class="line">	mode_displayed = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2940"><td class="num" id="LN2940">2940</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2941"><td class="num" id="LN2941">2941</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2942"><td class="num" id="LN2942">2942</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2943"><td class="num" id="LN2943">2943</td><td class="line">	<span class='comment'>// can't clear the screen, mark all chars with invalid attributes</span></td></tr>
<tr class="codeline" data-linenumber="2944"><td class="num" id="LN2944">2944</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; Rows; ++i)</td></tr>
<tr class="codeline" data-linenumber="2945"><td class="num" id="LN2945">2945</td><td class="line">	    lineinvalid(LineOffset[i], (<span class='keyword'>int</span>)Columns);</td></tr>
<tr class="codeline" data-linenumber="2946"><td class="num" id="LN2946">2946</td><td class="line">	clear_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2947"><td class="num" id="LN2947">2947</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2948"><td class="num" id="LN2948">2948</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2949"><td class="num" id="LN2949">2949</td><td class="line">    screen_cleared = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;	<span class='comment'>// can use contents of ScreenLines now</span></td></tr>
<tr class="codeline" data-linenumber="2950"><td class="num" id="LN2950">2950</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2951"><td class="num" id="LN2951">2951</td><td class="line">    win_rest_invalid(firstwin);</td></tr>
<tr class="codeline" data-linenumber="2952"><td class="num" id="LN2952">2952</td><td class="line">    redraw_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2953"><td class="num" id="LN2953">2953</td><td class="line">    redraw_tabline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2954"><td class="num" id="LN2954">2954</td><td class="line">    <span class='keyword'>if</span> (must_redraw == <span class='macro'>CLEAR<span class='macro_popup'>50</span></span>)	<span class='comment'>// no need to clear again</span></td></tr>
<tr class="codeline" data-linenumber="2955"><td class="num" id="LN2955">2955</td><td class="line">	must_redraw = <span class='macro'>NOT_VALID<span class='macro_popup'>40</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2956"><td class="num" id="LN2956">2956</td><td class="line">    compute_cmdrow();</td></tr>
<tr class="codeline" data-linenumber="2957"><td class="num" id="LN2957">2957</td><td class="line">    msg_row = cmdline_row;	<span class='comment'>// put cursor on last line for messages</span></td></tr>
<tr class="codeline" data-linenumber="2958"><td class="num" id="LN2958">2958</td><td class="line">    msg_col = 0;</td></tr>
<tr class="codeline" data-linenumber="2959"><td class="num" id="LN2959">2959</td><td class="line">    screen_start();		<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="2960"><td class="num" id="LN2960">2960</td><td class="line">    msg_scrolled = 0;		<span class='comment'>// can't scroll back</span></td></tr>
<tr class="codeline" data-linenumber="2961"><td class="num" id="LN2961">2961</td><td class="line">    msg_didany = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2962"><td class="num" id="LN2962">2962</td><td class="line">    msg_didout = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2963"><td class="num" id="LN2963">2963</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2964"><td class="num" id="LN2964">2964</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2965"><td class="num" id="LN2965">2965</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2966"><td class="num" id="LN2966">2966</td><td class="line"> <span class='comment'>* Clear one line in ScreenLines.</span></td></tr>
<tr class="codeline" data-linenumber="2967"><td class="num" id="LN2967">2967</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2968"><td class="num" id="LN2968">2968</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2969"><td class="num" id="LN2969">2969</td><td class="line">lineclear(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> width, <span class='keyword'>int</span> attr)</td></tr>
<tr class="codeline" data-linenumber="2970"><td class="num" id="LN2970">2970</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2971"><td class="num" id="LN2971">2971</td><td class="line">    (<span class='keyword'>void</span>)<span class='macro'>vim_memset(ScreenLines + off, ' ', (size_t)width * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memset((ScreenLines + off), (' '), ((size_t)width * sizeof(schar_T<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2972"><td class="num" id="LN2972">2972</td><td class="line">    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="2973"><td class="num" id="LN2973">2973</td><td class="line">	(<span class='keyword'>void</span>)<span class='macro'>vim_memset(ScreenLinesUC + off, 0,<span class='macro_popup'>memset((ScreenLinesUC + off), (0), ((size_t)width * sizeof(u8char_T<br>)))</span></span></td></tr>
<tr class="codeline" data-linenumber="2974"><td class="num" id="LN2974">2974</td><td class="line">					  <span class='macro'>(size_t)width * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memset((ScreenLinesUC + off), (0), ((size_t)width * sizeof(u8char_T<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2975"><td class="num" id="LN2975">2975</td><td class="line">    (<span class='keyword'>void</span>)<span class='macro'>vim_memset(ScreenAttrs + off, attr, (size_t)width * <span class='keyword'>sizeof</span>(sattr_T))<span class='macro_popup'>memset((ScreenAttrs + off), (attr), ((size_t)width * sizeof(sattr_T<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2976"><td class="num" id="LN2976">2976</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2977"><td class="num" id="LN2977">2977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2978"><td class="num" id="LN2978">2978</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2979"><td class="num" id="LN2979">2979</td><td class="line"> <span class='comment'>* Mark one line in ScreenLines invalid by setting the attributes to an</span></td></tr>
<tr class="codeline" data-linenumber="2980"><td class="num" id="LN2980">2980</td><td class="line"> <span class='comment'>* invalid value.</span></td></tr>
<tr class="codeline" data-linenumber="2981"><td class="num" id="LN2981">2981</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2982"><td class="num" id="LN2982">2982</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2983"><td class="num" id="LN2983">2983</td><td class="line">lineinvalid(<span class='keyword'>unsigned</span> off, <span class='keyword'>int</span> width)</td></tr>
<tr class="codeline" data-linenumber="2984"><td class="num" id="LN2984">2984</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2985"><td class="num" id="LN2985">2985</td><td class="line">    (<span class='keyword'>void</span>)<span class='macro'>vim_memset(ScreenAttrs + off, -1, (size_t)width * <span class='keyword'>sizeof</span>(sattr_T))<span class='macro_popup'>memset((ScreenAttrs + off), (-1), ((size_t)width * sizeof(sattr_T<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2986"><td class="num" id="LN2986">2986</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2987"><td class="num" id="LN2987">2987</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2988"><td class="num" id="LN2988">2988</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2989"><td class="num" id="LN2989">2989</td><td class="line"> <span class='comment'>* To be called when characters were sent to the terminal directly, outputting</span></td></tr>
<tr class="codeline" data-linenumber="2990"><td class="num" id="LN2990">2990</td><td class="line"> <span class='comment'>* test on "screen_lnum".</span></td></tr>
<tr class="codeline" data-linenumber="2991"><td class="num" id="LN2991">2991</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2992"><td class="num" id="LN2992">2992</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2993"><td class="num" id="LN2993">2993</td><td class="line">line_was_clobbered(<span class='keyword'>int</span> screen_lnum)</td></tr>
<tr class="codeline" data-linenumber="2994"><td class="num" id="LN2994">2994</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2995"><td class="num" id="LN2995">2995</td><td class="line">    lineinvalid(LineOffset[screen_lnum], (<span class='keyword'>int</span>)Columns);</td></tr>
<tr class="codeline" data-linenumber="2996"><td class="num" id="LN2996">2996</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2997"><td class="num" id="LN2997">2997</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2998"><td class="num" id="LN2998">2998</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2999"><td class="num" id="LN2999">2999</td><td class="line"> <span class='comment'>* Copy part of a Screenline for vertically split window "wp".</span></td></tr>
<tr class="codeline" data-linenumber="3000"><td class="num" id="LN3000">3000</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3001"><td class="num" id="LN3001">3001</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3002"><td class="num" id="LN3002">3002</td><td class="line">linecopy(<span class='keyword'>int</span> to, <span class='keyword'>int</span> from, win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="3003"><td class="num" id="LN3003">3003</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3004"><td class="num" id="LN3004">3004</td><td class="line">    <span class='keyword'>unsigned</span>	off_to = LineOffset[to] + wp-&gt;w_wincol;</td></tr>
<tr class="codeline" data-linenumber="3005"><td class="num" id="LN3005">3005</td><td class="line">    <span class='keyword'>unsigned</span>	off_from = LineOffset[from] + wp-&gt;w_wincol;</td></tr>
<tr class="codeline" data-linenumber="3006"><td class="num" id="LN3006">3006</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3007"><td class="num" id="LN3007">3007</td><td class="line">    <span class='macro'>mch_memmove(ScreenLines + off_to, ScreenLines + off_from,<span class='macro_popup'>memmove((char *)(ScreenLines + off_to), (char *)(ScreenLines +<br> off_from), wp-&gt;w_width * sizeof(schar_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="3008"><td class="num" id="LN3008">3008</td><td class="line">	    <span class='macro'>wp-&gt;w_width * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memmove((char *)(ScreenLines + off_to), (char *)(ScreenLines +<br> off_from), wp-&gt;w_width * sizeof(schar_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3009"><td class="num" id="LN3009">3009</td><td class="line">    <span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="3010"><td class="num" id="LN3010">3010</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3011"><td class="num" id="LN3011">3011</td><td class="line">	<span class='keyword'>int</span>	i;</td></tr>
<tr class="codeline" data-linenumber="3012"><td class="num" id="LN3012">3012</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3013"><td class="num" id="LN3013">3013</td><td class="line">	<span class='macro'>mch_memmove(ScreenLinesUC + off_to, ScreenLinesUC + off_from,<span class='macro_popup'>memmove((char *)(ScreenLinesUC + off_to), (char *)(ScreenLinesUC<br> + off_from), wp-&gt;w_width * sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="3014"><td class="num" id="LN3014">3014</td><td class="line">		<span class='macro'>wp-&gt;w_width * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memmove((char *)(ScreenLinesUC + off_to), (char *)(ScreenLinesUC<br> + off_from), wp-&gt;w_width * sizeof(u8char_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3015"><td class="num" id="LN3015">3015</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; p_mco; ++i)</td></tr>
<tr class="codeline" data-linenumber="3016"><td class="num" id="LN3016">3016</td><td class="line">	    <span class='macro'>mch_memmove(ScreenLinesC[i] + off_to, ScreenLinesC[i] + off_from,<span class='macro_popup'>memmove((char *)(ScreenLinesC[i] + off_to), (char *)(ScreenLinesC<br>[i] + off_from), wp-&gt;w_width * sizeof(u8char_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="3017"><td class="num" id="LN3017">3017</td><td class="line">		    <span class='macro'>wp-&gt;w_width * <span class='keyword'>sizeof</span>(u8char_T))<span class='macro_popup'>memmove((char *)(ScreenLinesC[i] + off_to), (char *)(ScreenLinesC<br>[i] + off_from), wp-&gt;w_width * sizeof(u8char_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3018"><td class="num" id="LN3018">3018</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3019"><td class="num" id="LN3019">3019</td><td class="line">    <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3020"><td class="num" id="LN3020">3020</td><td class="line">	<span class='macro'>mch_memmove(ScreenLines2 + off_to, ScreenLines2 + off_from,<span class='macro_popup'>memmove((char *)(ScreenLines2 + off_to), (char *)(ScreenLines2<br> + off_from), wp-&gt;w_width * sizeof(schar_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="3021"><td class="num" id="LN3021">3021</td><td class="line">		<span class='macro'>wp-&gt;w_width * <span class='keyword'>sizeof</span>(schar_T))<span class='macro_popup'>memmove((char *)(ScreenLines2 + off_to), (char *)(ScreenLines2<br> + off_from), wp-&gt;w_width * sizeof(schar_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3022"><td class="num" id="LN3022">3022</td><td class="line">    <span class='macro'>mch_memmove(ScreenAttrs + off_to, ScreenAttrs + off_from,<span class='macro_popup'>memmove((char *)(ScreenAttrs + off_to), (char *)(ScreenAttrs +<br> off_from), wp-&gt;w_width * sizeof(sattr_T))</span></span></td></tr>
<tr class="codeline" data-linenumber="3023"><td class="num" id="LN3023">3023</td><td class="line">	    <span class='macro'>wp-&gt;w_width * <span class='keyword'>sizeof</span>(sattr_T))<span class='macro_popup'>memmove((char *)(ScreenAttrs + off_to), (char *)(ScreenAttrs +<br> off_from), wp-&gt;w_width * sizeof(sattr_T))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3024"><td class="num" id="LN3024">3024</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3025"><td class="num" id="LN3025">3025</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3026"><td class="num" id="LN3026">3026</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3027"><td class="num" id="LN3027">3027</td><td class="line"> <span class='comment'>* Return TRUE if clearing with term string "p" would work.</span></td></tr>
<tr class="codeline" data-linenumber="3028"><td class="num" id="LN3028">3028</td><td class="line"> <span class='comment'>* It can't work when the string is empty or it won't set the right background.</span></td></tr>
<tr class="codeline" data-linenumber="3029"><td class="num" id="LN3029">3029</td><td class="line"> <span class='comment'>* Don't clear to end-of-line when there are popups, it may cause flicker.</span></td></tr>
<tr class="codeline" data-linenumber="3030"><td class="num" id="LN3030">3030</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3031"><td class="num" id="LN3031">3031</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="3032"><td class="num" id="LN3032">3032</td><td class="line">can_clear(char_u *p)</td></tr>
<tr class="codeline" data-linenumber="3033"><td class="num" id="LN3033">3033</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3034"><td class="num" id="LN3034">3034</td><td class="line">    <span class='keyword'>return</span> (*p != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; (t_colors &lt;= 1</td></tr>
<tr class="codeline" data-linenumber="3035"><td class="num" id="LN3035">3035</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="3036"><td class="num" id="LN3036">3036</td><td class="line">		|| gui.in_use</td></tr>
<tr class="codeline" data-linenumber="3037"><td class="num" id="LN3037">3037</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3038"><td class="num" id="LN3038">3038</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="3039"><td class="num" id="LN3039">3039</td><td class="line">		|| (p_tgc &amp;&amp; cterm_normal_bg_gui_color == <span class='macro'>INVALCOLOR<span class='macro_popup'>((long)0x1ffffff)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3040"><td class="num" id="LN3040">3040</td><td class="line">		|| (!p_tgc &amp;&amp; cterm_normal_bg_color == 0)</td></tr>
<tr class="codeline" data-linenumber="3041"><td class="num" id="LN3041">3041</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3042"><td class="num" id="LN3042">3042</td><td class="line">		|| cterm_normal_bg_color == 0</td></tr>
<tr class="codeline" data-linenumber="3043"><td class="num" id="LN3043">3043</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3044"><td class="num" id="LN3044">3044</td><td class="line">		|| *<span class='macro'>T_UT<span class='macro_popup'>(term_strings[(int)(KS_UT)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3045"><td class="num" id="LN3045">3045</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="3046"><td class="num" id="LN3046">3046</td><td class="line">	    &amp;&amp; !(p == <span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span> &amp;&amp; popup_visible)</td></tr>
<tr class="codeline" data-linenumber="3047"><td class="num" id="LN3047">3047</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3048"><td class="num" id="LN3048">3048</td><td class="line">	    );</td></tr>
<tr class="codeline" data-linenumber="3049"><td class="num" id="LN3049">3049</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3050"><td class="num" id="LN3050">3050</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3051"><td class="num" id="LN3051">3051</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3052"><td class="num" id="LN3052">3052</td><td class="line"> <span class='comment'>* Reset cursor position. Use whenever cursor was moved because of outputting</span></td></tr>
<tr class="codeline" data-linenumber="3053"><td class="num" id="LN3053">3053</td><td class="line"> <span class='comment'>* something directly to the screen (shell commands) or a terminal control</span></td></tr>
<tr class="codeline" data-linenumber="3054"><td class="num" id="LN3054">3054</td><td class="line"> <span class='comment'>* code.</span></td></tr>
<tr class="codeline" data-linenumber="3055"><td class="num" id="LN3055">3055</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3056"><td class="num" id="LN3056">3056</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3057"><td class="num" id="LN3057">3057</td><td class="line">screen_start(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="3058"><td class="num" id="LN3058">3058</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3059"><td class="num" id="LN3059">3059</td><td class="line">    screen_cur_row = screen_cur_col = 9999;</td></tr>
<tr class="codeline" data-linenumber="3060"><td class="num" id="LN3060">3060</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3061"><td class="num" id="LN3061">3061</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3062"><td class="num" id="LN3062">3062</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3063"><td class="num" id="LN3063">3063</td><td class="line"> <span class='comment'>* Move the cursor to position "row","col" in the screen.</span></td></tr>
<tr class="codeline" data-linenumber="3064"><td class="num" id="LN3064">3064</td><td class="line"> <span class='comment'>* This tries to find the most efficient way to move, minimizing the number of</span></td></tr>
<tr class="codeline" data-linenumber="3065"><td class="num" id="LN3065">3065</td><td class="line"> <span class='comment'>* characters sent to the terminal.</span></td></tr>
<tr class="codeline" data-linenumber="3066"><td class="num" id="LN3066">3066</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3067"><td class="num" id="LN3067">3067</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3068"><td class="num" id="LN3068">3068</td><td class="line">windgoto(<span class='keyword'>int</span> row, <span class='keyword'>int</span> col)</td></tr>
<tr class="codeline" data-linenumber="3069"><td class="num" id="LN3069">3069</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3070"><td class="num" id="LN3070">3070</td><td class="line">    sattr_T	    *p;</td></tr>
<tr class="codeline" data-linenumber="3071"><td class="num" id="LN3071">3071</td><td class="line">    <span class='keyword'>int</span>		    i;</td></tr>
<tr class="codeline" data-linenumber="3072"><td class="num" id="LN3072">3072</td><td class="line">    <span class='keyword'>int</span>		    plan;</td></tr>
<tr class="codeline" data-linenumber="3073"><td class="num" id="LN3073">3073</td><td class="line">    <span class='keyword'>int</span>		    cost;</td></tr>
<tr class="codeline" data-linenumber="3074"><td class="num" id="LN3074">3074</td><td class="line">    <span class='keyword'>int</span>		    wouldbe_col;</td></tr>
<tr class="codeline" data-linenumber="3075"><td class="num" id="LN3075">3075</td><td class="line">    <span class='keyword'>int</span>		    noinvcurs;</td></tr>
<tr class="codeline" data-linenumber="3076"><td class="num" id="LN3076">3076</td><td class="line">    char_u	    *bs;</td></tr>
<tr class="codeline" data-linenumber="3077"><td class="num" id="LN3077">3077</td><td class="line">    <span class='keyword'>int</span>		    goto_cost;</td></tr>
<tr class="codeline" data-linenumber="3078"><td class="num" id="LN3078">3078</td><td class="line">    <span class='keyword'>int</span>		    attr;</td></tr>
<tr class="codeline" data-linenumber="3079"><td class="num" id="LN3079">3079</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3080"><td class="num" id="LN3080">3080</td><td class="line"><span class='directive'>#define <span class='macro'>GOTO_COST<span class='macro_popup'>7</span></span>   7	// assume a term_windgoto() takes about 7 chars</span></td></tr>
<tr class="codeline" data-linenumber="3081"><td class="num" id="LN3081">3081</td><td class="line"><span class='directive'>#define <span class='macro'>HIGHL_COST<span class='macro_popup'>5</span></span>  5	// assume unhighlight takes 5 chars</span></td></tr>
<tr class="codeline" data-linenumber="3082"><td class="num" id="LN3082">3082</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3083"><td class="num" id="LN3083">3083</td><td class="line"><span class='directive'>#define <span class='macro'>PLAN_LE<span class='macro_popup'>1</span></span>	    1</span></td></tr>
<tr class="codeline" data-linenumber="3084"><td class="num" id="LN3084">3084</td><td class="line"><span class='directive'>#define <span class='macro'>PLAN_CR<span class='macro_popup'>2</span></span>	    2</span></td></tr>
<tr class="codeline" data-linenumber="3085"><td class="num" id="LN3085">3085</td><td class="line"><span class='directive'>#define <span class='macro'>PLAN_NL<span class='macro_popup'>3</span></span>	    3</span></td></tr>
<tr class="codeline" data-linenumber="3086"><td class="num" id="LN3086">3086</td><td class="line"><span class='directive'>#define <span class='macro'>PLAN_WRITE<span class='macro_popup'>4</span></span>  4</span></td></tr>
<tr class="codeline" data-linenumber="3087"><td class="num" id="LN3087">3087</td><td class="line">    <span class='comment'>// Can't use ScreenLines unless initialized</span></td></tr>
<tr class="codeline" data-linenumber="3088"><td class="num" id="LN3088">3088</td><td class="line">    <span class='keyword'>if</span> (ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3089"><td class="num" id="LN3089">3089</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="3090"><td class="num" id="LN3090">3090</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3091"><td class="num" id="LN3091">3091</td><td class="line">    <span class='keyword'>if</span> (col != screen_cur_col || row != screen_cur_row)</td></tr>
<tr class="codeline" data-linenumber="3092"><td class="num" id="LN3092">3092</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3093"><td class="num" id="LN3093">3093</td><td class="line">	<span class='comment'>// Check for valid position.</span></td></tr>
<tr class="codeline" data-linenumber="3094"><td class="num" id="LN3094">3094</td><td class="line">	<span class='keyword'>if</span> (row &lt; 0)	<span class='comment'>// window without text lines?</span></td></tr>
<tr class="codeline" data-linenumber="3095"><td class="num" id="LN3095">3095</td><td class="line">	    row = 0;</td></tr>
<tr class="codeline" data-linenumber="3096"><td class="num" id="LN3096">3096</td><td class="line">	<span class='keyword'>if</span> (row &gt;= screen_Rows)</td></tr>
<tr class="codeline" data-linenumber="3097"><td class="num" id="LN3097">3097</td><td class="line">	    row = screen_Rows - 1;</td></tr>
<tr class="codeline" data-linenumber="3098"><td class="num" id="LN3098">3098</td><td class="line">	<span class='keyword'>if</span> (col &gt;= screen_Columns)</td></tr>
<tr class="codeline" data-linenumber="3099"><td class="num" id="LN3099">3099</td><td class="line">	    col = screen_Columns - 1;</td></tr>
<tr class="codeline" data-linenumber="3100"><td class="num" id="LN3100">3100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3101"><td class="num" id="LN3101">3101</td><td class="line">	<span class='comment'>// check if no cursor movement is allowed in highlight mode</span></td></tr>
<tr class="codeline" data-linenumber="3102"><td class="num" id="LN3102">3102</td><td class="line">	<span class='keyword'>if</span> (screen_attr &amp;&amp; *<span class='macro'>T_MS<span class='macro_popup'>(term_strings[(int)(KS_MS)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3103"><td class="num" id="LN3103">3103</td><td class="line">	    noinvcurs = <span class='macro'>HIGHL_COST<span class='macro_popup'>5</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3104"><td class="num" id="LN3104">3104</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3105"><td class="num" id="LN3105">3105</td><td class="line">	    noinvcurs = 0;</td></tr>
<tr class="codeline" data-linenumber="3106"><td class="num" id="LN3106">3106</td><td class="line">	goto_cost = <span class='macro'>GOTO_COST<span class='macro_popup'>7</span></span> + noinvcurs;</td></tr>
<tr class="codeline" data-linenumber="3107"><td class="num" id="LN3107">3107</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3108"><td class="num" id="LN3108">3108</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3109"><td class="num" id="LN3109">3109</td><td class="line">	 <span class='comment'>* Plan how to do the positioning:</span></td></tr>
<tr class="codeline" data-linenumber="3110"><td class="num" id="LN3110">3110</td><td class="line">	 <span class='comment'>* 1. Use CR to move it to column 0, same row.</span></td></tr>
<tr class="codeline" data-linenumber="3111"><td class="num" id="LN3111">3111</td><td class="line">	 <span class='comment'>* 2. Use T_LE to move it a few columns to the left.</span></td></tr>
<tr class="codeline" data-linenumber="3112"><td class="num" id="LN3112">3112</td><td class="line">	 <span class='comment'>* 3. Use NL to move a few lines down, column 0.</span></td></tr>
<tr class="codeline" data-linenumber="3113"><td class="num" id="LN3113">3113</td><td class="line">	 <span class='comment'>* 4. Move a few columns to the right with T_ND or by writing chars.</span></td></tr>
<tr class="codeline" data-linenumber="3114"><td class="num" id="LN3114">3114</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="3115"><td class="num" id="LN3115">3115</td><td class="line">	 <span class='comment'>* Don't do this if the cursor went beyond the last column, the cursor</span></td></tr>
<tr class="codeline" data-linenumber="3116"><td class="num" id="LN3116">3116</td><td class="line">	 <span class='comment'>* position is unknown then (some terminals wrap, some don't )</span></td></tr>
<tr class="codeline" data-linenumber="3117"><td class="num" id="LN3117">3117</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="3118"><td class="num" id="LN3118">3118</td><td class="line">	 <span class='comment'>* First check if the highlighting attributes allow us to write</span></td></tr>
<tr class="codeline" data-linenumber="3119"><td class="num" id="LN3119">3119</td><td class="line">	 <span class='comment'>* characters to move the cursor to the right.</span></td></tr>
<tr class="codeline" data-linenumber="3120"><td class="num" id="LN3120">3120</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3121"><td class="num" id="LN3121">3121</td><td class="line">	<span class='keyword'>if</span> (row &gt;= screen_cur_row &amp;&amp; screen_cur_col &lt; Columns)</td></tr>
<tr class="codeline" data-linenumber="3122"><td class="num" id="LN3122">3122</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3123"><td class="num" id="LN3123">3123</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3124"><td class="num" id="LN3124">3124</td><td class="line">	     <span class='comment'>* If the cursor is in the same row, bigger col, we can use CR</span></td></tr>
<tr class="codeline" data-linenumber="3125"><td class="num" id="LN3125">3125</td><td class="line">	     <span class='comment'>* or T_LE.</span></td></tr>
<tr class="codeline" data-linenumber="3126"><td class="num" id="LN3126">3126</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3127"><td class="num" id="LN3127">3127</td><td class="line">	    bs = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;			    <span class='comment'>// init for GCC</span></td></tr>
<tr class="codeline" data-linenumber="3128"><td class="num" id="LN3128">3128</td><td class="line">	    attr = screen_attr;</td></tr>
<tr class="codeline" data-linenumber="3129"><td class="num" id="LN3129">3129</td><td class="line">	    <span class='keyword'>if</span> (row == screen_cur_row &amp;&amp; col &lt; screen_cur_col)</td></tr>
<tr class="codeline" data-linenumber="3130"><td class="num" id="LN3130">3130</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3131"><td class="num" id="LN3131">3131</td><td class="line">		<span class='comment'>// "le" is preferred over "bc", because "bc" is obsolete</span></td></tr>
<tr class="codeline" data-linenumber="3132"><td class="num" id="LN3132">3132</td><td class="line">		<span class='keyword'>if</span> (*<span class='macro'>T_LE<span class='macro_popup'>(term_strings[(int)(KS_LE)])</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3133"><td class="num" id="LN3133">3133</td><td class="line">		    bs = <span class='macro'>T_LE<span class='macro_popup'>(term_strings[(int)(KS_LE)])</span></span>;		    <span class='comment'>// "cursor left"</span></td></tr>
<tr class="codeline" data-linenumber="3134"><td class="num" id="LN3134">3134</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3135"><td class="num" id="LN3135">3135</td><td class="line">		    bs = <span class='macro'>T_BC<span class='macro_popup'>(term_strings[(int)(KS_BC)])</span></span>;		    <span class='comment'>// "backspace character (old)</span></td></tr>
<tr class="codeline" data-linenumber="3136"><td class="num" id="LN3136">3136</td><td class="line">		<span class='keyword'>if</span> (*bs)</td></tr>
<tr class="codeline" data-linenumber="3137"><td class="num" id="LN3137">3137</td><td class="line">		    cost = (screen_cur_col - col) * (<span class='keyword'>int</span>)<span class='macro'>STRLEN(bs)<span class='macro_popup'>strlen((char *)(bs))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3138"><td class="num" id="LN3138">3138</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3139"><td class="num" id="LN3139">3139</td><td class="line">		    cost = 999;</td></tr>
<tr class="codeline" data-linenumber="3140"><td class="num" id="LN3140">3140</td><td class="line">		<span class='keyword'>if</span> (col + 1 &lt; cost)	    <span class='comment'>// using CR is less characters</span></td></tr>
<tr class="codeline" data-linenumber="3141"><td class="num" id="LN3141">3141</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3142"><td class="num" id="LN3142">3142</td><td class="line">		    plan = <span class='macro'>PLAN_CR<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3143"><td class="num" id="LN3143">3143</td><td class="line">		    wouldbe_col = 0;</td></tr>
<tr class="codeline" data-linenumber="3144"><td class="num" id="LN3144">3144</td><td class="line">		    cost = 1;		    <span class='comment'>// CR is just one character</span></td></tr>
<tr class="codeline" data-linenumber="3145"><td class="num" id="LN3145">3145</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3146"><td class="num" id="LN3146">3146</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3147"><td class="num" id="LN3147">3147</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3148"><td class="num" id="LN3148">3148</td><td class="line">		    plan = <span class='macro'>PLAN_LE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3149"><td class="num" id="LN3149">3149</td><td class="line">		    wouldbe_col = col;</td></tr>
<tr class="codeline" data-linenumber="3150"><td class="num" id="LN3150">3150</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3151"><td class="num" id="LN3151">3151</td><td class="line">		<span class='keyword'>if</span> (noinvcurs)		    <span class='comment'>// will stop highlighting</span></td></tr>
<tr class="codeline" data-linenumber="3152"><td class="num" id="LN3152">3152</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3153"><td class="num" id="LN3153">3153</td><td class="line">		    cost += noinvcurs;</td></tr>
<tr class="codeline" data-linenumber="3154"><td class="num" id="LN3154">3154</td><td class="line">		    attr = 0;</td></tr>
<tr class="codeline" data-linenumber="3155"><td class="num" id="LN3155">3155</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3156"><td class="num" id="LN3156">3156</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3157"><td class="num" id="LN3157">3157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3158"><td class="num" id="LN3158">3158</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3159"><td class="num" id="LN3159">3159</td><td class="line">	     <span class='comment'>* If the cursor is above where we want to be, we can use CR LF.</span></td></tr>
<tr class="codeline" data-linenumber="3160"><td class="num" id="LN3160">3160</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3161"><td class="num" id="LN3161">3161</td><td class="line">	    <span class='keyword'>else</span> <span class='keyword'>if</span> (row &gt; screen_cur_row)</td></tr>
<tr class="codeline" data-linenumber="3162"><td class="num" id="LN3162">3162</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3163"><td class="num" id="LN3163">3163</td><td class="line">		plan = <span class='macro'>PLAN_NL<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3164"><td class="num" id="LN3164">3164</td><td class="line">		wouldbe_col = 0;</td></tr>
<tr class="codeline" data-linenumber="3165"><td class="num" id="LN3165">3165</td><td class="line">		cost = (row - screen_cur_row) * 2;  <span class='comment'>// CR LF</span></td></tr>
<tr class="codeline" data-linenumber="3166"><td class="num" id="LN3166">3166</td><td class="line">		<span class='keyword'>if</span> (noinvcurs)		    <span class='comment'>// will stop highlighting</span></td></tr>
<tr class="codeline" data-linenumber="3167"><td class="num" id="LN3167">3167</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3168"><td class="num" id="LN3168">3168</td><td class="line">		    cost += noinvcurs;</td></tr>
<tr class="codeline" data-linenumber="3169"><td class="num" id="LN3169">3169</td><td class="line">		    attr = 0;</td></tr>
<tr class="codeline" data-linenumber="3170"><td class="num" id="LN3170">3170</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3171"><td class="num" id="LN3171">3171</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3172"><td class="num" id="LN3172">3172</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3173"><td class="num" id="LN3173">3173</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3174"><td class="num" id="LN3174">3174</td><td class="line">	     <span class='comment'>* If the cursor is in the same row, smaller col, just use write.</span></td></tr>
<tr class="codeline" data-linenumber="3175"><td class="num" id="LN3175">3175</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3176"><td class="num" id="LN3176">3176</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3177"><td class="num" id="LN3177">3177</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3178"><td class="num" id="LN3178">3178</td><td class="line">		plan = <span class='macro'>PLAN_WRITE<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3179"><td class="num" id="LN3179">3179</td><td class="line">		wouldbe_col = screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="3180"><td class="num" id="LN3180">3180</td><td class="line">		cost = 0;</td></tr>
<tr class="codeline" data-linenumber="3181"><td class="num" id="LN3181">3181</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3182"><td class="num" id="LN3182">3182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3183"><td class="num" id="LN3183">3183</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3184"><td class="num" id="LN3184">3184</td><td class="line">	     <span class='comment'>* Check if any characters that need to be written have the</span></td></tr>
<tr class="codeline" data-linenumber="3185"><td class="num" id="LN3185">3185</td><td class="line">	     <span class='comment'>* correct attributes.  Also avoid UTF-8 characters.</span></td></tr>
<tr class="codeline" data-linenumber="3186"><td class="num" id="LN3186">3186</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3187"><td class="num" id="LN3187">3187</td><td class="line">	    i = col - wouldbe_col;</td></tr>
<tr class="codeline" data-linenumber="3188"><td class="num" id="LN3188">3188</td><td class="line">	    <span class='keyword'>if</span> (i &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3189"><td class="num" id="LN3189">3189</td><td class="line">		cost += i;</td></tr>
<tr class="codeline" data-linenumber="3190"><td class="num" id="LN3190">3190</td><td class="line">	    <span class='keyword'>if</span> (cost &lt; goto_cost &amp;&amp; i &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3191"><td class="num" id="LN3191">3191</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3192"><td class="num" id="LN3192">3192</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3193"><td class="num" id="LN3193">3193</td><td class="line">		 <span class='comment'>* Check if the attributes are correct without additionally</span></td></tr>
<tr class="codeline" data-linenumber="3194"><td class="num" id="LN3194">3194</td><td class="line">		 <span class='comment'>* stopping highlighting.</span></td></tr>
<tr class="codeline" data-linenumber="3195"><td class="num" id="LN3195">3195</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3196"><td class="num" id="LN3196">3196</td><td class="line">		p = ScreenAttrs + LineOffset[row] + wouldbe_col;</td></tr>
<tr class="codeline" data-linenumber="3197"><td class="num" id="LN3197">3197</td><td class="line">		<span class='keyword'>while</span> (i &amp;&amp; *p++ == attr)</td></tr>
<tr class="codeline" data-linenumber="3198"><td class="num" id="LN3198">3198</td><td class="line">		    --i;</td></tr>
<tr class="codeline" data-linenumber="3199"><td class="num" id="LN3199">3199</td><td class="line">		<span class='keyword'>if</span> (i != 0)</td></tr>
<tr class="codeline" data-linenumber="3200"><td class="num" id="LN3200">3200</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3201"><td class="num" id="LN3201">3201</td><td class="line">		    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3202"><td class="num" id="LN3202">3202</td><td class="line">		     <span class='comment'>* Try if it works when highlighting is stopped here.</span></td></tr>
<tr class="codeline" data-linenumber="3203"><td class="num" id="LN3203">3203</td><td class="line">		     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3204"><td class="num" id="LN3204">3204</td><td class="line">		    <span class='keyword'>if</span> (*--p == 0)</td></tr>
<tr class="codeline" data-linenumber="3205"><td class="num" id="LN3205">3205</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="3206"><td class="num" id="LN3206">3206</td><td class="line">			cost += noinvcurs;</td></tr>
<tr class="codeline" data-linenumber="3207"><td class="num" id="LN3207">3207</td><td class="line">			<span class='keyword'>while</span> (i &amp;&amp; *p++ == 0)</td></tr>
<tr class="codeline" data-linenumber="3208"><td class="num" id="LN3208">3208</td><td class="line">			    --i;</td></tr>
<tr class="codeline" data-linenumber="3209"><td class="num" id="LN3209">3209</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="3210"><td class="num" id="LN3210">3210</td><td class="line">		    <span class='keyword'>if</span> (i != 0)</td></tr>
<tr class="codeline" data-linenumber="3211"><td class="num" id="LN3211">3211</td><td class="line">			cost = 999;	<span class='comment'>// different attributes, don't do it</span></td></tr>
<tr class="codeline" data-linenumber="3212"><td class="num" id="LN3212">3212</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3213"><td class="num" id="LN3213">3213</td><td class="line">		<span class='keyword'>if</span> (enc_utf8)</td></tr>
<tr class="codeline" data-linenumber="3214"><td class="num" id="LN3214">3214</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3215"><td class="num" id="LN3215">3215</td><td class="line">		    <span class='comment'>// Don't use an UTF-8 char for positioning, it's slow.</span></td></tr>
<tr class="codeline" data-linenumber="3216"><td class="num" id="LN3216">3216</td><td class="line">		    <span class='keyword'>for</span> (i = wouldbe_col; i &lt; col; ++i)</td></tr>
<tr class="codeline" data-linenumber="3217"><td class="num" id="LN3217">3217</td><td class="line">			<span class='keyword'>if</span> (ScreenLinesUC[LineOffset[row] + i] != 0)</td></tr>
<tr class="codeline" data-linenumber="3218"><td class="num" id="LN3218">3218</td><td class="line">			{</td></tr>
<tr class="codeline" data-linenumber="3219"><td class="num" id="LN3219">3219</td><td class="line">			    cost = 999;</td></tr>
<tr class="codeline" data-linenumber="3220"><td class="num" id="LN3220">3220</td><td class="line">			    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3221"><td class="num" id="LN3221">3221</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="3222"><td class="num" id="LN3222">3222</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3223"><td class="num" id="LN3223">3223</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3224"><td class="num" id="LN3224">3224</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3225"><td class="num" id="LN3225">3225</td><td class="line">	    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3226"><td class="num" id="LN3226">3226</td><td class="line">	     <span class='comment'>* We can do it without term_windgoto()!</span></td></tr>
<tr class="codeline" data-linenumber="3227"><td class="num" id="LN3227">3227</td><td class="line">	     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3228"><td class="num" id="LN3228">3228</td><td class="line">	    <span class='keyword'>if</span> (cost &lt; goto_cost)</td></tr>
<tr class="codeline" data-linenumber="3229"><td class="num" id="LN3229">3229</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3230"><td class="num" id="LN3230">3230</td><td class="line">		<span class='keyword'>if</span> (plan == <span class='macro'>PLAN_LE<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3231"><td class="num" id="LN3231">3231</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3232"><td class="num" id="LN3232">3232</td><td class="line">		    <span class='keyword'>if</span> (noinvcurs)</td></tr>
<tr class="codeline" data-linenumber="3233"><td class="num" id="LN3233">3233</td><td class="line">			screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="3234"><td class="num" id="LN3234">3234</td><td class="line">		    <span class='keyword'>while</span> (screen_cur_col &gt; col)</td></tr>
<tr class="codeline" data-linenumber="3235"><td class="num" id="LN3235">3235</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="3236"><td class="num" id="LN3236">3236</td><td class="line">			out_str(bs);</td></tr>
<tr class="codeline" data-linenumber="3237"><td class="num" id="LN3237">3237</td><td class="line">			--screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="3238"><td class="num" id="LN3238">3238</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="3239"><td class="num" id="LN3239">3239</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3240"><td class="num" id="LN3240">3240</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (plan == <span class='macro'>PLAN_CR<span class='macro_popup'>2</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3241"><td class="num" id="LN3241">3241</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3242"><td class="num" id="LN3242">3242</td><td class="line">		    <span class='keyword'>if</span> (noinvcurs)</td></tr>
<tr class="codeline" data-linenumber="3243"><td class="num" id="LN3243">3243</td><td class="line">			screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="3244"><td class="num" id="LN3244">3244</td><td class="line">		    out_char('\r');</td></tr>
<tr class="codeline" data-linenumber="3245"><td class="num" id="LN3245">3245</td><td class="line">		    screen_cur_col = 0;</td></tr>
<tr class="codeline" data-linenumber="3246"><td class="num" id="LN3246">3246</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3247"><td class="num" id="LN3247">3247</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (plan == <span class='macro'>PLAN_NL<span class='macro_popup'>3</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3248"><td class="num" id="LN3248">3248</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3249"><td class="num" id="LN3249">3249</td><td class="line">		    <span class='keyword'>if</span> (noinvcurs)</td></tr>
<tr class="codeline" data-linenumber="3250"><td class="num" id="LN3250">3250</td><td class="line">			screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="3251"><td class="num" id="LN3251">3251</td><td class="line">		    <span class='keyword'>while</span> (screen_cur_row &lt; row)</td></tr>
<tr class="codeline" data-linenumber="3252"><td class="num" id="LN3252">3252</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="3253"><td class="num" id="LN3253">3253</td><td class="line">			out_char('\n');</td></tr>
<tr class="codeline" data-linenumber="3254"><td class="num" id="LN3254">3254</td><td class="line">			++screen_cur_row;</td></tr>
<tr class="codeline" data-linenumber="3255"><td class="num" id="LN3255">3255</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="3256"><td class="num" id="LN3256">3256</td><td class="line">		    screen_cur_col = 0;</td></tr>
<tr class="codeline" data-linenumber="3257"><td class="num" id="LN3257">3257</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3258"><td class="num" id="LN3258">3258</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3259"><td class="num" id="LN3259">3259</td><td class="line">		i = col - screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="3260"><td class="num" id="LN3260">3260</td><td class="line">		<span class='keyword'>if</span> (i &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3261"><td class="num" id="LN3261">3261</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="3262"><td class="num" id="LN3262">3262</td><td class="line">		    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3263"><td class="num" id="LN3263">3263</td><td class="line">		     <span class='comment'>* Use cursor-right if it's one character only.  Avoids</span></td></tr>
<tr class="codeline" data-linenumber="3264"><td class="num" id="LN3264">3264</td><td class="line">		     <span class='comment'>* removing a line of pixels from the last bold char, when</span></td></tr>
<tr class="codeline" data-linenumber="3265"><td class="num" id="LN3265">3265</td><td class="line">		     <span class='comment'>* using the bold trick in the GUI.</span></td></tr>
<tr class="codeline" data-linenumber="3266"><td class="num" id="LN3266">3266</td><td class="line">		     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3267"><td class="num" id="LN3267">3267</td><td class="line">		    <span class='keyword'>if</span> (<span class='macro'>T_ND<span class='macro_popup'>(term_strings[(int)(KS_ND)])</span></span>[0] != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; <span class='macro'>T_ND<span class='macro_popup'>(term_strings[(int)(KS_ND)])</span></span>[1] == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3268"><td class="num" id="LN3268">3268</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="3269"><td class="num" id="LN3269">3269</td><td class="line">			<span class='keyword'>while</span> (i-- &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3270"><td class="num" id="LN3270">3270</td><td class="line">			    out_char(*<span class='macro'>T_ND<span class='macro_popup'>(term_strings[(int)(KS_ND)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3271"><td class="num" id="LN3271">3271</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="3272"><td class="num" id="LN3272">3272</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3273"><td class="num" id="LN3273">3273</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="3274"><td class="num" id="LN3274">3274</td><td class="line">			<span class='keyword'>int</span>	off;</td></tr>
<tr class="codeline" data-linenumber="3275"><td class="num" id="LN3275">3275</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3276"><td class="num" id="LN3276">3276</td><td class="line">			off = LineOffset[row] + screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="3277"><td class="num" id="LN3277">3277</td><td class="line">			<span class='keyword'>while</span> (i-- &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3278"><td class="num" id="LN3278">3278</td><td class="line">			{</td></tr>
<tr class="codeline" data-linenumber="3279"><td class="num" id="LN3279">3279</td><td class="line">			    <span class='keyword'>if</span> (ScreenAttrs[off] != screen_attr)</td></tr>
<tr class="codeline" data-linenumber="3280"><td class="num" id="LN3280">3280</td><td class="line">				screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="3281"><td class="num" id="LN3281">3281</td><td class="line">			    out_flush_check();</td></tr>
<tr class="codeline" data-linenumber="3282"><td class="num" id="LN3282">3282</td><td class="line">			    out_char(ScreenLines[off]);</td></tr>
<tr class="codeline" data-linenumber="3283"><td class="num" id="LN3283">3283</td><td class="line">			    <span class='keyword'>if</span> (enc_dbcs == <span class='macro'>DBCS_JPNU<span class='macro_popup'>9932</span></span></td></tr>
<tr class="codeline" data-linenumber="3284"><td class="num" id="LN3284">3284</td><td class="line">						  &amp;&amp; ScreenLines[off] == 0x8e)</td></tr>
<tr class="codeline" data-linenumber="3285"><td class="num" id="LN3285">3285</td><td class="line">				out_char(ScreenLines2[off]);</td></tr>
<tr class="codeline" data-linenumber="3286"><td class="num" id="LN3286">3286</td><td class="line">			    ++off;</td></tr>
<tr class="codeline" data-linenumber="3287"><td class="num" id="LN3287">3287</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="3288"><td class="num" id="LN3288">3288</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="3289"><td class="num" id="LN3289">3289</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="3290"><td class="num" id="LN3290">3290</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3291"><td class="num" id="LN3291">3291</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3292"><td class="num" id="LN3292">3292</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3293"><td class="num" id="LN3293">3293</td><td class="line">	    cost = 999;</td></tr>
<tr class="codeline" data-linenumber="3294"><td class="num" id="LN3294">3294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3295"><td class="num" id="LN3295">3295</td><td class="line">	<span class='keyword'>if</span> (cost &gt;= goto_cost)</td></tr>
<tr class="codeline" data-linenumber="3296"><td class="num" id="LN3296">3296</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3297"><td class="num" id="LN3297">3297</td><td class="line">	    <span class='keyword'>if</span> (noinvcurs)</td></tr>
<tr class="codeline" data-linenumber="3298"><td class="num" id="LN3298">3298</td><td class="line">		screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="3299"><td class="num" id="LN3299">3299</td><td class="line">	    <span class='keyword'>if</span> (row == screen_cur_row &amp;&amp; (col &gt; screen_cur_col)</td></tr>
<tr class="codeline" data-linenumber="3300"><td class="num" id="LN3300">3300</td><td class="line">							     &amp;&amp; *<span class='macro'>T_CRI<span class='macro_popup'>(term_strings[(int)(KS_CRI)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3301"><td class="num" id="LN3301">3301</td><td class="line">		term_cursor_right(col - screen_cur_col);</td></tr>
<tr class="codeline" data-linenumber="3302"><td class="num" id="LN3302">3302</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3303"><td class="num" id="LN3303">3303</td><td class="line">		term_windgoto(row, col);</td></tr>
<tr class="codeline" data-linenumber="3304"><td class="num" id="LN3304">3304</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3305"><td class="num" id="LN3305">3305</td><td class="line">	screen_cur_row = row;</td></tr>
<tr class="codeline" data-linenumber="3306"><td class="num" id="LN3306">3306</td><td class="line">	screen_cur_col = col;</td></tr>
<tr class="codeline" data-linenumber="3307"><td class="num" id="LN3307">3307</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3308"><td class="num" id="LN3308">3308</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3309"><td class="num" id="LN3309">3309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3310"><td class="num" id="LN3310">3310</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3311"><td class="num" id="LN3311">3311</td><td class="line"> <span class='comment'>* Set cursor to its position in the current window.</span></td></tr>
<tr class="codeline" data-linenumber="3312"><td class="num" id="LN3312">3312</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3313"><td class="num" id="LN3313">3313</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3314"><td class="num" id="LN3314">3314</td><td class="line">setcursor(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="3315"><td class="num" id="LN3315">3315</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3316"><td class="num" id="LN3316">3316</td><td class="line">    setcursor_mayforce(<span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3317"><td class="num" id="LN3317">3317</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3318"><td class="num" id="LN3318">3318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3319"><td class="num" id="LN3319">3319</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3320"><td class="num" id="LN3320">3320</td><td class="line"> <span class='comment'>* Set cursor to its position in the current window.</span></td></tr>
<tr class="codeline" data-linenumber="3321"><td class="num" id="LN3321">3321</td><td class="line"> <span class='comment'>* When "force" is TRUE also when not redrawing.</span></td></tr>
<tr class="codeline" data-linenumber="3322"><td class="num" id="LN3322">3322</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3323"><td class="num" id="LN3323">3323</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3324"><td class="num" id="LN3324">3324</td><td class="line">setcursor_mayforce(<span class='keyword'>int</span> force)</td></tr>
<tr class="codeline" data-linenumber="3325"><td class="num" id="LN3325">3325</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3326"><td class="num" id="LN3326">3326</td><td class="line">    <span class='keyword'>if</span> (force || redrawing())</td></tr>
<tr class="codeline" data-linenumber="3327"><td class="num" id="LN3327">3327</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3328"><td class="num" id="LN3328">3328</td><td class="line">	validate_cursor();</td></tr>
<tr class="codeline" data-linenumber="3329"><td class="num" id="LN3329">3329</td><td class="line">	windgoto(<span class='macro'>W_WINROW(curwin)<span class='macro_popup'>(curwin-&gt;w_winrow + curwin-&gt;w_winbar_height)</span></span> + curwin-&gt;w_wrow,</td></tr>
<tr class="codeline" data-linenumber="3330"><td class="num" id="LN3330">3330</td><td class="line">		curwin-&gt;w_wincol + (</td></tr>
<tr class="codeline" data-linenumber="3331"><td class="num" id="LN3331">3331</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="3332"><td class="num" id="LN3332">3332</td><td class="line">		<span class='comment'>// With 'rightleft' set and the cursor on a double-wide</span></td></tr>
<tr class="codeline" data-linenumber="3333"><td class="num" id="LN3333">3333</td><td class="line">		<span class='comment'>// character, position it on the leftmost column.</span></td></tr>
<tr class="codeline" data-linenumber="3334"><td class="num" id="LN3334">3334</td><td class="line">		curwin-&gt;<span class='macro'>w_p_rl<span class='macro_popup'>w_onebuf_opt.wo_rl</span></span> ? ((<span class='keyword'>int</span>)curwin-&gt;w_width - curwin-&gt;w_wcol</td></tr>
<tr class="codeline" data-linenumber="3335"><td class="num" id="LN3335">3335</td><td class="line">		    - ((has_mbyte</td></tr>
<tr class="codeline" data-linenumber="3336"><td class="num" id="LN3336">3336</td><td class="line">			   &amp;&amp; (*mb_ptr2cells)(ml_get_cursor()) == 2</td></tr>
<tr class="codeline" data-linenumber="3337"><td class="num" id="LN3337">3337</td><td class="line">			   &amp;&amp; vim_isprintc(gchar_cursor())) ? 2 : 1)) :</td></tr>
<tr class="codeline" data-linenumber="3338"><td class="num" id="LN3338">3338</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3339"><td class="num" id="LN3339">3339</td><td class="line">							    curwin-&gt;w_wcol));</td></tr>
<tr class="codeline" data-linenumber="3340"><td class="num" id="LN3340">3340</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3341"><td class="num" id="LN3341">3341</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3342"><td class="num" id="LN3342">3342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3343"><td class="num" id="LN3343">3343</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3344"><td class="num" id="LN3344">3344</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3345"><td class="num" id="LN3345">3345</td><td class="line"> <span class='comment'>* Insert 'line_count' lines at 'row' in window 'wp'.</span></td></tr>
<tr class="codeline" data-linenumber="3346"><td class="num" id="LN3346">3346</td><td class="line"> <span class='comment'>* If 'invalid' is TRUE the wp-&gt;w_lines[].wl_lnum is invalidated.</span></td></tr>
<tr class="codeline" data-linenumber="3347"><td class="num" id="LN3347">3347</td><td class="line"> <span class='comment'>* If 'mayclear' is TRUE the screen will be cleared if it is faster than</span></td></tr>
<tr class="codeline" data-linenumber="3348"><td class="num" id="LN3348">3348</td><td class="line"> <span class='comment'>* scrolling.</span></td></tr>
<tr class="codeline" data-linenumber="3349"><td class="num" id="LN3349">3349</td><td class="line"> <span class='comment'>* Returns FAIL if the lines are not inserted, OK for success.</span></td></tr>
<tr class="codeline" data-linenumber="3350"><td class="num" id="LN3350">3350</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3351"><td class="num" id="LN3351">3351</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="3352"><td class="num" id="LN3352">3352</td><td class="line">win_ins_lines(</td></tr>
<tr class="codeline" data-linenumber="3353"><td class="num" id="LN3353">3353</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="3354"><td class="num" id="LN3354">3354</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="3355"><td class="num" id="LN3355">3355</td><td class="line">    <span class='keyword'>int</span>		line_count,</td></tr>
<tr class="codeline" data-linenumber="3356"><td class="num" id="LN3356">3356</td><td class="line">    <span class='keyword'>int</span>		invalid,</td></tr>
<tr class="codeline" data-linenumber="3357"><td class="num" id="LN3357">3357</td><td class="line">    <span class='keyword'>int</span>		mayclear)</td></tr>
<tr class="codeline" data-linenumber="3358"><td class="num" id="LN3358">3358</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3359"><td class="num" id="LN3359">3359</td><td class="line">    <span class='keyword'>int</span>		did_delete;</td></tr>
<tr class="codeline" data-linenumber="3360"><td class="num" id="LN3360">3360</td><td class="line">    <span class='keyword'>int</span>		nextrow;</td></tr>
<tr class="codeline" data-linenumber="3361"><td class="num" id="LN3361">3361</td><td class="line">    <span class='keyword'>int</span>		lastrow;</td></tr>
<tr class="codeline" data-linenumber="3362"><td class="num" id="LN3362">3362</td><td class="line">    <span class='keyword'>int</span>		retval;</td></tr>
<tr class="codeline" data-linenumber="3363"><td class="num" id="LN3363">3363</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3364"><td class="num" id="LN3364">3364</td><td class="line">    <span class='keyword'>if</span> (invalid)</td></tr>
<tr class="codeline" data-linenumber="3365"><td class="num" id="LN3365">3365</td><td class="line">	wp-&gt;w_lines_valid = 0;</td></tr>
<tr class="codeline" data-linenumber="3366"><td class="num" id="LN3366">3366</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3367"><td class="num" id="LN3367">3367</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;w_height &lt; 5)</td></tr>
<tr class="codeline" data-linenumber="3368"><td class="num" id="LN3368">3368</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3369"><td class="num" id="LN3369">3369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3370"><td class="num" id="LN3370">3370</td><td class="line">    <span class='keyword'>if</span> (line_count &gt; wp-&gt;w_height - row)</td></tr>
<tr class="codeline" data-linenumber="3371"><td class="num" id="LN3371">3371</td><td class="line">	line_count = wp-&gt;w_height - row;</td></tr>
<tr class="codeline" data-linenumber="3372"><td class="num" id="LN3372">3372</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3373"><td class="num" id="LN3373">3373</td><td class="line">    retval = win_do_lines(wp, row, line_count, mayclear, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="3374"><td class="num" id="LN3374">3374</td><td class="line">    <span class='keyword'>if</span> (retval != <span class='macro'>MAYBE<span class='macro_popup'>2</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3375"><td class="num" id="LN3375">3375</td><td class="line">	<span class='keyword'>return</span> retval;</td></tr>
<tr class="codeline" data-linenumber="3376"><td class="num" id="LN3376">3376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3377"><td class="num" id="LN3377">3377</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3378"><td class="num" id="LN3378">3378</td><td class="line">     <span class='comment'>* If there is a next window or a status line, we first try to delete the</span></td></tr>
<tr class="codeline" data-linenumber="3379"><td class="num" id="LN3379">3379</td><td class="line">     <span class='comment'>* lines at the bottom to avoid messing what is after the window.</span></td></tr>
<tr class="codeline" data-linenumber="3380"><td class="num" id="LN3380">3380</td><td class="line">     <span class='comment'>* If this fails and there are following windows, don't do anything to</span></td></tr>
<tr class="codeline" data-linenumber="3381"><td class="num" id="LN3381">3381</td><td class="line">     <span class='comment'>* avoid messing up those windows, better just redraw.</span></td></tr>
<tr class="codeline" data-linenumber="3382"><td class="num" id="LN3382">3382</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3383"><td class="num" id="LN3383">3383</td><td class="line">    did_delete = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3384"><td class="num" id="LN3384">3384</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;w_next != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || wp-&gt;w_status_height)</td></tr>
<tr class="codeline" data-linenumber="3385"><td class="num" id="LN3385">3385</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3386"><td class="num" id="LN3386">3386</td><td class="line">	<span class='keyword'>if</span> (screen_del_lines(0, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + wp-&gt;w_height - line_count,</td></tr>
<tr class="codeline" data-linenumber="3387"><td class="num" id="LN3387">3387</td><td class="line">				  line_count, (<span class='keyword'>int</span>)Rows, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, 0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) == <span class='macro'>OK<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3388"><td class="num" id="LN3388">3388</td><td class="line">	    did_delete = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3389"><td class="num" id="LN3389">3389</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (wp-&gt;w_next)</td></tr>
<tr class="codeline" data-linenumber="3390"><td class="num" id="LN3390">3390</td><td class="line">	    <span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3391"><td class="num" id="LN3391">3391</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3392"><td class="num" id="LN3392">3392</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3393"><td class="num" id="LN3393">3393</td><td class="line">     <span class='comment'>* if no lines deleted, blank the lines that will end up below the window</span></td></tr>
<tr class="codeline" data-linenumber="3394"><td class="num" id="LN3394">3394</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3395"><td class="num" id="LN3395">3395</td><td class="line">    <span class='keyword'>if</span> (!did_delete)</td></tr>
<tr class="codeline" data-linenumber="3396"><td class="num" id="LN3396">3396</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3397"><td class="num" id="LN3397">3397</td><td class="line">	wp-&gt;w_redr_status = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3398"><td class="num" id="LN3398">3398</td><td class="line">	redraw_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3399"><td class="num" id="LN3399">3399</td><td class="line">	nextrow = <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + wp-&gt;w_height + wp-&gt;w_status_height;</td></tr>
<tr class="codeline" data-linenumber="3400"><td class="num" id="LN3400">3400</td><td class="line">	lastrow = nextrow + line_count;</td></tr>
<tr class="codeline" data-linenumber="3401"><td class="num" id="LN3401">3401</td><td class="line">	<span class='keyword'>if</span> (lastrow &gt; Rows)</td></tr>
<tr class="codeline" data-linenumber="3402"><td class="num" id="LN3402">3402</td><td class="line">	    lastrow = Rows;</td></tr>
<tr class="codeline" data-linenumber="3403"><td class="num" id="LN3403">3403</td><td class="line">	screen_fill(nextrow - line_count, lastrow - line_count,</td></tr>
<tr class="codeline" data-linenumber="3404"><td class="num" id="LN3404">3404</td><td class="line">		  wp-&gt;w_wincol, (<span class='keyword'>int</span>)<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="3405"><td class="num" id="LN3405">3405</td><td class="line">		  ' ', ' ', 0);</td></tr>
<tr class="codeline" data-linenumber="3406"><td class="num" id="LN3406">3406</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3407"><td class="num" id="LN3407">3407</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3408"><td class="num" id="LN3408">3408</td><td class="line">    <span class='keyword'>if</span> (screen_ins_lines(0, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, line_count, (<span class='keyword'>int</span>)Rows, 0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3409"><td class="num" id="LN3409">3409</td><td class="line">								      == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3410"><td class="num" id="LN3410">3410</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3411"><td class="num" id="LN3411">3411</td><td class="line">	<span class='comment'>// deletion will have messed up other windows</span></td></tr>
<tr class="codeline" data-linenumber="3412"><td class="num" id="LN3412">3412</td><td class="line">	<span class='keyword'>if</span> (did_delete)</td></tr>
<tr class="codeline" data-linenumber="3413"><td class="num" id="LN3413">3413</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3414"><td class="num" id="LN3414">3414</td><td class="line">	    wp-&gt;w_redr_status = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3415"><td class="num" id="LN3415">3415</td><td class="line">	    win_rest_invalid(<span class='macro'>W_NEXT(wp)<span class='macro_popup'>((wp)-&gt;w_next)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3416"><td class="num" id="LN3416">3416</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3417"><td class="num" id="LN3417">3417</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3418"><td class="num" id="LN3418">3418</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3419"><td class="num" id="LN3419">3419</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3420"><td class="num" id="LN3420">3420</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>OK<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3421"><td class="num" id="LN3421">3421</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3422"><td class="num" id="LN3422">3422</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3423"><td class="num" id="LN3423">3423</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3424"><td class="num" id="LN3424">3424</td><td class="line"> <span class='comment'>* Delete "line_count" window lines at "row" in window "wp".</span></td></tr>
<tr class="codeline" data-linenumber="3425"><td class="num" id="LN3425">3425</td><td class="line"> <span class='comment'>* If "invalid" is TRUE curwin-&gt;w_lines[] is invalidated.</span></td></tr>
<tr class="codeline" data-linenumber="3426"><td class="num" id="LN3426">3426</td><td class="line"> <span class='comment'>* If "mayclear" is TRUE the screen will be cleared if it is faster than</span></td></tr>
<tr class="codeline" data-linenumber="3427"><td class="num" id="LN3427">3427</td><td class="line"> <span class='comment'>* scrolling</span></td></tr>
<tr class="codeline" data-linenumber="3428"><td class="num" id="LN3428">3428</td><td class="line"> <span class='comment'>* Return OK for success, FAIL if the lines are not deleted.</span></td></tr>
<tr class="codeline" data-linenumber="3429"><td class="num" id="LN3429">3429</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3430"><td class="num" id="LN3430">3430</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="3431"><td class="num" id="LN3431">3431</td><td class="line">win_del_lines(</td></tr>
<tr class="codeline" data-linenumber="3432"><td class="num" id="LN3432">3432</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="3433"><td class="num" id="LN3433">3433</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="3434"><td class="num" id="LN3434">3434</td><td class="line">    <span class='keyword'>int</span>		line_count,</td></tr>
<tr class="codeline" data-linenumber="3435"><td class="num" id="LN3435">3435</td><td class="line">    <span class='keyword'>int</span>		invalid,</td></tr>
<tr class="codeline" data-linenumber="3436"><td class="num" id="LN3436">3436</td><td class="line">    <span class='keyword'>int</span>		mayclear,</td></tr>
<tr class="codeline" data-linenumber="3437"><td class="num" id="LN3437">3437</td><td class="line">    <span class='keyword'>int</span>		clear_attr)	    <span class='comment'>// for clearing lines</span></td></tr>
<tr class="codeline" data-linenumber="3438"><td class="num" id="LN3438">3438</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3439"><td class="num" id="LN3439">3439</td><td class="line">    <span class='keyword'>int</span>		retval;</td></tr>
<tr class="codeline" data-linenumber="3440"><td class="num" id="LN3440">3440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3441"><td class="num" id="LN3441">3441</td><td class="line">    <span class='keyword'>if</span> (invalid)</td></tr>
<tr class="codeline" data-linenumber="3442"><td class="num" id="LN3442">3442</td><td class="line">	wp-&gt;w_lines_valid = 0;</td></tr>
<tr class="codeline" data-linenumber="3443"><td class="num" id="LN3443">3443</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3444"><td class="num" id="LN3444">3444</td><td class="line">    <span class='keyword'>if</span> (line_count &gt; wp-&gt;w_height - row)</td></tr>
<tr class="codeline" data-linenumber="3445"><td class="num" id="LN3445">3445</td><td class="line">	line_count = wp-&gt;w_height - row;</td></tr>
<tr class="codeline" data-linenumber="3446"><td class="num" id="LN3446">3446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3447"><td class="num" id="LN3447">3447</td><td class="line">    retval = win_do_lines(wp, row, line_count, mayclear, <span class='macro'>TRUE<span class='macro_popup'>1</span></span>, clear_attr);</td></tr>
<tr class="codeline" data-linenumber="3448"><td class="num" id="LN3448">3448</td><td class="line">    <span class='keyword'>if</span> (retval != <span class='macro'>MAYBE<span class='macro_popup'>2</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3449"><td class="num" id="LN3449">3449</td><td class="line">	<span class='keyword'>return</span> retval;</td></tr>
<tr class="codeline" data-linenumber="3450"><td class="num" id="LN3450">3450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3451"><td class="num" id="LN3451">3451</td><td class="line">    <span class='keyword'>if</span> (screen_del_lines(0, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, line_count,</td></tr>
<tr class="codeline" data-linenumber="3452"><td class="num" id="LN3452">3452</td><td class="line">				   (<span class='keyword'>int</span>)Rows, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, clear_attr, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3453"><td class="num" id="LN3453">3453</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3454"><td class="num" id="LN3454">3454</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3455"><td class="num" id="LN3455">3455</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3456"><td class="num" id="LN3456">3456</td><td class="line">     <span class='comment'>* If there are windows or status lines below, try to put them at the</span></td></tr>
<tr class="codeline" data-linenumber="3457"><td class="num" id="LN3457">3457</td><td class="line">     <span class='comment'>* correct place. If we can't do that, they have to be redrawn.</span></td></tr>
<tr class="codeline" data-linenumber="3458"><td class="num" id="LN3458">3458</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3459"><td class="num" id="LN3459">3459</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;w_next || wp-&gt;w_status_height || cmdline_row &lt; Rows - 1)</td></tr>
<tr class="codeline" data-linenumber="3460"><td class="num" id="LN3460">3460</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3461"><td class="num" id="LN3461">3461</td><td class="line">	<span class='keyword'>if</span> (screen_ins_lines(0, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + wp-&gt;w_height - line_count,</td></tr>
<tr class="codeline" data-linenumber="3462"><td class="num" id="LN3462">3462</td><td class="line">			      line_count, (<span class='keyword'>int</span>)Rows, clear_attr, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) == <span class='macro'>FAIL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3463"><td class="num" id="LN3463">3463</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3464"><td class="num" id="LN3464">3464</td><td class="line">	    wp-&gt;w_redr_status = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3465"><td class="num" id="LN3465">3465</td><td class="line">	    win_rest_invalid(wp-&gt;w_next);</td></tr>
<tr class="codeline" data-linenumber="3466"><td class="num" id="LN3466">3466</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3467"><td class="num" id="LN3467">3467</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3468"><td class="num" id="LN3468">3468</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3469"><td class="num" id="LN3469">3469</td><td class="line">     <span class='comment'>* If this is the last window and there is no status line, redraw the</span></td></tr>
<tr class="codeline" data-linenumber="3470"><td class="num" id="LN3470">3470</td><td class="line">     <span class='comment'>* command line later.</span></td></tr>
<tr class="codeline" data-linenumber="3471"><td class="num" id="LN3471">3471</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3472"><td class="num" id="LN3472">3472</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3473"><td class="num" id="LN3473">3473</td><td class="line">	redraw_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3474"><td class="num" id="LN3474">3474</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>OK<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3475"><td class="num" id="LN3475">3475</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3476"><td class="num" id="LN3476">3476</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3477"><td class="num" id="LN3477">3477</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3478"><td class="num" id="LN3478">3478</td><td class="line"> <span class='comment'>* Common code for win_ins_lines() and win_del_lines().</span></td></tr>
<tr class="codeline" data-linenumber="3479"><td class="num" id="LN3479">3479</td><td class="line"> <span class='comment'>* Returns OK or FAIL when the work has been done.</span></td></tr>
<tr class="codeline" data-linenumber="3480"><td class="num" id="LN3480">3480</td><td class="line"> <span class='comment'>* Returns MAYBE when not finished yet.</span></td></tr>
<tr class="codeline" data-linenumber="3481"><td class="num" id="LN3481">3481</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3482"><td class="num" id="LN3482">3482</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="3483"><td class="num" id="LN3483">3483</td><td class="line">win_do_lines(</td></tr>
<tr class="codeline" data-linenumber="3484"><td class="num" id="LN3484">3484</td><td class="line">    win_T	*wp,</td></tr>
<tr class="codeline" data-linenumber="3485"><td class="num" id="LN3485">3485</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="3486"><td class="num" id="LN3486">3486</td><td class="line">    <span class='keyword'>int</span>		line_count,</td></tr>
<tr class="codeline" data-linenumber="3487"><td class="num" id="LN3487">3487</td><td class="line">    <span class='keyword'>int</span>		mayclear,</td></tr>
<tr class="codeline" data-linenumber="3488"><td class="num" id="LN3488">3488</td><td class="line">    <span class='keyword'>int</span>		del,</td></tr>
<tr class="codeline" data-linenumber="3489"><td class="num" id="LN3489">3489</td><td class="line">    <span class='keyword'>int</span>		clear_attr)</td></tr>
<tr class="codeline" data-linenumber="3490"><td class="num" id="LN3490">3490</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3491"><td class="num" id="LN3491">3491</td><td class="line">    <span class='keyword'>int</span>		retval;</td></tr>
<tr class="codeline" data-linenumber="3492"><td class="num" id="LN3492">3492</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3493"><td class="num" id="LN3493">3493</td><td class="line">    <span class='keyword'>if</span> (!redrawing() || line_count &lt;= 0)</td></tr>
<tr class="codeline" data-linenumber="3494"><td class="num" id="LN3494">3494</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3495"><td class="num" id="LN3495">3495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3496"><td class="num" id="LN3496">3496</td><td class="line">    <span class='comment'>// When inserting lines would result in loss of command output, just redraw</span></td></tr>
<tr class="codeline" data-linenumber="3497"><td class="num" id="LN3497">3497</td><td class="line">    <span class='comment'>// the lines.</span></td></tr>
<tr class="codeline" data-linenumber="3498"><td class="num" id="LN3498">3498</td><td class="line">    <span class='keyword'>if</span> (no_win_do_lines_ins &amp;&amp; !del)</td></tr>
<tr class="codeline" data-linenumber="3499"><td class="num" id="LN3499">3499</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3500"><td class="num" id="LN3500">3500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3501"><td class="num" id="LN3501">3501</td><td class="line">    <span class='comment'>// only a few lines left: redraw is faster</span></td></tr>
<tr class="codeline" data-linenumber="3502"><td class="num" id="LN3502">3502</td><td class="line">    <span class='keyword'>if</span> (mayclear &amp;&amp; Rows - line_count &lt; 5 &amp;&amp; wp-&gt;w_width == Columns)</td></tr>
<tr class="codeline" data-linenumber="3503"><td class="num" id="LN3503">3503</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3504"><td class="num" id="LN3504">3504</td><td class="line">	<span class='keyword'>if</span> (!no_win_do_lines_ins)</td></tr>
<tr class="codeline" data-linenumber="3505"><td class="num" id="LN3505">3505</td><td class="line">	    screenclear();	    <span class='comment'>// will set wp-&gt;w_lines_valid to 0</span></td></tr>
<tr class="codeline" data-linenumber="3506"><td class="num" id="LN3506">3506</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3507"><td class="num" id="LN3507">3507</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3508"><td class="num" id="LN3508">3508</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3509"><td class="num" id="LN3509">3509</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="3510"><td class="num" id="LN3510">3510</td><td class="line">    <span class='comment'>// this doesn't work when there are popups visible</span></td></tr>
<tr class="codeline" data-linenumber="3511"><td class="num" id="LN3511">3511</td><td class="line">    <span class='keyword'>if</span> (popup_visible)</td></tr>
<tr class="codeline" data-linenumber="3512"><td class="num" id="LN3512">3512</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3513"><td class="num" id="LN3513">3513</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3514"><td class="num" id="LN3514">3514</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3515"><td class="num" id="LN3515">3515</td><td class="line">    <span class='comment'>// Delete all remaining lines</span></td></tr>
<tr class="codeline" data-linenumber="3516"><td class="num" id="LN3516">3516</td><td class="line">    <span class='keyword'>if</span> (row + line_count &gt;= wp-&gt;w_height)</td></tr>
<tr class="codeline" data-linenumber="3517"><td class="num" id="LN3517">3517</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3518"><td class="num" id="LN3518">3518</td><td class="line">	screen_fill(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, <span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + wp-&gt;w_height,</td></tr>
<tr class="codeline" data-linenumber="3519"><td class="num" id="LN3519">3519</td><td class="line">		wp-&gt;w_wincol, (<span class='keyword'>int</span>)<span class='macro'>W_ENDCOL(wp)<span class='macro_popup'>(wp-&gt;w_wincol + wp-&gt;w_width)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="3520"><td class="num" id="LN3520">3520</td><td class="line">		' ', ' ', 0);</td></tr>
<tr class="codeline" data-linenumber="3521"><td class="num" id="LN3521">3521</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>OK<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3522"><td class="num" id="LN3522">3522</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3523"><td class="num" id="LN3523">3523</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3524"><td class="num" id="LN3524">3524</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3525"><td class="num" id="LN3525">3525</td><td class="line">     <span class='comment'>* When scrolling, the message on the command line should be cleared,</span></td></tr>
<tr class="codeline" data-linenumber="3526"><td class="num" id="LN3526">3526</td><td class="line">     <span class='comment'>* otherwise it will stay there forever.</span></td></tr>
<tr class="codeline" data-linenumber="3527"><td class="num" id="LN3527">3527</td><td class="line">     <span class='comment'>* Don't do this when avoiding to insert lines.</span></td></tr>
<tr class="codeline" data-linenumber="3528"><td class="num" id="LN3528">3528</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3529"><td class="num" id="LN3529">3529</td><td class="line">    <span class='keyword'>if</span> (!no_win_do_lines_ins)</td></tr>
<tr class="codeline" data-linenumber="3530"><td class="num" id="LN3530">3530</td><td class="line">	clear_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3531"><td class="num" id="LN3531">3531</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3532"><td class="num" id="LN3532">3532</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3533"><td class="num" id="LN3533">3533</td><td class="line">     <span class='comment'>* If the terminal can set a scroll region, use that.</span></td></tr>
<tr class="codeline" data-linenumber="3534"><td class="num" id="LN3534">3534</td><td class="line">     <span class='comment'>* Always do this in a vertically split window.  This will redraw from</span></td></tr>
<tr class="codeline" data-linenumber="3535"><td class="num" id="LN3535">3535</td><td class="line">     <span class='comment'>* ScreenLines[] when t_CV isn't defined.  That's faster than using</span></td></tr>
<tr class="codeline" data-linenumber="3536"><td class="num" id="LN3536">3536</td><td class="line">     <span class='comment'>* win_line().</span></td></tr>
<tr class="codeline" data-linenumber="3537"><td class="num" id="LN3537">3537</td><td class="line">     <span class='comment'>* Don't use a scroll region when we are going to redraw the text, writing</span></td></tr>
<tr class="codeline" data-linenumber="3538"><td class="num" id="LN3538">3538</td><td class="line">     <span class='comment'>* a character in the lower right corner of the scroll region may cause a</span></td></tr>
<tr class="codeline" data-linenumber="3539"><td class="num" id="LN3539">3539</td><td class="line">     <span class='comment'>* scroll-up .</span></td></tr>
<tr class="codeline" data-linenumber="3540"><td class="num" id="LN3540">3540</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3541"><td class="num" id="LN3541">3541</td><td class="line">    <span class='keyword'>if</span> (scroll_region || wp-&gt;w_width != Columns)</td></tr>
<tr class="codeline" data-linenumber="3542"><td class="num" id="LN3542">3542</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3543"><td class="num" id="LN3543">3543</td><td class="line">	<span class='keyword'>if</span> (scroll_region &amp;&amp; (wp-&gt;w_width == Columns || *<span class='macro'>T_CSV<span class='macro_popup'>(term_strings[(int)(KS_CSV)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3544"><td class="num" id="LN3544">3544</td><td class="line">	    scroll_region_set(wp, row);</td></tr>
<tr class="codeline" data-linenumber="3545"><td class="num" id="LN3545">3545</td><td class="line">	<span class='keyword'>if</span> (del)</td></tr>
<tr class="codeline" data-linenumber="3546"><td class="num" id="LN3546">3546</td><td class="line">	    retval = screen_del_lines(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, 0, line_count,</td></tr>
<tr class="codeline" data-linenumber="3547"><td class="num" id="LN3547">3547</td><td class="line">				    wp-&gt;w_height - row, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, clear_attr, wp);</td></tr>
<tr class="codeline" data-linenumber="3548"><td class="num" id="LN3548">3548</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3549"><td class="num" id="LN3549">3549</td><td class="line">	    retval = screen_ins_lines(<span class='macro'>W_WINROW(wp)<span class='macro_popup'>(wp-&gt;w_winrow + wp-&gt;w_winbar_height)</span></span> + row, 0, line_count,</td></tr>
<tr class="codeline" data-linenumber="3550"><td class="num" id="LN3550">3550</td><td class="line">					   wp-&gt;w_height - row, clear_attr, wp);</td></tr>
<tr class="codeline" data-linenumber="3551"><td class="num" id="LN3551">3551</td><td class="line">	<span class='keyword'>if</span> (scroll_region &amp;&amp; (wp-&gt;w_width == Columns || *<span class='macro'>T_CSV<span class='macro_popup'>(term_strings[(int)(KS_CSV)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3552"><td class="num" id="LN3552">3552</td><td class="line">	    scroll_region_reset();</td></tr>
<tr class="codeline" data-linenumber="3553"><td class="num" id="LN3553">3553</td><td class="line">	<span class='keyword'>return</span> retval;</td></tr>
<tr class="codeline" data-linenumber="3554"><td class="num" id="LN3554">3554</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3555"><td class="num" id="LN3555">3555</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3556"><td class="num" id="LN3556">3556</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;w_next != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; p_tf) <span class='comment'>// don't delete/insert on fast terminal</span></td></tr>
<tr class="codeline" data-linenumber="3557"><td class="num" id="LN3557">3557</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3558"><td class="num" id="LN3558">3558</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3559"><td class="num" id="LN3559">3559</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MAYBE<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3560"><td class="num" id="LN3560">3560</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3561"><td class="num" id="LN3561">3561</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3562"><td class="num" id="LN3562">3562</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3563"><td class="num" id="LN3563">3563</td><td class="line"> <span class='comment'>* window 'wp' and everything after it is messed up, mark it for redraw</span></td></tr>
<tr class="codeline" data-linenumber="3564"><td class="num" id="LN3564">3564</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3565"><td class="num" id="LN3565">3565</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3566"><td class="num" id="LN3566">3566</td><td class="line">win_rest_invalid(win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="3567"><td class="num" id="LN3567">3567</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3568"><td class="num" id="LN3568">3568</td><td class="line">    <span class='keyword'>while</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3569"><td class="num" id="LN3569">3569</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3570"><td class="num" id="LN3570">3570</td><td class="line">	redraw_win_later(wp, <span class='macro'>NOT_VALID<span class='macro_popup'>40</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3571"><td class="num" id="LN3571">3571</td><td class="line">	wp-&gt;w_redr_status = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3572"><td class="num" id="LN3572">3572</td><td class="line">	wp = wp-&gt;w_next;</td></tr>
<tr class="codeline" data-linenumber="3573"><td class="num" id="LN3573">3573</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3574"><td class="num" id="LN3574">3574</td><td class="line">    redraw_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3575"><td class="num" id="LN3575">3575</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3576"><td class="num" id="LN3576">3576</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3577"><td class="num" id="LN3577">3577</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3578"><td class="num" id="LN3578">3578</td><td class="line"> <span class='comment'>* The rest of the routines in this file perform screen manipulations. The</span></td></tr>
<tr class="codeline" data-linenumber="3579"><td class="num" id="LN3579">3579</td><td class="line"> <span class='comment'>* given operation is performed physically on the screen. The corresponding</span></td></tr>
<tr class="codeline" data-linenumber="3580"><td class="num" id="LN3580">3580</td><td class="line"> <span class='comment'>* change is also made to the internal screen image. In this way, the editor</span></td></tr>
<tr class="codeline" data-linenumber="3581"><td class="num" id="LN3581">3581</td><td class="line"> <span class='comment'>* anticipates the effect of editing changes on the appearance of the screen.</span></td></tr>
<tr class="codeline" data-linenumber="3582"><td class="num" id="LN3582">3582</td><td class="line"> <span class='comment'>* That way, when we call screenupdate a complete redraw isn't usually</span></td></tr>
<tr class="codeline" data-linenumber="3583"><td class="num" id="LN3583">3583</td><td class="line"> <span class='comment'>* necessary. Another advantage is that we can keep adding code to anticipate</span></td></tr>
<tr class="codeline" data-linenumber="3584"><td class="num" id="LN3584">3584</td><td class="line"> <span class='comment'>* screen changes, and in the meantime, everything still works.</span></td></tr>
<tr class="codeline" data-linenumber="3585"><td class="num" id="LN3585">3585</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3586"><td class="num" id="LN3586">3586</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3587"><td class="num" id="LN3587">3587</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3588"><td class="num" id="LN3588">3588</td><td class="line"> <span class='comment'>* types for inserting or deleting lines</span></td></tr>
<tr class="codeline" data-linenumber="3589"><td class="num" id="LN3589">3589</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3590"><td class="num" id="LN3590">3590</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_CAL<span class='macro_popup'>1</span></span>   1</span></td></tr>
<tr class="codeline" data-linenumber="3591"><td class="num" id="LN3591">3591</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span>   2</span></td></tr>
<tr class="codeline" data-linenumber="3592"><td class="num" id="LN3592">3592</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_AL<span class='macro_popup'>3</span></span>    3</span></td></tr>
<tr class="codeline" data-linenumber="3593"><td class="num" id="LN3593">3593</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_CE<span class='macro_popup'>4</span></span>    4</span></td></tr>
<tr class="codeline" data-linenumber="3594"><td class="num" id="LN3594">3594</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_DL<span class='macro_popup'>5</span></span>    5</span></td></tr>
<tr class="codeline" data-linenumber="3595"><td class="num" id="LN3595">3595</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_SR<span class='macro_popup'>6</span></span>    6</span></td></tr>
<tr class="codeline" data-linenumber="3596"><td class="num" id="LN3596">3596</td><td class="line"><span class='directive'>#define <span class='macro'>USE_NL<span class='macro_popup'>7</span></span>	    7</span></td></tr>
<tr class="codeline" data-linenumber="3597"><td class="num" id="LN3597">3597</td><td class="line"><span class='directive'>#define <span class='macro'>USE_T_CD<span class='macro_popup'>8</span></span>    8</span></td></tr>
<tr class="codeline" data-linenumber="3598"><td class="num" id="LN3598">3598</td><td class="line"><span class='directive'>#define <span class='macro'>USE_REDRAW<span class='macro_popup'>9</span></span>  9</span></td></tr>
<tr class="codeline" data-linenumber="3599"><td class="num" id="LN3599">3599</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3600"><td class="num" id="LN3600">3600</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3601"><td class="num" id="LN3601">3601</td><td class="line"> <span class='comment'>* insert lines on the screen and update ScreenLines[]</span></td></tr>
<tr class="codeline" data-linenumber="3602"><td class="num" id="LN3602">3602</td><td class="line"> <span class='comment'>* 'end' is the line after the scrolled part. Normally it is Rows.</span></td></tr>
<tr class="codeline" data-linenumber="3603"><td class="num" id="LN3603">3603</td><td class="line"> <span class='comment'>* When scrolling region used 'off' is the offset from the top for the region.</span></td></tr>
<tr class="codeline" data-linenumber="3604"><td class="num" id="LN3604">3604</td><td class="line"> <span class='comment'>* 'row' and 'end' are relative to the start of the region.</span></td></tr>
<tr class="codeline" data-linenumber="3605"><td class="num" id="LN3605">3605</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="3606"><td class="num" id="LN3606">3606</td><td class="line"> <span class='comment'>* return FAIL for failure, OK for success.</span></td></tr>
<tr class="codeline" data-linenumber="3607"><td class="num" id="LN3607">3607</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3608"><td class="num" id="LN3608">3608</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="3609"><td class="num" id="LN3609">3609</td><td class="line">screen_ins_lines(</td></tr>
<tr class="codeline" data-linenumber="3610"><td class="num" id="LN3610">3610</td><td class="line">    <span class='keyword'>int</span>		off,</td></tr>
<tr class="codeline" data-linenumber="3611"><td class="num" id="LN3611">3611</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="3612"><td class="num" id="LN3612">3612</td><td class="line">    <span class='keyword'>int</span>		line_count,</td></tr>
<tr class="codeline" data-linenumber="3613"><td class="num" id="LN3613">3613</td><td class="line">    <span class='keyword'>int</span>		end,</td></tr>
<tr class="codeline" data-linenumber="3614"><td class="num" id="LN3614">3614</td><td class="line">    <span class='keyword'>int</span>		clear_attr,</td></tr>
<tr class="codeline" data-linenumber="3615"><td class="num" id="LN3615">3615</td><td class="line">    win_T	*wp)	    <span class='comment'>// NULL or window to use width from</span></td></tr>
<tr class="codeline" data-linenumber="3616"><td class="num" id="LN3616">3616</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3617"><td class="num" id="LN3617">3617</td><td class="line">    <span class='keyword'>int</span>		i;</td></tr>
<tr class="codeline" data-linenumber="3618"><td class="num" id="LN3618">3618</td><td class="line">    <span class='keyword'>int</span>		j;</td></tr>
<tr class="codeline" data-linenumber="3619"><td class="num" id="LN3619">3619</td><td class="line">    <span class='keyword'>unsigned</span>	temp;</td></tr>
<tr class="codeline" data-linenumber="3620"><td class="num" id="LN3620">3620</td><td class="line">    <span class='keyword'>int</span>		cursor_row;</td></tr>
<tr class="codeline" data-linenumber="3621"><td class="num" id="LN3621">3621</td><td class="line">    <span class='keyword'>int</span>		cursor_col = 0;</td></tr>
<tr class="codeline" data-linenumber="3622"><td class="num" id="LN3622">3622</td><td class="line">    <span class='keyword'>int</span>		type;</td></tr>
<tr class="codeline" data-linenumber="3623"><td class="num" id="LN3623">3623</td><td class="line">    <span class='keyword'>int</span>		result_empty;</td></tr>
<tr class="codeline" data-linenumber="3624"><td class="num" id="LN3624">3624</td><td class="line">    <span class='keyword'>int</span>		can_ce = can_clear(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3625"><td class="num" id="LN3625">3625</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3626"><td class="num" id="LN3626">3626</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3627"><td class="num" id="LN3627">3627</td><td class="line">     <span class='comment'>* FAIL if</span></td></tr>
<tr class="codeline" data-linenumber="3628"><td class="num" id="LN3628">3628</td><td class="line">     <span class='comment'>* - there is no valid screen</span></td></tr>
<tr class="codeline" data-linenumber="3629"><td class="num" id="LN3629">3629</td><td class="line">     <span class='comment'>* - the screen has to be redrawn completely</span></td></tr>
<tr class="codeline" data-linenumber="3630"><td class="num" id="LN3630">3630</td><td class="line">     <span class='comment'>* - the line count is less than one</span></td></tr>
<tr class="codeline" data-linenumber="3631"><td class="num" id="LN3631">3631</td><td class="line">     <span class='comment'>* - the line count is more than 'ttyscroll'</span></td></tr>
<tr class="codeline" data-linenumber="3632"><td class="num" id="LN3632">3632</td><td class="line">     <span class='comment'>* - redrawing for a callback and there is a modeless selection</span></td></tr>
<tr class="codeline" data-linenumber="3633"><td class="num" id="LN3633">3633</td><td class="line">     <span class='comment'>* - there is a popup window</span></td></tr>
<tr class="codeline" data-linenumber="3634"><td class="num" id="LN3634">3634</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3635"><td class="num" id="LN3635">3635</td><td class="line">     <span class='keyword'>if</span> (!screen_valid(<span class='macro'>TRUE<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3636"><td class="num" id="LN3636">3636</td><td class="line">	     || line_count &lt;= 0 || line_count &gt; p_ttyscroll</td></tr>
<tr class="codeline" data-linenumber="3637"><td class="num" id="LN3637">3637</td><td class="line"><span class='directive'>#ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="3638"><td class="num" id="LN3638">3638</td><td class="line">	     || (clip_star.state != <span class='macro'>SELECT_CLEARED<span class='macro_popup'>0</span></span></td></tr>
<tr class="codeline" data-linenumber="3639"><td class="num" id="LN3639">3639</td><td class="line">						 &amp;&amp; redrawing_for_callback &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3640"><td class="num" id="LN3640">3640</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3641"><td class="num" id="LN3641">3641</td><td class="line"><span class='directive'>#ifdef FEAT_PROP_POPUP</span></td></tr>
<tr class="codeline" data-linenumber="3642"><td class="num" id="LN3642">3642</td><td class="line">	     || popup_visible</td></tr>
<tr class="codeline" data-linenumber="3643"><td class="num" id="LN3643">3643</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3644"><td class="num" id="LN3644">3644</td><td class="line">	     )</td></tr>
<tr class="codeline" data-linenumber="3645"><td class="num" id="LN3645">3645</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3646"><td class="num" id="LN3646">3646</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3647"><td class="num" id="LN3647">3647</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3648"><td class="num" id="LN3648">3648</td><td class="line">     <span class='comment'>* There are seven ways to insert lines:</span></td></tr>
<tr class="codeline" data-linenumber="3649"><td class="num" id="LN3649">3649</td><td class="line">     <span class='comment'>* 0. When in a vertically split window and t_CV isn't set, redraw the</span></td></tr>
<tr class="codeline" data-linenumber="3650"><td class="num" id="LN3650">3650</td><td class="line">     <span class='comment'>*    characters from ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3651"><td class="num" id="LN3651">3651</td><td class="line">     <span class='comment'>* 1. Use T_CD (clear to end of display) if it exists and the result of</span></td></tr>
<tr class="codeline" data-linenumber="3652"><td class="num" id="LN3652">3652</td><td class="line">     <span class='comment'>*	  the insert is just empty lines</span></td></tr>
<tr class="codeline" data-linenumber="3653"><td class="num" id="LN3653">3653</td><td class="line">     <span class='comment'>* 2. Use T_CAL (insert multiple lines) if it exists and T_AL is not</span></td></tr>
<tr class="codeline" data-linenumber="3654"><td class="num" id="LN3654">3654</td><td class="line">     <span class='comment'>*	  present or line_count &gt; 1. It looks better if we do all the inserts</span></td></tr>
<tr class="codeline" data-linenumber="3655"><td class="num" id="LN3655">3655</td><td class="line">     <span class='comment'>*	  at once.</span></td></tr>
<tr class="codeline" data-linenumber="3656"><td class="num" id="LN3656">3656</td><td class="line">     <span class='comment'>* 3. Use T_CDL (delete multiple lines) if it exists and the result of the</span></td></tr>
<tr class="codeline" data-linenumber="3657"><td class="num" id="LN3657">3657</td><td class="line">     <span class='comment'>*	  insert is just empty lines and T_CE is not present or line_count &gt;</span></td></tr>
<tr class="codeline" data-linenumber="3658"><td class="num" id="LN3658">3658</td><td class="line">     <span class='comment'>*	  1.</span></td></tr>
<tr class="codeline" data-linenumber="3659"><td class="num" id="LN3659">3659</td><td class="line">     <span class='comment'>* 4. Use T_AL (insert line) if it exists.</span></td></tr>
<tr class="codeline" data-linenumber="3660"><td class="num" id="LN3660">3660</td><td class="line">     <span class='comment'>* 5. Use T_CE (erase line) if it exists and the result of the insert is</span></td></tr>
<tr class="codeline" data-linenumber="3661"><td class="num" id="LN3661">3661</td><td class="line">     <span class='comment'>*	  just empty lines.</span></td></tr>
<tr class="codeline" data-linenumber="3662"><td class="num" id="LN3662">3662</td><td class="line">     <span class='comment'>* 6. Use T_DL (delete line) if it exists and the result of the insert is</span></td></tr>
<tr class="codeline" data-linenumber="3663"><td class="num" id="LN3663">3663</td><td class="line">     <span class='comment'>*	  just empty lines.</span></td></tr>
<tr class="codeline" data-linenumber="3664"><td class="num" id="LN3664">3664</td><td class="line">     <span class='comment'>* 7. Use T_SR (scroll reverse) if it exists and inserting at row 0 and</span></td></tr>
<tr class="codeline" data-linenumber="3665"><td class="num" id="LN3665">3665</td><td class="line">     <span class='comment'>*	  the 'da' flag is not set or we have clear line capability.</span></td></tr>
<tr class="codeline" data-linenumber="3666"><td class="num" id="LN3666">3666</td><td class="line">     <span class='comment'>* 8. redraw the characters from ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3667"><td class="num" id="LN3667">3667</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="3668"><td class="num" id="LN3668">3668</td><td class="line">     <span class='comment'>* Careful: In a hpterm scroll reverse doesn't work as expected, it moves</span></td></tr>
<tr class="codeline" data-linenumber="3669"><td class="num" id="LN3669">3669</td><td class="line">     <span class='comment'>* the scrollbar for the window. It does have insert line, use that if it</span></td></tr>
<tr class="codeline" data-linenumber="3670"><td class="num" id="LN3670">3670</td><td class="line">     <span class='comment'>* exists.</span></td></tr>
<tr class="codeline" data-linenumber="3671"><td class="num" id="LN3671">3671</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3672"><td class="num" id="LN3672">3672</td><td class="line">    result_empty = (row + line_count &gt;= end);</td></tr>
<tr class="codeline" data-linenumber="3673"><td class="num" id="LN3673">3673</td><td class="line">    <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_width != Columns &amp;&amp; *<span class='macro'>T_CSV<span class='macro_popup'>(term_strings[(int)(KS_CSV)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3674"><td class="num" id="LN3674">3674</td><td class="line">	type = <span class='macro'>USE_REDRAW<span class='macro_popup'>9</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3675"><td class="num" id="LN3675">3675</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (can_clear(<span class='macro'>T_CD<span class='macro_popup'>(term_strings[(int)(KS_CD)])</span></span>) &amp;&amp; result_empty)</td></tr>
<tr class="codeline" data-linenumber="3676"><td class="num" id="LN3676">3676</td><td class="line">	type = <span class='macro'>USE_T_CD<span class='macro_popup'>8</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3677"><td class="num" id="LN3677">3677</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_CAL<span class='macro_popup'>(term_strings[(int)(KS_CAL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; (line_count &gt; 1 || *<span class='macro'>T_AL<span class='macro_popup'>(term_strings[(int)(KS_AL)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3678"><td class="num" id="LN3678">3678</td><td class="line">	type = <span class='macro'>USE_T_CAL<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3679"><td class="num" id="LN3679">3679</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_CDL<span class='macro_popup'>(term_strings[(int)(KS_CDL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; result_empty &amp;&amp; (line_count &gt; 1 || !can_ce))</td></tr>
<tr class="codeline" data-linenumber="3680"><td class="num" id="LN3680">3680</td><td class="line">	type = <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3681"><td class="num" id="LN3681">3681</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_AL<span class='macro_popup'>(term_strings[(int)(KS_AL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3682"><td class="num" id="LN3682">3682</td><td class="line">	type = <span class='macro'>USE_T_AL<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3683"><td class="num" id="LN3683">3683</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (can_ce &amp;&amp; result_empty)</td></tr>
<tr class="codeline" data-linenumber="3684"><td class="num" id="LN3684">3684</td><td class="line">	type = <span class='macro'>USE_T_CE<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3685"><td class="num" id="LN3685">3685</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_DL<span class='macro_popup'>(term_strings[(int)(KS_DL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; result_empty)</td></tr>
<tr class="codeline" data-linenumber="3686"><td class="num" id="LN3686">3686</td><td class="line">	type = <span class='macro'>USE_T_DL<span class='macro_popup'>5</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3687"><td class="num" id="LN3687">3687</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_SR<span class='macro_popup'>(term_strings[(int)(KS_SR)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; row == 0 &amp;&amp; (*<span class='macro'>T_DA<span class='macro_popup'>(term_strings[(int)(KS_DA)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> || can_ce))</td></tr>
<tr class="codeline" data-linenumber="3688"><td class="num" id="LN3688">3688</td><td class="line">	type = <span class='macro'>USE_T_SR<span class='macro_popup'>6</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3689"><td class="num" id="LN3689">3689</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3690"><td class="num" id="LN3690">3690</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3691"><td class="num" id="LN3691">3691</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3692"><td class="num" id="LN3692">3692</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3693"><td class="num" id="LN3693">3693</td><td class="line">     <span class='comment'>* For clearing the lines screen_del_lines() is used. This will also take</span></td></tr>
<tr class="codeline" data-linenumber="3694"><td class="num" id="LN3694">3694</td><td class="line">     <span class='comment'>* care of t_db if necessary.</span></td></tr>
<tr class="codeline" data-linenumber="3695"><td class="num" id="LN3695">3695</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3696"><td class="num" id="LN3696">3696</td><td class="line">    <span class='keyword'>if</span> (type == <span class='macro'>USE_T_CD<span class='macro_popup'>8</span></span> || type == <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="3697"><td class="num" id="LN3697">3697</td><td class="line">					 type == <span class='macro'>USE_T_CE<span class='macro_popup'>4</span></span> || type == <span class='macro'>USE_T_DL<span class='macro_popup'>5</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3698"><td class="num" id="LN3698">3698</td><td class="line">	<span class='keyword'>return</span> screen_del_lines(off, row, line_count, end, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, 0, wp);</td></tr>
<tr class="codeline" data-linenumber="3699"><td class="num" id="LN3699">3699</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3700"><td class="num" id="LN3700">3700</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3701"><td class="num" id="LN3701">3701</td><td class="line">     <span class='comment'>* If text is retained below the screen, first clear or delete as many</span></td></tr>
<tr class="codeline" data-linenumber="3702"><td class="num" id="LN3702">3702</td><td class="line">     <span class='comment'>* lines at the bottom of the window as are about to be inserted so that</span></td></tr>
<tr class="codeline" data-linenumber="3703"><td class="num" id="LN3703">3703</td><td class="line">     <span class='comment'>* the deleted lines won't later surface during a screen_del_lines.</span></td></tr>
<tr class="codeline" data-linenumber="3704"><td class="num" id="LN3704">3704</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3705"><td class="num" id="LN3705">3705</td><td class="line">    <span class='keyword'>if</span> (*<span class='macro'>T_DB<span class='macro_popup'>(term_strings[(int)(KS_DB)])</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3706"><td class="num" id="LN3706">3706</td><td class="line">	screen_del_lines(off, end - line_count, line_count, end, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>, 0, wp);</td></tr>
<tr class="codeline" data-linenumber="3707"><td class="num" id="LN3707">3707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3708"><td class="num" id="LN3708">3708</td><td class="line"><span class='directive'>#ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="3709"><td class="num" id="LN3709">3709</td><td class="line">    <span class='comment'>// Remove a modeless selection when inserting lines halfway the screen</span></td></tr>
<tr class="codeline" data-linenumber="3710"><td class="num" id="LN3710">3710</td><td class="line">    <span class='comment'>// or not the full width of the screen.</span></td></tr>
<tr class="codeline" data-linenumber="3711"><td class="num" id="LN3711">3711</td><td class="line">    <span class='keyword'>if</span> (off + row &gt; 0 || (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_width != Columns))</td></tr>
<tr class="codeline" data-linenumber="3712"><td class="num" id="LN3712">3712</td><td class="line">	clip_clear_selection(&amp;clip_star);</td></tr>
<tr class="codeline" data-linenumber="3713"><td class="num" id="LN3713">3713</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3714"><td class="num" id="LN3714">3714</td><td class="line">	clip_scroll_selection(-line_count);</td></tr>
<tr class="codeline" data-linenumber="3715"><td class="num" id="LN3715">3715</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3716"><td class="num" id="LN3716">3716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3717"><td class="num" id="LN3717">3717</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_HAIKU</span></td></tr>
<tr class="codeline" data-linenumber="3718"><td class="num" id="LN3718">3718</td><td class="line">    vim_lock_screen();</td></tr>
<tr class="codeline" data-linenumber="3719"><td class="num" id="LN3719">3719</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3720"><td class="num" id="LN3720">3720</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3721"><td class="num" id="LN3721">3721</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="3722"><td class="num" id="LN3722">3722</td><td class="line">    <span class='comment'>// Don't update the GUI cursor here, ScreenLines[] is invalid until the</span></td></tr>
<tr class="codeline" data-linenumber="3723"><td class="num" id="LN3723">3723</td><td class="line">    <span class='comment'>// scrolling is actually carried out.</span></td></tr>
<tr class="codeline" data-linenumber="3724"><td class="num" id="LN3724">3724</td><td class="line">    gui_dont_update_cursor(row + off &lt;= gui.cursor_row);</td></tr>
<tr class="codeline" data-linenumber="3725"><td class="num" id="LN3725">3725</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3726"><td class="num" id="LN3726">3726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3727"><td class="num" id="LN3727">3727</td><td class="line">    <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_wincol != 0 &amp;&amp; *<span class='macro'>T_CSV<span class='macro_popup'>(term_strings[(int)(KS_CSV)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; *<span class='macro'>T_CCS<span class='macro_popup'>(term_strings[(int)(KS_CCS)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3728"><td class="num" id="LN3728">3728</td><td class="line">	cursor_col = wp-&gt;w_wincol;</td></tr>
<tr class="codeline" data-linenumber="3729"><td class="num" id="LN3729">3729</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3730"><td class="num" id="LN3730">3730</td><td class="line">    <span class='keyword'>if</span> (*<span class='macro'>T_CCS<span class='macro_popup'>(term_strings[(int)(KS_CCS)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	   <span class='comment'>// cursor relative to region</span></td></tr>
<tr class="codeline" data-linenumber="3731"><td class="num" id="LN3731">3731</td><td class="line">	cursor_row = row;</td></tr>
<tr class="codeline" data-linenumber="3732"><td class="num" id="LN3732">3732</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3733"><td class="num" id="LN3733">3733</td><td class="line">	cursor_row = row + off;</td></tr>
<tr class="codeline" data-linenumber="3734"><td class="num" id="LN3734">3734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3735"><td class="num" id="LN3735">3735</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3736"><td class="num" id="LN3736">3736</td><td class="line">     <span class='comment'>* Shift LineOffset[] line_count down to reflect the inserted lines.</span></td></tr>
<tr class="codeline" data-linenumber="3737"><td class="num" id="LN3737">3737</td><td class="line">     <span class='comment'>* Clear the inserted lines in ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3738"><td class="num" id="LN3738">3738</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3739"><td class="num" id="LN3739">3739</td><td class="line">    row += off;</td></tr>
<tr class="codeline" data-linenumber="3740"><td class="num" id="LN3740">3740</td><td class="line">    end += off;</td></tr>
<tr class="codeline" data-linenumber="3741"><td class="num" id="LN3741">3741</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; line_count; ++i)</td></tr>
<tr class="codeline" data-linenumber="3742"><td class="num" id="LN3742">3742</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3743"><td class="num" id="LN3743">3743</td><td class="line">	<span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_width != Columns)</td></tr>
<tr class="codeline" data-linenumber="3744"><td class="num" id="LN3744">3744</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3745"><td class="num" id="LN3745">3745</td><td class="line">	    <span class='comment'>// need to copy part of a line</span></td></tr>
<tr class="codeline" data-linenumber="3746"><td class="num" id="LN3746">3746</td><td class="line">	    j = end - 1 - i;</td></tr>
<tr class="codeline" data-linenumber="3747"><td class="num" id="LN3747">3747</td><td class="line">	    <span class='keyword'>while</span> ((j -= line_count) &gt;= row)</td></tr>
<tr class="codeline" data-linenumber="3748"><td class="num" id="LN3748">3748</td><td class="line">		linecopy(j + line_count, j, wp);</td></tr>
<tr class="codeline" data-linenumber="3749"><td class="num" id="LN3749">3749</td><td class="line">	    j += line_count;</td></tr>
<tr class="codeline" data-linenumber="3750"><td class="num" id="LN3750">3750</td><td class="line">	    <span class='keyword'>if</span> (can_clear((char_u *)<span class='string_literal'>" "</span>))</td></tr>
<tr class="codeline" data-linenumber="3751"><td class="num" id="LN3751">3751</td><td class="line">		lineclear(LineOffset[j] + wp-&gt;w_wincol, wp-&gt;w_width,</td></tr>
<tr class="codeline" data-linenumber="3752"><td class="num" id="LN3752">3752</td><td class="line">								   clear_attr);</td></tr>
<tr class="codeline" data-linenumber="3753"><td class="num" id="LN3753">3753</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3754"><td class="num" id="LN3754">3754</td><td class="line">		lineinvalid(LineOffset[j] + wp-&gt;w_wincol, wp-&gt;w_width);</td></tr>
<tr class="codeline" data-linenumber="3755"><td class="num" id="LN3755">3755</td><td class="line">	    LineWraps[j] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3756"><td class="num" id="LN3756">3756</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3757"><td class="num" id="LN3757">3757</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3758"><td class="num" id="LN3758">3758</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3759"><td class="num" id="LN3759">3759</td><td class="line">	    j = end - 1 - i;</td></tr>
<tr class="codeline" data-linenumber="3760"><td class="num" id="LN3760">3760</td><td class="line">	    temp = LineOffset[j];</td></tr>
<tr class="codeline" data-linenumber="3761"><td class="num" id="LN3761">3761</td><td class="line">	    <span class='keyword'>while</span> ((j -= line_count) &gt;= row)</td></tr>
<tr class="codeline" data-linenumber="3762"><td class="num" id="LN3762">3762</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3763"><td class="num" id="LN3763">3763</td><td class="line">		LineOffset[j + line_count] = LineOffset[j];</td></tr>
<tr class="codeline" data-linenumber="3764"><td class="num" id="LN3764">3764</td><td class="line">		LineWraps[j + line_count] = LineWraps[j];</td></tr>
<tr class="codeline" data-linenumber="3765"><td class="num" id="LN3765">3765</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3766"><td class="num" id="LN3766">3766</td><td class="line">	    LineOffset[j + line_count] = temp;</td></tr>
<tr class="codeline" data-linenumber="3767"><td class="num" id="LN3767">3767</td><td class="line">	    LineWraps[j + line_count] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3768"><td class="num" id="LN3768">3768</td><td class="line">	    <span class='keyword'>if</span> (can_clear((char_u *)<span class='string_literal'>" "</span>))</td></tr>
<tr class="codeline" data-linenumber="3769"><td class="num" id="LN3769">3769</td><td class="line">		lineclear(temp, (<span class='keyword'>int</span>)Columns, clear_attr);</td></tr>
<tr class="codeline" data-linenumber="3770"><td class="num" id="LN3770">3770</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3771"><td class="num" id="LN3771">3771</td><td class="line">		lineinvalid(temp, (<span class='keyword'>int</span>)Columns);</td></tr>
<tr class="codeline" data-linenumber="3772"><td class="num" id="LN3772">3772</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3773"><td class="num" id="LN3773">3773</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3774"><td class="num" id="LN3774">3774</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3775"><td class="num" id="LN3775">3775</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_HAIKU</span></td></tr>
<tr class="codeline" data-linenumber="3776"><td class="num" id="LN3776">3776</td><td class="line">    vim_unlock_screen();</td></tr>
<tr class="codeline" data-linenumber="3777"><td class="num" id="LN3777">3777</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3778"><td class="num" id="LN3778">3778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3779"><td class="num" id="LN3779">3779</td><td class="line">    screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="3780"><td class="num" id="LN3780">3780</td><td class="line">    windgoto(cursor_row, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="3781"><td class="num" id="LN3781">3781</td><td class="line">    <span class='keyword'>if</span> (clear_attr != 0)</td></tr>
<tr class="codeline" data-linenumber="3782"><td class="num" id="LN3782">3782</td><td class="line">	screen_start_highlight(clear_attr);</td></tr>
<tr class="codeline" data-linenumber="3783"><td class="num" id="LN3783">3783</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3784"><td class="num" id="LN3784">3784</td><td class="line">    <span class='comment'>// redraw the characters</span></td></tr>
<tr class="codeline" data-linenumber="3785"><td class="num" id="LN3785">3785</td><td class="line">    <span class='keyword'>if</span> (type == <span class='macro'>USE_REDRAW<span class='macro_popup'>9</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3786"><td class="num" id="LN3786">3786</td><td class="line">	redraw_block(row, end, wp);</td></tr>
<tr class="codeline" data-linenumber="3787"><td class="num" id="LN3787">3787</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (type == <span class='macro'>USE_T_CAL<span class='macro_popup'>1</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3788"><td class="num" id="LN3788">3788</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3789"><td class="num" id="LN3789">3789</td><td class="line">	term_append_lines(line_count);</td></tr>
<tr class="codeline" data-linenumber="3790"><td class="num" id="LN3790">3790</td><td class="line">	screen_start();		<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="3791"><td class="num" id="LN3791">3791</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3792"><td class="num" id="LN3792">3792</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3793"><td class="num" id="LN3793">3793</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3794"><td class="num" id="LN3794">3794</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; line_count; i++)</td></tr>
<tr class="codeline" data-linenumber="3795"><td class="num" id="LN3795">3795</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3796"><td class="num" id="LN3796">3796</td><td class="line">	    <span class='keyword'>if</span> (type == <span class='macro'>USE_T_AL<span class='macro_popup'>3</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3797"><td class="num" id="LN3797">3797</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3798"><td class="num" id="LN3798">3798</td><td class="line">		<span class='keyword'>if</span> (i &amp;&amp; cursor_row != 0)</td></tr>
<tr class="codeline" data-linenumber="3799"><td class="num" id="LN3799">3799</td><td class="line">		    windgoto(cursor_row, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="3800"><td class="num" id="LN3800">3800</td><td class="line">		out_str(<span class='macro'>T_AL<span class='macro_popup'>(term_strings[(int)(KS_AL)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3801"><td class="num" id="LN3801">3801</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3802"><td class="num" id="LN3802">3802</td><td class="line">	    <span class='keyword'>else</span>  <span class='comment'>// type == USE_T_SR</span></td></tr>
<tr class="codeline" data-linenumber="3803"><td class="num" id="LN3803">3803</td><td class="line">		out_str(<span class='macro'>T_SR<span class='macro_popup'>(term_strings[(int)(KS_SR)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3804"><td class="num" id="LN3804">3804</td><td class="line">	    screen_start();	    <span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="3805"><td class="num" id="LN3805">3805</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3806"><td class="num" id="LN3806">3806</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3807"><td class="num" id="LN3807">3807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3808"><td class="num" id="LN3808">3808</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3809"><td class="num" id="LN3809">3809</td><td class="line">     <span class='comment'>* With scroll-reverse and 'da' flag set we need to clear the lines that</span></td></tr>
<tr class="codeline" data-linenumber="3810"><td class="num" id="LN3810">3810</td><td class="line">     <span class='comment'>* have been scrolled down into the region.</span></td></tr>
<tr class="codeline" data-linenumber="3811"><td class="num" id="LN3811">3811</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3812"><td class="num" id="LN3812">3812</td><td class="line">    <span class='keyword'>if</span> (type == <span class='macro'>USE_T_SR<span class='macro_popup'>6</span></span> &amp;&amp; *<span class='macro'>T_DA<span class='macro_popup'>(term_strings[(int)(KS_DA)])</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3813"><td class="num" id="LN3813">3813</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3814"><td class="num" id="LN3814">3814</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; line_count; ++i)</td></tr>
<tr class="codeline" data-linenumber="3815"><td class="num" id="LN3815">3815</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3816"><td class="num" id="LN3816">3816</td><td class="line">	    windgoto(off + i, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="3817"><td class="num" id="LN3817">3817</td><td class="line">	    out_str(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3818"><td class="num" id="LN3818">3818</td><td class="line">	    screen_start();	    <span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="3819"><td class="num" id="LN3819">3819</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3820"><td class="num" id="LN3820">3820</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3821"><td class="num" id="LN3821">3821</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3822"><td class="num" id="LN3822">3822</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="3823"><td class="num" id="LN3823">3823</td><td class="line">    gui_can_update_cursor();</td></tr>
<tr class="codeline" data-linenumber="3824"><td class="num" id="LN3824">3824</td><td class="line">    <span class='keyword'>if</span> (gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="3825"><td class="num" id="LN3825">3825</td><td class="line">	out_flush();	<span class='comment'>// always flush after a scroll</span></td></tr>
<tr class="codeline" data-linenumber="3826"><td class="num" id="LN3826">3826</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3827"><td class="num" id="LN3827">3827</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>OK<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3828"><td class="num" id="LN3828">3828</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3829"><td class="num" id="LN3829">3829</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3830"><td class="num" id="LN3830">3830</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3831"><td class="num" id="LN3831">3831</td><td class="line"> <span class='comment'>* Delete lines on the screen and update ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3832"><td class="num" id="LN3832">3832</td><td class="line"> <span class='comment'>* "end" is the line after the scrolled part. Normally it is Rows.</span></td></tr>
<tr class="codeline" data-linenumber="3833"><td class="num" id="LN3833">3833</td><td class="line"> <span class='comment'>* When scrolling region used "off" is the offset from the top for the region.</span></td></tr>
<tr class="codeline" data-linenumber="3834"><td class="num" id="LN3834">3834</td><td class="line"> <span class='comment'>* "row" and "end" are relative to the start of the region.</span></td></tr>
<tr class="codeline" data-linenumber="3835"><td class="num" id="LN3835">3835</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="3836"><td class="num" id="LN3836">3836</td><td class="line"> <span class='comment'>* Return OK for success, FAIL if the lines are not deleted.</span></td></tr>
<tr class="codeline" data-linenumber="3837"><td class="num" id="LN3837">3837</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3838"><td class="num" id="LN3838">3838</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="3839"><td class="num" id="LN3839">3839</td><td class="line">screen_del_lines(</td></tr>
<tr class="codeline" data-linenumber="3840"><td class="num" id="LN3840">3840</td><td class="line">    <span class='keyword'>int</span>		off,</td></tr>
<tr class="codeline" data-linenumber="3841"><td class="num" id="LN3841">3841</td><td class="line">    <span class='keyword'>int</span>		row,</td></tr>
<tr class="codeline" data-linenumber="3842"><td class="num" id="LN3842">3842</td><td class="line">    <span class='keyword'>int</span>		line_count,</td></tr>
<tr class="codeline" data-linenumber="3843"><td class="num" id="LN3843">3843</td><td class="line">    <span class='keyword'>int</span>		end,</td></tr>
<tr class="codeline" data-linenumber="3844"><td class="num" id="LN3844">3844</td><td class="line">    <span class='keyword'>int</span>		force,		<span class='comment'>// even when line_count &gt; p_ttyscroll</span></td></tr>
<tr class="codeline" data-linenumber="3845"><td class="num" id="LN3845">3845</td><td class="line">    <span class='keyword'>int</span>		clear_attr,	<span class='comment'>// used for clearing lines</span></td></tr>
<tr class="codeline" data-linenumber="3846"><td class="num" id="LN3846">3846</td><td class="line">    win_T	*wp <span class='macro'>UNUSED<span class='macro_popup'>__attribute__((unused))</span></span>)	<span class='comment'>// NULL or window to use width from</span></td></tr>
<tr class="codeline" data-linenumber="3847"><td class="num" id="LN3847">3847</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3848"><td class="num" id="LN3848">3848</td><td class="line">    <span class='keyword'>int</span>		j;</td></tr>
<tr class="codeline" data-linenumber="3849"><td class="num" id="LN3849">3849</td><td class="line">    <span class='keyword'>int</span>		i;</td></tr>
<tr class="codeline" data-linenumber="3850"><td class="num" id="LN3850">3850</td><td class="line">    <span class='keyword'>unsigned</span>	temp;</td></tr>
<tr class="codeline" data-linenumber="3851"><td class="num" id="LN3851">3851</td><td class="line">    <span class='keyword'>int</span>		cursor_row;</td></tr>
<tr class="codeline" data-linenumber="3852"><td class="num" id="LN3852">3852</td><td class="line">    <span class='keyword'>int</span>		cursor_col = 0;</td></tr>
<tr class="codeline" data-linenumber="3853"><td class="num" id="LN3853">3853</td><td class="line">    <span class='keyword'>int</span>		cursor_end;</td></tr>
<tr class="codeline" data-linenumber="3854"><td class="num" id="LN3854">3854</td><td class="line">    <span class='keyword'>int</span>		result_empty;	<span class='comment'>// result is empty until end of region</span></td></tr>
<tr class="codeline" data-linenumber="3855"><td class="num" id="LN3855">3855</td><td class="line">    <span class='keyword'>int</span>		can_delete;	<span class='comment'>// deleting line codes can be used</span></td></tr>
<tr class="codeline" data-linenumber="3856"><td class="num" id="LN3856">3856</td><td class="line">    <span class='keyword'>int</span>		type;</td></tr>
<tr class="codeline" data-linenumber="3857"><td class="num" id="LN3857">3857</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3858"><td class="num" id="LN3858">3858</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3859"><td class="num" id="LN3859">3859</td><td class="line">     <span class='comment'>* FAIL if</span></td></tr>
<tr class="codeline" data-linenumber="3860"><td class="num" id="LN3860">3860</td><td class="line">     <span class='comment'>* - there is no valid screen</span></td></tr>
<tr class="codeline" data-linenumber="3861"><td class="num" id="LN3861">3861</td><td class="line">     <span class='comment'>* - the screen has to be redrawn completely</span></td></tr>
<tr class="codeline" data-linenumber="3862"><td class="num" id="LN3862">3862</td><td class="line">     <span class='comment'>* - the line count is less than one</span></td></tr>
<tr class="codeline" data-linenumber="3863"><td class="num" id="LN3863">3863</td><td class="line">     <span class='comment'>* - the line count is more than 'ttyscroll'</span></td></tr>
<tr class="codeline" data-linenumber="3864"><td class="num" id="LN3864">3864</td><td class="line">     <span class='comment'>* - redrawing for a callback and there is a modeless selection</span></td></tr>
<tr class="codeline" data-linenumber="3865"><td class="num" id="LN3865">3865</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3866"><td class="num" id="LN3866">3866</td><td class="line">    <span class='keyword'>if</span> (!screen_valid(<span class='macro'>TRUE<span class='macro_popup'>1</span></span>) || line_count &lt;= 0</td></tr>
<tr class="codeline" data-linenumber="3867"><td class="num" id="LN3867">3867</td><td class="line">					|| (!force &amp;&amp; line_count &gt; p_ttyscroll)</td></tr>
<tr class="codeline" data-linenumber="3868"><td class="num" id="LN3868">3868</td><td class="line"><span class='directive'>#ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="3869"><td class="num" id="LN3869">3869</td><td class="line">	     || (clip_star.state != <span class='macro'>SELECT_CLEARED<span class='macro_popup'>0</span></span></td></tr>
<tr class="codeline" data-linenumber="3870"><td class="num" id="LN3870">3870</td><td class="line">						 &amp;&amp; redrawing_for_callback &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3871"><td class="num" id="LN3871">3871</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3872"><td class="num" id="LN3872">3872</td><td class="line">       )</td></tr>
<tr class="codeline" data-linenumber="3873"><td class="num" id="LN3873">3873</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3874"><td class="num" id="LN3874">3874</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3875"><td class="num" id="LN3875">3875</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3876"><td class="num" id="LN3876">3876</td><td class="line">     <span class='comment'>* Check if the rest of the current region will become empty.</span></td></tr>
<tr class="codeline" data-linenumber="3877"><td class="num" id="LN3877">3877</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3878"><td class="num" id="LN3878">3878</td><td class="line">    result_empty = row + line_count &gt;= end;</td></tr>
<tr class="codeline" data-linenumber="3879"><td class="num" id="LN3879">3879</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3880"><td class="num" id="LN3880">3880</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3881"><td class="num" id="LN3881">3881</td><td class="line">     <span class='comment'>* We can delete lines only when 'db' flag not set or when 'ce' option</span></td></tr>
<tr class="codeline" data-linenumber="3882"><td class="num" id="LN3882">3882</td><td class="line">     <span class='comment'>* available.</span></td></tr>
<tr class="codeline" data-linenumber="3883"><td class="num" id="LN3883">3883</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3884"><td class="num" id="LN3884">3884</td><td class="line">    can_delete = (*<span class='macro'>T_DB<span class='macro_popup'>(term_strings[(int)(KS_DB)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> || can_clear(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>));</td></tr>
<tr class="codeline" data-linenumber="3885"><td class="num" id="LN3885">3885</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3886"><td class="num" id="LN3886">3886</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3887"><td class="num" id="LN3887">3887</td><td class="line">     <span class='comment'>* There are six ways to delete lines:</span></td></tr>
<tr class="codeline" data-linenumber="3888"><td class="num" id="LN3888">3888</td><td class="line">     <span class='comment'>* 0. When in a vertically split window and t_CV isn't set, redraw the</span></td></tr>
<tr class="codeline" data-linenumber="3889"><td class="num" id="LN3889">3889</td><td class="line">     <span class='comment'>*    characters from ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3890"><td class="num" id="LN3890">3890</td><td class="line">     <span class='comment'>* 1. Use T_CD if it exists and the result is empty.</span></td></tr>
<tr class="codeline" data-linenumber="3891"><td class="num" id="LN3891">3891</td><td class="line">     <span class='comment'>* 2. Use newlines if row == 0 and count == 1 or T_CDL does not exist.</span></td></tr>
<tr class="codeline" data-linenumber="3892"><td class="num" id="LN3892">3892</td><td class="line">     <span class='comment'>* 3. Use T_CDL (delete multiple lines) if it exists and line_count &gt; 1 or</span></td></tr>
<tr class="codeline" data-linenumber="3893"><td class="num" id="LN3893">3893</td><td class="line">     <span class='comment'>*	  none of the other ways work.</span></td></tr>
<tr class="codeline" data-linenumber="3894"><td class="num" id="LN3894">3894</td><td class="line">     <span class='comment'>* 4. Use T_CE (erase line) if the result is empty.</span></td></tr>
<tr class="codeline" data-linenumber="3895"><td class="num" id="LN3895">3895</td><td class="line">     <span class='comment'>* 5. Use T_DL (delete line) if it exists.</span></td></tr>
<tr class="codeline" data-linenumber="3896"><td class="num" id="LN3896">3896</td><td class="line">     <span class='comment'>* 6. redraw the characters from ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3897"><td class="num" id="LN3897">3897</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3898"><td class="num" id="LN3898">3898</td><td class="line">    <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_width != Columns &amp;&amp; *<span class='macro'>T_CSV<span class='macro_popup'>(term_strings[(int)(KS_CSV)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3899"><td class="num" id="LN3899">3899</td><td class="line">	type = <span class='macro'>USE_REDRAW<span class='macro_popup'>9</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3900"><td class="num" id="LN3900">3900</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (can_clear(<span class='macro'>T_CD<span class='macro_popup'>(term_strings[(int)(KS_CD)])</span></span>) &amp;&amp; result_empty)</td></tr>
<tr class="codeline" data-linenumber="3901"><td class="num" id="LN3901">3901</td><td class="line">	type = <span class='macro'>USE_T_CD<span class='macro_popup'>8</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3902"><td class="num" id="LN3902">3902</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (row == 0 &amp;&amp; (</td></tr>
<tr class="codeline" data-linenumber="3903"><td class="num" id="LN3903">3903</td><td class="line"><span class='directive'>#ifndef AMIGA</span></td></tr>
<tr class="codeline" data-linenumber="3904"><td class="num" id="LN3904">3904</td><td class="line">	<span class='comment'>// On the Amiga, somehow '\n' on the last line doesn't always scroll</span></td></tr>
<tr class="codeline" data-linenumber="3905"><td class="num" id="LN3905">3905</td><td class="line">	<span class='comment'>// up, so use delete-line command</span></td></tr>
<tr class="codeline" data-linenumber="3906"><td class="num" id="LN3906">3906</td><td class="line">			    line_count == 1 ||</td></tr>
<tr class="codeline" data-linenumber="3907"><td class="num" id="LN3907">3907</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3908"><td class="num" id="LN3908">3908</td><td class="line">						*<span class='macro'>T_CDL<span class='macro_popup'>(term_strings[(int)(KS_CDL)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3909"><td class="num" id="LN3909">3909</td><td class="line">	type = <span class='macro'>USE_NL<span class='macro_popup'>7</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3910"><td class="num" id="LN3910">3910</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_CDL<span class='macro_popup'>(term_strings[(int)(KS_CDL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; line_count &gt; 1 &amp;&amp; can_delete)</td></tr>
<tr class="codeline" data-linenumber="3911"><td class="num" id="LN3911">3911</td><td class="line">	type = <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3912"><td class="num" id="LN3912">3912</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (can_clear(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>) &amp;&amp; result_empty</td></tr>
<tr class="codeline" data-linenumber="3913"><td class="num" id="LN3913">3913</td><td class="line">	    &amp;&amp; (wp == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || wp-&gt;w_width == Columns))</td></tr>
<tr class="codeline" data-linenumber="3914"><td class="num" id="LN3914">3914</td><td class="line">	type = <span class='macro'>USE_T_CE<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3915"><td class="num" id="LN3915">3915</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_DL<span class='macro_popup'>(term_strings[(int)(KS_DL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; can_delete)</td></tr>
<tr class="codeline" data-linenumber="3916"><td class="num" id="LN3916">3916</td><td class="line">	type = <span class='macro'>USE_T_DL<span class='macro_popup'>5</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3917"><td class="num" id="LN3917">3917</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (*<span class='macro'>T_CDL<span class='macro_popup'>(term_strings[(int)(KS_CDL)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; can_delete)</td></tr>
<tr class="codeline" data-linenumber="3918"><td class="num" id="LN3918">3918</td><td class="line">	type = <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3919"><td class="num" id="LN3919">3919</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3920"><td class="num" id="LN3920">3920</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>FAIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3921"><td class="num" id="LN3921">3921</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3922"><td class="num" id="LN3922">3922</td><td class="line"><span class='directive'>#ifdef FEAT_CLIPBOARD</span></td></tr>
<tr class="codeline" data-linenumber="3923"><td class="num" id="LN3923">3923</td><td class="line">    <span class='comment'>// Remove a modeless selection when deleting lines halfway the screen or</span></td></tr>
<tr class="codeline" data-linenumber="3924"><td class="num" id="LN3924">3924</td><td class="line">    <span class='comment'>// not the full width of the screen.</span></td></tr>
<tr class="codeline" data-linenumber="3925"><td class="num" id="LN3925">3925</td><td class="line">    <span class='keyword'>if</span> (off + row &gt; 0 || (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_width != Columns))</td></tr>
<tr class="codeline" data-linenumber="3926"><td class="num" id="LN3926">3926</td><td class="line">	clip_clear_selection(&amp;clip_star);</td></tr>
<tr class="codeline" data-linenumber="3927"><td class="num" id="LN3927">3927</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3928"><td class="num" id="LN3928">3928</td><td class="line">	clip_scroll_selection(line_count);</td></tr>
<tr class="codeline" data-linenumber="3929"><td class="num" id="LN3929">3929</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3930"><td class="num" id="LN3930">3930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3931"><td class="num" id="LN3931">3931</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_HAIKU</span></td></tr>
<tr class="codeline" data-linenumber="3932"><td class="num" id="LN3932">3932</td><td class="line">    vim_lock_screen();</td></tr>
<tr class="codeline" data-linenumber="3933"><td class="num" id="LN3933">3933</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3934"><td class="num" id="LN3934">3934</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3935"><td class="num" id="LN3935">3935</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="3936"><td class="num" id="LN3936">3936</td><td class="line">    <span class='comment'>// Don't update the GUI cursor here, ScreenLines[] is invalid until the</span></td></tr>
<tr class="codeline" data-linenumber="3937"><td class="num" id="LN3937">3937</td><td class="line">    <span class='comment'>// scrolling is actually carried out.</span></td></tr>
<tr class="codeline" data-linenumber="3938"><td class="num" id="LN3938">3938</td><td class="line">    gui_dont_update_cursor(gui.cursor_row &gt;= row + off</td></tr>
<tr class="codeline" data-linenumber="3939"><td class="num" id="LN3939">3939</td><td class="line">						&amp;&amp; gui.cursor_row &lt; end + off);</td></tr>
<tr class="codeline" data-linenumber="3940"><td class="num" id="LN3940">3940</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3941"><td class="num" id="LN3941">3941</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3942"><td class="num" id="LN3942">3942</td><td class="line">    <span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_wincol != 0 &amp;&amp; *<span class='macro'>T_CSV<span class='macro_popup'>(term_strings[(int)(KS_CSV)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> &amp;&amp; *<span class='macro'>T_CCS<span class='macro_popup'>(term_strings[(int)(KS_CCS)])</span></span> == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3943"><td class="num" id="LN3943">3943</td><td class="line">	cursor_col = wp-&gt;w_wincol;</td></tr>
<tr class="codeline" data-linenumber="3944"><td class="num" id="LN3944">3944</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3945"><td class="num" id="LN3945">3945</td><td class="line">    <span class='keyword'>if</span> (*<span class='macro'>T_CCS<span class='macro_popup'>(term_strings[(int)(KS_CCS)])</span></span> != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)	    <span class='comment'>// cursor relative to region</span></td></tr>
<tr class="codeline" data-linenumber="3946"><td class="num" id="LN3946">3946</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3947"><td class="num" id="LN3947">3947</td><td class="line">	cursor_row = row;</td></tr>
<tr class="codeline" data-linenumber="3948"><td class="num" id="LN3948">3948</td><td class="line">	cursor_end = end;</td></tr>
<tr class="codeline" data-linenumber="3949"><td class="num" id="LN3949">3949</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3950"><td class="num" id="LN3950">3950</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3951"><td class="num" id="LN3951">3951</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3952"><td class="num" id="LN3952">3952</td><td class="line">	cursor_row = row + off;</td></tr>
<tr class="codeline" data-linenumber="3953"><td class="num" id="LN3953">3953</td><td class="line">	cursor_end = end + off;</td></tr>
<tr class="codeline" data-linenumber="3954"><td class="num" id="LN3954">3954</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3955"><td class="num" id="LN3955">3955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3956"><td class="num" id="LN3956">3956</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="3957"><td class="num" id="LN3957">3957</td><td class="line">     <span class='comment'>* Now shift LineOffset[] line_count up to reflect the deleted lines.</span></td></tr>
<tr class="codeline" data-linenumber="3958"><td class="num" id="LN3958">3958</td><td class="line">     <span class='comment'>* Clear the inserted lines in ScreenLines[].</span></td></tr>
<tr class="codeline" data-linenumber="3959"><td class="num" id="LN3959">3959</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3960"><td class="num" id="LN3960">3960</td><td class="line">    row += off;</td></tr>
<tr class="codeline" data-linenumber="3961"><td class="num" id="LN3961">3961</td><td class="line">    end += off;</td></tr>
<tr class="codeline" data-linenumber="3962"><td class="num" id="LN3962">3962</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; line_count; ++i)</td></tr>
<tr class="codeline" data-linenumber="3963"><td class="num" id="LN3963">3963</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3964"><td class="num" id="LN3964">3964</td><td class="line">	<span class='keyword'>if</span> (wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; wp-&gt;w_width != Columns)</td></tr>
<tr class="codeline" data-linenumber="3965"><td class="num" id="LN3965">3965</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3966"><td class="num" id="LN3966">3966</td><td class="line">	    <span class='comment'>// need to copy part of a line</span></td></tr>
<tr class="codeline" data-linenumber="3967"><td class="num" id="LN3967">3967</td><td class="line">	    j = row + i;</td></tr>
<tr class="codeline" data-linenumber="3968"><td class="num" id="LN3968">3968</td><td class="line">	    <span class='keyword'>while</span> ((j += line_count) &lt;= end - 1)</td></tr>
<tr class="codeline" data-linenumber="3969"><td class="num" id="LN3969">3969</td><td class="line">		linecopy(j - line_count, j, wp);</td></tr>
<tr class="codeline" data-linenumber="3970"><td class="num" id="LN3970">3970</td><td class="line">	    j -= line_count;</td></tr>
<tr class="codeline" data-linenumber="3971"><td class="num" id="LN3971">3971</td><td class="line">	    <span class='keyword'>if</span> (can_clear((char_u *)<span class='string_literal'>" "</span>))</td></tr>
<tr class="codeline" data-linenumber="3972"><td class="num" id="LN3972">3972</td><td class="line">		lineclear(LineOffset[j] + wp-&gt;w_wincol, wp-&gt;w_width,</td></tr>
<tr class="codeline" data-linenumber="3973"><td class="num" id="LN3973">3973</td><td class="line">								   clear_attr);</td></tr>
<tr class="codeline" data-linenumber="3974"><td class="num" id="LN3974">3974</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3975"><td class="num" id="LN3975">3975</td><td class="line">		lineinvalid(LineOffset[j] + wp-&gt;w_wincol, wp-&gt;w_width);</td></tr>
<tr class="codeline" data-linenumber="3976"><td class="num" id="LN3976">3976</td><td class="line">	    LineWraps[j] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3977"><td class="num" id="LN3977">3977</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3978"><td class="num" id="LN3978">3978</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3979"><td class="num" id="LN3979">3979</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="3980"><td class="num" id="LN3980">3980</td><td class="line">	    <span class='comment'>// whole width, moving the line pointers is faster</span></td></tr>
<tr class="codeline" data-linenumber="3981"><td class="num" id="LN3981">3981</td><td class="line">	    j = row + i;</td></tr>
<tr class="codeline" data-linenumber="3982"><td class="num" id="LN3982">3982</td><td class="line">	    temp = LineOffset[j];</td></tr>
<tr class="codeline" data-linenumber="3983"><td class="num" id="LN3983">3983</td><td class="line">	    <span class='keyword'>while</span> ((j += line_count) &lt;= end - 1)</td></tr>
<tr class="codeline" data-linenumber="3984"><td class="num" id="LN3984">3984</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="3985"><td class="num" id="LN3985">3985</td><td class="line">		LineOffset[j - line_count] = LineOffset[j];</td></tr>
<tr class="codeline" data-linenumber="3986"><td class="num" id="LN3986">3986</td><td class="line">		LineWraps[j - line_count] = LineWraps[j];</td></tr>
<tr class="codeline" data-linenumber="3987"><td class="num" id="LN3987">3987</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="3988"><td class="num" id="LN3988">3988</td><td class="line">	    LineOffset[j - line_count] = temp;</td></tr>
<tr class="codeline" data-linenumber="3989"><td class="num" id="LN3989">3989</td><td class="line">	    LineWraps[j - line_count] = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3990"><td class="num" id="LN3990">3990</td><td class="line">	    <span class='keyword'>if</span> (can_clear((char_u *)<span class='string_literal'>" "</span>))</td></tr>
<tr class="codeline" data-linenumber="3991"><td class="num" id="LN3991">3991</td><td class="line">		lineclear(temp, (<span class='keyword'>int</span>)Columns, clear_attr);</td></tr>
<tr class="codeline" data-linenumber="3992"><td class="num" id="LN3992">3992</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3993"><td class="num" id="LN3993">3993</td><td class="line">		lineinvalid(temp, (<span class='keyword'>int</span>)Columns);</td></tr>
<tr class="codeline" data-linenumber="3994"><td class="num" id="LN3994">3994</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="3995"><td class="num" id="LN3995">3995</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3996"><td class="num" id="LN3996">3996</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3997"><td class="num" id="LN3997">3997</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_HAIKU</span></td></tr>
<tr class="codeline" data-linenumber="3998"><td class="num" id="LN3998">3998</td><td class="line">    vim_unlock_screen();</td></tr>
<tr class="codeline" data-linenumber="3999"><td class="num" id="LN3999">3999</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4000"><td class="num" id="LN4000">4000</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4001"><td class="num" id="LN4001">4001</td><td class="line">    <span class='keyword'>if</span> (screen_attr != clear_attr)</td></tr>
<tr class="codeline" data-linenumber="4002"><td class="num" id="LN4002">4002</td><td class="line">	screen_stop_highlight();</td></tr>
<tr class="codeline" data-linenumber="4003"><td class="num" id="LN4003">4003</td><td class="line">    <span class='keyword'>if</span> (clear_attr != 0)</td></tr>
<tr class="codeline" data-linenumber="4004"><td class="num" id="LN4004">4004</td><td class="line">	screen_start_highlight(clear_attr);</td></tr>
<tr class="codeline" data-linenumber="4005"><td class="num" id="LN4005">4005</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4006"><td class="num" id="LN4006">4006</td><td class="line">    <span class='comment'>// redraw the characters</span></td></tr>
<tr class="codeline" data-linenumber="4007"><td class="num" id="LN4007">4007</td><td class="line">    <span class='keyword'>if</span> (type == <span class='macro'>USE_REDRAW<span class='macro_popup'>9</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4008"><td class="num" id="LN4008">4008</td><td class="line">	redraw_block(row, end, wp);</td></tr>
<tr class="codeline" data-linenumber="4009"><td class="num" id="LN4009">4009</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (type == <span class='macro'>USE_T_CD<span class='macro_popup'>8</span></span>)	<span class='comment'>// delete the lines</span></td></tr>
<tr class="codeline" data-linenumber="4010"><td class="num" id="LN4010">4010</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4011"><td class="num" id="LN4011">4011</td><td class="line">	windgoto(cursor_row, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="4012"><td class="num" id="LN4012">4012</td><td class="line">	out_str(<span class='macro'>T_CD<span class='macro_popup'>(term_strings[(int)(KS_CD)])</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4013"><td class="num" id="LN4013">4013</td><td class="line">	screen_start();			<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="4014"><td class="num" id="LN4014">4014</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4015"><td class="num" id="LN4015">4015</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (type == <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4016"><td class="num" id="LN4016">4016</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4017"><td class="num" id="LN4017">4017</td><td class="line">	windgoto(cursor_row, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="4018"><td class="num" id="LN4018">4018</td><td class="line">	term_delete_lines(line_count);</td></tr>
<tr class="codeline" data-linenumber="4019"><td class="num" id="LN4019">4019</td><td class="line">	screen_start();			<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="4020"><td class="num" id="LN4020">4020</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4021"><td class="num" id="LN4021">4021</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4022"><td class="num" id="LN4022">4022</td><td class="line">     <span class='comment'>* Deleting lines at top of the screen or scroll region: Just scroll</span></td></tr>
<tr class="codeline" data-linenumber="4023"><td class="num" id="LN4023">4023</td><td class="line">     <span class='comment'>* the whole screen (scroll region) up by outputting newlines on the</span></td></tr>
<tr class="codeline" data-linenumber="4024"><td class="num" id="LN4024">4024</td><td class="line">     <span class='comment'>* last line.</span></td></tr>
<tr class="codeline" data-linenumber="4025"><td class="num" id="LN4025">4025</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4026"><td class="num" id="LN4026">4026</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (type == <span class='macro'>USE_NL<span class='macro_popup'>7</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4027"><td class="num" id="LN4027">4027</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4028"><td class="num" id="LN4028">4028</td><td class="line">	windgoto(cursor_end - 1, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="4029"><td class="num" id="LN4029">4029</td><td class="line">	<span class='keyword'>for</span> (i = line_count; --i &gt;= 0; )</td></tr>
<tr class="codeline" data-linenumber="4030"><td class="num" id="LN4030">4030</td><td class="line">	    out_char('\n');		<span class='comment'>// cursor will remain on same line</span></td></tr>
<tr class="codeline" data-linenumber="4031"><td class="num" id="LN4031">4031</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4032"><td class="num" id="LN4032">4032</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4033"><td class="num" id="LN4033">4033</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4034"><td class="num" id="LN4034">4034</td><td class="line">	<span class='keyword'>for</span> (i = line_count; --i &gt;= 0; )</td></tr>
<tr class="codeline" data-linenumber="4035"><td class="num" id="LN4035">4035</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4036"><td class="num" id="LN4036">4036</td><td class="line">	    <span class='keyword'>if</span> (type == <span class='macro'>USE_T_DL<span class='macro_popup'>5</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4037"><td class="num" id="LN4037">4037</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4038"><td class="num" id="LN4038">4038</td><td class="line">		windgoto(cursor_row, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="4039"><td class="num" id="LN4039">4039</td><td class="line">		out_str(<span class='macro'>T_DL<span class='macro_popup'>(term_strings[(int)(KS_DL)])</span></span>);		<span class='comment'>// delete a line</span></td></tr>
<tr class="codeline" data-linenumber="4040"><td class="num" id="LN4040">4040</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4041"><td class="num" id="LN4041">4041</td><td class="line">	    <span class='keyword'>else</span> <span class='comment'>// type == USE_T_CE</span></td></tr>
<tr class="codeline" data-linenumber="4042"><td class="num" id="LN4042">4042</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4043"><td class="num" id="LN4043">4043</td><td class="line">		windgoto(cursor_row + i, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="4044"><td class="num" id="LN4044">4044</td><td class="line">		out_str(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>);		<span class='comment'>// erase a line</span></td></tr>
<tr class="codeline" data-linenumber="4045"><td class="num" id="LN4045">4045</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4046"><td class="num" id="LN4046">4046</td><td class="line">	    screen_start();		<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="4047"><td class="num" id="LN4047">4047</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4048"><td class="num" id="LN4048">4048</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4049"><td class="num" id="LN4049">4049</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4050"><td class="num" id="LN4050">4050</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4051"><td class="num" id="LN4051">4051</td><td class="line">     <span class='comment'>* If the 'db' flag is set, we need to clear the lines that have been</span></td></tr>
<tr class="codeline" data-linenumber="4052"><td class="num" id="LN4052">4052</td><td class="line">     <span class='comment'>* scrolled up at the bottom of the region.</span></td></tr>
<tr class="codeline" data-linenumber="4053"><td class="num" id="LN4053">4053</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4054"><td class="num" id="LN4054">4054</td><td class="line">    <span class='keyword'>if</span> (*<span class='macro'>T_DB<span class='macro_popup'>(term_strings[(int)(KS_DB)])</span></span> &amp;&amp; (type == <span class='macro'>USE_T_DL<span class='macro_popup'>5</span></span> || type == <span class='macro'>USE_T_CDL<span class='macro_popup'>2</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4055"><td class="num" id="LN4055">4055</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4056"><td class="num" id="LN4056">4056</td><td class="line">	<span class='keyword'>for</span> (i = line_count; i &gt; 0; --i)</td></tr>
<tr class="codeline" data-linenumber="4057"><td class="num" id="LN4057">4057</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4058"><td class="num" id="LN4058">4058</td><td class="line">	    windgoto(cursor_end - i, cursor_col);</td></tr>
<tr class="codeline" data-linenumber="4059"><td class="num" id="LN4059">4059</td><td class="line">	    out_str(<span class='macro'>T_CE<span class='macro_popup'>(term_strings[(int)(KS_CE)])</span></span>);		<span class='comment'>// erase a line</span></td></tr>
<tr class="codeline" data-linenumber="4060"><td class="num" id="LN4060">4060</td><td class="line">	    screen_start();		<span class='comment'>// don't know where cursor is now</span></td></tr>
<tr class="codeline" data-linenumber="4061"><td class="num" id="LN4061">4061</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4062"><td class="num" id="LN4062">4062</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4063"><td class="num" id="LN4063">4063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4064"><td class="num" id="LN4064">4064</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="4065"><td class="num" id="LN4065">4065</td><td class="line">    gui_can_update_cursor();</td></tr>
<tr class="codeline" data-linenumber="4066"><td class="num" id="LN4066">4066</td><td class="line">    <span class='keyword'>if</span> (gui.in_use)</td></tr>
<tr class="codeline" data-linenumber="4067"><td class="num" id="LN4067">4067</td><td class="line">	out_flush();	<span class='comment'>// always flush after a scroll</span></td></tr>
<tr class="codeline" data-linenumber="4068"><td class="num" id="LN4068">4068</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4069"><td class="num" id="LN4069">4069</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4070"><td class="num" id="LN4070">4070</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>OK<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4071"><td class="num" id="LN4071">4071</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4072"><td class="num" id="LN4072">4072</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4073"><td class="num" id="LN4073">4073</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4074"><td class="num" id="LN4074">4074</td><td class="line"> <span class='comment'>* Return TRUE when postponing displaying the mode message: when not redrawing</span></td></tr>
<tr class="codeline" data-linenumber="4075"><td class="num" id="LN4075">4075</td><td class="line"> <span class='comment'>* or inside a mapping.</span></td></tr>
<tr class="codeline" data-linenumber="4076"><td class="num" id="LN4076">4076</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4077"><td class="num" id="LN4077">4077</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4078"><td class="num" id="LN4078">4078</td><td class="line">skip_showmode()</td></tr>
<tr class="codeline" data-linenumber="4079"><td class="num" id="LN4079">4079</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4080"><td class="num" id="LN4080">4080</td><td class="line">    <span class='comment'>// Call char_avail() only when we are going to show something, because it</span></td></tr>
<tr class="codeline" data-linenumber="4081"><td class="num" id="LN4081">4081</td><td class="line">    <span class='comment'>// takes a bit of time.  redrawing() may also call char_avail_avail().</span></td></tr>
<tr class="codeline" data-linenumber="4082"><td class="num" id="LN4082">4082</td><td class="line">    <span class='keyword'>if</span> (global_busy</td></tr>
<tr class="codeline" data-linenumber="4083"><td class="num" id="LN4083">4083</td><td class="line">	    || msg_silent != 0</td></tr>
<tr class="codeline" data-linenumber="4084"><td class="num" id="LN4084">4084</td><td class="line">	    || !redrawing()</td></tr>
<tr class="codeline" data-linenumber="4085"><td class="num" id="LN4085">4085</td><td class="line">	    || (char_avail() &amp;&amp; !KeyTyped))</td></tr>
<tr class="codeline" data-linenumber="4086"><td class="num" id="LN4086">4086</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4087"><td class="num" id="LN4087">4087</td><td class="line">	redraw_mode = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;		<span class='comment'>// show mode later</span></td></tr>
<tr class="codeline" data-linenumber="4088"><td class="num" id="LN4088">4088</td><td class="line">	<span class='keyword'>return</span> <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4089"><td class="num" id="LN4089">4089</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4090"><td class="num" id="LN4090">4090</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4091"><td class="num" id="LN4091">4091</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4092"><td class="num" id="LN4092">4092</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4093"><td class="num" id="LN4093">4093</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4094"><td class="num" id="LN4094">4094</td><td class="line"> <span class='comment'>* Show the current mode and ruler.</span></td></tr>
<tr class="codeline" data-linenumber="4095"><td class="num" id="LN4095">4095</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="4096"><td class="num" id="LN4096">4096</td><td class="line"> <span class='comment'>* If clear_cmdline is TRUE, clear the rest of the cmdline.</span></td></tr>
<tr class="codeline" data-linenumber="4097"><td class="num" id="LN4097">4097</td><td class="line"> <span class='comment'>* If clear_cmdline is FALSE there may be a message there that needs to be</span></td></tr>
<tr class="codeline" data-linenumber="4098"><td class="num" id="LN4098">4098</td><td class="line"> <span class='comment'>* cleared only if a mode is shown.</span></td></tr>
<tr class="codeline" data-linenumber="4099"><td class="num" id="LN4099">4099</td><td class="line"> <span class='comment'>* If redraw_mode is TRUE show or clear the mode.</span></td></tr>
<tr class="codeline" data-linenumber="4100"><td class="num" id="LN4100">4100</td><td class="line"> <span class='comment'>* Return the length of the message (0 if no message).</span></td></tr>
<tr class="codeline" data-linenumber="4101"><td class="num" id="LN4101">4101</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4102"><td class="num" id="LN4102">4102</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4103"><td class="num" id="LN4103">4103</td><td class="line">showmode(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4104"><td class="num" id="LN4104">4104</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4105"><td class="num" id="LN4105">4105</td><td class="line">    <span class='keyword'>int</span>		need_clear;</td></tr>
<tr class="codeline" data-linenumber="4106"><td class="num" id="LN4106">4106</td><td class="line">    <span class='keyword'>int</span>		length = 0;</td></tr>
<tr class="codeline" data-linenumber="4107"><td class="num" id="LN4107">4107</td><td class="line">    <span class='keyword'>int</span>		do_mode;</td></tr>
<tr class="codeline" data-linenumber="4108"><td class="num" id="LN4108">4108</td><td class="line">    <span class='keyword'>int</span>		attr;</td></tr>
<tr class="codeline" data-linenumber="4109"><td class="num" id="LN4109">4109</td><td class="line">    <span class='keyword'>int</span>		nwr_save;</td></tr>
<tr class="codeline" data-linenumber="4110"><td class="num" id="LN4110">4110</td><td class="line">    <span class='keyword'>int</span>		sub_attr;</td></tr>
<tr class="codeline" data-linenumber="4111"><td class="num" id="LN4111">4111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4112"><td class="num" id="LN4112">4112</td><td class="line">    do_mode = ((p_smd &amp;&amp; msg_silent == 0)</td></tr>
<tr class="codeline" data-linenumber="4113"><td class="num" id="LN4113">4113</td><td class="line">	    &amp;&amp; ((State &amp; <span class='macro'>INSERT<span class='macro_popup'>0x10</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4114"><td class="num" id="LN4114">4114</td><td class="line">		|| restart_edit != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span></td></tr>
<tr class="codeline" data-linenumber="4115"><td class="num" id="LN4115">4115</td><td class="line">		|| VIsual_active));</td></tr>
<tr class="codeline" data-linenumber="4116"><td class="num" id="LN4116">4116</td><td class="line">    <span class='keyword'>if</span> (do_mode || reg_recording != 0)</td></tr>
<tr class="codeline" data-linenumber="4117"><td class="num" id="LN4117">4117</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4118"><td class="num" id="LN4118">4118</td><td class="line">	<span class='keyword'>if</span> (skip_showmode())</td></tr>
<tr class="codeline" data-linenumber="4119"><td class="num" id="LN4119">4119</td><td class="line">	    <span class='keyword'>return</span> 0;		<span class='comment'>// show mode later</span></td></tr>
<tr class="codeline" data-linenumber="4120"><td class="num" id="LN4120">4120</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4121"><td class="num" id="LN4121">4121</td><td class="line">	nwr_save = need_wait_return;</td></tr>
<tr class="codeline" data-linenumber="4122"><td class="num" id="LN4122">4122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4123"><td class="num" id="LN4123">4123</td><td class="line">	<span class='comment'>// wait a bit before overwriting an important message</span></td></tr>
<tr class="codeline" data-linenumber="4124"><td class="num" id="LN4124">4124</td><td class="line">	check_for_delay(<span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4125"><td class="num" id="LN4125">4125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4126"><td class="num" id="LN4126">4126</td><td class="line">	<span class='comment'>// if the cmdline is more than one line high, erase top lines</span></td></tr>
<tr class="codeline" data-linenumber="4127"><td class="num" id="LN4127">4127</td><td class="line">	need_clear = clear_cmdline;</td></tr>
<tr class="codeline" data-linenumber="4128"><td class="num" id="LN4128">4128</td><td class="line">	<span class='keyword'>if</span> (clear_cmdline &amp;&amp; cmdline_row &lt; Rows - 1)</td></tr>
<tr class="codeline" data-linenumber="4129"><td class="num" id="LN4129">4129</td><td class="line">	    msg_clr_cmdline();			<span class='comment'>// will reset clear_cmdline</span></td></tr>
<tr class="codeline" data-linenumber="4130"><td class="num" id="LN4130">4130</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4131"><td class="num" id="LN4131">4131</td><td class="line">	<span class='comment'>// Position on the last line in the window, column 0</span></td></tr>
<tr class="codeline" data-linenumber="4132"><td class="num" id="LN4132">4132</td><td class="line">	msg_pos_mode();</td></tr>
<tr class="codeline" data-linenumber="4133"><td class="num" id="LN4133">4133</td><td class="line">	cursor_off();</td></tr>
<tr class="codeline" data-linenumber="4134"><td class="num" id="LN4134">4134</td><td class="line">	attr = <span class='macro'>HL_ATTR(HLF_CM)<span class='macro_popup'>highlight_attr[(int)(HLF_CM)]</span></span>;			<span class='comment'>// Highlight mode</span></td></tr>
<tr class="codeline" data-linenumber="4135"><td class="num" id="LN4135">4135</td><td class="line">	<span class='keyword'>if</span> (do_mode)</td></tr>
<tr class="codeline" data-linenumber="4136"><td class="num" id="LN4136">4136</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4137"><td class="num" id="LN4137">4137</td><td class="line">	    msg_puts_attr(<span class='string_literal'>"--"</span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4138"><td class="num" id="LN4138">4138</td><td class="line"><span class='directive'>#if defined(FEAT_XIM)</span></td></tr>
<tr class="codeline" data-linenumber="4139"><td class="num" id="LN4139">4139</td><td class="line">	    <span class='keyword'>if</span> (</td></tr>
<tr class="codeline" data-linenumber="4140"><td class="num" id="LN4140">4140</td><td class="line"><span class='directive'># ifdef FEAT_GUI_GTK</span></td></tr>
<tr class="codeline" data-linenumber="4141"><td class="num" id="LN4141">4141</td><td class="line">		    preedit_get_status()</td></tr>
<tr class="codeline" data-linenumber="4142"><td class="num" id="LN4142">4142</td><td class="line"><span class='directive'># else</span></td></tr>
<tr class="codeline" data-linenumber="4143"><td class="num" id="LN4143">4143</td><td class="line">		    im_get_status()</td></tr>
<tr class="codeline" data-linenumber="4144"><td class="num" id="LN4144">4144</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="4145"><td class="num" id="LN4145">4145</td><td class="line">	       )</td></tr>
<tr class="codeline" data-linenumber="4146"><td class="num" id="LN4146">4146</td><td class="line"><span class='directive'># ifdef FEAT_GUI_GTK // most of the time, it's not XIM being used</span></td></tr>
<tr class="codeline" data-linenumber="4147"><td class="num" id="LN4147">4147</td><td class="line">		msg_puts_attr(<span class='string_literal'>" IM"</span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4148"><td class="num" id="LN4148">4148</td><td class="line"><span class='directive'># else</span></td></tr>
<tr class="codeline" data-linenumber="4149"><td class="num" id="LN4149">4149</td><td class="line">		msg_puts_attr(<span class='string_literal'>" XIM"</span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4150"><td class="num" id="LN4150">4150</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="4151"><td class="num" id="LN4151">4151</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4152"><td class="num" id="LN4152">4152</td><td class="line">	    <span class='comment'>// CTRL-X in Insert mode</span></td></tr>
<tr class="codeline" data-linenumber="4153"><td class="num" id="LN4153">4153</td><td class="line">	    <span class='keyword'>if</span> (edit_submode != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; !shortmess(<span class='macro'>SHM_COMPLETIONMENU<span class='macro_popup'>'c'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4154"><td class="num" id="LN4154">4154</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4155"><td class="num" id="LN4155">4155</td><td class="line">		<span class='comment'>// These messages can get long, avoid a wrap in a narrow</span></td></tr>
<tr class="codeline" data-linenumber="4156"><td class="num" id="LN4156">4156</td><td class="line">		<span class='comment'>// window.  Prefer showing edit_submode_extra.</span></td></tr>
<tr class="codeline" data-linenumber="4157"><td class="num" id="LN4157">4157</td><td class="line">		length = (Rows - msg_row) * Columns - 3;</td></tr>
<tr class="codeline" data-linenumber="4158"><td class="num" id="LN4158">4158</td><td class="line">		<span class='keyword'>if</span> (edit_submode_extra != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4159"><td class="num" id="LN4159">4159</td><td class="line">		    length -= vim_strsize(edit_submode_extra);</td></tr>
<tr class="codeline" data-linenumber="4160"><td class="num" id="LN4160">4160</td><td class="line">		<span class='keyword'>if</span> (length &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="4161"><td class="num" id="LN4161">4161</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4162"><td class="num" id="LN4162">4162</td><td class="line">		    <span class='keyword'>if</span> (edit_submode_pre != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4163"><td class="num" id="LN4163">4163</td><td class="line">			length -= vim_strsize(edit_submode_pre);</td></tr>
<tr class="codeline" data-linenumber="4164"><td class="num" id="LN4164">4164</td><td class="line">		    <span class='keyword'>if</span> (length - vim_strsize(edit_submode) &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="4165"><td class="num" id="LN4165">4165</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="4166"><td class="num" id="LN4166">4166</td><td class="line">			<span class='keyword'>if</span> (edit_submode_pre != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4167"><td class="num" id="LN4167">4167</td><td class="line">			    msg_puts_attr((<span class='keyword'>char</span> *)edit_submode_pre, attr);</td></tr>
<tr class="codeline" data-linenumber="4168"><td class="num" id="LN4168">4168</td><td class="line">			msg_puts_attr((<span class='keyword'>char</span> *)edit_submode, attr);</td></tr>
<tr class="codeline" data-linenumber="4169"><td class="num" id="LN4169">4169</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="4170"><td class="num" id="LN4170">4170</td><td class="line">		    <span class='keyword'>if</span> (edit_submode_extra != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4171"><td class="num" id="LN4171">4171</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="4172"><td class="num" id="LN4172">4172</td><td class="line">			msg_puts_attr(<span class='string_literal'>" "</span>, attr);  <span class='comment'>// add a space in between</span></td></tr>
<tr class="codeline" data-linenumber="4173"><td class="num" id="LN4173">4173</td><td class="line">			<span class='keyword'>if</span> ((<span class='keyword'>int</span>)edit_submode_highl &lt; (<span class='keyword'>int</span>)HLF_COUNT)</td></tr>
<tr class="codeline" data-linenumber="4174"><td class="num" id="LN4174">4174</td><td class="line">			    sub_attr = <span class='macro'>HL_ATTR(edit_submode_highl)<span class='macro_popup'>highlight_attr[(int)(edit_submode_highl)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4175"><td class="num" id="LN4175">4175</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4176"><td class="num" id="LN4176">4176</td><td class="line">			    sub_attr = attr;</td></tr>
<tr class="codeline" data-linenumber="4177"><td class="num" id="LN4177">4177</td><td class="line">			msg_puts_attr((<span class='keyword'>char</span> *)edit_submode_extra, sub_attr);</td></tr>
<tr class="codeline" data-linenumber="4178"><td class="num" id="LN4178">4178</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="4179"><td class="num" id="LN4179">4179</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4180"><td class="num" id="LN4180">4180</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4181"><td class="num" id="LN4181">4181</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4182"><td class="num" id="LN4182">4182</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4183"><td class="num" id="LN4183">4183</td><td class="line">		<span class='keyword'>if</span> (State &amp; <span class='macro'>VREPLACE_FLAG<span class='macro_popup'>0x80</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4184"><td class="num" id="LN4184">4184</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" VREPLACE"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" VREPLACE"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4185"><td class="num" id="LN4185">4185</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (State &amp; <span class='macro'>REPLACE_FLAG<span class='macro_popup'>0x40</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4186"><td class="num" id="LN4186">4186</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" REPLACE"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" REPLACE"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4187"><td class="num" id="LN4187">4187</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (State &amp; <span class='macro'>INSERT<span class='macro_popup'>0x10</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4188"><td class="num" id="LN4188">4188</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4189"><td class="num" id="LN4189">4189</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="4190"><td class="num" id="LN4190">4190</td><td class="line">		    <span class='keyword'>if</span> (p_ri)</td></tr>
<tr class="codeline" data-linenumber="4191"><td class="num" id="LN4191">4191</td><td class="line">			msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" REVERSE"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" REVERSE"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4192"><td class="num" id="LN4192">4192</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4193"><td class="num" id="LN4193">4193</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" INSERT"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" INSERT"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4194"><td class="num" id="LN4194">4194</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4195"><td class="num" id="LN4195">4195</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (restart_edit == 'I' || restart_edit == 'i' ||</td></tr>
<tr class="codeline" data-linenumber="4196"><td class="num" id="LN4196">4196</td><td class="line">			restart_edit == 'a' || restart_edit == 'A')</td></tr>
<tr class="codeline" data-linenumber="4197"><td class="num" id="LN4197">4197</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" (insert)"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" (insert)"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4198"><td class="num" id="LN4198">4198</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (restart_edit == 'R')</td></tr>
<tr class="codeline" data-linenumber="4199"><td class="num" id="LN4199">4199</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" (replace)"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" (replace)"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4200"><td class="num" id="LN4200">4200</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (restart_edit == 'V')</td></tr>
<tr class="codeline" data-linenumber="4201"><td class="num" id="LN4201">4201</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" (vreplace)"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" (vreplace)"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4202"><td class="num" id="LN4202">4202</td><td class="line"><span class='directive'>#ifdef FEAT_RIGHTLEFT</span></td></tr>
<tr class="codeline" data-linenumber="4203"><td class="num" id="LN4203">4203</td><td class="line">		<span class='keyword'>if</span> (p_hkmap)</td></tr>
<tr class="codeline" data-linenumber="4204"><td class="num" id="LN4204">4204</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" Hebrew"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" Hebrew"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4205"><td class="num" id="LN4205">4205</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4206"><td class="num" id="LN4206">4206</td><td class="line"><span class='directive'>#ifdef FEAT_KEYMAP</span></td></tr>
<tr class="codeline" data-linenumber="4207"><td class="num" id="LN4207">4207</td><td class="line">		<span class='keyword'>if</span> (State &amp; <span class='macro'>LANGMAP<span class='macro_popup'>0x20</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4208"><td class="num" id="LN4208">4208</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4209"><td class="num" id="LN4209">4209</td><td class="line"><span class='directive'># ifdef FEAT_ARABIC</span></td></tr>
<tr class="codeline" data-linenumber="4210"><td class="num" id="LN4210">4210</td><td class="line">		    <span class='keyword'>if</span> (curwin-&gt;<span class='macro'>w_p_arab<span class='macro_popup'>w_onebuf_opt.wo_arab</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4211"><td class="num" id="LN4211">4211</td><td class="line">			msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" Arabic"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" Arabic"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4212"><td class="num" id="LN4212">4212</td><td class="line">		    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4213"><td class="num" id="LN4213">4213</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="4214"><td class="num" id="LN4214">4214</td><td class="line">			<span class='keyword'>if</span> (get_keymap_str(curwin, (char_u *)<span class='string_literal'>" (%s)"</span>,</td></tr>
<tr class="codeline" data-linenumber="4215"><td class="num" id="LN4215">4215</td><td class="line">							   NameBuff, <span class='macro'>MAXPATHL<span class='macro_popup'>4096</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4216"><td class="num" id="LN4216">4216</td><td class="line">			    msg_puts_attr((<span class='keyword'>char</span> *)NameBuff, attr);</td></tr>
<tr class="codeline" data-linenumber="4217"><td class="num" id="LN4217">4217</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4218"><td class="num" id="LN4218">4218</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4219"><td class="num" id="LN4219">4219</td><td class="line">		<span class='keyword'>if</span> ((State &amp; <span class='macro'>INSERT<span class='macro_popup'>0x10</span></span>) &amp;&amp; p_paste)</td></tr>
<tr class="codeline" data-linenumber="4220"><td class="num" id="LN4220">4220</td><td class="line">		    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>" (paste)"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)(" (paste)"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4221"><td class="num" id="LN4221">4221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4222"><td class="num" id="LN4222">4222</td><td class="line">		<span class='keyword'>if</span> (VIsual_active)</td></tr>
<tr class="codeline" data-linenumber="4223"><td class="num" id="LN4223">4223</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4224"><td class="num" id="LN4224">4224</td><td class="line">		    <span class='keyword'>char</span> *p;</td></tr>
<tr class="codeline" data-linenumber="4225"><td class="num" id="LN4225">4225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4226"><td class="num" id="LN4226">4226</td><td class="line">		    <span class='comment'>// Don't concatenate separate words to avoid translation</span></td></tr>
<tr class="codeline" data-linenumber="4227"><td class="num" id="LN4227">4227</td><td class="line">		    <span class='comment'>// problems.</span></td></tr>
<tr class="codeline" data-linenumber="4228"><td class="num" id="LN4228">4228</td><td class="line">		    <span class='keyword'>switch</span> ((VIsual_select ? 4 : 0)</td></tr>
<tr class="codeline" data-linenumber="4229"><td class="num" id="LN4229">4229</td><td class="line">			    + (VIsual_mode == <span class='macro'>Ctrl_V<span class='macro_popup'>22</span></span>) * 2</td></tr>
<tr class="codeline" data-linenumber="4230"><td class="num" id="LN4230">4230</td><td class="line">			    + (VIsual_mode == 'V'))</td></tr>
<tr class="codeline" data-linenumber="4231"><td class="num" id="LN4231">4231</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="4232"><td class="num" id="LN4232">4232</td><td class="line">			<span class='keyword'>case</span> 0:	p = <span class='macro'>N_(<span class='string_literal'>" VISUAL"</span>)<span class='macro_popup'>" VISUAL"</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4233"><td class="num" id="LN4233">4233</td><td class="line">			<span class='keyword'>case</span> 1: p = <span class='macro'>N_(<span class='string_literal'>" VISUAL LINE"</span>)<span class='macro_popup'>" VISUAL LINE"</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4234"><td class="num" id="LN4234">4234</td><td class="line">			<span class='keyword'>case</span> 2: p = <span class='macro'>N_(<span class='string_literal'>" VISUAL BLOCK"</span>)<span class='macro_popup'>" VISUAL BLOCK"</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4235"><td class="num" id="LN4235">4235</td><td class="line">			<span class='keyword'>case</span> 4: p = <span class='macro'>N_(<span class='string_literal'>" SELECT"</span>)<span class='macro_popup'>" SELECT"</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4236"><td class="num" id="LN4236">4236</td><td class="line">			<span class='keyword'>case</span> 5: p = <span class='macro'>N_(<span class='string_literal'>" SELECT LINE"</span>)<span class='macro_popup'>" SELECT LINE"</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4237"><td class="num" id="LN4237">4237</td><td class="line">			<span class='keyword'>default</span>: p = <span class='macro'>N_(<span class='string_literal'>" SELECT BLOCK"</span>)<span class='macro_popup'>" SELECT BLOCK"</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4238"><td class="num" id="LN4238">4238</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="4239"><td class="num" id="LN4239">4239</td><td class="line">		    msg_puts_attr(<span class='macro'>_(p)<span class='macro_popup'>dcgettext (((void*)0), (char *)(p), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4240"><td class="num" id="LN4240">4240</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4241"><td class="num" id="LN4241">4241</td><td class="line">		msg_puts_attr(<span class='string_literal'>" --"</span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4242"><td class="num" id="LN4242">4242</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4243"><td class="num" id="LN4243">4243</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4244"><td class="num" id="LN4244">4244</td><td class="line">	    need_clear = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4245"><td class="num" id="LN4245">4245</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4246"><td class="num" id="LN4246">4246</td><td class="line">	<span class='keyword'>if</span> (reg_recording != 0</td></tr>
<tr class="codeline" data-linenumber="4247"><td class="num" id="LN4247">4247</td><td class="line">		&amp;&amp; edit_submode == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)    <span class='comment'>// otherwise it gets too long</span></td></tr>
<tr class="codeline" data-linenumber="4248"><td class="num" id="LN4248">4248</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4249"><td class="num" id="LN4249">4249</td><td class="line">	    recording_mode(attr);</td></tr>
<tr class="codeline" data-linenumber="4250"><td class="num" id="LN4250">4250</td><td class="line">	    need_clear = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4251"><td class="num" id="LN4251">4251</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4252"><td class="num" id="LN4252">4252</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4253"><td class="num" id="LN4253">4253</td><td class="line">	mode_displayed = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4254"><td class="num" id="LN4254">4254</td><td class="line">	<span class='keyword'>if</span> (need_clear || clear_cmdline || redraw_mode)</td></tr>
<tr class="codeline" data-linenumber="4255"><td class="num" id="LN4255">4255</td><td class="line">	    msg_clr_eos();</td></tr>
<tr class="codeline" data-linenumber="4256"><td class="num" id="LN4256">4256</td><td class="line">	msg_didout = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;		<span class='comment'>// overwrite this message</span></td></tr>
<tr class="codeline" data-linenumber="4257"><td class="num" id="LN4257">4257</td><td class="line">	length = msg_col;</td></tr>
<tr class="codeline" data-linenumber="4258"><td class="num" id="LN4258">4258</td><td class="line">	msg_col = 0;</td></tr>
<tr class="codeline" data-linenumber="4259"><td class="num" id="LN4259">4259</td><td class="line">	need_wait_return = nwr_save;	<span class='comment'>// never ask for hit-return for this</span></td></tr>
<tr class="codeline" data-linenumber="4260"><td class="num" id="LN4260">4260</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4261"><td class="num" id="LN4261">4261</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (clear_cmdline &amp;&amp; msg_silent == 0)</td></tr>
<tr class="codeline" data-linenumber="4262"><td class="num" id="LN4262">4262</td><td class="line">	<span class='comment'>// Clear the whole command line.  Will reset "clear_cmdline".</span></td></tr>
<tr class="codeline" data-linenumber="4263"><td class="num" id="LN4263">4263</td><td class="line">	msg_clr_cmdline();</td></tr>
<tr class="codeline" data-linenumber="4264"><td class="num" id="LN4264">4264</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (redraw_mode)</td></tr>
<tr class="codeline" data-linenumber="4265"><td class="num" id="LN4265">4265</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4266"><td class="num" id="LN4266">4266</td><td class="line">	msg_pos_mode();</td></tr>
<tr class="codeline" data-linenumber="4267"><td class="num" id="LN4267">4267</td><td class="line">	msg_clr_eos();</td></tr>
<tr class="codeline" data-linenumber="4268"><td class="num" id="LN4268">4268</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4269"><td class="num" id="LN4269">4269</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4270"><td class="num" id="LN4270">4270</td><td class="line"><span class='directive'>#ifdef FEAT_CMDL_INFO</span></td></tr>
<tr class="codeline" data-linenumber="4271"><td class="num" id="LN4271">4271</td><td class="line">    <span class='comment'>// In Visual mode the size of the selected area must be redrawn.</span></td></tr>
<tr class="codeline" data-linenumber="4272"><td class="num" id="LN4272">4272</td><td class="line">    <span class='keyword'>if</span> (VIsual_active)</td></tr>
<tr class="codeline" data-linenumber="4273"><td class="num" id="LN4273">4273</td><td class="line">	clear_showcmd();</td></tr>
<tr class="codeline" data-linenumber="4274"><td class="num" id="LN4274">4274</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4275"><td class="num" id="LN4275">4275</td><td class="line">    <span class='comment'>// If the last window has no status line, the ruler is after the mode</span></td></tr>
<tr class="codeline" data-linenumber="4276"><td class="num" id="LN4276">4276</td><td class="line">    <span class='comment'>// message and must be redrawn</span></td></tr>
<tr class="codeline" data-linenumber="4277"><td class="num" id="LN4277">4277</td><td class="line">    <span class='keyword'>if</span> (redrawing() &amp;&amp; lastwin-&gt;w_status_height == 0)</td></tr>
<tr class="codeline" data-linenumber="4278"><td class="num" id="LN4278">4278</td><td class="line">	win_redr_ruler(lastwin, <span class='macro'>TRUE<span class='macro_popup'>1</span></span>, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4279"><td class="num" id="LN4279">4279</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4280"><td class="num" id="LN4280">4280</td><td class="line">    redraw_cmdline = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4281"><td class="num" id="LN4281">4281</td><td class="line">    redraw_mode = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4282"><td class="num" id="LN4282">4282</td><td class="line">    clear_cmdline = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4283"><td class="num" id="LN4283">4283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4284"><td class="num" id="LN4284">4284</td><td class="line">    <span class='keyword'>return</span> length;</td></tr>
<tr class="codeline" data-linenumber="4285"><td class="num" id="LN4285">4285</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4286"><td class="num" id="LN4286">4286</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4287"><td class="num" id="LN4287">4287</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4288"><td class="num" id="LN4288">4288</td><td class="line"> <span class='comment'>* Position for a mode message.</span></td></tr>
<tr class="codeline" data-linenumber="4289"><td class="num" id="LN4289">4289</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4290"><td class="num" id="LN4290">4290</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4291"><td class="num" id="LN4291">4291</td><td class="line">msg_pos_mode(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4292"><td class="num" id="LN4292">4292</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4293"><td class="num" id="LN4293">4293</td><td class="line">    msg_col = 0;</td></tr>
<tr class="codeline" data-linenumber="4294"><td class="num" id="LN4294">4294</td><td class="line">    msg_row = Rows - 1;</td></tr>
<tr class="codeline" data-linenumber="4295"><td class="num" id="LN4295">4295</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4296"><td class="num" id="LN4296">4296</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4297"><td class="num" id="LN4297">4297</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4298"><td class="num" id="LN4298">4298</td><td class="line"> <span class='comment'>* Delete mode message.  Used when ESC is typed which is expected to end</span></td></tr>
<tr class="codeline" data-linenumber="4299"><td class="num" id="LN4299">4299</td><td class="line"> <span class='comment'>* Insert mode (but Insert mode didn't end yet!).</span></td></tr>
<tr class="codeline" data-linenumber="4300"><td class="num" id="LN4300">4300</td><td class="line"> <span class='comment'>* Caller should check "mode_displayed".</span></td></tr>
<tr class="codeline" data-linenumber="4301"><td class="num" id="LN4301">4301</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4302"><td class="num" id="LN4302">4302</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4303"><td class="num" id="LN4303">4303</td><td class="line">unshowmode(<span class='keyword'>int</span> force)</td></tr>
<tr class="codeline" data-linenumber="4304"><td class="num" id="LN4304">4304</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4305"><td class="num" id="LN4305">4305</td><td class="line">    <span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4306"><td class="num" id="LN4306">4306</td><td class="line">     <span class='comment'>* Don't delete it right now, when not redrawing or inside a mapping.</span></td></tr>
<tr class="codeline" data-linenumber="4307"><td class="num" id="LN4307">4307</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4308"><td class="num" id="LN4308">4308</td><td class="line">    <span class='keyword'>if</span> (!redrawing() || (!force &amp;&amp; char_avail() &amp;&amp; !KeyTyped))</td></tr>
<tr class="codeline" data-linenumber="4309"><td class="num" id="LN4309">4309</td><td class="line">	redraw_cmdline = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;		<span class='comment'>// delete mode later</span></td></tr>
<tr class="codeline" data-linenumber="4310"><td class="num" id="LN4310">4310</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4311"><td class="num" id="LN4311">4311</td><td class="line">	clearmode();</td></tr>
<tr class="codeline" data-linenumber="4312"><td class="num" id="LN4312">4312</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4313"><td class="num" id="LN4313">4313</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4314"><td class="num" id="LN4314">4314</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4315"><td class="num" id="LN4315">4315</td><td class="line"> <span class='comment'>* Clear the mode message.</span></td></tr>
<tr class="codeline" data-linenumber="4316"><td class="num" id="LN4316">4316</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4317"><td class="num" id="LN4317">4317</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4318"><td class="num" id="LN4318">4318</td><td class="line">clearmode(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4319"><td class="num" id="LN4319">4319</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4320"><td class="num" id="LN4320">4320</td><td class="line">    <span class='keyword'>int</span> save_msg_row = msg_row;</td></tr>
<tr class="codeline" data-linenumber="4321"><td class="num" id="LN4321">4321</td><td class="line">    <span class='keyword'>int</span> save_msg_col = msg_col;</td></tr>
<tr class="codeline" data-linenumber="4322"><td class="num" id="LN4322">4322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4323"><td class="num" id="LN4323">4323</td><td class="line">    msg_pos_mode();</td></tr>
<tr class="codeline" data-linenumber="4324"><td class="num" id="LN4324">4324</td><td class="line">    <span class='keyword'>if</span> (reg_recording != 0)</td></tr>
<tr class="codeline" data-linenumber="4325"><td class="num" id="LN4325">4325</td><td class="line">	recording_mode(<span class='macro'>HL_ATTR(HLF_CM)<span class='macro_popup'>highlight_attr[(int)(HLF_CM)]</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4326"><td class="num" id="LN4326">4326</td><td class="line">    msg_clr_eos();</td></tr>
<tr class="codeline" data-linenumber="4327"><td class="num" id="LN4327">4327</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4328"><td class="num" id="LN4328">4328</td><td class="line">    msg_col = save_msg_col;</td></tr>
<tr class="codeline" data-linenumber="4329"><td class="num" id="LN4329">4329</td><td class="line">    msg_row = save_msg_row;</td></tr>
<tr class="codeline" data-linenumber="4330"><td class="num" id="LN4330">4330</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4331"><td class="num" id="LN4331">4331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4332"><td class="num" id="LN4332">4332</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4333"><td class="num" id="LN4333">4333</td><td class="line">recording_mode(<span class='keyword'>int</span> attr)</td></tr>
<tr class="codeline" data-linenumber="4334"><td class="num" id="LN4334">4334</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4335"><td class="num" id="LN4335">4335</td><td class="line">    msg_puts_attr(<span class='macro'>_(<span class='string_literal'>"recording"</span>)<span class='macro_popup'>dcgettext (((void*)0), (char *)("recording"), 5)</span></span>, attr);</td></tr>
<tr class="codeline" data-linenumber="4336"><td class="num" id="LN4336">4336</td><td class="line">    <span class='keyword'>if</span> (!shortmess(<span class='macro'>SHM_RECORDING<span class='macro_popup'>'q'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4337"><td class="num" id="LN4337">4337</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4338"><td class="num" id="LN4338">4338</td><td class="line">	<span class='keyword'>char</span> s[4];</td></tr>
<tr class="codeline" data-linenumber="4339"><td class="num" id="LN4339">4339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4340"><td class="num" id="LN4340">4340</td><td class="line">	<span class='macro'>sprintf(s, <span class='string_literal'>" @%c"</span>, reg_recording)<span class='macro_popup'>__builtin___sprintf_chk (s, 1 - 1, __builtin_object_size (s, 1<br> &gt; 1), " @%c", reg_recording)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4341"><td class="num" id="LN4341">4341</td><td class="line">	msg_puts_attr(s, attr);</td></tr>
<tr class="codeline" data-linenumber="4342"><td class="num" id="LN4342">4342</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4343"><td class="num" id="LN4343">4343</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4344"><td class="num" id="LN4344">4344</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4345"><td class="num" id="LN4345">4345</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4346"><td class="num" id="LN4346">4346</td><td class="line"> <span class='comment'>* Draw the tab pages line at the top of the Vim window.</span></td></tr>
<tr class="codeline" data-linenumber="4347"><td class="num" id="LN4347">4347</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4348"><td class="num" id="LN4348">4348</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4349"><td class="num" id="LN4349">4349</td><td class="line">draw_tabline(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4350"><td class="num" id="LN4350">4350</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4351"><td class="num" id="LN4351">4351</td><td class="line">    <span class='keyword'>int</span>		tabcount = 0;</td></tr>
<tr class="codeline" data-linenumber="4352"><td class="num" id="LN4352">4352</td><td class="line">    tabpage_T	*tp;</td></tr>
<tr class="codeline" data-linenumber="4353"><td class="num" id="LN4353">4353</td><td class="line">    <span class='keyword'>int</span>		tabwidth;</td></tr>
<tr class="codeline" data-linenumber="4354"><td class="num" id="LN4354">4354</td><td class="line">    <span class='keyword'>int</span>		col = 0;</td></tr>
<tr class="codeline" data-linenumber="4355"><td class="num" id="LN4355">4355</td><td class="line">    <span class='keyword'>int</span>		scol = 0;</td></tr>
<tr class="codeline" data-linenumber="4356"><td class="num" id="LN4356">4356</td><td class="line">    <span class='keyword'>int</span>		attr;</td></tr>
<tr class="codeline" data-linenumber="4357"><td class="num" id="LN4357">4357</td><td class="line">    win_T	*wp;</td></tr>
<tr class="codeline" data-linenumber="4358"><td class="num" id="LN4358">4358</td><td class="line">    win_T	*cwp;</td></tr>
<tr class="codeline" data-linenumber="4359"><td class="num" id="LN4359">4359</td><td class="line">    <span class='keyword'>int</span>		wincount;</td></tr>
<tr class="codeline" data-linenumber="4360"><td class="num" id="LN4360">4360</td><td class="line">    <span class='keyword'>int</span>		modified;</td></tr>
<tr class="codeline" data-linenumber="4361"><td class="num" id="LN4361">4361</td><td class="line">    <span class='keyword'>int</span>		c;</td></tr>
<tr class="codeline" data-linenumber="4362"><td class="num" id="LN4362">4362</td><td class="line">    <span class='keyword'>int</span>		len;</td></tr>
<tr class="codeline" data-linenumber="4363"><td class="num" id="LN4363">4363</td><td class="line">    <span class='keyword'>int</span>		attr_sel = <span class='macro'>HL_ATTR(HLF_TPS)<span class='macro_popup'>highlight_attr[(int)(HLF_TPS)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4364"><td class="num" id="LN4364">4364</td><td class="line">    <span class='keyword'>int</span>		attr_nosel = <span class='macro'>HL_ATTR(HLF_TP)<span class='macro_popup'>highlight_attr[(int)(HLF_TP)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4365"><td class="num" id="LN4365">4365</td><td class="line">    <span class='keyword'>int</span>		attr_fill = <span class='macro'>HL_ATTR(HLF_TPF)<span class='macro_popup'>highlight_attr[(int)(HLF_TPF)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4366"><td class="num" id="LN4366">4366</td><td class="line">    char_u	*p;</td></tr>
<tr class="codeline" data-linenumber="4367"><td class="num" id="LN4367">4367</td><td class="line">    <span class='keyword'>int</span>		room;</td></tr>
<tr class="codeline" data-linenumber="4368"><td class="num" id="LN4368">4368</td><td class="line">    <span class='keyword'>int</span>		use_sep_chars = (t_colors &lt; 8</td></tr>
<tr class="codeline" data-linenumber="4369"><td class="num" id="LN4369">4369</td><td class="line"><span class='directive'>#ifdef FEAT_GUI</span></td></tr>
<tr class="codeline" data-linenumber="4370"><td class="num" id="LN4370">4370</td><td class="line">					    &amp;&amp; !gui.in_use</td></tr>
<tr class="codeline" data-linenumber="4371"><td class="num" id="LN4371">4371</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4372"><td class="num" id="LN4372">4372</td><td class="line"><span class='directive'>#ifdef FEAT_TERMGUICOLORS</span></td></tr>
<tr class="codeline" data-linenumber="4373"><td class="num" id="LN4373">4373</td><td class="line">					    &amp;&amp; !p_tgc</td></tr>
<tr class="codeline" data-linenumber="4374"><td class="num" id="LN4374">4374</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4375"><td class="num" id="LN4375">4375</td><td class="line">					    );</td></tr>
<tr class="codeline" data-linenumber="4376"><td class="num" id="LN4376">4376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4377"><td class="num" id="LN4377">4377</td><td class="line">    <span class='keyword'>if</span> (ScreenLines == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4378"><td class="num" id="LN4378">4378</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="4379"><td class="num" id="LN4379">4379</td><td class="line">    redraw_tabline = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4380"><td class="num" id="LN4380">4380</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4381"><td class="num" id="LN4381">4381</td><td class="line"><span class='directive'>#ifdef FEAT_GUI_TABLINE</span></td></tr>
<tr class="codeline" data-linenumber="4382"><td class="num" id="LN4382">4382</td><td class="line">    <span class='comment'>// Take care of a GUI tabline.</span></td></tr>
<tr class="codeline" data-linenumber="4383"><td class="num" id="LN4383">4383</td><td class="line">    <span class='keyword'>if</span> (gui_use_tabline())</td></tr>
<tr class="codeline" data-linenumber="4384"><td class="num" id="LN4384">4384</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4385"><td class="num" id="LN4385">4385</td><td class="line">	gui_update_tabline();</td></tr>
<tr class="codeline" data-linenumber="4386"><td class="num" id="LN4386">4386</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="4387"><td class="num" id="LN4387">4387</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4388"><td class="num" id="LN4388">4388</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4389"><td class="num" id="LN4389">4389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4390"><td class="num" id="LN4390">4390</td><td class="line">    <span class='keyword'>if</span> (tabline_height() &lt; 1)</td></tr>
<tr class="codeline" data-linenumber="4391"><td class="num" id="LN4391">4391</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="4392"><td class="num" id="LN4392">4392</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4393"><td class="num" id="LN4393">4393</td><td class="line"><span class='directive'>#if defined(FEAT_STL_OPT)</span></td></tr>
<tr class="codeline" data-linenumber="4394"><td class="num" id="LN4394">4394</td><td class="line">    clear_TabPageIdxs();</td></tr>
<tr class="codeline" data-linenumber="4395"><td class="num" id="LN4395">4395</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4396"><td class="num" id="LN4396">4396</td><td class="line">    <span class='comment'>// Use the 'tabline' option if it's set.</span></td></tr>
<tr class="codeline" data-linenumber="4397"><td class="num" id="LN4397">4397</td><td class="line">    <span class='keyword'>if</span> (*p_tal != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4398"><td class="num" id="LN4398">4398</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4399"><td class="num" id="LN4399">4399</td><td class="line">	<span class='keyword'>int</span>	saved_did_emsg = did_emsg;</td></tr>
<tr class="codeline" data-linenumber="4400"><td class="num" id="LN4400">4400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4401"><td class="num" id="LN4401">4401</td><td class="line">	<span class='comment'>// Check for an error.  If there is one we would loop in redrawing the</span></td></tr>
<tr class="codeline" data-linenumber="4402"><td class="num" id="LN4402">4402</td><td class="line">	<span class='comment'>// screen.  Avoid that by making 'tabline' empty.</span></td></tr>
<tr class="codeline" data-linenumber="4403"><td class="num" id="LN4403">4403</td><td class="line">	did_emsg = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4404"><td class="num" id="LN4404">4404</td><td class="line">	win_redr_custom(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>FALSE<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4405"><td class="num" id="LN4405">4405</td><td class="line">	<span class='keyword'>if</span> (did_emsg)</td></tr>
<tr class="codeline" data-linenumber="4406"><td class="num" id="LN4406">4406</td><td class="line">	    set_string_option_direct((char_u *)<span class='string_literal'>"tabline"</span>, -1,</td></tr>
<tr class="codeline" data-linenumber="4407"><td class="num" id="LN4407">4407</td><td class="line">					   (char_u *)<span class='string_literal'>""</span>, <span class='macro'>OPT_FREE<span class='macro_popup'>0x01</span></span>, <span class='macro'>SID_ERROR<span class='macro_popup'>-5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4408"><td class="num" id="LN4408">4408</td><td class="line">	did_emsg |= saved_did_emsg;</td></tr>
<tr class="codeline" data-linenumber="4409"><td class="num" id="LN4409">4409</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4410"><td class="num" id="LN4410">4410</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4411"><td class="num" id="LN4411">4411</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4412"><td class="num" id="LN4412">4412</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4413"><td class="num" id="LN4413">4413</td><td class="line">	<span class='macro'>FOR_ALL_TABPAGES(tp)<span class='macro_popup'>for (tp = first_tabpage; tp != ((void*)0); tp = tp-&gt;tp_next<br>)</span></span></td></tr>
<tr class="codeline" data-linenumber="4414"><td class="num" id="LN4414">4414</td><td class="line">	    ++tabcount;</td></tr>
<tr class="codeline" data-linenumber="4415"><td class="num" id="LN4415">4415</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4416"><td class="num" id="LN4416">4416</td><td class="line">	tabwidth = (Columns - 1 + tabcount / 2) / tabcount;</td></tr>
<tr class="codeline" data-linenumber="4417"><td class="num" id="LN4417">4417</td><td class="line">	<span class='keyword'>if</span> (tabwidth &lt; 6)</td></tr>
<tr class="codeline" data-linenumber="4418"><td class="num" id="LN4418">4418</td><td class="line">	    tabwidth = 6;</td></tr>
<tr class="codeline" data-linenumber="4419"><td class="num" id="LN4419">4419</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4420"><td class="num" id="LN4420">4420</td><td class="line">	attr = attr_nosel;</td></tr>
<tr class="codeline" data-linenumber="4421"><td class="num" id="LN4421">4421</td><td class="line">	tabcount = 0;</td></tr>
<tr class="codeline" data-linenumber="4422"><td class="num" id="LN4422">4422</td><td class="line">	<span class='keyword'>for</span> (tp = first_tabpage; tp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; col &lt; Columns - 4;</td></tr>
<tr class="codeline" data-linenumber="4423"><td class="num" id="LN4423">4423</td><td class="line">							     tp = tp-&gt;tp_next)</td></tr>
<tr class="codeline" data-linenumber="4424"><td class="num" id="LN4424">4424</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4425"><td class="num" id="LN4425">4425</td><td class="line">	    scol = col;</td></tr>
<tr class="codeline" data-linenumber="4426"><td class="num" id="LN4426">4426</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4427"><td class="num" id="LN4427">4427</td><td class="line">	    <span class='keyword'>if</span> (tp-&gt;tp_topframe == topframe)</td></tr>
<tr class="codeline" data-linenumber="4428"><td class="num" id="LN4428">4428</td><td class="line">		attr = attr_sel;</td></tr>
<tr class="codeline" data-linenumber="4429"><td class="num" id="LN4429">4429</td><td class="line">	    <span class='keyword'>if</span> (use_sep_chars &amp;&amp; col &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="4430"><td class="num" id="LN4430">4430</td><td class="line">		screen_putchar('|', 0, col++, attr);</td></tr>
<tr class="codeline" data-linenumber="4431"><td class="num" id="LN4431">4431</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4432"><td class="num" id="LN4432">4432</td><td class="line">	    <span class='keyword'>if</span> (tp-&gt;tp_topframe != topframe)</td></tr>
<tr class="codeline" data-linenumber="4433"><td class="num" id="LN4433">4433</td><td class="line">		attr = attr_nosel;</td></tr>
<tr class="codeline" data-linenumber="4434"><td class="num" id="LN4434">4434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4435"><td class="num" id="LN4435">4435</td><td class="line">	    screen_putchar(' ', 0, col++, attr);</td></tr>
<tr class="codeline" data-linenumber="4436"><td class="num" id="LN4436">4436</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4437"><td class="num" id="LN4437">4437</td><td class="line">	    <span class='keyword'>if</span> (tp == curtab)</td></tr>
<tr class="codeline" data-linenumber="4438"><td class="num" id="LN4438">4438</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4439"><td class="num" id="LN4439">4439</td><td class="line">		cwp = curwin;</td></tr>
<tr class="codeline" data-linenumber="4440"><td class="num" id="LN4440">4440</td><td class="line">		wp = firstwin;</td></tr>
<tr class="codeline" data-linenumber="4441"><td class="num" id="LN4441">4441</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4442"><td class="num" id="LN4442">4442</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4443"><td class="num" id="LN4443">4443</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4444"><td class="num" id="LN4444">4444</td><td class="line">		cwp = tp-&gt;tp_curwin;</td></tr>
<tr class="codeline" data-linenumber="4445"><td class="num" id="LN4445">4445</td><td class="line">		wp = tp-&gt;tp_firstwin;</td></tr>
<tr class="codeline" data-linenumber="4446"><td class="num" id="LN4446">4446</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4447"><td class="num" id="LN4447">4447</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4448"><td class="num" id="LN4448">4448</td><td class="line">	    modified = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4449"><td class="num" id="LN4449">4449</td><td class="line">	    <span class='keyword'>for</span> (wincount = 0; wp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; wp = wp-&gt;w_next, ++wincount)</td></tr>
<tr class="codeline" data-linenumber="4450"><td class="num" id="LN4450">4450</td><td class="line">		<span class='keyword'>if</span> (bufIsChanged(wp-&gt;w_buffer))</td></tr>
<tr class="codeline" data-linenumber="4451"><td class="num" id="LN4451">4451</td><td class="line">		    modified = <span class='macro'>TRUE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4452"><td class="num" id="LN4452">4452</td><td class="line">	    <span class='keyword'>if</span> (modified || wincount &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="4453"><td class="num" id="LN4453">4453</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4454"><td class="num" id="LN4454">4454</td><td class="line">		<span class='keyword'>if</span> (wincount &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="4455"><td class="num" id="LN4455">4455</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4456"><td class="num" id="LN4456">4456</td><td class="line">		    vim_snprintf((<span class='keyword'>char</span> *)NameBuff, <span class='macro'>MAXPATHL<span class='macro_popup'>4096</span></span>, <span class='string_literal'>"%d"</span>, wincount);</td></tr>
<tr class="codeline" data-linenumber="4457"><td class="num" id="LN4457">4457</td><td class="line">		    len = (<span class='keyword'>int</span>)<span class='macro'>STRLEN(NameBuff)<span class='macro_popup'>strlen((char *)(NameBuff))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4458"><td class="num" id="LN4458">4458</td><td class="line">		    <span class='keyword'>if</span> (col + len &gt;= Columns - 3)</td></tr>
<tr class="codeline" data-linenumber="4459"><td class="num" id="LN4459">4459</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4460"><td class="num" id="LN4460">4460</td><td class="line">		    screen_puts_len(NameBuff, len, 0, col,</td></tr>
<tr class="codeline" data-linenumber="4461"><td class="num" id="LN4461">4461</td><td class="line"><span class='directive'>#if defined(FEAT_SYN_HL)</span></td></tr>
<tr class="codeline" data-linenumber="4462"><td class="num" id="LN4462">4462</td><td class="line">					 hl_combine_attr(attr, <span class='macro'>HL_ATTR(HLF_T)<span class='macro_popup'>highlight_attr[(int)(HLF_T)]</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4463"><td class="num" id="LN4463">4463</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="4464"><td class="num" id="LN4464">4464</td><td class="line">					 attr</td></tr>
<tr class="codeline" data-linenumber="4465"><td class="num" id="LN4465">4465</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4466"><td class="num" id="LN4466">4466</td><td class="line">					       );</td></tr>
<tr class="codeline" data-linenumber="4467"><td class="num" id="LN4467">4467</td><td class="line">		    col += len;</td></tr>
<tr class="codeline" data-linenumber="4468"><td class="num" id="LN4468">4468</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4469"><td class="num" id="LN4469">4469</td><td class="line">		<span class='keyword'>if</span> (modified)</td></tr>
<tr class="codeline" data-linenumber="4470"><td class="num" id="LN4470">4470</td><td class="line">		    screen_puts_len((char_u *)<span class='string_literal'>"+"</span>, 1, 0, col++, attr);</td></tr>
<tr class="codeline" data-linenumber="4471"><td class="num" id="LN4471">4471</td><td class="line">		screen_putchar(' ', 0, col++, attr);</td></tr>
<tr class="codeline" data-linenumber="4472"><td class="num" id="LN4472">4472</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4473"><td class="num" id="LN4473">4473</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4474"><td class="num" id="LN4474">4474</td><td class="line">	    room = scol - col + tabwidth - 1;</td></tr>
<tr class="codeline" data-linenumber="4475"><td class="num" id="LN4475">4475</td><td class="line">	    <span class='keyword'>if</span> (room &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="4476"><td class="num" id="LN4476">4476</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4477"><td class="num" id="LN4477">4477</td><td class="line">		<span class='comment'>// Get buffer name in NameBuff[]</span></td></tr>
<tr class="codeline" data-linenumber="4478"><td class="num" id="LN4478">4478</td><td class="line">		get_trans_bufname(cwp-&gt;w_buffer);</td></tr>
<tr class="codeline" data-linenumber="4479"><td class="num" id="LN4479">4479</td><td class="line">		shorten_dir(NameBuff);</td></tr>
<tr class="codeline" data-linenumber="4480"><td class="num" id="LN4480">4480</td><td class="line">		len = vim_strsize(NameBuff);</td></tr>
<tr class="codeline" data-linenumber="4481"><td class="num" id="LN4481">4481</td><td class="line">		p = NameBuff;</td></tr>
<tr class="codeline" data-linenumber="4482"><td class="num" id="LN4482">4482</td><td class="line">		<span class='keyword'>if</span> (has_mbyte)</td></tr>
<tr class="codeline" data-linenumber="4483"><td class="num" id="LN4483">4483</td><td class="line">		    <span class='keyword'>while</span> (len &gt; room)</td></tr>
<tr class="codeline" data-linenumber="4484"><td class="num" id="LN4484">4484</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="4485"><td class="num" id="LN4485">4485</td><td class="line">			len -= ptr2cells(p);</td></tr>
<tr class="codeline" data-linenumber="4486"><td class="num" id="LN4486">4486</td><td class="line">			<span class='macro'>MB_PTR_ADV(p)<span class='macro_popup'>p += (*mb_ptr2len)(p)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4487"><td class="num" id="LN4487">4487</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="4488"><td class="num" id="LN4488">4488</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (len &gt; room)</td></tr>
<tr class="codeline" data-linenumber="4489"><td class="num" id="LN4489">4489</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4490"><td class="num" id="LN4490">4490</td><td class="line">		    p += len - room;</td></tr>
<tr class="codeline" data-linenumber="4491"><td class="num" id="LN4491">4491</td><td class="line">		    len = room;</td></tr>
<tr class="codeline" data-linenumber="4492"><td class="num" id="LN4492">4492</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4493"><td class="num" id="LN4493">4493</td><td class="line">		<span class='keyword'>if</span> (len &gt; Columns - col - 1)</td></tr>
<tr class="codeline" data-linenumber="4494"><td class="num" id="LN4494">4494</td><td class="line">		    len = Columns - col - 1;</td></tr>
<tr class="codeline" data-linenumber="4495"><td class="num" id="LN4495">4495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4496"><td class="num" id="LN4496">4496</td><td class="line">		screen_puts_len(p, (<span class='keyword'>int</span>)<span class='macro'>STRLEN(p)<span class='macro_popup'>strlen((char *)(p))</span></span>, 0, col, attr);</td></tr>
<tr class="codeline" data-linenumber="4497"><td class="num" id="LN4497">4497</td><td class="line">		col += len;</td></tr>
<tr class="codeline" data-linenumber="4498"><td class="num" id="LN4498">4498</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4499"><td class="num" id="LN4499">4499</td><td class="line">	    screen_putchar(' ', 0, col++, attr);</td></tr>
<tr class="codeline" data-linenumber="4500"><td class="num" id="LN4500">4500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4501"><td class="num" id="LN4501">4501</td><td class="line">	    <span class='comment'>// Store the tab page number in TabPageIdxs[], so that</span></td></tr>
<tr class="codeline" data-linenumber="4502"><td class="num" id="LN4502">4502</td><td class="line">	    <span class='comment'>// jump_to_mouse() knows where each one is.</span></td></tr>
<tr class="codeline" data-linenumber="4503"><td class="num" id="LN4503">4503</td><td class="line">	    ++tabcount;</td></tr>
<tr class="codeline" data-linenumber="4504"><td class="num" id="LN4504">4504</td><td class="line">	    <span class='keyword'>while</span> (scol &lt; col)</td></tr>
<tr class="codeline" data-linenumber="4505"><td class="num" id="LN4505">4505</td><td class="line">		TabPageIdxs[scol++] = tabcount;</td></tr>
<tr class="codeline" data-linenumber="4506"><td class="num" id="LN4506">4506</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4507"><td class="num" id="LN4507">4507</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4508"><td class="num" id="LN4508">4508</td><td class="line">	<span class='keyword'>if</span> (use_sep_chars)</td></tr>
<tr class="codeline" data-linenumber="4509"><td class="num" id="LN4509">4509</td><td class="line">	    c = '_';</td></tr>
<tr class="codeline" data-linenumber="4510"><td class="num" id="LN4510">4510</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4511"><td class="num" id="LN4511">4511</td><td class="line">	    c = ' ';</td></tr>
<tr class="codeline" data-linenumber="4512"><td class="num" id="LN4512">4512</td><td class="line">	screen_fill(0, 1, col, (<span class='keyword'>int</span>)Columns, c, c, attr_fill);</td></tr>
<tr class="codeline" data-linenumber="4513"><td class="num" id="LN4513">4513</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4514"><td class="num" id="LN4514">4514</td><td class="line">	<span class='comment'>// Put an "X" for closing the current tab if there are several.</span></td></tr>
<tr class="codeline" data-linenumber="4515"><td class="num" id="LN4515">4515</td><td class="line">	<span class='keyword'>if</span> (first_tabpage-&gt;tp_next != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4516"><td class="num" id="LN4516">4516</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4517"><td class="num" id="LN4517">4517</td><td class="line">	    screen_putchar('X', 0, (<span class='keyword'>int</span>)Columns - 1, attr_nosel);</td></tr>
<tr class="codeline" data-linenumber="4518"><td class="num" id="LN4518">4518</td><td class="line">	    TabPageIdxs[Columns - 1] = -999;</td></tr>
<tr class="codeline" data-linenumber="4519"><td class="num" id="LN4519">4519</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4520"><td class="num" id="LN4520">4520</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4521"><td class="num" id="LN4521">4521</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4522"><td class="num" id="LN4522">4522</td><td class="line">    <span class='comment'>// Reset the flag here again, in case evaluating 'tabline' causes it to be</span></td></tr>
<tr class="codeline" data-linenumber="4523"><td class="num" id="LN4523">4523</td><td class="line">    <span class='comment'>// set.</span></td></tr>
<tr class="codeline" data-linenumber="4524"><td class="num" id="LN4524">4524</td><td class="line">    redraw_tabline = <span class='macro'>FALSE<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4525"><td class="num" id="LN4525">4525</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4526"><td class="num" id="LN4526">4526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4527"><td class="num" id="LN4527">4527</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4528"><td class="num" id="LN4528">4528</td><td class="line"> <span class='comment'>* Get buffer name for "buf" into NameBuff[].</span></td></tr>
<tr class="codeline" data-linenumber="4529"><td class="num" id="LN4529">4529</td><td class="line"> <span class='comment'>* Takes care of special buffer names and translates special characters.</span></td></tr>
<tr class="codeline" data-linenumber="4530"><td class="num" id="LN4530">4530</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4531"><td class="num" id="LN4531">4531</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4532"><td class="num" id="LN4532">4532</td><td class="line">get_trans_bufname(buf_T *buf)</td></tr>
<tr class="codeline" data-linenumber="4533"><td class="num" id="LN4533">4533</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4534"><td class="num" id="LN4534">4534</td><td class="line">    <span class='keyword'>if</span> (buf_spname(buf) != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4535"><td class="num" id="LN4535">4535</td><td class="line">	vim_strncpy(NameBuff, buf_spname(buf), <span class='macro'>MAXPATHL<span class='macro_popup'>4096</span></span> - 1);</td></tr>
<tr class="codeline" data-linenumber="4536"><td class="num" id="LN4536">4536</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4537"><td class="num" id="LN4537">4537</td><td class="line">	home_replace(buf, buf-&gt;b_fname, NameBuff, <span class='macro'>MAXPATHL<span class='macro_popup'>4096</span></span>, <span class='macro'>TRUE<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4538"><td class="num" id="LN4538">4538</td><td class="line">    trans_characters(NameBuff, <span class='macro'>MAXPATHL<span class='macro_popup'>4096</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4539"><td class="num" id="LN4539">4539</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4540"><td class="num" id="LN4540">4540</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4541"><td class="num" id="LN4541">4541</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4542"><td class="num" id="LN4542">4542</td><td class="line"> <span class='comment'>* Get the character to use in a status line.  Get its attributes in "*attr".</span></td></tr>
<tr class="codeline" data-linenumber="4543"><td class="num" id="LN4543">4543</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4544"><td class="num" id="LN4544">4544</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4545"><td class="num" id="LN4545">4545</td><td class="line">fillchar_status(<span class='keyword'>int</span> *attr, win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="4546"><td class="num" id="LN4546">4546</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4547"><td class="num" id="LN4547">4547</td><td class="line">    <span class='keyword'>int</span> fill;</td></tr>
<tr class="codeline" data-linenumber="4548"><td class="num" id="LN4548">4548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4549"><td class="num" id="LN4549">4549</td><td class="line"><span class='directive'>#ifdef <span class='macro'>FEAT_TERMINAL<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="4550"><td class="num" id="LN4550">4550</td><td class="line">    <span class='keyword'>if</span> (bt_terminal(wp-&gt;w_buffer))</td></tr>
<tr class="codeline" data-linenumber="4551"><td class="num" id="LN4551">4551</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4552"><td class="num" id="LN4552">4552</td><td class="line">	<span class='keyword'>if</span> (wp == curwin)</td></tr>
<tr class="codeline" data-linenumber="4553"><td class="num" id="LN4553">4553</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4554"><td class="num" id="LN4554">4554</td><td class="line">	    *attr = <span class='macro'>HL_ATTR(HLF_ST)<span class='macro_popup'>highlight_attr[(int)(HLF_ST)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4555"><td class="num" id="LN4555">4555</td><td class="line">	    fill = fill_stl;</td></tr>
<tr class="codeline" data-linenumber="4556"><td class="num" id="LN4556">4556</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4557"><td class="num" id="LN4557">4557</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4558"><td class="num" id="LN4558">4558</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4559"><td class="num" id="LN4559">4559</td><td class="line">	    *attr = <span class='macro'>HL_ATTR(HLF_STNC)<span class='macro_popup'>highlight_attr[(int)(HLF_STNC)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4560"><td class="num" id="LN4560">4560</td><td class="line">	    fill = fill_stlnc;</td></tr>
<tr class="codeline" data-linenumber="4561"><td class="num" id="LN4561">4561</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4562"><td class="num" id="LN4562">4562</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4563"><td class="num" id="LN4563">4563</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4564"><td class="num" id="LN4564">4564</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4565"><td class="num" id="LN4565">4565</td><td class="line">    <span class='keyword'>if</span> (wp == curwin)</td></tr>
<tr class="codeline" data-linenumber="4566"><td class="num" id="LN4566">4566</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4567"><td class="num" id="LN4567">4567</td><td class="line">	*attr = <span class='macro'>HL_ATTR(HLF_S)<span class='macro_popup'>highlight_attr[(int)(HLF_S)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4568"><td class="num" id="LN4568">4568</td><td class="line">	fill = fill_stl;</td></tr>
<tr class="codeline" data-linenumber="4569"><td class="num" id="LN4569">4569</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4570"><td class="num" id="LN4570">4570</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4571"><td class="num" id="LN4571">4571</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4572"><td class="num" id="LN4572">4572</td><td class="line">	*attr = <span class='macro'>HL_ATTR(HLF_SNC)<span class='macro_popup'>highlight_attr[(int)(HLF_SNC)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4573"><td class="num" id="LN4573">4573</td><td class="line">	fill = fill_stlnc;</td></tr>
<tr class="codeline" data-linenumber="4574"><td class="num" id="LN4574">4574</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4575"><td class="num" id="LN4575">4575</td><td class="line">    <span class='comment'>// Use fill when there is highlighting, and highlighting of current</span></td></tr>
<tr class="codeline" data-linenumber="4576"><td class="num" id="LN4576">4576</td><td class="line">    <span class='comment'>// window differs, or the fillchars differ, or this is not the</span></td></tr>
<tr class="codeline" data-linenumber="4577"><td class="num" id="LN4577">4577</td><td class="line">    <span class='comment'>// current window</span></td></tr>
<tr class="codeline" data-linenumber="4578"><td class="num" id="LN4578">4578</td><td class="line">    <span class='keyword'>if</span> (*attr != 0 &amp;&amp; ((<span class='macro'>HL_ATTR(HLF_S)<span class='macro_popup'>highlight_attr[(int)(HLF_S)]</span></span> != <span class='macro'>HL_ATTR(HLF_SNC)<span class='macro_popup'>highlight_attr[(int)(HLF_SNC)]</span></span></td></tr>
<tr class="codeline" data-linenumber="4579"><td class="num" id="LN4579">4579</td><td class="line">			|| wp != curwin || <span class='macro'>ONE_WINDOW<span class='macro_popup'>(firstwin == lastwin)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4580"><td class="num" id="LN4580">4580</td><td class="line">		    || (fill_stl != fill_stlnc)))</td></tr>
<tr class="codeline" data-linenumber="4581"><td class="num" id="LN4581">4581</td><td class="line">	<span class='keyword'>return</span> fill;</td></tr>
<tr class="codeline" data-linenumber="4582"><td class="num" id="LN4582">4582</td><td class="line">    <span class='keyword'>if</span> (wp == curwin)</td></tr>
<tr class="codeline" data-linenumber="4583"><td class="num" id="LN4583">4583</td><td class="line">	<span class='keyword'>return</span> '^';</td></tr>
<tr class="codeline" data-linenumber="4584"><td class="num" id="LN4584">4584</td><td class="line">    <span class='keyword'>return</span> '=';</td></tr>
<tr class="codeline" data-linenumber="4585"><td class="num" id="LN4585">4585</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4586"><td class="num" id="LN4586">4586</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4587"><td class="num" id="LN4587">4587</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4588"><td class="num" id="LN4588">4588</td><td class="line"> <span class='comment'>* Get the character to use in a separator between vertically split windows.</span></td></tr>
<tr class="codeline" data-linenumber="4589"><td class="num" id="LN4589">4589</td><td class="line"> <span class='comment'>* Get its attributes in "*attr".</span></td></tr>
<tr class="codeline" data-linenumber="4590"><td class="num" id="LN4590">4590</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4591"><td class="num" id="LN4591">4591</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4592"><td class="num" id="LN4592">4592</td><td class="line">fillchar_vsep(<span class='keyword'>int</span> *attr)</td></tr>
<tr class="codeline" data-linenumber="4593"><td class="num" id="LN4593">4593</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4594"><td class="num" id="LN4594">4594</td><td class="line">    *attr = <span class='macro'>HL_ATTR(HLF_C)<span class='macro_popup'>highlight_attr[(int)(HLF_C)]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4595"><td class="num" id="LN4595">4595</td><td class="line">    <span class='keyword'>if</span> (*attr == 0 &amp;&amp; fill_vert == ' ')</td></tr>
<tr class="codeline" data-linenumber="4596"><td class="num" id="LN4596">4596</td><td class="line">	<span class='keyword'>return</span> '|';</td></tr>
<tr class="codeline" data-linenumber="4597"><td class="num" id="LN4597">4597</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4598"><td class="num" id="LN4598">4598</td><td class="line">	<span class='keyword'>return</span> fill_vert;</td></tr>
<tr class="codeline" data-linenumber="4599"><td class="num" id="LN4599">4599</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4600"><td class="num" id="LN4600">4600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4601"><td class="num" id="LN4601">4601</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4602"><td class="num" id="LN4602">4602</td><td class="line"> <span class='comment'>* Return TRUE if redrawing should currently be done.</span></td></tr>
<tr class="codeline" data-linenumber="4603"><td class="num" id="LN4603">4603</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4604"><td class="num" id="LN4604">4604</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4605"><td class="num" id="LN4605">4605</td><td class="line">redrawing(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4606"><td class="num" id="LN4606">4606</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4607"><td class="num" id="LN4607">4607</td><td class="line"><span class='directive'>#ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="4608"><td class="num" id="LN4608">4608</td><td class="line">    <span class='keyword'>if</span> (disable_redraw_for_testing)</td></tr>
<tr class="codeline" data-linenumber="4609"><td class="num" id="LN4609">4609</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4610"><td class="num" id="LN4610">4610</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4611"><td class="num" id="LN4611">4611</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4612"><td class="num" id="LN4612">4612</td><td class="line">	<span class='keyword'>return</span> ((!RedrawingDisabled</td></tr>
<tr class="codeline" data-linenumber="4613"><td class="num" id="LN4613">4613</td><td class="line"><span class='directive'>#ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="4614"><td class="num" id="LN4614">4614</td><td class="line">		    || ignore_redraw_flag_for_testing</td></tr>
<tr class="codeline" data-linenumber="4615"><td class="num" id="LN4615">4615</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4616"><td class="num" id="LN4616">4616</td><td class="line">		) &amp;&amp; !(p_lz &amp;&amp; char_avail() &amp;&amp; !KeyTyped &amp;&amp; !do_redraw));</td></tr>
<tr class="codeline" data-linenumber="4617"><td class="num" id="LN4617">4617</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4618"><td class="num" id="LN4618">4618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4619"><td class="num" id="LN4619">4619</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4620"><td class="num" id="LN4620">4620</td><td class="line"> <span class='comment'>* Return TRUE if printing messages should currently be done.</span></td></tr>
<tr class="codeline" data-linenumber="4621"><td class="num" id="LN4621">4621</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4622"><td class="num" id="LN4622">4622</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4623"><td class="num" id="LN4623">4623</td><td class="line">messaging(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4624"><td class="num" id="LN4624">4624</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4625"><td class="num" id="LN4625">4625</td><td class="line">    <span class='keyword'>return</span> (!(p_lz &amp;&amp; char_avail() &amp;&amp; !KeyTyped));</td></tr>
<tr class="codeline" data-linenumber="4626"><td class="num" id="LN4626">4626</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4627"><td class="num" id="LN4627">4627</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4628"><td class="num" id="LN4628">4628</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4629"><td class="num" id="LN4629">4629</td><td class="line"> <span class='comment'>* Compute columns for ruler and shown command. 'sc_col' is also used to</span></td></tr>
<tr class="codeline" data-linenumber="4630"><td class="num" id="LN4630">4630</td><td class="line"> <span class='comment'>* decide what the maximum length of a message on the status line can be.</span></td></tr>
<tr class="codeline" data-linenumber="4631"><td class="num" id="LN4631">4631</td><td class="line"> <span class='comment'>* If there is a status line for the last window, 'sc_col' is independent</span></td></tr>
<tr class="codeline" data-linenumber="4632"><td class="num" id="LN4632">4632</td><td class="line"> <span class='comment'>* of 'ru_col'.</span></td></tr>
<tr class="codeline" data-linenumber="4633"><td class="num" id="LN4633">4633</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4634"><td class="num" id="LN4634">4634</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4635"><td class="num" id="LN4635">4635</td><td class="line"><span class='directive'>#define <span class='macro'>COL_RULER<span class='macro_popup'>17</span></span> 17	    // columns needed by standard ruler</span></td></tr>
<tr class="codeline" data-linenumber="4636"><td class="num" id="LN4636">4636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4637"><td class="num" id="LN4637">4637</td><td class="line">    <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="4638"><td class="num" id="LN4638">4638</td><td class="line">comp_col(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4639"><td class="num" id="LN4639">4639</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4640"><td class="num" id="LN4640">4640</td><td class="line"><span class='directive'>#if defined(FEAT_CMDL_INFO)</span></td></tr>
<tr class="codeline" data-linenumber="4641"><td class="num" id="LN4641">4641</td><td class="line">    <span class='keyword'>int</span> last_has_status = (p_ls == 2 || (p_ls == 1 &amp;&amp; !<span class='macro'>ONE_WINDOW<span class='macro_popup'>(firstwin == lastwin)</span></span>));</td></tr>
<tr class="codeline" data-linenumber="4642"><td class="num" id="LN4642">4642</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4643"><td class="num" id="LN4643">4643</td><td class="line">    sc_col = 0;</td></tr>
<tr class="codeline" data-linenumber="4644"><td class="num" id="LN4644">4644</td><td class="line">    ru_col = 0;</td></tr>
<tr class="codeline" data-linenumber="4645"><td class="num" id="LN4645">4645</td><td class="line">    <span class='keyword'>if</span> (p_ru)</td></tr>
<tr class="codeline" data-linenumber="4646"><td class="num" id="LN4646">4646</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4647"><td class="num" id="LN4647">4647</td><td class="line"><span class='directive'># ifdef FEAT_STL_OPT</span></td></tr>
<tr class="codeline" data-linenumber="4648"><td class="num" id="LN4648">4648</td><td class="line">	ru_col = (ru_wid ? ru_wid : <span class='macro'>COL_RULER<span class='macro_popup'>17</span></span>) + 1;</td></tr>
<tr class="codeline" data-linenumber="4649"><td class="num" id="LN4649">4649</td><td class="line"><span class='directive'># else</span></td></tr>
<tr class="codeline" data-linenumber="4650"><td class="num" id="LN4650">4650</td><td class="line">	ru_col = <span class='macro'>COL_RULER<span class='macro_popup'>17</span></span> + 1;</td></tr>
<tr class="codeline" data-linenumber="4651"><td class="num" id="LN4651">4651</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="4652"><td class="num" id="LN4652">4652</td><td class="line">	<span class='comment'>// no last status line, adjust sc_col</span></td></tr>
<tr class="codeline" data-linenumber="4653"><td class="num" id="LN4653">4653</td><td class="line">	<span class='keyword'>if</span> (!last_has_status)</td></tr>
<tr class="codeline" data-linenumber="4654"><td class="num" id="LN4654">4654</td><td class="line">	    sc_col = ru_col;</td></tr>
<tr class="codeline" data-linenumber="4655"><td class="num" id="LN4655">4655</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4656"><td class="num" id="LN4656">4656</td><td class="line">    <span class='keyword'>if</span> (p_sc)</td></tr>
<tr class="codeline" data-linenumber="4657"><td class="num" id="LN4657">4657</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4658"><td class="num" id="LN4658">4658</td><td class="line">	sc_col += <span class='macro'>SHOWCMD_COLS<span class='macro_popup'>10</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4659"><td class="num" id="LN4659">4659</td><td class="line">	<span class='keyword'>if</span> (!p_ru || last_has_status)	    <span class='comment'>// no need for separating space</span></td></tr>
<tr class="codeline" data-linenumber="4660"><td class="num" id="LN4660">4660</td><td class="line">	    ++sc_col;</td></tr>
<tr class="codeline" data-linenumber="4661"><td class="num" id="LN4661">4661</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4662"><td class="num" id="LN4662">4662</td><td class="line">    sc_col = Columns - sc_col;</td></tr>
<tr class="codeline" data-linenumber="4663"><td class="num" id="LN4663">4663</td><td class="line">    ru_col = Columns - ru_col;</td></tr>
<tr class="codeline" data-linenumber="4664"><td class="num" id="LN4664">4664</td><td class="line">    <span class='keyword'>if</span> (sc_col &lt;= 0)		<span class='comment'>// screen too narrow, will become a mess</span></td></tr>
<tr class="codeline" data-linenumber="4665"><td class="num" id="LN4665">4665</td><td class="line">	sc_col = 1;</td></tr>
<tr class="codeline" data-linenumber="4666"><td class="num" id="LN4666">4666</td><td class="line">    <span class='keyword'>if</span> (ru_col &lt;= 0)</td></tr>
<tr class="codeline" data-linenumber="4667"><td class="num" id="LN4667">4667</td><td class="line">	ru_col = 1;</td></tr>
<tr class="codeline" data-linenumber="4668"><td class="num" id="LN4668">4668</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="4669"><td class="num" id="LN4669">4669</td><td class="line">    sc_col = Columns;</td></tr>
<tr class="codeline" data-linenumber="4670"><td class="num" id="LN4670">4670</td><td class="line">    ru_col = Columns;</td></tr>
<tr class="codeline" data-linenumber="4671"><td class="num" id="LN4671">4671</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4672"><td class="num" id="LN4672">4672</td><td class="line"><span class='directive'>#ifdef FEAT_EVAL</span></td></tr>
<tr class="codeline" data-linenumber="4673"><td class="num" id="LN4673">4673</td><td class="line">    set_vim_var_nr(<span class='macro'>VV_ECHOSPACE<span class='macro_popup'>93</span></span>, sc_col - 1);</td></tr>
<tr class="codeline" data-linenumber="4674"><td class="num" id="LN4674">4674</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4675"><td class="num" id="LN4675">4675</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4676"><td class="num" id="LN4676">4676</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4677"><td class="num" id="LN4677">4677</td><td class="line"><span class='directive'>#if defined(FEAT_LINEBREAK) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="4678"><td class="num" id="LN4678">4678</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4679"><td class="num" id="LN4679">4679</td><td class="line"> <span class='comment'>* Return the width of the 'number' and 'relativenumber' column.</span></td></tr>
<tr class="codeline" data-linenumber="4680"><td class="num" id="LN4680">4680</td><td class="line"> <span class='comment'>* Caller may need to check if 'number' or 'relativenumber' is set.</span></td></tr>
<tr class="codeline" data-linenumber="4681"><td class="num" id="LN4681">4681</td><td class="line"> <span class='comment'>* Otherwise it depends on 'numberwidth' and the line count.</span></td></tr>
<tr class="codeline" data-linenumber="4682"><td class="num" id="LN4682">4682</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4683"><td class="num" id="LN4683">4683</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4684"><td class="num" id="LN4684">4684</td><td class="line">number_width(win_T *wp)</td></tr>
<tr class="codeline" data-linenumber="4685"><td class="num" id="LN4685">4685</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4686"><td class="num" id="LN4686">4686</td><td class="line">    <span class='keyword'>int</span>		n;</td></tr>
<tr class="codeline" data-linenumber="4687"><td class="num" id="LN4687">4687</td><td class="line">    linenr_T	lnum;</td></tr>
<tr class="codeline" data-linenumber="4688"><td class="num" id="LN4688">4688</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4689"><td class="num" id="LN4689">4689</td><td class="line">    <span class='keyword'>if</span> (wp-&gt;<span class='macro'>w_p_rnu<span class='macro_popup'>w_onebuf_opt.wo_rnu</span></span> &amp;&amp; !wp-&gt;<span class='macro'>w_p_nu<span class='macro_popup'>w_onebuf_opt.wo_nu</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4690"><td class="num" id="LN4690">4690</td><td class="line">	<span class='comment'>// cursor line shows "0"</span></td></tr>
<tr class="codeline" data-linenumber="4691"><td class="num" id="LN4691">4691</td><td class="line">	lnum = wp-&gt;w_height;</td></tr>
<tr class="codeline" data-linenumber="4692"><td class="num" id="LN4692">4692</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4693"><td class="num" id="LN4693">4693</td><td class="line">	<span class='comment'>// cursor line shows absolute line number</span></td></tr>
<tr class="codeline" data-linenumber="4694"><td class="num" id="LN4694">4694</td><td class="line">	lnum = wp-&gt;w_buffer-&gt;b_ml.ml_line_count;</td></tr>
<tr class="codeline" data-linenumber="4695"><td class="num" id="LN4695">4695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4696"><td class="num" id="LN4696">4696</td><td class="line">    <span class='keyword'>if</span> (lnum == wp-&gt;w_nrwidth_line_count &amp;&amp; wp-&gt;w_nuw_cached == wp-&gt;<span class='macro'>w_p_nuw<span class='macro_popup'>w_onebuf_opt.wo_nuw</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4697"><td class="num" id="LN4697">4697</td><td class="line">	<span class='keyword'>return</span> wp-&gt;w_nrwidth_width;</td></tr>
<tr class="codeline" data-linenumber="4698"><td class="num" id="LN4698">4698</td><td class="line">    wp-&gt;w_nrwidth_line_count = lnum;</td></tr>
<tr class="codeline" data-linenumber="4699"><td class="num" id="LN4699">4699</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4700"><td class="num" id="LN4700">4700</td><td class="line">    n = 0;</td></tr>
<tr class="codeline" data-linenumber="4701"><td class="num" id="LN4701">4701</td><td class="line">    <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="4702"><td class="num" id="LN4702">4702</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4703"><td class="num" id="LN4703">4703</td><td class="line">	lnum /= 10;</td></tr>
<tr class="codeline" data-linenumber="4704"><td class="num" id="LN4704">4704</td><td class="line">	++n;</td></tr>
<tr class="codeline" data-linenumber="4705"><td class="num" id="LN4705">4705</td><td class="line">    } <span class='keyword'>while</span> (lnum &gt; 0);</td></tr>
<tr class="codeline" data-linenumber="4706"><td class="num" id="LN4706">4706</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4707"><td class="num" id="LN4707">4707</td><td class="line">    <span class='comment'>// 'numberwidth' gives the minimal width plus one</span></td></tr>
<tr class="codeline" data-linenumber="4708"><td class="num" id="LN4708">4708</td><td class="line">    <span class='keyword'>if</span> (n &lt; wp-&gt;<span class='macro'>w_p_nuw<span class='macro_popup'>w_onebuf_opt.wo_nuw</span></span> - 1)</td></tr>
<tr class="codeline" data-linenumber="4709"><td class="num" id="LN4709">4709</td><td class="line">	n = wp-&gt;<span class='macro'>w_p_nuw<span class='macro_popup'>w_onebuf_opt.wo_nuw</span></span> - 1;</td></tr>
<tr class="codeline" data-linenumber="4710"><td class="num" id="LN4710">4710</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4711"><td class="num" id="LN4711">4711</td><td class="line"><span class='directive'># ifdef FEAT_SIGNS</span></td></tr>
<tr class="codeline" data-linenumber="4712"><td class="num" id="LN4712">4712</td><td class="line">    <span class='comment'>// If 'signcolumn' is set to 'number' and there is a sign to display, then</span></td></tr>
<tr class="codeline" data-linenumber="4713"><td class="num" id="LN4713">4713</td><td class="line">    <span class='comment'>// the minimal width for the number column is 2.</span></td></tr>
<tr class="codeline" data-linenumber="4714"><td class="num" id="LN4714">4714</td><td class="line">    <span class='keyword'>if</span> (n &lt; 2 &amp;&amp; get_first_valid_sign(wp) != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></td></tr>
<tr class="codeline" data-linenumber="4715"><td class="num" id="LN4715">4715</td><td class="line">	    &amp;&amp; (*wp-&gt;<span class='macro'>w_p_scl<span class='macro_popup'>w_onebuf_opt.wo_scl</span></span> == 'n' &amp;&amp; *(wp-&gt;<span class='macro'>w_p_scl<span class='macro_popup'>w_onebuf_opt.wo_scl</span></span> + 1) == 'u'))</td></tr>
<tr class="codeline" data-linenumber="4716"><td class="num" id="LN4716">4716</td><td class="line">	n = 2;</td></tr>
<tr class="codeline" data-linenumber="4717"><td class="num" id="LN4717">4717</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="4718"><td class="num" id="LN4718">4718</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4719"><td class="num" id="LN4719">4719</td><td class="line">    wp-&gt;w_nrwidth_width = n;</td></tr>
<tr class="codeline" data-linenumber="4720"><td class="num" id="LN4720">4720</td><td class="line">    wp-&gt;w_nuw_cached = wp-&gt;<span class='macro'>w_p_nuw<span class='macro_popup'>w_onebuf_opt.wo_nuw</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4721"><td class="num" id="LN4721">4721</td><td class="line">    <span class='keyword'>return</span> n;</td></tr>
<tr class="codeline" data-linenumber="4722"><td class="num" id="LN4722">4722</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4723"><td class="num" id="LN4723">4723</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4724"><td class="num" id="LN4724">4724</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4725"><td class="num" id="LN4725">4725</td><td class="line"><span class='directive'>#if defined(FEAT_EVAL) || defined(PROTO)</span></td></tr>
<tr class="codeline" data-linenumber="4726"><td class="num" id="LN4726">4726</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4727"><td class="num" id="LN4727">4727</td><td class="line"> <span class='comment'>* Return the current cursor column. This is the actual position on the</span></td></tr>
<tr class="codeline" data-linenumber="4728"><td class="num" id="LN4728">4728</td><td class="line"> <span class='comment'>* screen. First column is 0.</span></td></tr>
<tr class="codeline" data-linenumber="4729"><td class="num" id="LN4729">4729</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4730"><td class="num" id="LN4730">4730</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4731"><td class="num" id="LN4731">4731</td><td class="line">screen_screencol(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4732"><td class="num" id="LN4732">4732</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4733"><td class="num" id="LN4733">4733</td><td class="line">    <span class='keyword'>return</span> screen_cur_col;</td></tr>
<tr class="codeline" data-linenumber="4734"><td class="num" id="LN4734">4734</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4735"><td class="num" id="LN4735">4735</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4736"><td class="num" id="LN4736">4736</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4737"><td class="num" id="LN4737">4737</td><td class="line"> <span class='comment'>* Return the current cursor row. This is the actual position on the screen.</span></td></tr>
<tr class="codeline" data-linenumber="4738"><td class="num" id="LN4738">4738</td><td class="line"> <span class='comment'>* First row is 0.</span></td></tr>
<tr class="codeline" data-linenumber="4739"><td class="num" id="LN4739">4739</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4740"><td class="num" id="LN4740">4740</td><td class="line">    <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="4741"><td class="num" id="LN4741">4741</td><td class="line">screen_screenrow(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="4742"><td class="num" id="LN4742">4742</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4743"><td class="num" id="LN4743">4743</td><td class="line">    <span class='keyword'>return</span> screen_cur_row;</td></tr>
<tr class="codeline" data-linenumber="4744"><td class="num" id="LN4744">4744</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4745"><td class="num" id="LN4745">4745</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4746"><td class="num" id="LN4746">4746</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4747"><td class="num" id="LN4747">4747</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4748"><td class="num" id="LN4748">4748</td><td class="line"> <span class='comment'>* Handle setting 'listchars' or 'fillchars'.</span></td></tr>
<tr class="codeline" data-linenumber="4749"><td class="num" id="LN4749">4749</td><td class="line"> <span class='comment'>* Returns error message, NULL if it's OK.</span></td></tr>
<tr class="codeline" data-linenumber="4750"><td class="num" id="LN4750">4750</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4751"><td class="num" id="LN4751">4751</td><td class="line">    <span class='keyword'>char</span> *</td></tr>
<tr class="codeline" data-linenumber="4752"><td class="num" id="LN4752">4752</td><td class="line">set_chars_option(char_u **varp)</td></tr>
<tr class="codeline" data-linenumber="4753"><td class="num" id="LN4753">4753</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4754"><td class="num" id="LN4754">4754</td><td class="line">    <span class='keyword'>int</span>		round, i, len, entries;</td></tr>
<tr class="codeline" data-linenumber="4755"><td class="num" id="LN4755">4755</td><td class="line">    char_u	*p, *s;</td></tr>
<tr class="codeline" data-linenumber="4756"><td class="num" id="LN4756">4756</td><td class="line">    <span class='keyword'>int</span>		c1 = 0, c2 = 0, c3 = 0;</td></tr>
<tr class="codeline" data-linenumber="4757"><td class="num" id="LN4757">4757</td><td class="line">    <span class='keyword'>struct</span> charstab</td></tr>
<tr class="codeline" data-linenumber="4758"><td class="num" id="LN4758">4758</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4759"><td class="num" id="LN4759">4759</td><td class="line">	<span class='keyword'>int</span>	*cp;</td></tr>
<tr class="codeline" data-linenumber="4760"><td class="num" id="LN4760">4760</td><td class="line">	<span class='keyword'>char</span>	*name;</td></tr>
<tr class="codeline" data-linenumber="4761"><td class="num" id="LN4761">4761</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="4762"><td class="num" id="LN4762">4762</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>struct</span> charstab filltab[] =</td></tr>
<tr class="codeline" data-linenumber="4763"><td class="num" id="LN4763">4763</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4764"><td class="num" id="LN4764">4764</td><td class="line">	{&amp;fill_stl,	<span class='string_literal'>"stl"</span>},</td></tr>
<tr class="codeline" data-linenumber="4765"><td class="num" id="LN4765">4765</td><td class="line">	{&amp;fill_stlnc,	<span class='string_literal'>"stlnc"</span>},</td></tr>
<tr class="codeline" data-linenumber="4766"><td class="num" id="LN4766">4766</td><td class="line">	{&amp;fill_vert,	<span class='string_literal'>"vert"</span>},</td></tr>
<tr class="codeline" data-linenumber="4767"><td class="num" id="LN4767">4767</td><td class="line">	{&amp;fill_fold,	<span class='string_literal'>"fold"</span>},</td></tr>
<tr class="codeline" data-linenumber="4768"><td class="num" id="LN4768">4768</td><td class="line">	{&amp;fill_diff,	<span class='string_literal'>"diff"</span>},</td></tr>
<tr class="codeline" data-linenumber="4769"><td class="num" id="LN4769">4769</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="4770"><td class="num" id="LN4770">4770</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>struct</span> charstab lcstab[] =</td></tr>
<tr class="codeline" data-linenumber="4771"><td class="num" id="LN4771">4771</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4772"><td class="num" id="LN4772">4772</td><td class="line">	{&amp;lcs_eol,	<span class='string_literal'>"eol"</span>},</td></tr>
<tr class="codeline" data-linenumber="4773"><td class="num" id="LN4773">4773</td><td class="line">	{&amp;lcs_ext,	<span class='string_literal'>"extends"</span>},</td></tr>
<tr class="codeline" data-linenumber="4774"><td class="num" id="LN4774">4774</td><td class="line">	{&amp;lcs_nbsp,	<span class='string_literal'>"nbsp"</span>},</td></tr>
<tr class="codeline" data-linenumber="4775"><td class="num" id="LN4775">4775</td><td class="line">	{&amp;lcs_prec,	<span class='string_literal'>"precedes"</span>},</td></tr>
<tr class="codeline" data-linenumber="4776"><td class="num" id="LN4776">4776</td><td class="line">	{&amp;lcs_space,	<span class='string_literal'>"space"</span>},</td></tr>
<tr class="codeline" data-linenumber="4777"><td class="num" id="LN4777">4777</td><td class="line">	{&amp;lcs_tab2,	<span class='string_literal'>"tab"</span>},</td></tr>
<tr class="codeline" data-linenumber="4778"><td class="num" id="LN4778">4778</td><td class="line">	{&amp;lcs_trail,	<span class='string_literal'>"trail"</span>},</td></tr>
<tr class="codeline" data-linenumber="4779"><td class="num" id="LN4779">4779</td><td class="line"><span class='directive'>#ifdef FEAT_CONCEAL</span></td></tr>
<tr class="codeline" data-linenumber="4780"><td class="num" id="LN4780">4780</td><td class="line">	{&amp;lcs_conceal,	<span class='string_literal'>"conceal"</span>},</td></tr>
<tr class="codeline" data-linenumber="4781"><td class="num" id="LN4781">4781</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="4782"><td class="num" id="LN4782">4782</td><td class="line">	{<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,		<span class='string_literal'>"conceal"</span>},</td></tr>
<tr class="codeline" data-linenumber="4783"><td class="num" id="LN4783">4783</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4784"><td class="num" id="LN4784">4784</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="4785"><td class="num" id="LN4785">4785</td><td class="line">    <span class='keyword'>struct</span> charstab *tab;</td></tr>
<tr class="codeline" data-linenumber="4786"><td class="num" id="LN4786">4786</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4787"><td class="num" id="LN4787">4787</td><td class="line">    <span class='keyword'>if</span> (varp == &amp;p_lcs)</td></tr>
<tr class="codeline" data-linenumber="4788"><td class="num" id="LN4788">4788</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4789"><td class="num" id="LN4789">4789</td><td class="line">	tab = lcstab;</td></tr>
<tr class="codeline" data-linenumber="4790"><td class="num" id="LN4790">4790</td><td class="line">	entries = <span class='keyword'>sizeof</span>(lcstab) / <span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> charstab);</td></tr>
<tr class="codeline" data-linenumber="4791"><td class="num" id="LN4791">4791</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4792"><td class="num" id="LN4792">4792</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4793"><td class="num" id="LN4793">4793</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4794"><td class="num" id="LN4794">4794</td><td class="line">	tab = filltab;</td></tr>
<tr class="codeline" data-linenumber="4795"><td class="num" id="LN4795">4795</td><td class="line">	entries = <span class='keyword'>sizeof</span>(filltab) / <span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> charstab);</td></tr>
<tr class="codeline" data-linenumber="4796"><td class="num" id="LN4796">4796</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4797"><td class="num" id="LN4797">4797</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4798"><td class="num" id="LN4798">4798</td><td class="line">    <span class='comment'>// first round: check for valid value, second round: assign values</span></td></tr>
<tr class="codeline" data-linenumber="4799"><td class="num" id="LN4799">4799</td><td class="line">    <span class='keyword'>for</span> (round = 0; round &lt;= 1; ++round)</td></tr>
<tr class="codeline" data-linenumber="4800"><td class="num" id="LN4800">4800</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4801"><td class="num" id="LN4801">4801</td><td class="line">	<span class='keyword'>if</span> (round &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="4802"><td class="num" id="LN4802">4802</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4803"><td class="num" id="LN4803">4803</td><td class="line">	    <span class='comment'>// After checking that the value is valid: set defaults: space for</span></td></tr>
<tr class="codeline" data-linenumber="4804"><td class="num" id="LN4804">4804</td><td class="line">	    <span class='comment'>// 'fillchars', NUL for 'listchars'</span></td></tr>
<tr class="codeline" data-linenumber="4805"><td class="num" id="LN4805">4805</td><td class="line">	    <span class='keyword'>for</span> (i = 0; i &lt; entries; ++i)</td></tr>
<tr class="codeline" data-linenumber="4806"><td class="num" id="LN4806">4806</td><td class="line">		<span class='keyword'>if</span> (tab[i].cp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4807"><td class="num" id="LN4807">4807</td><td class="line">		    *(tab[i].cp) = (varp == &amp;p_lcs ? <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span> : ' ');</td></tr>
<tr class="codeline" data-linenumber="4808"><td class="num" id="LN4808">4808</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4809"><td class="num" id="LN4809">4809</td><td class="line">	    <span class='keyword'>if</span> (varp == &amp;p_lcs)</td></tr>
<tr class="codeline" data-linenumber="4810"><td class="num" id="LN4810">4810</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4811"><td class="num" id="LN4811">4811</td><td class="line">		lcs_tab1 = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4812"><td class="num" id="LN4812">4812</td><td class="line">		lcs_tab3 = <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4813"><td class="num" id="LN4813">4813</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4814"><td class="num" id="LN4814">4814</td><td class="line">	    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4815"><td class="num" id="LN4815">4815</td><td class="line">		fill_diff = '-';</td></tr>
<tr class="codeline" data-linenumber="4816"><td class="num" id="LN4816">4816</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4817"><td class="num" id="LN4817">4817</td><td class="line">	p = *varp;</td></tr>
<tr class="codeline" data-linenumber="4818"><td class="num" id="LN4818">4818</td><td class="line">	<span class='keyword'>while</span> (*p)</td></tr>
<tr class="codeline" data-linenumber="4819"><td class="num" id="LN4819">4819</td><td class="line">	{</td></tr>
<tr class="codeline" data-linenumber="4820"><td class="num" id="LN4820">4820</td><td class="line">	    <span class='keyword'>for</span> (i = 0; i &lt; entries; ++i)</td></tr>
<tr class="codeline" data-linenumber="4821"><td class="num" id="LN4821">4821</td><td class="line">	    {</td></tr>
<tr class="codeline" data-linenumber="4822"><td class="num" id="LN4822">4822</td><td class="line">		len = (<span class='keyword'>int</span>)<span class='macro'>STRLEN(tab[i].name)<span class='macro_popup'>strlen((char *)(tab[i].name))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4823"><td class="num" id="LN4823">4823</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>STRNCMP(p, tab[i].name, len)<span class='macro_popup'>strncmp((char *)(p), (char *)(tab[i].name), (size_t)(len))</span></span> == 0</td></tr>
<tr class="codeline" data-linenumber="4824"><td class="num" id="LN4824">4824</td><td class="line">			&amp;&amp; p[len] == ':'</td></tr>
<tr class="codeline" data-linenumber="4825"><td class="num" id="LN4825">4825</td><td class="line">			&amp;&amp; p[len + 1] != <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4826"><td class="num" id="LN4826">4826</td><td class="line">		{</td></tr>
<tr class="codeline" data-linenumber="4827"><td class="num" id="LN4827">4827</td><td class="line">		    c2 = c3 = 0;</td></tr>
<tr class="codeline" data-linenumber="4828"><td class="num" id="LN4828">4828</td><td class="line">		    s = p + len + 1;</td></tr>
<tr class="codeline" data-linenumber="4829"><td class="num" id="LN4829">4829</td><td class="line">		    c1 = mb_ptr2char_adv(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="4830"><td class="num" id="LN4830">4830</td><td class="line">		    <span class='keyword'>if</span> (mb_char2cells(c1) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="4831"><td class="num" id="LN4831">4831</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="4832"><td class="num" id="LN4832">4832</td><td class="line">		    <span class='keyword'>if</span> (tab[i].cp == &amp;lcs_tab2)</td></tr>
<tr class="codeline" data-linenumber="4833"><td class="num" id="LN4833">4833</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="4834"><td class="num" id="LN4834">4834</td><td class="line">			<span class='keyword'>if</span> (*s == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4835"><td class="num" id="LN4835">4835</td><td class="line">			    <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="4836"><td class="num" id="LN4836">4836</td><td class="line">			c2 = mb_ptr2char_adv(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="4837"><td class="num" id="LN4837">4837</td><td class="line">			<span class='keyword'>if</span> (mb_char2cells(c2) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="4838"><td class="num" id="LN4838">4838</td><td class="line">			    <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="4839"><td class="num" id="LN4839">4839</td><td class="line">			<span class='keyword'>if</span> (!(*s == ',' || *s == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4840"><td class="num" id="LN4840">4840</td><td class="line">			{</td></tr>
<tr class="codeline" data-linenumber="4841"><td class="num" id="LN4841">4841</td><td class="line">			    c3 = mb_ptr2char_adv(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="4842"><td class="num" id="LN4842">4842</td><td class="line">			    <span class='keyword'>if</span> (mb_char2cells(c3) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="4843"><td class="num" id="LN4843">4843</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="4844"><td class="num" id="LN4844">4844</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="4845"><td class="num" id="LN4845">4845</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="4846"><td class="num" id="LN4846">4846</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4847"><td class="num" id="LN4847">4847</td><td class="line">		    <span class='keyword'>if</span> (*s == ',' || *s == <span class='macro'>NUL<span class='macro_popup'>'\000'</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4848"><td class="num" id="LN4848">4848</td><td class="line">		    {</td></tr>
<tr class="codeline" data-linenumber="4849"><td class="num" id="LN4849">4849</td><td class="line">			<span class='keyword'>if</span> (round)</td></tr>
<tr class="codeline" data-linenumber="4850"><td class="num" id="LN4850">4850</td><td class="line">			{</td></tr>
<tr class="codeline" data-linenumber="4851"><td class="num" id="LN4851">4851</td><td class="line">			    <span class='keyword'>if</span> (tab[i].cp == &amp;lcs_tab2)</td></tr>
<tr class="codeline" data-linenumber="4852"><td class="num" id="LN4852">4852</td><td class="line">			    {</td></tr>
<tr class="codeline" data-linenumber="4853"><td class="num" id="LN4853">4853</td><td class="line">				lcs_tab1 = c1;</td></tr>
<tr class="codeline" data-linenumber="4854"><td class="num" id="LN4854">4854</td><td class="line">				lcs_tab2 = c2;</td></tr>
<tr class="codeline" data-linenumber="4855"><td class="num" id="LN4855">4855</td><td class="line">				lcs_tab3 = c3;</td></tr>
<tr class="codeline" data-linenumber="4856"><td class="num" id="LN4856">4856</td><td class="line">			    }</td></tr>
<tr class="codeline" data-linenumber="4857"><td class="num" id="LN4857">4857</td><td class="line">			    <span class='keyword'>else</span> <span class='keyword'>if</span> (tab[i].cp != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="4858"><td class="num" id="LN4858">4858</td><td class="line">				*(tab[i].cp) = c1;</td></tr>
<tr class="codeline" data-linenumber="4859"><td class="num" id="LN4859">4859</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4860"><td class="num" id="LN4860">4860</td><td class="line">			}</td></tr>
<tr class="codeline" data-linenumber="4861"><td class="num" id="LN4861">4861</td><td class="line">			p = s;</td></tr>
<tr class="codeline" data-linenumber="4862"><td class="num" id="LN4862">4862</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4863"><td class="num" id="LN4863">4863</td><td class="line">		    }</td></tr>
<tr class="codeline" data-linenumber="4864"><td class="num" id="LN4864">4864</td><td class="line">		}</td></tr>
<tr class="codeline" data-linenumber="4865"><td class="num" id="LN4865">4865</td><td class="line">	    }</td></tr>
<tr class="codeline" data-linenumber="4866"><td class="num" id="LN4866">4866</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4867"><td class="num" id="LN4867">4867</td><td class="line">	    <span class='keyword'>if</span> (i == entries)</td></tr>
<tr class="codeline" data-linenumber="4868"><td class="num" id="LN4868">4868</td><td class="line">		<span class='keyword'>return</span> e_invarg;</td></tr>
<tr class="codeline" data-linenumber="4869"><td class="num" id="LN4869">4869</td><td class="line">	    <span class='keyword'>if</span> (*p == ',')</td></tr>
<tr class="codeline" data-linenumber="4870"><td class="num" id="LN4870">4870</td><td class="line">		++p;</td></tr>
<tr class="codeline" data-linenumber="4871"><td class="num" id="LN4871">4871</td><td class="line">	}</td></tr>
<tr class="codeline" data-linenumber="4872"><td class="num" id="LN4872">4872</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4873"><td class="num" id="LN4873">4873</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4874"><td class="num" id="LN4874">4874</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;	<span class='comment'>// no error</span></td></tr>
<tr class="codeline" data-linenumber="4875"><td class="num" id="LN4875">4875</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4876"><td class="num" id="LN4876">4876</td><td class="line"> </td></tr>
</table></body></html>
