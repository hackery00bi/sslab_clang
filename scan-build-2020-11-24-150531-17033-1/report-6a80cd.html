<!doctype html>
<html>
<head>
<title>src/stb_image_write.h</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memmove' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memmove_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memmove' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/sslab_clang/c_darknet/darknet/src/stb_image_write.h -->

<!-- FILENAME stb_image_write.h -->

<!-- FUNCTIONNAME stbi_write_png_to_mem -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 710a712600f428b12fd01de70f690ae3 -->

<!-- BUGLINE 1093 -->

<!-- BUGCOLUMN 4 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>src/stb_image_write.h</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 1093, column 4</a><br />Call to function 'memmove' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memmove_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name image.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model pic -pic-level 2 -mframe-pointer=none -menable-no-infs -menable-no-nans -menable-unsafe-fp-math -fno-signed-zeros -mreassociate -freciprocal-math -fdenormal-fp-math=preserve-sign,preserve-sign -ffp-contract=fast -fno-rounding-math -ffast-math -ffinite-math-only -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I include/ -I src/ -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -Ofast -Wno-unused-result -Wno-unknown-pragmas -fdebug-compilation-dir /tmp/sslab_clang/c_darknet/darknet -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-24-150531-17033-1 -x c ./src/image.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"18894": {"1093": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="18894">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/* stb_image_write - v1.09 - public domain - http://nothings.org/stb/stb_image_write.h</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line">   <span class='comment'>writes out PNG/BMP/TGA/JPEG/HDR images to C stdio - Sean Barrett 2010-2015</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line">                                     <span class='comment'>no warranty implied; use at your own risk</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line">   <span class='comment'>Before #including,</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line">       <span class='comment'>#define STB_IMAGE_WRITE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line">   <span class='comment'>in the file that you want to have the implementation.</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line">   <span class='comment'>Will probably not work correctly with strict-aliasing optimizations.</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line">   <span class='comment'>If using a modern Microsoft Compiler, non-safe versions of CRT calls may cause</span> </td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line">   <span class='comment'>compilation warnings or even errors. To avoid this, also before #including,</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line">       <span class='comment'>#define STBI_MSC_SECURE_CRT</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='comment'>ABOUT:</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line">   <span class='comment'>This header file is a library for writing images to C stdio. It could be</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line">   <span class='comment'>adapted to write to memory or a general streaming interface; let me know.</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line">   <span class='comment'>The PNG output is not optimal; it is 20-50% larger than the file</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line">   <span class='comment'>written by a decent optimizing implementation; though providing a custom</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line">   <span class='comment'>zlib compress function (see STBIW_ZLIB_COMPRESS) can mitigate that.</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">   <span class='comment'>This library is designed for source code compactness and simplicity,</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">   <span class='comment'>not optimal image file size or run-time performance.</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='comment'>BUILDING:</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">   <span class='comment'>You can #define STBIW_ASSERT(x) before the #include to avoid using assert.h.</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">   <span class='comment'>You can #define STBIW_MALLOC(), STBIW_REALLOC(), and STBIW_FREE() to replace</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">   <span class='comment'>malloc,realloc,free.</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">   <span class='comment'>You can #define STBIW_MEMMOVE() to replace memmove()</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">   <span class='comment'>You can #define STBIW_ZLIB_COMPRESS to use a custom zlib-style compress function</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">   <span class='comment'>for PNG compression (instead of the builtin one), it must have the following signature:</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">   <span class='comment'>unsigned char * my_compress(unsigned char *data, int data_len, int *out_len, int quality);</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">   <span class='comment'>The returned data will be freed with STBIW_FREE() (free() by default),</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">   <span class='comment'>so it must be heap allocated with STBIW_MALLOC() (malloc() by default),</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='comment'>USAGE:</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">   <span class='comment'>There are five functions, one for each image file format:</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">     <span class='comment'>int stbi_write_png(char const *filename, int w, int h, int comp, const void *data, int stride_in_bytes);</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">     <span class='comment'>int stbi_write_bmp(char const *filename, int w, int h, int comp, const void *data);</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">     <span class='comment'>int stbi_write_tga(char const *filename, int w, int h, int comp, const void *data);</span></td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">     <span class='comment'>int stbi_write_jpg(char const *filename, int w, int h, int comp, const void *data, int quality);</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">     <span class='comment'>int stbi_write_hdr(char const *filename, int w, int h, int comp, const float *data);</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">     <span class='comment'>void stbi_flip_vertically_on_write(int flag); // flag is non-zero to flip data vertically</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">   <span class='comment'>There are also five equivalent functions that use an arbitrary write function. You are</span></td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">   <span class='comment'>expected to open/close your file-equivalent before and after calling these:</span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">     <span class='comment'>int stbi_write_png_to_func(stbi_write_func *func, void *context, int w, int h, int comp, const void  *data, int stride_in_bytes);</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">     <span class='comment'>int stbi_write_bmp_to_func(stbi_write_func *func, void *context, int w, int h, int comp, const void  *data);</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">     <span class='comment'>int stbi_write_tga_to_func(stbi_write_func *func, void *context, int w, int h, int comp, const void  *data);</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">     <span class='comment'>int stbi_write_hdr_to_func(stbi_write_func *func, void *context, int w, int h, int comp, const float *data);</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">     <span class='comment'>int stbi_write_jpg_to_func(stbi_write_func *func, void *context, int x, int y, int comp, const void *data, int quality);</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">   <span class='comment'>where the callback is:</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">      <span class='comment'>void stbi_write_func(void *context, void *data, int size);</span></td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">   <span class='comment'>You can configure it with these global variables:</span></td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">      <span class='comment'>int stbi_write_tga_with_rle;             // defaults to true; set to 0 to disable RLE</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">      <span class='comment'>int stbi_write_png_compression_level;    // defaults to 8; set to higher for more compression</span></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">      <span class='comment'>int stbi_write_force_png_filter;         // defaults to -1; set to 0..5 to force a filter mode</span></td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">   <span class='comment'>You can define STBI_WRITE_NO_STDIO to disable the file variant of these</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">   <span class='comment'>functions, so the library will not use stdio.h at all. However, this will</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">   <span class='comment'>also disable HDR writing, because it requires stdio for formatted output.</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">   <span class='comment'>Each function returns 0 on failure and non-0 on success.</span></td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">   <span class='comment'>The functions create an image file defined by the parameters. The image</span></td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">   <span class='comment'>is a rectangle of pixels stored from left-to-right, top-to-bottom.</span></td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">   <span class='comment'>Each pixel contains 'comp' channels of data stored interleaved with 8-bits</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">   <span class='comment'>per channel, in the following order: 1=Y, 2=YA, 3=RGB, 4=RGBA. (Y is</span></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">   <span class='comment'>monochrome color.) The rectangle is 'w' pixels wide and 'h' pixels tall.</span></td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">   <span class='comment'>The *data pointer points to the first byte of the top-left-most pixel.</span></td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">   <span class='comment'>For PNG, "stride_in_bytes" is the distance in bytes from the first byte of</span></td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">   <span class='comment'>a row of pixels to the first byte of the next row of pixels.</span></td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">   <span class='comment'>PNG creates output files with the same number of components as the input.</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">   <span class='comment'>The BMP format expands Y to RGB in the file format and does not</span></td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">   <span class='comment'>output alpha.</span></td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">   <span class='comment'>PNG supports writing rectangles of data even when the bytes storing rows of</span></td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">   <span class='comment'>data are not consecutive in memory (e.g. sub-rectangles of a larger image),</span></td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">   <span class='comment'>by supplying the stride between the beginning of adjacent rows. The other</span></td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">   <span class='comment'>formats do not. (Thus you cannot write a native-format BMP through the BMP</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">   <span class='comment'>writer, both because it is in BGR order and because it may have padding</span></td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">   <span class='comment'>at the end of the line.)</span></td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">   <span class='comment'>PNG allows you to set the deflate compression level by setting the global</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">   <span class='comment'>variable 'stbi_write_png_compression_level' (it defaults to 8).</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">   <span class='comment'>HDR expects linear float data. Since the format is always 32-bit rgb(e)</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">   <span class='comment'>data, alpha (if provided) is discarded, and for monochrome data it is</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">   <span class='comment'>replicated across all three channels.</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">   <span class='comment'>TGA supports RLE or non-RLE compressed data. To use non-RLE-compressed</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">   <span class='comment'>data, set the global variable 'stbi_write_tga_with_rle' to 0.</span></td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">   </td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">   <span class='comment'>JPEG does ignore alpha channels in input data; quality is between 1 and 100.</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">   <span class='comment'>Higher quality looks better but results in a bigger image.</span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">   <span class='comment'>JPEG baseline (no JPEG progressive).</span></td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"><span class='comment'>CREDITS:</span></td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">   <span class='comment'>Sean Barrett           -    PNG/BMP/TGA</span> </td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">   <span class='comment'>Baldur Karlsson        -    HDR</span></td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">   <span class='comment'>Jean-Sebastien Guay    -    TGA monochrome</span></td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">   <span class='comment'>Tim Kelsey             -    misc enhancements</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">   <span class='comment'>Alan Hickman           -    TGA RLE</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">   <span class='comment'>Emmanuel Julien        -    initial file IO callback implementation</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">   <span class='comment'>Jon Olick              -    original jo_jpeg.cpp code</span></td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">   <span class='comment'>Daniel Gibson          -    integrate JPEG, allow external zlib</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">   <span class='comment'>Aarni Koskela          -    allow choosing PNG filter</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">   <span class='comment'>bugfixes:</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">      <span class='comment'>github:Chribba</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">      <span class='comment'>Guillaume Chereau</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">      <span class='comment'>github:jry2</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">      <span class='comment'>github:romigrou</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">      <span class='comment'>Sergio Gonzalez</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">      <span class='comment'>Jonas Karlsson</span></td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">      <span class='comment'>Filip Wasil</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">      <span class='comment'>Thatcher Ulrich</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">      <span class='comment'>github:poppolopoppo</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">      <span class='comment'>Patrick Boettcher</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">      <span class='comment'>github:xeekworx</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">      <span class='comment'>Cap Petschulat</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">      <span class='comment'>Simon Rodriguez</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">      <span class='comment'>Ivan Tikhonov</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">      <span class='comment'>github:ignotion</span></td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">      <span class='comment'>Adam Schackart</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='comment'>LICENSE</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">  <span class='comment'>See end of file for license information.</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='directive'>#ifndef INCLUDE_STB_IMAGE_WRITE_H</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='directive'>#define INCLUDE_STB_IMAGE_WRITE_H</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='comment'>// if STB_IMAGE_WRITE_STATIC causes problems, try defining STBIWDEF to 'inline' or 'static inline'</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"><span class='directive'>#ifndef <span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span></span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line"><span class='directive'>#ifdef STB_IMAGE_WRITE_STATIC</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"><span class='directive'>#define <span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span>  static</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='directive'>#define <span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span>  extern "C"</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"><span class='directive'>#define <span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span>  extern</span></td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"><span class='directive'>#ifndef STB_IMAGE_WRITE_STATIC  // C++ forbids static forward declarations</span></td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>int</span> stbi_write_tga_with_rle;</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>int</span> stbi_write_png_compression_level;</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>int</span> stbi_write_force_png_filter;</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_png(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data, <span class='keyword'>int</span> stride_in_bytes);</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_bmp(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data);</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_tga(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data);</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_hdr(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>float</span> *data);</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_jpg(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data, <span class='keyword'>int</span> quality);</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>void</span> stbi_write_func(<span class='keyword'>void</span> *context, <span class='keyword'>void</span> *data, <span class='keyword'>int</span> size);</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_png_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data, <span class='keyword'>int</span> stride_in_bytes);</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_bmp_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data);</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_tga_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data);</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_hdr_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>float</span> *data);</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_jpg_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>  *data, <span class='keyword'>int</span> quality);</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_flip_vertically_on_write(<span class='keyword'>int</span> flip_boolean);</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"><span class='directive'>#endif//INCLUDE_STB_IMAGE_WRITE_H</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line"><span class='directive'>#ifdef STB_IMAGE_WRITE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"><span class='directive'>#ifdef _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">   <span class='directive'>#ifndef _CRT_SECURE_NO_WARNINGS</span></td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">   <span class='directive'>#define _CRT_SECURE_NO_WARNINGS</span></td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">   <span class='directive'>#ifndef _CRT_NONSTDC_NO_DEPRECATE</span></td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">   <span class='directive'>#define _CRT_NONSTDC_NO_DEPRECATE</span></td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line"><span class='directive'>#include &lt;stdio.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"><span class='directive'>#endif // STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line"><span class='directive'>#include &lt;stdarg.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line"><span class='directive'>#include &lt;stdlib.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line"><span class='directive'>#include &lt;string.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line"><span class='directive'>#include &lt;math.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"><span class='directive'>#if defined(STBIW_MALLOC) &amp;&amp; defined(STBIW_FREE) &amp;&amp; (defined(STBIW_REALLOC) || defined(STBIW_REALLOC_SIZED))</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"><span class='comment'>// ok</span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line"><span class='directive'>#elif !defined(STBIW_MALLOC) &amp;&amp; !defined(STBIW_FREE) &amp;&amp; !defined(STBIW_REALLOC) &amp;&amp; !defined(STBIW_REALLOC_SIZED)</span></td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line"><span class='comment'>// ok</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line"><span class='directive'>#error "Must define all or none of STBIW_MALLOC, STBIW_FREE, and STBIW_REALLOC (or STBIW_REALLOC_SIZED)."</span></td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line"><span class='directive'>#ifndef STBIW_MALLOC</span></td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_MALLOC(sz)<span class='macro_popup'>malloc(sz)</span></span>        malloc(sz)</span></td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_REALLOC(p,newsz)<span class='macro_popup'>realloc(p,newsz)</span></span>  realloc(p,newsz)</span></td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_FREE(p)<span class='macro_popup'>free(p)</span></span>           free(p)</span></td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line"><span class='directive'>#ifndef STBIW_REALLOC_SIZED</span></td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_REALLOC_SIZED(p,oldsz,newsz)<span class='macro_popup'>realloc(p,newsz)</span></span> <span class='macro'>STBIW_REALLOC(p,newsz)<span class='macro_popup'>realloc(p,newsz)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"><span class='directive'>#ifndef STBIW_MEMMOVE</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_MEMMOVE(a,b,sz)<span class='macro_popup'>memmove(a,b,sz)</span></span> memmove(a,b,sz)</span></td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"><span class='directive'>#ifndef STBIW_ASSERT</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"><span class='directive'>#include &lt;assert.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_ASSERT(x)<span class='macro_popup'>((void) sizeof ((x) ? 1 : 0), __extension__ ({ if (x) ; else __assert_fail<br> ("x", "src/stb_image_write.h", 236, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span> <span class='macro'>assert(x)<span class='macro_popup'>((void) sizeof ((x) ? 1 : 0), __extension__ ({ if (x) ; else __assert_fail<br> ("x", "src/stb_image_write.h", 236, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line"><span class='directive'>#define <span class='macro'>STBIW_UCHAR(x)<span class='macro_popup'>(unsigned char) ((x) &amp; 0xff)</span></span> (unsigned char) ((x) &amp; 0xff)</span></td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"><span class='directive'>#ifdef STB_IMAGE_WRITE_STATIC</span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__flip_vertically_on_write=0;</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_png_compression_level = 8;</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_tga_with_rle = 1;</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_force_png_filter = -1;</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"><span class='keyword'>int</span> stbi_write_png_compression_level = 8;</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"><span class='keyword'>int</span> stbi__flip_vertically_on_write=0;</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line"><span class='keyword'>int</span> stbi_write_tga_with_rle = 1;</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"><span class='keyword'>int</span> stbi_write_force_png_filter = -1;</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_flip_vertically_on_write(<span class='keyword'>int</span> flag)</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">   stbi__flip_vertically_on_write = flag;</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">   stbi_write_func *func;</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">   <span class='keyword'>void</span> *context;</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">} stbi__write_context;</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"><span class='comment'>// initialize a callback-based context</span></td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__start_write_callbacks(stbi__write_context *s, stbi_write_func *c, <span class='keyword'>void</span> *context)</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">   s-&gt;func    = c;</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">   s-&gt;context = context;</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__stdio_write(<span class='keyword'>void</span> *context, <span class='keyword'>void</span> *data, <span class='keyword'>int</span> size)</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">   fwrite(data,1,size,(FILE*) context);</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__start_write_file(stbi__write_context *s, <span class='keyword'>const</span> <span class='keyword'>char</span> *filename)</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">   FILE *f;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line"><span class='directive'>#ifdef STBI_MSC_SECURE_CRT</span></td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">   <span class='keyword'>if</span> (fopen_s(&amp;f, filename, <span class='string_literal'>"wb"</span>))</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">      f = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">   f = fopen(filename, <span class='string_literal'>"wb"</span>);</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">   stbi__start_write_callbacks(s, stbi__stdio_write, (<span class='keyword'>void</span> *) f);</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">   <span class='keyword'>return</span> f != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__end_write_file(stbi__write_context *s)</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">   fclose((FILE *)s-&gt;context);</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line"><span class='directive'>#endif // !STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> stbiw_uint32;</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>int</span> stb_image_write_test[<span class='keyword'>sizeof</span>(stbiw_uint32)==4 ? 1 : -1];</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__writefv(stbi__write_context *s, <span class='keyword'>const</span> <span class='keyword'>char</span> *fmt, va_list v)</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">   <span class='keyword'>while</span> (*fmt) {</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">      <span class='keyword'>switch</span> (*fmt++) {</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">         <span class='keyword'>case</span> ' ': <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">         <span class='keyword'>case</span> '1': { <span class='keyword'>unsigned</span> <span class='keyword'>char</span> x = <span class='macro'>STBIW_UCHAR(va_arg(v, <span class='keyword'>int</span>))<span class='macro_popup'>(unsigned char) ((__builtin_va_arg(v, int)) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">                     s-&gt;func(s-&gt;context,&amp;x,1);</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">                     <span class='keyword'>break</span>; }</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">         <span class='keyword'>case</span> '2': { <span class='keyword'>int</span> x = <span class='macro'>va_arg(v,<span class='keyword'>int</span>)<span class='macro_popup'>__builtin_va_arg(v, int)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">                     <span class='keyword'>unsigned</span> <span class='keyword'>char</span> b[2];</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">                     b[0] = <span class='macro'>STBIW_UCHAR(x)<span class='macro_popup'>(unsigned char) ((x) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">                     b[1] = <span class='macro'>STBIW_UCHAR(x&gt;&gt;8)<span class='macro_popup'>(unsigned char) ((x&gt;&gt;8) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">                     s-&gt;func(s-&gt;context,b,2);</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">                     <span class='keyword'>break</span>; }</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">         <span class='keyword'>case</span> '4': { stbiw_uint32 x = <span class='macro'>va_arg(v,<span class='keyword'>int</span>)<span class='macro_popup'>__builtin_va_arg(v, int)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">                     <span class='keyword'>unsigned</span> <span class='keyword'>char</span> b[4];</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">                     b[0]=<span class='macro'>STBIW_UCHAR(x)<span class='macro_popup'>(unsigned char) ((x) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">                     b[1]=<span class='macro'>STBIW_UCHAR(x&gt;&gt;8)<span class='macro_popup'>(unsigned char) ((x&gt;&gt;8) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">                     b[2]=<span class='macro'>STBIW_UCHAR(x&gt;&gt;16)<span class='macro_popup'>(unsigned char) ((x&gt;&gt;16) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">                     b[3]=<span class='macro'>STBIW_UCHAR(x&gt;&gt;24)<span class='macro_popup'>(unsigned char) ((x&gt;&gt;24) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">                     s-&gt;func(s-&gt;context,b,4);</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">                     <span class='keyword'>break</span>; }</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">         <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">            <span class='macro'>STBIW_ASSERT(0)<span class='macro_popup'>((void) sizeof ((0) ? 1 : 0), __extension__ ({ if (0) ; else __assert_fail<br> ("0", "src/stb_image_write.h", 324, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__writef(stbi__write_context *s, <span class='keyword'>const</span> <span class='keyword'>char</span> *fmt, ...)</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">   va_list v;</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">   <span class='macro'>va_start(v, fmt)<span class='macro_popup'>__builtin_va_start(v, fmt)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">   stbiw__writefv(s, fmt, v);</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">   <span class='macro'>va_end(v)<span class='macro_popup'>__builtin_va_end(v)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__putc(stbi__write_context *s, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> c)</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">   s-&gt;func(s-&gt;context, &amp;c, 1);</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__write3(stbi__write_context *s, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> a, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> b, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> c)</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> arr[3];</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">   arr[0] = a, arr[1] = b, arr[2] = c;</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">   s-&gt;func(s-&gt;context, arr, 3);</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__write_pixel(stbi__write_context *s, <span class='keyword'>int</span> rgb_dir, <span class='keyword'>int</span> comp, <span class='keyword'>int</span> write_alpha, <span class='keyword'>int</span> expand_mono, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *d)</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> bg[3] = { 255, 0, 255}, px[3];</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">   <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">   <span class='keyword'>if</span> (write_alpha &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">      s-&gt;func(s-&gt;context, &amp;d[comp - 1], 1);</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">   <span class='keyword'>switch</span> (comp) {</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">      <span class='keyword'>case</span> 2: <span class='comment'>// 2 pixels = mono + alpha, alpha is written separately, so same as 1-channel case</span></td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">      <span class='keyword'>case</span> 1:</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">         <span class='keyword'>if</span> (expand_mono)</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">            stbiw__write3(s, d[0], d[0], d[0]); <span class='comment'>// monochrome bmp</span></td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">         <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">            s-&gt;func(s-&gt;context, d, 1);  <span class='comment'>// monochrome TGA</span></td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">         <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">      <span class='keyword'>case</span> 4:</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">         <span class='keyword'>if</span> (!write_alpha) {</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">            <span class='comment'>// composite against pink background</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">            <span class='keyword'>for</span> (k = 0; k &lt; 3; ++k)</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">               px[k] = bg[k] + ((d[k] - bg[k]) * d[3]) / 255;</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">            stbiw__write3(s, px[1 - rgb_dir], px[1], px[1 + rgb_dir]);</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">         <span class='comment'>/* FALLTHROUGH */</span></td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">      <span class='keyword'>case</span> 3:</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">         stbiw__write3(s, d[1 - rgb_dir], d[1], d[1 + rgb_dir]);</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">         <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">   <span class='keyword'>if</span> (write_alpha &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">      s-&gt;func(s-&gt;context, &amp;d[comp - 1], 1);</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__write_pixels(stbi__write_context *s, <span class='keyword'>int</span> rgb_dir, <span class='keyword'>int</span> vdir, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>void</span> *data, <span class='keyword'>int</span> write_alpha, <span class='keyword'>int</span> scanline_pad, <span class='keyword'>int</span> expand_mono)</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">   stbiw_uint32 zero = 0;</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">   <span class='keyword'>int</span> i,j, j_end;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">   <span class='keyword'>if</span> (y &lt;= 0)</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">      <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">   <span class='keyword'>if</span> (stbi__flip_vertically_on_write)</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">      vdir *= -1;</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">   <span class='keyword'>if</span> (vdir &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">      j_end = -1, j = y-1;</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">      j_end =  y, j = 0;</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">   <span class='keyword'>for</span> (; j != j_end; j += vdir) {</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">         <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *d = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) data + (j*x+i)*comp;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">         stbiw__write_pixel(s, rgb_dir, comp, write_alpha, expand_mono, d);</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">      s-&gt;func(s-&gt;context, &amp;zero, scanline_pad);</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbiw__outfile(stbi__write_context *s, <span class='keyword'>int</span> rgb_dir, <span class='keyword'>int</span> vdir, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>int</span> expand_mono, <span class='keyword'>void</span> *data, <span class='keyword'>int</span> alpha, <span class='keyword'>int</span> pad, <span class='keyword'>const</span> <span class='keyword'>char</span> *fmt, ...)</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">   <span class='keyword'>if</span> (y &lt; 0 || x &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">      va_list v;</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">      <span class='macro'>va_start(v, fmt)<span class='macro_popup'>__builtin_va_start(v, fmt)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">      stbiw__writefv(s, fmt, v);</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">      <span class='macro'>va_end(v)<span class='macro_popup'>__builtin_va_end(v)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">      stbiw__write_pixels(s,rgb_dir,vdir,x,y,comp,data,alpha,pad, expand_mono);</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">      <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_bmp_core(stbi__write_context *s, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">   <span class='keyword'>int</span> pad = (-x*3) &amp; 3;</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">   <span class='keyword'>return</span> stbiw__outfile(s,-1,-1,x,y,comp,1,(<span class='keyword'>void</span> *) data,0,pad,</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">           <span class='string_literal'>"11 4 22 4"</span> <span class='string_literal'>"4 44 22 444444"</span>,</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">           'B', 'M', 14+40+(x*3+pad)*y, 0,0, 14+40,  <span class='comment'>// file header</span></td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">            40, x,y, 1,24, 0,0,0,0,0,0);             <span class='comment'>// bitmap header</span></td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_bmp_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">   stbi__start_write_callbacks(&amp;s, func, context);</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">   <span class='keyword'>return</span> stbi_write_bmp_core(&amp;s, x, y, comp, data);</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_bmp(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">   <span class='keyword'>if</span> (stbi__start_write_file(&amp;s,filename)) {</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">      <span class='keyword'>int</span> r = stbi_write_bmp_core(&amp;s, x, y, comp, data);</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">      stbi__end_write_file(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">      <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">   } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line"><span class='directive'>#endif //!STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_tga_core(stbi__write_context *s, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">   <span class='keyword'>int</span> has_alpha = (comp == 2 || comp == 4);</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">   <span class='keyword'>int</span> colorbytes = has_alpha ? comp-1 : comp;</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">   <span class='keyword'>int</span> format = colorbytes &lt; 2 ? 3 : 2; <span class='comment'>// 3 color channels (RGB/RGBA) = 2, 1 color channel (Y/YA) = 3</span></td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">   <span class='keyword'>if</span> (y &lt; 0 || x &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">   <span class='keyword'>if</span> (!stbi_write_tga_with_rle) {</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">      <span class='keyword'>return</span> stbiw__outfile(s, -1, -1, x, y, comp, 0, (<span class='keyword'>void</span> *) data, has_alpha, 0,</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">         <span class='string_literal'>"111 221 2222 11"</span>, 0, 0, format, 0, 0, 0, 0, 0, x, y, (colorbytes + has_alpha) * 8, has_alpha * 8);</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">      <span class='keyword'>int</span> i,j,k;</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">      <span class='keyword'>int</span> jend, jdir;</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">      stbiw__writef(s, <span class='string_literal'>"111 221 2222 11"</span>, 0,0,format+8, 0,0,0, 0,0,x,y, (colorbytes + has_alpha) * 8, has_alpha * 8);</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">      <span class='keyword'>if</span> (stbi__flip_vertically_on_write) {</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">         j = 0;</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">         jend = y;</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">         jdir = 1;</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">         j = y-1;</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">         jend = -1;</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">         jdir = -1;</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">      <span class='keyword'>for</span> (; j != jend; j += jdir) {</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">         <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *row = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) data + j * x * comp;</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">         <span class='keyword'>int</span> len;</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">         <span class='keyword'>for</span> (i = 0; i &lt; x; i += len) {</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">            <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *begin = row + i * comp;</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">            <span class='keyword'>int</span> diff = 1;</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">            len = 1;</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">            <span class='keyword'>if</span> (i &lt; x - 1) {</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">               ++len;</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">               diff = memcmp(begin, row + (i + 1) * comp, comp);</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">               <span class='keyword'>if</span> (diff) {</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">                  <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *prev = begin;</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">                  <span class='keyword'>for</span> (k = i + 2; k &lt; x &amp;&amp; len &lt; 128; ++k) {</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">                     <span class='keyword'>if</span> (memcmp(prev, row + k * comp, comp)) {</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">                        prev += comp;</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">                        ++len;</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">                     } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">                        --len;</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">                     }</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">                  <span class='keyword'>for</span> (k = i + 2; k &lt; x &amp;&amp; len &lt; 128; ++k) {</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">                     <span class='keyword'>if</span> (!memcmp(begin, row + k * comp, comp)) {</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">                        ++len;</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">                     } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">                     }</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">            <span class='keyword'>if</span> (diff) {</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">               <span class='keyword'>unsigned</span> <span class='keyword'>char</span> header = <span class='macro'>STBIW_UCHAR(len - 1)<span class='macro_popup'>(unsigned char) ((len - 1) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">               s-&gt;func(s-&gt;context, &amp;header, 1);</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">               <span class='keyword'>for</span> (k = 0; k &lt; len; ++k) {</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">                  stbiw__write_pixel(s, -1, comp, has_alpha, 0, begin + k * comp);</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">               <span class='keyword'>unsigned</span> <span class='keyword'>char</span> header = <span class='macro'>STBIW_UCHAR(len - 129)<span class='macro_popup'>(unsigned char) ((len - 129) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">               s-&gt;func(s-&gt;context, &amp;header, 1);</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">               stbiw__write_pixel(s, -1, comp, has_alpha, 0, begin);</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_tga_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">   stbi__start_write_callbacks(&amp;s, func, context);</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">   <span class='keyword'>return</span> stbi_write_tga_core(&amp;s, x, y, comp, (<span class='keyword'>void</span> *) data);</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_tga(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data)</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">   <span class='keyword'>if</span> (stbi__start_write_file(&amp;s,filename)) {</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">      <span class='keyword'>int</span> r = stbi_write_tga_core(&amp;s, x, y, comp, (<span class='keyword'>void</span> *) data);</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">      stbi__end_write_file(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">      <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">   } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line"><span class='comment'>// *************************************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line"><span class='comment'>// Radiance RGBE HDR writer</span></td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line"><span class='comment'>// by Baldur Karlsson</span></td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__max(a, b)<span class='macro_popup'>((a) &gt; (b) ? (a) : (b))</span></span>  ((a) &gt; (b) ? (a) : (b))</span></td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line"><span class='keyword'>void</span> stbiw__linear_to_rgbe(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *rgbe, <span class='keyword'>float</span> *linear)</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">   <span class='keyword'>int</span> exponent;</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">   <span class='keyword'>float</span> maxcomp = <span class='macro'>stbiw__max(linear[0], stbiw__max(linear[1], linear[2]))<span class='macro_popup'>((linear[0]) &gt; (((linear[1]) &gt; (linear[2]) ? (linear[1]<br>) : (linear[2]))) ? (linear[0]) : (((linear[1]) &gt; (linear[<br>2]) ? (linear[1]) : (linear[2]))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">   <span class='keyword'>if</span> (maxcomp &lt; 1e-32f) {</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">      rgbe[0] = rgbe[1] = rgbe[2] = rgbe[3] = 0;</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">      <span class='keyword'>float</span> normalize = (<span class='keyword'>float</span>) frexp(maxcomp, &amp;exponent) * 256.0f/maxcomp;</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">      rgbe[0] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>)(linear[0] * normalize);</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">      rgbe[1] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>)(linear[1] * normalize);</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">      rgbe[2] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>)(linear[2] * normalize);</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">      rgbe[3] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>)(exponent + 128);</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line"><span class='keyword'>void</span> stbiw__write_run_data(stbi__write_context *s, <span class='keyword'>int</span> length, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> databyte)</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> lengthbyte = <span class='macro'>STBIW_UCHAR(length+128)<span class='macro_popup'>(unsigned char) ((length+128) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">   <span class='macro'>STBIW_ASSERT(length+128 &lt;= 255)<span class='macro_popup'>((void) sizeof ((length+128 &lt;= 255) ? 1 : 0), __extension__<br> ({ if (length+128 &lt;= 255) ; else __assert_fail ("length+128 &lt;= 255"<br>, "src/stb_image_write.h", 575, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">   s-&gt;func(s-&gt;context, &amp;lengthbyte, 1);</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">   s-&gt;func(s-&gt;context, &amp;databyte, 1);</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line"><span class='keyword'>void</span> stbiw__write_dump_data(stbi__write_context *s, <span class='keyword'>int</span> length, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *data)</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> lengthbyte = <span class='macro'>STBIW_UCHAR(length)<span class='macro_popup'>(unsigned char) ((length) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">   <span class='macro'>STBIW_ASSERT(length &lt;= 128)<span class='macro_popup'>((void) sizeof ((length &lt;= 128) ? 1 : 0), __extension__ ({<br> if (length &lt;= 128) ; else __assert_fail ("length &lt;= 128"<br>, "src/stb_image_write.h", 583, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>; <span class='comment'>// inconsistent with spec but consistent with official code</span></td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">   s-&gt;func(s-&gt;context, &amp;lengthbyte, 1);</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">   s-&gt;func(s-&gt;context, data, length);</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line"><span class='keyword'>void</span> stbiw__write_hdr_scanline(stbi__write_context *s, <span class='keyword'>int</span> width, <span class='keyword'>int</span> ncomp, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *scratch, <span class='keyword'>float</span> *scanline)</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> scanlineheader[4] = { 2, 2, 0, 0 };</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> rgbe[4];</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">   <span class='keyword'>float</span> linear[3];</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">   <span class='keyword'>int</span> x;</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">   scanlineheader[2] = (width&amp;0xff00)&gt;&gt;8;</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">   scanlineheader[3] = (width&amp;0x00ff);</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">   <span class='comment'>/* skip RLE for images too small or large */</span></td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">   <span class='keyword'>if</span> (width &lt; 8 || width &gt;= 32768) {</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">      <span class='keyword'>for</span> (x=0; x &lt; width; x++) {</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">         <span class='keyword'>switch</span> (ncomp) {</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">            <span class='keyword'>case</span> 4: <span class='comment'>/* fallthrough */</span></td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">            <span class='keyword'>case</span> 3: linear[2] = scanline[x*ncomp + 2];</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">                    linear[1] = scanline[x*ncomp + 1];</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">                    linear[0] = scanline[x*ncomp + 0];</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">            <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">                    linear[0] = linear[1] = linear[2] = scanline[x*ncomp + 0];</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">         stbiw__linear_to_rgbe(rgbe, linear);</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">         s-&gt;func(s-&gt;context, rgbe, 4);</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">      <span class='keyword'>int</span> c,r;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">      <span class='comment'>/* encode into scratch buffer */</span></td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">      <span class='keyword'>for</span> (x=0; x &lt; width; x++) {</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">         <span class='keyword'>switch</span>(ncomp) {</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">            <span class='keyword'>case</span> 4: <span class='comment'>/* fallthrough */</span></td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">            <span class='keyword'>case</span> 3: linear[2] = scanline[x*ncomp + 2];</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">                    linear[1] = scanline[x*ncomp + 1];</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">                    linear[0] = scanline[x*ncomp + 0];</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">            <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">                    linear[0] = linear[1] = linear[2] = scanline[x*ncomp + 0];</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">         stbiw__linear_to_rgbe(rgbe, linear);</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">         scratch[x + width*0] = rgbe[0];</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">         scratch[x + width*1] = rgbe[1];</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">         scratch[x + width*2] = rgbe[2];</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">         scratch[x + width*3] = rgbe[3];</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">      s-&gt;func(s-&gt;context, scanlineheader, 4);</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">      <span class='comment'>/* RLE each component separately */</span></td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">      <span class='keyword'>for</span> (c=0; c &lt; 4; c++) {</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">         <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *comp = &amp;scratch[width*c];</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">         x = 0;</td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">         <span class='keyword'>while</span> (x &lt; width) {</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">            <span class='comment'>// find first run</span></td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">            r = x;</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">            <span class='keyword'>while</span> (r+2 &lt; width) {</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">               <span class='keyword'>if</span> (comp[r] == comp[r+1] &amp;&amp; comp[r] == comp[r+2])</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">                  <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">               ++r;</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">            <span class='keyword'>if</span> (r+2 &gt;= width)</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">               r = width;</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">            <span class='comment'>// dump up to first run</span></td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">            <span class='keyword'>while</span> (x &lt; r) {</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">               <span class='keyword'>int</span> len = r-x;</td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">               <span class='keyword'>if</span> (len &gt; 128) len = 128;</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">               stbiw__write_dump_data(s, len, &amp;comp[x]);</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">               x += len;</td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">            <span class='comment'>// if there's a run, output it</span></td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">            <span class='keyword'>if</span> (r+2 &lt; width) { <span class='comment'>// same test as what we break out of in search loop, so only true if we break'd</span></td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">               <span class='comment'>// find next byte after run</span></td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">               <span class='keyword'>while</span> (r &lt; width &amp;&amp; comp[r] == comp[x])</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">                  ++r;</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">               <span class='comment'>// output run up to r</span></td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">               <span class='keyword'>while</span> (x &lt; r) {</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">                  <span class='keyword'>int</span> len = r-x;</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">                  <span class='keyword'>if</span> (len &gt; 127) len = 127;</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line">                  stbiw__write_run_data(s, len, comp[x]);</td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">                  x += len;</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_hdr_core(stbi__write_context *s, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>float</span> *data)</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">   <span class='keyword'>if</span> (y &lt;= 0 || x &lt;= 0 || data == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">   <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">      <span class='comment'>// Each component is stored separately. Allocate scratch space for full output scanline.</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *scratch = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) <span class='macro'>STBIW_MALLOC(x*4)<span class='macro_popup'>malloc(x*4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">      <span class='keyword'>int</span> i, len;</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">      <span class='keyword'>char</span> buffer[128];</td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">      <span class='keyword'>char</span> header[] = <span class='string_literal'>"#?RADIANCE\n# Written by stb_image_write.h\nFORMAT=32-bit_rle_rgbe\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">      s-&gt;func(s-&gt;context, header, <span class='keyword'>sizeof</span>(header)-1);</td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line"><span class='directive'>#ifdef STBI_MSC_SECURE_CRT</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">      len = sprintf_s(buffer, <span class='string_literal'>"EXPOSURE=          1.0000000000000\n\n-Y %d +X %d\n"</span>, y, x);</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">      len = sprintf(buffer, <span class='string_literal'>"EXPOSURE=          1.0000000000000\n\n-Y %d +X %d\n"</span>, y, x);</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">      s-&gt;func(s-&gt;context, buffer, len);</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">      <span class='keyword'>for</span>(i=0; i &lt; y; i++)</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">         stbiw__write_hdr_scanline(s, x, comp, scratch, data + comp*x*(stbi__flip_vertically_on_write ? y-1-i : i)*x);</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">      <span class='macro'>STBIW_FREE(scratch)<span class='macro_popup'>free(scratch)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">      <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_hdr_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>float</span> *data)</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">   stbi__start_write_callbacks(&amp;s, func, context);</td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">   <span class='keyword'>return</span> stbi_write_hdr_core(&amp;s, x, y, comp, (<span class='keyword'>float</span> *) data);</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_hdr(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>float</span> *data)</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">   <span class='keyword'>if</span> (stbi__start_write_file(&amp;s,filename)) {</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">      <span class='keyword'>int</span> r = stbi_write_hdr_core(&amp;s, x, y, comp, (<span class='keyword'>float</span> *) data);</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">      stbi__end_write_file(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">      <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">   } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line"><span class='directive'>#endif // STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line"><span class='comment'>//////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line"><span class='comment'>// PNG writer</span></td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line"><span class='directive'>#ifndef STBIW_ZLIB_COMPRESS</span></td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line"><span class='comment'>// stretchy buffer; stbiw__sbpush() == vector&lt;&gt;::push_back() -- stbiw__sbcount() == vector&lt;&gt;::size()</span></td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbraw(a)<span class='macro_popup'>((int *) (a) - 2)</span></span> ((int *) (a) - 2)</span></td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbm(a)<span class='macro_popup'>((int *) (a) - 2)[0]</span></span>   <span class='macro'>stbiw__sbraw(a)<span class='macro_popup'>((int *) (a) - 2)</span></span>[0]</span></td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbn(a)<span class='macro_popup'>((int *) (a) - 2)[1]</span></span>   <span class='macro'>stbiw__sbraw(a)<span class='macro_popup'>((int *) (a) - 2)</span></span>[1]</span></td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbneedgrow(a,n)<span class='macro_popup'>((a)==0 || ((int *) (a) - 2)[1]+n &gt;= ((int *) (a) - 2)[0])</span></span>  ((a)==0 || <span class='macro'>stbiw__sbn(a)<span class='macro_popup'>((int *) (a) - 2)[1]</span></span>+n &gt;= <span class='macro'>stbiw__sbm(a)<span class='macro_popup'>((int *) (a) - 2)[0]</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbmaybegrow(a,n)<span class='macro_popup'>(((a)==0 || ((int *) (a) - 2)[1]+(n) &gt;= ((int *) (a) - 2)[<br>0]) ? stbiw__sbgrowf((void **) &amp;(a), (n), sizeof(*(a))) :<br> 0)</span></span> (<span class='macro'>stbiw__sbneedgrow(a,(n))<span class='macro_popup'>((a)==0 || ((int *) (a) - 2)[1]+(n) &gt;= ((int *) (a) - 2)[0<br>])</span></span> ? <span class='macro'>stbiw__sbgrow(a,n)<span class='macro_popup'>stbiw__sbgrowf((void **) &amp;(a), (n), sizeof(*(a)))</span></span> : 0)</span></td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbgrow(a,n)<span class='macro_popup'>stbiw__sbgrowf((void **) &amp;(a), (n), sizeof(*(a)))</span></span>  stbiw__sbgrowf((void **) &amp;(a), (n), sizeof(*(a)))</span></td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbpush(a, v)<span class='macro_popup'>((((a)==0 || ((int *) (a) - 2)[1]+(1) &gt;= ((int *) (a) - 2)<br>[0]) ? stbiw__sbgrowf((void **) &amp;(a), (1), sizeof(*(a))) :<br> 0), (a)[((int *) (a) - 2)[1]++] = (v))</span></span>      (<span class='macro'>stbiw__sbmaybegrow(a,1)<span class='macro_popup'>(((a)==0 || ((int *) (a) - 2)[1]+(1) &gt;= ((int *) (a) - 2)[<br>0]) ? stbiw__sbgrowf((void **) &amp;(a), (1), sizeof(*(a))) :<br> 0)</span></span>, (a)[<span class='macro'>stbiw__sbn(a)<span class='macro_popup'>((int *) (a) - 2)[1]</span></span>++] = (v))</span></td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbcount(a)<span class='macro_popup'>((a) ? ((int *) (a) - 2)[1] : 0)</span></span>        ((a) ? <span class='macro'>stbiw__sbn(a)<span class='macro_popup'>((int *) (a) - 2)[1]</span></span> : 0)</span></td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__sbfree(a)<span class='macro_popup'>((a) ? free(((int *) (a) - 2)),0 : 0)</span></span>         ((a) ? <span class='macro'>STBIW_FREE(stbiw__sbraw(a))<span class='macro_popup'>free(((int *) (a) - 2))</span></span>,0 : 0)</span></td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbiw__sbgrowf(<span class='keyword'>void</span> **arr, <span class='keyword'>int</span> increment, <span class='keyword'>int</span> itemsize)</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">   <span class='keyword'>int</span> m = *arr ? 2*<span class='macro'>stbiw__sbm(*arr)<span class='macro_popup'>((int *) (*arr) - 2)[0]</span></span>+increment : increment+1;</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">   <span class='keyword'>void</span> *p = <span class='macro'>STBIW_REALLOC_SIZED(*arr ? stbiw__sbraw(*arr) : 0, *arr ? (stbiw__sbm(*arr)*itemsize + <span class='keyword'>sizeof</span>(<span class='keyword'>int</span>)*2) : 0, itemsize * m + <span class='keyword'>sizeof</span>(<span class='keyword'>int</span>)*2)<span class='macro_popup'>realloc(*arr ? ((int *) (*arr) - 2) : 0,itemsize * m + sizeof<br>(int)*2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">   <span class='macro'>STBIW_ASSERT(p)<span class='macro_popup'>((void) sizeof ((p) ? 1 : 0), __extension__ ({ if (p) ; else __assert_fail<br> ("p", "src/stb_image_write.h", 747, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">   <span class='keyword'>if</span> (p) {</td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">      <span class='keyword'>if</span> (!*arr) ((<span class='keyword'>int</span> *) p)[1] = 0;</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">      *arr = (<span class='keyword'>void</span> *) ((<span class='keyword'>int</span> *) p + 2);</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">      <span class='macro'>stbiw__sbm(*arr)<span class='macro_popup'>((int *) (*arr) - 2)[0]</span></span> = m;</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">   <span class='keyword'>return</span> *arr;</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *stbiw__zlib_flushf(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *data, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> *bitbuffer, <span class='keyword'>int</span> *bitcount)</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">   <span class='keyword'>while</span> (*bitcount &gt;= 8) {</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">      <span class='macro'>stbiw__sbpush(data, STBIW_UCHAR(*bitbuffer))<span class='macro_popup'>((((data)==0 || ((int *) (data) - 2)[1]+(1) &gt;= ((int *) (data<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(data), (1), sizeof<br>(*(data))) : 0), (data)[((int *) (data) - 2)[1]++] = ((unsigned<br> char) ((*bitbuffer) &amp; 0xff)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">      *bitbuffer &gt;&gt;= 8;</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">      *bitcount -= 8;</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">   <span class='keyword'>return</span> data;</td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbiw__zlib_bitrev(<span class='keyword'>int</span> code, <span class='keyword'>int</span> codebits)</td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">   <span class='keyword'>int</span> res=0;</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">   <span class='keyword'>while</span> (codebits--) {</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">      res = (res &lt;&lt; 1) | (code &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">      code &gt;&gt;= 1;</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">   <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> stbiw__zlib_countm(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *a, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *b, <span class='keyword'>int</span> limit)</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; limit &amp;&amp; i &lt; 258; ++i)</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">      <span class='keyword'>if</span> (a[i] != b[i]) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">   <span class='keyword'>return</span> i;</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> stbiw__zhash(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *data)</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">   stbiw_uint32 hash = data[0] + (data[1] &lt;&lt; 8) + (data[2] &lt;&lt; 16);</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">   hash ^= hash &lt;&lt; 3;</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">   hash += hash &gt;&gt; 5;</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">   hash ^= hash &lt;&lt; 4;</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">   hash += hash &gt;&gt; 17;</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line">   hash ^= hash &lt;&lt; 25;</td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">   hash += hash &gt;&gt; 6;</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line">   <span class='keyword'>return</span> hash;</td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_flush()<span class='macro_popup'>(out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))</span></span> (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))</span></td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_add(code,codebits)<span class='macro_popup'>(bitbuf |= (code) &lt;&lt; bitcount, bitcount += (codebits), (<br>out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount)))</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">      <span class='directive'>(bitbuf |= (code) &lt;&lt; bitcount, bitcount += (codebits), <span class='macro'>stbiw__zlib_flush()<span class='macro_popup'>(out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huffa(b,c)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(b,c)) &lt;&lt; bitcount, bitcount<br> += (c), (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount<br>)))</span></span>  <span class='macro'>stbiw__zlib_add(stbiw__zlib_bitrev(b,c),c)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(b,c)) &lt;&lt; bitcount, bitcount<br> += (c), (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount<br>)))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line"><span class='comment'>// default huffman tables</span></td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huff1(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x30 + (n),8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span>  <span class='macro'>stbiw__zlib_huffa(0x30 + (n), 8)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x30 + (n),8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huff2(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x190 + (n)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span>  <span class='macro'>stbiw__zlib_huffa(0x190 + (n)-144, 9)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x190 + (n)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huff3(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0 + (n)-256,7)) &lt;&lt; bitcount<br>, bitcount += (7), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span>  <span class='macro'>stbiw__zlib_huffa(0 + (n)-256,7)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0 + (n)-256,7)) &lt;&lt; bitcount<br>, bitcount += (7), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huff4(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0xc0 + (n)-280,8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span>  <span class='macro'>stbiw__zlib_huffa(0xc0 + (n)-280,8)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0xc0 + (n)-280,8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huff(n)<span class='macro_popup'>((n) &lt;= 143 ? (bitbuf |= (stbiw__zlib_bitrev(0x30 + (n),8)<br>) &lt;&lt; bitcount, bitcount += (8), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (n) &lt;= 255 ? (bitbuf<br> |= (stbiw__zlib_bitrev(0x190 + (n)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount))) : (n) &lt;= 279 ? (bitbuf |= (stbiw__zlib_bitrev<br>(0 + (n)-256,7)) &lt;&lt; bitcount, bitcount += (7), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (bitbuf |= (stbiw__zlib_bitrev<br>(0xc0 + (n)-280,8)) &lt;&lt; bitcount, bitcount += (8), (out =<br> stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))))</span></span>  ((n) &lt;= 143 ? <span class='macro'>stbiw__zlib_huff1(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x30 + (n),8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span> : (n) &lt;= 255 ? <span class='macro'>stbiw__zlib_huff2(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x190 + (n)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span> : (n) &lt;= 279 ? <span class='macro'>stbiw__zlib_huff3(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0 + (n)-256,7)) &lt;&lt; bitcount<br>, bitcount += (7), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span> : <span class='macro'>stbiw__zlib_huff4(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0xc0 + (n)-280,8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__zlib_huffb(n)<span class='macro_popup'>((n) &lt;= 143 ? (bitbuf |= (stbiw__zlib_bitrev(0x30 + (n),8)<br>) &lt;&lt; bitcount, bitcount += (8), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (bitbuf |= (stbiw__zlib_bitrev<br>(0x190 + (n)-144,9)) &lt;&lt; bitcount, bitcount += (9), (out<br> = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))))</span></span> ((n) &lt;= 143 ? <span class='macro'>stbiw__zlib_huff1(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x30 + (n),8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span> : <span class='macro'>stbiw__zlib_huff2(n)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(0x190 + (n)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount)))</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__ZHASH<span class='macro_popup'>16384</span></span>   16384</span></td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line"><span class='directive'>#endif // STBIW_ZLIB_COMPRESS</span></td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line"><span class='keyword'>unsigned</span> <span class='keyword'>char</span> * stbi_zlib_compress(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *data, <span class='keyword'>int</span> data_len, <span class='keyword'>int</span> *out_len, <span class='keyword'>int</span> quality)</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line"><span class='directive'>#ifdef STBIW_ZLIB_COMPRESS</span></td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">   <span class='comment'>// user provided a zlib compress implementation, use that</span></td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">   <span class='keyword'>return</span> STBIW_ZLIB_COMPRESS(data, data_len, out_len, quality);</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line"><span class='directive'>#else // use builtin</span></td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> lengthc[] = { 3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258, 259 };</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span>  lengtheb[]= { 0,0,0,0,0,0,0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,  4,  5,  5,  5,  5,  0 };</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> distc[]   = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577, 32768 };</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span>  disteb[]  = { 0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13 };</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> bitbuf=0;</td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">   <span class='keyword'>int</span> i,j, bitcount=0;</td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *out = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> ***hash_table = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>***) <span class='macro'>STBIW_MALLOC(stbiw__ZHASH * <span class='keyword'>sizeof</span>(<span class='keyword'>char</span>**))<span class='macro_popup'>malloc(16384 * sizeof(char**))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">   <span class='keyword'>if</span> (hash_table == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">   <span class='keyword'>if</span> (quality &lt; 5) quality = 5;</td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line">   <span class='macro'>stbiw__sbpush(out, 0x78)<span class='macro_popup'>((((out)==0 || ((int *) (out) - 2)[1]+(1) &gt;= ((int *) (out<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(out), (1), sizeof<br>(*(out))) : 0), (out)[((int *) (out) - 2)[1]++] = (0x78))</span></span>;   <span class='comment'>// DEFLATE 32K window</span></td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">   <span class='macro'>stbiw__sbpush(out, 0x5e)<span class='macro_popup'>((((out)==0 || ((int *) (out) - 2)[1]+(1) &gt;= ((int *) (out<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(out), (1), sizeof<br>(*(out))) : 0), (out)[((int *) (out) - 2)[1]++] = (0x5e))</span></span>;   <span class='comment'>// FLEVEL = 1</span></td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">   <span class='macro'>stbiw__zlib_add(1,1)<span class='macro_popup'>(bitbuf |= (1) &lt;&lt; bitcount, bitcount += (1), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount)))</span></span>;  <span class='comment'>// BFINAL = 1</span></td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">   <span class='macro'>stbiw__zlib_add(1,2)<span class='macro_popup'>(bitbuf |= (1) &lt;&lt; bitcount, bitcount += (2), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount)))</span></span>;  <span class='comment'>// BTYPE = 1 -- fixed huffman</span></td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; <span class='macro'>stbiw__ZHASH<span class='macro_popup'>16384</span></span>; ++i)</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">      hash_table[i] = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">   i=0;</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">   <span class='keyword'>while</span> (i &lt; data_len-3) {</td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">      <span class='comment'>// hash next 3 bytes of data to be compressed</span></td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">      <span class='keyword'>int</span> h = stbiw__zhash(data+i)&amp;(<span class='macro'>stbiw__ZHASH<span class='macro_popup'>16384</span></span>-1), best=3;</td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *bestloc = 0;</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span> **hlist = hash_table[h];</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line">      <span class='keyword'>int</span> n = <span class='macro'>stbiw__sbcount(hlist)<span class='macro_popup'>((hlist) ? ((int *) (hlist) - 2)[1] : 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; n; ++j) {</td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">         <span class='keyword'>if</span> (hlist[j]-data &gt; i-32768) { <span class='comment'>// if entry lies within window</span></td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">            <span class='keyword'>int</span> d = stbiw__zlib_countm(hlist[j], data+i, data_len-i);</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">            <span class='keyword'>if</span> (d &gt;= best) best=d,bestloc=hlist[j];</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">      <span class='comment'>// when hash table entry is too long, delete half the entries</span></td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">      <span class='keyword'>if</span> (hash_table[h] &amp;&amp; <span class='macro'>stbiw__sbn(hash_table[h])<span class='macro_popup'>((int *) (hash_table[h]) - 2)[1]</span></span> == 2*quality) {</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">         <span class='macro'>STBIW_MEMMOVE(hash_table[h], hash_table[h]+quality, <span class='keyword'>sizeof</span>(hash_table[h][0])*quality)<span class='macro_popup'>memmove(hash_table[h],hash_table[h]+quality,sizeof(hash_table<br>[h][0])*quality)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">         <span class='macro'>stbiw__sbn(hash_table[h])<span class='macro_popup'>((int *) (hash_table[h]) - 2)[1]</span></span> = quality;</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">      <span class='macro'>stbiw__sbpush(hash_table[h],data+i)<span class='macro_popup'>((((hash_table[h])==0 || ((int *) (hash_table[h]) - 2)[1]+(1)<br> &gt;= ((int *) (hash_table[h]) - 2)[0]) ? stbiw__sbgrowf((void<br> **) &amp;(hash_table[h]), (1), sizeof(*(hash_table[h]))) : 0<br>), (hash_table[h])[((int *) (hash_table[h]) - 2)[1]++] = (data<br>+i))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">      <span class='keyword'>if</span> (bestloc) {</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">         <span class='comment'>// "lazy matching" - check match at *next* byte, and if it's better, do cur byte as literal</span></td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">         h = stbiw__zhash(data+i+1)&amp;(<span class='macro'>stbiw__ZHASH<span class='macro_popup'>16384</span></span>-1);</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line">         hlist = hash_table[h];</td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">         n = <span class='macro'>stbiw__sbcount(hlist)<span class='macro_popup'>((hlist) ? ((int *) (hlist) - 2)[1] : 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; n; ++j) {</td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">            <span class='keyword'>if</span> (hlist[j]-data &gt; i-32767) {</td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">               <span class='keyword'>int</span> e = stbiw__zlib_countm(hlist[j], data+i+1, data_len-i-1);</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">               <span class='keyword'>if</span> (e &gt; best) { <span class='comment'>// if next match is better, bail on current match</span></td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">                  bestloc = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">                  <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">      <span class='keyword'>if</span> (bestloc) {</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">         <span class='keyword'>int</span> d = (<span class='keyword'>int</span>) (data+i - bestloc); <span class='comment'>// distance back</span></td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">         <span class='macro'>STBIW_ASSERT(d &lt;= 32767 &amp;&amp; best &lt;= 258)<span class='macro_popup'>((void) sizeof ((d &lt;= 32767 &amp;&amp; best &lt;= 258) ? 1<br> : 0), __extension__ ({ if (d &lt;= 32767 &amp;&amp; best &lt;=<br> 258) ; else __assert_fail ("d &lt;= 32767 &amp;&amp; best &lt;= 258"<br>, "src/stb_image_write.h", 876, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">         <span class='keyword'>for</span> (j=0; best &gt; lengthc[j+1]-1; ++j);</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line">         <span class='macro'>stbiw__zlib_huff(j+257)<span class='macro_popup'>((j+257) &lt;= 143 ? (bitbuf |= (stbiw__zlib_bitrev(0x30 + (j<br>+257),8)) &lt;&lt; bitcount, bitcount += (8), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (j+257) &lt;= 255 ? (bitbuf<br> |= (stbiw__zlib_bitrev(0x190 + (j+257)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount))) : (j+257) &lt;= 279 ? (bitbuf |= (stbiw__zlib_bitrev<br>(0 + (j+257)-256,7)) &lt;&lt; bitcount, bitcount += (7), (out<br> = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))) : (bitbuf<br> |= (stbiw__zlib_bitrev(0xc0 + (j+257)-280,8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">         <span class='keyword'>if</span> (lengtheb[j]) <span class='macro'>stbiw__zlib_add(best - lengthc[j], lengtheb[j])<span class='macro_popup'>(bitbuf |= (best - lengthc[j]) &lt;&lt; bitcount, bitcount +=<br> (lengtheb[j]), (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;<br>bitcount)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">         <span class='keyword'>for</span> (j=0; d &gt; distc[j+1]-1; ++j);</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">         <span class='macro'>stbiw__zlib_add(stbiw__zlib_bitrev(j,5),5)<span class='macro_popup'>(bitbuf |= (stbiw__zlib_bitrev(j,5)) &lt;&lt; bitcount, bitcount<br> += (5), (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">         <span class='keyword'>if</span> (disteb[j]) <span class='macro'>stbiw__zlib_add(d - distc[j], disteb[j])<span class='macro_popup'>(bitbuf |= (d - distc[j]) &lt;&lt; bitcount, bitcount += (disteb<br>[j]), (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">         i += best;</td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line">         <span class='macro'>stbiw__zlib_huffb(data[i])<span class='macro_popup'>((data[i]) &lt;= 143 ? (bitbuf |= (stbiw__zlib_bitrev(0x30 + (<br>data[i]),8)) &lt;&lt; bitcount, bitcount += (8), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (bitbuf |= (stbiw__zlib_bitrev<br>(0x190 + (data[i])-144,9)) &lt;&lt; bitcount, bitcount += (9)<br>, (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">         ++i;</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">   <span class='comment'>// write out final bytes</span></td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">   <span class='keyword'>for</span> (;i &lt; data_len; ++i)</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">      <span class='macro'>stbiw__zlib_huffb(data[i])<span class='macro_popup'>((data[i]) &lt;= 143 ? (bitbuf |= (stbiw__zlib_bitrev(0x30 + (<br>data[i]),8)) &lt;&lt; bitcount, bitcount += (8), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (bitbuf |= (stbiw__zlib_bitrev<br>(0x190 + (data[i])-144,9)) &lt;&lt; bitcount, bitcount += (9)<br>, (out = stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">   <span class='macro'>stbiw__zlib_huff(256)<span class='macro_popup'>((256) &lt;= 143 ? (bitbuf |= (stbiw__zlib_bitrev(0x30 + (256<br>),8)) &lt;&lt; bitcount, bitcount += (8), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount))) : (256) &lt;= 255 ? (bitbuf<br> |= (stbiw__zlib_bitrev(0x190 + (256)-144,9)) &lt;&lt; bitcount<br>, bitcount += (9), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount))) : (256) &lt;= 279 ? (bitbuf |= (stbiw__zlib_bitrev<br>(0 + (256)-256,7)) &lt;&lt; bitcount, bitcount += (7), (out =<br> stbiw__zlib_flushf(out, &amp;bitbuf, &amp;bitcount))) : (bitbuf<br> |= (stbiw__zlib_bitrev(0xc0 + (256)-280,8)) &lt;&lt; bitcount<br>, bitcount += (8), (out = stbiw__zlib_flushf(out, &amp;bitbuf<br>, &amp;bitcount))))</span></span>; <span class='comment'>// end of block</span></td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">   <span class='comment'>// pad with 0 bits to byte boundary</span></td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">   <span class='keyword'>while</span> (bitcount)</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line">      <span class='macro'>stbiw__zlib_add(0,1)<span class='macro_popup'>(bitbuf |= (0) &lt;&lt; bitcount, bitcount += (1), (out = stbiw__zlib_flushf<br>(out, &amp;bitbuf, &amp;bitcount)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; <span class='macro'>stbiw__ZHASH<span class='macro_popup'>16384</span></span>; ++i)</td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">      (<span class='keyword'>void</span>) <span class='macro'>stbiw__sbfree(hash_table[i])<span class='macro_popup'>((hash_table[i]) ? free(((int *) (hash_table[i]) - 2)),0 : 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line">   <span class='macro'>STBIW_FREE(hash_table)<span class='macro_popup'>free(hash_table)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">      <span class='comment'>// compute adler32 on input</span></td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>int</span> s1=1, s2=0;</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">      <span class='keyword'>int</span> blocklen = (<span class='keyword'>int</span>) (data_len % 5552);</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">      j=0;</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">      <span class='keyword'>while</span> (j &lt; data_len) {</td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; blocklen; ++i) s1 += data[j+i], s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">         s1 %= 65521, s2 %= 65521;</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">         j += blocklen;</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">         blocklen = 5552;</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">      <span class='macro'>stbiw__sbpush(out, STBIW_UCHAR(s2 &gt;&gt; 8))<span class='macro_popup'>((((out)==0 || ((int *) (out) - 2)[1]+(1) &gt;= ((int *) (out<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(out), (1), sizeof<br>(*(out))) : 0), (out)[((int *) (out) - 2)[1]++] = ((unsigned char<br>) ((s2 &gt;&gt; 8) &amp; 0xff)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">      <span class='macro'>stbiw__sbpush(out, STBIW_UCHAR(s2))<span class='macro_popup'>((((out)==0 || ((int *) (out) - 2)[1]+(1) &gt;= ((int *) (out<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(out), (1), sizeof<br>(*(out))) : 0), (out)[((int *) (out) - 2)[1]++] = ((unsigned char<br>) ((s2) &amp; 0xff)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">      <span class='macro'>stbiw__sbpush(out, STBIW_UCHAR(s1 &gt;&gt; 8))<span class='macro_popup'>((((out)==0 || ((int *) (out) - 2)[1]+(1) &gt;= ((int *) (out<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(out), (1), sizeof<br>(*(out))) : 0), (out)[((int *) (out) - 2)[1]++] = ((unsigned char<br>) ((s1 &gt;&gt; 8) &amp; 0xff)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">      <span class='macro'>stbiw__sbpush(out, STBIW_UCHAR(s1))<span class='macro_popup'>((((out)==0 || ((int *) (out) - 2)[1]+(1) &gt;= ((int *) (out<br>) - 2)[0]) ? stbiw__sbgrowf((void **) &amp;(out), (1), sizeof<br>(*(out))) : 0), (out)[((int *) (out) - 2)[1]++] = ((unsigned char<br>) ((s1) &amp; 0xff)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">   *out_len = <span class='macro'>stbiw__sbn(out)<span class='macro_popup'>((int *) (out) - 2)[1]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">   <span class='comment'>// make returned pointer freeable</span></td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">   <span class='macro'>STBIW_MEMMOVE(stbiw__sbraw(out), out, *out_len)<span class='macro_popup'>memmove(((int *) (out) - 2),out,*out_len)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">   <span class='keyword'>return</span> (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) <span class='macro'>stbiw__sbraw(out)<span class='macro_popup'>((int *) (out) - 2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line"><span class='directive'>#endif // STBIW_ZLIB_COMPRESS</span></td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> stbiw__crc32(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len)</td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> crc_table[256] =</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line">      0x00000000, 0x77073096, 0xEE0E612C, 0x990951BA, 0x076DC419, 0x706AF48F, 0xE963A535, 0x9E6495A3,</td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line">      0x0eDB8832, 0x79DCB8A4, 0xE0D5E91E, 0x97D2D988, 0x09B64C2B, 0x7EB17CBD, 0xE7B82D07, 0x90BF1D91,</td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line">      0x1DB71064, 0x6AB020F2, 0xF3B97148, 0x84BE41DE, 0x1ADAD47D, 0x6DDDE4EB, 0xF4D4B551, 0x83D385C7,</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">      0x136C9856, 0x646BA8C0, 0xFD62F97A, 0x8A65C9EC, 0x14015C4F, 0x63066CD9, 0xFA0F3D63, 0x8D080DF5,</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">      0x3B6E20C8, 0x4C69105E, 0xD56041E4, 0xA2677172, 0x3C03E4D1, 0x4B04D447, 0xD20D85FD, 0xA50AB56B,</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">      0x35B5A8FA, 0x42B2986C, 0xDBBBC9D6, 0xACBCF940, 0x32D86CE3, 0x45DF5C75, 0xDCD60DCF, 0xABD13D59,</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">      0x26D930AC, 0x51DE003A, 0xC8D75180, 0xBFD06116, 0x21B4F4B5, 0x56B3C423, 0xCFBA9599, 0xB8BDA50F,</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">      0x2802B89E, 0x5F058808, 0xC60CD9B2, 0xB10BE924, 0x2F6F7C87, 0x58684C11, 0xC1611DAB, 0xB6662D3D,</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line">      0x76DC4190, 0x01DB7106, 0x98D220BC, 0xEFD5102A, 0x71B18589, 0x06B6B51F, 0x9FBFE4A5, 0xE8B8D433,</td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">      0x7807C9A2, 0x0F00F934, 0x9609A88E, 0xE10E9818, 0x7F6A0DBB, 0x086D3D2D, 0x91646C97, 0xE6635C01,</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">      0x6B6B51F4, 0x1C6C6162, 0x856530D8, 0xF262004E, 0x6C0695ED, 0x1B01A57B, 0x8208F4C1, 0xF50FC457,</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">      0x65B0D9C6, 0x12B7E950, 0x8BBEB8EA, 0xFCB9887C, 0x62DD1DDF, 0x15DA2D49, 0x8CD37CF3, 0xFBD44C65,</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">      0x4DB26158, 0x3AB551CE, 0xA3BC0074, 0xD4BB30E2, 0x4ADFA541, 0x3DD895D7, 0xA4D1C46D, 0xD3D6F4FB,</td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">      0x4369E96A, 0x346ED9FC, 0xAD678846, 0xDA60B8D0, 0x44042D73, 0x33031DE5, 0xAA0A4C5F, 0xDD0D7CC9,</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">      0x5005713C, 0x270241AA, 0xBE0B1010, 0xC90C2086, 0x5768B525, 0x206F85B3, 0xB966D409, 0xCE61E49F,</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">      0x5EDEF90E, 0x29D9C998, 0xB0D09822, 0xC7D7A8B4, 0x59B33D17, 0x2EB40D81, 0xB7BD5C3B, 0xC0BA6CAD,</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">      0xEDB88320, 0x9ABFB3B6, 0x03B6E20C, 0x74B1D29A, 0xEAD54739, 0x9DD277AF, 0x04DB2615, 0x73DC1683,</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">      0xE3630B12, 0x94643B84, 0x0D6D6A3E, 0x7A6A5AA8, 0xE40ECF0B, 0x9309FF9D, 0x0A00AE27, 0x7D079EB1,</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">      0xF00F9344, 0x8708A3D2, 0x1E01F268, 0x6906C2FE, 0xF762575D, 0x806567CB, 0x196C3671, 0x6E6B06E7,</td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line">      0xFED41B76, 0x89D32BE0, 0x10DA7A5A, 0x67DD4ACC, 0xF9B9DF6F, 0x8EBEEFF9, 0x17B7BE43, 0x60B08ED5,</td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">      0xD6D6A3E8, 0xA1D1937E, 0x38D8C2C4, 0x4FDFF252, 0xD1BB67F1, 0xA6BC5767, 0x3FB506DD, 0x48B2364B,</td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">      0xD80D2BDA, 0xAF0A1B4C, 0x36034AF6, 0x41047A60, 0xDF60EFC3, 0xA867DF55, 0x316E8EEF, 0x4669BE79,</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">      0xCB61B38C, 0xBC66831A, 0x256FD2A0, 0x5268E236, 0xCC0C7795, 0xBB0B4703, 0x220216B9, 0x5505262F,</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">      0xC5BA3BBE, 0xB2BD0B28, 0x2BB45A92, 0x5CB36A04, 0xC2D7FFA7, 0xB5D0CF31, 0x2CD99E8B, 0x5BDEAE1D,</td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">      0x9B64C2B0, 0xEC63F226, 0x756AA39C, 0x026D930A, 0x9C0906A9, 0xEB0E363F, 0x72076785, 0x05005713,</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line">      0x95BF4A82, 0xE2B87A14, 0x7BB12BAE, 0x0CB61B38, 0x92D28E9B, 0xE5D5BE0D, 0x7CDCEFB7, 0x0BDBDF21,</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">      0x86D3D2D4, 0xF1D4E242, 0x68DDB3F8, 0x1FDA836E, 0x81BE16CD, 0xF6B9265B, 0x6FB077E1, 0x18B74777,</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">      0x88085AE6, 0xFF0F6A70, 0x66063BCA, 0x11010B5C, 0x8F659EFF, 0xF862AE69, 0x616BFFD3, 0x166CCF45,</td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">      0xA00AE278, 0xD70DD2EE, 0x4E048354, 0x3903B3C2, 0xA7672661, 0xD06016F7, 0x4969474D, 0x3E6E77DB,</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">      0xAED16A4A, 0xD9D65ADC, 0x40DF0B66, 0x37D83BF0, 0xA9BCAE53, 0xDEBB9EC5, 0x47B2CF7F, 0x30B5FFE9,</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">      0xBDBDF21C, 0xCABAC28A, 0x53B39330, 0x24B4A3A6, 0xBAD03605, 0xCDD70693, 0x54DE5729, 0x23D967BF,</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line">      0xB3667A2E, 0xC4614AB8, 0x5D681B02, 0x2A6F2B94, 0xB40BBE37, 0xC30C8EA1, 0x5A05DF1B, 0x2D02EF8D</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> crc = ~0u;</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; len; ++i)</td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">      crc = (crc &gt;&gt; 8) ^ crc_table[buffer[i] ^ (crc &amp; 0xff)];</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">   <span class='keyword'>return</span> ~crc;</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__wpng4(o,a,b,c,d)<span class='macro_popup'>((o)[0]=(unsigned char) ((a) &amp; 0xff),(o)[1]=(unsigned char<br>) ((b) &amp; 0xff),(o)[2]=(unsigned char) ((c) &amp; 0xff),(o<br>)[3]=(unsigned char) ((d) &amp; 0xff),(o)+=4)</span></span> ((o)[0]=<span class='macro'>STBIW_UCHAR(a)<span class='macro_popup'>(unsigned char) ((a) &amp; 0xff)</span></span>,(o)[1]=<span class='macro'>STBIW_UCHAR(b)<span class='macro_popup'>(unsigned char) ((b) &amp; 0xff)</span></span>,(o)[2]=<span class='macro'>STBIW_UCHAR(c)<span class='macro_popup'>(unsigned char) ((c) &amp; 0xff)</span></span>,(o)[3]=<span class='macro'>STBIW_UCHAR(d)<span class='macro_popup'>(unsigned char) ((d) &amp; 0xff)</span></span>,(o)+=4)</span></td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__wp32(data,v)<span class='macro_popup'>((data)[0]=(unsigned char) (((v)&gt;&gt;24) &amp; 0xff),(data<br>)[1]=(unsigned char) (((v)&gt;&gt;16) &amp; 0xff),(data)[2]=(<br>unsigned char) (((v)&gt;&gt;8) &amp; 0xff),(data)[3]=(unsigned<br> char) (((v)) &amp; 0xff),(data)+=4);</span></span> <span class='macro'>stbiw__wpng4(data, (v)&gt;&gt;24,(v)&gt;&gt;16,(v)&gt;&gt;8,(v))<span class='macro_popup'>((data)[0]=(unsigned char) (((v)&gt;&gt;24) &amp; 0xff),(data<br>)[1]=(unsigned char) (((v)&gt;&gt;16) &amp; 0xff),(data)[2]=(<br>unsigned char) (((v)&gt;&gt;8) &amp; 0xff),(data)[3]=(unsigned<br> char) (((v)) &amp; 0xff),(data)+=4)</span></span>;</span></td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line"><span class='directive'>#define <span class='macro'>stbiw__wptag(data,s)<span class='macro_popup'>((data)[0]=(unsigned char) ((s[0]) &amp; 0xff),(data)[1]=(unsigned<br> char) ((s[1]) &amp; 0xff),(data)[2]=(unsigned char) ((s[2]) &amp;<br> 0xff),(data)[3]=(unsigned char) ((s[3]) &amp; 0xff),(data)+=<br>4)</span></span> <span class='macro'>stbiw__wpng4(data, s[0],s[1],s[2],s[3])<span class='macro_popup'>((data)[0]=(unsigned char) ((s[0]) &amp; 0xff),(data)[1]=(unsigned<br> char) ((s[1]) &amp; 0xff),(data)[2]=(unsigned char) ((s[2]) &amp;<br> 0xff),(data)[3]=(unsigned char) ((s[3]) &amp; 0xff),(data)+=<br>4)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__wpcrc(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> **data, <span class='keyword'>int</span> len)</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> crc = stbiw__crc32(*data - len - 4, len+4);</td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">   <span class='macro'>stbiw__wp32(*data, crc)<span class='macro_popup'>((*data)[0]=(unsigned char) (((crc)&gt;&gt;24) &amp; 0xff),(*<br>data)[1]=(unsigned char) (((crc)&gt;&gt;16) &amp; 0xff),(*data<br>)[2]=(unsigned char) (((crc)&gt;&gt;8) &amp; 0xff),(*data)[3]<br>=(unsigned char) (((crc)) &amp; 0xff),(*data)+=4);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> stbiw__paeth(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> c)</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">   <span class='keyword'>int</span> p = a + b - c, pa = abs(p-a), pb = abs(p-b), pc = abs(p-c);</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">   <span class='keyword'>if</span> (pa &lt;= pb &amp;&amp; pa &lt;= pc) <span class='keyword'>return</span> <span class='macro'>STBIW_UCHAR(a)<span class='macro_popup'>(unsigned char) ((a) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">   <span class='keyword'>if</span> (pb &lt;= pc) <span class='keyword'>return</span> <span class='macro'>STBIW_UCHAR(b)<span class='macro_popup'>(unsigned char) ((b) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">   <span class='keyword'>return</span> <span class='macro'>STBIW_UCHAR(c)<span class='macro_popup'>(unsigned char) ((c) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line"><span class='comment'>// @OPTIMIZE: provide an option that always forces left-predict or paeth predict</span></td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__encode_png_line(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pixels, <span class='keyword'>int</span> stride_bytes, <span class='keyword'>int</span> width, <span class='keyword'>int</span> height, <span class='keyword'>int</span> y, <span class='keyword'>int</span> n, <span class='keyword'>int</span> filter_type, <span class='keyword'>signed</span> <span class='keyword'>char</span> *line_buffer)</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>int</span> mapping[] = { 0,1,2,3,4 };</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>int</span> firstmap[] = { 0,1,0,5,6 };</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">   <span class='keyword'>int</span> *mymap = (y != 0) ? mapping : firstmap;</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">   <span class='keyword'>int</span> type = mymap[filter_type];</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *z = pixels + stride_bytes * (stbi__flip_vertically_on_write ? height-1-y : y);</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">   <span class='keyword'>int</span> signed_stride = stbi__flip_vertically_on_write ? -stride_bytes : stride_bytes;</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">   <span class='keyword'>for</span> (i = 0; i &lt; n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">      <span class='keyword'>switch</span> (type) {</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">         <span class='keyword'>case</span> 0: line_buffer[i] = z[i]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">         <span class='keyword'>case</span> 1: line_buffer[i] = z[i]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">         <span class='keyword'>case</span> 2: line_buffer[i] = z[i] - z[i-signed_stride]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">         <span class='keyword'>case</span> 3: line_buffer[i] = z[i] - (z[i-signed_stride]&gt;&gt;1); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">         <span class='keyword'>case</span> 4: line_buffer[i] = (<span class='keyword'>signed</span> <span class='keyword'>char</span>) (z[i] - stbiw__paeth(0,z[i-signed_stride],0)); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">         <span class='keyword'>case</span> 5: line_buffer[i] = z[i]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">         <span class='keyword'>case</span> 6: line_buffer[i] = z[i]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">   <span class='keyword'>for</span> (i=n; i &lt; width*n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">      <span class='keyword'>switch</span> (type) {</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">         <span class='keyword'>case</span> 0: line_buffer[i] = z[i]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">         <span class='keyword'>case</span> 1: line_buffer[i] = z[i] - z[i-n]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">         <span class='keyword'>case</span> 2: line_buffer[i] = z[i] - z[i-signed_stride]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">         <span class='keyword'>case</span> 3: line_buffer[i] = z[i] - ((z[i-n] + z[i-signed_stride])&gt;&gt;1); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">         <span class='keyword'>case</span> 4: line_buffer[i] = z[i] - stbiw__paeth(z[i-n], z[i-signed_stride], z[i-signed_stride-n]); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">         <span class='keyword'>case</span> 5: line_buffer[i] = z[i] - (z[i-n]&gt;&gt;1); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">         <span class='keyword'>case</span> 6: line_buffer[i] = z[i] - stbiw__paeth(z[i-n], 0,0); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line"><span class='keyword'>unsigned</span> <span class='keyword'>char</span> *stbi_write_png_to_mem(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pixels, <span class='keyword'>int</span> stride_bytes, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> n, <span class='keyword'>int</span> *out_len)</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">   <span class='keyword'>int</span> force_filter = stbi_write_force_png_filter;</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">   <span class='keyword'>int</span> ctype[5] = { -1, 0, 4, 2, 6 };</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> sig[8] = { 137,80,78,71,13,10,26,10 };</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *out,*o, *filt, *zlib;</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">   <span class='keyword'>signed</span> <span class='keyword'>char</span> *line_buffer;</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">   <span class='keyword'>int</span> j,zlen;</td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">   <span class='keyword'>if</span> (stride_bytes == 0)</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">      stride_bytes = x * n;</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">   <span class='keyword'>if</span> (force_filter &gt;= 5) {</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">      force_filter = -1;</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">   filt = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) <span class='macro'>STBIW_MALLOC((x*n+1) * y)<span class='macro_popup'>malloc((x*n+1) * y)</span></span>; <span class='keyword'>if</span> (!filt) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line">   line_buffer = (<span class='keyword'>signed</span> <span class='keyword'>char</span> *) <span class='macro'>STBIW_MALLOC(x * n)<span class='macro_popup'>malloc(x * n)</span></span>; <span class='keyword'>if</span> (!line_buffer) { <span class='macro'>STBIW_FREE(filt)<span class='macro_popup'>free(filt)</span></span>; <span class='keyword'>return</span> 0; }</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">   <span class='keyword'>for</span> (j=0; j &lt; y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">      <span class='keyword'>int</span> filter_type;</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">      <span class='keyword'>if</span> (force_filter &gt; -1) {</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">         filter_type = force_filter;</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">         stbiw__encode_png_line(pixels, stride_bytes, x, y, j, n, force_filter, line_buffer);</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">      } <span class='keyword'>else</span> { <span class='comment'>// Estimate the best filter by running through all of them:</span></td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">         <span class='keyword'>int</span> best_filter = 0, best_filter_val = 0x7fffffff, est, i;</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">         <span class='keyword'>for</span> (filter_type = 0; filter_type &lt; 5; filter_type++) {</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">            stbiw__encode_png_line(pixels, stride_bytes, x, y, j, n, filter_type, line_buffer);</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">            <span class='comment'>// Estimate the entropy of the line using this filter; the less, the better.</span></td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">            est = 0;</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">            <span class='keyword'>for</span> (i = 0; i &lt; x*n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">               est += abs((<span class='keyword'>signed</span> <span class='keyword'>char</span>) line_buffer[i]);</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">            <span class='keyword'>if</span> (est &lt; best_filter_val) {</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">               best_filter_val = est;</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">               best_filter = filter_type;</td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">         <span class='keyword'>if</span> (filter_type != best_filter) {  <span class='comment'>// If the last iteration already got us the best filter, don't redo it</span></td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">            stbiw__encode_png_line(pixels, stride_bytes, x, y, j, n, best_filter, line_buffer);</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">            filter_type = best_filter;</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">      <span class='comment'>// when we get here, filter_type contains the filter type, and line_buffer contains the data</span></td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">      filt[j*(x*n+1)] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) filter_type;</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">      <span class='macro'>STBIW_MEMMOVE(filt+j*(x*n+1)+1, line_buffer, x*n)<span class='macro_popup'>memmove(filt+j*(x*n+1)+1,line_buffer,x*n)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">   <span class='macro'>STBIW_FREE(line_buffer)<span class='macro_popup'>free(line_buffer)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">   zlib = stbi_zlib_compress(filt, y*( x*n+1), &amp;zlen, stbi_write_png_compression_level);</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">   <span class='macro'>STBIW_FREE(filt)<span class='macro_popup'>free(filt)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">   <span class='keyword'>if</span> (!zlib) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">   <span class='comment'>// each tag requires 12 bytes of overhead</span></td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">   out = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) <span class='macro'>STBIW_MALLOC(8 + 12+13 + 12+zlen + 12)<span class='macro_popup'>malloc(8 + 12+13 + 12+zlen + 12)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">   <span class='keyword'>if</span> (!out) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">   *out_len = 8 + 12+13 + 12+zlen + 12;</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">   o=out;</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">   <span class='macro'>STBIW_MEMMOVE(o,sig,8)<span class='macro_popup'>memmove(o,sig,8)</span></span>; o+= 8;</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">   <span class='macro'>stbiw__wp32(o, 13)<span class='macro_popup'>((o)[0]=(unsigned char) (((13)&gt;&gt;24) &amp; 0xff),(o)[1]=<br>(unsigned char) (((13)&gt;&gt;16) &amp; 0xff),(o)[2]=(unsigned<br> char) (((13)&gt;&gt;8) &amp; 0xff),(o)[3]=(unsigned char) ((<br>(13)) &amp; 0xff),(o)+=4);</span></span>; <span class='comment'>// header length</span></td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">   <span class='macro'>stbiw__wptag(o, <span class='string_literal'>"IHDR"</span>)<span class='macro_popup'>((o)[0]=(unsigned char) (("IHDR"[0]) &amp; 0xff),(o)[1]=(unsigned<br> char) (("IHDR"[1]) &amp; 0xff),(o)[2]=(unsigned char) (("IHDR"<br>[2]) &amp; 0xff),(o)[3]=(unsigned char) (("IHDR"[3]) &amp; 0xff<br>),(o)+=4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">   <span class='macro'>stbiw__wp32(o, x)<span class='macro_popup'>((o)[0]=(unsigned char) (((x)&gt;&gt;24) &amp; 0xff),(o)[1]=(<br>unsigned char) (((x)&gt;&gt;16) &amp; 0xff),(o)[2]=(unsigned char<br>) (((x)&gt;&gt;8) &amp; 0xff),(o)[3]=(unsigned char) (((x)) &amp;<br> 0xff),(o)+=4);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">   <span class='macro'>stbiw__wp32(o, y)<span class='macro_popup'>((o)[0]=(unsigned char) (((y)&gt;&gt;24) &amp; 0xff),(o)[1]=(<br>unsigned char) (((y)&gt;&gt;16) &amp; 0xff),(o)[2]=(unsigned char<br>) (((y)&gt;&gt;8) &amp; 0xff),(o)[3]=(unsigned char) (((y)) &amp;<br> 0xff),(o)+=4);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">   *o++ = 8;</td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">   *o++ = <span class='macro'>STBIW_UCHAR(ctype[n])<span class='macro_popup'>(unsigned char) ((ctype[n]) &amp; 0xff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">   *o++ = 0;</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">   *o++ = 0;</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">   *o++ = 0;</td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">   stbiw__wpcrc(&amp;o,13);</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">   <span class='macro'>stbiw__wp32(o, zlen)<span class='macro_popup'>((o)[0]=(unsigned char) (((zlen)&gt;&gt;24) &amp; 0xff),(o)[1<br>]=(unsigned char) (((zlen)&gt;&gt;16) &amp; 0xff),(o)[2]=(unsigned<br> char) (((zlen)&gt;&gt;8) &amp; 0xff),(o)[3]=(unsigned char) (<br>((zlen)) &amp; 0xff),(o)+=4);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">   <span class='macro'>stbiw__wptag(o, <span class='string_literal'>"IDAT"</span>)<span class='macro_popup'>((o)[0]=(unsigned char) (("IDAT"[0]) &amp; 0xff),(o)[1]=(unsigned<br> char) (("IDAT"[1]) &amp; 0xff),(o)[2]=(unsigned char) (("IDAT"<br>[2]) &amp; 0xff),(o)[3]=(unsigned char) (("IDAT"[3]) &amp; 0xff<br>),(o)+=4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">   <span class="mrange"><span class='macro'>STBIW_MEMMOVE</span>(o, zlib, zlen)<span class='macro_popup'>memmove(o,zlib,zlen)</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:4ex; max-width:59em">Call to function 'memmove' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memmove_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">   o += zlen;</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">   <span class='macro'>STBIW_FREE(zlib)<span class='macro_popup'>free(zlib)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">   stbiw__wpcrc(&amp;o, zlen);</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line">   <span class='macro'>stbiw__wp32(o,0)<span class='macro_popup'>((o)[0]=(unsigned char) (((0)&gt;&gt;24) &amp; 0xff),(o)[1]=(<br>unsigned char) (((0)&gt;&gt;16) &amp; 0xff),(o)[2]=(unsigned char<br>) (((0)&gt;&gt;8) &amp; 0xff),(o)[3]=(unsigned char) (((0)) &amp;<br> 0xff),(o)+=4);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">   <span class='macro'>stbiw__wptag(o, <span class='string_literal'>"IEND"</span>)<span class='macro_popup'>((o)[0]=(unsigned char) (("IEND"[0]) &amp; 0xff),(o)[1]=(unsigned<br> char) (("IEND"[1]) &amp; 0xff),(o)[2]=(unsigned char) (("IEND"<br>[2]) &amp; 0xff),(o)[3]=(unsigned char) (("IEND"[3]) &amp; 0xff<br>),(o)+=4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">   stbiw__wpcrc(&amp;o,0);</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">   <span class='macro'>STBIW_ASSERT(o == out + *out_len)<span class='macro_popup'>((void) sizeof ((o == out + *out_len) ? 1 : 0), __extension__<br> ({ if (o == out + *out_len) ; else __assert_fail ("o == out + *out_len"<br>, "src/stb_image_write.h", 1102, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_png(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data, <span class='keyword'>int</span> stride_bytes)</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">   FILE *f;</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">   <span class='keyword'>int</span> len;</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *png = stbi_write_png_to_mem((<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) data, stride_bytes, x, y, comp, &amp;len);</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">   <span class='keyword'>if</span> (png == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line"><span class='directive'>#ifdef STBI_MSC_SECURE_CRT</span></td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">   <span class='keyword'>if</span> (fopen_s(&amp;f, filename, <span class='string_literal'>"wb"</span>))</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line">      f = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">   f = fopen(filename, <span class='string_literal'>"wb"</span>);</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">   <span class='keyword'>if</span> (!f) { <span class='macro'>STBIW_FREE(png)<span class='macro_popup'>free(png)</span></span>; <span class='keyword'>return</span> 0; }</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">   fwrite(png, 1, len, f);</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">   fclose(f);</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">   <span class='macro'>STBIW_FREE(png)<span class='macro_popup'>free(png)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_png_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data, <span class='keyword'>int</span> stride_bytes)</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">   <span class='keyword'>int</span> len;</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *png = stbi_write_png_to_mem((<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) data, stride_bytes, x, y, comp, &amp;len);</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">   <span class='keyword'>if</span> (png == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">   func(context, png, len);</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">   <span class='macro'>STBIW_FREE(png)<span class='macro_popup'>free(png)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line"><span class='comment'>/* ***************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line"> <span class='comment'>* JPEG writer</span></td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line"> <span class='comment'>* This is based on Jon Olick's jo_jpeg.cpp:</span></td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line"> <span class='comment'>* public domain Simple, Minimalistic JPEG writer - http://www.jonolick.com/code.html</span></td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> stbiw__jpg_ZigZag[] = { 0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">      24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63 };</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__jpg_writeBits(stbi__write_context *s, <span class='keyword'>int</span> *bitBufP, <span class='keyword'>int</span> *bitCntP, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> *bs) {</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">   <span class='keyword'>int</span> bitBuf = *bitBufP, bitCnt = *bitCntP;</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">   bitCnt += bs[1];</td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">   bitBuf |= bs[0] &lt;&lt; (24 - bitCnt);</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">   <span class='keyword'>while</span>(bitCnt &gt;= 8) {</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span> c = (bitBuf &gt;&gt; 16) &amp; 255;</td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">      stbiw__putc(s, c);</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">      <span class='keyword'>if</span>(c == 255) {</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">         stbiw__putc(s, 0);</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">      bitBuf &lt;&lt;= 8;</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">      bitCnt -= 8;</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">   *bitBufP = bitBuf;</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">   *bitCntP = bitCnt;</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__jpg_DCT(<span class='keyword'>float</span> *d0p, <span class='keyword'>float</span> *d1p, <span class='keyword'>float</span> *d2p, <span class='keyword'>float</span> *d3p, <span class='keyword'>float</span> *d4p, <span class='keyword'>float</span> *d5p, <span class='keyword'>float</span> *d6p, <span class='keyword'>float</span> *d7p) {</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">   <span class='keyword'>float</span> d0 = *d0p, d1 = *d1p, d2 = *d2p, d3 = *d3p, d4 = *d4p, d5 = *d5p, d6 = *d6p, d7 = *d7p;</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">   <span class='keyword'>float</span> z1, z2, z3, z4, z5, z11, z13;</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">   <span class='keyword'>float</span> tmp0 = d0 + d7;</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">   <span class='keyword'>float</span> tmp7 = d0 - d7;</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">   <span class='keyword'>float</span> tmp1 = d1 + d6;</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">   <span class='keyword'>float</span> tmp6 = d1 - d6;</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">   <span class='keyword'>float</span> tmp2 = d2 + d5;</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">   <span class='keyword'>float</span> tmp5 = d2 - d5;</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">   <span class='keyword'>float</span> tmp3 = d3 + d4;</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">   <span class='keyword'>float</span> tmp4 = d3 - d4;</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">   <span class='comment'>// Even part</span></td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">   <span class='keyword'>float</span> tmp10 = tmp0 + tmp3;   <span class='comment'>// phase 2</span></td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">   <span class='keyword'>float</span> tmp13 = tmp0 - tmp3;</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">   <span class='keyword'>float</span> tmp11 = tmp1 + tmp2;</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">   <span class='keyword'>float</span> tmp12 = tmp1 - tmp2;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">   d0 = tmp10 + tmp11;       <span class='comment'>// phase 3</span></td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">   d4 = tmp10 - tmp11;</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">   z1 = (tmp12 + tmp13) * 0.707106781f; <span class='comment'>// c4</span></td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">   d2 = tmp13 + z1;       <span class='comment'>// phase 5</span></td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">   d6 = tmp13 - z1;</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">   <span class='comment'>// Odd part</span></td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">   tmp10 = tmp4 + tmp5;       <span class='comment'>// phase 2</span></td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">   tmp11 = tmp5 + tmp6;</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">   tmp12 = tmp6 + tmp7;</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">   <span class='comment'>// The rotator is modified from fig 4-8 to avoid extra negations.</span></td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">   z5 = (tmp10 - tmp12) * 0.382683433f; <span class='comment'>// c6</span></td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">   z2 = tmp10 * 0.541196100f + z5; <span class='comment'>// c2-c6</span></td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">   z4 = tmp12 * 1.306562965f + z5; <span class='comment'>// c2+c6</span></td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">   z3 = tmp11 * 0.707106781f; <span class='comment'>// c4</span></td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">   z11 = tmp7 + z3;      <span class='comment'>// phase 5</span></td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line">   z13 = tmp7 - z3;</td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">   *d5p = z13 + z2;         <span class='comment'>// phase 6</span></td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">   *d3p = z13 - z2;</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">   *d1p = z11 + z4;</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">   *d7p = z11 - z4;</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">   *d0p = d0;  *d2p = d2;  *d4p = d4;  *d6p = d6;</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbiw__jpg_calcBits(<span class='keyword'>int</span> val, <span class='keyword'>unsigned</span> <span class='keyword'>short</span> bits[2]) {</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">   <span class='keyword'>int</span> tmp1 = val &lt; 0 ? -val : val;</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">   val = val &lt; 0 ? val-1 : val;</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">   bits[1] = 1;</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">   <span class='keyword'>while</span>(tmp1 &gt;&gt;= 1) {</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">      ++bits[1];</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line">   bits[0] = val &amp; ((1&lt;&lt;bits[1])-1);</td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbiw__jpg_processDU(stbi__write_context *s, <span class='keyword'>int</span> *bitBuf, <span class='keyword'>int</span> *bitCnt, <span class='keyword'>float</span> *CDU, <span class='keyword'>float</span> *fdtbl, <span class='keyword'>int</span> DC, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> HTDC[256][2], <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> HTAC[256][2]) {</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">   <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> EOB[2] = { HTAC[0x00][0], HTAC[0x00][1] };</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">   <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> M16zeroes[2] = { HTAC[0xF0][0], HTAC[0xF0][1] };</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line">   <span class='keyword'>int</span> dataOff, i, diff, end0pos;</td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line">   <span class='keyword'>int</span> DU[64];</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">   <span class='comment'>// DCT rows</span></td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">   <span class='keyword'>for</span>(dataOff=0; dataOff&lt;64; dataOff+=8) {</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">      stbiw__jpg_DCT(&amp;CDU[dataOff], &amp;CDU[dataOff+1], &amp;CDU[dataOff+2], &amp;CDU[dataOff+3], &amp;CDU[dataOff+4], &amp;CDU[dataOff+5], &amp;CDU[dataOff+6], &amp;CDU[dataOff+7]);</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">   <span class='comment'>// DCT columns</span></td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">   <span class='keyword'>for</span>(dataOff=0; dataOff&lt;8; ++dataOff) {</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">      stbiw__jpg_DCT(&amp;CDU[dataOff], &amp;CDU[dataOff+8], &amp;CDU[dataOff+16], &amp;CDU[dataOff+24], &amp;CDU[dataOff+32], &amp;CDU[dataOff+40], &amp;CDU[dataOff+48], &amp;CDU[dataOff+56]);</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">   <span class='comment'>// Quantize/descale/zigzag the coefficients</span></td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">   <span class='keyword'>for</span>(i=0; i&lt;64; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">      <span class='keyword'>float</span> v = CDU[i]*fdtbl[i];</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">      <span class='comment'>// DU[stbiw__jpg_ZigZag[i]] = (int)(v &lt; 0 ? ceilf(v - 0.5f) : floorf(v + 0.5f));</span></td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">      <span class='comment'>// ceilf() and floorf() are C99, not C89, but I /think/ they're not needed here anyway?</span></td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">      DU[stbiw__jpg_ZigZag[i]] = (<span class='keyword'>int</span>)(v &lt; 0 ? v - 0.5f : v + 0.5f);</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">   <span class='comment'>// Encode DC</span></td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">   diff = DU[0] - DC;</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">   <span class='keyword'>if</span> (diff == 0) {</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, HTDC[0]);</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>short</span> bits[2];</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">      stbiw__jpg_calcBits(diff, bits);</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, HTDC[bits[1]]);</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, bits);</td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">   <span class='comment'>// Encode ACs</span></td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">   end0pos = 63;</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">   <span class='keyword'>for</span>(; (end0pos&gt;0)&amp;&amp;(DU[end0pos]==0); --end0pos) {</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">   <span class='comment'>// end0pos = first element in reverse order !=0</span></td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">   <span class='keyword'>if</span>(end0pos == 0) {</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, EOB);</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">      <span class='keyword'>return</span> DU[0];</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">   <span class='keyword'>for</span>(i = 1; i &lt;= end0pos; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">      <span class='keyword'>int</span> startpos = i;</td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">      <span class='keyword'>int</span> nrzeroes;</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>short</span> bits[2];</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">      <span class='keyword'>for</span> (; DU[i]==0 &amp;&amp; i&lt;=end0pos; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">      nrzeroes = i-startpos;</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">      <span class='keyword'>if</span> ( nrzeroes &gt;= 16 ) {</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">         <span class='keyword'>int</span> lng = nrzeroes&gt;&gt;4;</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">         <span class='keyword'>int</span> nrmarker;</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">         <span class='keyword'>for</span> (nrmarker=1; nrmarker &lt;= lng; ++nrmarker)</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">            stbiw__jpg_writeBits(s, bitBuf, bitCnt, M16zeroes);</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">         nrzeroes &amp;= 15;</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">      stbiw__jpg_calcBits(DU[i], bits);</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, HTAC[(nrzeroes&lt;&lt;4)+bits[1]]);</td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, bits);</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">   <span class='keyword'>if</span>(end0pos != 63) {</td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">      stbiw__jpg_writeBits(s, bitBuf, bitCnt, EOB);</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">   <span class='keyword'>return</span> DU[0];</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi_write_jpg_core(stbi__write_context *s, <span class='keyword'>int</span> width, <span class='keyword'>int</span> height, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span>* data, <span class='keyword'>int</span> quality) {</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">   <span class='comment'>// Constants that don't pollute global namespace</span></td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_dc_luminance_nrcodes[] = {0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0};</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_dc_luminance_values[] = {0,1,2,3,4,5,6,7,8,9,10,11};</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_ac_luminance_nrcodes[] = {0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d};</td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_ac_luminance_values[] = {</td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line">      0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">      0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">      0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">      0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line">      0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,</td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">      0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">      0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_dc_chrominance_nrcodes[] = {0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0};</td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_dc_chrominance_values[] = {0,1,2,3,4,5,6,7,8,9,10,11};</td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_ac_chrominance_nrcodes[] = {0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77};</td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> std_ac_chrominance_values[] = {</td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">      0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,</td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line">      0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,</td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line">      0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,</td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line">      0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,</td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">      0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,</td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">      0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">      0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">   <span class='comment'>// Huffman tables</span></td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> YDC_HT[256][2] = { {0,2},{2,3},{3,3},{4,3},{5,3},{6,3},{14,4},{30,5},{62,6},{126,7},{254,8},{510,9}};</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> UVDC_HT[256][2] = { {0,2},{1,2},{2,2},{6,3},{14,4},{30,5},{62,6},{126,7},{254,8},{510,9},{1022,10},{2046,11}};</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> YAC_HT[256][2] = {</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">      {10,4},{0,2},{1,2},{4,3},{11,4},{26,5},{120,7},{248,8},{1014,10},{65410,16},{65411,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">      {12,4},{27,5},{121,7},{502,9},{2038,11},{65412,16},{65413,16},{65414,16},{65415,16},{65416,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">      {28,5},{249,8},{1015,10},{4084,12},{65417,16},{65418,16},{65419,16},{65420,16},{65421,16},{65422,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">      {58,6},{503,9},{4085,12},{65423,16},{65424,16},{65425,16},{65426,16},{65427,16},{65428,16},{65429,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line">      {59,6},{1016,10},{65430,16},{65431,16},{65432,16},{65433,16},{65434,16},{65435,16},{65436,16},{65437,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">      {122,7},{2039,11},{65438,16},{65439,16},{65440,16},{65441,16},{65442,16},{65443,16},{65444,16},{65445,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">      {123,7},{4086,12},{65446,16},{65447,16},{65448,16},{65449,16},{65450,16},{65451,16},{65452,16},{65453,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">      {250,8},{4087,12},{65454,16},{65455,16},{65456,16},{65457,16},{65458,16},{65459,16},{65460,16},{65461,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">      {504,9},{32704,15},{65462,16},{65463,16},{65464,16},{65465,16},{65466,16},{65467,16},{65468,16},{65469,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">      {505,9},{65470,16},{65471,16},{65472,16},{65473,16},{65474,16},{65475,16},{65476,16},{65477,16},{65478,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">      {506,9},{65479,16},{65480,16},{65481,16},{65482,16},{65483,16},{65484,16},{65485,16},{65486,16},{65487,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">      {1017,10},{65488,16},{65489,16},{65490,16},{65491,16},{65492,16},{65493,16},{65494,16},{65495,16},{65496,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">      {1018,10},{65497,16},{65498,16},{65499,16},{65500,16},{65501,16},{65502,16},{65503,16},{65504,16},{65505,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">      {2040,11},{65506,16},{65507,16},{65508,16},{65509,16},{65510,16},{65511,16},{65512,16},{65513,16},{65514,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">      {65515,16},{65516,16},{65517,16},{65518,16},{65519,16},{65520,16},{65521,16},{65522,16},{65523,16},{65524,16},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">      {2041,11},{65525,16},{65526,16},{65527,16},{65528,16},{65529,16},{65530,16},{65531,16},{65532,16},{65533,16},{65534,16},{0,0},{0,0},{0,0},{0,0},{0,0}</td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> UVAC_HT[256][2] = {</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">      {0,2},{1,2},{4,3},{10,4},{24,5},{25,5},{56,6},{120,7},{500,9},{1014,10},{4084,12},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">      {11,4},{57,6},{246,8},{501,9},{2038,11},{4085,12},{65416,16},{65417,16},{65418,16},{65419,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">      {26,5},{247,8},{1015,10},{4086,12},{32706,15},{65420,16},{65421,16},{65422,16},{65423,16},{65424,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">      {27,5},{248,8},{1016,10},{4087,12},{65425,16},{65426,16},{65427,16},{65428,16},{65429,16},{65430,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">      {58,6},{502,9},{65431,16},{65432,16},{65433,16},{65434,16},{65435,16},{65436,16},{65437,16},{65438,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">      {59,6},{1017,10},{65439,16},{65440,16},{65441,16},{65442,16},{65443,16},{65444,16},{65445,16},{65446,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">      {121,7},{2039,11},{65447,16},{65448,16},{65449,16},{65450,16},{65451,16},{65452,16},{65453,16},{65454,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">      {122,7},{2040,11},{65455,16},{65456,16},{65457,16},{65458,16},{65459,16},{65460,16},{65461,16},{65462,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">      {249,8},{65463,16},{65464,16},{65465,16},{65466,16},{65467,16},{65468,16},{65469,16},{65470,16},{65471,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">      {503,9},{65472,16},{65473,16},{65474,16},{65475,16},{65476,16},{65477,16},{65478,16},{65479,16},{65480,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">      {504,9},{65481,16},{65482,16},{65483,16},{65484,16},{65485,16},{65486,16},{65487,16},{65488,16},{65489,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">      {505,9},{65490,16},{65491,16},{65492,16},{65493,16},{65494,16},{65495,16},{65496,16},{65497,16},{65498,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">      {506,9},{65499,16},{65500,16},{65501,16},{65502,16},{65503,16},{65504,16},{65505,16},{65506,16},{65507,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">      {2041,11},{65508,16},{65509,16},{65510,16},{65511,16},{65512,16},{65513,16},{65514,16},{65515,16},{65516,16},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">      {16352,14},{65517,16},{65518,16},{65519,16},{65520,16},{65521,16},{65522,16},{65523,16},{65524,16},{65525,16},{0,0},{0,0},{0,0},{0,0},{0,0},</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">      {1018,10},{32707,15},{65526,16},{65527,16},{65528,16},{65529,16},{65530,16},{65531,16},{65532,16},{65533,16},{65534,16},{0,0},{0,0},{0,0},{0,0},{0,0}</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> YQT[] = {16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">                             37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99};</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> UVQT[] = {17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">                              99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99};</td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>float</span> aasf[] = { 1.0f * 2.828427125f, 1.387039845f * 2.828427125f, 1.306562965f * 2.828427125f, 1.175875602f * 2.828427125f, </td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">                                 1.0f * 2.828427125f, 0.785694958f * 2.828427125f, 0.541196100f * 2.828427125f, 0.275899379f * 2.828427125f };</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line">   <span class='keyword'>int</span> row, col, i, k;</td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">   <span class='keyword'>float</span> fdtbl_Y[64], fdtbl_UV[64];</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> YTable[64], UVTable[64];</td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line">   <span class='keyword'>if</span>(!data || !width || !height || comp &gt; 4 || comp &lt; 1) {</td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line">   quality = quality ? quality : 90;</td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">   quality = quality &lt; 1 ? 1 : quality &gt; 100 ? 100 : quality;</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line">   quality = quality &lt; 50 ? 5000 / quality : 200 - quality * 2;</td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">   <span class='keyword'>for</span>(i = 0; i &lt; 64; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">      <span class='keyword'>int</span> uvti, yti = (YQT[i]*quality+50)/100;</td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">      YTable[stbiw__jpg_ZigZag[i]] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) (yti &lt; 1 ? 1 : yti &gt; 255 ? 255 : yti);</td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">      uvti = (UVQT[i]*quality+50)/100;</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">      UVTable[stbiw__jpg_ZigZag[i]] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) (uvti &lt; 1 ? 1 : uvti &gt; 255 ? 255 : uvti);</td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">   <span class='keyword'>for</span>(row = 0, k = 0; row &lt; 8; ++row) {</td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">      <span class='keyword'>for</span>(col = 0; col &lt; 8; ++col, ++k) {</td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">         fdtbl_Y[k]  = 1 / (YTable [stbiw__jpg_ZigZag[k]] * aasf[row] * aasf[col]);</td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">         fdtbl_UV[k] = 1 / (UVTable[stbiw__jpg_ZigZag[k]] * aasf[row] * aasf[col]);</td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">   <span class='comment'>// Write Headers</span></td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">      <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> head0[] = { 0xFF,0xD8,0xFF,0xE0,0,0x10,'J','F','I','F',0,1,1,0,0,1,0,1,0,0,0xFF,0xDB,0,0x84,0 };</td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line">      <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> head2[] = { 0xFF,0xDA,0,0xC,3,1,0,2,0x11,3,0x11,0,0x3F,0 };</td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">      <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> head1[] = { 0xFF,0xC0,0,0x11,8,(<span class='keyword'>unsigned</span> <span class='keyword'>char</span>)(height&gt;&gt;8),<span class='macro'>STBIW_UCHAR(height)<span class='macro_popup'>(unsigned char) ((height) &amp; 0xff)</span></span>,(<span class='keyword'>unsigned</span> <span class='keyword'>char</span>)(width&gt;&gt;8),<span class='macro'>STBIW_UCHAR(width)<span class='macro_popup'>(unsigned char) ((width) &amp; 0xff)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">                                      3,1,0x11,0,2,0x11,1,3,0x11,1,0xFF,0xC4,0x01,0xA2,0 };</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)head0, <span class='keyword'>sizeof</span>(head0));</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)YTable, <span class='keyword'>sizeof</span>(YTable));</td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">      stbiw__putc(s, 1);</td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">      s-&gt;func(s-&gt;context, UVTable, <span class='keyword'>sizeof</span>(UVTable));</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)head1, <span class='keyword'>sizeof</span>(head1));</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)(std_dc_luminance_nrcodes+1), <span class='keyword'>sizeof</span>(std_dc_luminance_nrcodes)-1);</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)std_dc_luminance_values, <span class='keyword'>sizeof</span>(std_dc_luminance_values));</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">      stbiw__putc(s, 0x10); <span class='comment'>// HTYACinfo</span></td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)(std_ac_luminance_nrcodes+1), <span class='keyword'>sizeof</span>(std_ac_luminance_nrcodes)-1);</td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)std_ac_luminance_values, <span class='keyword'>sizeof</span>(std_ac_luminance_values));</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">      stbiw__putc(s, 1); <span class='comment'>// HTUDCinfo</span></td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)(std_dc_chrominance_nrcodes+1), <span class='keyword'>sizeof</span>(std_dc_chrominance_nrcodes)-1);</td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)std_dc_chrominance_values, <span class='keyword'>sizeof</span>(std_dc_chrominance_values));</td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">      stbiw__putc(s, 0x11); <span class='comment'>// HTUACinfo</span></td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)(std_ac_chrominance_nrcodes+1), <span class='keyword'>sizeof</span>(std_ac_chrominance_nrcodes)-1);</td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)std_ac_chrominance_values, <span class='keyword'>sizeof</span>(std_ac_chrominance_values));</td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">      s-&gt;func(s-&gt;context, (<span class='keyword'>void</span>*)head2, <span class='keyword'>sizeof</span>(head2));</td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">   <span class='comment'>// Encode 8x8 macroblocks</span></td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">      <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> fillBits[] = {0x7F, 7};</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line">      <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *imageData = (<span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *)data;</td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">      <span class='keyword'>int</span> DCY=0, DCU=0, DCV=0;</td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">      <span class='keyword'>int</span> bitBuf=0, bitCnt=0;</td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">      <span class='comment'>// comp == 2 is grey+alpha (alpha is ignored)</span></td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">      <span class='keyword'>int</span> ofsG = comp &gt; 2 ? 1 : 0, ofsB = comp &gt; 2 ? 2 : 0;</td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line">      <span class='keyword'>int</span> x, y, pos;</td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">      <span class='keyword'>for</span>(y = 0; y &lt; height; y += 8) {</td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">         <span class='keyword'>for</span>(x = 0; x &lt; width; x += 8) {</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">            <span class='keyword'>float</span> YDU[64], UDU[64], VDU[64];</td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">            <span class='keyword'>for</span>(row = y, pos = 0; row &lt; y+8; ++row) {</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">               <span class='keyword'>for</span>(col = x; col &lt; x+8; ++col, ++pos) {</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">                  <span class='keyword'>int</span> p = (stbi__flip_vertically_on_write ? height-1-row : row)*width*comp + col*comp;</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line">                  <span class='keyword'>float</span> r, g, b;</td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">                  <span class='keyword'>if</span>(row &gt;= height) {</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">                     p -= width*comp*(row+1 - height);</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">                  <span class='keyword'>if</span>(col &gt;= width) {</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">                     p -= comp*(col+1 - width);</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">                  r = imageData[p+0];</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">                  g = imageData[p+ofsG];</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">                  b = imageData[p+ofsB];</td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">                  YDU[pos]=+0.29900f*r+0.58700f*g+0.11400f*b-128;</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line">                  UDU[pos]=-0.16874f*r-0.33126f*g+0.50000f*b;</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">                  VDU[pos]=+0.50000f*r-0.41869f*g-0.08131f*b;</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line">            DCY = stbiw__jpg_processDU(s, &amp;bitBuf, &amp;bitCnt, YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT);</td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">            DCU = stbiw__jpg_processDU(s, &amp;bitBuf, &amp;bitCnt, UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT);</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">            DCV = stbiw__jpg_processDU(s, &amp;bitBuf, &amp;bitCnt, VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT);</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">      <span class='comment'>// Do the bit alignment of the EOI marker</span></td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">      stbiw__jpg_writeBits(s, &amp;bitBuf, &amp;bitCnt, fillBits);</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">   <span class='comment'>// EOI</span></td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">   stbiw__putc(s, 0xFF);</td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">   stbiw__putc(s, 0xD9);</td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_jpg_to_func(stbi_write_func *func, <span class='keyword'>void</span> *context, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data, <span class='keyword'>int</span> quality)</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">   stbi__start_write_callbacks(&amp;s, func, context);</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">   <span class='keyword'>return</span> stbi_write_jpg_core(&amp;s, x, y, comp, (<span class='keyword'>void</span> *) data, quality);</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line"><span class='directive'>#ifndef STBI_WRITE_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line"><span class='macro'>STBIWDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_write_jpg(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp, <span class='keyword'>const</span> <span class='keyword'>void</span> *data, <span class='keyword'>int</span> quality)</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">   stbi__write_context s;</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">   <span class='keyword'>if</span> (stbi__start_write_file(&amp;s,filename)) {</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">      <span class='keyword'>int</span> r = stbi_write_jpg_core(&amp;s, x, y, comp, data, quality);</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">      stbi__end_write_file(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line">      <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">   } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line"><span class='directive'>#endif // STB_IMAGE_WRITE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line"><span class='comment'>/* Revision history</span></td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">      <span class='comment'>1.09  (2018-02-11)</span></td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">             <span class='comment'>fix typo in zlib quality API, improve STB_I_W_STATIC in C++</span></td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">      <span class='comment'>1.08  (2018-01-29)</span></td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">             <span class='comment'>add stbi__flip_vertically_on_write, external zlib, zlib quality, choose PNG filter</span></td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">      <span class='comment'>1.07  (2017-07-24)</span></td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">             <span class='comment'>doc fix</span></td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">      <span class='comment'>1.06 (2017-07-23)</span></td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">             <span class='comment'>writing JPEG (using Jon Olick's code)</span></td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">      <span class='comment'>1.05   ???</span></td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">      <span class='comment'>1.04 (2017-03-03)</span></td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">             <span class='comment'>monochrome BMP expansion</span></td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">      <span class='comment'>1.03   ???</span></td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">      <span class='comment'>1.02 (2016-04-02)</span></td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">             <span class='comment'>avoid allocating large structures on the stack</span></td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">      <span class='comment'>1.01 (2016-01-16)</span></td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">             <span class='comment'>STBIW_REALLOC_SIZED: support allocators with no realloc support</span></td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">             <span class='comment'>avoid race-condition in crc initialization</span></td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">             <span class='comment'>minor compile issues</span></td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">      <span class='comment'>1.00 (2015-09-14)</span></td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">             <span class='comment'>installable file IO function</span></td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">      <span class='comment'>0.99 (2015-09-13)</span></td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">             <span class='comment'>warning fixes; TGA rle support</span></td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">      <span class='comment'>0.98 (2015-04-08)</span></td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line">             <span class='comment'>added STBIW_MALLOC, STBIW_ASSERT etc</span></td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">      <span class='comment'>0.97 (2015-01-18)</span></td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line">             <span class='comment'>fixed HDR asserts, rewrote HDR rle logic</span></td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">      <span class='comment'>0.96 (2015-01-17)</span></td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">             <span class='comment'>add HDR output</span></td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">             <span class='comment'>fix monochrome BMP</span></td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">      <span class='comment'>0.95 (2014-08-17)</span></td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">		       <span class='comment'>add monochrome TGA output</span></td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">      <span class='comment'>0.94 (2014-05-31)</span></td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line">             <span class='comment'>rename private functions to avoid conflicts with stb_image.h</span></td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">      <span class='comment'>0.93 (2014-05-27)</span></td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">             <span class='comment'>warning fixes</span></td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">      <span class='comment'>0.92 (2010-08-01)</span></td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">             <span class='comment'>casts to unsigned char to fix warnings</span></td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line">      <span class='comment'>0.91 (2010-07-17)</span></td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">             <span class='comment'>first public release</span></td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">      <span class='comment'>0.90   first internal release</span></td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line"><span class='comment'>This software is available under 2 licenses -- choose whichever you prefer.</span></td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line"><span class='comment'>ALTERNATIVE A - MIT License</span></td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line"><span class='comment'>Copyright (c) 2017 Sean Barrett</span></td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line"><span class='comment'>Permission is hereby granted, free of charge, to any person obtaining a copy of</span> </td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line"><span class='comment'>this software and associated documentation files (the "Software"), to deal in</span> </td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line"><span class='comment'>the Software without restriction, including without limitation the rights to</span> </td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line"><span class='comment'>use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies</span> </td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line"><span class='comment'>of the Software, and to permit persons to whom the Software is furnished to do</span> </td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line"><span class='comment'>so, subject to the following conditions:</span></td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line"><span class='comment'>The above copyright notice and this permission notice shall be included in all</span> </td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line"><span class='comment'>copies or substantial portions of the Software.</span></td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line"><span class='comment'>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span> </td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line"><span class='comment'>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span> </td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line"><span class='comment'>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span> </td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line"><span class='comment'>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span> </td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line"><span class='comment'>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span> </td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line"><span class='comment'>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span> </td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line"><span class='comment'>SOFTWARE.</span></td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line"><span class='comment'>ALTERNATIVE B - Public Domain (www.unlicense.org)</span></td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line"><span class='comment'>This is free and unencumbered software released into the public domain.</span></td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line"><span class='comment'>Anyone is free to copy, modify, publish, use, compile, sell, or distribute this</span> </td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line"><span class='comment'>software, either in source code form or as a compiled binary, for any purpose,</span> </td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line"><span class='comment'>commercial or non-commercial, and by any means.</span></td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line"><span class='comment'>In jurisdictions that recognize copyright laws, the author or authors of this</span> </td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line"><span class='comment'>software dedicate any and all copyright interest in the software to the public</span> </td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line"><span class='comment'>domain. We make this dedication for the benefit of the public at large and to</span> </td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line"><span class='comment'>the detriment of our heirs and successors. We intend this dedication to be an</span> </td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line"><span class='comment'>overt act of relinquishment in perpetuity of all present and future rights to</span> </td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line"><span class='comment'>this software under copyright law.</span></td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line"><span class='comment'>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span> </td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line"><span class='comment'>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span> </td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line"><span class='comment'>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span> </td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line"><span class='comment'>AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span> </td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line"><span class='comment'>ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span> </td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line"><span class='comment'>WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line"><span class='comment'>*/</span></td></tr>
</table></body></html>
