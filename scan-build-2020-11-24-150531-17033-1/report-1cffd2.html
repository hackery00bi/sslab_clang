<!doctype html>
<html>
<head>
<title>src/stb_image.h</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memset' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/sslab_clang/c_darknet/darknet/src/stb_image.h -->

<!-- FILENAME stb_image.h -->

<!-- FUNCTIONNAME stbi__pic_load -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT c53888600e9d1ca757ff76e1730b1cfc -->

<!-- BUGLINE 6092 -->

<!-- BUGCOLUMN 4 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>src/stb_image.h</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 6092, column 4</a><br />Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name image.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model pic -pic-level 2 -mframe-pointer=none -menable-no-infs -menable-no-nans -menable-unsafe-fp-math -fno-signed-zeros -mreassociate -freciprocal-math -fdenormal-fp-math=preserve-sign,preserve-sign -ffp-contract=fast -fno-rounding-math -ffast-math -ffinite-math-only -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -I include/ -I src/ -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -Ofast -Wno-unused-result -Wno-unknown-pragmas -fdebug-compilation-dir /tmp/sslab_clang/c_darknet/darknet -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-24-150531-17033-1 -x c ./src/image.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"15316": {"6092": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="15316">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/* stb_image - v2.19 - public domain image loader - http://nothings.org/stb</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line">                                  <span class='comment'>no warranty implied; use at your own risk</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line">   <span class='comment'>Do this:</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line">      <span class='comment'>#define STB_IMAGE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line">   <span class='comment'>before you include this file in *one* C or C++ file to create the implementation.</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line">   <span class='comment'>// i.e. it should look like this:</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line">   <span class='comment'>#include ...</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line">   <span class='comment'>#include ...</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line">   <span class='comment'>#include ...</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line">   <span class='comment'>#define STB_IMAGE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line">   <span class='comment'>#include "stb_image.h"</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line">   <span class='comment'>You can #define STBI_ASSERT(x) before the #include to avoid using assert.h.</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line">   <span class='comment'>And #define STBI_MALLOC, STBI_REALLOC, and STBI_FREE to avoid using malloc,realloc,free</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line">   <span class='comment'>QUICK NOTES:</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line">      <span class='comment'>Primarily of interest to game developers and other people who can</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line">          <span class='comment'>avoid problematic images and only need the trivial interface</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line">      <span class='comment'>JPEG baseline &amp; progressive (12 bpc/arithmetic not supported, same as stock IJG lib)</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line">      <span class='comment'>PNG 1/2/4/8/16-bit-per-channel</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">      <span class='comment'>TGA (not sure what subset, if a subset)</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">      <span class='comment'>BMP non-1bpp, non-RLE</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">      <span class='comment'>PSD (composited view only, no extra channels, 8/16 bit-per-channel)</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">      <span class='comment'>GIF (*comp always reports as 4-channel)</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">      <span class='comment'>HDR (radiance rgbE format)</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">      <span class='comment'>PIC (Softimage PIC)</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">      <span class='comment'>PNM (PPM and PGM binary only)</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">      <span class='comment'>Animated GIF still needs a proper API, but here's one way to do it:</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">          <span class='comment'>http://gist.github.com/urraka/685d9a6340b26b830d49</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">      <span class='comment'>- decode from memory or through FILE (define STBI_NO_STDIO to remove code)</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">      <span class='comment'>- decode from arbitrary I/O callbacks</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">      <span class='comment'>- SIMD acceleration on x86/x64 (SSE2) and ARM (NEON)</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">   <span class='comment'>Full documentation under "DOCUMENTATION" below.</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"><span class='comment'>LICENSE</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">  <span class='comment'>See end of file for license information.</span></td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='comment'>RECENT REVISION HISTORY:</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">      <span class='comment'>2.19  (2018-02-11) fix warning</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">      <span class='comment'>2.18  (2018-01-30) fix warnings</span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">      <span class='comment'>2.17  (2018-01-29) bugfix, 1-bit BMP, 16-bitness query, fix warnings</span></td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">      <span class='comment'>2.16  (2017-07-23) all functions have 16-bit variants; optimizations; bugfixes</span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">      <span class='comment'>2.15  (2017-03-18) fix png-1,2,4; all Imagenet JPGs; no runtime SSE detection on GCC</span></td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">      <span class='comment'>2.14  (2017-03-03) remove deprecated STBI_JPEG_OLD; fixes for Imagenet JPGs</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">      <span class='comment'>2.13  (2016-12-04) experimental 16-bit API, only for PNG so far; fixes</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">      <span class='comment'>2.12  (2016-04-02) fix typo in 2.11 PSD fix that caused crashes</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">      <span class='comment'>2.11  (2016-04-02) 16-bit PNGS; enable SSE2 in non-gcc x64</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">                         <span class='comment'>RGB-format JPEG; remove white matting in PSD;</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">                         <span class='comment'>allocate large structures on the stack;</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">                         <span class='comment'>correct channel count for PNG &amp; BMP</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">      <span class='comment'>2.10  (2016-01-22) avoid warning introduced in 2.09</span></td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">      <span class='comment'>2.09  (2016-01-16) 16-bit TGA; comments in PNM files; STBI_REALLOC_SIZED</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">   <span class='comment'>See end of file for full revision history.</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"> <span class='comment'>============================    Contributors    =========================</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> <span class='comment'>Image formats                          Extensions, features</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">    <span class='comment'>Sean Barrett (jpeg, png, bmp)          Jetro Lauha (stbi_info)</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">    <span class='comment'>Nicolas Schulz (hdr, psd)              Martin "SpartanJ" Golini (stbi_info)</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">    <span class='comment'>Jonathan Dummer (tga)                  James "moose2000" Brown (iPhone PNG)</span></td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">    <span class='comment'>Jean-Marc Lienher (gif)                Ben "Disch" Wenger (io callbacks)</span></td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">    <span class='comment'>Tom Seddon (pic)                       Omar Cornut (1/2/4-bit PNG)</span></td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">    <span class='comment'>Thatcher Ulrich (psd)                  Nicolas Guillemot (vertical flip)</span></td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">    <span class='comment'>Ken Miller (pgm, ppm)                  Richard Mitton (16-bit PSD)</span></td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    <span class='comment'>github:urraka (animated gif)           Junggon Kim (PNM comments)</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">    <span class='comment'>Christopher Forseth (animated gif)     Daniel Gibson (16-bit TGA)</span></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">                                           <span class='comment'>socks-the-fox (16-bit PNG)</span></td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">                                           <span class='comment'>Jeremy Sawicki (handle all ImageNet JPGs)</span></td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"> <span class='comment'>Optimizations &amp; bugfixes                  Mikhail Morozov (1-bit BMP)</span></td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">    <span class='comment'>Fabian "ryg" Giesen                    Anael Seghezzi (is-16-bit query)</span></td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">    <span class='comment'>Arseny Kapoulkine</span></td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">    <span class='comment'>John-Mark Allen</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"> <span class='comment'>Bug &amp; warning fixes</span></td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">    <span class='comment'>Marc LeBlanc            David Woo          Guillaume George   Martins Mozeiko</span></td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    <span class='comment'>Christpher Lloyd        Jerry Jansson      Joseph Thomson     Phil Jordan</span></td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">    <span class='comment'>Dave Moore              Roy Eltham         Hayaki Saito       Nathan Reed</span></td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">    <span class='comment'>Won Chun                Luke Graham        Johan Duparc       Nick Verigakis</span></td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">    <span class='comment'>the Horde3D community   Thomas Ruf         Ronny Chevalier    github:rlyeh</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">    <span class='comment'>Janez Zemva             John Bartholomew   Michal Cichon      github:romigrou</span></td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    <span class='comment'>Jonathan Blow           Ken Hamada         Tero Hanninen      github:svdijk</span></td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    <span class='comment'>Laurent Gomila          Cort Stratton      Sergio Gonzalez    github:snagar</span></td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    <span class='comment'>Aruelien Pocheville     Thibault Reuille   Cass Everitt       github:Zelex</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">    <span class='comment'>Ryamond Barbiero        Paul Du Bois       Engin Manap        github:grim210</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    <span class='comment'>Aldo Culquicondor       Philipp Wiesemann  Dale Weiler        github:sammyhw</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">    <span class='comment'>Oriol Ferrer Mesia      Josh Tobin         Matthew Gregan     github:phprus</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">    <span class='comment'>Julian Raschke          Gregory Mullen     Baldur Karlsson    github:poppolopoppo</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">    <span class='comment'>Christian Floisand      Kevin Schmidt                         github:darealshinji</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">    <span class='comment'>Blazej Dariusz Roszkowski                                     github:Michaelangel007</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"><span class='directive'>#ifndef STBI_INCLUDE_STB_IMAGE_H</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"><span class='directive'>#define STBI_INCLUDE_STB_IMAGE_H</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line"><span class='comment'>// DOCUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"><span class='comment'>// Limitations:</span></td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"><span class='comment'>//    - no 12-bit-per-channel JPEG</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"><span class='comment'>//    - no JPEGs with arithmetic coding</span></td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line"><span class='comment'>//    - GIF always returns *comp=4</span></td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"><span class='comment'>// Basic usage (see HDR discussion below for HDR usage):</span></td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line"><span class='comment'>//    int x,y,n;</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"><span class='comment'>//    unsigned char *data = stbi_load(filename, &amp;x, &amp;y, &amp;n, 0);</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line"><span class='comment'>//    // ... process data if not NULL ...</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"><span class='comment'>//    // ... x = width, y = height, n = # 8-bit components per pixel ...</span></td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line"><span class='comment'>//    // ... replace '0' with '1'..'4' to force that many components per pixel</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"><span class='comment'>//    // ... but 'n' will always be the number that it would have been if you said 0</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"><span class='comment'>//    stbi_image_free(data)</span></td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"><span class='comment'>// Standard parameters:</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"><span class='comment'>//    int *x                 -- outputs image width in pixels</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line"><span class='comment'>//    int *y                 -- outputs image height in pixels</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"><span class='comment'>//    int *channels_in_file  -- outputs # of image components in image file</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='comment'>//    int desired_channels   -- if non-zero, # of image components requested in result</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"><span class='comment'>// The return value from an image loader is an 'unsigned char *' which points</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"><span class='comment'>// to the pixel data, or NULL on an allocation failure or if the image is</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line"><span class='comment'>// corrupt or invalid. The pixel data consists of *y scanlines of *x pixels,</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"><span class='comment'>// with each pixel consisting of N interleaved 8-bit components; the first</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"><span class='comment'>// pixel pointed to is top-left-most in the image. There is no padding between</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='comment'>// image scanlines or between pixels, regardless of format. The number of</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"><span class='comment'>// components N is 'desired_channels' if desired_channels is non-zero, or</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line"><span class='comment'>// *channels_in_file otherwise. If desired_channels is non-zero,</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line"><span class='comment'>// *channels_in_file has the number of components that _would_ have been</span></td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line"><span class='comment'>// output otherwise. E.g. if you set desired_channels to 4, you will always</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"><span class='comment'>// get RGBA output, but you can check *channels_in_file to see if it's trivially</span></td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='comment'>// opaque because e.g. there were only 3 channels in the source image.</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"><span class='comment'>// An output image with N components has the following components interleaved</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line"><span class='comment'>// in this order in each pixel:</span></td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"><span class='comment'>//     N=#comp     components</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='comment'>//       1           grey</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='comment'>//       2           grey, alpha</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"><span class='comment'>//       3           red, green, blue</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='comment'>//       4           red, green, blue, alpha</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line"><span class='comment'>// If image loading fails for any reason, the return value will be NULL,</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"><span class='comment'>// and *x, *y, *channels_in_file will be unchanged. The function</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='comment'>// stbi_failure_reason() can be queried for an extremely brief, end-user</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='comment'>// unfriendly explanation of why the load failed. Define STBI_NO_FAILURE_STRINGS</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='comment'>// to avoid compiling these strings at all, and STBI_FAILURE_USERMSG to get slightly</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='comment'>// more user-friendly ones.</span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='comment'>// Paletted PNG, BMP, GIF, and PIC images are automatically depalettized.</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"><span class='comment'>// ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"><span class='comment'>// Philosophy</span></td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"><span class='comment'>// stb libraries are designed with the following priorities:</span></td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"><span class='comment'>//    1. easy to use</span></td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"><span class='comment'>//    2. easy to maintain</span></td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"><span class='comment'>//    3. good performance</span></td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"><span class='comment'>// Sometimes I let "good performance" creep up in priority over "easy to maintain",</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"><span class='comment'>// and for best performance I may provide less-easy-to-use APIs that give higher</span></td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line"><span class='comment'>// performance, in addition to the easy to use ones. Nevertheless, it's important</span></td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"><span class='comment'>// to keep in mind that from the standpoint of you, a client of this library,</span></td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"><span class='comment'>// all you care about is #1 and #3, and stb libraries DO NOT emphasize #3 above all.</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"><span class='comment'>// Some secondary priorities arise directly from the first two, some of which</span></td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line"><span class='comment'>// make more explicit reasons why performance can't be emphasized.</span></td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line"><span class='comment'>//    - Portable ("ease of use")</span></td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"><span class='comment'>//    - Small source code footprint ("easy to maintain")</span></td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line"><span class='comment'>//    - No dependencies ("ease of use")</span></td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"><span class='comment'>// ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"><span class='comment'>// I/O callbacks</span></td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"><span class='comment'>// I/O callbacks allow you to read from arbitrary sources, like packaged</span></td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line"><span class='comment'>// files or some other source. Data read from callbacks are processed</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line"><span class='comment'>// through a small internal buffer (currently 128 bytes) to try to reduce</span></td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"><span class='comment'>// overhead.</span></td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line"><span class='comment'>// The three functions you must define are "read" (reads some bytes of data),</span></td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line"><span class='comment'>// "skip" (skips some bytes of data), "eof" (reports if the stream is at the end).</span></td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line"><span class='comment'>// ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line"><span class='comment'>// SIMD support</span></td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"><span class='comment'>// The JPEG decoder will try to automatically use SIMD kernels on x86 when</span></td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line"><span class='comment'>// supported by the compiler. For ARM Neon support, you must explicitly</span></td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"><span class='comment'>// request it.</span></td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line"><span class='comment'>// (The old do-it-yourself SIMD API is no longer supported in the current</span></td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line"><span class='comment'>// code.)</span></td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line"><span class='comment'>// On x86, SSE2 will automatically be used when available based on a run-time</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line"><span class='comment'>// test; if not, the generic C versions are used as a fall-back. On ARM targets,</span></td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"><span class='comment'>// the typical path is to have separate builds for NEON and non-NEON devices</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"><span class='comment'>// (at least this is true for iOS and Android). Therefore, the NEON support is</span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line"><span class='comment'>// toggled by a build flag: define STBI_NEON to get NEON loops.</span></td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line"><span class='comment'>// If for some reason you do not want to use any of SIMD code, or if</span></td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line"><span class='comment'>// you have issues compiling it, you can disable it entirely by</span></td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line"><span class='comment'>// defining STBI_NO_SIMD.</span></td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line"><span class='comment'>// ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"><span class='comment'>// HDR image support   (disable by defining STBI_NO_HDR)</span></td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"><span class='comment'>// stb_image now supports loading HDR images in general, and currently</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"><span class='comment'>// the Radiance .HDR file format, although the support is provided</span></td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line"><span class='comment'>// generically. You can still load any file through the existing interface;</span></td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"><span class='comment'>// if you attempt to load an HDR file, it will be automatically remapped to</span></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"><span class='comment'>// LDR, assuming gamma 2.2 and an arbitrary scale factor defaulting to 1;</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"><span class='comment'>// both of these constants can be reconfigured through this interface:</span></td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"><span class='comment'>//     stbi_hdr_to_ldr_gamma(2.2f);</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"><span class='comment'>//     stbi_hdr_to_ldr_scale(1.0f);</span></td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line"><span class='comment'>// (note, do not use _inverse_ constants; stbi_image will invert them</span></td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line"><span class='comment'>// appropriately).</span></td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"><span class='comment'>// Additionally, there is a new, parallel interface for loading files as</span></td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line"><span class='comment'>// (linear) floats to preserve the full dynamic range:</span></td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line"><span class='comment'>//    float *data = stbi_loadf(filename, &amp;x, &amp;y, &amp;n, 0);</span></td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"><span class='comment'>// If you load LDR images through this interface, those images will</span></td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"><span class='comment'>// be promoted to floating point values, run through the inverse of</span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"><span class='comment'>// constants corresponding to the above:</span></td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line"><span class='comment'>//     stbi_ldr_to_hdr_scale(1.0f);</span></td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line"><span class='comment'>//     stbi_ldr_to_hdr_gamma(2.2f);</span></td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"><span class='comment'>// Finally, given a filename (or an open file or memory block--see header</span></td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"><span class='comment'>// file for details) containing image data, you can query for the "most</span></td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line"><span class='comment'>// appropriate" interface to use (that is, whether the image is HDR or</span></td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"><span class='comment'>// not), using:</span></td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line"><span class='comment'>//     stbi_is_hdr(char *filename);</span></td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line"><span class='comment'>// ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line"><span class='comment'>// iPhone PNG support:</span></td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line"><span class='comment'>// By default we convert iphone-formatted PNGs back to RGB, even though</span></td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"><span class='comment'>// they are internally encoded differently. You can disable this conversion</span></td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"><span class='comment'>// by by calling stbi_convert_iphone_png_to_rgb(0), in which case</span></td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line"><span class='comment'>// you will always just get the native iphone "format" through (which</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line"><span class='comment'>// is BGR stored in RGB).</span></td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"><span class='comment'>// Call stbi_set_unpremultiply_on_load(1) as well to force a divide per</span></td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line"><span class='comment'>// pixel to remove any premultiplied alpha *only* if the image file explicitly</span></td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line"><span class='comment'>// says there's premultiplied data (currently only happens in iPhone images,</span></td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line"><span class='comment'>// and only if iPhone convert-to-rgb processing is on).</span></td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line"><span class='comment'>// ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"><span class='comment'>// ADDITIONAL CONFIGURATION</span></td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"><span class='comment'>//  - You can suppress implementation of any of the decoders to reduce</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line"><span class='comment'>//    your code footprint by #defining one or more of the following</span></td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line"><span class='comment'>//    symbols before creating the implementation.</span></td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"><span class='comment'>//        STBI_NO_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"><span class='comment'>//        STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line"><span class='comment'>//        STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line"><span class='comment'>//        STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line"><span class='comment'>//        STBI_NO_TGA</span></td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line"><span class='comment'>//        STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"><span class='comment'>//        STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line"><span class='comment'>//        STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line"><span class='comment'>//        STBI_NO_PNM   (.ppm and .pgm)</span></td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line"><span class='comment'>//  - You can request *only* certain decoders and suppress all other ones</span></td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line"><span class='comment'>//    (this will be more forward-compatible, as addition of new decoders</span></td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line"><span class='comment'>//    doesn't require you to disable them explicitly):</span></td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line"><span class='comment'>//        STBI_ONLY_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line"><span class='comment'>//        STBI_ONLY_PNG</span></td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line"><span class='comment'>//        STBI_ONLY_BMP</span></td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line"><span class='comment'>//        STBI_ONLY_PSD</span></td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line"><span class='comment'>//        STBI_ONLY_TGA</span></td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line"><span class='comment'>//        STBI_ONLY_GIF</span></td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line"><span class='comment'>//        STBI_ONLY_HDR</span></td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"><span class='comment'>//        STBI_ONLY_PIC</span></td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line"><span class='comment'>//        STBI_ONLY_PNM   (.ppm and .pgm)</span></td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"><span class='comment'>//   - If you use STBI_NO_PNG (or _ONLY_ without PNG), and you still</span></td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line"><span class='comment'>//     want the zlib decoder to be available, #define STBI_SUPPORT_ZLIB</span></td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line"><span class='directive'>#include &lt;stdio.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"><span class='directive'>#endif // STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_VERSION<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">   STBI_default = 0, <span class='comment'>// only used for desired_channels</span></td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">   STBI_grey       = 1,</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">   STBI_grey_alpha = 2,</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">   STBI_rgb        = 3,</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">   STBI_rgb_alpha  = 4</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> stbi_uc;</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> stbi_us;</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"><span class='keyword'>extern</span> <span class='string_literal'>"C"</span> {</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line"><span class='directive'>#ifdef STB_IMAGE_STATIC</span></td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line"><span class='directive'>#define <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> static</span></td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line"><span class='directive'>#define <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> extern</span></td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line"><span class='comment'>//////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"><span class='comment'>// PRIMARY API - works on images of any type</span></td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line"><span class='comment'>// load image by filename, open file, or memory buffer</span></td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">   <span class='keyword'>int</span>      (*read)  (<span class='keyword'>void</span> *user,<span class='keyword'>char</span> *data,<span class='keyword'>int</span> size);   <span class='comment'>// fill 'data' with 'size' bytes.  return number of bytes actually read</span></td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">   <span class='keyword'>void</span>     (*skip)  (<span class='keyword'>void</span> *user,<span class='keyword'>int</span> n);                 <span class='comment'>// skip the next 'n' bytes, or 'unget' the last -n bytes if negative</span></td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">   <span class='keyword'>int</span>      (*eof)   (<span class='keyword'>void</span> *user);                       <span class='comment'>// returns nonzero if we are at end of file/data</span></td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">} stbi_io_callbacks;</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line"><span class='comment'>////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line"><span class='comment'>// 8-bits-per-channel interface</span></td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_from_memory   (stbi_uc           <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len   , <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk  , <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line"><span class='directive'>#ifndef STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_gif_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> **delays, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *z, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp);</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load            (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_from_file  (FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line"><span class='comment'>// for stbi_load_from_file, file pointer is left pointing immediately after image</span></td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"><span class='comment'>////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"><span class='comment'>// 16-bits-per-channel interface</span></td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_16_from_memory   (stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_16_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_16          (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_from_file_16(FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line"><span class='comment'>////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line"><span class='comment'>// float-per-channel interface</span></td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line"><span class='directive'>#ifndef STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf_from_memory     (stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf_from_callbacks  (stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y,  <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">   <span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf            (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf_from_file  (FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels);</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line"><span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_hdr_to_ldr_gamma(<span class='keyword'>float</span> gamma);</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_hdr_to_ldr_scale(<span class='keyword'>float</span> scale);</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line"><span class='directive'>#endif // STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line"><span class='directive'>#ifndef STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_ldr_to_hdr_gamma(<span class='keyword'>float</span> gamma);</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">   <span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_ldr_to_hdr_scale(<span class='keyword'>float</span> scale);</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line"><span class='directive'>#endif // STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line"><span class='comment'>// stbi_is_hdr is always defined, but always returns false if STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>    stbi_is_hdr_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user);</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>    stbi_is_hdr_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len);</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_hdr          (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename);</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_hdr_from_file(FILE *f);</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line"><span class='directive'>#endif // STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line"><span class='comment'>// get a VERY brief reason for failure</span></td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line"><span class='comment'>// NOT THREADSAFE</span></td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>const</span> <span class='keyword'>char</span> *stbi_failure_reason  (<span class='keyword'>void</span>);</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line"><span class='comment'>// free the loaded image -- this is just free()</span></td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>     stbi_image_free      (<span class='keyword'>void</span> *retval_from_stbi_load);</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line"><span class='comment'>// get image dimensions &amp; components without fully decoding</span></td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_info_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_info_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_16_bit_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len);</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_16_bit_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user);</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_info               (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename,     <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_info_from_file     (FILE *f,                  <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_16_bit          (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename);</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_16_bit_from_file(FILE *f);</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line"><span class='comment'>// for image formats that explicitly notate that they have premultiplied alpha,</span></td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line"><span class='comment'>// we just return the colors as stored in the file. set this flag to force</span></td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line"><span class='comment'>// unpremultiplication. results are undefined if the unpremultiply overflow.</span></td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_set_unpremultiply_on_load(<span class='keyword'>int</span> flag_true_if_should_unpremultiply);</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line"><span class='comment'>// indicate whether we should process iphone images back to canonical format,</span></td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line"><span class='comment'>// or just pass them through "as-is"</span></td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_convert_iphone_png_to_rgb(<span class='keyword'>int</span> flag_true_if_should_convert);</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line"><span class='comment'>// flip the image vertically, so the first pixel in the output array is the bottom left</span></td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_set_flip_vertically_on_load(<span class='keyword'>int</span> flag_true_if_should_flip);</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line"><span class='comment'>// ZLIB client - used by PNG, available for other purposes</span></td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_malloc_guesssize(<span class='keyword'>const</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> initial_size, <span class='keyword'>int</span> *outlen);</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_malloc_guesssize_headerflag(<span class='keyword'>const</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> initial_size, <span class='keyword'>int</span> *outlen, <span class='keyword'>int</span> parse_header);</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_malloc(<span class='keyword'>const</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *outlen);</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>   stbi_zlib_decode_buffer(<span class='keyword'>char</span> *obuffer, <span class='keyword'>int</span> olen, <span class='keyword'>const</span> <span class='keyword'>char</span> *ibuffer, <span class='keyword'>int</span> ilen);</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_noheader_malloc(<span class='keyword'>const</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *outlen);</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>   stbi_zlib_decode_noheader_buffer(<span class='keyword'>char</span> *obuffer, <span class='keyword'>int</span> olen, <span class='keyword'>const</span> <span class='keyword'>char</span> *ibuffer, <span class='keyword'>int</span> ilen);</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line"><span class='comment'>////   end header file   /////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line"><span class='directive'>#endif // STBI_INCLUDE_STB_IMAGE_H</span></td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line"><span class='directive'>#ifdef STB_IMAGE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line"><span class='directive'>#if defined(STBI_ONLY_JPEG) || defined(STBI_ONLY_PNG) || defined(STBI_ONLY_BMP) \</span></td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">  <span class='directive'>|| defined(STBI_ONLY_TGA) || defined(STBI_ONLY_GIF) || defined(STBI_ONLY_PSD) \</span></td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">  <span class='directive'>|| defined(STBI_ONLY_HDR) || defined(STBI_ONLY_PIC) || defined(STBI_ONLY_PNM) \</span></td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">  <span class='directive'>|| defined(STBI_ONLY_ZLIB)</span></td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">   <span class='directive'>#define STBI_NO_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_PNG</span></td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">   <span class='directive'>#define STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_BMP</span></td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">   <span class='directive'>#define STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_PSD</span></td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">   <span class='directive'>#define STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_TGA</span></td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">   <span class='directive'>#define STBI_NO_TGA</span></td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_GIF</span></td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">   <span class='directive'>#define STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_HDR</span></td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">   <span class='directive'>#define STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_PIC</span></td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">   <span class='directive'>#define STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">   <span class='directive'>#ifndef STBI_ONLY_PNM</span></td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">   <span class='directive'>#define STBI_NO_PNM</span></td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line"><span class='directive'>#if defined(STBI_NO_PNG) &amp;&amp; !defined(STBI_SUPPORT_ZLIB) &amp;&amp; !defined(STBI_NO_ZLIB)</span></td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line"><span class='directive'>#define STBI_NO_ZLIB</span></td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line"><span class='directive'>#include &lt;stdarg.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line"><span class='directive'>#include &lt;stddef.h&gt; // ptrdiff_t on osx</span></td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line"><span class='directive'>#include &lt;stdlib.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line"><span class='directive'>#include &lt;string.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line"><span class='directive'>#include &lt;limits.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line"><span class='directive'>#if !defined(STBI_NO_LINEAR) || !defined(STBI_NO_HDR)</span></td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line"><span class='directive'>#include &lt;math.h&gt;  // ldexp, pow</span></td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line"><span class='directive'>#include &lt;stdio.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line"><span class='directive'>#ifndef STBI_ASSERT</span></td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line"><span class='directive'>#include &lt;assert.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_ASSERT(x)<span class='macro_popup'>((void) sizeof ((x) ? 1 : 0), __extension__ ({ if (x) ; else __assert_fail<br> ("x", "src/stb_image.h", 525, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span> <span class='macro'>assert(x)<span class='macro_popup'>((void) sizeof ((x) ? 1 : 0), __extension__ ({ if (x) ; else __assert_fail<br> ("x", "src/stb_image.h", 525, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line"><span class='directive'>#ifndef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">   <span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">   <span class='directive'>#define stbi_inline inline</span></td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">   <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">   <span class='directive'>#define stbi_inline</span></td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">   <span class='directive'>#define stbi_inline __forceinline</span></td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> stbi__uint16;</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line"><span class='keyword'>typedef</span>   <span class='keyword'>signed</span> <span class='keyword'>short</span> stbi__int16;</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span>   stbi__uint32;</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line"><span class='keyword'>typedef</span>   <span class='keyword'>signed</span> <span class='keyword'>int</span>   stbi__int32;</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line"><span class='directive'>#include &lt;stdint.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line"><span class='keyword'>typedef</span> uint16_t stbi__uint16;</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line"><span class='keyword'>typedef</span> int16_t  stbi__int16;</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line"><span class='keyword'>typedef</span> uint32_t stbi__uint32;</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line"><span class='keyword'>typedef</span> int32_t  stbi__int32;</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line"><span class='comment'>// should produce compiler error if size is wrong</span></td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> validate_uint32[<span class='keyword'>sizeof</span>(stbi__uint32)==4 ? 1 : -1];</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_NOTUSED(v)<span class='macro_popup'>(void)sizeof(v)</span></span>  (void)(v)</span></td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_NOTUSED(v)<span class='macro_popup'>(void)sizeof(v)</span></span>  (void)sizeof(v)</span></td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line"><span class='directive'>#define STBI_HAS_LROTL</span></td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line"><span class='directive'>#ifdef STBI_HAS_LROTL</span></td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">   <span class='directive'>#define <span class='macro'>stbi_lrot(x,y)<span class='macro_popup'>(((x) &lt;&lt; (y)) | ((x) &gt;&gt; (32 - (y))))</span></span>  _lrotl(x,y)</span></td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">   <span class='directive'>#define <span class='macro'>stbi_lrot(x,y)<span class='macro_popup'>(((x) &lt;&lt; (y)) | ((x) &gt;&gt; (32 - (y))))</span></span>  (((x) &lt;&lt; (y)) | ((x) &gt;&gt; (32 - (y))))</span></td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line"><span class='directive'>#if defined(STBI_MALLOC) &amp;&amp; defined(STBI_FREE) &amp;&amp; (defined(STBI_REALLOC) || defined(STBI_REALLOC_SIZED))</span></td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line"><span class='comment'>// ok</span></td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line"><span class='directive'>#elif !defined(STBI_MALLOC) &amp;&amp; !defined(STBI_FREE) &amp;&amp; !defined(STBI_REALLOC) &amp;&amp; !defined(STBI_REALLOC_SIZED)</span></td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line"><span class='comment'>// ok</span></td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line"><span class='directive'>#error "Must define all or none of STBI_MALLOC, STBI_FREE, and STBI_REALLOC (or STBI_REALLOC_SIZED)."</span></td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line"><span class='directive'>#ifndef STBI_MALLOC</span></td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_MALLOC(sz)<span class='macro_popup'>malloc(sz)</span></span>           malloc(sz)</span></td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_REALLOC(p,newsz)<span class='macro_popup'>realloc(p,newsz)</span></span>     realloc(p,newsz)</span></td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_FREE(p)<span class='macro_popup'>free(p)</span></span>              free(p)</span></td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line"><span class='directive'>#ifndef STBI_REALLOC_SIZED</span></td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_REALLOC_SIZED(p,oldsz,newsz)<span class='macro_popup'>realloc(p,newsz)</span></span> <span class='macro'>STBI_REALLOC(p,newsz)<span class='macro_popup'>realloc(p,newsz)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line"><span class='comment'>// x86/x64 detection</span></td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line"><span class='directive'>#if defined(<span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>) || defined(_M_X64)</span></td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line"><span class='directive'>#define STBI__X64_TARGET</span></td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line"><span class='directive'>#elif defined(__i386) || defined(_M_IX86)</span></td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"><span class='directive'>#define STBI__X86_TARGET</span></td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line"><span class='directive'>#if defined(<span class='macro'>__GNUC__<span class='macro_popup'>4</span></span>) &amp;&amp; defined(STBI__X86_TARGET) &amp;&amp; !defined(<span class='macro'>__SSE2__<span class='macro_popup'>1</span></span>) &amp;&amp; !defined(STBI_NO_SIMD)</span></td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line"><span class='comment'>// gcc doesn't support sse2 intrinsics unless you compile with -msse2,</span></td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line"><span class='comment'>// which in turn means it gets to use SSE2 everywhere. This is unfortunate,</span></td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line"><span class='comment'>// but previous attempts to provide the SSE2 functions with runtime</span></td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line"><span class='comment'>// detection caused numerous issues. The way architecture extensions are</span></td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line"><span class='comment'>// exposed in GCC/Clang is, sadly, not really suited for one-file libs.</span></td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line"><span class='comment'>// New behavior: if compiled with -msse2, we use SSE2 without any</span></td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line"><span class='comment'>// detection; if not, we don't use it at all.</span></td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line"><span class='directive'>#define STBI_NO_SIMD</span></td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line"><span class='directive'>#if defined(__MINGW32__) &amp;&amp; defined(STBI__X86_TARGET) &amp;&amp; !defined(STBI_MINGW_ENABLE_SSE2) &amp;&amp; !defined(STBI_NO_SIMD)</span></td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line"><span class='comment'>// Note that __MINGW32__ doesn't actually mean 32-bit, so we have to avoid STBI__X64_TARGET</span></td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line"><span class='comment'>// 32-bit MinGW wants ESP to be 16-byte aligned, but this is not in the</span></td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line"><span class='comment'>// Windows ABI and VC++ as well as Windows DLLs don't maintain that invariant.</span></td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line"><span class='comment'>// As a result, enabling SSE2 on 32-bit MinGW is dangerous when not</span></td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line"><span class='comment'>// simultaneously enabling "-mstackrealign".</span></td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line"><span class='comment'>// See https://github.com/nothings/stb/issues/81 for more information.</span></td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line"><span class='comment'>// So default to no SSE2 on 32-bit MinGW. If you've read this far and added</span></td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line"><span class='comment'>// -mstackrealign to your build settings, feel free to #define STBI_MINGW_ENABLE_SSE2.</span></td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line"><span class='directive'>#define STBI_NO_SIMD</span></td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line"><span class='directive'>#if !defined(STBI_NO_SIMD) &amp;&amp; (defined(STBI__X86_TARGET) || defined(STBI__X64_TARGET))</span></td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line"><span class='directive'>#define STBI_SSE2</span></td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line"><span class='directive'>#include &lt;emmintrin.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line"><span class='directive'>#if _MSC_VER &gt;= 1400  // not VC6</span></td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line"><span class='directive'>#include &lt;intrin.h&gt; // __cpuid</span></td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__cpuid3(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">   <span class='keyword'>int</span> info[4];</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">   __cpuid(info,1);</td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">   <span class='keyword'>return</span> info[3];</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__cpuid3(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">   <span class='keyword'>int</span> res;</td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">   <span class='keyword'>__asm</span> {</td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">      mov  eax,1</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">      cpuid</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">      mov  res,edx</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">   <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_SIMD_ALIGN(type, name)<span class='macro_popup'>type name __attribute__((aligned(16)))</span></span> __declspec(align(16)) type name</span></td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__sse2_available(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">   <span class='keyword'>int</span> info3 = stbi__cpuid3();</td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">   <span class='keyword'>return</span> ((info3 &gt;&gt; 26) &amp; 1) != 0;</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line"><span class='directive'>#else // assume GCC-style if not VC++</span></td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_SIMD_ALIGN(type, name)<span class='macro_popup'>type name __attribute__((aligned(16)))</span></span> type name __attribute__((aligned(16)))</span></td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__sse2_available(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">   <span class='comment'>// If we're even attempting to compile this on GCC/Clang, that means</span></td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">   <span class='comment'>// -msse2 is on, which means the compiler is allowed to use SSE2</span></td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">   <span class='comment'>// instructions at will, and so are we.</span></td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line"><span class='comment'>// ARM NEON</span></td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line"><span class='directive'>#if defined(STBI_NO_SIMD) &amp;&amp; defined(STBI_NEON)</span></td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line"><span class='directive'>#undef STBI_NEON</span></td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line"><span class='directive'>#ifdef STBI_NEON</span></td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line"><span class='directive'>#include &lt;arm_neon.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line"><span class='comment'>// assume GCC or Clang on ARM targets</span></td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_SIMD_ALIGN(type, name)<span class='macro_popup'>type name __attribute__((aligned(16)))</span></span> type name __attribute__((aligned(16)))</span></td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line"><span class='directive'>#ifndef STBI_SIMD_ALIGN</span></td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line"><span class='directive'>#define <span class='macro'>STBI_SIMD_ALIGN(type, name)<span class='macro_popup'>type name __attribute__((aligned(16)))</span></span> type name</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line"><span class='comment'>///////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line"><span class='comment'>//  stbi__context struct and start_xxx functions</span></td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line"><span class='comment'>// stbi__context structure is our basic context used by all images, so it</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line"><span class='comment'>// contains all the IO context, plus some basic image information</span></td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">   stbi__uint32 img_x, img_y;</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">   <span class='keyword'>int</span> img_n, img_out_n;</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">   stbi_io_callbacks io;</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">   <span class='keyword'>void</span> *io_user_data;</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">   <span class='keyword'>int</span> read_from_callbacks;</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">   <span class='keyword'>int</span> buflen;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line">   stbi_uc buffer_start[128];</td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line">   stbi_uc *img_buffer, *img_buffer_end;</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">   stbi_uc *img_buffer_original, *img_buffer_original_end;</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">} stbi__context;</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__refill_buffer(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line"><span class='comment'>// initialize a memory-decode context</span></td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__start_mem(stbi__context *s, stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len)</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">   s-&gt;io.read = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">   s-&gt;read_from_callbacks = 0;</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">   s-&gt;img_buffer = s-&gt;img_buffer_original = (stbi_uc *) buffer;</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">   s-&gt;img_buffer_end = s-&gt;img_buffer_original_end = (stbi_uc *) buffer+len;</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line"><span class='comment'>// initialize a callback-based context</span></td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__start_callbacks(stbi__context *s, stbi_io_callbacks *c, <span class='keyword'>void</span> *user)</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">   s-&gt;io = *c;</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">   s-&gt;io_user_data = user;</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">   s-&gt;buflen = <span class='keyword'>sizeof</span>(s-&gt;buffer_start);</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">   s-&gt;read_from_callbacks = 1;</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">   s-&gt;img_buffer_original = s-&gt;buffer_start;</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">   stbi__refill_buffer(s);</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">   s-&gt;img_buffer_original_end = s-&gt;img_buffer_end;</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__stdio_read(<span class='keyword'>void</span> *user, <span class='keyword'>char</span> *data, <span class='keyword'>int</span> size)</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">   <span class='keyword'>return</span> (<span class='keyword'>int</span>) fread(data,1,size,(FILE*) user);</td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__stdio_skip(<span class='keyword'>void</span> *user, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">   fseek((FILE*) user, n, <span class='macro'>SEEK_CUR<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__stdio_eof(<span class='keyword'>void</span> *user)</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">   <span class='keyword'>return</span> feof((FILE*) user);</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line"><span class='keyword'>static</span> stbi_io_callbacks stbi__stdio_callbacks =</td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">   stbi__stdio_read,</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">   stbi__stdio_skip,</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">   stbi__stdio_eof,</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__start_file(stbi__context *s, FILE *f)</td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">   stbi__start_callbacks(s, &amp;stbi__stdio_callbacks, (<span class='keyword'>void</span> *) f);</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line"><span class='comment'>//static void stop_file(stbi__context *s) { }</span></td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line"><span class='directive'>#endif // !STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__rewind(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">   <span class='comment'>// conceptually rewind SHOULD rewind to the beginning of the stream,</span></td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">   <span class='comment'>// but we just rewind to the beginning of the initial buffer, because</span></td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">   <span class='comment'>// we only use it after doing 'test', which only ever looks at at most 92 bytes</span></td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">   s-&gt;img_buffer = s-&gt;img_buffer_original;</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">   s-&gt;img_buffer_end = s-&gt;img_buffer_original_end;</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">   STBI_ORDER_RGB,</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">   STBI_ORDER_BGR</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">   <span class='keyword'>int</span> bits_per_channel;</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">   <span class='keyword'>int</span> num_channels;</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">   <span class='keyword'>int</span> channel_order;</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">} stbi__result_info;</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line"><span class='directive'>#ifndef STBI_NO_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__jpeg_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__jpeg_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__jpeg_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line"><span class='directive'>#ifndef STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__png_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__png_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__png_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__png_is16(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line"><span class='directive'>#ifndef STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__bmp_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__bmp_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__bmp_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line"><span class='directive'>#ifndef STBI_NO_TGA</span></td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__tga_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__tga_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__tga_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line"><span class='directive'>#ifndef STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__psd_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__psd_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri, <span class='keyword'>int</span> bpc);</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__psd_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__psd_is16(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line"><span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__hdr_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span>   *stbi__hdr_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__hdr_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line"><span class='directive'>#ifndef STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pic_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__pic_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pic_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line"><span class='directive'>#ifndef STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__gif_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__gif_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__load_gif_main(stbi__context *s, <span class='keyword'>int</span> **delays, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *z, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp);</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__gif_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line"><span class='directive'>#ifndef STBI_NO_PNM</span></td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_test(stbi__context *s);</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>    *stbi__pnm_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri);</td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp);</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line"><span class='comment'>// this is not threadsafe</span></td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *stbi__g_failure_reason;</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>const</span> <span class='keyword'>char</span> *stbi_failure_reason(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">   <span class='keyword'>return</span> stbi__g_failure_reason;</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__err(<span class='keyword'>const</span> <span class='keyword'>char</span> *str)</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">   stbi__g_failure_reason = str;</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__malloc(size_t size)</td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>STBI_MALLOC(size)<span class='macro_popup'>malloc(size)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line"><span class='comment'>// stb_image uses ints pervasively, including for offset calculations.</span></td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line"><span class='comment'>// therefore the largest decoded image size we can support with the</span></td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line"><span class='comment'>// current code, even on 64-bit targets, is INT_MAX. this is not a</span></td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line"><span class='comment'>// significant limitation for the intended use case.</span></td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line"><span class='comment'>// we do, however, need to make sure our size calculations don't</span></td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line"><span class='comment'>// overflow. hence a few helper functions for size calculations that</span></td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line"><span class='comment'>// multiply integers together, making sure that they're non-negative</span></td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line"><span class='comment'>// and no overflow occurs.</span></td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line"><span class='comment'>// return 1 if the sum is valid, 0 on overflow.</span></td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line"><span class='comment'>// negative terms are considered invalid.</span></td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__addsizes_valid(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b)</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">   <span class='keyword'>if</span> (b &lt; 0) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">   <span class='comment'>// now 0 &lt;= b &lt;= INT_MAX, hence also</span></td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line">   <span class='comment'>// 0 &lt;= INT_MAX - b &lt;= INTMAX.</span></td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">   <span class='comment'>// And "a + b &lt;= INT_MAX" (which might overflow) is the</span></td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">   <span class='comment'>// same as a &lt;= INT_MAX - b (no overflow)</span></td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">   <span class='keyword'>return</span> a &lt;= <span class='macro'>INT_MAX<span class='macro_popup'>2147483647</span></span> - b;</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line"><span class='comment'>// returns 1 if the product is valid, 0 on overflow.</span></td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line"><span class='comment'>// negative factors are considered invalid.</span></td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__mul2sizes_valid(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b)</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">   <span class='keyword'>if</span> (a &lt; 0 || b &lt; 0) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">   <span class='keyword'>if</span> (b == 0) <span class='keyword'>return</span> 1; <span class='comment'>// mul-by-0 is always safe</span></td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">   <span class='comment'>// portable way to check for no overflows in a*b</span></td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">   <span class='keyword'>return</span> a &lt;= <span class='macro'>INT_MAX<span class='macro_popup'>2147483647</span></span>/b;</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line"><span class='comment'>// returns 1 if "a*b + add" has no negative terms/factors and doesn't overflow</span></td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__mad2sizes_valid(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> add)</td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">   <span class='keyword'>return</span> stbi__mul2sizes_valid(a, b) &amp;&amp; stbi__addsizes_valid(a*b, add);</td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line"><span class='comment'>// returns 1 if "a*b*c + add" has no negative terms/factors and doesn't overflow</span></td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__mad3sizes_valid(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> c, <span class='keyword'>int</span> add)</td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">   <span class='keyword'>return</span> stbi__mul2sizes_valid(a, b) &amp;&amp; stbi__mul2sizes_valid(a*b, c) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">      stbi__addsizes_valid(a*b*c, add);</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line"><span class='comment'>// returns 1 if "a*b*c*d + add" has no negative terms/factors and doesn't overflow</span></td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line"><span class='directive'>#if !defined(STBI_NO_LINEAR) || !defined(STBI_NO_HDR)</span></td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__mad4sizes_valid(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> c, <span class='keyword'>int</span> d, <span class='keyword'>int</span> add)</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">   <span class='keyword'>return</span> stbi__mul2sizes_valid(a, b) &amp;&amp; stbi__mul2sizes_valid(a*b, c) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">      stbi__mul2sizes_valid(a*b*c, d) &amp;&amp; stbi__addsizes_valid(a*b*c*d, add);</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line"><span class='comment'>// mallocs with size overflow checking</span></td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__malloc_mad2(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> add)</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad2sizes_valid(a, b, add)) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">   <span class='keyword'>return</span> stbi__malloc(a*b + add);</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__malloc_mad3(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> c, <span class='keyword'>int</span> add)</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(a, b, c, add)) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">   <span class='keyword'>return</span> stbi__malloc(a*b*c + add);</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line"><span class='directive'>#if !defined(STBI_NO_LINEAR) || !defined(STBI_NO_HDR)</span></td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__malloc_mad4(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> c, <span class='keyword'>int</span> d, <span class='keyword'>int</span> add)</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad4sizes_valid(a, b, c, d, add)) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">   <span class='keyword'>return</span> stbi__malloc(a*b*c*d + add);</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line"><span class='comment'>// stbi__err - error</span></td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line"><span class='comment'>// stbi__errpf - error returning pointer to float</span></td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line"><span class='comment'>// stbi__errpuc - error returning pointer to unsigned char</span></td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line"><span class='directive'>#ifdef STBI_NO_FAILURE_STRINGS</span></td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">   <span class='directive'>#define <span class='macro'>stbi__err(x,y)<span class='macro_popup'>stbi__err(x)</span></span>  0</span></td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line"><span class='directive'>#elif defined(STBI_FAILURE_USERMSG)</span></td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">   <span class='directive'>#define <span class='macro'>stbi__err(x,y)<span class='macro_popup'>stbi__err(x)</span></span>  stbi__err(y)</span></td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">   <span class='directive'>#define <span class='macro'>stbi__err(x,y)<span class='macro_popup'>stbi__err(x)</span></span>  stbi__err(x)</span></td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__errpf(x,y)<span class='macro_popup'>((float *)(size_t) (stbi__err(x)?((void*)0):((void*)0)))</span></span>   ((float *)(size_t) (<span class='macro'>stbi__err(x,y)<span class='macro_popup'>stbi__err(x)</span></span>?<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>:<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</span></td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__errpuc(x,y)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err(x)?((void*)0):((void*)0<br>)))</span></span>  ((unsigned char *)(size_t) (<span class='macro'>stbi__err(x,y)<span class='macro_popup'>stbi__err(x)</span></span>?<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>:<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</span></td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_image_free(<span class='keyword'>void</span> *retval_from_stbi_load)</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">   <span class='macro'>STBI_FREE(retval_from_stbi_load)<span class='macro_popup'>free(retval_from_stbi_load)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line"><span class='directive'>#ifndef STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span>   *stbi__ldr_to_hdr(stbi_uc *data, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp);</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line"><span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__hdr_to_ldr(<span class='keyword'>float</span>   *data, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp);</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__vertically_flip_on_load = 0;</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_set_flip_vertically_on_load(<span class='keyword'>int</span> flag_true_if_should_flip)</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">    stbi__vertically_flip_on_load = flag_true_if_should_flip;</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__load_main(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri, <span class='keyword'>int</span> bpc)</td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">   memset(ri, 0, <span class='keyword'>sizeof</span>(*ri)); <span class='comment'>// make sure it's initialized if we add new fields</span></td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">   ri-&gt;bits_per_channel = 8; <span class='comment'>// default is 8 so most paths don't have to be changed</span></td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">   ri-&gt;channel_order = STBI_ORDER_RGB; <span class='comment'>// all current input &amp; output are this, but this is here so we can add BGR order</span></td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">   ri-&gt;num_channels = 0;</td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">   <span class='directive'>#ifndef STBI_NO_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">   <span class='keyword'>if</span> (stbi__jpeg_test(s)) <span class='keyword'>return</span> stbi__jpeg_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">   <span class='keyword'>if</span> (stbi__png_test(s))  <span class='keyword'>return</span> stbi__png_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">   <span class='directive'>#ifndef STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">   <span class='keyword'>if</span> (stbi__bmp_test(s))  <span class='keyword'>return</span> stbi__bmp_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">   <span class='directive'>#ifndef STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">   <span class='keyword'>if</span> (stbi__gif_test(s))  <span class='keyword'>return</span> stbi__gif_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">   <span class='keyword'>if</span> (stbi__psd_test(s))  <span class='keyword'>return</span> stbi__psd_load(s,x,y,comp,req_comp, ri, bpc);</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">   <span class='keyword'>if</span> (stbi__pic_test(s))  <span class='keyword'>return</span> stbi__pic_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PNM</span></td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">   <span class='keyword'>if</span> (stbi__pnm_test(s))  <span class='keyword'>return</span> stbi__pnm_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">   <span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">   <span class='keyword'>if</span> (stbi__hdr_test(s)) {</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">      <span class='keyword'>float</span> *hdr = stbi__hdr_load(s, x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">      <span class='keyword'>return</span> stbi__hdr_to_ldr(hdr, *x, *y, req_comp ? req_comp : *comp);</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">   <span class='directive'>#ifndef STBI_NO_TGA</span></td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">   <span class='comment'>// test tga last because it's a crappy test!</span></td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">   <span class='keyword'>if</span> (stbi__tga_test(s))</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">      <span class='keyword'>return</span> stbi__tga_load(s,x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">   <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"unknown image type"</span>, <span class='string_literal'>"Image not of any known type, or corrupt"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("unknown image type")?(<br>(void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__convert_16_to_8(stbi__uint16 *orig, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> channels)</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">   <span class='keyword'>int</span> img_len = w * h * channels;</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">   stbi_uc *reduced;</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">   reduced = (stbi_uc *) stbi__malloc(img_len);</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">   <span class='keyword'>if</span> (reduced == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">   <span class='keyword'>for</span> (i = 0; i &lt; img_len; ++i)</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">      reduced[i] = (stbi_uc)((orig[i] &gt;&gt; 8) &amp; 0xFF); <span class='comment'>// top half of each byte is sufficient approx of 16-&gt;8 bit scaling</span></td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">   <span class='macro'>STBI_FREE(orig)<span class='macro_popup'>free(orig)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">   <span class='keyword'>return</span> reduced;</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line"><span class='keyword'>static</span> stbi__uint16 *stbi__convert_8_to_16(stbi_uc *orig, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> channels)</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">   <span class='keyword'>int</span> img_len = w * h * channels;</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">   stbi__uint16 *enlarged;</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">   enlarged = (stbi__uint16 *) stbi__malloc(img_len*2);</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">   <span class='keyword'>if</span> (enlarged == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> (stbi__uint16 *) <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">   <span class='keyword'>for</span> (i = 0; i &lt; img_len; ++i)</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">      enlarged[i] = (stbi__uint16)((orig[i] &lt;&lt; 8) + orig[i]); <span class='comment'>// replicate to high and low byte, maps 0-&gt;0, 255-&gt;0xffff</span></td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">   <span class='macro'>STBI_FREE(orig)<span class='macro_popup'>free(orig)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">   <span class='keyword'>return</span> enlarged;</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__vertical_flip(<span class='keyword'>void</span> *image, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> bytes_per_pixel)</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">   <span class='keyword'>int</span> row;</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">   size_t bytes_per_row = (size_t)w * bytes_per_pixel;</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">   stbi_uc temp[2048];</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">   stbi_uc *bytes = (stbi_uc *)image;</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">   <span class='keyword'>for</span> (row = 0; row &lt; (h&gt;&gt;1); row++) {</td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">      stbi_uc *row0 = bytes + row*bytes_per_row;</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">      stbi_uc *row1 = bytes + (h - row - 1)*bytes_per_row;</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">      <span class='comment'>// swap row0 with row1</span></td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">      size_t bytes_left = bytes_per_row;</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">      <span class='keyword'>while</span> (bytes_left) {</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">         size_t bytes_copy = (bytes_left &lt; <span class='keyword'>sizeof</span>(temp)) ? bytes_left : <span class='keyword'>sizeof</span>(temp);</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">         memcpy(temp, row0, bytes_copy);</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">         memcpy(row0, row1, bytes_copy);</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">         memcpy(row1, temp, bytes_copy);</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">         row0 += bytes_copy;</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">         row1 += bytes_copy;</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">         bytes_left -= bytes_copy;</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__vertical_flip_slices(<span class='keyword'>void</span> *image, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> z, <span class='keyword'>int</span> bytes_per_pixel)</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">   <span class='keyword'>int</span> slice;</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">   <span class='keyword'>int</span> slice_size = w * h * bytes_per_pixel;</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">   stbi_uc *bytes = (stbi_uc *)image;</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">   <span class='keyword'>for</span> (slice = 0; slice &lt; z; ++slice) {</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">      stbi__vertical_flip(bytes, w, h, bytes_per_pixel); </td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">      bytes += slice_size; </td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *stbi__load_and_postprocess_8bit(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">   stbi__result_info ri;</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">   <span class='keyword'>void</span> *result = stbi__load_main(s, x, y, comp, req_comp, &amp;ri, 8);</td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">   <span class='keyword'>if</span> (result == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">   <span class='keyword'>if</span> (ri.bits_per_channel != 8) {</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">      <span class='macro'>STBI_ASSERT(ri.bits_per_channel == 16)<span class='macro_popup'>((void) sizeof ((ri.bits_per_channel == 16) ? 1 : 0), __extension__<br> ({ if (ri.bits_per_channel == 16) ; else __assert_fail ("ri.bits_per_channel == 16"<br>, "src/stb_image.h", 1094, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">      result = stbi__convert_16_to_8((stbi__uint16 *) result, *x, *y, req_comp == 0 ? *comp : req_comp);</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">      ri.bits_per_channel = 8;</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">   <span class='comment'>// @TODO: move stbi__convert_format to here</span></td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">   <span class='keyword'>if</span> (stbi__vertically_flip_on_load) {</td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">      <span class='keyword'>int</span> channels = req_comp ? req_comp : *comp;</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">      stbi__vertical_flip(result, *x, *y, channels * <span class='keyword'>sizeof</span>(stbi_uc));</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">   <span class='keyword'>return</span> (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) result;</td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line"><span class='keyword'>static</span> stbi__uint16 *stbi__load_and_postprocess_16bit(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">   stbi__result_info ri;</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">   <span class='keyword'>void</span> *result = stbi__load_main(s, x, y, comp, req_comp, &amp;ri, 16);</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line">   <span class='keyword'>if</span> (result == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">   <span class='keyword'>if</span> (ri.bits_per_channel != 16) {</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">      <span class='macro'>STBI_ASSERT(ri.bits_per_channel == 8)<span class='macro_popup'>((void) sizeof ((ri.bits_per_channel == 8) ? 1 : 0), __extension__<br> ({ if (ri.bits_per_channel == 8) ; else __assert_fail ("ri.bits_per_channel == 8"<br>, "src/stb_image.h", 1118, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">      result = stbi__convert_8_to_16((stbi_uc *) result, *x, *y, req_comp == 0 ? *comp : req_comp);</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">      ri.bits_per_channel = 16;</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">   <span class='comment'>// @TODO: move stbi__convert_format16 to here</span></td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">   <span class='comment'>// @TODO: special case RGB-to-Y (and RGBA-to-YA) for 8-bit-to-16-bit case to keep more precision</span></td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">   <span class='keyword'>if</span> (stbi__vertically_flip_on_load) {</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">      <span class='keyword'>int</span> channels = req_comp ? req_comp : *comp;</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">      stbi__vertical_flip(result, *x, *y, channels * <span class='keyword'>sizeof</span>(stbi__uint16));</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">   <span class='keyword'>return</span> (stbi__uint16 *) result;</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line"><span class='directive'>#if !defined(STBI_NO_HDR) || !defined(STBI_NO_LINEAR)</span></td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__float_postprocess(<span class='keyword'>float</span> *result, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line">   <span class='keyword'>if</span> (stbi__vertically_flip_on_load &amp;&amp; result != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">      <span class='keyword'>int</span> channels = req_comp ? req_comp : *comp;</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">      stbi__vertical_flip(result, *x, *y, channels * <span class='keyword'>sizeof</span>(<span class='keyword'>float</span>));</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line"><span class='keyword'>static</span> FILE *stbi__fopen(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>char</span> <span class='keyword'>const</span> *mode)</td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">   FILE *f;</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line"><span class='directive'>#if defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1400</span></td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">   <span class='keyword'>if</span> (0 != fopen_s(&amp;f, filename, mode))</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">      f=0;</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">   f = fopen(filename, mode);</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">   <span class='keyword'>return</span> f;</td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">   FILE *f = stbi__fopen(filename, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *result;</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">   <span class='keyword'>if</span> (!f) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"can't fopen"</span>, <span class='string_literal'>"Unable to open file"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("can't fopen")?((void*)<br>0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">   result = stbi_load_from_file(f,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">   fclose(f);</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_from_file(FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *result;</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">   stbi__start_file(&amp;s,f);</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">   result = stbi__load_and_postprocess_8bit(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">   <span class='keyword'>if</span> (result) {</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">      <span class='comment'>// need to 'unget' all the characters in the IO buffer</span></td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">      fseek(f, - (<span class='keyword'>int</span>) (s.img_buffer_end - s.img_buffer), <span class='macro'>SEEK_CUR<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi__uint16 *stbi_load_from_file_16(FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">   stbi__uint16 *result;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">   stbi__start_file(&amp;s,f);</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">   result = stbi__load_and_postprocess_16bit(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">   <span class='keyword'>if</span> (result) {</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">      <span class='comment'>// need to 'unget' all the characters in the IO buffer</span></td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">      fseek(f, - (<span class='keyword'>int</span>) (s.img_buffer_end - s.img_buffer), <span class='macro'>SEEK_CUR<span class='macro_popup'>1</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_16(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">   FILE *f = stbi__fopen(filename, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">   stbi__uint16 *result;</td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">   <span class='keyword'>if</span> (!f) <span class='keyword'>return</span> (stbi_us *) <span class='macro'>stbi__errpuc(<span class='string_literal'>"can't fopen"</span>, <span class='string_literal'>"Unable to open file"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("can't fopen")?((void*)<br>0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">   result = stbi_load_from_file_16(f,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">   fclose(f);</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line"><span class='directive'>#endif //!STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_16_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels)</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">   stbi__start_mem(&amp;s,buffer,len);</td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">   <span class='keyword'>return</span> stbi__load_and_postprocess_16bit(&amp;s,x,y,channels_in_file,desired_channels);</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_us *stbi_load_16_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *channels_in_file, <span class='keyword'>int</span> desired_channels)</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">   stbi__start_callbacks(&amp;s, (stbi_io_callbacks *)clbk, user);</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">   <span class='keyword'>return</span> stbi__load_and_postprocess_16bit(&amp;s,x,y,channels_in_file,desired_channels);</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">   stbi__start_mem(&amp;s,buffer,len);</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">   <span class='keyword'>return</span> stbi__load_and_postprocess_8bit(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">   stbi__start_callbacks(&amp;s, (stbi_io_callbacks *) clbk, user);</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">   <span class='keyword'>return</span> stbi__load_and_postprocess_8bit(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line"><span class='directive'>#ifndef STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> stbi_uc *stbi_load_gif_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> **delays, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *z, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *result;</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">   stbi__context s; </td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">   stbi__start_mem(&amp;s,buffer,len); </td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">   </td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">   result = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>*) stbi__load_gif_main(&amp;s, delays, x, y, z, comp, req_comp);</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">   <span class='keyword'>if</span> (stbi__vertically_flip_on_load) {</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">      stbi__vertical_flip_slices( result, *x, *y, *z, *comp ); </td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">   <span class='keyword'>return</span> result; </td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line"><span class='directive'>#ifndef STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span> *stbi__loadf_main(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *data;</td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">   <span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">   <span class='keyword'>if</span> (stbi__hdr_test(s)) {</td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">      stbi__result_info ri;</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">      <span class='keyword'>float</span> *hdr_data = stbi__hdr_load(s,x,y,comp,req_comp, &amp;ri);</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">      <span class='keyword'>if</span> (hdr_data)</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">         stbi__float_postprocess(hdr_data,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">      <span class='keyword'>return</span> hdr_data;</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">   data = stbi__load_and_postprocess_8bit(s, x, y, comp, req_comp);</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">   <span class='keyword'>if</span> (data)</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">      <span class='keyword'>return</span> stbi__ldr_to_hdr(data, *x, *y, req_comp ? req_comp : *comp);</td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">   <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"unknown image type"</span>, <span class='string_literal'>"Image not of any known type, or corrupt"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("unknown image type")?((void*)0<br>):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">   stbi__start_mem(&amp;s,buffer,len);</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">   <span class='keyword'>return</span> stbi__loadf_main(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">   stbi__start_callbacks(&amp;s, (stbi_io_callbacks *) clbk, user);</td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">   <span class='keyword'>return</span> stbi__loadf_main(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">   <span class='keyword'>float</span> *result;</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">   FILE *f = stbi__fopen(filename, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">   <span class='keyword'>if</span> (!f) <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"can't fopen"</span>, <span class='string_literal'>"Unable to open file"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("can't fopen")?((void*)0):((void<br>*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">   result = stbi_loadf_from_file(f,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">   fclose(f);</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>float</span> *stbi_loadf_from_file(FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">   stbi__start_file(&amp;s,f);</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line">   <span class='keyword'>return</span> stbi__loadf_main(&amp;s,x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line"><span class='directive'>#endif // !STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line"><span class='directive'>#endif // !STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line"><span class='comment'>// these is-hdr-or-not is defined independent of whether STBI_NO_LINEAR is</span></td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line"><span class='comment'>// defined, for API simplicity; if STBI_NO_LINEAR is defined, it always</span></td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line"><span class='comment'>// reports false!</span></td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_is_hdr_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len)</td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">   <span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">   stbi__start_mem(&amp;s,buffer,len);</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">   <span class='keyword'>return</span> stbi__hdr_test(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">   <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line">   <span class='macro'>STBI_NOTUSED(buffer)<span class='macro_popup'>(void)sizeof(buffer)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">   <span class='macro'>STBI_NOTUSED(len)<span class='macro_popup'>(void)sizeof(len)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_hdr          (<span class='keyword'>char</span> <span class='keyword'>const</span> *filename)</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">   FILE *f = stbi__fopen(filename, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">   <span class='keyword'>int</span> result=0;</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">   <span class='keyword'>if</span> (f) {</td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">      result = stbi_is_hdr_from_file(f);</td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">      fclose(f);</td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_is_hdr_from_file(FILE *f)</td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">   <span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">   <span class='keyword'>long</span> pos = ftell(f);</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">   <span class='keyword'>int</span> res;</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">   stbi__start_file(&amp;s,f);</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">   res = stbi__hdr_test(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">   fseek(f, pos, <span class='macro'>SEEK_SET<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">   <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">   <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">   <span class='macro'>STBI_NOTUSED(f)<span class='macro_popup'>(void)sizeof(f)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line"><span class='directive'>#endif // !STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span>      stbi_is_hdr_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *clbk, <span class='keyword'>void</span> *user)</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">   <span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">   stbi__start_callbacks(&amp;s, (stbi_io_callbacks *) clbk, user);</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">   <span class='keyword'>return</span> stbi__hdr_test(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">   <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">   <span class='macro'>STBI_NOTUSED(clbk)<span class='macro_popup'>(void)sizeof(clbk)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">   <span class='macro'>STBI_NOTUSED(user)<span class='macro_popup'>(void)sizeof(user)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line">   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"><span class='directive'>#ifndef STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span> stbi__l2h_gamma=2.2f, stbi__l2h_scale=1.0f;</td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_ldr_to_hdr_gamma(<span class='keyword'>float</span> gamma) { stbi__l2h_gamma = gamma; }</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_ldr_to_hdr_scale(<span class='keyword'>float</span> scale) { stbi__l2h_scale = scale; }</td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span> stbi__h2l_gamma_i=1.0f/2.2f, stbi__h2l_scale_i=1.0f;</td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_hdr_to_ldr_gamma(<span class='keyword'>float</span> gamma) { stbi__h2l_gamma_i = 1/gamma; }</td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span>   stbi_hdr_to_ldr_scale(<span class='keyword'>float</span> scale) { stbi__h2l_scale_i = 1/scale; }</td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line"><span class='comment'>//////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line"><span class='comment'>// Common code used by all image loaders</span></td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">   STBI__SCAN_load=0,</td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">   STBI__SCAN_type,</td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">   STBI__SCAN_header</td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__refill_buffer(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">   <span class='keyword'>int</span> n = (s-&gt;io.read)(s-&gt;io_user_data,(<span class='keyword'>char</span>*)s-&gt;buffer_start,s-&gt;buflen);</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">   <span class='keyword'>if</span> (n == 0) {</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">      <span class='comment'>// at end of file, treat same as if from memory, but need to handle case</span></td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">      <span class='comment'>// where s-&gt;img_buffer isn't pointing to safe memory, e.g. 0-byte file</span></td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">      s-&gt;read_from_callbacks = 0;</td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">      s-&gt;img_buffer = s-&gt;buffer_start;</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">      s-&gt;img_buffer_end = s-&gt;buffer_start+1;</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">      *s-&gt;img_buffer = 0;</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">      s-&gt;img_buffer = s-&gt;buffer_start;</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">      s-&gt;img_buffer_end = s-&gt;buffer_start + n;</td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line">stbi_inline <span class='keyword'>static</span> stbi_uc stbi__get8(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">   <span class='keyword'>if</span> (s-&gt;img_buffer &lt; s-&gt;img_buffer_end)</td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line">      <span class='keyword'>return</span> *s-&gt;img_buffer++;</td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">   <span class='keyword'>if</span> (s-&gt;read_from_callbacks) {</td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">      stbi__refill_buffer(s);</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line">      <span class='keyword'>return</span> *s-&gt;img_buffer++;</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__at_eof(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">   <span class='keyword'>if</span> (s-&gt;io.read) {</td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">      <span class='keyword'>if</span> (!(s-&gt;io.eof)(s-&gt;io_user_data)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line">      <span class='comment'>// if feof() is true, check if buffer = end</span></td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">      <span class='comment'>// special case: we've only got the special 0 character at the end</span></td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">      <span class='keyword'>if</span> (s-&gt;read_from_callbacks == 0) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">   <span class='keyword'>return</span> s-&gt;img_buffer &gt;= s-&gt;img_buffer_end;</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__skip(stbi__context *s, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">   <span class='keyword'>if</span> (n &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">      s-&gt;img_buffer = s-&gt;img_buffer_end;</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">      <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">   <span class='keyword'>if</span> (s-&gt;io.read) {</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">      <span class='keyword'>int</span> blen = (<span class='keyword'>int</span>) (s-&gt;img_buffer_end - s-&gt;img_buffer);</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">      <span class='keyword'>if</span> (blen &lt; n) {</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">         s-&gt;img_buffer = s-&gt;img_buffer_end;</td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">         (s-&gt;io.skip)(s-&gt;io_user_data, n - blen);</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line">         <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">   s-&gt;img_buffer += n;</td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__getn(stbi__context *s, stbi_uc *buffer, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">   <span class='keyword'>if</span> (s-&gt;io.read) {</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">      <span class='keyword'>int</span> blen = (<span class='keyword'>int</span>) (s-&gt;img_buffer_end - s-&gt;img_buffer);</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">      <span class='keyword'>if</span> (blen &lt; n) {</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">         <span class='keyword'>int</span> res, count;</td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">         memcpy(buffer, s-&gt;img_buffer, blen);</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">         count = (s-&gt;io.read)(s-&gt;io_user_data, (<span class='keyword'>char</span>*) buffer + blen, n - blen);</td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">         res = (count == (n-blen));</td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">         s-&gt;img_buffer = s-&gt;img_buffer_end;</td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">         <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">   <span class='keyword'>if</span> (s-&gt;img_buffer+n &lt;= s-&gt;img_buffer_end) {</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">      memcpy(buffer, s-&gt;img_buffer, n);</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">      s-&gt;img_buffer += n;</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">      <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">   } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__get16be(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">   <span class='keyword'>int</span> z = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">   <span class='keyword'>return</span> (z &lt;&lt; 8) + stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line"><span class='keyword'>static</span> stbi__uint32 stbi__get32be(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">   stbi__uint32 z = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">   <span class='keyword'>return</span> (z &lt;&lt; 16) + stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line"><span class='directive'>#if defined(STBI_NO_BMP) &amp;&amp; defined(STBI_NO_TGA) &amp;&amp; defined(STBI_NO_GIF)</span></td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line"><span class='comment'>// nothing</span></td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__get16le(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">   <span class='keyword'>int</span> z = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">   <span class='keyword'>return</span> z + (stbi__get8(s) &lt;&lt; 8);</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line"><span class='directive'>#ifndef STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line"><span class='keyword'>static</span> stbi__uint32 stbi__get32le(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">   stbi__uint32 z = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">   <span class='keyword'>return</span> z + (stbi__get16le(s) &lt;&lt; 16);</td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__BYTECAST(x)<span class='macro_popup'>((stbi_uc) ((x) &amp; 255))</span></span>  ((stbi_uc) ((x) &amp; 255))  // truncate int to byte without warnings</span></td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line"><span class='comment'>//////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line"><span class='comment'>//  generic converter from built-in img_n to req_comp</span></td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line"><span class='comment'>//    individual types do this automatically as much as possible (e.g. jpeg</span></td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line"><span class='comment'>//    does all cases internally since it needs to colorspace convert anyway,</span></td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line"><span class='comment'>//    and it never has alpha, so very few cases ). png can automatically</span></td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line"><span class='comment'>//    interleave an alpha=255 channel, but falls back to this for other cases</span></td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line"><span class='comment'>//  assume data buffer is malloced, so malloc a new one and free that one</span></td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line"><span class='comment'>//  only failure mode is malloc failing</span></td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line"><span class='keyword'>static</span> stbi_uc stbi__compute_y(<span class='keyword'>int</span> r, <span class='keyword'>int</span> g, <span class='keyword'>int</span> b)</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">   <span class='keyword'>return</span> (stbi_uc) (((r*77) + (g*150) +  (29*b)) &gt;&gt; 8);</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *stbi__convert_format(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *data, <span class='keyword'>int</span> img_n, <span class='keyword'>int</span> req_comp, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> x, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> y)</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">   <span class='keyword'>int</span> i,j;</td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *good;</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">   <span class='keyword'>if</span> (req_comp == img_n) <span class='keyword'>return</span> data;</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">   <span class='macro'>STBI_ASSERT(req_comp &gt;= 1 &amp;&amp; req_comp &lt;= 4)<span class='macro_popup'>((void) sizeof ((req_comp &gt;= 1 &amp;&amp; req_comp &lt;= 4<br>) ? 1 : 0), __extension__ ({ if (req_comp &gt;= 1 &amp;&amp; req_comp<br> &lt;= 4) ; else __assert_fail ("req_comp &gt;= 1 &amp;&amp; req_comp &lt;= 4"<br>, "src/stb_image.h", 1525, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">   good = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) stbi__malloc_mad3(req_comp, x, y, 0);</td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">   <span class='keyword'>if</span> (good == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">      <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">   <span class='keyword'>for</span> (j=0; j &lt; (<span class='keyword'>int</span>) y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *src  = data + j * x * img_n   ;</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *dest = good + j * x * req_comp;</td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">      <span class='directive'>#define <span class='macro'>STBI__COMBO(a,b)<span class='macro_popup'>((a)*8+(b))</span></span>  ((a)*8+(b))</span></td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">      <span class='directive'>#define STBI__CASE(a,b)   case <span class='macro'>STBI__COMBO(a,b)<span class='macro_popup'>((a)*8+(b))</span></span>: for(i=x-1; i &gt;= 0; --i, src += a, dest += b)</span></td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">      <span class='comment'>// convert source image with img_n components to one with req_comp components;</span></td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">      <span class='comment'>// avoid switch per pixel, so use switch per scanline and massive macros</span></td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line">      <span class='keyword'>switch</span> (<span class='macro'>STBI__COMBO(img_n, req_comp)<span class='macro_popup'>((img_n)*8+(req_comp))</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">         STBI__CASE(1,2) { dest[0]=src[0], dest[1]=255;                                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">         STBI__CASE(1,3) { dest[0]=dest[1]=dest[2]=src[0];                                  } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">         STBI__CASE(1,4) { dest[0]=dest[1]=dest[2]=src[0], dest[3]=255;                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">         STBI__CASE(2,1) { dest[0]=src[0];                                                  } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">         STBI__CASE(2,3) { dest[0]=dest[1]=dest[2]=src[0];                                  } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">         STBI__CASE(2,4) { dest[0]=dest[1]=dest[2]=src[0], dest[3]=src[1];                  } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">         STBI__CASE(3,4) { dest[0]=src[0],dest[1]=src[1],dest[2]=src[2],dest[3]=255;        } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">         STBI__CASE(3,1) { dest[0]=stbi__compute_y(src[0],src[1],src[2]);                   } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">         STBI__CASE(3,2) { dest[0]=stbi__compute_y(src[0],src[1],src[2]), dest[1] = 255;    } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">         STBI__CASE(4,1) { dest[0]=stbi__compute_y(src[0],src[1],src[2]);                   } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">         STBI__CASE(4,2) { dest[0]=stbi__compute_y(src[0],src[1],src[2]), dest[1] = src[3]; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">         STBI__CASE(4,3) { dest[0]=src[0],dest[1]=src[1],dest[2]=src[2];                    } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">         <span class='keyword'>default</span>: <span class='macro'>STBI_ASSERT(0)<span class='macro_popup'>((void) sizeof ((0) ? 1 : 0), __extension__ ({ if (0) ; else __assert_fail<br> ("0", "src/stb_image.h", 1554, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">      <span class='directive'>#undef STBI__CASE</span></td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">   <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">   <span class='keyword'>return</span> good;</td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line"><span class='keyword'>static</span> stbi__uint16 stbi__compute_y_16(<span class='keyword'>int</span> r, <span class='keyword'>int</span> g, <span class='keyword'>int</span> b)</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">   <span class='keyword'>return</span> (stbi__uint16) (((r*77) + (g*150) +  (29*b)) &gt;&gt; 8);</td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line"><span class='keyword'>static</span> stbi__uint16 *stbi__convert_format16(stbi__uint16 *data, <span class='keyword'>int</span> img_n, <span class='keyword'>int</span> req_comp, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> x, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> y)</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">   <span class='keyword'>int</span> i,j;</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line">   stbi__uint16 *good;</td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">   <span class='keyword'>if</span> (req_comp == img_n) <span class='keyword'>return</span> data;</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">   <span class='macro'>STBI_ASSERT(req_comp &gt;= 1 &amp;&amp; req_comp &lt;= 4)<span class='macro_popup'>((void) sizeof ((req_comp &gt;= 1 &amp;&amp; req_comp &lt;= 4<br>) ? 1 : 0), __extension__ ({ if (req_comp &gt;= 1 &amp;&amp; req_comp<br> &lt;= 4) ; else __assert_fail ("req_comp &gt;= 1 &amp;&amp; req_comp &lt;= 4"<br>, "src/stb_image.h", 1574, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">   good = (stbi__uint16 *) stbi__malloc(req_comp * x * y * 2);</td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">   <span class='keyword'>if</span> (good == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">      <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">      <span class='keyword'>return</span> (stbi__uint16 *) <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">   <span class='keyword'>for</span> (j=0; j &lt; (<span class='keyword'>int</span>) y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">      stbi__uint16 *src  = data + j * x * img_n   ;</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line">      stbi__uint16 *dest = good + j * x * req_comp;</td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">      <span class='directive'>#define <span class='macro'>STBI__COMBO(a,b)<span class='macro_popup'>((a)*8+(b))</span></span>  ((a)*8+(b))</span></td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">      <span class='directive'>#define STBI__CASE(a,b)   case <span class='macro'>STBI__COMBO(a,b)<span class='macro_popup'>((a)*8+(b))</span></span>: for(i=x-1; i &gt;= 0; --i, src += a, dest += b)</span></td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">      <span class='comment'>// convert source image with img_n components to one with req_comp components;</span></td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line">      <span class='comment'>// avoid switch per pixel, so use switch per scanline and massive macros</span></td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">      <span class='keyword'>switch</span> (<span class='macro'>STBI__COMBO(img_n, req_comp)<span class='macro_popup'>((img_n)*8+(req_comp))</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line">         STBI__CASE(1,2) { dest[0]=src[0], dest[1]=0xffff;                                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">         STBI__CASE(1,3) { dest[0]=dest[1]=dest[2]=src[0];                                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line">         STBI__CASE(1,4) { dest[0]=dest[1]=dest[2]=src[0], dest[3]=0xffff;                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">         STBI__CASE(2,1) { dest[0]=src[0];                                                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">         STBI__CASE(2,3) { dest[0]=dest[1]=dest[2]=src[0];                                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line">         STBI__CASE(2,4) { dest[0]=dest[1]=dest[2]=src[0], dest[3]=src[1];                     } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">         STBI__CASE(3,4) { dest[0]=src[0],dest[1]=src[1],dest[2]=src[2],dest[3]=0xffff;        } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">         STBI__CASE(3,1) { dest[0]=stbi__compute_y_16(src[0],src[1],src[2]);                   } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">         STBI__CASE(3,2) { dest[0]=stbi__compute_y_16(src[0],src[1],src[2]), dest[1] = 0xffff; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">         STBI__CASE(4,1) { dest[0]=stbi__compute_y_16(src[0],src[1],src[2]);                   } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">         STBI__CASE(4,2) { dest[0]=stbi__compute_y_16(src[0],src[1],src[2]), dest[1] = src[3]; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">         STBI__CASE(4,3) { dest[0]=src[0],dest[1]=src[1],dest[2]=src[2];                       } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">         <span class='keyword'>default</span>: <span class='macro'>STBI_ASSERT(0)<span class='macro_popup'>((void) sizeof ((0) ? 1 : 0), __extension__ ({ if (0) ; else __assert_fail<br> ("0", "src/stb_image.h", 1603, __extension__ __PRETTY_FUNCTION__<br>); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">      <span class='directive'>#undef STBI__CASE</span></td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line">   <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">   <span class='keyword'>return</span> good;</td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line"><span class='directive'>#ifndef STBI_NO_LINEAR</span></td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span>   *stbi__ldr_to_hdr(stbi_uc *data, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp)</td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">   <span class='keyword'>int</span> i,k,n;</td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">   <span class='keyword'>float</span> *output;</td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">   <span class='keyword'>if</span> (!data) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">   output = (<span class='keyword'>float</span> *) stbi__malloc_mad4(x, y, comp, <span class='keyword'>sizeof</span>(<span class='keyword'>float</span>), 0);</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">   <span class='keyword'>if</span> (output == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) { <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("outofmem")?((void*)0):((void*)<br>0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">   <span class='comment'>// compute number of non-alpha components</span></td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">   <span class='keyword'>if</span> (comp &amp; 1) n = comp; <span class='keyword'>else</span> n = comp-1;</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; x*y; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">      <span class='keyword'>for</span> (k=0; k &lt; n; ++k) {</td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">         output[i*comp + k] = (<span class='keyword'>float</span>) (pow(data[i*comp+k]/255.0f, stbi__l2h_gamma) * stbi__l2h_scale);</td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">      <span class='keyword'>if</span> (k &lt; comp) output[i*comp + k] = data[i*comp+k]/255.0f;</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">   <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">   <span class='keyword'>return</span> output;</td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line"><span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__float2int(x)<span class='macro_popup'>((int) (x))</span></span>   ((int) (x))</span></td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__hdr_to_ldr(<span class='keyword'>float</span>   *data, <span class='keyword'>int</span> x, <span class='keyword'>int</span> y, <span class='keyword'>int</span> comp)</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">   <span class='keyword'>int</span> i,k,n;</td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">   stbi_uc *output;</td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">   <span class='keyword'>if</span> (!data) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">   output = (stbi_uc *) stbi__malloc_mad3(x, y, comp, 0);</td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">   <span class='keyword'>if</span> (output == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) { <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">   <span class='comment'>// compute number of non-alpha components</span></td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">   <span class='keyword'>if</span> (comp &amp; 1) n = comp; <span class='keyword'>else</span> n = comp-1;</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; x*y; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">      <span class='keyword'>for</span> (k=0; k &lt; n; ++k) {</td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">         <span class='keyword'>float</span> z = (<span class='keyword'>float</span>) pow(data[i*comp+k]*stbi__h2l_scale_i, stbi__h2l_gamma_i) * 255 + 0.5f;</td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">         <span class='keyword'>if</span> (z &lt; 0) z = 0;</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">         <span class='keyword'>if</span> (z &gt; 255) z = 255;</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">         output[i*comp + k] = (stbi_uc) <span class='macro'>stbi__float2int(z)<span class='macro_popup'>((int) (z))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">      <span class='keyword'>if</span> (k &lt; comp) {</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">         <span class='keyword'>float</span> z = data[i*comp+k] * 255 + 0.5f;</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">         <span class='keyword'>if</span> (z &lt; 0) z = 0;</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line">         <span class='keyword'>if</span> (z &gt; 255) z = 255;</td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">         output[i*comp + k] = (stbi_uc) <span class='macro'>stbi__float2int(z)<span class='macro_popup'>((int) (z))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">   <span class='macro'>STBI_FREE(data)<span class='macro_popup'>free(data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">   <span class='keyword'>return</span> output;</td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line"><span class='comment'>//////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line"><span class='comment'>//  "baseline" JPEG/JFIF decoder</span></td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line"><span class='comment'>//    simple implementation</span></td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line"><span class='comment'>//      - doesn't support delayed output of y-dimension</span></td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line"><span class='comment'>//      - simple interface (only one output format: 8-bit interleaved RGB)</span></td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line"><span class='comment'>//      - doesn't try to recover corrupt jpegs</span></td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line"><span class='comment'>//      - doesn't allow partial loading, loading multiple at once</span></td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line"><span class='comment'>//      - still fast on x86 (copying globals into locals doesn't help x86)</span></td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line"><span class='comment'>//      - allocates lots of intermediate memory (full size of all components)</span></td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line"><span class='comment'>//        - non-interleaved case requires this anyway</span></td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line"><span class='comment'>//        - allows good upsampling (see next)</span></td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line"><span class='comment'>//    high-quality</span></td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line"><span class='comment'>//      - upsampled channels are bilinearly interpolated, even across blocks</span></td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line"><span class='comment'>//      - quality integer IDCT derived from IJG's 'slow'</span></td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line"><span class='comment'>//    performance</span></td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line"><span class='comment'>//      - fast huffman; reasonable integer IDCT</span></td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line"><span class='comment'>//      - some SIMD kernels for common paths on targets with SSE2/NEON</span></td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line"><span class='comment'>//      - uses a lot of intermediate memory, could cache poorly</span></td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line"><span class='directive'>#ifndef STBI_NO_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line"><span class='comment'>// huffman decoding acceleration</span></td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line"><span class='directive'>#define <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>   9  // larger handles more cases; smaller stomps less cache</span></td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">   stbi_uc  fast[1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">   <span class='comment'>// weirdly, repacking this into AoS is a 10% speed loss, instead of a win</span></td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">   stbi__uint16 code[256];</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line">   stbi_uc  values[256];</td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">   stbi_uc  size[257];</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> maxcode[18];</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">   <span class='keyword'>int</span>    delta[17];   <span class='comment'>// old 'firstsymbol' - old 'firstcode'</span></td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">} stbi__huffman;</td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">   stbi__context *s;</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">   stbi__huffman huff_dc[4];</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line">   stbi__huffman huff_ac[4];</td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">   stbi__uint16 dequant[4][64];</td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">   stbi__int16 fast_ac[4][1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line"><span class='comment'>// sizes for components, interleaved MCUs</span></td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">   <span class='keyword'>int</span> img_h_max, img_v_max;</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">   <span class='keyword'>int</span> img_mcu_x, img_mcu_y;</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">   <span class='keyword'>int</span> img_mcu_w, img_mcu_h;</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line"><span class='comment'>// definition of jpeg image component</span></td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">   <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">      <span class='keyword'>int</span> id;</td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line">      <span class='keyword'>int</span> h,v;</td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">      <span class='keyword'>int</span> tq;</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">      <span class='keyword'>int</span> hd,ha;</td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">      <span class='keyword'>int</span> dc_pred;</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">      <span class='keyword'>int</span> x,y,w2,h2;</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">      stbi_uc *data;</td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">      <span class='keyword'>void</span> *raw_data, *raw_coeff;</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">      stbi_uc *linebuf;</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line">      <span class='keyword'>short</span>   *coeff;   <span class='comment'>// progressive only</span></td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">      <span class='keyword'>int</span>      coeff_w, coeff_h; <span class='comment'>// number of 8x8 coefficient blocks</span></td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">   } img_comp[4];</td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line">   stbi__uint32   code_buffer; <span class='comment'>// jpeg entropy-coded buffer</span></td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">   <span class='keyword'>int</span>            code_bits;   <span class='comment'>// number of valid bits</span></td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span>  marker;      <span class='comment'>// marker seen while filling entropy buffer</span></td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line">   <span class='keyword'>int</span>            nomore;      <span class='comment'>// flag if we saw a marker so must stop</span></td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line">   <span class='keyword'>int</span>            progressive;</td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line">   <span class='keyword'>int</span>            spec_start;</td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">   <span class='keyword'>int</span>            spec_end;</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">   <span class='keyword'>int</span>            succ_high;</td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">   <span class='keyword'>int</span>            succ_low;</td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line">   <span class='keyword'>int</span>            eob_run;</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">   <span class='keyword'>int</span>            jfif;</td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line">   <span class='keyword'>int</span>            app14_color_transform; <span class='comment'>// Adobe APP14 tag</span></td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">   <span class='keyword'>int</span>            rgb;</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">   <span class='keyword'>int</span> scan_n, order[4];</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">   <span class='keyword'>int</span> restart_interval, todo;</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line"><span class='comment'>// kernels</span></td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">   <span class='keyword'>void</span> (*idct_block_kernel)(stbi_uc *out, <span class='keyword'>int</span> out_stride, <span class='keyword'>short</span> data[64]);</td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">   <span class='keyword'>void</span> (*YCbCr_to_RGB_kernel)(stbi_uc *out, <span class='keyword'>const</span> stbi_uc *y, <span class='keyword'>const</span> stbi_uc *pcb, <span class='keyword'>const</span> stbi_uc *pcr, <span class='keyword'>int</span> count, <span class='keyword'>int</span> step);</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">   stbi_uc *(*resample_row_hv_2_kernel)(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs);</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">} stbi__jpeg;</td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__build_huffman(stbi__huffman *h, <span class='keyword'>int</span> *count)</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">   <span class='keyword'>int</span> i,j,k=0;</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> code;</td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">   <span class='comment'>// build size list for each symbol (from JPEG spec)</span></td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; 16; ++i)</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; count[i]; ++j)</td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">         h-&gt;size[k++] = (stbi_uc) (i+1);</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">   h-&gt;size[k] = 0;</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line">   <span class='comment'>// compute actual symbols (from jpeg spec)</span></td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line">   code = 0;</td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line">   k = 0;</td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">   <span class='keyword'>for</span>(j=1; j &lt;= 16; ++j) {</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">      <span class='comment'>// compute delta to add to code to compute symbol id</span></td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">      h-&gt;delta[j] = k - code;</td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">      <span class='keyword'>if</span> (h-&gt;size[k] == j) {</td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">         <span class='keyword'>while</span> (h-&gt;size[k] == j)</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">            h-&gt;code[k++] = (stbi__uint16) (code++);</td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">         <span class='keyword'>if</span> (code-1 &gt;= (1u &lt;&lt; j)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad code lengths"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad code lengths")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">      <span class='comment'>// compute largest code + 1 for this size, preshifted as needed later</span></td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">      h-&gt;maxcode[j] = code &lt;&lt; (16-j);</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line">      code &lt;&lt;= 1;</td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">   h-&gt;maxcode[j] = 0xffffffff;</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">   <span class='comment'>// build non-spec acceleration table; 255 is flag for not-accelerated</span></td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">   memset(h-&gt;fast, 255, 1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; k; ++i) {</td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">      <span class='keyword'>int</span> s = h-&gt;size[i];</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">      <span class='keyword'>if</span> (s &lt;= <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">         <span class='keyword'>int</span> c = h-&gt;code[i] &lt;&lt; (<span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>-s);</td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">         <span class='keyword'>int</span> m = 1 &lt;&lt; (<span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>-s);</td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; m; ++j) {</td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">            h-&gt;fast[c+j] = (stbi_uc) i;</td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line"><span class='comment'>// build a table that decodes both magnitude and value of small ACs in</span></td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line"><span class='comment'>// one go.</span></td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__build_fast_ac(stbi__int16 *fast_ac, stbi__huffman *h)</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; (1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>); ++i) {</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">      stbi_uc fast = h-&gt;fast[i];</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">      fast_ac[i] = 0;</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">      <span class='keyword'>if</span> (fast &lt; 255) {</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">         <span class='keyword'>int</span> rs = h-&gt;values[fast];</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">         <span class='keyword'>int</span> run = (rs &gt;&gt; 4) &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">         <span class='keyword'>int</span> magbits = rs &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">         <span class='keyword'>int</span> len = h-&gt;size[fast];</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">         <span class='keyword'>if</span> (magbits &amp;&amp; len + magbits &lt;= <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">            <span class='comment'>// magnitude code followed by receive_extend code</span></td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line">            <span class='keyword'>int</span> k = ((i &lt;&lt; len) &amp; ((1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>) - 1)) &gt;&gt; (<span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span> - magbits);</td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line">            <span class='keyword'>int</span> m = 1 &lt;&lt; (magbits - 1);</td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">            <span class='keyword'>if</span> (k &lt; m) k += (~0U &lt;&lt; magbits) + 1;</td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">            <span class='comment'>// if the result is small enough, we can fit it in fast_ac table</span></td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">            <span class='keyword'>if</span> (k &gt;= -128 &amp;&amp; k &lt;= 127)</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line">               fast_ac[i] = (stbi__int16) ((k * 256) + (run * 16) + (len + magbits));</td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__grow_buffer_unsafe(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">   <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>int</span> b = j-&gt;nomore ? 0 : stbi__get8(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">      <span class='keyword'>if</span> (b == 0xff) {</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">         <span class='keyword'>int</span> c = stbi__get8(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">         <span class='keyword'>while</span> (c == 0xff) c = stbi__get8(j-&gt;s); <span class='comment'>// consume fill bytes</span></td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">         <span class='keyword'>if</span> (c != 0) {</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">            j-&gt;marker = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) c;</td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">            j-&gt;nomore = 1;</td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">      j-&gt;code_buffer |= b &lt;&lt; (24 - j-&gt;code_bits);</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">      j-&gt;code_bits += 8;</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">   } <span class='keyword'>while</span> (j-&gt;code_bits &lt;= 24);</td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line"><span class='comment'>// (1 &lt;&lt; n) - 1</span></td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> stbi__uint32 stbi__bmask[17]={0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535};</td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line"><span class='comment'>// decode a jpeg huffman value from the bitstream</span></td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_huff_decode(stbi__jpeg *j, stbi__huffman *h)</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> temp;</td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">   <span class='keyword'>int</span> c,k;</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line">   <span class='keyword'>if</span> (j-&gt;code_bits &lt; 16) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line">   <span class='comment'>// look at the top FAST_BITS and determine what symbol ID it is,</span></td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line">   <span class='comment'>// if the code is &lt;= FAST_BITS</span></td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">   c = (j-&gt;code_buffer &gt;&gt; (32 - <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>)) &amp; ((1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>)-1);</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">   k = h-&gt;fast[c];</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">   <span class='keyword'>if</span> (k &lt; 255) {</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">      <span class='keyword'>int</span> s = h-&gt;size[k];</td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">      <span class='keyword'>if</span> (s &gt; j-&gt;code_bits)</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line">         <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">      j-&gt;code_buffer &lt;&lt;= s;</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line">      j-&gt;code_bits -= s;</td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">      <span class='keyword'>return</span> h-&gt;values[k];</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">   <span class='comment'>// naive test is to shift the code_buffer down so k bits are</span></td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">   <span class='comment'>// valid, then test against maxcode. To speed this up, we've</span></td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">   <span class='comment'>// preshifted maxcode left so that it has (16-k) 0s at the</span></td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">   <span class='comment'>// end; in other words, regardless of the number of bits, it</span></td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line">   <span class='comment'>// wants to be compared against something shifted to have 16;</span></td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">   <span class='comment'>// that way we don't need to shift inside the loop.</span></td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line">   temp = j-&gt;code_buffer &gt;&gt; 16;</td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line">   <span class='keyword'>for</span> (k=<span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>+1 ; ; ++k)</td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line">      <span class='keyword'>if</span> (temp &lt; h-&gt;maxcode[k])</td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line">         <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line">   <span class='keyword'>if</span> (k == 17) {</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">      <span class='comment'>// error! code not found</span></td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">      j-&gt;code_bits -= 16;</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">      <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">   <span class='keyword'>if</span> (k &gt; j-&gt;code_bits)</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">      <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">   <span class='comment'>// convert the huffman code to the symbol id</span></td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line">   c = ((j-&gt;code_buffer &gt;&gt; (32 - k)) &amp; stbi__bmask[k]) + h-&gt;delta[k];</td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">   <span class='macro'>STBI_ASSERT((((j-&gt;code_buffer) &gt;&gt; (32 - h-&gt;size[c])) &amp; stbi__bmask[h-&gt;size[c]]) == h-&gt;code[c])<span class='macro_popup'>((void) sizeof (((((j-&gt;code_buffer) &gt;&gt; (32 - h-&gt;size<br>[c])) &amp; stbi__bmask[h-&gt;size[c]]) == h-&gt;code[c]) ? 1<br> : 0), __extension__ ({ if ((((j-&gt;code_buffer) &gt;&gt; (32<br> - h-&gt;size[c])) &amp; stbi__bmask[h-&gt;size[c]]) == h-&gt;<br>code[c]) ; else __assert_fail ("(((j-&gt;code_buffer) &gt;&gt; (32 - h-&gt;size[c])) &amp; stbi__bmask[h-&gt;size[c]]) == h-&gt;code[c]"<br>, "src/stb_image.h", 1886, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">   <span class='comment'>// convert the id to a symbol</span></td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line">   j-&gt;code_bits -= k;</td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line">   j-&gt;code_buffer &lt;&lt;= k;</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line">   <span class='keyword'>return</span> h-&gt;values[c];</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line"><span class='comment'>// bias[n] = (-1&lt;&lt;n) + 1</span></td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> stbi__jbias[16] = {0,-1,-3,-7,-15,-31,-63,-127,-255,-511,-1023,-2047,-4095,-8191,-16383,-32767};</td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line"><span class='comment'>// combined JPEG 'receive' and JPEG 'extend', since baseline</span></td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line"><span class='comment'>// always extends everything it receives.</span></td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__extend_receive(stbi__jpeg *j, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line">   <span class='keyword'>int</span> sgn;</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line">   <span class='keyword'>if</span> (j-&gt;code_bits &lt; n) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line">   sgn = (stbi__int32)j-&gt;code_buffer &gt;&gt; 31; <span class='comment'>// sign bit is always in MSB</span></td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">   k = <span class='macro'>stbi_lrot(j-&gt;code_buffer, n)<span class='macro_popup'>(((j-&gt;code_buffer) &lt;&lt; (n)) | ((j-&gt;code_buffer) &gt;&gt;<br> (32 - (n))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line">   <span class='macro'>STBI_ASSERT(n &gt;= 0 &amp;&amp; n &lt; (<span class='keyword'>int</span>) (<span class='keyword'>sizeof</span>(stbi__bmask)/<span class='keyword'>sizeof</span>(*stbi__bmask)))<span class='macro_popup'>((void) sizeof ((n &gt;= 0 &amp;&amp; n &lt; (int) (sizeof(stbi__bmask<br>)/sizeof(*stbi__bmask))) ? 1 : 0), __extension__ ({ if (n &gt;=<br> 0 &amp;&amp; n &lt; (int) (sizeof(stbi__bmask)/sizeof(*stbi__bmask<br>))) ; else __assert_fail ("n &gt;= 0 &amp;&amp; n &lt; (int) (sizeof(stbi__bmask)/sizeof(*stbi__bmask))"<br>, "src/stb_image.h", 1907, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">   j-&gt;code_buffer = k &amp; ~stbi__bmask[n];</td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">   k &amp;= stbi__bmask[n];</td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">   j-&gt;code_bits -= n;</td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">   <span class='keyword'>return</span> k + (stbi__jbias[n] &amp; ~sgn);</td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line"><span class='comment'>// get some unsigned bits</span></td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_get_bits(stbi__jpeg *j, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">   <span class='keyword'>if</span> (j-&gt;code_bits &lt; n) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">   k = <span class='macro'>stbi_lrot(j-&gt;code_buffer, n)<span class='macro_popup'>(((j-&gt;code_buffer) &lt;&lt; (n)) | ((j-&gt;code_buffer) &gt;&gt;<br> (32 - (n))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line">   j-&gt;code_buffer = k &amp; ~stbi__bmask[n];</td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">   k &amp;= stbi__bmask[n];</td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line">   j-&gt;code_bits -= n;</td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line">   <span class='keyword'>return</span> k;</td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_get_bit(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">   <span class='keyword'>if</span> (j-&gt;code_bits &lt; 1) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">   k = j-&gt;code_buffer;</td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">   j-&gt;code_buffer &lt;&lt;= 1;</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line">   --j-&gt;code_bits;</td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line">   <span class='keyword'>return</span> k &amp; 0x80000000;</td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line"><span class='comment'>// given a value that's at position X in the zigzag stream,</span></td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line"><span class='comment'>// where does it appear in the 8x8 matrix coded as row-major?</span></td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> stbi_uc stbi__jpeg_dezigzag[64+15] =</td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">    0,  1,  8, 16,  9,  2,  3, 10,</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">   17, 24, 32, 25, 18, 11,  4,  5,</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line">   12, 19, 26, 33, 40, 48, 41, 34,</td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">   27, 20, 13,  6,  7, 14, 21, 28,</td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">   35, 42, 49, 56, 57, 50, 43, 36,</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line">   29, 22, 15, 23, 30, 37, 44, 51,</td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line">   58, 59, 52, 45, 38, 31, 39, 46,</td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line">   53, 60, 61, 54, 47, 55, 62, 63,</td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">   <span class='comment'>// let corrupt input sample past end</span></td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line">   63, 63, 63, 63, 63, 63, 63, 63,</td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line">   63, 63, 63, 63, 63, 63, 63</td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line"><span class='comment'>// decode one 64-entry block--</span></td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_decode_block(stbi__jpeg *j, <span class='keyword'>short</span> data[64], stbi__huffman *hdc, stbi__huffman *hac, stbi__int16 *fac, <span class='keyword'>int</span> b, stbi__uint16 *dequant)</td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">   <span class='keyword'>int</span> diff,dc,k;</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line">   <span class='keyword'>int</span> t;</td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line">   <span class='keyword'>if</span> (j-&gt;code_bits &lt; 16) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line">   t = stbi__jpeg_huff_decode(j, hdc);</td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line">   <span class='keyword'>if</span> (t &lt; 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line">   <span class='comment'>// 0 all the ac values now so we can do it 32-bits at a time</span></td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">   memset(data,0,64*<span class='keyword'>sizeof</span>(data[0]));</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">   diff = t ? stbi__extend_receive(j, t) : 0;</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">   dc = j-&gt;img_comp[b].dc_pred + diff;</td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">   j-&gt;img_comp[b].dc_pred = dc;</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">   data[0] = (<span class='keyword'>short</span>) (dc * dequant[0]);</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line">   <span class='comment'>// decode AC components, see JPEG spec</span></td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">   k = 1;</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line">   <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>int</span> zig;</td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">      <span class='keyword'>int</span> c,r,s;</td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">      <span class='keyword'>if</span> (j-&gt;code_bits &lt; 16) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line">      c = (j-&gt;code_buffer &gt;&gt; (32 - <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>)) &amp; ((1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>)-1);</td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">      r = fac[c];</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line">      <span class='keyword'>if</span> (r) { <span class='comment'>// fast-AC path</span></td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">         k += (r &gt;&gt; 4) &amp; 15; <span class='comment'>// run</span></td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line">         s = r &amp; 15; <span class='comment'>// combined length</span></td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">         j-&gt;code_buffer &lt;&lt;= s;</td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line">         j-&gt;code_bits -= s;</td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">         <span class='comment'>// decode into unzigzag'd location</span></td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">         zig = stbi__jpeg_dezigzag[k++];</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line">         data[zig] = (<span class='keyword'>short</span>) ((r &gt;&gt; 8) * dequant[zig]);</td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">         <span class='keyword'>int</span> rs = stbi__jpeg_huff_decode(j, hac);</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line">         <span class='keyword'>if</span> (rs &lt; 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">         s = rs &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">         r = rs &gt;&gt; 4;</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line">         <span class='keyword'>if</span> (s == 0) {</td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">            <span class='keyword'>if</span> (rs != 0xf0) <span class='keyword'>break</span>; <span class='comment'>// end block</span></td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">            k += 16;</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">            k += r;</td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">            <span class='comment'>// decode into unzigzag'd location</span></td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line">            zig = stbi__jpeg_dezigzag[k++];</td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line">            data[zig] = (<span class='keyword'>short</span>) (stbi__extend_receive(j,s) * dequant[zig]);</td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">   } <span class='keyword'>while</span> (k &lt; 64);</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_decode_block_prog_dc(stbi__jpeg *j, <span class='keyword'>short</span> data[64], stbi__huffman *hdc, <span class='keyword'>int</span> b)</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line">   <span class='keyword'>int</span> diff,dc;</td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">   <span class='keyword'>int</span> t;</td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">   <span class='keyword'>if</span> (j-&gt;spec_end != 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"can't merge dc and ac"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("can't merge dc and ac")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">   <span class='keyword'>if</span> (j-&gt;code_bits &lt; 16) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">   <span class='keyword'>if</span> (j-&gt;succ_high == 0) {</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">      <span class='comment'>// first scan for DC coefficient, must be first</span></td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line">      memset(data,0,64*<span class='keyword'>sizeof</span>(data[0])); <span class='comment'>// 0 all the ac values now</span></td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line">      t = stbi__jpeg_huff_decode(j, hdc);</td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line">      diff = t ? stbi__extend_receive(j, t) : 0;</td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line">      dc = j-&gt;img_comp[b].dc_pred + diff;</td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">      j-&gt;img_comp[b].dc_pred = dc;</td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line">      data[0] = (<span class='keyword'>short</span>) (dc &lt;&lt; j-&gt;succ_low);</td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">      <span class='comment'>// refinement scan for DC coefficient</span></td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line">      <span class='keyword'>if</span> (stbi__jpeg_get_bit(j))</td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">         data[0] += (<span class='keyword'>short</span>) (1 &lt;&lt; j-&gt;succ_low);</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line"><span class='comment'>// @OPTIMIZE: store non-zigzagged during the decode passes,</span></td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line"><span class='comment'>// and only de-zigzag when dequantizing</span></td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_decode_block_prog_ac(stbi__jpeg *j, <span class='keyword'>short</span> data[64], stbi__huffman *hac, stbi__int16 *fac)</td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line">   <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line">   <span class='keyword'>if</span> (j-&gt;spec_start == 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"can't merge dc and ac"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("can't merge dc and ac")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line">   <span class='keyword'>if</span> (j-&gt;succ_high == 0) {</td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line">      <span class='keyword'>int</span> shift = j-&gt;succ_low;</td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line">      <span class='keyword'>if</span> (j-&gt;eob_run) {</td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line">         --j-&gt;eob_run;</td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line">         <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">      k = j-&gt;spec_start;</td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line">      <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">         <span class='keyword'>unsigned</span> <span class='keyword'>int</span> zig;</td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">         <span class='keyword'>int</span> c,r,s;</td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line">         <span class='keyword'>if</span> (j-&gt;code_bits &lt; 16) stbi__grow_buffer_unsafe(j);</td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line">         c = (j-&gt;code_buffer &gt;&gt; (32 - <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>)) &amp; ((1 &lt;&lt; <span class='macro'>FAST_BITS<span class='macro_popup'>9</span></span>)-1);</td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line">         r = fac[c];</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line">         <span class='keyword'>if</span> (r) { <span class='comment'>// fast-AC path</span></td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line">            k += (r &gt;&gt; 4) &amp; 15; <span class='comment'>// run</span></td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line">            s = r &amp; 15; <span class='comment'>// combined length</span></td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line">            j-&gt;code_buffer &lt;&lt;= s;</td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">            j-&gt;code_bits -= s;</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line">            zig = stbi__jpeg_dezigzag[k++];</td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">            data[zig] = (<span class='keyword'>short</span>) ((r &gt;&gt; 8) &lt;&lt; shift);</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line">            <span class='keyword'>int</span> rs = stbi__jpeg_huff_decode(j, hac);</td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line">            <span class='keyword'>if</span> (rs &lt; 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line">            s = rs &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line">            r = rs &gt;&gt; 4;</td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line">            <span class='keyword'>if</span> (s == 0) {</td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line">               <span class='keyword'>if</span> (r &lt; 15) {</td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line">                  j-&gt;eob_run = (1 &lt;&lt; r);</td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">                  <span class='keyword'>if</span> (r)</td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line">                     j-&gt;eob_run += stbi__jpeg_get_bits(j, r);</td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line">                  --j-&gt;eob_run;</td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line">                  <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">               k += 16;</td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">               k += r;</td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line">               zig = stbi__jpeg_dezigzag[k++];</td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">               data[zig] = (<span class='keyword'>short</span>) (stbi__extend_receive(j,s) &lt;&lt; shift);</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line">      } <span class='keyword'>while</span> (k &lt;= j-&gt;spec_end);</td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">      <span class='comment'>// refinement scan for these AC coefficients</span></td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">      <span class='keyword'>short</span> bit = (<span class='keyword'>short</span>) (1 &lt;&lt; j-&gt;succ_low);</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line">      <span class='keyword'>if</span> (j-&gt;eob_run) {</td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">         --j-&gt;eob_run;</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line">         <span class='keyword'>for</span> (k = j-&gt;spec_start; k &lt;= j-&gt;spec_end; ++k) {</td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line">            <span class='keyword'>short</span> *p = &amp;data[stbi__jpeg_dezigzag[k]];</td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line">            <span class='keyword'>if</span> (*p != 0)</td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line">               <span class='keyword'>if</span> (stbi__jpeg_get_bit(j))</td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line">                  <span class='keyword'>if</span> ((*p &amp; bit)==0) {</td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line">                     <span class='keyword'>if</span> (*p &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line">                        *p += bit;</td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line">                     <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line">                        *p -= bit;</td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">         k = j-&gt;spec_start;</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line">         <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line">            <span class='keyword'>int</span> r,s;</td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line">            <span class='keyword'>int</span> rs = stbi__jpeg_huff_decode(j, hac); <span class='comment'>// @OPTIMIZE see if we can use the fast path here, advance-by-r is so slow, eh</span></td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line">            <span class='keyword'>if</span> (rs &lt; 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line">            s = rs &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line">            r = rs &gt;&gt; 4;</td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line">            <span class='keyword'>if</span> (s == 0) {</td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line">               <span class='keyword'>if</span> (r &lt; 15) {</td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line">                  j-&gt;eob_run = (1 &lt;&lt; r) - 1;</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line">                  <span class='keyword'>if</span> (r)</td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line">                     j-&gt;eob_run += stbi__jpeg_get_bits(j, r);</td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line">                  r = 64; <span class='comment'>// force end of block</span></td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">                  <span class='comment'>// r=15 s=0 should write 16 0s, so we just do</span></td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line">                  <span class='comment'>// a run of 15 0s and then write s (which is 0),</span></td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line">                  <span class='comment'>// so we don't have to do anything special here</span></td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line">               <span class='keyword'>if</span> (s != 1) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">               <span class='comment'>// sign bit</span></td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">               <span class='keyword'>if</span> (stbi__jpeg_get_bit(j))</td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">                  s = bit;</td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line">               <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">                  s = -bit;</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line">            <span class='comment'>// advance by r</span></td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line">            <span class='keyword'>while</span> (k &lt;= j-&gt;spec_end) {</td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">               <span class='keyword'>short</span> *p = &amp;data[stbi__jpeg_dezigzag[k++]];</td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">               <span class='keyword'>if</span> (*p != 0) {</td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">                  <span class='keyword'>if</span> (stbi__jpeg_get_bit(j))</td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">                     <span class='keyword'>if</span> ((*p &amp; bit)==0) {</td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">                        <span class='keyword'>if</span> (*p &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line">                           *p += bit;</td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line">                        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">                           *p -= bit;</td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">                     }</td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line">                  <span class='keyword'>if</span> (r == 0) {</td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">                     *p = (<span class='keyword'>short</span>) s;</td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line">                     <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">                  --r;</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line">         } <span class='keyword'>while</span> (k &lt;= j-&gt;spec_end);</td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line"><span class='comment'>// take a -128..127 value and stbi__clamp it and convert to 0..255</span></td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line">stbi_inline <span class='keyword'>static</span> stbi_uc stbi__clamp(<span class='keyword'>int</span> x)</td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">   <span class='comment'>// trick to use a single test to catch both cases</span></td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line">   <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span> <span class='keyword'>int</span>) x &gt; 255) {</td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line">      <span class='keyword'>if</span> (x &lt; 0) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">      <span class='keyword'>if</span> (x &gt; 255) <span class='keyword'>return</span> 255;</td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">   <span class='keyword'>return</span> (stbi_uc) x;</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__f2f(x)<span class='macro_popup'>((int) (((x) * 4096 + 0.5)))</span></span>  ((int) (((x) * 4096 + 0.5)))</span></td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__fsh(x)<span class='macro_popup'>((x) * 4096)</span></span>  ((x) * 4096)</span></td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line"><span class='comment'>// derived from jidctint -- DCT_ISLOW</span></td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__IDCT_1D(s0,s1,s2,s3,s4,s5,s6,s7)<span class='macro_popup'>int t0,t1,t2,t3,p1,p2,p3,p4,p5,x0,x1,x2,x3; p2 = s2; p3 = s6;<br> p1 = (p2+p3) * ((int) (((0.5411961f) * 4096 + 0.5))); t2 = p1<br> + p3*((int) (((-1.847759065f) * 4096 + 0.5))); t3 = p1 + p2*<br>((int) (((0.765366865f) * 4096 + 0.5))); p2 = s0; p3 = s4; t0<br> = ((p2+p3) * 4096); t1 = ((p2-p3) * 4096); x0 = t0+t3; x3 = t0<br>-t3; x1 = t1+t2; x2 = t1-t2; t0 = s7; t1 = s5; t2 = s3; t3 = s1<br>; p3 = t0+t2; p4 = t1+t3; p1 = t0+t3; p2 = t1+t2; p5 = (p3+p4<br>)*((int) (((1.175875602f) * 4096 + 0.5))); t0 = t0*((int) (((<br>0.298631336f) * 4096 + 0.5))); t1 = t1*((int) (((2.053119869f<br>) * 4096 + 0.5))); t2 = t2*((int) (((3.072711026f) * 4096 + 0.5<br>))); t3 = t3*((int) (((1.501321110f) * 4096 + 0.5))); p1 = p5<br> + p1*((int) (((-0.899976223f) * 4096 + 0.5))); p2 = p5 + p2*<br>((int) (((-2.562915447f) * 4096 + 0.5))); p3 = p3*((int) (((-<br>1.961570560f) * 4096 + 0.5))); p4 = p4*((int) (((-0.390180644f<br>) * 4096 + 0.5))); t3 += p1+p4; t2 += p2+p3; t1 += p2+p4; t0 +=<br> p1+p3;</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line">   <span class='directive'>int t0,t1,t2,t3,p1,p2,p3,p4,p5,x0,x1,x2,x3; \</span></td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">   <span class='directive'>p2 = s2;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line">   <span class='directive'>p3 = s6;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line">   <span class='directive'>p1 = (p2+p3) * <span class='macro'>stbi__f2f(0.5411961f)<span class='macro_popup'>((int) (((0.5411961f) * 4096 + 0.5)))</span></span>;       \</span></td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line">   <span class='directive'>t2 = p1 + p3*<span class='macro'>stbi__f2f(-1.847759065f)<span class='macro_popup'>((int) (((-1.847759065f) * 4096 + 0.5)))</span></span>;      \</span></td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line">   <span class='directive'>t3 = p1 + p2*<span class='macro'>stbi__f2f( 0.765366865f)<span class='macro_popup'>((int) (((0.765366865f) * 4096 + 0.5)))</span></span>;      \</span></td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">   <span class='directive'>p2 = s0;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">   <span class='directive'>p3 = s4;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line">   <span class='directive'>t0 = <span class='macro'>stbi__fsh(p2+p3)<span class='macro_popup'>((p2+p3) * 4096)</span></span>;                      \</span></td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line">   <span class='directive'>t1 = <span class='macro'>stbi__fsh(p2-p3)<span class='macro_popup'>((p2-p3) * 4096)</span></span>;                      \</span></td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line">   <span class='directive'>x0 = t0+t3;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line">   <span class='directive'>x3 = t0-t3;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line">   <span class='directive'>x1 = t1+t2;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line">   <span class='directive'>x2 = t1-t2;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line">   <span class='directive'>t0 = s7;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line">   <span class='directive'>t1 = s5;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">   <span class='directive'>t2 = s3;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line">   <span class='directive'>t3 = s1;                                    \</span></td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line">   <span class='directive'>p3 = t0+t2;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line">   <span class='directive'>p4 = t1+t3;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">   <span class='directive'>p1 = t0+t3;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line">   <span class='directive'>p2 = t1+t2;                                 \</span></td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line">   <span class='directive'>p5 = (p3+p4)*<span class='macro'>stbi__f2f( 1.175875602f)<span class='macro_popup'>((int) (((1.175875602f) * 4096 + 0.5)))</span></span>;      \</span></td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line">   <span class='directive'>t0 = t0*<span class='macro'>stbi__f2f( 0.298631336f)<span class='macro_popup'>((int) (((0.298631336f) * 4096 + 0.5)))</span></span>;           \</span></td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line">   <span class='directive'>t1 = t1*<span class='macro'>stbi__f2f( 2.053119869f)<span class='macro_popup'>((int) (((2.053119869f) * 4096 + 0.5)))</span></span>;           \</span></td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line">   <span class='directive'>t2 = t2*<span class='macro'>stbi__f2f( 3.072711026f)<span class='macro_popup'>((int) (((3.072711026f) * 4096 + 0.5)))</span></span>;           \</span></td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line">   <span class='directive'>t3 = t3*<span class='macro'>stbi__f2f( 1.501321110f)<span class='macro_popup'>((int) (((1.501321110f) * 4096 + 0.5)))</span></span>;           \</span></td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line">   <span class='directive'>p1 = p5 + p1*<span class='macro'>stbi__f2f(-0.899976223f)<span class='macro_popup'>((int) (((-0.899976223f) * 4096 + 0.5)))</span></span>;      \</span></td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">   <span class='directive'>p2 = p5 + p2*<span class='macro'>stbi__f2f(-2.562915447f)<span class='macro_popup'>((int) (((-2.562915447f) * 4096 + 0.5)))</span></span>;      \</span></td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line">   <span class='directive'>p3 = p3*<span class='macro'>stbi__f2f(-1.961570560f)<span class='macro_popup'>((int) (((-1.961570560f) * 4096 + 0.5)))</span></span>;           \</span></td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">   <span class='directive'>p4 = p4*<span class='macro'>stbi__f2f(-0.390180644f)<span class='macro_popup'>((int) (((-0.390180644f) * 4096 + 0.5)))</span></span>;           \</span></td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">   <span class='directive'>t3 += p1+p4;                                \</span></td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line">   <span class='directive'>t2 += p2+p3;                                \</span></td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">   <span class='directive'>t1 += p2+p4;                                \</span></td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line">   <span class='directive'>t0 += p1+p3;</span></td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__idct_block(stbi_uc *out, <span class='keyword'>int</span> out_stride, <span class='keyword'>short</span> data[64])</td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">   <span class='keyword'>int</span> i,val[64],*v=val;</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">   stbi_uc *o;</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">   <span class='keyword'>short</span> *d = data;</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line">   <span class='comment'>// columns</span></td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; 8; ++i,++d, ++v) {</td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">      <span class='comment'>// if all zeroes, shortcut -- this avoids dequantizing 0s and IDCTing</span></td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">      <span class='keyword'>if</span> (d[ 8]==0 &amp;&amp; d[16]==0 &amp;&amp; d[24]==0 &amp;&amp; d[32]==0</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">           &amp;&amp; d[40]==0 &amp;&amp; d[48]==0 &amp;&amp; d[56]==0) {</td></tr>
<tr class="codeline" data-linenumber="2215"><td class="num" id="LN2215">2215</td><td class="line">         <span class='comment'>//    no shortcut                 0     seconds</span></td></tr>
<tr class="codeline" data-linenumber="2216"><td class="num" id="LN2216">2216</td><td class="line">         <span class='comment'>//    (1|2|3|4|5|6|7)==0          0     seconds</span></td></tr>
<tr class="codeline" data-linenumber="2217"><td class="num" id="LN2217">2217</td><td class="line">         <span class='comment'>//    all separate               -0.047 seconds</span></td></tr>
<tr class="codeline" data-linenumber="2218"><td class="num" id="LN2218">2218</td><td class="line">         <span class='comment'>//    1 &amp;&amp; 2|3 &amp;&amp; 4|5 &amp;&amp; 6|7:    -0.047 seconds</span></td></tr>
<tr class="codeline" data-linenumber="2219"><td class="num" id="LN2219">2219</td><td class="line">         <span class='keyword'>int</span> dcterm = d[0]*4;</td></tr>
<tr class="codeline" data-linenumber="2220"><td class="num" id="LN2220">2220</td><td class="line">         v[0] = v[8] = v[16] = v[24] = v[32] = v[40] = v[48] = v[56] = dcterm;</td></tr>
<tr class="codeline" data-linenumber="2221"><td class="num" id="LN2221">2221</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2222"><td class="num" id="LN2222">2222</td><td class="line">         <span class='macro'>STBI__IDCT_1D(d[ 0],d[ 8],d[16],d[24],d[32],d[40],d[48],d[56])<span class='macro_popup'>int t0,t1,t2,t3,p1,p2,p3,p4,p5,x0,x1,x2,x3; p2 = d[16]; p3 = d<br>[48]; p1 = (p2+p3) * ((int) (((0.5411961f) * 4096 + 0.5))); t2<br> = p1 + p3*((int) (((-1.847759065f) * 4096 + 0.5))); t3 = p1 +<br> p2*((int) (((0.765366865f) * 4096 + 0.5))); p2 = d[ 0]; p3 =<br> d[32]; t0 = ((p2+p3) * 4096); t1 = ((p2-p3) * 4096); x0 = t0<br>+t3; x3 = t0-t3; x1 = t1+t2; x2 = t1-t2; t0 = d[56]; t1 = d[40<br>]; t2 = d[24]; t3 = d[ 8]; p3 = t0+t2; p4 = t1+t3; p1 = t0+t3<br>; p2 = t1+t2; p5 = (p3+p4)*((int) (((1.175875602f) * 4096 + 0.5<br>))); t0 = t0*((int) (((0.298631336f) * 4096 + 0.5))); t1 = t1<br>*((int) (((2.053119869f) * 4096 + 0.5))); t2 = t2*((int) (((3.072711026f<br>) * 4096 + 0.5))); t3 = t3*((int) (((1.501321110f) * 4096 + 0.5<br>))); p1 = p5 + p1*((int) (((-0.899976223f) * 4096 + 0.5))); p2<br> = p5 + p2*((int) (((-2.562915447f) * 4096 + 0.5))); p3 = p3*<br>((int) (((-1.961570560f) * 4096 + 0.5))); p4 = p4*((int) (((-<br>0.390180644f) * 4096 + 0.5))); t3 += p1+p4; t2 += p2+p3; t1 +=<br> p2+p4; t0 += p1+p3;</span></span></td></tr>
<tr class="codeline" data-linenumber="2223"><td class="num" id="LN2223">2223</td><td class="line">         <span class='comment'>// constants scaled things up by 1&lt;&lt;12; let's bring them back</span></td></tr>
<tr class="codeline" data-linenumber="2224"><td class="num" id="LN2224">2224</td><td class="line">         <span class='comment'>// down, but keep 2 extra bits of precision</span></td></tr>
<tr class="codeline" data-linenumber="2225"><td class="num" id="LN2225">2225</td><td class="line">         x0 += 512; x1 += 512; x2 += 512; x3 += 512;</td></tr>
<tr class="codeline" data-linenumber="2226"><td class="num" id="LN2226">2226</td><td class="line">         v[ 0] = (x0+t3) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2227"><td class="num" id="LN2227">2227</td><td class="line">         v[56] = (x0-t3) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2228"><td class="num" id="LN2228">2228</td><td class="line">         v[ 8] = (x1+t2) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2229"><td class="num" id="LN2229">2229</td><td class="line">         v[48] = (x1-t2) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2230"><td class="num" id="LN2230">2230</td><td class="line">         v[16] = (x2+t1) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2231"><td class="num" id="LN2231">2231</td><td class="line">         v[40] = (x2-t1) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2232"><td class="num" id="LN2232">2232</td><td class="line">         v[24] = (x3+t0) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2233"><td class="num" id="LN2233">2233</td><td class="line">         v[32] = (x3-t0) &gt;&gt; 10;</td></tr>
<tr class="codeline" data-linenumber="2234"><td class="num" id="LN2234">2234</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2235"><td class="num" id="LN2235">2235</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2236"><td class="num" id="LN2236">2236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2237"><td class="num" id="LN2237">2237</td><td class="line">   <span class='keyword'>for</span> (i=0, v=val, o=out; i &lt; 8; ++i,v+=8,o+=out_stride) {</td></tr>
<tr class="codeline" data-linenumber="2238"><td class="num" id="LN2238">2238</td><td class="line">      <span class='comment'>// no fast case since the first 1D IDCT spread components out</span></td></tr>
<tr class="codeline" data-linenumber="2239"><td class="num" id="LN2239">2239</td><td class="line">      <span class='macro'>STBI__IDCT_1D(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7])<span class='macro_popup'>int t0,t1,t2,t3,p1,p2,p3,p4,p5,x0,x1,x2,x3; p2 = v[2]; p3 = v<br>[6]; p1 = (p2+p3) * ((int) (((0.5411961f) * 4096 + 0.5))); t2<br> = p1 + p3*((int) (((-1.847759065f) * 4096 + 0.5))); t3 = p1 +<br> p2*((int) (((0.765366865f) * 4096 + 0.5))); p2 = v[0]; p3 = v<br>[4]; t0 = ((p2+p3) * 4096); t1 = ((p2-p3) * 4096); x0 = t0+t3<br>; x3 = t0-t3; x1 = t1+t2; x2 = t1-t2; t0 = v[7]; t1 = v[5]; t2<br> = v[3]; t3 = v[1]; p3 = t0+t2; p4 = t1+t3; p1 = t0+t3; p2 = t1<br>+t2; p5 = (p3+p4)*((int) (((1.175875602f) * 4096 + 0.5))); t0<br> = t0*((int) (((0.298631336f) * 4096 + 0.5))); t1 = t1*((int)<br> (((2.053119869f) * 4096 + 0.5))); t2 = t2*((int) (((3.072711026f<br>) * 4096 + 0.5))); t3 = t3*((int) (((1.501321110f) * 4096 + 0.5<br>))); p1 = p5 + p1*((int) (((-0.899976223f) * 4096 + 0.5))); p2<br> = p5 + p2*((int) (((-2.562915447f) * 4096 + 0.5))); p3 = p3*<br>((int) (((-1.961570560f) * 4096 + 0.5))); p4 = p4*((int) (((-<br>0.390180644f) * 4096 + 0.5))); t3 += p1+p4; t2 += p2+p3; t1 +=<br> p2+p4; t0 += p1+p3;</span></span></td></tr>
<tr class="codeline" data-linenumber="2240"><td class="num" id="LN2240">2240</td><td class="line">      <span class='comment'>// constants scaled things up by 1&lt;&lt;12, plus we had 1&lt;&lt;2 from first</span></td></tr>
<tr class="codeline" data-linenumber="2241"><td class="num" id="LN2241">2241</td><td class="line">      <span class='comment'>// loop, plus horizontal and vertical each scale by sqrt(8) so together</span></td></tr>
<tr class="codeline" data-linenumber="2242"><td class="num" id="LN2242">2242</td><td class="line">      <span class='comment'>// we've got an extra 1&lt;&lt;3, so 1&lt;&lt;17 total we need to remove.</span></td></tr>
<tr class="codeline" data-linenumber="2243"><td class="num" id="LN2243">2243</td><td class="line">      <span class='comment'>// so we want to round that, which means adding 0.5 * 1&lt;&lt;17,</span></td></tr>
<tr class="codeline" data-linenumber="2244"><td class="num" id="LN2244">2244</td><td class="line">      <span class='comment'>// aka 65536. Also, we'll end up with -128 to 127 that we want</span></td></tr>
<tr class="codeline" data-linenumber="2245"><td class="num" id="LN2245">2245</td><td class="line">      <span class='comment'>// to encode as 0..255 by adding 128, so we'll add that before the shift</span></td></tr>
<tr class="codeline" data-linenumber="2246"><td class="num" id="LN2246">2246</td><td class="line">      x0 += 65536 + (128&lt;&lt;17);</td></tr>
<tr class="codeline" data-linenumber="2247"><td class="num" id="LN2247">2247</td><td class="line">      x1 += 65536 + (128&lt;&lt;17);</td></tr>
<tr class="codeline" data-linenumber="2248"><td class="num" id="LN2248">2248</td><td class="line">      x2 += 65536 + (128&lt;&lt;17);</td></tr>
<tr class="codeline" data-linenumber="2249"><td class="num" id="LN2249">2249</td><td class="line">      x3 += 65536 + (128&lt;&lt;17);</td></tr>
<tr class="codeline" data-linenumber="2250"><td class="num" id="LN2250">2250</td><td class="line">      <span class='comment'>// tried computing the shifts into temps, or'ing the temps to see</span></td></tr>
<tr class="codeline" data-linenumber="2251"><td class="num" id="LN2251">2251</td><td class="line">      <span class='comment'>// if any were out of range, but that was slower</span></td></tr>
<tr class="codeline" data-linenumber="2252"><td class="num" id="LN2252">2252</td><td class="line">      o[0] = stbi__clamp((x0+t3) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2253"><td class="num" id="LN2253">2253</td><td class="line">      o[7] = stbi__clamp((x0-t3) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2254"><td class="num" id="LN2254">2254</td><td class="line">      o[1] = stbi__clamp((x1+t2) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2255"><td class="num" id="LN2255">2255</td><td class="line">      o[6] = stbi__clamp((x1-t2) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2256"><td class="num" id="LN2256">2256</td><td class="line">      o[2] = stbi__clamp((x2+t1) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2257"><td class="num" id="LN2257">2257</td><td class="line">      o[5] = stbi__clamp((x2-t1) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2258"><td class="num" id="LN2258">2258</td><td class="line">      o[3] = stbi__clamp((x3+t0) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2259"><td class="num" id="LN2259">2259</td><td class="line">      o[4] = stbi__clamp((x3-t0) &gt;&gt; 17);</td></tr>
<tr class="codeline" data-linenumber="2260"><td class="num" id="LN2260">2260</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2261"><td class="num" id="LN2261">2261</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2262"><td class="num" id="LN2262">2262</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2263"><td class="num" id="LN2263">2263</td><td class="line"><span class='directive'>#ifdef STBI_SSE2</span></td></tr>
<tr class="codeline" data-linenumber="2264"><td class="num" id="LN2264">2264</td><td class="line"><span class='comment'>// sse2 integer IDCT. not the fastest possible implementation but it</span></td></tr>
<tr class="codeline" data-linenumber="2265"><td class="num" id="LN2265">2265</td><td class="line"><span class='comment'>// produces bit-identical results to the generic C version so it's</span></td></tr>
<tr class="codeline" data-linenumber="2266"><td class="num" id="LN2266">2266</td><td class="line"><span class='comment'>// fully "transparent".</span></td></tr>
<tr class="codeline" data-linenumber="2267"><td class="num" id="LN2267">2267</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__idct_simd(stbi_uc *out, <span class='keyword'>int</span> out_stride, <span class='keyword'>short</span> data[64])</td></tr>
<tr class="codeline" data-linenumber="2268"><td class="num" id="LN2268">2268</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2269"><td class="num" id="LN2269">2269</td><td class="line">   <span class='comment'>// This is constructed to match our regular (generic) integer IDCT exactly.</span></td></tr>
<tr class="codeline" data-linenumber="2270"><td class="num" id="LN2270">2270</td><td class="line">   __m128i row0, row1, row2, row3, row4, row5, row6, row7;</td></tr>
<tr class="codeline" data-linenumber="2271"><td class="num" id="LN2271">2271</td><td class="line">   __m128i tmp;</td></tr>
<tr class="codeline" data-linenumber="2272"><td class="num" id="LN2272">2272</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2273"><td class="num" id="LN2273">2273</td><td class="line">   <span class='comment'>// dot product constant: even elems=x, odd elems=y</span></td></tr>
<tr class="codeline" data-linenumber="2274"><td class="num" id="LN2274">2274</td><td class="line">   <span class='directive'>#define dct_const(x,y)  _mm_setr_epi16((x),(y),(x),(y),(x),(y),(x),(y))</span></td></tr>
<tr class="codeline" data-linenumber="2275"><td class="num" id="LN2275">2275</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2276"><td class="num" id="LN2276">2276</td><td class="line">   <span class='comment'>// out(0) = c0[even]*x + c0[odd]*y   (c0, x, y 16-bit, out 32-bit)</span></td></tr>
<tr class="codeline" data-linenumber="2277"><td class="num" id="LN2277">2277</td><td class="line">   <span class='comment'>// out(1) = c1[even]*x + c1[odd]*y</span></td></tr>
<tr class="codeline" data-linenumber="2278"><td class="num" id="LN2278">2278</td><td class="line">   <span class='directive'>#define dct_rot(out0,out1, x,y,c0,c1) \</span></td></tr>
<tr class="codeline" data-linenumber="2279"><td class="num" id="LN2279">2279</td><td class="line">      <span class='directive'>__m128i c0##lo = _mm_unpacklo_epi16((x),(y)); \</span></td></tr>
<tr class="codeline" data-linenumber="2280"><td class="num" id="LN2280">2280</td><td class="line">      <span class='directive'>__m128i c0##hi = _mm_unpackhi_epi16((x),(y)); \</span></td></tr>
<tr class="codeline" data-linenumber="2281"><td class="num" id="LN2281">2281</td><td class="line">      <span class='directive'>__m128i out0##_l = _mm_madd_epi16(c0##lo, c0); \</span></td></tr>
<tr class="codeline" data-linenumber="2282"><td class="num" id="LN2282">2282</td><td class="line">      <span class='directive'>__m128i out0##_h = _mm_madd_epi16(c0##hi, c0); \</span></td></tr>
<tr class="codeline" data-linenumber="2283"><td class="num" id="LN2283">2283</td><td class="line">      <span class='directive'>__m128i out1##_l = _mm_madd_epi16(c0##lo, c1); \</span></td></tr>
<tr class="codeline" data-linenumber="2284"><td class="num" id="LN2284">2284</td><td class="line">      <span class='directive'>__m128i out1##_h = _mm_madd_epi16(c0##hi, c1)</span></td></tr>
<tr class="codeline" data-linenumber="2285"><td class="num" id="LN2285">2285</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2286"><td class="num" id="LN2286">2286</td><td class="line">   <span class='comment'>// out = in &lt;&lt; 12  (in 16-bit, out 32-bit)</span></td></tr>
<tr class="codeline" data-linenumber="2287"><td class="num" id="LN2287">2287</td><td class="line">   <span class='directive'>#define dct_widen(out, in) \</span></td></tr>
<tr class="codeline" data-linenumber="2288"><td class="num" id="LN2288">2288</td><td class="line">      <span class='directive'>__m128i out##_l = _mm_srai_epi32(_mm_unpacklo_epi16(_mm_setzero_si128(), (in)), 4); \</span></td></tr>
<tr class="codeline" data-linenumber="2289"><td class="num" id="LN2289">2289</td><td class="line">      <span class='directive'>__m128i out##_h = _mm_srai_epi32(_mm_unpackhi_epi16(_mm_setzero_si128(), (in)), 4)</span></td></tr>
<tr class="codeline" data-linenumber="2290"><td class="num" id="LN2290">2290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2291"><td class="num" id="LN2291">2291</td><td class="line">   <span class='comment'>// wide add</span></td></tr>
<tr class="codeline" data-linenumber="2292"><td class="num" id="LN2292">2292</td><td class="line">   <span class='directive'>#define dct_wadd(out, a, b) \</span></td></tr>
<tr class="codeline" data-linenumber="2293"><td class="num" id="LN2293">2293</td><td class="line">      <span class='directive'>__m128i out##_l = _mm_add_epi32(a##_l, b##_l); \</span></td></tr>
<tr class="codeline" data-linenumber="2294"><td class="num" id="LN2294">2294</td><td class="line">      <span class='directive'>__m128i out##_h = _mm_add_epi32(a##_h, b##_h)</span></td></tr>
<tr class="codeline" data-linenumber="2295"><td class="num" id="LN2295">2295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2296"><td class="num" id="LN2296">2296</td><td class="line">   <span class='comment'>// wide sub</span></td></tr>
<tr class="codeline" data-linenumber="2297"><td class="num" id="LN2297">2297</td><td class="line">   <span class='directive'>#define dct_wsub(out, a, b) \</span></td></tr>
<tr class="codeline" data-linenumber="2298"><td class="num" id="LN2298">2298</td><td class="line">      <span class='directive'>__m128i out##_l = _mm_sub_epi32(a##_l, b##_l); \</span></td></tr>
<tr class="codeline" data-linenumber="2299"><td class="num" id="LN2299">2299</td><td class="line">      <span class='directive'>__m128i out##_h = _mm_sub_epi32(a##_h, b##_h)</span></td></tr>
<tr class="codeline" data-linenumber="2300"><td class="num" id="LN2300">2300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2301"><td class="num" id="LN2301">2301</td><td class="line">   <span class='comment'>// butterfly a/b, add bias, then shift by "s" and pack</span></td></tr>
<tr class="codeline" data-linenumber="2302"><td class="num" id="LN2302">2302</td><td class="line">   <span class='directive'>#define dct_bfly32o(out0, out1, a,b,bias,s) \</span></td></tr>
<tr class="codeline" data-linenumber="2303"><td class="num" id="LN2303">2303</td><td class="line">      <span class='directive'>{ \</span></td></tr>
<tr class="codeline" data-linenumber="2304"><td class="num" id="LN2304">2304</td><td class="line">         <span class='directive'>__m128i abiased_l = _mm_add_epi32(a##_l, bias); \</span></td></tr>
<tr class="codeline" data-linenumber="2305"><td class="num" id="LN2305">2305</td><td class="line">         <span class='directive'>__m128i abiased_h = _mm_add_epi32(a##_h, bias); \</span></td></tr>
<tr class="codeline" data-linenumber="2306"><td class="num" id="LN2306">2306</td><td class="line">         <span class='directive'>dct_wadd(sum, abiased, b); \</span></td></tr>
<tr class="codeline" data-linenumber="2307"><td class="num" id="LN2307">2307</td><td class="line">         <span class='directive'>dct_wsub(dif, abiased, b); \</span></td></tr>
<tr class="codeline" data-linenumber="2308"><td class="num" id="LN2308">2308</td><td class="line">         <span class='directive'>out0 = _mm_packs_epi32(_mm_srai_epi32(sum_l, s), _mm_srai_epi32(sum_h, s)); \</span></td></tr>
<tr class="codeline" data-linenumber="2309"><td class="num" id="LN2309">2309</td><td class="line">         <span class='directive'>out1 = _mm_packs_epi32(_mm_srai_epi32(dif_l, s), _mm_srai_epi32(dif_h, s)); \</span></td></tr>
<tr class="codeline" data-linenumber="2310"><td class="num" id="LN2310">2310</td><td class="line">      <span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="2311"><td class="num" id="LN2311">2311</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2312"><td class="num" id="LN2312">2312</td><td class="line">   <span class='comment'>// 8-bit interleave step (for transposes)</span></td></tr>
<tr class="codeline" data-linenumber="2313"><td class="num" id="LN2313">2313</td><td class="line">   <span class='directive'>#define dct_interleave8(a, b) \</span></td></tr>
<tr class="codeline" data-linenumber="2314"><td class="num" id="LN2314">2314</td><td class="line">      <span class='directive'>tmp = a; \</span></td></tr>
<tr class="codeline" data-linenumber="2315"><td class="num" id="LN2315">2315</td><td class="line">      <span class='directive'>a = _mm_unpacklo_epi8(a, b); \</span></td></tr>
<tr class="codeline" data-linenumber="2316"><td class="num" id="LN2316">2316</td><td class="line">      <span class='directive'>b = _mm_unpackhi_epi8(tmp, b)</span></td></tr>
<tr class="codeline" data-linenumber="2317"><td class="num" id="LN2317">2317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2318"><td class="num" id="LN2318">2318</td><td class="line">   <span class='comment'>// 16-bit interleave step (for transposes)</span></td></tr>
<tr class="codeline" data-linenumber="2319"><td class="num" id="LN2319">2319</td><td class="line">   <span class='directive'>#define dct_interleave16(a, b) \</span></td></tr>
<tr class="codeline" data-linenumber="2320"><td class="num" id="LN2320">2320</td><td class="line">      <span class='directive'>tmp = a; \</span></td></tr>
<tr class="codeline" data-linenumber="2321"><td class="num" id="LN2321">2321</td><td class="line">      <span class='directive'>a = _mm_unpacklo_epi16(a, b); \</span></td></tr>
<tr class="codeline" data-linenumber="2322"><td class="num" id="LN2322">2322</td><td class="line">      <span class='directive'>b = _mm_unpackhi_epi16(tmp, b)</span></td></tr>
<tr class="codeline" data-linenumber="2323"><td class="num" id="LN2323">2323</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2324"><td class="num" id="LN2324">2324</td><td class="line">   <span class='directive'>#define dct_pass(bias,shift) \</span></td></tr>
<tr class="codeline" data-linenumber="2325"><td class="num" id="LN2325">2325</td><td class="line">      <span class='directive'>{ \</span></td></tr>
<tr class="codeline" data-linenumber="2326"><td class="num" id="LN2326">2326</td><td class="line">         <span class='directive'>/* even part */ \</span></td></tr>
<tr class="codeline" data-linenumber="2327"><td class="num" id="LN2327">2327</td><td class="line">         <span class='directive'>dct_rot(t2e,t3e, row2,row6, rot0_0,rot0_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2328"><td class="num" id="LN2328">2328</td><td class="line">         <span class='directive'>__m128i sum04 = _mm_add_epi16(row0, row4); \</span></td></tr>
<tr class="codeline" data-linenumber="2329"><td class="num" id="LN2329">2329</td><td class="line">         <span class='directive'>__m128i dif04 = _mm_sub_epi16(row0, row4); \</span></td></tr>
<tr class="codeline" data-linenumber="2330"><td class="num" id="LN2330">2330</td><td class="line">         <span class='directive'>dct_widen(t0e, sum04); \</span></td></tr>
<tr class="codeline" data-linenumber="2331"><td class="num" id="LN2331">2331</td><td class="line">         <span class='directive'>dct_widen(t1e, dif04); \</span></td></tr>
<tr class="codeline" data-linenumber="2332"><td class="num" id="LN2332">2332</td><td class="line">         <span class='directive'>dct_wadd(x0, t0e, t3e); \</span></td></tr>
<tr class="codeline" data-linenumber="2333"><td class="num" id="LN2333">2333</td><td class="line">         <span class='directive'>dct_wsub(x3, t0e, t3e); \</span></td></tr>
<tr class="codeline" data-linenumber="2334"><td class="num" id="LN2334">2334</td><td class="line">         <span class='directive'>dct_wadd(x1, t1e, t2e); \</span></td></tr>
<tr class="codeline" data-linenumber="2335"><td class="num" id="LN2335">2335</td><td class="line">         <span class='directive'>dct_wsub(x2, t1e, t2e); \</span></td></tr>
<tr class="codeline" data-linenumber="2336"><td class="num" id="LN2336">2336</td><td class="line">         <span class='directive'>/* odd part */ \</span></td></tr>
<tr class="codeline" data-linenumber="2337"><td class="num" id="LN2337">2337</td><td class="line">         <span class='directive'>dct_rot(y0o,y2o, row7,row3, rot2_0,rot2_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2338"><td class="num" id="LN2338">2338</td><td class="line">         <span class='directive'>dct_rot(y1o,y3o, row5,row1, rot3_0,rot3_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2339"><td class="num" id="LN2339">2339</td><td class="line">         <span class='directive'>__m128i sum17 = _mm_add_epi16(row1, row7); \</span></td></tr>
<tr class="codeline" data-linenumber="2340"><td class="num" id="LN2340">2340</td><td class="line">         <span class='directive'>__m128i sum35 = _mm_add_epi16(row3, row5); \</span></td></tr>
<tr class="codeline" data-linenumber="2341"><td class="num" id="LN2341">2341</td><td class="line">         <span class='directive'>dct_rot(y4o,y5o, sum17,sum35, rot1_0,rot1_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2342"><td class="num" id="LN2342">2342</td><td class="line">         <span class='directive'>dct_wadd(x4, y0o, y4o); \</span></td></tr>
<tr class="codeline" data-linenumber="2343"><td class="num" id="LN2343">2343</td><td class="line">         <span class='directive'>dct_wadd(x5, y1o, y5o); \</span></td></tr>
<tr class="codeline" data-linenumber="2344"><td class="num" id="LN2344">2344</td><td class="line">         <span class='directive'>dct_wadd(x6, y2o, y5o); \</span></td></tr>
<tr class="codeline" data-linenumber="2345"><td class="num" id="LN2345">2345</td><td class="line">         <span class='directive'>dct_wadd(x7, y3o, y4o); \</span></td></tr>
<tr class="codeline" data-linenumber="2346"><td class="num" id="LN2346">2346</td><td class="line">         <span class='directive'>dct_bfly32o(row0,row7, x0,x7,bias,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2347"><td class="num" id="LN2347">2347</td><td class="line">         <span class='directive'>dct_bfly32o(row1,row6, x1,x6,bias,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2348"><td class="num" id="LN2348">2348</td><td class="line">         <span class='directive'>dct_bfly32o(row2,row5, x2,x5,bias,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2349"><td class="num" id="LN2349">2349</td><td class="line">         <span class='directive'>dct_bfly32o(row3,row4, x3,x4,bias,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2350"><td class="num" id="LN2350">2350</td><td class="line">      <span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="2351"><td class="num" id="LN2351">2351</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2352"><td class="num" id="LN2352">2352</td><td class="line">   __m128i rot0_0 = dct_const(<span class='macro'>stbi__f2f(0.5411961f)<span class='macro_popup'>((int) (((0.5411961f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(0.5411961f)<span class='macro_popup'>((int) (((0.5411961f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f(-1.847759065f)<span class='macro_popup'>((int) (((-1.847759065f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2353"><td class="num" id="LN2353">2353</td><td class="line">   __m128i rot0_1 = dct_const(<span class='macro'>stbi__f2f(0.5411961f)<span class='macro_popup'>((int) (((0.5411961f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f( 0.765366865f)<span class='macro_popup'>((int) (((0.765366865f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(0.5411961f)<span class='macro_popup'>((int) (((0.5411961f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2354"><td class="num" id="LN2354">2354</td><td class="line">   __m128i rot1_0 = dct_const(<span class='macro'>stbi__f2f(1.175875602f)<span class='macro_popup'>((int) (((1.175875602f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f(-0.899976223f)<span class='macro_popup'>((int) (((-0.899976223f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(1.175875602f)<span class='macro_popup'>((int) (((1.175875602f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2355"><td class="num" id="LN2355">2355</td><td class="line">   __m128i rot1_1 = dct_const(<span class='macro'>stbi__f2f(1.175875602f)<span class='macro_popup'>((int) (((1.175875602f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(1.175875602f)<span class='macro_popup'>((int) (((1.175875602f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f(-2.562915447f)<span class='macro_popup'>((int) (((-2.562915447f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2356"><td class="num" id="LN2356">2356</td><td class="line">   __m128i rot2_0 = dct_const(<span class='macro'>stbi__f2f(-1.961570560f)<span class='macro_popup'>((int) (((-1.961570560f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f( 0.298631336f)<span class='macro_popup'>((int) (((0.298631336f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(-1.961570560f)<span class='macro_popup'>((int) (((-1.961570560f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2357"><td class="num" id="LN2357">2357</td><td class="line">   __m128i rot2_1 = dct_const(<span class='macro'>stbi__f2f(-1.961570560f)<span class='macro_popup'>((int) (((-1.961570560f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(-1.961570560f)<span class='macro_popup'>((int) (((-1.961570560f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f( 3.072711026f)<span class='macro_popup'>((int) (((3.072711026f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2358"><td class="num" id="LN2358">2358</td><td class="line">   __m128i rot3_0 = dct_const(<span class='macro'>stbi__f2f(-0.390180644f)<span class='macro_popup'>((int) (((-0.390180644f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f( 2.053119869f)<span class='macro_popup'>((int) (((2.053119869f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(-0.390180644f)<span class='macro_popup'>((int) (((-0.390180644f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2359"><td class="num" id="LN2359">2359</td><td class="line">   __m128i rot3_1 = dct_const(<span class='macro'>stbi__f2f(-0.390180644f)<span class='macro_popup'>((int) (((-0.390180644f) * 4096 + 0.5)))</span></span>, <span class='macro'>stbi__f2f(-0.390180644f)<span class='macro_popup'>((int) (((-0.390180644f) * 4096 + 0.5)))</span></span> + <span class='macro'>stbi__f2f( 1.501321110f)<span class='macro_popup'>((int) (((1.501321110f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2360"><td class="num" id="LN2360">2360</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2361"><td class="num" id="LN2361">2361</td><td class="line">   <span class='comment'>// rounding biases in column/row passes, see stbi__idct_block for explanation.</span></td></tr>
<tr class="codeline" data-linenumber="2362"><td class="num" id="LN2362">2362</td><td class="line">   __m128i bias_0 = _mm_set1_epi32(512);</td></tr>
<tr class="codeline" data-linenumber="2363"><td class="num" id="LN2363">2363</td><td class="line">   __m128i bias_1 = _mm_set1_epi32(65536 + (128&lt;&lt;17));</td></tr>
<tr class="codeline" data-linenumber="2364"><td class="num" id="LN2364">2364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2365"><td class="num" id="LN2365">2365</td><td class="line">   <span class='comment'>// load</span></td></tr>
<tr class="codeline" data-linenumber="2366"><td class="num" id="LN2366">2366</td><td class="line">   row0 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 0*8));</td></tr>
<tr class="codeline" data-linenumber="2367"><td class="num" id="LN2367">2367</td><td class="line">   row1 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 1*8));</td></tr>
<tr class="codeline" data-linenumber="2368"><td class="num" id="LN2368">2368</td><td class="line">   row2 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 2*8));</td></tr>
<tr class="codeline" data-linenumber="2369"><td class="num" id="LN2369">2369</td><td class="line">   row3 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 3*8));</td></tr>
<tr class="codeline" data-linenumber="2370"><td class="num" id="LN2370">2370</td><td class="line">   row4 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 4*8));</td></tr>
<tr class="codeline" data-linenumber="2371"><td class="num" id="LN2371">2371</td><td class="line">   row5 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 5*8));</td></tr>
<tr class="codeline" data-linenumber="2372"><td class="num" id="LN2372">2372</td><td class="line">   row6 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 6*8));</td></tr>
<tr class="codeline" data-linenumber="2373"><td class="num" id="LN2373">2373</td><td class="line">   row7 = _mm_load_si128((<span class='keyword'>const</span> __m128i *) (data + 7*8));</td></tr>
<tr class="codeline" data-linenumber="2374"><td class="num" id="LN2374">2374</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2375"><td class="num" id="LN2375">2375</td><td class="line">   <span class='comment'>// column pass</span></td></tr>
<tr class="codeline" data-linenumber="2376"><td class="num" id="LN2376">2376</td><td class="line">   dct_pass(bias_0, 10);</td></tr>
<tr class="codeline" data-linenumber="2377"><td class="num" id="LN2377">2377</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2378"><td class="num" id="LN2378">2378</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="2379"><td class="num" id="LN2379">2379</td><td class="line">      <span class='comment'>// 16bit 8x8 transpose pass 1</span></td></tr>
<tr class="codeline" data-linenumber="2380"><td class="num" id="LN2380">2380</td><td class="line">      dct_interleave16(row0, row4);</td></tr>
<tr class="codeline" data-linenumber="2381"><td class="num" id="LN2381">2381</td><td class="line">      dct_interleave16(row1, row5);</td></tr>
<tr class="codeline" data-linenumber="2382"><td class="num" id="LN2382">2382</td><td class="line">      dct_interleave16(row2, row6);</td></tr>
<tr class="codeline" data-linenumber="2383"><td class="num" id="LN2383">2383</td><td class="line">      dct_interleave16(row3, row7);</td></tr>
<tr class="codeline" data-linenumber="2384"><td class="num" id="LN2384">2384</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2385"><td class="num" id="LN2385">2385</td><td class="line">      <span class='comment'>// transpose pass 2</span></td></tr>
<tr class="codeline" data-linenumber="2386"><td class="num" id="LN2386">2386</td><td class="line">      dct_interleave16(row0, row2);</td></tr>
<tr class="codeline" data-linenumber="2387"><td class="num" id="LN2387">2387</td><td class="line">      dct_interleave16(row1, row3);</td></tr>
<tr class="codeline" data-linenumber="2388"><td class="num" id="LN2388">2388</td><td class="line">      dct_interleave16(row4, row6);</td></tr>
<tr class="codeline" data-linenumber="2389"><td class="num" id="LN2389">2389</td><td class="line">      dct_interleave16(row5, row7);</td></tr>
<tr class="codeline" data-linenumber="2390"><td class="num" id="LN2390">2390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2391"><td class="num" id="LN2391">2391</td><td class="line">      <span class='comment'>// transpose pass 3</span></td></tr>
<tr class="codeline" data-linenumber="2392"><td class="num" id="LN2392">2392</td><td class="line">      dct_interleave16(row0, row1);</td></tr>
<tr class="codeline" data-linenumber="2393"><td class="num" id="LN2393">2393</td><td class="line">      dct_interleave16(row2, row3);</td></tr>
<tr class="codeline" data-linenumber="2394"><td class="num" id="LN2394">2394</td><td class="line">      dct_interleave16(row4, row5);</td></tr>
<tr class="codeline" data-linenumber="2395"><td class="num" id="LN2395">2395</td><td class="line">      dct_interleave16(row6, row7);</td></tr>
<tr class="codeline" data-linenumber="2396"><td class="num" id="LN2396">2396</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2397"><td class="num" id="LN2397">2397</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2398"><td class="num" id="LN2398">2398</td><td class="line">   <span class='comment'>// row pass</span></td></tr>
<tr class="codeline" data-linenumber="2399"><td class="num" id="LN2399">2399</td><td class="line">   dct_pass(bias_1, 17);</td></tr>
<tr class="codeline" data-linenumber="2400"><td class="num" id="LN2400">2400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2401"><td class="num" id="LN2401">2401</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="2402"><td class="num" id="LN2402">2402</td><td class="line">      <span class='comment'>// pack</span></td></tr>
<tr class="codeline" data-linenumber="2403"><td class="num" id="LN2403">2403</td><td class="line">      __m128i p0 = _mm_packus_epi16(row0, row1); <span class='comment'>// a0a1a2a3...a7b0b1b2b3...b7</span></td></tr>
<tr class="codeline" data-linenumber="2404"><td class="num" id="LN2404">2404</td><td class="line">      __m128i p1 = _mm_packus_epi16(row2, row3);</td></tr>
<tr class="codeline" data-linenumber="2405"><td class="num" id="LN2405">2405</td><td class="line">      __m128i p2 = _mm_packus_epi16(row4, row5);</td></tr>
<tr class="codeline" data-linenumber="2406"><td class="num" id="LN2406">2406</td><td class="line">      __m128i p3 = _mm_packus_epi16(row6, row7);</td></tr>
<tr class="codeline" data-linenumber="2407"><td class="num" id="LN2407">2407</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2408"><td class="num" id="LN2408">2408</td><td class="line">      <span class='comment'>// 8bit 8x8 transpose pass 1</span></td></tr>
<tr class="codeline" data-linenumber="2409"><td class="num" id="LN2409">2409</td><td class="line">      dct_interleave8(p0, p2); <span class='comment'>// a0e0a1e1...</span></td></tr>
<tr class="codeline" data-linenumber="2410"><td class="num" id="LN2410">2410</td><td class="line">      dct_interleave8(p1, p3); <span class='comment'>// c0g0c1g1...</span></td></tr>
<tr class="codeline" data-linenumber="2411"><td class="num" id="LN2411">2411</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2412"><td class="num" id="LN2412">2412</td><td class="line">      <span class='comment'>// transpose pass 2</span></td></tr>
<tr class="codeline" data-linenumber="2413"><td class="num" id="LN2413">2413</td><td class="line">      dct_interleave8(p0, p1); <span class='comment'>// a0c0e0g0...</span></td></tr>
<tr class="codeline" data-linenumber="2414"><td class="num" id="LN2414">2414</td><td class="line">      dct_interleave8(p2, p3); <span class='comment'>// b0d0f0h0...</span></td></tr>
<tr class="codeline" data-linenumber="2415"><td class="num" id="LN2415">2415</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2416"><td class="num" id="LN2416">2416</td><td class="line">      <span class='comment'>// transpose pass 3</span></td></tr>
<tr class="codeline" data-linenumber="2417"><td class="num" id="LN2417">2417</td><td class="line">      dct_interleave8(p0, p2); <span class='comment'>// a0b0c0d0...</span></td></tr>
<tr class="codeline" data-linenumber="2418"><td class="num" id="LN2418">2418</td><td class="line">      dct_interleave8(p1, p3); <span class='comment'>// a4b4c4d4...</span></td></tr>
<tr class="codeline" data-linenumber="2419"><td class="num" id="LN2419">2419</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2420"><td class="num" id="LN2420">2420</td><td class="line">      <span class='comment'>// store</span></td></tr>
<tr class="codeline" data-linenumber="2421"><td class="num" id="LN2421">2421</td><td class="line">      _mm_storel_epi64((__m128i *) out, p0); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2422"><td class="num" id="LN2422">2422</td><td class="line">      _mm_storel_epi64((__m128i *) out, <span class='macro'>_mm_shuffle_epi32(p0, 0x4e)<span class='macro_popup'>(__m128i)__builtin_ia32_pshufd((__v4si)(__m128i)(p0), (int)(0x4e<br>))</span></span>); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2423"><td class="num" id="LN2423">2423</td><td class="line">      _mm_storel_epi64((__m128i *) out, p2); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2424"><td class="num" id="LN2424">2424</td><td class="line">      _mm_storel_epi64((__m128i *) out, <span class='macro'>_mm_shuffle_epi32(p2, 0x4e)<span class='macro_popup'>(__m128i)__builtin_ia32_pshufd((__v4si)(__m128i)(p2), (int)(0x4e<br>))</span></span>); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2425"><td class="num" id="LN2425">2425</td><td class="line">      _mm_storel_epi64((__m128i *) out, p1); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2426"><td class="num" id="LN2426">2426</td><td class="line">      _mm_storel_epi64((__m128i *) out, <span class='macro'>_mm_shuffle_epi32(p1, 0x4e)<span class='macro_popup'>(__m128i)__builtin_ia32_pshufd((__v4si)(__m128i)(p1), (int)(0x4e<br>))</span></span>); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2427"><td class="num" id="LN2427">2427</td><td class="line">      _mm_storel_epi64((__m128i *) out, p3); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2428"><td class="num" id="LN2428">2428</td><td class="line">      _mm_storel_epi64((__m128i *) out, <span class='macro'>_mm_shuffle_epi32(p3, 0x4e)<span class='macro_popup'>(__m128i)__builtin_ia32_pshufd((__v4si)(__m128i)(p3), (int)(0x4e<br>))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2429"><td class="num" id="LN2429">2429</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2430"><td class="num" id="LN2430">2430</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2431"><td class="num" id="LN2431">2431</td><td class="line"><span class='directive'>#undef dct_const</span></td></tr>
<tr class="codeline" data-linenumber="2432"><td class="num" id="LN2432">2432</td><td class="line"><span class='directive'>#undef dct_rot</span></td></tr>
<tr class="codeline" data-linenumber="2433"><td class="num" id="LN2433">2433</td><td class="line"><span class='directive'>#undef dct_widen</span></td></tr>
<tr class="codeline" data-linenumber="2434"><td class="num" id="LN2434">2434</td><td class="line"><span class='directive'>#undef dct_wadd</span></td></tr>
<tr class="codeline" data-linenumber="2435"><td class="num" id="LN2435">2435</td><td class="line"><span class='directive'>#undef dct_wsub</span></td></tr>
<tr class="codeline" data-linenumber="2436"><td class="num" id="LN2436">2436</td><td class="line"><span class='directive'>#undef dct_bfly32o</span></td></tr>
<tr class="codeline" data-linenumber="2437"><td class="num" id="LN2437">2437</td><td class="line"><span class='directive'>#undef dct_interleave8</span></td></tr>
<tr class="codeline" data-linenumber="2438"><td class="num" id="LN2438">2438</td><td class="line"><span class='directive'>#undef dct_interleave16</span></td></tr>
<tr class="codeline" data-linenumber="2439"><td class="num" id="LN2439">2439</td><td class="line"><span class='directive'>#undef dct_pass</span></td></tr>
<tr class="codeline" data-linenumber="2440"><td class="num" id="LN2440">2440</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2441"><td class="num" id="LN2441">2441</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2442"><td class="num" id="LN2442">2442</td><td class="line"><span class='directive'>#endif // STBI_SSE2</span></td></tr>
<tr class="codeline" data-linenumber="2443"><td class="num" id="LN2443">2443</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2444"><td class="num" id="LN2444">2444</td><td class="line"><span class='directive'>#ifdef STBI_NEON</span></td></tr>
<tr class="codeline" data-linenumber="2445"><td class="num" id="LN2445">2445</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2446"><td class="num" id="LN2446">2446</td><td class="line"><span class='comment'>// NEON integer IDCT. should produce bit-identical</span></td></tr>
<tr class="codeline" data-linenumber="2447"><td class="num" id="LN2447">2447</td><td class="line"><span class='comment'>// results to the generic C version.</span></td></tr>
<tr class="codeline" data-linenumber="2448"><td class="num" id="LN2448">2448</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__idct_simd(stbi_uc *out, <span class='keyword'>int</span> out_stride, <span class='keyword'>short</span> data[64])</td></tr>
<tr class="codeline" data-linenumber="2449"><td class="num" id="LN2449">2449</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2450"><td class="num" id="LN2450">2450</td><td class="line">   int16x8_t row0, row1, row2, row3, row4, row5, row6, row7;</td></tr>
<tr class="codeline" data-linenumber="2451"><td class="num" id="LN2451">2451</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2452"><td class="num" id="LN2452">2452</td><td class="line">   int16x4_t rot0_0 = vdup_n_s16(<span class='macro'>stbi__f2f(0.5411961f)<span class='macro_popup'>((int) (((0.5411961f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2453"><td class="num" id="LN2453">2453</td><td class="line">   int16x4_t rot0_1 = vdup_n_s16(<span class='macro'>stbi__f2f(-1.847759065f)<span class='macro_popup'>((int) (((-1.847759065f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2454"><td class="num" id="LN2454">2454</td><td class="line">   int16x4_t rot0_2 = vdup_n_s16(<span class='macro'>stbi__f2f( 0.765366865f)<span class='macro_popup'>((int) (((0.765366865f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2455"><td class="num" id="LN2455">2455</td><td class="line">   int16x4_t rot1_0 = vdup_n_s16(<span class='macro'>stbi__f2f( 1.175875602f)<span class='macro_popup'>((int) (((1.175875602f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2456"><td class="num" id="LN2456">2456</td><td class="line">   int16x4_t rot1_1 = vdup_n_s16(<span class='macro'>stbi__f2f(-0.899976223f)<span class='macro_popup'>((int) (((-0.899976223f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2457"><td class="num" id="LN2457">2457</td><td class="line">   int16x4_t rot1_2 = vdup_n_s16(<span class='macro'>stbi__f2f(-2.562915447f)<span class='macro_popup'>((int) (((-2.562915447f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2458"><td class="num" id="LN2458">2458</td><td class="line">   int16x4_t rot2_0 = vdup_n_s16(<span class='macro'>stbi__f2f(-1.961570560f)<span class='macro_popup'>((int) (((-1.961570560f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2459"><td class="num" id="LN2459">2459</td><td class="line">   int16x4_t rot2_1 = vdup_n_s16(<span class='macro'>stbi__f2f(-0.390180644f)<span class='macro_popup'>((int) (((-0.390180644f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2460"><td class="num" id="LN2460">2460</td><td class="line">   int16x4_t rot3_0 = vdup_n_s16(<span class='macro'>stbi__f2f( 0.298631336f)<span class='macro_popup'>((int) (((0.298631336f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2461"><td class="num" id="LN2461">2461</td><td class="line">   int16x4_t rot3_1 = vdup_n_s16(<span class='macro'>stbi__f2f( 2.053119869f)<span class='macro_popup'>((int) (((2.053119869f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2462"><td class="num" id="LN2462">2462</td><td class="line">   int16x4_t rot3_2 = vdup_n_s16(<span class='macro'>stbi__f2f( 3.072711026f)<span class='macro_popup'>((int) (((3.072711026f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2463"><td class="num" id="LN2463">2463</td><td class="line">   int16x4_t rot3_3 = vdup_n_s16(<span class='macro'>stbi__f2f( 1.501321110f)<span class='macro_popup'>((int) (((1.501321110f) * 4096 + 0.5)))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2464"><td class="num" id="LN2464">2464</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2465"><td class="num" id="LN2465">2465</td><td class="line"><span class='directive'>#define dct_long_mul(out, inq, coeff) \</span></td></tr>
<tr class="codeline" data-linenumber="2466"><td class="num" id="LN2466">2466</td><td class="line">   <span class='directive'>int32x4_t out##_l = vmull_s16(vget_low_s16(inq), coeff); \</span></td></tr>
<tr class="codeline" data-linenumber="2467"><td class="num" id="LN2467">2467</td><td class="line">   <span class='directive'>int32x4_t out##_h = vmull_s16(vget_high_s16(inq), coeff)</span></td></tr>
<tr class="codeline" data-linenumber="2468"><td class="num" id="LN2468">2468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2469"><td class="num" id="LN2469">2469</td><td class="line"><span class='directive'>#define dct_long_mac(out, acc, inq, coeff) \</span></td></tr>
<tr class="codeline" data-linenumber="2470"><td class="num" id="LN2470">2470</td><td class="line">   <span class='directive'>int32x4_t out##_l = vmlal_s16(acc##_l, vget_low_s16(inq), coeff); \</span></td></tr>
<tr class="codeline" data-linenumber="2471"><td class="num" id="LN2471">2471</td><td class="line">   <span class='directive'>int32x4_t out##_h = vmlal_s16(acc##_h, vget_high_s16(inq), coeff)</span></td></tr>
<tr class="codeline" data-linenumber="2472"><td class="num" id="LN2472">2472</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2473"><td class="num" id="LN2473">2473</td><td class="line"><span class='directive'>#define dct_widen(out, inq) \</span></td></tr>
<tr class="codeline" data-linenumber="2474"><td class="num" id="LN2474">2474</td><td class="line">   <span class='directive'>int32x4_t out##_l = vshll_n_s16(vget_low_s16(inq), 12); \</span></td></tr>
<tr class="codeline" data-linenumber="2475"><td class="num" id="LN2475">2475</td><td class="line">   <span class='directive'>int32x4_t out##_h = vshll_n_s16(vget_high_s16(inq), 12)</span></td></tr>
<tr class="codeline" data-linenumber="2476"><td class="num" id="LN2476">2476</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2477"><td class="num" id="LN2477">2477</td><td class="line"><span class='comment'>// wide add</span></td></tr>
<tr class="codeline" data-linenumber="2478"><td class="num" id="LN2478">2478</td><td class="line"><span class='directive'>#define dct_wadd(out, a, b) \</span></td></tr>
<tr class="codeline" data-linenumber="2479"><td class="num" id="LN2479">2479</td><td class="line">   <span class='directive'>int32x4_t out##_l = vaddq_s32(a##_l, b##_l); \</span></td></tr>
<tr class="codeline" data-linenumber="2480"><td class="num" id="LN2480">2480</td><td class="line">   <span class='directive'>int32x4_t out##_h = vaddq_s32(a##_h, b##_h)</span></td></tr>
<tr class="codeline" data-linenumber="2481"><td class="num" id="LN2481">2481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2482"><td class="num" id="LN2482">2482</td><td class="line"><span class='comment'>// wide sub</span></td></tr>
<tr class="codeline" data-linenumber="2483"><td class="num" id="LN2483">2483</td><td class="line"><span class='directive'>#define dct_wsub(out, a, b) \</span></td></tr>
<tr class="codeline" data-linenumber="2484"><td class="num" id="LN2484">2484</td><td class="line">   <span class='directive'>int32x4_t out##_l = vsubq_s32(a##_l, b##_l); \</span></td></tr>
<tr class="codeline" data-linenumber="2485"><td class="num" id="LN2485">2485</td><td class="line">   <span class='directive'>int32x4_t out##_h = vsubq_s32(a##_h, b##_h)</span></td></tr>
<tr class="codeline" data-linenumber="2486"><td class="num" id="LN2486">2486</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2487"><td class="num" id="LN2487">2487</td><td class="line"><span class='comment'>// butterfly a/b, then shift using "shiftop" by "s" and pack</span></td></tr>
<tr class="codeline" data-linenumber="2488"><td class="num" id="LN2488">2488</td><td class="line"><span class='directive'>#define dct_bfly32o(out0,out1, a,b,shiftop,s) \</span></td></tr>
<tr class="codeline" data-linenumber="2489"><td class="num" id="LN2489">2489</td><td class="line">   <span class='directive'>{ \</span></td></tr>
<tr class="codeline" data-linenumber="2490"><td class="num" id="LN2490">2490</td><td class="line">      <span class='directive'>dct_wadd(sum, a, b); \</span></td></tr>
<tr class="codeline" data-linenumber="2491"><td class="num" id="LN2491">2491</td><td class="line">      <span class='directive'>dct_wsub(dif, a, b); \</span></td></tr>
<tr class="codeline" data-linenumber="2492"><td class="num" id="LN2492">2492</td><td class="line">      <span class='directive'>out0 = vcombine_s16(shiftop(sum_l, s), shiftop(sum_h, s)); \</span></td></tr>
<tr class="codeline" data-linenumber="2493"><td class="num" id="LN2493">2493</td><td class="line">      <span class='directive'>out1 = vcombine_s16(shiftop(dif_l, s), shiftop(dif_h, s)); \</span></td></tr>
<tr class="codeline" data-linenumber="2494"><td class="num" id="LN2494">2494</td><td class="line">   <span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="2495"><td class="num" id="LN2495">2495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2496"><td class="num" id="LN2496">2496</td><td class="line"><span class='directive'>#define dct_pass(shiftop, shift) \</span></td></tr>
<tr class="codeline" data-linenumber="2497"><td class="num" id="LN2497">2497</td><td class="line">   <span class='directive'>{ \</span></td></tr>
<tr class="codeline" data-linenumber="2498"><td class="num" id="LN2498">2498</td><td class="line">      <span class='directive'>/* even part */ \</span></td></tr>
<tr class="codeline" data-linenumber="2499"><td class="num" id="LN2499">2499</td><td class="line">      <span class='directive'>int16x8_t sum26 = vaddq_s16(row2, row6); \</span></td></tr>
<tr class="codeline" data-linenumber="2500"><td class="num" id="LN2500">2500</td><td class="line">      <span class='directive'>dct_long_mul(p1e, sum26, rot0_0); \</span></td></tr>
<tr class="codeline" data-linenumber="2501"><td class="num" id="LN2501">2501</td><td class="line">      <span class='directive'>dct_long_mac(t2e, p1e, row6, rot0_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2502"><td class="num" id="LN2502">2502</td><td class="line">      <span class='directive'>dct_long_mac(t3e, p1e, row2, rot0_2); \</span></td></tr>
<tr class="codeline" data-linenumber="2503"><td class="num" id="LN2503">2503</td><td class="line">      <span class='directive'>int16x8_t sum04 = vaddq_s16(row0, row4); \</span></td></tr>
<tr class="codeline" data-linenumber="2504"><td class="num" id="LN2504">2504</td><td class="line">      <span class='directive'>int16x8_t dif04 = vsubq_s16(row0, row4); \</span></td></tr>
<tr class="codeline" data-linenumber="2505"><td class="num" id="LN2505">2505</td><td class="line">      <span class='directive'>dct_widen(t0e, sum04); \</span></td></tr>
<tr class="codeline" data-linenumber="2506"><td class="num" id="LN2506">2506</td><td class="line">      <span class='directive'>dct_widen(t1e, dif04); \</span></td></tr>
<tr class="codeline" data-linenumber="2507"><td class="num" id="LN2507">2507</td><td class="line">      <span class='directive'>dct_wadd(x0, t0e, t3e); \</span></td></tr>
<tr class="codeline" data-linenumber="2508"><td class="num" id="LN2508">2508</td><td class="line">      <span class='directive'>dct_wsub(x3, t0e, t3e); \</span></td></tr>
<tr class="codeline" data-linenumber="2509"><td class="num" id="LN2509">2509</td><td class="line">      <span class='directive'>dct_wadd(x1, t1e, t2e); \</span></td></tr>
<tr class="codeline" data-linenumber="2510"><td class="num" id="LN2510">2510</td><td class="line">      <span class='directive'>dct_wsub(x2, t1e, t2e); \</span></td></tr>
<tr class="codeline" data-linenumber="2511"><td class="num" id="LN2511">2511</td><td class="line">      <span class='directive'>/* odd part */ \</span></td></tr>
<tr class="codeline" data-linenumber="2512"><td class="num" id="LN2512">2512</td><td class="line">      <span class='directive'>int16x8_t sum15 = vaddq_s16(row1, row5); \</span></td></tr>
<tr class="codeline" data-linenumber="2513"><td class="num" id="LN2513">2513</td><td class="line">      <span class='directive'>int16x8_t sum17 = vaddq_s16(row1, row7); \</span></td></tr>
<tr class="codeline" data-linenumber="2514"><td class="num" id="LN2514">2514</td><td class="line">      <span class='directive'>int16x8_t sum35 = vaddq_s16(row3, row5); \</span></td></tr>
<tr class="codeline" data-linenumber="2515"><td class="num" id="LN2515">2515</td><td class="line">      <span class='directive'>int16x8_t sum37 = vaddq_s16(row3, row7); \</span></td></tr>
<tr class="codeline" data-linenumber="2516"><td class="num" id="LN2516">2516</td><td class="line">      <span class='directive'>int16x8_t sumodd = vaddq_s16(sum17, sum35); \</span></td></tr>
<tr class="codeline" data-linenumber="2517"><td class="num" id="LN2517">2517</td><td class="line">      <span class='directive'>dct_long_mul(p5o, sumodd, rot1_0); \</span></td></tr>
<tr class="codeline" data-linenumber="2518"><td class="num" id="LN2518">2518</td><td class="line">      <span class='directive'>dct_long_mac(p1o, p5o, sum17, rot1_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2519"><td class="num" id="LN2519">2519</td><td class="line">      <span class='directive'>dct_long_mac(p2o, p5o, sum35, rot1_2); \</span></td></tr>
<tr class="codeline" data-linenumber="2520"><td class="num" id="LN2520">2520</td><td class="line">      <span class='directive'>dct_long_mul(p3o, sum37, rot2_0); \</span></td></tr>
<tr class="codeline" data-linenumber="2521"><td class="num" id="LN2521">2521</td><td class="line">      <span class='directive'>dct_long_mul(p4o, sum15, rot2_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2522"><td class="num" id="LN2522">2522</td><td class="line">      <span class='directive'>dct_wadd(sump13o, p1o, p3o); \</span></td></tr>
<tr class="codeline" data-linenumber="2523"><td class="num" id="LN2523">2523</td><td class="line">      <span class='directive'>dct_wadd(sump24o, p2o, p4o); \</span></td></tr>
<tr class="codeline" data-linenumber="2524"><td class="num" id="LN2524">2524</td><td class="line">      <span class='directive'>dct_wadd(sump23o, p2o, p3o); \</span></td></tr>
<tr class="codeline" data-linenumber="2525"><td class="num" id="LN2525">2525</td><td class="line">      <span class='directive'>dct_wadd(sump14o, p1o, p4o); \</span></td></tr>
<tr class="codeline" data-linenumber="2526"><td class="num" id="LN2526">2526</td><td class="line">      <span class='directive'>dct_long_mac(x4, sump13o, row7, rot3_0); \</span></td></tr>
<tr class="codeline" data-linenumber="2527"><td class="num" id="LN2527">2527</td><td class="line">      <span class='directive'>dct_long_mac(x5, sump24o, row5, rot3_1); \</span></td></tr>
<tr class="codeline" data-linenumber="2528"><td class="num" id="LN2528">2528</td><td class="line">      <span class='directive'>dct_long_mac(x6, sump23o, row3, rot3_2); \</span></td></tr>
<tr class="codeline" data-linenumber="2529"><td class="num" id="LN2529">2529</td><td class="line">      <span class='directive'>dct_long_mac(x7, sump14o, row1, rot3_3); \</span></td></tr>
<tr class="codeline" data-linenumber="2530"><td class="num" id="LN2530">2530</td><td class="line">      <span class='directive'>dct_bfly32o(row0,row7, x0,x7,shiftop,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2531"><td class="num" id="LN2531">2531</td><td class="line">      <span class='directive'>dct_bfly32o(row1,row6, x1,x6,shiftop,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2532"><td class="num" id="LN2532">2532</td><td class="line">      <span class='directive'>dct_bfly32o(row2,row5, x2,x5,shiftop,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2533"><td class="num" id="LN2533">2533</td><td class="line">      <span class='directive'>dct_bfly32o(row3,row4, x3,x4,shiftop,shift); \</span></td></tr>
<tr class="codeline" data-linenumber="2534"><td class="num" id="LN2534">2534</td><td class="line">   <span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="2535"><td class="num" id="LN2535">2535</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2536"><td class="num" id="LN2536">2536</td><td class="line">   <span class='comment'>// load</span></td></tr>
<tr class="codeline" data-linenumber="2537"><td class="num" id="LN2537">2537</td><td class="line">   row0 = vld1q_s16(data + 0*8);</td></tr>
<tr class="codeline" data-linenumber="2538"><td class="num" id="LN2538">2538</td><td class="line">   row1 = vld1q_s16(data + 1*8);</td></tr>
<tr class="codeline" data-linenumber="2539"><td class="num" id="LN2539">2539</td><td class="line">   row2 = vld1q_s16(data + 2*8);</td></tr>
<tr class="codeline" data-linenumber="2540"><td class="num" id="LN2540">2540</td><td class="line">   row3 = vld1q_s16(data + 3*8);</td></tr>
<tr class="codeline" data-linenumber="2541"><td class="num" id="LN2541">2541</td><td class="line">   row4 = vld1q_s16(data + 4*8);</td></tr>
<tr class="codeline" data-linenumber="2542"><td class="num" id="LN2542">2542</td><td class="line">   row5 = vld1q_s16(data + 5*8);</td></tr>
<tr class="codeline" data-linenumber="2543"><td class="num" id="LN2543">2543</td><td class="line">   row6 = vld1q_s16(data + 6*8);</td></tr>
<tr class="codeline" data-linenumber="2544"><td class="num" id="LN2544">2544</td><td class="line">   row7 = vld1q_s16(data + 7*8);</td></tr>
<tr class="codeline" data-linenumber="2545"><td class="num" id="LN2545">2545</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2546"><td class="num" id="LN2546">2546</td><td class="line">   <span class='comment'>// add DC bias</span></td></tr>
<tr class="codeline" data-linenumber="2547"><td class="num" id="LN2547">2547</td><td class="line">   row0 = vaddq_s16(row0, vsetq_lane_s16(1024, vdupq_n_s16(0), 0));</td></tr>
<tr class="codeline" data-linenumber="2548"><td class="num" id="LN2548">2548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2549"><td class="num" id="LN2549">2549</td><td class="line">   <span class='comment'>// column pass</span></td></tr>
<tr class="codeline" data-linenumber="2550"><td class="num" id="LN2550">2550</td><td class="line">   dct_pass(vrshrn_n_s32, 10);</td></tr>
<tr class="codeline" data-linenumber="2551"><td class="num" id="LN2551">2551</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2552"><td class="num" id="LN2552">2552</td><td class="line">   <span class='comment'>// 16bit 8x8 transpose</span></td></tr>
<tr class="codeline" data-linenumber="2553"><td class="num" id="LN2553">2553</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="2554"><td class="num" id="LN2554">2554</td><td class="line"><span class='comment'>// these three map to a single VTRN.16, VTRN.32, and VSWP, respectively.</span></td></tr>
<tr class="codeline" data-linenumber="2555"><td class="num" id="LN2555">2555</td><td class="line"><span class='comment'>// whether compilers actually get this is another story, sadly.</span></td></tr>
<tr class="codeline" data-linenumber="2556"><td class="num" id="LN2556">2556</td><td class="line"><span class='directive'>#define dct_trn16(x, y) { int16x8x2_t t = vtrnq_s16(x, y); x = t.val[0]; y = t.val[1]; }</span></td></tr>
<tr class="codeline" data-linenumber="2557"><td class="num" id="LN2557">2557</td><td class="line"><span class='directive'>#define dct_trn32(x, y) { int32x4x2_t t = vtrnq_s32(vreinterpretq_s32_s16(x), vreinterpretq_s32_s16(y)); x = vreinterpretq_s16_s32(t.val[0]); y = vreinterpretq_s16_s32(t.val[1]); }</span></td></tr>
<tr class="codeline" data-linenumber="2558"><td class="num" id="LN2558">2558</td><td class="line"><span class='directive'>#define dct_trn64(x, y) { int16x8_t x0 = x; int16x8_t y0 = y; x = vcombine_s16(vget_low_s16(x0), vget_low_s16(y0)); y = vcombine_s16(vget_high_s16(x0), vget_high_s16(y0)); }</span></td></tr>
<tr class="codeline" data-linenumber="2559"><td class="num" id="LN2559">2559</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2560"><td class="num" id="LN2560">2560</td><td class="line">      <span class='comment'>// pass 1</span></td></tr>
<tr class="codeline" data-linenumber="2561"><td class="num" id="LN2561">2561</td><td class="line">      dct_trn16(row0, row1); <span class='comment'>// a0b0a2b2a4b4a6b6</span></td></tr>
<tr class="codeline" data-linenumber="2562"><td class="num" id="LN2562">2562</td><td class="line">      dct_trn16(row2, row3);</td></tr>
<tr class="codeline" data-linenumber="2563"><td class="num" id="LN2563">2563</td><td class="line">      dct_trn16(row4, row5);</td></tr>
<tr class="codeline" data-linenumber="2564"><td class="num" id="LN2564">2564</td><td class="line">      dct_trn16(row6, row7);</td></tr>
<tr class="codeline" data-linenumber="2565"><td class="num" id="LN2565">2565</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2566"><td class="num" id="LN2566">2566</td><td class="line">      <span class='comment'>// pass 2</span></td></tr>
<tr class="codeline" data-linenumber="2567"><td class="num" id="LN2567">2567</td><td class="line">      dct_trn32(row0, row2); <span class='comment'>// a0b0c0d0a4b4c4d4</span></td></tr>
<tr class="codeline" data-linenumber="2568"><td class="num" id="LN2568">2568</td><td class="line">      dct_trn32(row1, row3);</td></tr>
<tr class="codeline" data-linenumber="2569"><td class="num" id="LN2569">2569</td><td class="line">      dct_trn32(row4, row6);</td></tr>
<tr class="codeline" data-linenumber="2570"><td class="num" id="LN2570">2570</td><td class="line">      dct_trn32(row5, row7);</td></tr>
<tr class="codeline" data-linenumber="2571"><td class="num" id="LN2571">2571</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2572"><td class="num" id="LN2572">2572</td><td class="line">      <span class='comment'>// pass 3</span></td></tr>
<tr class="codeline" data-linenumber="2573"><td class="num" id="LN2573">2573</td><td class="line">      dct_trn64(row0, row4); <span class='comment'>// a0b0c0d0e0f0g0h0</span></td></tr>
<tr class="codeline" data-linenumber="2574"><td class="num" id="LN2574">2574</td><td class="line">      dct_trn64(row1, row5);</td></tr>
<tr class="codeline" data-linenumber="2575"><td class="num" id="LN2575">2575</td><td class="line">      dct_trn64(row2, row6);</td></tr>
<tr class="codeline" data-linenumber="2576"><td class="num" id="LN2576">2576</td><td class="line">      dct_trn64(row3, row7);</td></tr>
<tr class="codeline" data-linenumber="2577"><td class="num" id="LN2577">2577</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2578"><td class="num" id="LN2578">2578</td><td class="line"><span class='directive'>#undef dct_trn16</span></td></tr>
<tr class="codeline" data-linenumber="2579"><td class="num" id="LN2579">2579</td><td class="line"><span class='directive'>#undef dct_trn32</span></td></tr>
<tr class="codeline" data-linenumber="2580"><td class="num" id="LN2580">2580</td><td class="line"><span class='directive'>#undef dct_trn64</span></td></tr>
<tr class="codeline" data-linenumber="2581"><td class="num" id="LN2581">2581</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2582"><td class="num" id="LN2582">2582</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2583"><td class="num" id="LN2583">2583</td><td class="line">   <span class='comment'>// row pass</span></td></tr>
<tr class="codeline" data-linenumber="2584"><td class="num" id="LN2584">2584</td><td class="line">   <span class='comment'>// vrshrn_n_s32 only supports shifts up to 16, we need</span></td></tr>
<tr class="codeline" data-linenumber="2585"><td class="num" id="LN2585">2585</td><td class="line">   <span class='comment'>// 17. so do a non-rounding shift of 16 first then follow</span></td></tr>
<tr class="codeline" data-linenumber="2586"><td class="num" id="LN2586">2586</td><td class="line">   <span class='comment'>// up with a rounding shift by 1.</span></td></tr>
<tr class="codeline" data-linenumber="2587"><td class="num" id="LN2587">2587</td><td class="line">   dct_pass(vshrn_n_s32, 16);</td></tr>
<tr class="codeline" data-linenumber="2588"><td class="num" id="LN2588">2588</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2589"><td class="num" id="LN2589">2589</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="2590"><td class="num" id="LN2590">2590</td><td class="line">      <span class='comment'>// pack and round</span></td></tr>
<tr class="codeline" data-linenumber="2591"><td class="num" id="LN2591">2591</td><td class="line">      uint8x8_t p0 = vqrshrun_n_s16(row0, 1);</td></tr>
<tr class="codeline" data-linenumber="2592"><td class="num" id="LN2592">2592</td><td class="line">      uint8x8_t p1 = vqrshrun_n_s16(row1, 1);</td></tr>
<tr class="codeline" data-linenumber="2593"><td class="num" id="LN2593">2593</td><td class="line">      uint8x8_t p2 = vqrshrun_n_s16(row2, 1);</td></tr>
<tr class="codeline" data-linenumber="2594"><td class="num" id="LN2594">2594</td><td class="line">      uint8x8_t p3 = vqrshrun_n_s16(row3, 1);</td></tr>
<tr class="codeline" data-linenumber="2595"><td class="num" id="LN2595">2595</td><td class="line">      uint8x8_t p4 = vqrshrun_n_s16(row4, 1);</td></tr>
<tr class="codeline" data-linenumber="2596"><td class="num" id="LN2596">2596</td><td class="line">      uint8x8_t p5 = vqrshrun_n_s16(row5, 1);</td></tr>
<tr class="codeline" data-linenumber="2597"><td class="num" id="LN2597">2597</td><td class="line">      uint8x8_t p6 = vqrshrun_n_s16(row6, 1);</td></tr>
<tr class="codeline" data-linenumber="2598"><td class="num" id="LN2598">2598</td><td class="line">      uint8x8_t p7 = vqrshrun_n_s16(row7, 1);</td></tr>
<tr class="codeline" data-linenumber="2599"><td class="num" id="LN2599">2599</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2600"><td class="num" id="LN2600">2600</td><td class="line">      <span class='comment'>// again, these can translate into one instruction, but often don't.</span></td></tr>
<tr class="codeline" data-linenumber="2601"><td class="num" id="LN2601">2601</td><td class="line"><span class='directive'>#define dct_trn8_8(x, y) { uint8x8x2_t t = vtrn_u8(x, y); x = t.val[0]; y = t.val[1]; }</span></td></tr>
<tr class="codeline" data-linenumber="2602"><td class="num" id="LN2602">2602</td><td class="line"><span class='directive'>#define dct_trn8_16(x, y) { uint16x4x2_t t = vtrn_u16(vreinterpret_u16_u8(x), vreinterpret_u16_u8(y)); x = vreinterpret_u8_u16(t.val[0]); y = vreinterpret_u8_u16(t.val[1]); }</span></td></tr>
<tr class="codeline" data-linenumber="2603"><td class="num" id="LN2603">2603</td><td class="line"><span class='directive'>#define dct_trn8_32(x, y) { uint32x2x2_t t = vtrn_u32(vreinterpret_u32_u8(x), vreinterpret_u32_u8(y)); x = vreinterpret_u8_u32(t.val[0]); y = vreinterpret_u8_u32(t.val[1]); }</span></td></tr>
<tr class="codeline" data-linenumber="2604"><td class="num" id="LN2604">2604</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2605"><td class="num" id="LN2605">2605</td><td class="line">      <span class='comment'>// sadly can't use interleaved stores here since we only write</span></td></tr>
<tr class="codeline" data-linenumber="2606"><td class="num" id="LN2606">2606</td><td class="line">      <span class='comment'>// 8 bytes to each scan line!</span></td></tr>
<tr class="codeline" data-linenumber="2607"><td class="num" id="LN2607">2607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2608"><td class="num" id="LN2608">2608</td><td class="line">      <span class='comment'>// 8x8 8-bit transpose pass 1</span></td></tr>
<tr class="codeline" data-linenumber="2609"><td class="num" id="LN2609">2609</td><td class="line">      dct_trn8_8(p0, p1);</td></tr>
<tr class="codeline" data-linenumber="2610"><td class="num" id="LN2610">2610</td><td class="line">      dct_trn8_8(p2, p3);</td></tr>
<tr class="codeline" data-linenumber="2611"><td class="num" id="LN2611">2611</td><td class="line">      dct_trn8_8(p4, p5);</td></tr>
<tr class="codeline" data-linenumber="2612"><td class="num" id="LN2612">2612</td><td class="line">      dct_trn8_8(p6, p7);</td></tr>
<tr class="codeline" data-linenumber="2613"><td class="num" id="LN2613">2613</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2614"><td class="num" id="LN2614">2614</td><td class="line">      <span class='comment'>// pass 2</span></td></tr>
<tr class="codeline" data-linenumber="2615"><td class="num" id="LN2615">2615</td><td class="line">      dct_trn8_16(p0, p2);</td></tr>
<tr class="codeline" data-linenumber="2616"><td class="num" id="LN2616">2616</td><td class="line">      dct_trn8_16(p1, p3);</td></tr>
<tr class="codeline" data-linenumber="2617"><td class="num" id="LN2617">2617</td><td class="line">      dct_trn8_16(p4, p6);</td></tr>
<tr class="codeline" data-linenumber="2618"><td class="num" id="LN2618">2618</td><td class="line">      dct_trn8_16(p5, p7);</td></tr>
<tr class="codeline" data-linenumber="2619"><td class="num" id="LN2619">2619</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2620"><td class="num" id="LN2620">2620</td><td class="line">      <span class='comment'>// pass 3</span></td></tr>
<tr class="codeline" data-linenumber="2621"><td class="num" id="LN2621">2621</td><td class="line">      dct_trn8_32(p0, p4);</td></tr>
<tr class="codeline" data-linenumber="2622"><td class="num" id="LN2622">2622</td><td class="line">      dct_trn8_32(p1, p5);</td></tr>
<tr class="codeline" data-linenumber="2623"><td class="num" id="LN2623">2623</td><td class="line">      dct_trn8_32(p2, p6);</td></tr>
<tr class="codeline" data-linenumber="2624"><td class="num" id="LN2624">2624</td><td class="line">      dct_trn8_32(p3, p7);</td></tr>
<tr class="codeline" data-linenumber="2625"><td class="num" id="LN2625">2625</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2626"><td class="num" id="LN2626">2626</td><td class="line">      <span class='comment'>// store</span></td></tr>
<tr class="codeline" data-linenumber="2627"><td class="num" id="LN2627">2627</td><td class="line">      vst1_u8(out, p0); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2628"><td class="num" id="LN2628">2628</td><td class="line">      vst1_u8(out, p1); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2629"><td class="num" id="LN2629">2629</td><td class="line">      vst1_u8(out, p2); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2630"><td class="num" id="LN2630">2630</td><td class="line">      vst1_u8(out, p3); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2631"><td class="num" id="LN2631">2631</td><td class="line">      vst1_u8(out, p4); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2632"><td class="num" id="LN2632">2632</td><td class="line">      vst1_u8(out, p5); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2633"><td class="num" id="LN2633">2633</td><td class="line">      vst1_u8(out, p6); out += out_stride;</td></tr>
<tr class="codeline" data-linenumber="2634"><td class="num" id="LN2634">2634</td><td class="line">      vst1_u8(out, p7);</td></tr>
<tr class="codeline" data-linenumber="2635"><td class="num" id="LN2635">2635</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2636"><td class="num" id="LN2636">2636</td><td class="line"><span class='directive'>#undef dct_trn8_8</span></td></tr>
<tr class="codeline" data-linenumber="2637"><td class="num" id="LN2637">2637</td><td class="line"><span class='directive'>#undef dct_trn8_16</span></td></tr>
<tr class="codeline" data-linenumber="2638"><td class="num" id="LN2638">2638</td><td class="line"><span class='directive'>#undef dct_trn8_32</span></td></tr>
<tr class="codeline" data-linenumber="2639"><td class="num" id="LN2639">2639</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2640"><td class="num" id="LN2640">2640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2641"><td class="num" id="LN2641">2641</td><td class="line"><span class='directive'>#undef dct_long_mul</span></td></tr>
<tr class="codeline" data-linenumber="2642"><td class="num" id="LN2642">2642</td><td class="line"><span class='directive'>#undef dct_long_mac</span></td></tr>
<tr class="codeline" data-linenumber="2643"><td class="num" id="LN2643">2643</td><td class="line"><span class='directive'>#undef dct_widen</span></td></tr>
<tr class="codeline" data-linenumber="2644"><td class="num" id="LN2644">2644</td><td class="line"><span class='directive'>#undef dct_wadd</span></td></tr>
<tr class="codeline" data-linenumber="2645"><td class="num" id="LN2645">2645</td><td class="line"><span class='directive'>#undef dct_wsub</span></td></tr>
<tr class="codeline" data-linenumber="2646"><td class="num" id="LN2646">2646</td><td class="line"><span class='directive'>#undef dct_bfly32o</span></td></tr>
<tr class="codeline" data-linenumber="2647"><td class="num" id="LN2647">2647</td><td class="line"><span class='directive'>#undef dct_pass</span></td></tr>
<tr class="codeline" data-linenumber="2648"><td class="num" id="LN2648">2648</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2649"><td class="num" id="LN2649">2649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2650"><td class="num" id="LN2650">2650</td><td class="line"><span class='directive'>#endif // STBI_NEON</span></td></tr>
<tr class="codeline" data-linenumber="2651"><td class="num" id="LN2651">2651</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2652"><td class="num" id="LN2652">2652</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>  0xff</span></td></tr>
<tr class="codeline" data-linenumber="2653"><td class="num" id="LN2653">2653</td><td class="line"><span class='comment'>// if there's a pending marker from the entropy stream, return that</span></td></tr>
<tr class="codeline" data-linenumber="2654"><td class="num" id="LN2654">2654</td><td class="line"><span class='comment'>// otherwise, fetch from the stream and get a marker. if there's no</span></td></tr>
<tr class="codeline" data-linenumber="2655"><td class="num" id="LN2655">2655</td><td class="line"><span class='comment'>// marker, return 0xff, which is never a valid marker value</span></td></tr>
<tr class="codeline" data-linenumber="2656"><td class="num" id="LN2656">2656</td><td class="line"><span class='keyword'>static</span> stbi_uc stbi__get_marker(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="2657"><td class="num" id="LN2657">2657</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2658"><td class="num" id="LN2658">2658</td><td class="line">   stbi_uc x;</td></tr>
<tr class="codeline" data-linenumber="2659"><td class="num" id="LN2659">2659</td><td class="line">   <span class='keyword'>if</span> (j-&gt;marker != <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>) { x = j-&gt;marker; j-&gt;marker = <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>; <span class='keyword'>return</span> x; }</td></tr>
<tr class="codeline" data-linenumber="2660"><td class="num" id="LN2660">2660</td><td class="line">   x = stbi__get8(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2661"><td class="num" id="LN2661">2661</td><td class="line">   <span class='keyword'>if</span> (x != 0xff) <span class='keyword'>return</span> <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2662"><td class="num" id="LN2662">2662</td><td class="line">   <span class='keyword'>while</span> (x == 0xff)</td></tr>
<tr class="codeline" data-linenumber="2663"><td class="num" id="LN2663">2663</td><td class="line">      x = stbi__get8(j-&gt;s); <span class='comment'>// consume repeated 0xff fill bytes</span></td></tr>
<tr class="codeline" data-linenumber="2664"><td class="num" id="LN2664">2664</td><td class="line">   <span class='keyword'>return</span> x;</td></tr>
<tr class="codeline" data-linenumber="2665"><td class="num" id="LN2665">2665</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2666"><td class="num" id="LN2666">2666</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2667"><td class="num" id="LN2667">2667</td><td class="line"><span class='comment'>// in each scan, we'll have scan_n components, and the order</span></td></tr>
<tr class="codeline" data-linenumber="2668"><td class="num" id="LN2668">2668</td><td class="line"><span class='comment'>// of the components is specified by order[]</span></td></tr>
<tr class="codeline" data-linenumber="2669"><td class="num" id="LN2669">2669</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__RESTART(x)<span class='macro_popup'>((x) &gt;= 0xd0 &amp;&amp; (x) &lt;= 0xd7)</span></span>     ((x) &gt;= 0xd0 &amp;&amp; (x) &lt;= 0xd7)</span></td></tr>
<tr class="codeline" data-linenumber="2670"><td class="num" id="LN2670">2670</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2671"><td class="num" id="LN2671">2671</td><td class="line"><span class='comment'>// after a restart interval, stbi__jpeg_reset the entropy decoder and</span></td></tr>
<tr class="codeline" data-linenumber="2672"><td class="num" id="LN2672">2672</td><td class="line"><span class='comment'>// the dc prediction</span></td></tr>
<tr class="codeline" data-linenumber="2673"><td class="num" id="LN2673">2673</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__jpeg_reset(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="2674"><td class="num" id="LN2674">2674</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2675"><td class="num" id="LN2675">2675</td><td class="line">   j-&gt;code_bits = 0;</td></tr>
<tr class="codeline" data-linenumber="2676"><td class="num" id="LN2676">2676</td><td class="line">   j-&gt;code_buffer = 0;</td></tr>
<tr class="codeline" data-linenumber="2677"><td class="num" id="LN2677">2677</td><td class="line">   j-&gt;nomore = 0;</td></tr>
<tr class="codeline" data-linenumber="2678"><td class="num" id="LN2678">2678</td><td class="line">   j-&gt;img_comp[0].dc_pred = j-&gt;img_comp[1].dc_pred = j-&gt;img_comp[2].dc_pred = j-&gt;img_comp[3].dc_pred = 0;</td></tr>
<tr class="codeline" data-linenumber="2679"><td class="num" id="LN2679">2679</td><td class="line">   j-&gt;marker = <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2680"><td class="num" id="LN2680">2680</td><td class="line">   j-&gt;todo = j-&gt;restart_interval ? j-&gt;restart_interval : 0x7fffffff;</td></tr>
<tr class="codeline" data-linenumber="2681"><td class="num" id="LN2681">2681</td><td class="line">   j-&gt;eob_run = 0;</td></tr>
<tr class="codeline" data-linenumber="2682"><td class="num" id="LN2682">2682</td><td class="line">   <span class='comment'>// no more than 1&lt;&lt;31 MCUs if no restart_interal? that's plenty safe,</span></td></tr>
<tr class="codeline" data-linenumber="2683"><td class="num" id="LN2683">2683</td><td class="line">   <span class='comment'>// since we don't even allow 1&lt;&lt;30 pixels</span></td></tr>
<tr class="codeline" data-linenumber="2684"><td class="num" id="LN2684">2684</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2685"><td class="num" id="LN2685">2685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2686"><td class="num" id="LN2686">2686</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__parse_entropy_coded_data(stbi__jpeg *z)</td></tr>
<tr class="codeline" data-linenumber="2687"><td class="num" id="LN2687">2687</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2688"><td class="num" id="LN2688">2688</td><td class="line">   stbi__jpeg_reset(z);</td></tr>
<tr class="codeline" data-linenumber="2689"><td class="num" id="LN2689">2689</td><td class="line">   <span class='keyword'>if</span> (!z-&gt;progressive) {</td></tr>
<tr class="codeline" data-linenumber="2690"><td class="num" id="LN2690">2690</td><td class="line">      <span class='keyword'>if</span> (z-&gt;scan_n == 1) {</td></tr>
<tr class="codeline" data-linenumber="2691"><td class="num" id="LN2691">2691</td><td class="line">         <span class='keyword'>int</span> i,j;</td></tr>
<tr class="codeline" data-linenumber="2692"><td class="num" id="LN2692">2692</td><td class="line">         <span class='macro'>STBI_SIMD_ALIGN(<span class='keyword'>short</span>, data[64])<span class='macro_popup'>short data[64] __attribute__((aligned(16)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2693"><td class="num" id="LN2693">2693</td><td class="line">         <span class='keyword'>int</span> n = z-&gt;order[0];</td></tr>
<tr class="codeline" data-linenumber="2694"><td class="num" id="LN2694">2694</td><td class="line">         <span class='comment'>// non-interleaved data, we just need to process one block at a time,</span></td></tr>
<tr class="codeline" data-linenumber="2695"><td class="num" id="LN2695">2695</td><td class="line">         <span class='comment'>// in trivial scanline order</span></td></tr>
<tr class="codeline" data-linenumber="2696"><td class="num" id="LN2696">2696</td><td class="line">         <span class='comment'>// number of blocks to do just depends on how many actual "pixels" this</span></td></tr>
<tr class="codeline" data-linenumber="2697"><td class="num" id="LN2697">2697</td><td class="line">         <span class='comment'>// component has, independent of interleaved MCU blocking and such</span></td></tr>
<tr class="codeline" data-linenumber="2698"><td class="num" id="LN2698">2698</td><td class="line">         <span class='keyword'>int</span> w = (z-&gt;img_comp[n].x+7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="2699"><td class="num" id="LN2699">2699</td><td class="line">         <span class='keyword'>int</span> h = (z-&gt;img_comp[n].y+7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="2700"><td class="num" id="LN2700">2700</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; h; ++j) {</td></tr>
<tr class="codeline" data-linenumber="2701"><td class="num" id="LN2701">2701</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; w; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2702"><td class="num" id="LN2702">2702</td><td class="line">               <span class='keyword'>int</span> ha = z-&gt;img_comp[n].ha;</td></tr>
<tr class="codeline" data-linenumber="2703"><td class="num" id="LN2703">2703</td><td class="line">               <span class='keyword'>if</span> (!stbi__jpeg_decode_block(z, data, z-&gt;huff_dc+z-&gt;img_comp[n].hd, z-&gt;huff_ac+ha, z-&gt;fast_ac[ha], n, z-&gt;dequant[z-&gt;img_comp[n].tq])) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2704"><td class="num" id="LN2704">2704</td><td class="line">               z-&gt;idct_block_kernel(z-&gt;img_comp[n].data+z-&gt;img_comp[n].w2*j*8+i*8, z-&gt;img_comp[n].w2, data);</td></tr>
<tr class="codeline" data-linenumber="2705"><td class="num" id="LN2705">2705</td><td class="line">               <span class='comment'>// every data block is an MCU, so countdown the restart interval</span></td></tr>
<tr class="codeline" data-linenumber="2706"><td class="num" id="LN2706">2706</td><td class="line">               <span class='keyword'>if</span> (--z-&gt;todo &lt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="2707"><td class="num" id="LN2707">2707</td><td class="line">                  <span class='keyword'>if</span> (z-&gt;code_bits &lt; 24) stbi__grow_buffer_unsafe(z);</td></tr>
<tr class="codeline" data-linenumber="2708"><td class="num" id="LN2708">2708</td><td class="line">                  <span class='comment'>// if it's NOT a restart, then just bail, so we get corrupt data</span></td></tr>
<tr class="codeline" data-linenumber="2709"><td class="num" id="LN2709">2709</td><td class="line">                  <span class='comment'>// rather than no data</span></td></tr>
<tr class="codeline" data-linenumber="2710"><td class="num" id="LN2710">2710</td><td class="line">                  <span class='keyword'>if</span> (!<span class='macro'>STBI__RESTART(z-&gt;marker)<span class='macro_popup'>((z-&gt;marker) &gt;= 0xd0 &amp;&amp; (z-&gt;marker) &lt;= 0xd7<br>)</span></span>) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2711"><td class="num" id="LN2711">2711</td><td class="line">                  stbi__jpeg_reset(z);</td></tr>
<tr class="codeline" data-linenumber="2712"><td class="num" id="LN2712">2712</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2713"><td class="num" id="LN2713">2713</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2714"><td class="num" id="LN2714">2714</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2715"><td class="num" id="LN2715">2715</td><td class="line">         <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2716"><td class="num" id="LN2716">2716</td><td class="line">      } <span class='keyword'>else</span> { <span class='comment'>// interleaved</span></td></tr>
<tr class="codeline" data-linenumber="2717"><td class="num" id="LN2717">2717</td><td class="line">         <span class='keyword'>int</span> i,j,k,x,y;</td></tr>
<tr class="codeline" data-linenumber="2718"><td class="num" id="LN2718">2718</td><td class="line">         <span class='macro'>STBI_SIMD_ALIGN(<span class='keyword'>short</span>, data[64])<span class='macro_popup'>short data[64] __attribute__((aligned(16)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2719"><td class="num" id="LN2719">2719</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; z-&gt;img_mcu_y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="2720"><td class="num" id="LN2720">2720</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; z-&gt;img_mcu_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2721"><td class="num" id="LN2721">2721</td><td class="line">               <span class='comment'>// scan an interleaved mcu... process scan_n components in order</span></td></tr>
<tr class="codeline" data-linenumber="2722"><td class="num" id="LN2722">2722</td><td class="line">               <span class='keyword'>for</span> (k=0; k &lt; z-&gt;scan_n; ++k) {</td></tr>
<tr class="codeline" data-linenumber="2723"><td class="num" id="LN2723">2723</td><td class="line">                  <span class='keyword'>int</span> n = z-&gt;order[k];</td></tr>
<tr class="codeline" data-linenumber="2724"><td class="num" id="LN2724">2724</td><td class="line">                  <span class='comment'>// scan out an mcu's worth of this component; that's just determined</span></td></tr>
<tr class="codeline" data-linenumber="2725"><td class="num" id="LN2725">2725</td><td class="line">                  <span class='comment'>// by the basic H and V specified for the component</span></td></tr>
<tr class="codeline" data-linenumber="2726"><td class="num" id="LN2726">2726</td><td class="line">                  <span class='keyword'>for</span> (y=0; y &lt; z-&gt;img_comp[n].v; ++y) {</td></tr>
<tr class="codeline" data-linenumber="2727"><td class="num" id="LN2727">2727</td><td class="line">                     <span class='keyword'>for</span> (x=0; x &lt; z-&gt;img_comp[n].h; ++x) {</td></tr>
<tr class="codeline" data-linenumber="2728"><td class="num" id="LN2728">2728</td><td class="line">                        <span class='keyword'>int</span> x2 = (i*z-&gt;img_comp[n].h + x)*8;</td></tr>
<tr class="codeline" data-linenumber="2729"><td class="num" id="LN2729">2729</td><td class="line">                        <span class='keyword'>int</span> y2 = (j*z-&gt;img_comp[n].v + y)*8;</td></tr>
<tr class="codeline" data-linenumber="2730"><td class="num" id="LN2730">2730</td><td class="line">                        <span class='keyword'>int</span> ha = z-&gt;img_comp[n].ha;</td></tr>
<tr class="codeline" data-linenumber="2731"><td class="num" id="LN2731">2731</td><td class="line">                        <span class='keyword'>if</span> (!stbi__jpeg_decode_block(z, data, z-&gt;huff_dc+z-&gt;img_comp[n].hd, z-&gt;huff_ac+ha, z-&gt;fast_ac[ha], n, z-&gt;dequant[z-&gt;img_comp[n].tq])) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2732"><td class="num" id="LN2732">2732</td><td class="line">                        z-&gt;idct_block_kernel(z-&gt;img_comp[n].data+z-&gt;img_comp[n].w2*y2+x2, z-&gt;img_comp[n].w2, data);</td></tr>
<tr class="codeline" data-linenumber="2733"><td class="num" id="LN2733">2733</td><td class="line">                     }</td></tr>
<tr class="codeline" data-linenumber="2734"><td class="num" id="LN2734">2734</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="2735"><td class="num" id="LN2735">2735</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2736"><td class="num" id="LN2736">2736</td><td class="line">               <span class='comment'>// after all interleaved components, that's an interleaved MCU,</span></td></tr>
<tr class="codeline" data-linenumber="2737"><td class="num" id="LN2737">2737</td><td class="line">               <span class='comment'>// so now count down the restart interval</span></td></tr>
<tr class="codeline" data-linenumber="2738"><td class="num" id="LN2738">2738</td><td class="line">               <span class='keyword'>if</span> (--z-&gt;todo &lt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="2739"><td class="num" id="LN2739">2739</td><td class="line">                  <span class='keyword'>if</span> (z-&gt;code_bits &lt; 24) stbi__grow_buffer_unsafe(z);</td></tr>
<tr class="codeline" data-linenumber="2740"><td class="num" id="LN2740">2740</td><td class="line">                  <span class='keyword'>if</span> (!<span class='macro'>STBI__RESTART(z-&gt;marker)<span class='macro_popup'>((z-&gt;marker) &gt;= 0xd0 &amp;&amp; (z-&gt;marker) &lt;= 0xd7<br>)</span></span>) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2741"><td class="num" id="LN2741">2741</td><td class="line">                  stbi__jpeg_reset(z);</td></tr>
<tr class="codeline" data-linenumber="2742"><td class="num" id="LN2742">2742</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2743"><td class="num" id="LN2743">2743</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2744"><td class="num" id="LN2744">2744</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2745"><td class="num" id="LN2745">2745</td><td class="line">         <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2746"><td class="num" id="LN2746">2746</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2747"><td class="num" id="LN2747">2747</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2748"><td class="num" id="LN2748">2748</td><td class="line">      <span class='keyword'>if</span> (z-&gt;scan_n == 1) {</td></tr>
<tr class="codeline" data-linenumber="2749"><td class="num" id="LN2749">2749</td><td class="line">         <span class='keyword'>int</span> i,j;</td></tr>
<tr class="codeline" data-linenumber="2750"><td class="num" id="LN2750">2750</td><td class="line">         <span class='keyword'>int</span> n = z-&gt;order[0];</td></tr>
<tr class="codeline" data-linenumber="2751"><td class="num" id="LN2751">2751</td><td class="line">         <span class='comment'>// non-interleaved data, we just need to process one block at a time,</span></td></tr>
<tr class="codeline" data-linenumber="2752"><td class="num" id="LN2752">2752</td><td class="line">         <span class='comment'>// in trivial scanline order</span></td></tr>
<tr class="codeline" data-linenumber="2753"><td class="num" id="LN2753">2753</td><td class="line">         <span class='comment'>// number of blocks to do just depends on how many actual "pixels" this</span></td></tr>
<tr class="codeline" data-linenumber="2754"><td class="num" id="LN2754">2754</td><td class="line">         <span class='comment'>// component has, independent of interleaved MCU blocking and such</span></td></tr>
<tr class="codeline" data-linenumber="2755"><td class="num" id="LN2755">2755</td><td class="line">         <span class='keyword'>int</span> w = (z-&gt;img_comp[n].x+7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="2756"><td class="num" id="LN2756">2756</td><td class="line">         <span class='keyword'>int</span> h = (z-&gt;img_comp[n].y+7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="2757"><td class="num" id="LN2757">2757</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; h; ++j) {</td></tr>
<tr class="codeline" data-linenumber="2758"><td class="num" id="LN2758">2758</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; w; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2759"><td class="num" id="LN2759">2759</td><td class="line">               <span class='keyword'>short</span> *data = z-&gt;img_comp[n].coeff + 64 * (i + j * z-&gt;img_comp[n].coeff_w);</td></tr>
<tr class="codeline" data-linenumber="2760"><td class="num" id="LN2760">2760</td><td class="line">               <span class='keyword'>if</span> (z-&gt;spec_start == 0) {</td></tr>
<tr class="codeline" data-linenumber="2761"><td class="num" id="LN2761">2761</td><td class="line">                  <span class='keyword'>if</span> (!stbi__jpeg_decode_block_prog_dc(z, data, &amp;z-&gt;huff_dc[z-&gt;img_comp[n].hd], n))</td></tr>
<tr class="codeline" data-linenumber="2762"><td class="num" id="LN2762">2762</td><td class="line">                     <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2763"><td class="num" id="LN2763">2763</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2764"><td class="num" id="LN2764">2764</td><td class="line">                  <span class='keyword'>int</span> ha = z-&gt;img_comp[n].ha;</td></tr>
<tr class="codeline" data-linenumber="2765"><td class="num" id="LN2765">2765</td><td class="line">                  <span class='keyword'>if</span> (!stbi__jpeg_decode_block_prog_ac(z, data, &amp;z-&gt;huff_ac[ha], z-&gt;fast_ac[ha]))</td></tr>
<tr class="codeline" data-linenumber="2766"><td class="num" id="LN2766">2766</td><td class="line">                     <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2767"><td class="num" id="LN2767">2767</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2768"><td class="num" id="LN2768">2768</td><td class="line">               <span class='comment'>// every data block is an MCU, so countdown the restart interval</span></td></tr>
<tr class="codeline" data-linenumber="2769"><td class="num" id="LN2769">2769</td><td class="line">               <span class='keyword'>if</span> (--z-&gt;todo &lt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="2770"><td class="num" id="LN2770">2770</td><td class="line">                  <span class='keyword'>if</span> (z-&gt;code_bits &lt; 24) stbi__grow_buffer_unsafe(z);</td></tr>
<tr class="codeline" data-linenumber="2771"><td class="num" id="LN2771">2771</td><td class="line">                  <span class='keyword'>if</span> (!<span class='macro'>STBI__RESTART(z-&gt;marker)<span class='macro_popup'>((z-&gt;marker) &gt;= 0xd0 &amp;&amp; (z-&gt;marker) &lt;= 0xd7<br>)</span></span>) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2772"><td class="num" id="LN2772">2772</td><td class="line">                  stbi__jpeg_reset(z);</td></tr>
<tr class="codeline" data-linenumber="2773"><td class="num" id="LN2773">2773</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2774"><td class="num" id="LN2774">2774</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2775"><td class="num" id="LN2775">2775</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2776"><td class="num" id="LN2776">2776</td><td class="line">         <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2777"><td class="num" id="LN2777">2777</td><td class="line">      } <span class='keyword'>else</span> { <span class='comment'>// interleaved</span></td></tr>
<tr class="codeline" data-linenumber="2778"><td class="num" id="LN2778">2778</td><td class="line">         <span class='keyword'>int</span> i,j,k,x,y;</td></tr>
<tr class="codeline" data-linenumber="2779"><td class="num" id="LN2779">2779</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; z-&gt;img_mcu_y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="2780"><td class="num" id="LN2780">2780</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; z-&gt;img_mcu_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2781"><td class="num" id="LN2781">2781</td><td class="line">               <span class='comment'>// scan an interleaved mcu... process scan_n components in order</span></td></tr>
<tr class="codeline" data-linenumber="2782"><td class="num" id="LN2782">2782</td><td class="line">               <span class='keyword'>for</span> (k=0; k &lt; z-&gt;scan_n; ++k) {</td></tr>
<tr class="codeline" data-linenumber="2783"><td class="num" id="LN2783">2783</td><td class="line">                  <span class='keyword'>int</span> n = z-&gt;order[k];</td></tr>
<tr class="codeline" data-linenumber="2784"><td class="num" id="LN2784">2784</td><td class="line">                  <span class='comment'>// scan out an mcu's worth of this component; that's just determined</span></td></tr>
<tr class="codeline" data-linenumber="2785"><td class="num" id="LN2785">2785</td><td class="line">                  <span class='comment'>// by the basic H and V specified for the component</span></td></tr>
<tr class="codeline" data-linenumber="2786"><td class="num" id="LN2786">2786</td><td class="line">                  <span class='keyword'>for</span> (y=0; y &lt; z-&gt;img_comp[n].v; ++y) {</td></tr>
<tr class="codeline" data-linenumber="2787"><td class="num" id="LN2787">2787</td><td class="line">                     <span class='keyword'>for</span> (x=0; x &lt; z-&gt;img_comp[n].h; ++x) {</td></tr>
<tr class="codeline" data-linenumber="2788"><td class="num" id="LN2788">2788</td><td class="line">                        <span class='keyword'>int</span> x2 = (i*z-&gt;img_comp[n].h + x);</td></tr>
<tr class="codeline" data-linenumber="2789"><td class="num" id="LN2789">2789</td><td class="line">                        <span class='keyword'>int</span> y2 = (j*z-&gt;img_comp[n].v + y);</td></tr>
<tr class="codeline" data-linenumber="2790"><td class="num" id="LN2790">2790</td><td class="line">                        <span class='keyword'>short</span> *data = z-&gt;img_comp[n].coeff + 64 * (x2 + y2 * z-&gt;img_comp[n].coeff_w);</td></tr>
<tr class="codeline" data-linenumber="2791"><td class="num" id="LN2791">2791</td><td class="line">                        <span class='keyword'>if</span> (!stbi__jpeg_decode_block_prog_dc(z, data, &amp;z-&gt;huff_dc[z-&gt;img_comp[n].hd], n))</td></tr>
<tr class="codeline" data-linenumber="2792"><td class="num" id="LN2792">2792</td><td class="line">                           <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2793"><td class="num" id="LN2793">2793</td><td class="line">                     }</td></tr>
<tr class="codeline" data-linenumber="2794"><td class="num" id="LN2794">2794</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="2795"><td class="num" id="LN2795">2795</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2796"><td class="num" id="LN2796">2796</td><td class="line">               <span class='comment'>// after all interleaved components, that's an interleaved MCU,</span></td></tr>
<tr class="codeline" data-linenumber="2797"><td class="num" id="LN2797">2797</td><td class="line">               <span class='comment'>// so now count down the restart interval</span></td></tr>
<tr class="codeline" data-linenumber="2798"><td class="num" id="LN2798">2798</td><td class="line">               <span class='keyword'>if</span> (--z-&gt;todo &lt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="2799"><td class="num" id="LN2799">2799</td><td class="line">                  <span class='keyword'>if</span> (z-&gt;code_bits &lt; 24) stbi__grow_buffer_unsafe(z);</td></tr>
<tr class="codeline" data-linenumber="2800"><td class="num" id="LN2800">2800</td><td class="line">                  <span class='keyword'>if</span> (!<span class='macro'>STBI__RESTART(z-&gt;marker)<span class='macro_popup'>((z-&gt;marker) &gt;= 0xd0 &amp;&amp; (z-&gt;marker) &lt;= 0xd7<br>)</span></span>) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2801"><td class="num" id="LN2801">2801</td><td class="line">                  stbi__jpeg_reset(z);</td></tr>
<tr class="codeline" data-linenumber="2802"><td class="num" id="LN2802">2802</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="2803"><td class="num" id="LN2803">2803</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2804"><td class="num" id="LN2804">2804</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2805"><td class="num" id="LN2805">2805</td><td class="line">         <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2806"><td class="num" id="LN2806">2806</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2807"><td class="num" id="LN2807">2807</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2808"><td class="num" id="LN2808">2808</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2809"><td class="num" id="LN2809">2809</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2810"><td class="num" id="LN2810">2810</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__jpeg_dequantize(<span class='keyword'>short</span> *data, stbi__uint16 *dequant)</td></tr>
<tr class="codeline" data-linenumber="2811"><td class="num" id="LN2811">2811</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2812"><td class="num" id="LN2812">2812</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2813"><td class="num" id="LN2813">2813</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; 64; ++i)</td></tr>
<tr class="codeline" data-linenumber="2814"><td class="num" id="LN2814">2814</td><td class="line">      data[i] *= dequant[i];</td></tr>
<tr class="codeline" data-linenumber="2815"><td class="num" id="LN2815">2815</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2816"><td class="num" id="LN2816">2816</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2817"><td class="num" id="LN2817">2817</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__jpeg_finish(stbi__jpeg *z)</td></tr>
<tr class="codeline" data-linenumber="2818"><td class="num" id="LN2818">2818</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2819"><td class="num" id="LN2819">2819</td><td class="line">   <span class='keyword'>if</span> (z-&gt;progressive) {</td></tr>
<tr class="codeline" data-linenumber="2820"><td class="num" id="LN2820">2820</td><td class="line">      <span class='comment'>// dequantize and idct the data</span></td></tr>
<tr class="codeline" data-linenumber="2821"><td class="num" id="LN2821">2821</td><td class="line">      <span class='keyword'>int</span> i,j,n;</td></tr>
<tr class="codeline" data-linenumber="2822"><td class="num" id="LN2822">2822</td><td class="line">      <span class='keyword'>for</span> (n=0; n &lt; z-&gt;s-&gt;img_n; ++n) {</td></tr>
<tr class="codeline" data-linenumber="2823"><td class="num" id="LN2823">2823</td><td class="line">         <span class='keyword'>int</span> w = (z-&gt;img_comp[n].x+7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="2824"><td class="num" id="LN2824">2824</td><td class="line">         <span class='keyword'>int</span> h = (z-&gt;img_comp[n].y+7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="2825"><td class="num" id="LN2825">2825</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; h; ++j) {</td></tr>
<tr class="codeline" data-linenumber="2826"><td class="num" id="LN2826">2826</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; w; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2827"><td class="num" id="LN2827">2827</td><td class="line">               <span class='keyword'>short</span> *data = z-&gt;img_comp[n].coeff + 64 * (i + j * z-&gt;img_comp[n].coeff_w);</td></tr>
<tr class="codeline" data-linenumber="2828"><td class="num" id="LN2828">2828</td><td class="line">               stbi__jpeg_dequantize(data, z-&gt;dequant[z-&gt;img_comp[n].tq]);</td></tr>
<tr class="codeline" data-linenumber="2829"><td class="num" id="LN2829">2829</td><td class="line">               z-&gt;idct_block_kernel(z-&gt;img_comp[n].data+z-&gt;img_comp[n].w2*j*8+i*8, z-&gt;img_comp[n].w2, data);</td></tr>
<tr class="codeline" data-linenumber="2830"><td class="num" id="LN2830">2830</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2831"><td class="num" id="LN2831">2831</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2832"><td class="num" id="LN2832">2832</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2833"><td class="num" id="LN2833">2833</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2834"><td class="num" id="LN2834">2834</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2835"><td class="num" id="LN2835">2835</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2836"><td class="num" id="LN2836">2836</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__process_marker(stbi__jpeg *z, <span class='keyword'>int</span> m)</td></tr>
<tr class="codeline" data-linenumber="2837"><td class="num" id="LN2837">2837</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2838"><td class="num" id="LN2838">2838</td><td class="line">   <span class='keyword'>int</span> L;</td></tr>
<tr class="codeline" data-linenumber="2839"><td class="num" id="LN2839">2839</td><td class="line">   <span class='keyword'>switch</span> (m) {</td></tr>
<tr class="codeline" data-linenumber="2840"><td class="num" id="LN2840">2840</td><td class="line">      <span class='keyword'>case</span> <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>: <span class='comment'>// no marker found</span></td></tr>
<tr class="codeline" data-linenumber="2841"><td class="num" id="LN2841">2841</td><td class="line">         <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"expected marker"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("expected marker")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2842"><td class="num" id="LN2842">2842</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2843"><td class="num" id="LN2843">2843</td><td class="line">      <span class='keyword'>case</span> 0xDD: <span class='comment'>// DRI - specify restart interval</span></td></tr>
<tr class="codeline" data-linenumber="2844"><td class="num" id="LN2844">2844</td><td class="line">         <span class='keyword'>if</span> (stbi__get16be(z-&gt;s) != 4) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DRI len"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DRI len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2845"><td class="num" id="LN2845">2845</td><td class="line">         z-&gt;restart_interval = stbi__get16be(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2846"><td class="num" id="LN2846">2846</td><td class="line">         <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2847"><td class="num" id="LN2847">2847</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2848"><td class="num" id="LN2848">2848</td><td class="line">      <span class='keyword'>case</span> 0xDB: <span class='comment'>// DQT - define quantization table</span></td></tr>
<tr class="codeline" data-linenumber="2849"><td class="num" id="LN2849">2849</td><td class="line">         L = stbi__get16be(z-&gt;s)-2;</td></tr>
<tr class="codeline" data-linenumber="2850"><td class="num" id="LN2850">2850</td><td class="line">         <span class='keyword'>while</span> (L &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="2851"><td class="num" id="LN2851">2851</td><td class="line">            <span class='keyword'>int</span> q = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2852"><td class="num" id="LN2852">2852</td><td class="line">            <span class='keyword'>int</span> p = q &gt;&gt; 4, sixteen = (p != 0);</td></tr>
<tr class="codeline" data-linenumber="2853"><td class="num" id="LN2853">2853</td><td class="line">            <span class='keyword'>int</span> t = q &amp; 15,i;</td></tr>
<tr class="codeline" data-linenumber="2854"><td class="num" id="LN2854">2854</td><td class="line">            <span class='keyword'>if</span> (p != 0 &amp;&amp; p != 1) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DQT type"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DQT type")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2855"><td class="num" id="LN2855">2855</td><td class="line">            <span class='keyword'>if</span> (t &gt; 3) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DQT table"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DQT table")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2856"><td class="num" id="LN2856">2856</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2857"><td class="num" id="LN2857">2857</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; 64; ++i)</td></tr>
<tr class="codeline" data-linenumber="2858"><td class="num" id="LN2858">2858</td><td class="line">               z-&gt;dequant[t][stbi__jpeg_dezigzag[i]] = (stbi__uint16)(sixteen ? stbi__get16be(z-&gt;s) : stbi__get8(z-&gt;s));</td></tr>
<tr class="codeline" data-linenumber="2859"><td class="num" id="LN2859">2859</td><td class="line">            L -= (sixteen ? 129 : 65);</td></tr>
<tr class="codeline" data-linenumber="2860"><td class="num" id="LN2860">2860</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2861"><td class="num" id="LN2861">2861</td><td class="line">         <span class='keyword'>return</span> L==0;</td></tr>
<tr class="codeline" data-linenumber="2862"><td class="num" id="LN2862">2862</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2863"><td class="num" id="LN2863">2863</td><td class="line">      <span class='keyword'>case</span> 0xC4: <span class='comment'>// DHT - define huffman table</span></td></tr>
<tr class="codeline" data-linenumber="2864"><td class="num" id="LN2864">2864</td><td class="line">         L = stbi__get16be(z-&gt;s)-2;</td></tr>
<tr class="codeline" data-linenumber="2865"><td class="num" id="LN2865">2865</td><td class="line">         <span class='keyword'>while</span> (L &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="2866"><td class="num" id="LN2866">2866</td><td class="line">            stbi_uc *v;</td></tr>
<tr class="codeline" data-linenumber="2867"><td class="num" id="LN2867">2867</td><td class="line">            <span class='keyword'>int</span> sizes[16],i,n=0;</td></tr>
<tr class="codeline" data-linenumber="2868"><td class="num" id="LN2868">2868</td><td class="line">            <span class='keyword'>int</span> q = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2869"><td class="num" id="LN2869">2869</td><td class="line">            <span class='keyword'>int</span> tc = q &gt;&gt; 4;</td></tr>
<tr class="codeline" data-linenumber="2870"><td class="num" id="LN2870">2870</td><td class="line">            <span class='keyword'>int</span> th = q &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="2871"><td class="num" id="LN2871">2871</td><td class="line">            <span class='keyword'>if</span> (tc &gt; 1 || th &gt; 3) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DHT header"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DHT header")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2872"><td class="num" id="LN2872">2872</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; 16; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2873"><td class="num" id="LN2873">2873</td><td class="line">               sizes[i] = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2874"><td class="num" id="LN2874">2874</td><td class="line">               n += sizes[i];</td></tr>
<tr class="codeline" data-linenumber="2875"><td class="num" id="LN2875">2875</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2876"><td class="num" id="LN2876">2876</td><td class="line">            L -= 17;</td></tr>
<tr class="codeline" data-linenumber="2877"><td class="num" id="LN2877">2877</td><td class="line">            <span class='keyword'>if</span> (tc == 0) {</td></tr>
<tr class="codeline" data-linenumber="2878"><td class="num" id="LN2878">2878</td><td class="line">               <span class='keyword'>if</span> (!stbi__build_huffman(z-&gt;huff_dc+th, sizes)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2879"><td class="num" id="LN2879">2879</td><td class="line">               v = z-&gt;huff_dc[th].values;</td></tr>
<tr class="codeline" data-linenumber="2880"><td class="num" id="LN2880">2880</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2881"><td class="num" id="LN2881">2881</td><td class="line">               <span class='keyword'>if</span> (!stbi__build_huffman(z-&gt;huff_ac+th, sizes)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2882"><td class="num" id="LN2882">2882</td><td class="line">               v = z-&gt;huff_ac[th].values;</td></tr>
<tr class="codeline" data-linenumber="2883"><td class="num" id="LN2883">2883</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2884"><td class="num" id="LN2884">2884</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; n; ++i)</td></tr>
<tr class="codeline" data-linenumber="2885"><td class="num" id="LN2885">2885</td><td class="line">               v[i] = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2886"><td class="num" id="LN2886">2886</td><td class="line">            <span class='keyword'>if</span> (tc != 0)</td></tr>
<tr class="codeline" data-linenumber="2887"><td class="num" id="LN2887">2887</td><td class="line">               stbi__build_fast_ac(z-&gt;fast_ac[th], z-&gt;huff_ac + th);</td></tr>
<tr class="codeline" data-linenumber="2888"><td class="num" id="LN2888">2888</td><td class="line">            L -= n;</td></tr>
<tr class="codeline" data-linenumber="2889"><td class="num" id="LN2889">2889</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2890"><td class="num" id="LN2890">2890</td><td class="line">         <span class='keyword'>return</span> L==0;</td></tr>
<tr class="codeline" data-linenumber="2891"><td class="num" id="LN2891">2891</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2892"><td class="num" id="LN2892">2892</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2893"><td class="num" id="LN2893">2893</td><td class="line">   <span class='comment'>// check for comment block or APP blocks</span></td></tr>
<tr class="codeline" data-linenumber="2894"><td class="num" id="LN2894">2894</td><td class="line">   <span class='keyword'>if</span> ((m &gt;= 0xE0 &amp;&amp; m &lt;= 0xEF) || m == 0xFE) {</td></tr>
<tr class="codeline" data-linenumber="2895"><td class="num" id="LN2895">2895</td><td class="line">      L = stbi__get16be(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2896"><td class="num" id="LN2896">2896</td><td class="line">      <span class='keyword'>if</span> (L &lt; 2) {</td></tr>
<tr class="codeline" data-linenumber="2897"><td class="num" id="LN2897">2897</td><td class="line">         <span class='keyword'>if</span> (m == 0xFE)</td></tr>
<tr class="codeline" data-linenumber="2898"><td class="num" id="LN2898">2898</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad COM len"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad COM len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2899"><td class="num" id="LN2899">2899</td><td class="line">         <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2900"><td class="num" id="LN2900">2900</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad APP len"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad APP len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2901"><td class="num" id="LN2901">2901</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2902"><td class="num" id="LN2902">2902</td><td class="line">      L -= 2;</td></tr>
<tr class="codeline" data-linenumber="2903"><td class="num" id="LN2903">2903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2904"><td class="num" id="LN2904">2904</td><td class="line">      <span class='keyword'>if</span> (m == 0xE0 &amp;&amp; L &gt;= 5) { <span class='comment'>// JFIF APP0 segment</span></td></tr>
<tr class="codeline" data-linenumber="2905"><td class="num" id="LN2905">2905</td><td class="line">         <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> tag[5] = {'J','F','I','F','\0'};</td></tr>
<tr class="codeline" data-linenumber="2906"><td class="num" id="LN2906">2906</td><td class="line">         <span class='keyword'>int</span> ok = 1;</td></tr>
<tr class="codeline" data-linenumber="2907"><td class="num" id="LN2907">2907</td><td class="line">         <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2908"><td class="num" id="LN2908">2908</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; 5; ++i)</td></tr>
<tr class="codeline" data-linenumber="2909"><td class="num" id="LN2909">2909</td><td class="line">            <span class='keyword'>if</span> (stbi__get8(z-&gt;s) != tag[i])</td></tr>
<tr class="codeline" data-linenumber="2910"><td class="num" id="LN2910">2910</td><td class="line">               ok = 0;</td></tr>
<tr class="codeline" data-linenumber="2911"><td class="num" id="LN2911">2911</td><td class="line">         L -= 5;</td></tr>
<tr class="codeline" data-linenumber="2912"><td class="num" id="LN2912">2912</td><td class="line">         <span class='keyword'>if</span> (ok)</td></tr>
<tr class="codeline" data-linenumber="2913"><td class="num" id="LN2913">2913</td><td class="line">            z-&gt;jfif = 1;</td></tr>
<tr class="codeline" data-linenumber="2914"><td class="num" id="LN2914">2914</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (m == 0xEE &amp;&amp; L &gt;= 12) { <span class='comment'>// Adobe APP14 segment</span></td></tr>
<tr class="codeline" data-linenumber="2915"><td class="num" id="LN2915">2915</td><td class="line">         <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> tag[6] = {'A','d','o','b','e','\0'};</td></tr>
<tr class="codeline" data-linenumber="2916"><td class="num" id="LN2916">2916</td><td class="line">         <span class='keyword'>int</span> ok = 1;</td></tr>
<tr class="codeline" data-linenumber="2917"><td class="num" id="LN2917">2917</td><td class="line">         <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2918"><td class="num" id="LN2918">2918</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; 6; ++i)</td></tr>
<tr class="codeline" data-linenumber="2919"><td class="num" id="LN2919">2919</td><td class="line">            <span class='keyword'>if</span> (stbi__get8(z-&gt;s) != tag[i])</td></tr>
<tr class="codeline" data-linenumber="2920"><td class="num" id="LN2920">2920</td><td class="line">               ok = 0;</td></tr>
<tr class="codeline" data-linenumber="2921"><td class="num" id="LN2921">2921</td><td class="line">         L -= 6;</td></tr>
<tr class="codeline" data-linenumber="2922"><td class="num" id="LN2922">2922</td><td class="line">         <span class='keyword'>if</span> (ok) {</td></tr>
<tr class="codeline" data-linenumber="2923"><td class="num" id="LN2923">2923</td><td class="line">            stbi__get8(z-&gt;s); <span class='comment'>// version</span></td></tr>
<tr class="codeline" data-linenumber="2924"><td class="num" id="LN2924">2924</td><td class="line">            stbi__get16be(z-&gt;s); <span class='comment'>// flags0</span></td></tr>
<tr class="codeline" data-linenumber="2925"><td class="num" id="LN2925">2925</td><td class="line">            stbi__get16be(z-&gt;s); <span class='comment'>// flags1</span></td></tr>
<tr class="codeline" data-linenumber="2926"><td class="num" id="LN2926">2926</td><td class="line">            z-&gt;app14_color_transform = stbi__get8(z-&gt;s); <span class='comment'>// color transform</span></td></tr>
<tr class="codeline" data-linenumber="2927"><td class="num" id="LN2927">2927</td><td class="line">            L -= 6;</td></tr>
<tr class="codeline" data-linenumber="2928"><td class="num" id="LN2928">2928</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="2929"><td class="num" id="LN2929">2929</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2930"><td class="num" id="LN2930">2930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2931"><td class="num" id="LN2931">2931</td><td class="line">      stbi__skip(z-&gt;s, L);</td></tr>
<tr class="codeline" data-linenumber="2932"><td class="num" id="LN2932">2932</td><td class="line">      <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2933"><td class="num" id="LN2933">2933</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2934"><td class="num" id="LN2934">2934</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2935"><td class="num" id="LN2935">2935</td><td class="line">   <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"unknown marker"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("unknown marker")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2936"><td class="num" id="LN2936">2936</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2937"><td class="num" id="LN2937">2937</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2938"><td class="num" id="LN2938">2938</td><td class="line"><span class='comment'>// after we see SOS</span></td></tr>
<tr class="codeline" data-linenumber="2939"><td class="num" id="LN2939">2939</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__process_scan_header(stbi__jpeg *z)</td></tr>
<tr class="codeline" data-linenumber="2940"><td class="num" id="LN2940">2940</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2941"><td class="num" id="LN2941">2941</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2942"><td class="num" id="LN2942">2942</td><td class="line">   <span class='keyword'>int</span> Ls = stbi__get16be(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2943"><td class="num" id="LN2943">2943</td><td class="line">   z-&gt;scan_n = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2944"><td class="num" id="LN2944">2944</td><td class="line">   <span class='keyword'>if</span> (z-&gt;scan_n &lt; 1 || z-&gt;scan_n &gt; 4 || z-&gt;scan_n &gt; (<span class='keyword'>int</span>) z-&gt;s-&gt;img_n) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOS component count"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOS component count")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2945"><td class="num" id="LN2945">2945</td><td class="line">   <span class='keyword'>if</span> (Ls != 6+2*z-&gt;scan_n) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOS len"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOS len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2946"><td class="num" id="LN2946">2946</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; z-&gt;scan_n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2947"><td class="num" id="LN2947">2947</td><td class="line">      <span class='keyword'>int</span> id = stbi__get8(z-&gt;s), which;</td></tr>
<tr class="codeline" data-linenumber="2948"><td class="num" id="LN2948">2948</td><td class="line">      <span class='keyword'>int</span> q = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2949"><td class="num" id="LN2949">2949</td><td class="line">      <span class='keyword'>for</span> (which = 0; which &lt; z-&gt;s-&gt;img_n; ++which)</td></tr>
<tr class="codeline" data-linenumber="2950"><td class="num" id="LN2950">2950</td><td class="line">         <span class='keyword'>if</span> (z-&gt;img_comp[which].id == id)</td></tr>
<tr class="codeline" data-linenumber="2951"><td class="num" id="LN2951">2951</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2952"><td class="num" id="LN2952">2952</td><td class="line">      <span class='keyword'>if</span> (which == z-&gt;s-&gt;img_n) <span class='keyword'>return</span> 0; <span class='comment'>// no match</span></td></tr>
<tr class="codeline" data-linenumber="2953"><td class="num" id="LN2953">2953</td><td class="line">      z-&gt;img_comp[which].hd = q &gt;&gt; 4;   <span class='keyword'>if</span> (z-&gt;img_comp[which].hd &gt; 3) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DC huff"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DC huff")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2954"><td class="num" id="LN2954">2954</td><td class="line">      z-&gt;img_comp[which].ha = q &amp; 15;   <span class='keyword'>if</span> (z-&gt;img_comp[which].ha &gt; 3) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad AC huff"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad AC huff")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2955"><td class="num" id="LN2955">2955</td><td class="line">      z-&gt;order[i] = which;</td></tr>
<tr class="codeline" data-linenumber="2956"><td class="num" id="LN2956">2956</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2957"><td class="num" id="LN2957">2957</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2958"><td class="num" id="LN2958">2958</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="2959"><td class="num" id="LN2959">2959</td><td class="line">      <span class='keyword'>int</span> aa;</td></tr>
<tr class="codeline" data-linenumber="2960"><td class="num" id="LN2960">2960</td><td class="line">      z-&gt;spec_start = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2961"><td class="num" id="LN2961">2961</td><td class="line">      z-&gt;spec_end   = stbi__get8(z-&gt;s); <span class='comment'>// should be 63, but might be 0</span></td></tr>
<tr class="codeline" data-linenumber="2962"><td class="num" id="LN2962">2962</td><td class="line">      aa = stbi__get8(z-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="2963"><td class="num" id="LN2963">2963</td><td class="line">      z-&gt;succ_high = (aa &gt;&gt; 4);</td></tr>
<tr class="codeline" data-linenumber="2964"><td class="num" id="LN2964">2964</td><td class="line">      z-&gt;succ_low  = (aa &amp; 15);</td></tr>
<tr class="codeline" data-linenumber="2965"><td class="num" id="LN2965">2965</td><td class="line">      <span class='keyword'>if</span> (z-&gt;progressive) {</td></tr>
<tr class="codeline" data-linenumber="2966"><td class="num" id="LN2966">2966</td><td class="line">         <span class='keyword'>if</span> (z-&gt;spec_start &gt; 63 || z-&gt;spec_end &gt; 63  || z-&gt;spec_start &gt; z-&gt;spec_end || z-&gt;succ_high &gt; 13 || z-&gt;succ_low &gt; 13)</td></tr>
<tr class="codeline" data-linenumber="2967"><td class="num" id="LN2967">2967</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOS"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOS")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2968"><td class="num" id="LN2968">2968</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2969"><td class="num" id="LN2969">2969</td><td class="line">         <span class='keyword'>if</span> (z-&gt;spec_start != 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOS"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOS")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2970"><td class="num" id="LN2970">2970</td><td class="line">         <span class='keyword'>if</span> (z-&gt;succ_high != 0 || z-&gt;succ_low != 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOS"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOS")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2971"><td class="num" id="LN2971">2971</td><td class="line">         z-&gt;spec_end = 63;</td></tr>
<tr class="codeline" data-linenumber="2972"><td class="num" id="LN2972">2972</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2973"><td class="num" id="LN2973">2973</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2974"><td class="num" id="LN2974">2974</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2975"><td class="num" id="LN2975">2975</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2976"><td class="num" id="LN2976">2976</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2977"><td class="num" id="LN2977">2977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2978"><td class="num" id="LN2978">2978</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__free_jpeg_components(stbi__jpeg *z, <span class='keyword'>int</span> ncomp, <span class='keyword'>int</span> why)</td></tr>
<tr class="codeline" data-linenumber="2979"><td class="num" id="LN2979">2979</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2980"><td class="num" id="LN2980">2980</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2981"><td class="num" id="LN2981">2981</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; ncomp; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2982"><td class="num" id="LN2982">2982</td><td class="line">      <span class='keyword'>if</span> (z-&gt;img_comp[i].raw_data) {</td></tr>
<tr class="codeline" data-linenumber="2983"><td class="num" id="LN2983">2983</td><td class="line">         <span class='macro'>STBI_FREE(z-&gt;img_comp[i].raw_data)<span class='macro_popup'>free(z-&gt;img_comp[i].raw_data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2984"><td class="num" id="LN2984">2984</td><td class="line">         z-&gt;img_comp[i].raw_data = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2985"><td class="num" id="LN2985">2985</td><td class="line">         z-&gt;img_comp[i].data = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2986"><td class="num" id="LN2986">2986</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2987"><td class="num" id="LN2987">2987</td><td class="line">      <span class='keyword'>if</span> (z-&gt;img_comp[i].raw_coeff) {</td></tr>
<tr class="codeline" data-linenumber="2988"><td class="num" id="LN2988">2988</td><td class="line">         <span class='macro'>STBI_FREE(z-&gt;img_comp[i].raw_coeff)<span class='macro_popup'>free(z-&gt;img_comp[i].raw_coeff)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2989"><td class="num" id="LN2989">2989</td><td class="line">         z-&gt;img_comp[i].raw_coeff = 0;</td></tr>
<tr class="codeline" data-linenumber="2990"><td class="num" id="LN2990">2990</td><td class="line">         z-&gt;img_comp[i].coeff = 0;</td></tr>
<tr class="codeline" data-linenumber="2991"><td class="num" id="LN2991">2991</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2992"><td class="num" id="LN2992">2992</td><td class="line">      <span class='keyword'>if</span> (z-&gt;img_comp[i].linebuf) {</td></tr>
<tr class="codeline" data-linenumber="2993"><td class="num" id="LN2993">2993</td><td class="line">         <span class='macro'>STBI_FREE(z-&gt;img_comp[i].linebuf)<span class='macro_popup'>free(z-&gt;img_comp[i].linebuf)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2994"><td class="num" id="LN2994">2994</td><td class="line">         z-&gt;img_comp[i].linebuf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2995"><td class="num" id="LN2995">2995</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2996"><td class="num" id="LN2996">2996</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="2997"><td class="num" id="LN2997">2997</td><td class="line">   <span class='keyword'>return</span> why;</td></tr>
<tr class="codeline" data-linenumber="2998"><td class="num" id="LN2998">2998</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2999"><td class="num" id="LN2999">2999</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3000"><td class="num" id="LN3000">3000</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__process_frame_header(stbi__jpeg *z, <span class='keyword'>int</span> scan)</td></tr>
<tr class="codeline" data-linenumber="3001"><td class="num" id="LN3001">3001</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3002"><td class="num" id="LN3002">3002</td><td class="line">   stbi__context *s = z-&gt;s;</td></tr>
<tr class="codeline" data-linenumber="3003"><td class="num" id="LN3003">3003</td><td class="line">   <span class='keyword'>int</span> Lf,p,i,q, h_max=1,v_max=1,c;</td></tr>
<tr class="codeline" data-linenumber="3004"><td class="num" id="LN3004">3004</td><td class="line">   Lf = stbi__get16be(s);         <span class='keyword'>if</span> (Lf &lt; 11) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOF len"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOF len")</span></span>; <span class='comment'>// JPEG</span></td></tr>
<tr class="codeline" data-linenumber="3005"><td class="num" id="LN3005">3005</td><td class="line">   p  = stbi__get8(s);            <span class='keyword'>if</span> (p != 8) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"only 8-bit"</span>,<span class='string_literal'>"JPEG format not supported: 8-bit only"</span>)<span class='macro_popup'>stbi__err("only 8-bit")</span></span>; <span class='comment'>// JPEG baseline</span></td></tr>
<tr class="codeline" data-linenumber="3006"><td class="num" id="LN3006">3006</td><td class="line">   s-&gt;img_y = stbi__get16be(s);   <span class='keyword'>if</span> (s-&gt;img_y == 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"no header height"</span>, <span class='string_literal'>"JPEG format not supported: delayed height"</span>)<span class='macro_popup'>stbi__err("no header height")</span></span>; <span class='comment'>// Legal, but we don't handle it--but neither does IJG</span></td></tr>
<tr class="codeline" data-linenumber="3007"><td class="num" id="LN3007">3007</td><td class="line">   s-&gt;img_x = stbi__get16be(s);   <span class='keyword'>if</span> (s-&gt;img_x == 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"0 width"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("0 width")</span></span>; <span class='comment'>// JPEG requires</span></td></tr>
<tr class="codeline" data-linenumber="3008"><td class="num" id="LN3008">3008</td><td class="line">   c = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="3009"><td class="num" id="LN3009">3009</td><td class="line">   <span class='keyword'>if</span> (c != 3 &amp;&amp; c != 1 &amp;&amp; c != 4) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad component count"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad component count")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3010"><td class="num" id="LN3010">3010</td><td class="line">   s-&gt;img_n = c;</td></tr>
<tr class="codeline" data-linenumber="3011"><td class="num" id="LN3011">3011</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; c; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3012"><td class="num" id="LN3012">3012</td><td class="line">      z-&gt;img_comp[i].data = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3013"><td class="num" id="LN3013">3013</td><td class="line">      z-&gt;img_comp[i].linebuf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3014"><td class="num" id="LN3014">3014</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3015"><td class="num" id="LN3015">3015</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3016"><td class="num" id="LN3016">3016</td><td class="line">   <span class='keyword'>if</span> (Lf != 8+3*s-&gt;img_n) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad SOF len"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad SOF len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3017"><td class="num" id="LN3017">3017</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3018"><td class="num" id="LN3018">3018</td><td class="line">   z-&gt;rgb = 0;</td></tr>
<tr class="codeline" data-linenumber="3019"><td class="num" id="LN3019">3019</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; s-&gt;img_n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3020"><td class="num" id="LN3020">3020</td><td class="line">      <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> rgb[3] = { 'R', 'G', 'B' };</td></tr>
<tr class="codeline" data-linenumber="3021"><td class="num" id="LN3021">3021</td><td class="line">      z-&gt;img_comp[i].id = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="3022"><td class="num" id="LN3022">3022</td><td class="line">      <span class='keyword'>if</span> (s-&gt;img_n == 3 &amp;&amp; z-&gt;img_comp[i].id == rgb[i])</td></tr>
<tr class="codeline" data-linenumber="3023"><td class="num" id="LN3023">3023</td><td class="line">         ++z-&gt;rgb;</td></tr>
<tr class="codeline" data-linenumber="3024"><td class="num" id="LN3024">3024</td><td class="line">      q = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="3025"><td class="num" id="LN3025">3025</td><td class="line">      z-&gt;img_comp[i].h = (q &gt;&gt; 4);  <span class='keyword'>if</span> (!z-&gt;img_comp[i].h || z-&gt;img_comp[i].h &gt; 4) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad H"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad H")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3026"><td class="num" id="LN3026">3026</td><td class="line">      z-&gt;img_comp[i].v = q &amp; 15;    <span class='keyword'>if</span> (!z-&gt;img_comp[i].v || z-&gt;img_comp[i].v &gt; 4) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad V"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad V")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3027"><td class="num" id="LN3027">3027</td><td class="line">      z-&gt;img_comp[i].tq = stbi__get8(s);  <span class='keyword'>if</span> (z-&gt;img_comp[i].tq &gt; 3) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad TQ"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad TQ")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3028"><td class="num" id="LN3028">3028</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3029"><td class="num" id="LN3029">3029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3030"><td class="num" id="LN3030">3030</td><td class="line">   <span class='keyword'>if</span> (scan != STBI__SCAN_load) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3031"><td class="num" id="LN3031">3031</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3032"><td class="num" id="LN3032">3032</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(s-&gt;img_x, s-&gt;img_y, s-&gt;img_n, 0)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"Image too large to decode"</span>)<span class='macro_popup'>stbi__err("too large")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3033"><td class="num" id="LN3033">3033</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3034"><td class="num" id="LN3034">3034</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; s-&gt;img_n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3035"><td class="num" id="LN3035">3035</td><td class="line">      <span class='keyword'>if</span> (z-&gt;img_comp[i].h &gt; h_max) h_max = z-&gt;img_comp[i].h;</td></tr>
<tr class="codeline" data-linenumber="3036"><td class="num" id="LN3036">3036</td><td class="line">      <span class='keyword'>if</span> (z-&gt;img_comp[i].v &gt; v_max) v_max = z-&gt;img_comp[i].v;</td></tr>
<tr class="codeline" data-linenumber="3037"><td class="num" id="LN3037">3037</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3038"><td class="num" id="LN3038">3038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3039"><td class="num" id="LN3039">3039</td><td class="line">   <span class='comment'>// compute interleaved mcu info</span></td></tr>
<tr class="codeline" data-linenumber="3040"><td class="num" id="LN3040">3040</td><td class="line">   z-&gt;img_h_max = h_max;</td></tr>
<tr class="codeline" data-linenumber="3041"><td class="num" id="LN3041">3041</td><td class="line">   z-&gt;img_v_max = v_max;</td></tr>
<tr class="codeline" data-linenumber="3042"><td class="num" id="LN3042">3042</td><td class="line">   z-&gt;img_mcu_w = h_max * 8;</td></tr>
<tr class="codeline" data-linenumber="3043"><td class="num" id="LN3043">3043</td><td class="line">   z-&gt;img_mcu_h = v_max * 8;</td></tr>
<tr class="codeline" data-linenumber="3044"><td class="num" id="LN3044">3044</td><td class="line">   <span class='comment'>// these sizes can't be more than 17 bits</span></td></tr>
<tr class="codeline" data-linenumber="3045"><td class="num" id="LN3045">3045</td><td class="line">   z-&gt;img_mcu_x = (s-&gt;img_x + z-&gt;img_mcu_w-1) / z-&gt;img_mcu_w;</td></tr>
<tr class="codeline" data-linenumber="3046"><td class="num" id="LN3046">3046</td><td class="line">   z-&gt;img_mcu_y = (s-&gt;img_y + z-&gt;img_mcu_h-1) / z-&gt;img_mcu_h;</td></tr>
<tr class="codeline" data-linenumber="3047"><td class="num" id="LN3047">3047</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3048"><td class="num" id="LN3048">3048</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; s-&gt;img_n; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3049"><td class="num" id="LN3049">3049</td><td class="line">      <span class='comment'>// number of effective pixels (e.g. for non-interleaved MCU)</span></td></tr>
<tr class="codeline" data-linenumber="3050"><td class="num" id="LN3050">3050</td><td class="line">      z-&gt;img_comp[i].x = (s-&gt;img_x * z-&gt;img_comp[i].h + h_max-1) / h_max;</td></tr>
<tr class="codeline" data-linenumber="3051"><td class="num" id="LN3051">3051</td><td class="line">      z-&gt;img_comp[i].y = (s-&gt;img_y * z-&gt;img_comp[i].v + v_max-1) / v_max;</td></tr>
<tr class="codeline" data-linenumber="3052"><td class="num" id="LN3052">3052</td><td class="line">      <span class='comment'>// to simplify generation, we'll allocate enough memory to decode</span></td></tr>
<tr class="codeline" data-linenumber="3053"><td class="num" id="LN3053">3053</td><td class="line">      <span class='comment'>// the bogus oversized data from using interleaved MCUs and their</span></td></tr>
<tr class="codeline" data-linenumber="3054"><td class="num" id="LN3054">3054</td><td class="line">      <span class='comment'>// big blocks (e.g. a 16x16 iMCU on an image of width 33); we won't</span></td></tr>
<tr class="codeline" data-linenumber="3055"><td class="num" id="LN3055">3055</td><td class="line">      <span class='comment'>// discard the extra data until colorspace conversion</span></td></tr>
<tr class="codeline" data-linenumber="3056"><td class="num" id="LN3056">3056</td><td class="line">      <span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="3057"><td class="num" id="LN3057">3057</td><td class="line">      <span class='comment'>// img_mcu_x, img_mcu_y: &lt;=17 bits; comp[i].h and .v are &lt;=4 (checked earlier)</span></td></tr>
<tr class="codeline" data-linenumber="3058"><td class="num" id="LN3058">3058</td><td class="line">      <span class='comment'>// so these muls can't overflow with 32-bit ints (which we require)</span></td></tr>
<tr class="codeline" data-linenumber="3059"><td class="num" id="LN3059">3059</td><td class="line">      z-&gt;img_comp[i].w2 = z-&gt;img_mcu_x * z-&gt;img_comp[i].h * 8;</td></tr>
<tr class="codeline" data-linenumber="3060"><td class="num" id="LN3060">3060</td><td class="line">      z-&gt;img_comp[i].h2 = z-&gt;img_mcu_y * z-&gt;img_comp[i].v * 8;</td></tr>
<tr class="codeline" data-linenumber="3061"><td class="num" id="LN3061">3061</td><td class="line">      z-&gt;img_comp[i].coeff = 0;</td></tr>
<tr class="codeline" data-linenumber="3062"><td class="num" id="LN3062">3062</td><td class="line">      z-&gt;img_comp[i].raw_coeff = 0;</td></tr>
<tr class="codeline" data-linenumber="3063"><td class="num" id="LN3063">3063</td><td class="line">      z-&gt;img_comp[i].linebuf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3064"><td class="num" id="LN3064">3064</td><td class="line">      z-&gt;img_comp[i].raw_data = stbi__malloc_mad2(z-&gt;img_comp[i].w2, z-&gt;img_comp[i].h2, 15);</td></tr>
<tr class="codeline" data-linenumber="3065"><td class="num" id="LN3065">3065</td><td class="line">      <span class='keyword'>if</span> (z-&gt;img_comp[i].raw_data == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3066"><td class="num" id="LN3066">3066</td><td class="line">         <span class='keyword'>return</span> stbi__free_jpeg_components(z, i+1, <span class='macro'>stbi__err(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>stbi__err("outofmem")</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3067"><td class="num" id="LN3067">3067</td><td class="line">      <span class='comment'>// align blocks for idct using mmx/sse</span></td></tr>
<tr class="codeline" data-linenumber="3068"><td class="num" id="LN3068">3068</td><td class="line">      z-&gt;img_comp[i].data = (stbi_uc*) (((size_t) z-&gt;img_comp[i].raw_data + 15) &amp; ~15);</td></tr>
<tr class="codeline" data-linenumber="3069"><td class="num" id="LN3069">3069</td><td class="line">      <span class='keyword'>if</span> (z-&gt;progressive) {</td></tr>
<tr class="codeline" data-linenumber="3070"><td class="num" id="LN3070">3070</td><td class="line">         <span class='comment'>// w2, h2 are multiples of 8 (see above)</span></td></tr>
<tr class="codeline" data-linenumber="3071"><td class="num" id="LN3071">3071</td><td class="line">         z-&gt;img_comp[i].coeff_w = z-&gt;img_comp[i].w2 / 8;</td></tr>
<tr class="codeline" data-linenumber="3072"><td class="num" id="LN3072">3072</td><td class="line">         z-&gt;img_comp[i].coeff_h = z-&gt;img_comp[i].h2 / 8;</td></tr>
<tr class="codeline" data-linenumber="3073"><td class="num" id="LN3073">3073</td><td class="line">         z-&gt;img_comp[i].raw_coeff = stbi__malloc_mad3(z-&gt;img_comp[i].w2, z-&gt;img_comp[i].h2, <span class='keyword'>sizeof</span>(<span class='keyword'>short</span>), 15);</td></tr>
<tr class="codeline" data-linenumber="3074"><td class="num" id="LN3074">3074</td><td class="line">         <span class='keyword'>if</span> (z-&gt;img_comp[i].raw_coeff == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3075"><td class="num" id="LN3075">3075</td><td class="line">            <span class='keyword'>return</span> stbi__free_jpeg_components(z, i+1, <span class='macro'>stbi__err(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>stbi__err("outofmem")</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3076"><td class="num" id="LN3076">3076</td><td class="line">         z-&gt;img_comp[i].coeff = (<span class='keyword'>short</span>*) (((size_t) z-&gt;img_comp[i].raw_coeff + 15) &amp; ~15);</td></tr>
<tr class="codeline" data-linenumber="3077"><td class="num" id="LN3077">3077</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3078"><td class="num" id="LN3078">3078</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3079"><td class="num" id="LN3079">3079</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3080"><td class="num" id="LN3080">3080</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3081"><td class="num" id="LN3081">3081</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3082"><td class="num" id="LN3082">3082</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3083"><td class="num" id="LN3083">3083</td><td class="line"><span class='comment'>// use comparisons since in some cases we handle more than one case (e.g. SOF)</span></td></tr>
<tr class="codeline" data-linenumber="3084"><td class="num" id="LN3084">3084</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__DNL(x)<span class='macro_popup'>((x) == 0xdc)</span></span>         ((x) == 0xdc)</span></td></tr>
<tr class="codeline" data-linenumber="3085"><td class="num" id="LN3085">3085</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__SOI(x)<span class='macro_popup'>((x) == 0xd8)</span></span>         ((x) == 0xd8)</span></td></tr>
<tr class="codeline" data-linenumber="3086"><td class="num" id="LN3086">3086</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__EOI(x)<span class='macro_popup'>((x) == 0xd9)</span></span>         ((x) == 0xd9)</span></td></tr>
<tr class="codeline" data-linenumber="3087"><td class="num" id="LN3087">3087</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__SOF(x)<span class='macro_popup'>((x) == 0xc0 || (x) == 0xc1 || (x) == 0xc2)</span></span>         ((x) == 0xc0 || (x) == 0xc1 || (x) == 0xc2)</span></td></tr>
<tr class="codeline" data-linenumber="3088"><td class="num" id="LN3088">3088</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__SOS(x)<span class='macro_popup'>((x) == 0xda)</span></span>         ((x) == 0xda)</span></td></tr>
<tr class="codeline" data-linenumber="3089"><td class="num" id="LN3089">3089</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3090"><td class="num" id="LN3090">3090</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__SOF_progressive(x)<span class='macro_popup'>((x) == 0xc2)</span></span>   ((x) == 0xc2)</span></td></tr>
<tr class="codeline" data-linenumber="3091"><td class="num" id="LN3091">3091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3092"><td class="num" id="LN3092">3092</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__decode_jpeg_header(stbi__jpeg *z, <span class='keyword'>int</span> scan)</td></tr>
<tr class="codeline" data-linenumber="3093"><td class="num" id="LN3093">3093</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3094"><td class="num" id="LN3094">3094</td><td class="line">   <span class='keyword'>int</span> m;</td></tr>
<tr class="codeline" data-linenumber="3095"><td class="num" id="LN3095">3095</td><td class="line">   z-&gt;jfif = 0;</td></tr>
<tr class="codeline" data-linenumber="3096"><td class="num" id="LN3096">3096</td><td class="line">   z-&gt;app14_color_transform = -1; <span class='comment'>// valid values are 0,1,2</span></td></tr>
<tr class="codeline" data-linenumber="3097"><td class="num" id="LN3097">3097</td><td class="line">   z-&gt;marker = <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>; <span class='comment'>// initialize cached marker to empty</span></td></tr>
<tr class="codeline" data-linenumber="3098"><td class="num" id="LN3098">3098</td><td class="line">   m = stbi__get_marker(z);</td></tr>
<tr class="codeline" data-linenumber="3099"><td class="num" id="LN3099">3099</td><td class="line">   <span class='keyword'>if</span> (!<span class='macro'>stbi__SOI(m)<span class='macro_popup'>((m) == 0xd8)</span></span>) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"no SOI"</span>,<span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("no SOI")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3100"><td class="num" id="LN3100">3100</td><td class="line">   <span class='keyword'>if</span> (scan == STBI__SCAN_type) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3101"><td class="num" id="LN3101">3101</td><td class="line">   m = stbi__get_marker(z);</td></tr>
<tr class="codeline" data-linenumber="3102"><td class="num" id="LN3102">3102</td><td class="line">   <span class='keyword'>while</span> (!<span class='macro'>stbi__SOF(m)<span class='macro_popup'>((m) == 0xc0 || (m) == 0xc1 || (m) == 0xc2)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3103"><td class="num" id="LN3103">3103</td><td class="line">      <span class='keyword'>if</span> (!stbi__process_marker(z,m)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3104"><td class="num" id="LN3104">3104</td><td class="line">      m = stbi__get_marker(z);</td></tr>
<tr class="codeline" data-linenumber="3105"><td class="num" id="LN3105">3105</td><td class="line">      <span class='keyword'>while</span> (m == <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3106"><td class="num" id="LN3106">3106</td><td class="line">         <span class='comment'>// some files have extra padding after their blocks, so ok, we'll scan</span></td></tr>
<tr class="codeline" data-linenumber="3107"><td class="num" id="LN3107">3107</td><td class="line">         <span class='keyword'>if</span> (stbi__at_eof(z-&gt;s)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"no SOF"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("no SOF")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3108"><td class="num" id="LN3108">3108</td><td class="line">         m = stbi__get_marker(z);</td></tr>
<tr class="codeline" data-linenumber="3109"><td class="num" id="LN3109">3109</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3110"><td class="num" id="LN3110">3110</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3111"><td class="num" id="LN3111">3111</td><td class="line">   z-&gt;progressive = <span class='macro'>stbi__SOF_progressive(m)<span class='macro_popup'>((m) == 0xc2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3112"><td class="num" id="LN3112">3112</td><td class="line">   <span class='keyword'>if</span> (!stbi__process_frame_header(z, scan)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3113"><td class="num" id="LN3113">3113</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3114"><td class="num" id="LN3114">3114</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3115"><td class="num" id="LN3115">3115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3116"><td class="num" id="LN3116">3116</td><td class="line"><span class='comment'>// decode image to YCbCr format</span></td></tr>
<tr class="codeline" data-linenumber="3117"><td class="num" id="LN3117">3117</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__decode_jpeg_image(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="3118"><td class="num" id="LN3118">3118</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3119"><td class="num" id="LN3119">3119</td><td class="line">   <span class='keyword'>int</span> m;</td></tr>
<tr class="codeline" data-linenumber="3120"><td class="num" id="LN3120">3120</td><td class="line">   <span class='keyword'>for</span> (m = 0; m &lt; 4; m++) {</td></tr>
<tr class="codeline" data-linenumber="3121"><td class="num" id="LN3121">3121</td><td class="line">      j-&gt;img_comp[m].raw_data = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3122"><td class="num" id="LN3122">3122</td><td class="line">      j-&gt;img_comp[m].raw_coeff = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3123"><td class="num" id="LN3123">3123</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3124"><td class="num" id="LN3124">3124</td><td class="line">   j-&gt;restart_interval = 0;</td></tr>
<tr class="codeline" data-linenumber="3125"><td class="num" id="LN3125">3125</td><td class="line">   <span class='keyword'>if</span> (!stbi__decode_jpeg_header(j, STBI__SCAN_load)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3126"><td class="num" id="LN3126">3126</td><td class="line">   m = stbi__get_marker(j);</td></tr>
<tr class="codeline" data-linenumber="3127"><td class="num" id="LN3127">3127</td><td class="line">   <span class='keyword'>while</span> (!<span class='macro'>stbi__EOI(m)<span class='macro_popup'>((m) == 0xd9)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3128"><td class="num" id="LN3128">3128</td><td class="line">      <span class='keyword'>if</span> (<span class='macro'>stbi__SOS(m)<span class='macro_popup'>((m) == 0xda)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3129"><td class="num" id="LN3129">3129</td><td class="line">         <span class='keyword'>if</span> (!stbi__process_scan_header(j)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3130"><td class="num" id="LN3130">3130</td><td class="line">         <span class='keyword'>if</span> (!stbi__parse_entropy_coded_data(j)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3131"><td class="num" id="LN3131">3131</td><td class="line">         <span class='keyword'>if</span> (j-&gt;marker == <span class='macro'>STBI__MARKER_none<span class='macro_popup'>0xff</span></span> ) {</td></tr>
<tr class="codeline" data-linenumber="3132"><td class="num" id="LN3132">3132</td><td class="line">            <span class='comment'>// handle 0s at the end of image data from IP Kamera 9060</span></td></tr>
<tr class="codeline" data-linenumber="3133"><td class="num" id="LN3133">3133</td><td class="line">            <span class='keyword'>while</span> (!stbi__at_eof(j-&gt;s)) {</td></tr>
<tr class="codeline" data-linenumber="3134"><td class="num" id="LN3134">3134</td><td class="line">               <span class='keyword'>int</span> x = stbi__get8(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="3135"><td class="num" id="LN3135">3135</td><td class="line">               <span class='keyword'>if</span> (x == 255) {</td></tr>
<tr class="codeline" data-linenumber="3136"><td class="num" id="LN3136">3136</td><td class="line">                  j-&gt;marker = stbi__get8(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="3137"><td class="num" id="LN3137">3137</td><td class="line">                  <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3138"><td class="num" id="LN3138">3138</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3139"><td class="num" id="LN3139">3139</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3140"><td class="num" id="LN3140">3140</td><td class="line">            <span class='comment'>// if we reach eof without hitting a marker, stbi__get_marker() below will fail and we'll eventually return 0</span></td></tr>
<tr class="codeline" data-linenumber="3141"><td class="num" id="LN3141">3141</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="3142"><td class="num" id="LN3142">3142</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>stbi__DNL(m)<span class='macro_popup'>((m) == 0xdc)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3143"><td class="num" id="LN3143">3143</td><td class="line">         <span class='keyword'>int</span> Ld = stbi__get16be(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="3144"><td class="num" id="LN3144">3144</td><td class="line">         stbi__uint32 NL = stbi__get16be(j-&gt;s);</td></tr>
<tr class="codeline" data-linenumber="3145"><td class="num" id="LN3145">3145</td><td class="line">         <span class='keyword'>if</span> (Ld != 4) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DNL len"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DNL len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3146"><td class="num" id="LN3146">3146</td><td class="line">         <span class='keyword'>if</span> (NL != j-&gt;s-&gt;img_y) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad DNL height"</span>, <span class='string_literal'>"Corrupt JPEG"</span>)<span class='macro_popup'>stbi__err("bad DNL height")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3147"><td class="num" id="LN3147">3147</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3148"><td class="num" id="LN3148">3148</td><td class="line">         <span class='keyword'>if</span> (!stbi__process_marker(j, m)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3149"><td class="num" id="LN3149">3149</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3150"><td class="num" id="LN3150">3150</td><td class="line">      m = stbi__get_marker(j);</td></tr>
<tr class="codeline" data-linenumber="3151"><td class="num" id="LN3151">3151</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3152"><td class="num" id="LN3152">3152</td><td class="line">   <span class='keyword'>if</span> (j-&gt;progressive)</td></tr>
<tr class="codeline" data-linenumber="3153"><td class="num" id="LN3153">3153</td><td class="line">      stbi__jpeg_finish(j);</td></tr>
<tr class="codeline" data-linenumber="3154"><td class="num" id="LN3154">3154</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3155"><td class="num" id="LN3155">3155</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3156"><td class="num" id="LN3156">3156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3157"><td class="num" id="LN3157">3157</td><td class="line"><span class='comment'>// static jfif-centered resampling (across block boundaries)</span></td></tr>
<tr class="codeline" data-linenumber="3158"><td class="num" id="LN3158">3158</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3159"><td class="num" id="LN3159">3159</td><td class="line"><span class='keyword'>typedef</span> stbi_uc *(*resample_row_func)(stbi_uc *out, stbi_uc *in0, stbi_uc *in1,</td></tr>
<tr class="codeline" data-linenumber="3160"><td class="num" id="LN3160">3160</td><td class="line">                                    <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs);</td></tr>
<tr class="codeline" data-linenumber="3161"><td class="num" id="LN3161">3161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3162"><td class="num" id="LN3162">3162</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__div4(x)<span class='macro_popup'>((stbi_uc) ((x) &gt;&gt; 2))</span></span> ((stbi_uc) ((x) &gt;&gt; 2))</span></td></tr>
<tr class="codeline" data-linenumber="3163"><td class="num" id="LN3163">3163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3164"><td class="num" id="LN3164">3164</td><td class="line"><span class='keyword'>static</span> stbi_uc *resample_row_1(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs)</td></tr>
<tr class="codeline" data-linenumber="3165"><td class="num" id="LN3165">3165</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3166"><td class="num" id="LN3166">3166</td><td class="line">   <span class='macro'>STBI_NOTUSED(out)<span class='macro_popup'>(void)sizeof(out)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3167"><td class="num" id="LN3167">3167</td><td class="line">   <span class='macro'>STBI_NOTUSED(in_far)<span class='macro_popup'>(void)sizeof(in_far)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3168"><td class="num" id="LN3168">3168</td><td class="line">   <span class='macro'>STBI_NOTUSED(w)<span class='macro_popup'>(void)sizeof(w)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3169"><td class="num" id="LN3169">3169</td><td class="line">   <span class='macro'>STBI_NOTUSED(hs)<span class='macro_popup'>(void)sizeof(hs)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3170"><td class="num" id="LN3170">3170</td><td class="line">   <span class='keyword'>return</span> in_near;</td></tr>
<tr class="codeline" data-linenumber="3171"><td class="num" id="LN3171">3171</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3172"><td class="num" id="LN3172">3172</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3173"><td class="num" id="LN3173">3173</td><td class="line"><span class='keyword'>static</span> stbi_uc* stbi__resample_row_v_2(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs)</td></tr>
<tr class="codeline" data-linenumber="3174"><td class="num" id="LN3174">3174</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3175"><td class="num" id="LN3175">3175</td><td class="line">   <span class='comment'>// need to generate two samples vertically for every one in input</span></td></tr>
<tr class="codeline" data-linenumber="3176"><td class="num" id="LN3176">3176</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="3177"><td class="num" id="LN3177">3177</td><td class="line">   <span class='macro'>STBI_NOTUSED(hs)<span class='macro_popup'>(void)sizeof(hs)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3178"><td class="num" id="LN3178">3178</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; w; ++i)</td></tr>
<tr class="codeline" data-linenumber="3179"><td class="num" id="LN3179">3179</td><td class="line">      out[i] = <span class='macro'>stbi__div4(3*in_near[i] + in_far[i] + 2)<span class='macro_popup'>((stbi_uc) ((3*in_near[i] + in_far[i] + 2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3180"><td class="num" id="LN3180">3180</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3181"><td class="num" id="LN3181">3181</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3182"><td class="num" id="LN3182">3182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3183"><td class="num" id="LN3183">3183</td><td class="line"><span class='keyword'>static</span> stbi_uc*  stbi__resample_row_h_2(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs)</td></tr>
<tr class="codeline" data-linenumber="3184"><td class="num" id="LN3184">3184</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3185"><td class="num" id="LN3185">3185</td><td class="line">   <span class='comment'>// need to generate two samples horizontally for every one in input</span></td></tr>
<tr class="codeline" data-linenumber="3186"><td class="num" id="LN3186">3186</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="3187"><td class="num" id="LN3187">3187</td><td class="line">   stbi_uc *input = in_near;</td></tr>
<tr class="codeline" data-linenumber="3188"><td class="num" id="LN3188">3188</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3189"><td class="num" id="LN3189">3189</td><td class="line">   <span class='keyword'>if</span> (w == 1) {</td></tr>
<tr class="codeline" data-linenumber="3190"><td class="num" id="LN3190">3190</td><td class="line">      <span class='comment'>// if only one sample, can't do any interpolation</span></td></tr>
<tr class="codeline" data-linenumber="3191"><td class="num" id="LN3191">3191</td><td class="line">      out[0] = out[1] = input[0];</td></tr>
<tr class="codeline" data-linenumber="3192"><td class="num" id="LN3192">3192</td><td class="line">      <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3193"><td class="num" id="LN3193">3193</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3194"><td class="num" id="LN3194">3194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3195"><td class="num" id="LN3195">3195</td><td class="line">   out[0] = input[0];</td></tr>
<tr class="codeline" data-linenumber="3196"><td class="num" id="LN3196">3196</td><td class="line">   out[1] = <span class='macro'>stbi__div4(input[0]*3 + input[1] + 2)<span class='macro_popup'>((stbi_uc) ((input[0]*3 + input[1] + 2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3197"><td class="num" id="LN3197">3197</td><td class="line">   <span class='keyword'>for</span> (i=1; i &lt; w-1; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3198"><td class="num" id="LN3198">3198</td><td class="line">      <span class='keyword'>int</span> n = 3*input[i]+2;</td></tr>
<tr class="codeline" data-linenumber="3199"><td class="num" id="LN3199">3199</td><td class="line">      out[i*2+0] = <span class='macro'>stbi__div4(n+input[i-1])<span class='macro_popup'>((stbi_uc) ((n+input[i-1]) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3200"><td class="num" id="LN3200">3200</td><td class="line">      out[i*2+1] = <span class='macro'>stbi__div4(n+input[i+1])<span class='macro_popup'>((stbi_uc) ((n+input[i+1]) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3201"><td class="num" id="LN3201">3201</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3202"><td class="num" id="LN3202">3202</td><td class="line">   out[i*2+0] = <span class='macro'>stbi__div4(input[w-2]*3 + input[w-1] + 2)<span class='macro_popup'>((stbi_uc) ((input[w-2]*3 + input[w-1] + 2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3203"><td class="num" id="LN3203">3203</td><td class="line">   out[i*2+1] = input[w-1];</td></tr>
<tr class="codeline" data-linenumber="3204"><td class="num" id="LN3204">3204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3205"><td class="num" id="LN3205">3205</td><td class="line">   <span class='macro'>STBI_NOTUSED(in_far)<span class='macro_popup'>(void)sizeof(in_far)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3206"><td class="num" id="LN3206">3206</td><td class="line">   <span class='macro'>STBI_NOTUSED(hs)<span class='macro_popup'>(void)sizeof(hs)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3207"><td class="num" id="LN3207">3207</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3208"><td class="num" id="LN3208">3208</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3209"><td class="num" id="LN3209">3209</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3210"><td class="num" id="LN3210">3210</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3211"><td class="num" id="LN3211">3211</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__div16(x)<span class='macro_popup'>((stbi_uc) ((x) &gt;&gt; 4))</span></span> ((stbi_uc) ((x) &gt;&gt; 4))</span></td></tr>
<tr class="codeline" data-linenumber="3212"><td class="num" id="LN3212">3212</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3213"><td class="num" id="LN3213">3213</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__resample_row_hv_2(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs)</td></tr>
<tr class="codeline" data-linenumber="3214"><td class="num" id="LN3214">3214</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3215"><td class="num" id="LN3215">3215</td><td class="line">   <span class='comment'>// need to generate 2x2 samples for every one in input</span></td></tr>
<tr class="codeline" data-linenumber="3216"><td class="num" id="LN3216">3216</td><td class="line">   <span class='keyword'>int</span> i,t0,t1;</td></tr>
<tr class="codeline" data-linenumber="3217"><td class="num" id="LN3217">3217</td><td class="line">   <span class='keyword'>if</span> (w == 1) {</td></tr>
<tr class="codeline" data-linenumber="3218"><td class="num" id="LN3218">3218</td><td class="line">      out[0] = out[1] = <span class='macro'>stbi__div4(3*in_near[0] + in_far[0] + 2)<span class='macro_popup'>((stbi_uc) ((3*in_near[0] + in_far[0] + 2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3219"><td class="num" id="LN3219">3219</td><td class="line">      <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3220"><td class="num" id="LN3220">3220</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3221"><td class="num" id="LN3221">3221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3222"><td class="num" id="LN3222">3222</td><td class="line">   t1 = 3*in_near[0] + in_far[0];</td></tr>
<tr class="codeline" data-linenumber="3223"><td class="num" id="LN3223">3223</td><td class="line">   out[0] = <span class='macro'>stbi__div4(t1+2)<span class='macro_popup'>((stbi_uc) ((t1+2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3224"><td class="num" id="LN3224">3224</td><td class="line">   <span class='keyword'>for</span> (i=1; i &lt; w; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3225"><td class="num" id="LN3225">3225</td><td class="line">      t0 = t1;</td></tr>
<tr class="codeline" data-linenumber="3226"><td class="num" id="LN3226">3226</td><td class="line">      t1 = 3*in_near[i]+in_far[i];</td></tr>
<tr class="codeline" data-linenumber="3227"><td class="num" id="LN3227">3227</td><td class="line">      out[i*2-1] = <span class='macro'>stbi__div16(3*t0 + t1 + 8)<span class='macro_popup'>((stbi_uc) ((3*t0 + t1 + 8) &gt;&gt; 4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3228"><td class="num" id="LN3228">3228</td><td class="line">      out[i*2  ] = <span class='macro'>stbi__div16(3*t1 + t0 + 8)<span class='macro_popup'>((stbi_uc) ((3*t1 + t0 + 8) &gt;&gt; 4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3229"><td class="num" id="LN3229">3229</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3230"><td class="num" id="LN3230">3230</td><td class="line">   out[w*2-1] = <span class='macro'>stbi__div4(t1+2)<span class='macro_popup'>((stbi_uc) ((t1+2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3231"><td class="num" id="LN3231">3231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3232"><td class="num" id="LN3232">3232</td><td class="line">   <span class='macro'>STBI_NOTUSED(hs)<span class='macro_popup'>(void)sizeof(hs)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3233"><td class="num" id="LN3233">3233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3234"><td class="num" id="LN3234">3234</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3235"><td class="num" id="LN3235">3235</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3236"><td class="num" id="LN3236">3236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3237"><td class="num" id="LN3237">3237</td><td class="line"><span class='directive'>#if defined(STBI_SSE2) || defined(STBI_NEON)</span></td></tr>
<tr class="codeline" data-linenumber="3238"><td class="num" id="LN3238">3238</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__resample_row_hv_2_simd(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs)</td></tr>
<tr class="codeline" data-linenumber="3239"><td class="num" id="LN3239">3239</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3240"><td class="num" id="LN3240">3240</td><td class="line">   <span class='comment'>// need to generate 2x2 samples for every one in input</span></td></tr>
<tr class="codeline" data-linenumber="3241"><td class="num" id="LN3241">3241</td><td class="line">   <span class='keyword'>int</span> i=0,t0,t1;</td></tr>
<tr class="codeline" data-linenumber="3242"><td class="num" id="LN3242">3242</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3243"><td class="num" id="LN3243">3243</td><td class="line">   <span class='keyword'>if</span> (w == 1) {</td></tr>
<tr class="codeline" data-linenumber="3244"><td class="num" id="LN3244">3244</td><td class="line">      out[0] = out[1] = <span class='macro'>stbi__div4(3*in_near[0] + in_far[0] + 2)<span class='macro_popup'>((stbi_uc) ((3*in_near[0] + in_far[0] + 2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3245"><td class="num" id="LN3245">3245</td><td class="line">      <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3246"><td class="num" id="LN3246">3246</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3247"><td class="num" id="LN3247">3247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3248"><td class="num" id="LN3248">3248</td><td class="line">   t1 = 3*in_near[0] + in_far[0];</td></tr>
<tr class="codeline" data-linenumber="3249"><td class="num" id="LN3249">3249</td><td class="line">   <span class='comment'>// process groups of 8 pixels for as long as we can.</span></td></tr>
<tr class="codeline" data-linenumber="3250"><td class="num" id="LN3250">3250</td><td class="line">   <span class='comment'>// note we can't handle the last pixel in a row in this loop</span></td></tr>
<tr class="codeline" data-linenumber="3251"><td class="num" id="LN3251">3251</td><td class="line">   <span class='comment'>// because we need to handle the filter boundary conditions.</span></td></tr>
<tr class="codeline" data-linenumber="3252"><td class="num" id="LN3252">3252</td><td class="line">   <span class='keyword'>for</span> (; i &lt; ((w-1) &amp; ~7); i += 8) {</td></tr>
<tr class="codeline" data-linenumber="3253"><td class="num" id="LN3253">3253</td><td class="line"><span class='directive'>#if defined(STBI_SSE2)</span></td></tr>
<tr class="codeline" data-linenumber="3254"><td class="num" id="LN3254">3254</td><td class="line">      <span class='comment'>// load and perform the vertical filtering pass</span></td></tr>
<tr class="codeline" data-linenumber="3255"><td class="num" id="LN3255">3255</td><td class="line">      <span class='comment'>// this uses 3*x + y = 4*x + (y - x)</span></td></tr>
<tr class="codeline" data-linenumber="3256"><td class="num" id="LN3256">3256</td><td class="line">      __m128i zero  = _mm_setzero_si128();</td></tr>
<tr class="codeline" data-linenumber="3257"><td class="num" id="LN3257">3257</td><td class="line">      __m128i farb  = _mm_loadl_epi64((__m128i *) (in_far + i));</td></tr>
<tr class="codeline" data-linenumber="3258"><td class="num" id="LN3258">3258</td><td class="line">      __m128i nearb = _mm_loadl_epi64((__m128i *) (in_near + i));</td></tr>
<tr class="codeline" data-linenumber="3259"><td class="num" id="LN3259">3259</td><td class="line">      __m128i farw  = _mm_unpacklo_epi8(farb, zero);</td></tr>
<tr class="codeline" data-linenumber="3260"><td class="num" id="LN3260">3260</td><td class="line">      __m128i nearw = _mm_unpacklo_epi8(nearb, zero);</td></tr>
<tr class="codeline" data-linenumber="3261"><td class="num" id="LN3261">3261</td><td class="line">      __m128i diff  = _mm_sub_epi16(farw, nearw);</td></tr>
<tr class="codeline" data-linenumber="3262"><td class="num" id="LN3262">3262</td><td class="line">      __m128i nears = _mm_slli_epi16(nearw, 2);</td></tr>
<tr class="codeline" data-linenumber="3263"><td class="num" id="LN3263">3263</td><td class="line">      __m128i curr  = _mm_add_epi16(nears, diff); <span class='comment'>// current row</span></td></tr>
<tr class="codeline" data-linenumber="3264"><td class="num" id="LN3264">3264</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3265"><td class="num" id="LN3265">3265</td><td class="line">      <span class='comment'>// horizontal filter works the same based on shifted vers of current</span></td></tr>
<tr class="codeline" data-linenumber="3266"><td class="num" id="LN3266">3266</td><td class="line">      <span class='comment'>// row. "prev" is current row shifted right by 1 pixel; we need to</span></td></tr>
<tr class="codeline" data-linenumber="3267"><td class="num" id="LN3267">3267</td><td class="line">      <span class='comment'>// insert the previous pixel value (from t1).</span></td></tr>
<tr class="codeline" data-linenumber="3268"><td class="num" id="LN3268">3268</td><td class="line">      <span class='comment'>// "next" is current row shifted left by 1 pixel, with first pixel</span></td></tr>
<tr class="codeline" data-linenumber="3269"><td class="num" id="LN3269">3269</td><td class="line">      <span class='comment'>// of next block of 8 pixels added in.</span></td></tr>
<tr class="codeline" data-linenumber="3270"><td class="num" id="LN3270">3270</td><td class="line">      __m128i prv0 = <span class='macro'>_mm_slli_si128(curr, 2)<span class='macro_popup'>(__m128i)__builtin_ia32_pslldqi128_byteshift((__v2di)(__m128i<br>)(curr), (int)(2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3271"><td class="num" id="LN3271">3271</td><td class="line">      __m128i nxt0 = <span class='macro'>_mm_srli_si128(curr, 2)<span class='macro_popup'>(__m128i)__builtin_ia32_psrldqi128_byteshift((__v2di)(__m128i<br>)(curr), (int)(2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3272"><td class="num" id="LN3272">3272</td><td class="line">      __m128i prev = <span class='macro'>_mm_insert_epi16(prv0, t1, 0)<span class='macro_popup'>(__m128i)__builtin_ia32_vec_set_v8hi((__v8hi)(__m128i)(prv0),<br> (int)(t1), (int)(0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3273"><td class="num" id="LN3273">3273</td><td class="line">      __m128i next = <span class='macro'>_mm_insert_epi16(nxt0, 3*in_near[i+8] + in_far[i+8], 7)<span class='macro_popup'>(__m128i)__builtin_ia32_vec_set_v8hi((__v8hi)(__m128i)(nxt0),<br> (int)(3*in_near[i+8] + in_far[i+8]), (int)(7))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3274"><td class="num" id="LN3274">3274</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3275"><td class="num" id="LN3275">3275</td><td class="line">      <span class='comment'>// horizontal filter, polyphase implementation since it's convenient:</span></td></tr>
<tr class="codeline" data-linenumber="3276"><td class="num" id="LN3276">3276</td><td class="line">      <span class='comment'>// even pixels = 3*cur + prev = cur*4 + (prev - cur)</span></td></tr>
<tr class="codeline" data-linenumber="3277"><td class="num" id="LN3277">3277</td><td class="line">      <span class='comment'>// odd  pixels = 3*cur + next = cur*4 + (next - cur)</span></td></tr>
<tr class="codeline" data-linenumber="3278"><td class="num" id="LN3278">3278</td><td class="line">      <span class='comment'>// note the shared term.</span></td></tr>
<tr class="codeline" data-linenumber="3279"><td class="num" id="LN3279">3279</td><td class="line">      __m128i bias  = _mm_set1_epi16(8);</td></tr>
<tr class="codeline" data-linenumber="3280"><td class="num" id="LN3280">3280</td><td class="line">      __m128i curs = _mm_slli_epi16(curr, 2);</td></tr>
<tr class="codeline" data-linenumber="3281"><td class="num" id="LN3281">3281</td><td class="line">      __m128i prvd = _mm_sub_epi16(prev, curr);</td></tr>
<tr class="codeline" data-linenumber="3282"><td class="num" id="LN3282">3282</td><td class="line">      __m128i nxtd = _mm_sub_epi16(next, curr);</td></tr>
<tr class="codeline" data-linenumber="3283"><td class="num" id="LN3283">3283</td><td class="line">      __m128i curb = _mm_add_epi16(curs, bias);</td></tr>
<tr class="codeline" data-linenumber="3284"><td class="num" id="LN3284">3284</td><td class="line">      __m128i even = _mm_add_epi16(prvd, curb);</td></tr>
<tr class="codeline" data-linenumber="3285"><td class="num" id="LN3285">3285</td><td class="line">      __m128i odd  = _mm_add_epi16(nxtd, curb);</td></tr>
<tr class="codeline" data-linenumber="3286"><td class="num" id="LN3286">3286</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3287"><td class="num" id="LN3287">3287</td><td class="line">      <span class='comment'>// interleave even and odd pixels, then undo scaling.</span></td></tr>
<tr class="codeline" data-linenumber="3288"><td class="num" id="LN3288">3288</td><td class="line">      __m128i int0 = _mm_unpacklo_epi16(even, odd);</td></tr>
<tr class="codeline" data-linenumber="3289"><td class="num" id="LN3289">3289</td><td class="line">      __m128i int1 = _mm_unpackhi_epi16(even, odd);</td></tr>
<tr class="codeline" data-linenumber="3290"><td class="num" id="LN3290">3290</td><td class="line">      __m128i de0  = _mm_srli_epi16(int0, 4);</td></tr>
<tr class="codeline" data-linenumber="3291"><td class="num" id="LN3291">3291</td><td class="line">      __m128i de1  = _mm_srli_epi16(int1, 4);</td></tr>
<tr class="codeline" data-linenumber="3292"><td class="num" id="LN3292">3292</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3293"><td class="num" id="LN3293">3293</td><td class="line">      <span class='comment'>// pack and write output</span></td></tr>
<tr class="codeline" data-linenumber="3294"><td class="num" id="LN3294">3294</td><td class="line">      __m128i outv = _mm_packus_epi16(de0, de1);</td></tr>
<tr class="codeline" data-linenumber="3295"><td class="num" id="LN3295">3295</td><td class="line">      _mm_storeu_si128((__m128i *) (out + i*2), outv);</td></tr>
<tr class="codeline" data-linenumber="3296"><td class="num" id="LN3296">3296</td><td class="line"><span class='directive'>#elif defined(STBI_NEON)</span></td></tr>
<tr class="codeline" data-linenumber="3297"><td class="num" id="LN3297">3297</td><td class="line">      <span class='comment'>// load and perform the vertical filtering pass</span></td></tr>
<tr class="codeline" data-linenumber="3298"><td class="num" id="LN3298">3298</td><td class="line">      <span class='comment'>// this uses 3*x + y = 4*x + (y - x)</span></td></tr>
<tr class="codeline" data-linenumber="3299"><td class="num" id="LN3299">3299</td><td class="line">      uint8x8_t farb  = vld1_u8(in_far + i);</td></tr>
<tr class="codeline" data-linenumber="3300"><td class="num" id="LN3300">3300</td><td class="line">      uint8x8_t nearb = vld1_u8(in_near + i);</td></tr>
<tr class="codeline" data-linenumber="3301"><td class="num" id="LN3301">3301</td><td class="line">      int16x8_t diff  = vreinterpretq_s16_u16(vsubl_u8(farb, nearb));</td></tr>
<tr class="codeline" data-linenumber="3302"><td class="num" id="LN3302">3302</td><td class="line">      int16x8_t nears = vreinterpretq_s16_u16(vshll_n_u8(nearb, 2));</td></tr>
<tr class="codeline" data-linenumber="3303"><td class="num" id="LN3303">3303</td><td class="line">      int16x8_t curr  = vaddq_s16(nears, diff); <span class='comment'>// current row</span></td></tr>
<tr class="codeline" data-linenumber="3304"><td class="num" id="LN3304">3304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3305"><td class="num" id="LN3305">3305</td><td class="line">      <span class='comment'>// horizontal filter works the same based on shifted vers of current</span></td></tr>
<tr class="codeline" data-linenumber="3306"><td class="num" id="LN3306">3306</td><td class="line">      <span class='comment'>// row. "prev" is current row shifted right by 1 pixel; we need to</span></td></tr>
<tr class="codeline" data-linenumber="3307"><td class="num" id="LN3307">3307</td><td class="line">      <span class='comment'>// insert the previous pixel value (from t1).</span></td></tr>
<tr class="codeline" data-linenumber="3308"><td class="num" id="LN3308">3308</td><td class="line">      <span class='comment'>// "next" is current row shifted left by 1 pixel, with first pixel</span></td></tr>
<tr class="codeline" data-linenumber="3309"><td class="num" id="LN3309">3309</td><td class="line">      <span class='comment'>// of next block of 8 pixels added in.</span></td></tr>
<tr class="codeline" data-linenumber="3310"><td class="num" id="LN3310">3310</td><td class="line">      int16x8_t prv0 = vextq_s16(curr, curr, 7);</td></tr>
<tr class="codeline" data-linenumber="3311"><td class="num" id="LN3311">3311</td><td class="line">      int16x8_t nxt0 = vextq_s16(curr, curr, 1);</td></tr>
<tr class="codeline" data-linenumber="3312"><td class="num" id="LN3312">3312</td><td class="line">      int16x8_t prev = vsetq_lane_s16(t1, prv0, 0);</td></tr>
<tr class="codeline" data-linenumber="3313"><td class="num" id="LN3313">3313</td><td class="line">      int16x8_t next = vsetq_lane_s16(3*in_near[i+8] + in_far[i+8], nxt0, 7);</td></tr>
<tr class="codeline" data-linenumber="3314"><td class="num" id="LN3314">3314</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3315"><td class="num" id="LN3315">3315</td><td class="line">      <span class='comment'>// horizontal filter, polyphase implementation since it's convenient:</span></td></tr>
<tr class="codeline" data-linenumber="3316"><td class="num" id="LN3316">3316</td><td class="line">      <span class='comment'>// even pixels = 3*cur + prev = cur*4 + (prev - cur)</span></td></tr>
<tr class="codeline" data-linenumber="3317"><td class="num" id="LN3317">3317</td><td class="line">      <span class='comment'>// odd  pixels = 3*cur + next = cur*4 + (next - cur)</span></td></tr>
<tr class="codeline" data-linenumber="3318"><td class="num" id="LN3318">3318</td><td class="line">      <span class='comment'>// note the shared term.</span></td></tr>
<tr class="codeline" data-linenumber="3319"><td class="num" id="LN3319">3319</td><td class="line">      int16x8_t curs = vshlq_n_s16(curr, 2);</td></tr>
<tr class="codeline" data-linenumber="3320"><td class="num" id="LN3320">3320</td><td class="line">      int16x8_t prvd = vsubq_s16(prev, curr);</td></tr>
<tr class="codeline" data-linenumber="3321"><td class="num" id="LN3321">3321</td><td class="line">      int16x8_t nxtd = vsubq_s16(next, curr);</td></tr>
<tr class="codeline" data-linenumber="3322"><td class="num" id="LN3322">3322</td><td class="line">      int16x8_t even = vaddq_s16(curs, prvd);</td></tr>
<tr class="codeline" data-linenumber="3323"><td class="num" id="LN3323">3323</td><td class="line">      int16x8_t odd  = vaddq_s16(curs, nxtd);</td></tr>
<tr class="codeline" data-linenumber="3324"><td class="num" id="LN3324">3324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3325"><td class="num" id="LN3325">3325</td><td class="line">      <span class='comment'>// undo scaling and round, then store with even/odd phases interleaved</span></td></tr>
<tr class="codeline" data-linenumber="3326"><td class="num" id="LN3326">3326</td><td class="line">      uint8x8x2_t o;</td></tr>
<tr class="codeline" data-linenumber="3327"><td class="num" id="LN3327">3327</td><td class="line">      o.val[0] = vqrshrun_n_s16(even, 4);</td></tr>
<tr class="codeline" data-linenumber="3328"><td class="num" id="LN3328">3328</td><td class="line">      o.val[1] = vqrshrun_n_s16(odd,  4);</td></tr>
<tr class="codeline" data-linenumber="3329"><td class="num" id="LN3329">3329</td><td class="line">      vst2_u8(out + i*2, o);</td></tr>
<tr class="codeline" data-linenumber="3330"><td class="num" id="LN3330">3330</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3331"><td class="num" id="LN3331">3331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3332"><td class="num" id="LN3332">3332</td><td class="line">      <span class='comment'>// "previous" value for next iter</span></td></tr>
<tr class="codeline" data-linenumber="3333"><td class="num" id="LN3333">3333</td><td class="line">      t1 = 3*in_near[i+7] + in_far[i+7];</td></tr>
<tr class="codeline" data-linenumber="3334"><td class="num" id="LN3334">3334</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3335"><td class="num" id="LN3335">3335</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3336"><td class="num" id="LN3336">3336</td><td class="line">   t0 = t1;</td></tr>
<tr class="codeline" data-linenumber="3337"><td class="num" id="LN3337">3337</td><td class="line">   t1 = 3*in_near[i] + in_far[i];</td></tr>
<tr class="codeline" data-linenumber="3338"><td class="num" id="LN3338">3338</td><td class="line">   out[i*2] = <span class='macro'>stbi__div16(3*t1 + t0 + 8)<span class='macro_popup'>((stbi_uc) ((3*t1 + t0 + 8) &gt;&gt; 4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3339"><td class="num" id="LN3339">3339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3340"><td class="num" id="LN3340">3340</td><td class="line">   <span class='keyword'>for</span> (++i; i &lt; w; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3341"><td class="num" id="LN3341">3341</td><td class="line">      t0 = t1;</td></tr>
<tr class="codeline" data-linenumber="3342"><td class="num" id="LN3342">3342</td><td class="line">      t1 = 3*in_near[i]+in_far[i];</td></tr>
<tr class="codeline" data-linenumber="3343"><td class="num" id="LN3343">3343</td><td class="line">      out[i*2-1] = <span class='macro'>stbi__div16(3*t0 + t1 + 8)<span class='macro_popup'>((stbi_uc) ((3*t0 + t1 + 8) &gt;&gt; 4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3344"><td class="num" id="LN3344">3344</td><td class="line">      out[i*2  ] = <span class='macro'>stbi__div16(3*t1 + t0 + 8)<span class='macro_popup'>((stbi_uc) ((3*t1 + t0 + 8) &gt;&gt; 4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3345"><td class="num" id="LN3345">3345</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3346"><td class="num" id="LN3346">3346</td><td class="line">   out[w*2-1] = <span class='macro'>stbi__div4(t1+2)<span class='macro_popup'>((stbi_uc) ((t1+2) &gt;&gt; 2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3347"><td class="num" id="LN3347">3347</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3348"><td class="num" id="LN3348">3348</td><td class="line">   <span class='macro'>STBI_NOTUSED(hs)<span class='macro_popup'>(void)sizeof(hs)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3349"><td class="num" id="LN3349">3349</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3350"><td class="num" id="LN3350">3350</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3351"><td class="num" id="LN3351">3351</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3352"><td class="num" id="LN3352">3352</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3353"><td class="num" id="LN3353">3353</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3354"><td class="num" id="LN3354">3354</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__resample_row_generic(stbi_uc *out, stbi_uc *in_near, stbi_uc *in_far, <span class='keyword'>int</span> w, <span class='keyword'>int</span> hs)</td></tr>
<tr class="codeline" data-linenumber="3355"><td class="num" id="LN3355">3355</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3356"><td class="num" id="LN3356">3356</td><td class="line">   <span class='comment'>// resample with nearest-neighbor</span></td></tr>
<tr class="codeline" data-linenumber="3357"><td class="num" id="LN3357">3357</td><td class="line">   <span class='keyword'>int</span> i,j;</td></tr>
<tr class="codeline" data-linenumber="3358"><td class="num" id="LN3358">3358</td><td class="line">   <span class='macro'>STBI_NOTUSED(in_far)<span class='macro_popup'>(void)sizeof(in_far)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3359"><td class="num" id="LN3359">3359</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; w; ++i)</td></tr>
<tr class="codeline" data-linenumber="3360"><td class="num" id="LN3360">3360</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; hs; ++j)</td></tr>
<tr class="codeline" data-linenumber="3361"><td class="num" id="LN3361">3361</td><td class="line">         out[i*hs+j] = in_near[i];</td></tr>
<tr class="codeline" data-linenumber="3362"><td class="num" id="LN3362">3362</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="3363"><td class="num" id="LN3363">3363</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3364"><td class="num" id="LN3364">3364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3365"><td class="num" id="LN3365">3365</td><td class="line"><span class='comment'>// this is a reduced-precision calculation of YCbCr-to-RGB introduced</span></td></tr>
<tr class="codeline" data-linenumber="3366"><td class="num" id="LN3366">3366</td><td class="line"><span class='comment'>// to make sure the code produces the same results in both SIMD and scalar</span></td></tr>
<tr class="codeline" data-linenumber="3367"><td class="num" id="LN3367">3367</td><td class="line"><span class='directive'>#define <span class='macro'>stbi__float2fixed(x)<span class='macro_popup'>(((int) ((x) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>  (((int) ((x) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></td></tr>
<tr class="codeline" data-linenumber="3368"><td class="num" id="LN3368">3368</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__YCbCr_to_RGB_row(stbi_uc *out, <span class='keyword'>const</span> stbi_uc *y, <span class='keyword'>const</span> stbi_uc *pcb, <span class='keyword'>const</span> stbi_uc *pcr, <span class='keyword'>int</span> count, <span class='keyword'>int</span> step)</td></tr>
<tr class="codeline" data-linenumber="3369"><td class="num" id="LN3369">3369</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3370"><td class="num" id="LN3370">3370</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="3371"><td class="num" id="LN3371">3371</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3372"><td class="num" id="LN3372">3372</td><td class="line">      <span class='keyword'>int</span> y_fixed = (y[i] &lt;&lt; 20) + (1&lt;&lt;19); <span class='comment'>// rounding</span></td></tr>
<tr class="codeline" data-linenumber="3373"><td class="num" id="LN3373">3373</td><td class="line">      <span class='keyword'>int</span> r,g,b;</td></tr>
<tr class="codeline" data-linenumber="3374"><td class="num" id="LN3374">3374</td><td class="line">      <span class='keyword'>int</span> cr = pcr[i] - 128;</td></tr>
<tr class="codeline" data-linenumber="3375"><td class="num" id="LN3375">3375</td><td class="line">      <span class='keyword'>int</span> cb = pcb[i] - 128;</td></tr>
<tr class="codeline" data-linenumber="3376"><td class="num" id="LN3376">3376</td><td class="line">      r = y_fixed +  cr* <span class='macro'>stbi__float2fixed(1.40200f)<span class='macro_popup'>(((int) ((1.40200f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3377"><td class="num" id="LN3377">3377</td><td class="line">      g = y_fixed + (cr*-<span class='macro'>stbi__float2fixed(0.71414f)<span class='macro_popup'>(((int) ((0.71414f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>) + ((cb*-<span class='macro'>stbi__float2fixed(0.34414f)<span class='macro_popup'>(((int) ((0.34414f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>) &amp; 0xffff0000);</td></tr>
<tr class="codeline" data-linenumber="3378"><td class="num" id="LN3378">3378</td><td class="line">      b = y_fixed                                     +   cb* <span class='macro'>stbi__float2fixed(1.77200f)<span class='macro_popup'>(((int) ((1.77200f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3379"><td class="num" id="LN3379">3379</td><td class="line">      r &gt;&gt;= 20;</td></tr>
<tr class="codeline" data-linenumber="3380"><td class="num" id="LN3380">3380</td><td class="line">      g &gt;&gt;= 20;</td></tr>
<tr class="codeline" data-linenumber="3381"><td class="num" id="LN3381">3381</td><td class="line">      b &gt;&gt;= 20;</td></tr>
<tr class="codeline" data-linenumber="3382"><td class="num" id="LN3382">3382</td><td class="line">      <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span>) r &gt; 255) { <span class='keyword'>if</span> (r &lt; 0) r = 0; <span class='keyword'>else</span> r = 255; }</td></tr>
<tr class="codeline" data-linenumber="3383"><td class="num" id="LN3383">3383</td><td class="line">      <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span>) g &gt; 255) { <span class='keyword'>if</span> (g &lt; 0) g = 0; <span class='keyword'>else</span> g = 255; }</td></tr>
<tr class="codeline" data-linenumber="3384"><td class="num" id="LN3384">3384</td><td class="line">      <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span>) b &gt; 255) { <span class='keyword'>if</span> (b &lt; 0) b = 0; <span class='keyword'>else</span> b = 255; }</td></tr>
<tr class="codeline" data-linenumber="3385"><td class="num" id="LN3385">3385</td><td class="line">      out[0] = (stbi_uc)r;</td></tr>
<tr class="codeline" data-linenumber="3386"><td class="num" id="LN3386">3386</td><td class="line">      out[1] = (stbi_uc)g;</td></tr>
<tr class="codeline" data-linenumber="3387"><td class="num" id="LN3387">3387</td><td class="line">      out[2] = (stbi_uc)b;</td></tr>
<tr class="codeline" data-linenumber="3388"><td class="num" id="LN3388">3388</td><td class="line">      out[3] = 255;</td></tr>
<tr class="codeline" data-linenumber="3389"><td class="num" id="LN3389">3389</td><td class="line">      out += step;</td></tr>
<tr class="codeline" data-linenumber="3390"><td class="num" id="LN3390">3390</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3391"><td class="num" id="LN3391">3391</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3392"><td class="num" id="LN3392">3392</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3393"><td class="num" id="LN3393">3393</td><td class="line"><span class='directive'>#if defined(STBI_SSE2) || defined(STBI_NEON)</span></td></tr>
<tr class="codeline" data-linenumber="3394"><td class="num" id="LN3394">3394</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__YCbCr_to_RGB_simd(stbi_uc *out, stbi_uc <span class='keyword'>const</span> *y, stbi_uc <span class='keyword'>const</span> *pcb, stbi_uc <span class='keyword'>const</span> *pcr, <span class='keyword'>int</span> count, <span class='keyword'>int</span> step)</td></tr>
<tr class="codeline" data-linenumber="3395"><td class="num" id="LN3395">3395</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3396"><td class="num" id="LN3396">3396</td><td class="line">   <span class='keyword'>int</span> i = 0;</td></tr>
<tr class="codeline" data-linenumber="3397"><td class="num" id="LN3397">3397</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3398"><td class="num" id="LN3398">3398</td><td class="line"><span class='directive'>#ifdef STBI_SSE2</span></td></tr>
<tr class="codeline" data-linenumber="3399"><td class="num" id="LN3399">3399</td><td class="line">   <span class='comment'>// step == 3 is pretty ugly on the final interleave, and i'm not convinced</span></td></tr>
<tr class="codeline" data-linenumber="3400"><td class="num" id="LN3400">3400</td><td class="line">   <span class='comment'>// it's useful in practice (you wouldn't use it for textures, for example).</span></td></tr>
<tr class="codeline" data-linenumber="3401"><td class="num" id="LN3401">3401</td><td class="line">   <span class='comment'>// so just accelerate step == 4 case.</span></td></tr>
<tr class="codeline" data-linenumber="3402"><td class="num" id="LN3402">3402</td><td class="line">   <span class='keyword'>if</span> (step == 4) {</td></tr>
<tr class="codeline" data-linenumber="3403"><td class="num" id="LN3403">3403</td><td class="line">      <span class='comment'>// this is a fairly straightforward implementation and not super-optimized.</span></td></tr>
<tr class="codeline" data-linenumber="3404"><td class="num" id="LN3404">3404</td><td class="line">      __m128i signflip  = _mm_set1_epi8(-0x80);</td></tr>
<tr class="codeline" data-linenumber="3405"><td class="num" id="LN3405">3405</td><td class="line">      __m128i cr_const0 = _mm_set1_epi16(   (<span class='keyword'>short</span>) ( 1.40200f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3406"><td class="num" id="LN3406">3406</td><td class="line">      __m128i cr_const1 = _mm_set1_epi16( - (<span class='keyword'>short</span>) ( 0.71414f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3407"><td class="num" id="LN3407">3407</td><td class="line">      __m128i cb_const0 = _mm_set1_epi16( - (<span class='keyword'>short</span>) ( 0.34414f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3408"><td class="num" id="LN3408">3408</td><td class="line">      __m128i cb_const1 = _mm_set1_epi16(   (<span class='keyword'>short</span>) ( 1.77200f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3409"><td class="num" id="LN3409">3409</td><td class="line">      __m128i y_bias = _mm_set1_epi8((<span class='keyword'>char</span>) (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) 128);</td></tr>
<tr class="codeline" data-linenumber="3410"><td class="num" id="LN3410">3410</td><td class="line">      __m128i xw = _mm_set1_epi16(255); <span class='comment'>// alpha channel</span></td></tr>
<tr class="codeline" data-linenumber="3411"><td class="num" id="LN3411">3411</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3412"><td class="num" id="LN3412">3412</td><td class="line">      <span class='keyword'>for</span> (; i+7 &lt; count; i += 8) {</td></tr>
<tr class="codeline" data-linenumber="3413"><td class="num" id="LN3413">3413</td><td class="line">         <span class='comment'>// load</span></td></tr>
<tr class="codeline" data-linenumber="3414"><td class="num" id="LN3414">3414</td><td class="line">         __m128i y_bytes = _mm_loadl_epi64((__m128i *) (y+i));</td></tr>
<tr class="codeline" data-linenumber="3415"><td class="num" id="LN3415">3415</td><td class="line">         __m128i cr_bytes = _mm_loadl_epi64((__m128i *) (pcr+i));</td></tr>
<tr class="codeline" data-linenumber="3416"><td class="num" id="LN3416">3416</td><td class="line">         __m128i cb_bytes = _mm_loadl_epi64((__m128i *) (pcb+i));</td></tr>
<tr class="codeline" data-linenumber="3417"><td class="num" id="LN3417">3417</td><td class="line">         __m128i cr_biased = _mm_xor_si128(cr_bytes, signflip); <span class='comment'>// -128</span></td></tr>
<tr class="codeline" data-linenumber="3418"><td class="num" id="LN3418">3418</td><td class="line">         __m128i cb_biased = _mm_xor_si128(cb_bytes, signflip); <span class='comment'>// -128</span></td></tr>
<tr class="codeline" data-linenumber="3419"><td class="num" id="LN3419">3419</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3420"><td class="num" id="LN3420">3420</td><td class="line">         <span class='comment'>// unpack to short (and left-shift cr, cb by 8)</span></td></tr>
<tr class="codeline" data-linenumber="3421"><td class="num" id="LN3421">3421</td><td class="line">         __m128i yw  = _mm_unpacklo_epi8(y_bias, y_bytes);</td></tr>
<tr class="codeline" data-linenumber="3422"><td class="num" id="LN3422">3422</td><td class="line">         __m128i crw = _mm_unpacklo_epi8(_mm_setzero_si128(), cr_biased);</td></tr>
<tr class="codeline" data-linenumber="3423"><td class="num" id="LN3423">3423</td><td class="line">         __m128i cbw = _mm_unpacklo_epi8(_mm_setzero_si128(), cb_biased);</td></tr>
<tr class="codeline" data-linenumber="3424"><td class="num" id="LN3424">3424</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3425"><td class="num" id="LN3425">3425</td><td class="line">         <span class='comment'>// color transform</span></td></tr>
<tr class="codeline" data-linenumber="3426"><td class="num" id="LN3426">3426</td><td class="line">         __m128i yws = _mm_srli_epi16(yw, 4);</td></tr>
<tr class="codeline" data-linenumber="3427"><td class="num" id="LN3427">3427</td><td class="line">         __m128i cr0 = _mm_mulhi_epi16(cr_const0, crw);</td></tr>
<tr class="codeline" data-linenumber="3428"><td class="num" id="LN3428">3428</td><td class="line">         __m128i cb0 = _mm_mulhi_epi16(cb_const0, cbw);</td></tr>
<tr class="codeline" data-linenumber="3429"><td class="num" id="LN3429">3429</td><td class="line">         __m128i cb1 = _mm_mulhi_epi16(cbw, cb_const1);</td></tr>
<tr class="codeline" data-linenumber="3430"><td class="num" id="LN3430">3430</td><td class="line">         __m128i cr1 = _mm_mulhi_epi16(crw, cr_const1);</td></tr>
<tr class="codeline" data-linenumber="3431"><td class="num" id="LN3431">3431</td><td class="line">         __m128i rws = _mm_add_epi16(cr0, yws);</td></tr>
<tr class="codeline" data-linenumber="3432"><td class="num" id="LN3432">3432</td><td class="line">         __m128i gwt = _mm_add_epi16(cb0, yws);</td></tr>
<tr class="codeline" data-linenumber="3433"><td class="num" id="LN3433">3433</td><td class="line">         __m128i bws = _mm_add_epi16(yws, cb1);</td></tr>
<tr class="codeline" data-linenumber="3434"><td class="num" id="LN3434">3434</td><td class="line">         __m128i gws = _mm_add_epi16(gwt, cr1);</td></tr>
<tr class="codeline" data-linenumber="3435"><td class="num" id="LN3435">3435</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3436"><td class="num" id="LN3436">3436</td><td class="line">         <span class='comment'>// descale</span></td></tr>
<tr class="codeline" data-linenumber="3437"><td class="num" id="LN3437">3437</td><td class="line">         __m128i rw = _mm_srai_epi16(rws, 4);</td></tr>
<tr class="codeline" data-linenumber="3438"><td class="num" id="LN3438">3438</td><td class="line">         __m128i bw = _mm_srai_epi16(bws, 4);</td></tr>
<tr class="codeline" data-linenumber="3439"><td class="num" id="LN3439">3439</td><td class="line">         __m128i gw = _mm_srai_epi16(gws, 4);</td></tr>
<tr class="codeline" data-linenumber="3440"><td class="num" id="LN3440">3440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3441"><td class="num" id="LN3441">3441</td><td class="line">         <span class='comment'>// back to byte, set up for transpose</span></td></tr>
<tr class="codeline" data-linenumber="3442"><td class="num" id="LN3442">3442</td><td class="line">         __m128i brb = _mm_packus_epi16(rw, bw);</td></tr>
<tr class="codeline" data-linenumber="3443"><td class="num" id="LN3443">3443</td><td class="line">         __m128i gxb = _mm_packus_epi16(gw, xw);</td></tr>
<tr class="codeline" data-linenumber="3444"><td class="num" id="LN3444">3444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3445"><td class="num" id="LN3445">3445</td><td class="line">         <span class='comment'>// transpose to interleave channels</span></td></tr>
<tr class="codeline" data-linenumber="3446"><td class="num" id="LN3446">3446</td><td class="line">         __m128i t0 = _mm_unpacklo_epi8(brb, gxb);</td></tr>
<tr class="codeline" data-linenumber="3447"><td class="num" id="LN3447">3447</td><td class="line">         __m128i t1 = _mm_unpackhi_epi8(brb, gxb);</td></tr>
<tr class="codeline" data-linenumber="3448"><td class="num" id="LN3448">3448</td><td class="line">         __m128i o0 = _mm_unpacklo_epi16(t0, t1);</td></tr>
<tr class="codeline" data-linenumber="3449"><td class="num" id="LN3449">3449</td><td class="line">         __m128i o1 = _mm_unpackhi_epi16(t0, t1);</td></tr>
<tr class="codeline" data-linenumber="3450"><td class="num" id="LN3450">3450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3451"><td class="num" id="LN3451">3451</td><td class="line">         <span class='comment'>// store</span></td></tr>
<tr class="codeline" data-linenumber="3452"><td class="num" id="LN3452">3452</td><td class="line">         _mm_storeu_si128((__m128i *) (out + 0), o0);</td></tr>
<tr class="codeline" data-linenumber="3453"><td class="num" id="LN3453">3453</td><td class="line">         _mm_storeu_si128((__m128i *) (out + 16), o1);</td></tr>
<tr class="codeline" data-linenumber="3454"><td class="num" id="LN3454">3454</td><td class="line">         out += 32;</td></tr>
<tr class="codeline" data-linenumber="3455"><td class="num" id="LN3455">3455</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3456"><td class="num" id="LN3456">3456</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3457"><td class="num" id="LN3457">3457</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3458"><td class="num" id="LN3458">3458</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3459"><td class="num" id="LN3459">3459</td><td class="line"><span class='directive'>#ifdef STBI_NEON</span></td></tr>
<tr class="codeline" data-linenumber="3460"><td class="num" id="LN3460">3460</td><td class="line">   <span class='comment'>// in this version, step=3 support would be easy to add. but is there demand?</span></td></tr>
<tr class="codeline" data-linenumber="3461"><td class="num" id="LN3461">3461</td><td class="line">   <span class='keyword'>if</span> (step == 4) {</td></tr>
<tr class="codeline" data-linenumber="3462"><td class="num" id="LN3462">3462</td><td class="line">      <span class='comment'>// this is a fairly straightforward implementation and not super-optimized.</span></td></tr>
<tr class="codeline" data-linenumber="3463"><td class="num" id="LN3463">3463</td><td class="line">      uint8x8_t signflip = vdup_n_u8(0x80);</td></tr>
<tr class="codeline" data-linenumber="3464"><td class="num" id="LN3464">3464</td><td class="line">      int16x8_t cr_const0 = vdupq_n_s16(   (<span class='keyword'>short</span>) ( 1.40200f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3465"><td class="num" id="LN3465">3465</td><td class="line">      int16x8_t cr_const1 = vdupq_n_s16( - (<span class='keyword'>short</span>) ( 0.71414f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3466"><td class="num" id="LN3466">3466</td><td class="line">      int16x8_t cb_const0 = vdupq_n_s16( - (<span class='keyword'>short</span>) ( 0.34414f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3467"><td class="num" id="LN3467">3467</td><td class="line">      int16x8_t cb_const1 = vdupq_n_s16(   (<span class='keyword'>short</span>) ( 1.77200f*4096.0f+0.5f));</td></tr>
<tr class="codeline" data-linenumber="3468"><td class="num" id="LN3468">3468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3469"><td class="num" id="LN3469">3469</td><td class="line">      <span class='keyword'>for</span> (; i+7 &lt; count; i += 8) {</td></tr>
<tr class="codeline" data-linenumber="3470"><td class="num" id="LN3470">3470</td><td class="line">         <span class='comment'>// load</span></td></tr>
<tr class="codeline" data-linenumber="3471"><td class="num" id="LN3471">3471</td><td class="line">         uint8x8_t y_bytes  = vld1_u8(y + i);</td></tr>
<tr class="codeline" data-linenumber="3472"><td class="num" id="LN3472">3472</td><td class="line">         uint8x8_t cr_bytes = vld1_u8(pcr + i);</td></tr>
<tr class="codeline" data-linenumber="3473"><td class="num" id="LN3473">3473</td><td class="line">         uint8x8_t cb_bytes = vld1_u8(pcb + i);</td></tr>
<tr class="codeline" data-linenumber="3474"><td class="num" id="LN3474">3474</td><td class="line">         int8x8_t cr_biased = vreinterpret_s8_u8(vsub_u8(cr_bytes, signflip));</td></tr>
<tr class="codeline" data-linenumber="3475"><td class="num" id="LN3475">3475</td><td class="line">         int8x8_t cb_biased = vreinterpret_s8_u8(vsub_u8(cb_bytes, signflip));</td></tr>
<tr class="codeline" data-linenumber="3476"><td class="num" id="LN3476">3476</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3477"><td class="num" id="LN3477">3477</td><td class="line">         <span class='comment'>// expand to s16</span></td></tr>
<tr class="codeline" data-linenumber="3478"><td class="num" id="LN3478">3478</td><td class="line">         int16x8_t yws = vreinterpretq_s16_u16(vshll_n_u8(y_bytes, 4));</td></tr>
<tr class="codeline" data-linenumber="3479"><td class="num" id="LN3479">3479</td><td class="line">         int16x8_t crw = vshll_n_s8(cr_biased, 7);</td></tr>
<tr class="codeline" data-linenumber="3480"><td class="num" id="LN3480">3480</td><td class="line">         int16x8_t cbw = vshll_n_s8(cb_biased, 7);</td></tr>
<tr class="codeline" data-linenumber="3481"><td class="num" id="LN3481">3481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3482"><td class="num" id="LN3482">3482</td><td class="line">         <span class='comment'>// color transform</span></td></tr>
<tr class="codeline" data-linenumber="3483"><td class="num" id="LN3483">3483</td><td class="line">         int16x8_t cr0 = vqdmulhq_s16(crw, cr_const0);</td></tr>
<tr class="codeline" data-linenumber="3484"><td class="num" id="LN3484">3484</td><td class="line">         int16x8_t cb0 = vqdmulhq_s16(cbw, cb_const0);</td></tr>
<tr class="codeline" data-linenumber="3485"><td class="num" id="LN3485">3485</td><td class="line">         int16x8_t cr1 = vqdmulhq_s16(crw, cr_const1);</td></tr>
<tr class="codeline" data-linenumber="3486"><td class="num" id="LN3486">3486</td><td class="line">         int16x8_t cb1 = vqdmulhq_s16(cbw, cb_const1);</td></tr>
<tr class="codeline" data-linenumber="3487"><td class="num" id="LN3487">3487</td><td class="line">         int16x8_t rws = vaddq_s16(yws, cr0);</td></tr>
<tr class="codeline" data-linenumber="3488"><td class="num" id="LN3488">3488</td><td class="line">         int16x8_t gws = vaddq_s16(vaddq_s16(yws, cb0), cr1);</td></tr>
<tr class="codeline" data-linenumber="3489"><td class="num" id="LN3489">3489</td><td class="line">         int16x8_t bws = vaddq_s16(yws, cb1);</td></tr>
<tr class="codeline" data-linenumber="3490"><td class="num" id="LN3490">3490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3491"><td class="num" id="LN3491">3491</td><td class="line">         <span class='comment'>// undo scaling, round, convert to byte</span></td></tr>
<tr class="codeline" data-linenumber="3492"><td class="num" id="LN3492">3492</td><td class="line">         uint8x8x4_t o;</td></tr>
<tr class="codeline" data-linenumber="3493"><td class="num" id="LN3493">3493</td><td class="line">         o.val[0] = vqrshrun_n_s16(rws, 4);</td></tr>
<tr class="codeline" data-linenumber="3494"><td class="num" id="LN3494">3494</td><td class="line">         o.val[1] = vqrshrun_n_s16(gws, 4);</td></tr>
<tr class="codeline" data-linenumber="3495"><td class="num" id="LN3495">3495</td><td class="line">         o.val[2] = vqrshrun_n_s16(bws, 4);</td></tr>
<tr class="codeline" data-linenumber="3496"><td class="num" id="LN3496">3496</td><td class="line">         o.val[3] = vdup_n_u8(255);</td></tr>
<tr class="codeline" data-linenumber="3497"><td class="num" id="LN3497">3497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3498"><td class="num" id="LN3498">3498</td><td class="line">         <span class='comment'>// store, interleaving r/g/b/a</span></td></tr>
<tr class="codeline" data-linenumber="3499"><td class="num" id="LN3499">3499</td><td class="line">         vst4_u8(out, o);</td></tr>
<tr class="codeline" data-linenumber="3500"><td class="num" id="LN3500">3500</td><td class="line">         out += 8*4;</td></tr>
<tr class="codeline" data-linenumber="3501"><td class="num" id="LN3501">3501</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3502"><td class="num" id="LN3502">3502</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3503"><td class="num" id="LN3503">3503</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3504"><td class="num" id="LN3504">3504</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3505"><td class="num" id="LN3505">3505</td><td class="line">   <span class='keyword'>for</span> (; i &lt; count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3506"><td class="num" id="LN3506">3506</td><td class="line">      <span class='keyword'>int</span> y_fixed = (y[i] &lt;&lt; 20) + (1&lt;&lt;19); <span class='comment'>// rounding</span></td></tr>
<tr class="codeline" data-linenumber="3507"><td class="num" id="LN3507">3507</td><td class="line">      <span class='keyword'>int</span> r,g,b;</td></tr>
<tr class="codeline" data-linenumber="3508"><td class="num" id="LN3508">3508</td><td class="line">      <span class='keyword'>int</span> cr = pcr[i] - 128;</td></tr>
<tr class="codeline" data-linenumber="3509"><td class="num" id="LN3509">3509</td><td class="line">      <span class='keyword'>int</span> cb = pcb[i] - 128;</td></tr>
<tr class="codeline" data-linenumber="3510"><td class="num" id="LN3510">3510</td><td class="line">      r = y_fixed + cr* <span class='macro'>stbi__float2fixed(1.40200f)<span class='macro_popup'>(((int) ((1.40200f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3511"><td class="num" id="LN3511">3511</td><td class="line">      g = y_fixed + cr*-<span class='macro'>stbi__float2fixed(0.71414f)<span class='macro_popup'>(((int) ((0.71414f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span> + ((cb*-<span class='macro'>stbi__float2fixed(0.34414f)<span class='macro_popup'>(((int) ((0.34414f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>) &amp; 0xffff0000);</td></tr>
<tr class="codeline" data-linenumber="3512"><td class="num" id="LN3512">3512</td><td class="line">      b = y_fixed                                   +   cb* <span class='macro'>stbi__float2fixed(1.77200f)<span class='macro_popup'>(((int) ((1.77200f) * 4096.0f + 0.5f)) &lt;&lt; 8)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3513"><td class="num" id="LN3513">3513</td><td class="line">      r &gt;&gt;= 20;</td></tr>
<tr class="codeline" data-linenumber="3514"><td class="num" id="LN3514">3514</td><td class="line">      g &gt;&gt;= 20;</td></tr>
<tr class="codeline" data-linenumber="3515"><td class="num" id="LN3515">3515</td><td class="line">      b &gt;&gt;= 20;</td></tr>
<tr class="codeline" data-linenumber="3516"><td class="num" id="LN3516">3516</td><td class="line">      <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span>) r &gt; 255) { <span class='keyword'>if</span> (r &lt; 0) r = 0; <span class='keyword'>else</span> r = 255; }</td></tr>
<tr class="codeline" data-linenumber="3517"><td class="num" id="LN3517">3517</td><td class="line">      <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span>) g &gt; 255) { <span class='keyword'>if</span> (g &lt; 0) g = 0; <span class='keyword'>else</span> g = 255; }</td></tr>
<tr class="codeline" data-linenumber="3518"><td class="num" id="LN3518">3518</td><td class="line">      <span class='keyword'>if</span> ((<span class='keyword'>unsigned</span>) b &gt; 255) { <span class='keyword'>if</span> (b &lt; 0) b = 0; <span class='keyword'>else</span> b = 255; }</td></tr>
<tr class="codeline" data-linenumber="3519"><td class="num" id="LN3519">3519</td><td class="line">      out[0] = (stbi_uc)r;</td></tr>
<tr class="codeline" data-linenumber="3520"><td class="num" id="LN3520">3520</td><td class="line">      out[1] = (stbi_uc)g;</td></tr>
<tr class="codeline" data-linenumber="3521"><td class="num" id="LN3521">3521</td><td class="line">      out[2] = (stbi_uc)b;</td></tr>
<tr class="codeline" data-linenumber="3522"><td class="num" id="LN3522">3522</td><td class="line">      out[3] = 255;</td></tr>
<tr class="codeline" data-linenumber="3523"><td class="num" id="LN3523">3523</td><td class="line">      out += step;</td></tr>
<tr class="codeline" data-linenumber="3524"><td class="num" id="LN3524">3524</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3525"><td class="num" id="LN3525">3525</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3526"><td class="num" id="LN3526">3526</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3527"><td class="num" id="LN3527">3527</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3528"><td class="num" id="LN3528">3528</td><td class="line"><span class='comment'>// set up the kernels</span></td></tr>
<tr class="codeline" data-linenumber="3529"><td class="num" id="LN3529">3529</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__setup_jpeg(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="3530"><td class="num" id="LN3530">3530</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3531"><td class="num" id="LN3531">3531</td><td class="line">   j-&gt;idct_block_kernel = stbi__idct_block;</td></tr>
<tr class="codeline" data-linenumber="3532"><td class="num" id="LN3532">3532</td><td class="line">   j-&gt;YCbCr_to_RGB_kernel = stbi__YCbCr_to_RGB_row;</td></tr>
<tr class="codeline" data-linenumber="3533"><td class="num" id="LN3533">3533</td><td class="line">   j-&gt;resample_row_hv_2_kernel = stbi__resample_row_hv_2;</td></tr>
<tr class="codeline" data-linenumber="3534"><td class="num" id="LN3534">3534</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3535"><td class="num" id="LN3535">3535</td><td class="line"><span class='directive'>#ifdef STBI_SSE2</span></td></tr>
<tr class="codeline" data-linenumber="3536"><td class="num" id="LN3536">3536</td><td class="line">   <span class='keyword'>if</span> (stbi__sse2_available()) {</td></tr>
<tr class="codeline" data-linenumber="3537"><td class="num" id="LN3537">3537</td><td class="line">      j-&gt;idct_block_kernel = stbi__idct_simd;</td></tr>
<tr class="codeline" data-linenumber="3538"><td class="num" id="LN3538">3538</td><td class="line">      j-&gt;YCbCr_to_RGB_kernel = stbi__YCbCr_to_RGB_simd;</td></tr>
<tr class="codeline" data-linenumber="3539"><td class="num" id="LN3539">3539</td><td class="line">      j-&gt;resample_row_hv_2_kernel = stbi__resample_row_hv_2_simd;</td></tr>
<tr class="codeline" data-linenumber="3540"><td class="num" id="LN3540">3540</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3541"><td class="num" id="LN3541">3541</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3542"><td class="num" id="LN3542">3542</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3543"><td class="num" id="LN3543">3543</td><td class="line"><span class='directive'>#ifdef STBI_NEON</span></td></tr>
<tr class="codeline" data-linenumber="3544"><td class="num" id="LN3544">3544</td><td class="line">   j-&gt;idct_block_kernel = stbi__idct_simd;</td></tr>
<tr class="codeline" data-linenumber="3545"><td class="num" id="LN3545">3545</td><td class="line">   j-&gt;YCbCr_to_RGB_kernel = stbi__YCbCr_to_RGB_simd;</td></tr>
<tr class="codeline" data-linenumber="3546"><td class="num" id="LN3546">3546</td><td class="line">   j-&gt;resample_row_hv_2_kernel = stbi__resample_row_hv_2_simd;</td></tr>
<tr class="codeline" data-linenumber="3547"><td class="num" id="LN3547">3547</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3548"><td class="num" id="LN3548">3548</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3549"><td class="num" id="LN3549">3549</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3550"><td class="num" id="LN3550">3550</td><td class="line"><span class='comment'>// clean up the temporary component buffers</span></td></tr>
<tr class="codeline" data-linenumber="3551"><td class="num" id="LN3551">3551</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__cleanup_jpeg(stbi__jpeg *j)</td></tr>
<tr class="codeline" data-linenumber="3552"><td class="num" id="LN3552">3552</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3553"><td class="num" id="LN3553">3553</td><td class="line">   stbi__free_jpeg_components(j, j-&gt;s-&gt;img_n, 0);</td></tr>
<tr class="codeline" data-linenumber="3554"><td class="num" id="LN3554">3554</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3555"><td class="num" id="LN3555">3555</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3556"><td class="num" id="LN3556">3556</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="3557"><td class="num" id="LN3557">3557</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3558"><td class="num" id="LN3558">3558</td><td class="line">   resample_row_func resample;</td></tr>
<tr class="codeline" data-linenumber="3559"><td class="num" id="LN3559">3559</td><td class="line">   stbi_uc *line0,*line1;</td></tr>
<tr class="codeline" data-linenumber="3560"><td class="num" id="LN3560">3560</td><td class="line">   <span class='keyword'>int</span> hs,vs;   <span class='comment'>// expansion factor in each axis</span></td></tr>
<tr class="codeline" data-linenumber="3561"><td class="num" id="LN3561">3561</td><td class="line">   <span class='keyword'>int</span> w_lores; <span class='comment'>// horizontal pixels pre-expansion</span></td></tr>
<tr class="codeline" data-linenumber="3562"><td class="num" id="LN3562">3562</td><td class="line">   <span class='keyword'>int</span> ystep;   <span class='comment'>// how far through vertical expansion we are</span></td></tr>
<tr class="codeline" data-linenumber="3563"><td class="num" id="LN3563">3563</td><td class="line">   <span class='keyword'>int</span> ypos;    <span class='comment'>// which pre-expansion row we're on</span></td></tr>
<tr class="codeline" data-linenumber="3564"><td class="num" id="LN3564">3564</td><td class="line">} stbi__resample;</td></tr>
<tr class="codeline" data-linenumber="3565"><td class="num" id="LN3565">3565</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3566"><td class="num" id="LN3566">3566</td><td class="line"><span class='comment'>// fast 0..255 * 0..255 =&gt; 0..255 rounded multiplication</span></td></tr>
<tr class="codeline" data-linenumber="3567"><td class="num" id="LN3567">3567</td><td class="line"><span class='keyword'>static</span> stbi_uc stbi__blinn_8x8(stbi_uc x, stbi_uc y)</td></tr>
<tr class="codeline" data-linenumber="3568"><td class="num" id="LN3568">3568</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3569"><td class="num" id="LN3569">3569</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> t = x*y + 128;</td></tr>
<tr class="codeline" data-linenumber="3570"><td class="num" id="LN3570">3570</td><td class="line">   <span class='keyword'>return</span> (stbi_uc) ((t + (t &gt;&gt;8)) &gt;&gt; 8);</td></tr>
<tr class="codeline" data-linenumber="3571"><td class="num" id="LN3571">3571</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3572"><td class="num" id="LN3572">3572</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3573"><td class="num" id="LN3573">3573</td><td class="line"><span class='keyword'>static</span> stbi_uc *load_jpeg_image(stbi__jpeg *z, <span class='keyword'>int</span> *out_x, <span class='keyword'>int</span> *out_y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="3574"><td class="num" id="LN3574">3574</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3575"><td class="num" id="LN3575">3575</td><td class="line">   <span class='keyword'>int</span> n, decode_n, is_rgb;</td></tr>
<tr class="codeline" data-linenumber="3576"><td class="num" id="LN3576">3576</td><td class="line">   z-&gt;s-&gt;img_n = 0; <span class='comment'>// make stbi__cleanup_jpeg safe</span></td></tr>
<tr class="codeline" data-linenumber="3577"><td class="num" id="LN3577">3577</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3578"><td class="num" id="LN3578">3578</td><td class="line">   <span class='comment'>// validate req_comp</span></td></tr>
<tr class="codeline" data-linenumber="3579"><td class="num" id="LN3579">3579</td><td class="line">   <span class='keyword'>if</span> (req_comp &lt; 0 || req_comp &gt; 4) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad req_comp"</span>, <span class='string_literal'>"Internal error"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad req_comp")?((void*<br>)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3580"><td class="num" id="LN3580">3580</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3581"><td class="num" id="LN3581">3581</td><td class="line">   <span class='comment'>// load a jpeg image from whichever source, but leave in YCbCr format</span></td></tr>
<tr class="codeline" data-linenumber="3582"><td class="num" id="LN3582">3582</td><td class="line">   <span class='keyword'>if</span> (!stbi__decode_jpeg_image(z)) { stbi__cleanup_jpeg(z); <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="3583"><td class="num" id="LN3583">3583</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3584"><td class="num" id="LN3584">3584</td><td class="line">   <span class='comment'>// determine actual number of components to generate</span></td></tr>
<tr class="codeline" data-linenumber="3585"><td class="num" id="LN3585">3585</td><td class="line">   n = req_comp ? req_comp : z-&gt;s-&gt;img_n &gt;= 3 ? 3 : 1;</td></tr>
<tr class="codeline" data-linenumber="3586"><td class="num" id="LN3586">3586</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3587"><td class="num" id="LN3587">3587</td><td class="line">   is_rgb = z-&gt;s-&gt;img_n == 3 &amp;&amp; (z-&gt;rgb == 3 || (z-&gt;app14_color_transform == 0 &amp;&amp; !z-&gt;jfif));</td></tr>
<tr class="codeline" data-linenumber="3588"><td class="num" id="LN3588">3588</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3589"><td class="num" id="LN3589">3589</td><td class="line">   <span class='keyword'>if</span> (z-&gt;s-&gt;img_n == 3 &amp;&amp; n &lt; 3 &amp;&amp; !is_rgb)</td></tr>
<tr class="codeline" data-linenumber="3590"><td class="num" id="LN3590">3590</td><td class="line">      decode_n = 1;</td></tr>
<tr class="codeline" data-linenumber="3591"><td class="num" id="LN3591">3591</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3592"><td class="num" id="LN3592">3592</td><td class="line">      decode_n = z-&gt;s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="3593"><td class="num" id="LN3593">3593</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3594"><td class="num" id="LN3594">3594</td><td class="line">   <span class='comment'>// resample and color-convert</span></td></tr>
<tr class="codeline" data-linenumber="3595"><td class="num" id="LN3595">3595</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="3596"><td class="num" id="LN3596">3596</td><td class="line">      <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="3597"><td class="num" id="LN3597">3597</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>int</span> i,j;</td></tr>
<tr class="codeline" data-linenumber="3598"><td class="num" id="LN3598">3598</td><td class="line">      stbi_uc *output;</td></tr>
<tr class="codeline" data-linenumber="3599"><td class="num" id="LN3599">3599</td><td class="line">      stbi_uc *coutput[4];</td></tr>
<tr class="codeline" data-linenumber="3600"><td class="num" id="LN3600">3600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3601"><td class="num" id="LN3601">3601</td><td class="line">      stbi__resample res_comp[4];</td></tr>
<tr class="codeline" data-linenumber="3602"><td class="num" id="LN3602">3602</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3603"><td class="num" id="LN3603">3603</td><td class="line">      <span class='keyword'>for</span> (k=0; k &lt; decode_n; ++k) {</td></tr>
<tr class="codeline" data-linenumber="3604"><td class="num" id="LN3604">3604</td><td class="line">         stbi__resample *r = &amp;res_comp[k];</td></tr>
<tr class="codeline" data-linenumber="3605"><td class="num" id="LN3605">3605</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3606"><td class="num" id="LN3606">3606</td><td class="line">         <span class='comment'>// allocate line buffer big enough for upsampling off the edges</span></td></tr>
<tr class="codeline" data-linenumber="3607"><td class="num" id="LN3607">3607</td><td class="line">         <span class='comment'>// with upsample factor of 4</span></td></tr>
<tr class="codeline" data-linenumber="3608"><td class="num" id="LN3608">3608</td><td class="line">         z-&gt;img_comp[k].linebuf = (stbi_uc *) stbi__malloc(z-&gt;s-&gt;img_x + 3);</td></tr>
<tr class="codeline" data-linenumber="3609"><td class="num" id="LN3609">3609</td><td class="line">         <span class='keyword'>if</span> (!z-&gt;img_comp[k].linebuf) { stbi__cleanup_jpeg(z); <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="3610"><td class="num" id="LN3610">3610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3611"><td class="num" id="LN3611">3611</td><td class="line">         r-&gt;hs      = z-&gt;img_h_max / z-&gt;img_comp[k].h;</td></tr>
<tr class="codeline" data-linenumber="3612"><td class="num" id="LN3612">3612</td><td class="line">         r-&gt;vs      = z-&gt;img_v_max / z-&gt;img_comp[k].v;</td></tr>
<tr class="codeline" data-linenumber="3613"><td class="num" id="LN3613">3613</td><td class="line">         r-&gt;ystep   = r-&gt;vs &gt;&gt; 1;</td></tr>
<tr class="codeline" data-linenumber="3614"><td class="num" id="LN3614">3614</td><td class="line">         r-&gt;w_lores = (z-&gt;s-&gt;img_x + r-&gt;hs-1) / r-&gt;hs;</td></tr>
<tr class="codeline" data-linenumber="3615"><td class="num" id="LN3615">3615</td><td class="line">         r-&gt;ypos    = 0;</td></tr>
<tr class="codeline" data-linenumber="3616"><td class="num" id="LN3616">3616</td><td class="line">         r-&gt;line0   = r-&gt;line1 = z-&gt;img_comp[k].data;</td></tr>
<tr class="codeline" data-linenumber="3617"><td class="num" id="LN3617">3617</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3618"><td class="num" id="LN3618">3618</td><td class="line">         <span class='keyword'>if</span>      (r-&gt;hs == 1 &amp;&amp; r-&gt;vs == 1) r-&gt;resample = resample_row_1;</td></tr>
<tr class="codeline" data-linenumber="3619"><td class="num" id="LN3619">3619</td><td class="line">         <span class='keyword'>else</span> <span class='keyword'>if</span> (r-&gt;hs == 1 &amp;&amp; r-&gt;vs == 2) r-&gt;resample = stbi__resample_row_v_2;</td></tr>
<tr class="codeline" data-linenumber="3620"><td class="num" id="LN3620">3620</td><td class="line">         <span class='keyword'>else</span> <span class='keyword'>if</span> (r-&gt;hs == 2 &amp;&amp; r-&gt;vs == 1) r-&gt;resample = stbi__resample_row_h_2;</td></tr>
<tr class="codeline" data-linenumber="3621"><td class="num" id="LN3621">3621</td><td class="line">         <span class='keyword'>else</span> <span class='keyword'>if</span> (r-&gt;hs == 2 &amp;&amp; r-&gt;vs == 2) r-&gt;resample = z-&gt;resample_row_hv_2_kernel;</td></tr>
<tr class="codeline" data-linenumber="3622"><td class="num" id="LN3622">3622</td><td class="line">         <span class='keyword'>else</span>                               r-&gt;resample = stbi__resample_row_generic;</td></tr>
<tr class="codeline" data-linenumber="3623"><td class="num" id="LN3623">3623</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3624"><td class="num" id="LN3624">3624</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3625"><td class="num" id="LN3625">3625</td><td class="line">      <span class='comment'>// can't error after this so, this is safe</span></td></tr>
<tr class="codeline" data-linenumber="3626"><td class="num" id="LN3626">3626</td><td class="line">      output = (stbi_uc *) stbi__malloc_mad3(n, z-&gt;s-&gt;img_x, z-&gt;s-&gt;img_y, 1);</td></tr>
<tr class="codeline" data-linenumber="3627"><td class="num" id="LN3627">3627</td><td class="line">      <span class='keyword'>if</span> (!output) { stbi__cleanup_jpeg(z); <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="3628"><td class="num" id="LN3628">3628</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3629"><td class="num" id="LN3629">3629</td><td class="line">      <span class='comment'>// now go ahead and resample</span></td></tr>
<tr class="codeline" data-linenumber="3630"><td class="num" id="LN3630">3630</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; z-&gt;s-&gt;img_y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="3631"><td class="num" id="LN3631">3631</td><td class="line">         stbi_uc *out = output + n * z-&gt;s-&gt;img_x * j;</td></tr>
<tr class="codeline" data-linenumber="3632"><td class="num" id="LN3632">3632</td><td class="line">         <span class='keyword'>for</span> (k=0; k &lt; decode_n; ++k) {</td></tr>
<tr class="codeline" data-linenumber="3633"><td class="num" id="LN3633">3633</td><td class="line">            stbi__resample *r = &amp;res_comp[k];</td></tr>
<tr class="codeline" data-linenumber="3634"><td class="num" id="LN3634">3634</td><td class="line">            <span class='keyword'>int</span> y_bot = r-&gt;ystep &gt;= (r-&gt;vs &gt;&gt; 1);</td></tr>
<tr class="codeline" data-linenumber="3635"><td class="num" id="LN3635">3635</td><td class="line">            coutput[k] = r-&gt;resample(z-&gt;img_comp[k].linebuf,</td></tr>
<tr class="codeline" data-linenumber="3636"><td class="num" id="LN3636">3636</td><td class="line">                                     y_bot ? r-&gt;line1 : r-&gt;line0,</td></tr>
<tr class="codeline" data-linenumber="3637"><td class="num" id="LN3637">3637</td><td class="line">                                     y_bot ? r-&gt;line0 : r-&gt;line1,</td></tr>
<tr class="codeline" data-linenumber="3638"><td class="num" id="LN3638">3638</td><td class="line">                                     r-&gt;w_lores, r-&gt;hs);</td></tr>
<tr class="codeline" data-linenumber="3639"><td class="num" id="LN3639">3639</td><td class="line">            <span class='keyword'>if</span> (++r-&gt;ystep &gt;= r-&gt;vs) {</td></tr>
<tr class="codeline" data-linenumber="3640"><td class="num" id="LN3640">3640</td><td class="line">               r-&gt;ystep = 0;</td></tr>
<tr class="codeline" data-linenumber="3641"><td class="num" id="LN3641">3641</td><td class="line">               r-&gt;line0 = r-&gt;line1;</td></tr>
<tr class="codeline" data-linenumber="3642"><td class="num" id="LN3642">3642</td><td class="line">               <span class='keyword'>if</span> (++r-&gt;ypos &lt; z-&gt;img_comp[k].y)</td></tr>
<tr class="codeline" data-linenumber="3643"><td class="num" id="LN3643">3643</td><td class="line">                  r-&gt;line1 += z-&gt;img_comp[k].w2;</td></tr>
<tr class="codeline" data-linenumber="3644"><td class="num" id="LN3644">3644</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3645"><td class="num" id="LN3645">3645</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="3646"><td class="num" id="LN3646">3646</td><td class="line">         <span class='keyword'>if</span> (n &gt;= 3) {</td></tr>
<tr class="codeline" data-linenumber="3647"><td class="num" id="LN3647">3647</td><td class="line">            stbi_uc *y = coutput[0];</td></tr>
<tr class="codeline" data-linenumber="3648"><td class="num" id="LN3648">3648</td><td class="line">            <span class='keyword'>if</span> (z-&gt;s-&gt;img_n == 3) {</td></tr>
<tr class="codeline" data-linenumber="3649"><td class="num" id="LN3649">3649</td><td class="line">               <span class='keyword'>if</span> (is_rgb) {</td></tr>
<tr class="codeline" data-linenumber="3650"><td class="num" id="LN3650">3650</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3651"><td class="num" id="LN3651">3651</td><td class="line">                     out[0] = y[i];</td></tr>
<tr class="codeline" data-linenumber="3652"><td class="num" id="LN3652">3652</td><td class="line">                     out[1] = coutput[1][i];</td></tr>
<tr class="codeline" data-linenumber="3653"><td class="num" id="LN3653">3653</td><td class="line">                     out[2] = coutput[2][i];</td></tr>
<tr class="codeline" data-linenumber="3654"><td class="num" id="LN3654">3654</td><td class="line">                     out[3] = 255;</td></tr>
<tr class="codeline" data-linenumber="3655"><td class="num" id="LN3655">3655</td><td class="line">                     out += n;</td></tr>
<tr class="codeline" data-linenumber="3656"><td class="num" id="LN3656">3656</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="3657"><td class="num" id="LN3657">3657</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3658"><td class="num" id="LN3658">3658</td><td class="line">                  z-&gt;YCbCr_to_RGB_kernel(out, y, coutput[1], coutput[2], z-&gt;s-&gt;img_x, n);</td></tr>
<tr class="codeline" data-linenumber="3659"><td class="num" id="LN3659">3659</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3660"><td class="num" id="LN3660">3660</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (z-&gt;s-&gt;img_n == 4) {</td></tr>
<tr class="codeline" data-linenumber="3661"><td class="num" id="LN3661">3661</td><td class="line">               <span class='keyword'>if</span> (z-&gt;app14_color_transform == 0) { <span class='comment'>// CMYK</span></td></tr>
<tr class="codeline" data-linenumber="3662"><td class="num" id="LN3662">3662</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3663"><td class="num" id="LN3663">3663</td><td class="line">                     stbi_uc m = coutput[3][i];</td></tr>
<tr class="codeline" data-linenumber="3664"><td class="num" id="LN3664">3664</td><td class="line">                     out[0] = stbi__blinn_8x8(coutput[0][i], m);</td></tr>
<tr class="codeline" data-linenumber="3665"><td class="num" id="LN3665">3665</td><td class="line">                     out[1] = stbi__blinn_8x8(coutput[1][i], m);</td></tr>
<tr class="codeline" data-linenumber="3666"><td class="num" id="LN3666">3666</td><td class="line">                     out[2] = stbi__blinn_8x8(coutput[2][i], m);</td></tr>
<tr class="codeline" data-linenumber="3667"><td class="num" id="LN3667">3667</td><td class="line">                     out[3] = 255;</td></tr>
<tr class="codeline" data-linenumber="3668"><td class="num" id="LN3668">3668</td><td class="line">                     out += n;</td></tr>
<tr class="codeline" data-linenumber="3669"><td class="num" id="LN3669">3669</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="3670"><td class="num" id="LN3670">3670</td><td class="line">               } <span class='keyword'>else</span> <span class='keyword'>if</span> (z-&gt;app14_color_transform == 2) { <span class='comment'>// YCCK</span></td></tr>
<tr class="codeline" data-linenumber="3671"><td class="num" id="LN3671">3671</td><td class="line">                  z-&gt;YCbCr_to_RGB_kernel(out, y, coutput[1], coutput[2], z-&gt;s-&gt;img_x, n);</td></tr>
<tr class="codeline" data-linenumber="3672"><td class="num" id="LN3672">3672</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3673"><td class="num" id="LN3673">3673</td><td class="line">                     stbi_uc m = coutput[3][i];</td></tr>
<tr class="codeline" data-linenumber="3674"><td class="num" id="LN3674">3674</td><td class="line">                     out[0] = stbi__blinn_8x8(255 - out[0], m);</td></tr>
<tr class="codeline" data-linenumber="3675"><td class="num" id="LN3675">3675</td><td class="line">                     out[1] = stbi__blinn_8x8(255 - out[1], m);</td></tr>
<tr class="codeline" data-linenumber="3676"><td class="num" id="LN3676">3676</td><td class="line">                     out[2] = stbi__blinn_8x8(255 - out[2], m);</td></tr>
<tr class="codeline" data-linenumber="3677"><td class="num" id="LN3677">3677</td><td class="line">                     out += n;</td></tr>
<tr class="codeline" data-linenumber="3678"><td class="num" id="LN3678">3678</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="3679"><td class="num" id="LN3679">3679</td><td class="line">               } <span class='keyword'>else</span> { <span class='comment'>// YCbCr + alpha?  Ignore the fourth channel for now</span></td></tr>
<tr class="codeline" data-linenumber="3680"><td class="num" id="LN3680">3680</td><td class="line">                  z-&gt;YCbCr_to_RGB_kernel(out, y, coutput[1], coutput[2], z-&gt;s-&gt;img_x, n);</td></tr>
<tr class="codeline" data-linenumber="3681"><td class="num" id="LN3681">3681</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3682"><td class="num" id="LN3682">3682</td><td class="line">            } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3683"><td class="num" id="LN3683">3683</td><td class="line">               <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3684"><td class="num" id="LN3684">3684</td><td class="line">                  out[0] = out[1] = out[2] = y[i];</td></tr>
<tr class="codeline" data-linenumber="3685"><td class="num" id="LN3685">3685</td><td class="line">                  out[3] = 255; <span class='comment'>// not used if n==3</span></td></tr>
<tr class="codeline" data-linenumber="3686"><td class="num" id="LN3686">3686</td><td class="line">                  out += n;</td></tr>
<tr class="codeline" data-linenumber="3687"><td class="num" id="LN3687">3687</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3688"><td class="num" id="LN3688">3688</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3689"><td class="num" id="LN3689">3689</td><td class="line">            <span class='keyword'>if</span> (is_rgb) {</td></tr>
<tr class="codeline" data-linenumber="3690"><td class="num" id="LN3690">3690</td><td class="line">               <span class='keyword'>if</span> (n == 1)</td></tr>
<tr class="codeline" data-linenumber="3691"><td class="num" id="LN3691">3691</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i)</td></tr>
<tr class="codeline" data-linenumber="3692"><td class="num" id="LN3692">3692</td><td class="line">                     *out++ = stbi__compute_y(coutput[0][i], coutput[1][i], coutput[2][i]);</td></tr>
<tr class="codeline" data-linenumber="3693"><td class="num" id="LN3693">3693</td><td class="line">               <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3694"><td class="num" id="LN3694">3694</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i, out += 2) {</td></tr>
<tr class="codeline" data-linenumber="3695"><td class="num" id="LN3695">3695</td><td class="line">                     out[0] = stbi__compute_y(coutput[0][i], coutput[1][i], coutput[2][i]);</td></tr>
<tr class="codeline" data-linenumber="3696"><td class="num" id="LN3696">3696</td><td class="line">                     out[1] = 255;</td></tr>
<tr class="codeline" data-linenumber="3697"><td class="num" id="LN3697">3697</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="3698"><td class="num" id="LN3698">3698</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3699"><td class="num" id="LN3699">3699</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (z-&gt;s-&gt;img_n == 4 &amp;&amp; z-&gt;app14_color_transform == 0) {</td></tr>
<tr class="codeline" data-linenumber="3700"><td class="num" id="LN3700">3700</td><td class="line">               <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3701"><td class="num" id="LN3701">3701</td><td class="line">                  stbi_uc m = coutput[3][i];</td></tr>
<tr class="codeline" data-linenumber="3702"><td class="num" id="LN3702">3702</td><td class="line">                  stbi_uc r = stbi__blinn_8x8(coutput[0][i], m);</td></tr>
<tr class="codeline" data-linenumber="3703"><td class="num" id="LN3703">3703</td><td class="line">                  stbi_uc g = stbi__blinn_8x8(coutput[1][i], m);</td></tr>
<tr class="codeline" data-linenumber="3704"><td class="num" id="LN3704">3704</td><td class="line">                  stbi_uc b = stbi__blinn_8x8(coutput[2][i], m);</td></tr>
<tr class="codeline" data-linenumber="3705"><td class="num" id="LN3705">3705</td><td class="line">                  out[0] = stbi__compute_y(r, g, b);</td></tr>
<tr class="codeline" data-linenumber="3706"><td class="num" id="LN3706">3706</td><td class="line">                  out[1] = 255;</td></tr>
<tr class="codeline" data-linenumber="3707"><td class="num" id="LN3707">3707</td><td class="line">                  out += n;</td></tr>
<tr class="codeline" data-linenumber="3708"><td class="num" id="LN3708">3708</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3709"><td class="num" id="LN3709">3709</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (z-&gt;s-&gt;img_n == 4 &amp;&amp; z-&gt;app14_color_transform == 2) {</td></tr>
<tr class="codeline" data-linenumber="3710"><td class="num" id="LN3710">3710</td><td class="line">               <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3711"><td class="num" id="LN3711">3711</td><td class="line">                  out[0] = stbi__blinn_8x8(255 - coutput[0][i], coutput[3][i]);</td></tr>
<tr class="codeline" data-linenumber="3712"><td class="num" id="LN3712">3712</td><td class="line">                  out[1] = 255;</td></tr>
<tr class="codeline" data-linenumber="3713"><td class="num" id="LN3713">3713</td><td class="line">                  out += n;</td></tr>
<tr class="codeline" data-linenumber="3714"><td class="num" id="LN3714">3714</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="3715"><td class="num" id="LN3715">3715</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3716"><td class="num" id="LN3716">3716</td><td class="line">               stbi_uc *y = coutput[0];</td></tr>
<tr class="codeline" data-linenumber="3717"><td class="num" id="LN3717">3717</td><td class="line">               <span class='keyword'>if</span> (n == 1)</td></tr>
<tr class="codeline" data-linenumber="3718"><td class="num" id="LN3718">3718</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) out[i] = y[i];</td></tr>
<tr class="codeline" data-linenumber="3719"><td class="num" id="LN3719">3719</td><td class="line">               <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3720"><td class="num" id="LN3720">3720</td><td class="line">                  <span class='keyword'>for</span> (i=0; i &lt; z-&gt;s-&gt;img_x; ++i) *out++ = y[i], *out++ = 255;</td></tr>
<tr class="codeline" data-linenumber="3721"><td class="num" id="LN3721">3721</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3722"><td class="num" id="LN3722">3722</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="3723"><td class="num" id="LN3723">3723</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3724"><td class="num" id="LN3724">3724</td><td class="line">      stbi__cleanup_jpeg(z);</td></tr>
<tr class="codeline" data-linenumber="3725"><td class="num" id="LN3725">3725</td><td class="line">      *out_x = z-&gt;s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="3726"><td class="num" id="LN3726">3726</td><td class="line">      *out_y = z-&gt;s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="3727"><td class="num" id="LN3727">3727</td><td class="line">      <span class='keyword'>if</span> (comp) *comp = z-&gt;s-&gt;img_n &gt;= 3 ? 3 : 1; <span class='comment'>// report original components, not output</span></td></tr>
<tr class="codeline" data-linenumber="3728"><td class="num" id="LN3728">3728</td><td class="line">      <span class='keyword'>return</span> output;</td></tr>
<tr class="codeline" data-linenumber="3729"><td class="num" id="LN3729">3729</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3730"><td class="num" id="LN3730">3730</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3731"><td class="num" id="LN3731">3731</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3732"><td class="num" id="LN3732">3732</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__jpeg_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="3733"><td class="num" id="LN3733">3733</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3734"><td class="num" id="LN3734">3734</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span>* result;</td></tr>
<tr class="codeline" data-linenumber="3735"><td class="num" id="LN3735">3735</td><td class="line">   stbi__jpeg* j = (stbi__jpeg*) stbi__malloc(<span class='keyword'>sizeof</span>(stbi__jpeg));</td></tr>
<tr class="codeline" data-linenumber="3736"><td class="num" id="LN3736">3736</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3737"><td class="num" id="LN3737">3737</td><td class="line">   j-&gt;s = s;</td></tr>
<tr class="codeline" data-linenumber="3738"><td class="num" id="LN3738">3738</td><td class="line">   stbi__setup_jpeg(j);</td></tr>
<tr class="codeline" data-linenumber="3739"><td class="num" id="LN3739">3739</td><td class="line">   result = load_jpeg_image(j, x,y,comp,req_comp);</td></tr>
<tr class="codeline" data-linenumber="3740"><td class="num" id="LN3740">3740</td><td class="line">   <span class='macro'>STBI_FREE(j)<span class='macro_popup'>free(j)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3741"><td class="num" id="LN3741">3741</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="3742"><td class="num" id="LN3742">3742</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3743"><td class="num" id="LN3743">3743</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3744"><td class="num" id="LN3744">3744</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="3745"><td class="num" id="LN3745">3745</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3746"><td class="num" id="LN3746">3746</td><td class="line">   <span class='keyword'>int</span> r;</td></tr>
<tr class="codeline" data-linenumber="3747"><td class="num" id="LN3747">3747</td><td class="line">   stbi__jpeg* j = (stbi__jpeg*)stbi__malloc(<span class='keyword'>sizeof</span>(stbi__jpeg));</td></tr>
<tr class="codeline" data-linenumber="3748"><td class="num" id="LN3748">3748</td><td class="line">   j-&gt;s = s;</td></tr>
<tr class="codeline" data-linenumber="3749"><td class="num" id="LN3749">3749</td><td class="line">   stbi__setup_jpeg(j);</td></tr>
<tr class="codeline" data-linenumber="3750"><td class="num" id="LN3750">3750</td><td class="line">   r = stbi__decode_jpeg_header(j, STBI__SCAN_type);</td></tr>
<tr class="codeline" data-linenumber="3751"><td class="num" id="LN3751">3751</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="3752"><td class="num" id="LN3752">3752</td><td class="line">   <span class='macro'>STBI_FREE(j)<span class='macro_popup'>free(j)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3753"><td class="num" id="LN3753">3753</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="3754"><td class="num" id="LN3754">3754</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3755"><td class="num" id="LN3755">3755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3756"><td class="num" id="LN3756">3756</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_info_raw(stbi__jpeg *j, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="3757"><td class="num" id="LN3757">3757</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3758"><td class="num" id="LN3758">3758</td><td class="line">   <span class='keyword'>if</span> (!stbi__decode_jpeg_header(j, STBI__SCAN_header)) {</td></tr>
<tr class="codeline" data-linenumber="3759"><td class="num" id="LN3759">3759</td><td class="line">      stbi__rewind( j-&gt;s );</td></tr>
<tr class="codeline" data-linenumber="3760"><td class="num" id="LN3760">3760</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3761"><td class="num" id="LN3761">3761</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3762"><td class="num" id="LN3762">3762</td><td class="line">   <span class='keyword'>if</span> (x) *x = j-&gt;s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="3763"><td class="num" id="LN3763">3763</td><td class="line">   <span class='keyword'>if</span> (y) *y = j-&gt;s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="3764"><td class="num" id="LN3764">3764</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = j-&gt;s-&gt;img_n &gt;= 3 ? 3 : 1;</td></tr>
<tr class="codeline" data-linenumber="3765"><td class="num" id="LN3765">3765</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3766"><td class="num" id="LN3766">3766</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3767"><td class="num" id="LN3767">3767</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3768"><td class="num" id="LN3768">3768</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__jpeg_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="3769"><td class="num" id="LN3769">3769</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3770"><td class="num" id="LN3770">3770</td><td class="line">   <span class='keyword'>int</span> result;</td></tr>
<tr class="codeline" data-linenumber="3771"><td class="num" id="LN3771">3771</td><td class="line">   stbi__jpeg* j = (stbi__jpeg*) (stbi__malloc(<span class='keyword'>sizeof</span>(stbi__jpeg)));</td></tr>
<tr class="codeline" data-linenumber="3772"><td class="num" id="LN3772">3772</td><td class="line">   j-&gt;s = s;</td></tr>
<tr class="codeline" data-linenumber="3773"><td class="num" id="LN3773">3773</td><td class="line">   result = stbi__jpeg_info_raw(j, x, y, comp);</td></tr>
<tr class="codeline" data-linenumber="3774"><td class="num" id="LN3774">3774</td><td class="line">   <span class='macro'>STBI_FREE(j)<span class='macro_popup'>free(j)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3775"><td class="num" id="LN3775">3775</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="3776"><td class="num" id="LN3776">3776</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3777"><td class="num" id="LN3777">3777</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3778"><td class="num" id="LN3778">3778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3779"><td class="num" id="LN3779">3779</td><td class="line"><span class='comment'>// public domain zlib decode    v0.2  Sean Barrett 2006-11-18</span></td></tr>
<tr class="codeline" data-linenumber="3780"><td class="num" id="LN3780">3780</td><td class="line"><span class='comment'>//    simple implementation</span></td></tr>
<tr class="codeline" data-linenumber="3781"><td class="num" id="LN3781">3781</td><td class="line"><span class='comment'>//      - all input must be provided in an upfront buffer</span></td></tr>
<tr class="codeline" data-linenumber="3782"><td class="num" id="LN3782">3782</td><td class="line"><span class='comment'>//      - all output is written to a single output buffer (can malloc/realloc)</span></td></tr>
<tr class="codeline" data-linenumber="3783"><td class="num" id="LN3783">3783</td><td class="line"><span class='comment'>//    performance</span></td></tr>
<tr class="codeline" data-linenumber="3784"><td class="num" id="LN3784">3784</td><td class="line"><span class='comment'>//      - fast huffman</span></td></tr>
<tr class="codeline" data-linenumber="3785"><td class="num" id="LN3785">3785</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3786"><td class="num" id="LN3786">3786</td><td class="line"><span class='directive'>#ifndef STBI_NO_ZLIB</span></td></tr>
<tr class="codeline" data-linenumber="3787"><td class="num" id="LN3787">3787</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3788"><td class="num" id="LN3788">3788</td><td class="line"><span class='comment'>// fast-way is faster to check than jpeg huffman, but slow way is slower</span></td></tr>
<tr class="codeline" data-linenumber="3789"><td class="num" id="LN3789">3789</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__ZFAST_BITS<span class='macro_popup'>9</span></span>  9 // accelerate all cases in default tables</span></td></tr>
<tr class="codeline" data-linenumber="3790"><td class="num" id="LN3790">3790</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__ZFAST_MASK<span class='macro_popup'>((1 &lt;&lt; 9) - 1)</span></span>  ((1 &lt;&lt; <span class='macro'>STBI__ZFAST_BITS<span class='macro_popup'>9</span></span>) - 1)</span></td></tr>
<tr class="codeline" data-linenumber="3791"><td class="num" id="LN3791">3791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3792"><td class="num" id="LN3792">3792</td><td class="line"><span class='comment'>// zlib-style huffman encoding</span></td></tr>
<tr class="codeline" data-linenumber="3793"><td class="num" id="LN3793">3793</td><td class="line"><span class='comment'>// (jpegs packs from left, zlib from right, so can't share code)</span></td></tr>
<tr class="codeline" data-linenumber="3794"><td class="num" id="LN3794">3794</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="3795"><td class="num" id="LN3795">3795</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3796"><td class="num" id="LN3796">3796</td><td class="line">   stbi__uint16 fast[1 &lt;&lt; <span class='macro'>STBI__ZFAST_BITS<span class='macro_popup'>9</span></span>];</td></tr>
<tr class="codeline" data-linenumber="3797"><td class="num" id="LN3797">3797</td><td class="line">   stbi__uint16 firstcode[16];</td></tr>
<tr class="codeline" data-linenumber="3798"><td class="num" id="LN3798">3798</td><td class="line">   <span class='keyword'>int</span> maxcode[17];</td></tr>
<tr class="codeline" data-linenumber="3799"><td class="num" id="LN3799">3799</td><td class="line">   stbi__uint16 firstsymbol[16];</td></tr>
<tr class="codeline" data-linenumber="3800"><td class="num" id="LN3800">3800</td><td class="line">   stbi_uc  size[288];</td></tr>
<tr class="codeline" data-linenumber="3801"><td class="num" id="LN3801">3801</td><td class="line">   stbi__uint16 value[288];</td></tr>
<tr class="codeline" data-linenumber="3802"><td class="num" id="LN3802">3802</td><td class="line">} stbi__zhuffman;</td></tr>
<tr class="codeline" data-linenumber="3803"><td class="num" id="LN3803">3803</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3804"><td class="num" id="LN3804">3804</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__bitreverse16(<span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="3805"><td class="num" id="LN3805">3805</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3806"><td class="num" id="LN3806">3806</td><td class="line">  n = ((n &amp; 0xAAAA) &gt;&gt;  1) | ((n &amp; 0x5555) &lt;&lt; 1);</td></tr>
<tr class="codeline" data-linenumber="3807"><td class="num" id="LN3807">3807</td><td class="line">  n = ((n &amp; 0xCCCC) &gt;&gt;  2) | ((n &amp; 0x3333) &lt;&lt; 2);</td></tr>
<tr class="codeline" data-linenumber="3808"><td class="num" id="LN3808">3808</td><td class="line">  n = ((n &amp; 0xF0F0) &gt;&gt;  4) | ((n &amp; 0x0F0F) &lt;&lt; 4);</td></tr>
<tr class="codeline" data-linenumber="3809"><td class="num" id="LN3809">3809</td><td class="line">  n = ((n &amp; 0xFF00) &gt;&gt;  8) | ((n &amp; 0x00FF) &lt;&lt; 8);</td></tr>
<tr class="codeline" data-linenumber="3810"><td class="num" id="LN3810">3810</td><td class="line">  <span class='keyword'>return</span> n;</td></tr>
<tr class="codeline" data-linenumber="3811"><td class="num" id="LN3811">3811</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3812"><td class="num" id="LN3812">3812</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3813"><td class="num" id="LN3813">3813</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__bit_reverse(<span class='keyword'>int</span> v, <span class='keyword'>int</span> bits)</td></tr>
<tr class="codeline" data-linenumber="3814"><td class="num" id="LN3814">3814</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3815"><td class="num" id="LN3815">3815</td><td class="line">   <span class='macro'>STBI_ASSERT(bits &lt;= 16)<span class='macro_popup'>((void) sizeof ((bits &lt;= 16) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= 16) ; else __assert_fail ("bits &lt;= 16", "src/stb_image.h"<br>, 3815, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3816"><td class="num" id="LN3816">3816</td><td class="line">   <span class='comment'>// to bit reverse n bits, reverse 16 and shift</span></td></tr>
<tr class="codeline" data-linenumber="3817"><td class="num" id="LN3817">3817</td><td class="line">   <span class='comment'>// e.g. 11 bits, bit reverse and shift away 5</span></td></tr>
<tr class="codeline" data-linenumber="3818"><td class="num" id="LN3818">3818</td><td class="line">   <span class='keyword'>return</span> stbi__bitreverse16(v) &gt;&gt; (16-bits);</td></tr>
<tr class="codeline" data-linenumber="3819"><td class="num" id="LN3819">3819</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3820"><td class="num" id="LN3820">3820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3821"><td class="num" id="LN3821">3821</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__zbuild_huffman(stbi__zhuffman *z, <span class='keyword'>const</span> stbi_uc *sizelist, <span class='keyword'>int</span> num)</td></tr>
<tr class="codeline" data-linenumber="3822"><td class="num" id="LN3822">3822</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3823"><td class="num" id="LN3823">3823</td><td class="line">   <span class='keyword'>int</span> i,k=0;</td></tr>
<tr class="codeline" data-linenumber="3824"><td class="num" id="LN3824">3824</td><td class="line">   <span class='keyword'>int</span> code, next_code[16], sizes[17];</td></tr>
<tr class="codeline" data-linenumber="3825"><td class="num" id="LN3825">3825</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3826"><td class="num" id="LN3826">3826</td><td class="line">   <span class='comment'>// DEFLATE spec for generating codes</span></td></tr>
<tr class="codeline" data-linenumber="3827"><td class="num" id="LN3827">3827</td><td class="line">   memset(sizes, 0, <span class='keyword'>sizeof</span>(sizes));</td></tr>
<tr class="codeline" data-linenumber="3828"><td class="num" id="LN3828">3828</td><td class="line">   memset(z-&gt;fast, 0, <span class='keyword'>sizeof</span>(z-&gt;fast));</td></tr>
<tr class="codeline" data-linenumber="3829"><td class="num" id="LN3829">3829</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; num; ++i)</td></tr>
<tr class="codeline" data-linenumber="3830"><td class="num" id="LN3830">3830</td><td class="line">      ++sizes[sizelist[i]];</td></tr>
<tr class="codeline" data-linenumber="3831"><td class="num" id="LN3831">3831</td><td class="line">   sizes[0] = 0;</td></tr>
<tr class="codeline" data-linenumber="3832"><td class="num" id="LN3832">3832</td><td class="line">   <span class='keyword'>for</span> (i=1; i &lt; 16; ++i)</td></tr>
<tr class="codeline" data-linenumber="3833"><td class="num" id="LN3833">3833</td><td class="line">      <span class='keyword'>if</span> (sizes[i] &gt; (1 &lt;&lt; i))</td></tr>
<tr class="codeline" data-linenumber="3834"><td class="num" id="LN3834">3834</td><td class="line">         <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad sizes"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad sizes")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3835"><td class="num" id="LN3835">3835</td><td class="line">   code = 0;</td></tr>
<tr class="codeline" data-linenumber="3836"><td class="num" id="LN3836">3836</td><td class="line">   <span class='keyword'>for</span> (i=1; i &lt; 16; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3837"><td class="num" id="LN3837">3837</td><td class="line">      next_code[i] = code;</td></tr>
<tr class="codeline" data-linenumber="3838"><td class="num" id="LN3838">3838</td><td class="line">      z-&gt;firstcode[i] = (stbi__uint16) code;</td></tr>
<tr class="codeline" data-linenumber="3839"><td class="num" id="LN3839">3839</td><td class="line">      z-&gt;firstsymbol[i] = (stbi__uint16) k;</td></tr>
<tr class="codeline" data-linenumber="3840"><td class="num" id="LN3840">3840</td><td class="line">      code = (code + sizes[i]);</td></tr>
<tr class="codeline" data-linenumber="3841"><td class="num" id="LN3841">3841</td><td class="line">      <span class='keyword'>if</span> (sizes[i])</td></tr>
<tr class="codeline" data-linenumber="3842"><td class="num" id="LN3842">3842</td><td class="line">         <span class='keyword'>if</span> (code-1 &gt;= (1 &lt;&lt; i)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad codelengths"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad codelengths")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3843"><td class="num" id="LN3843">3843</td><td class="line">      z-&gt;maxcode[i] = code &lt;&lt; (16-i); <span class='comment'>// preshift for inner loop</span></td></tr>
<tr class="codeline" data-linenumber="3844"><td class="num" id="LN3844">3844</td><td class="line">      code &lt;&lt;= 1;</td></tr>
<tr class="codeline" data-linenumber="3845"><td class="num" id="LN3845">3845</td><td class="line">      k += sizes[i];</td></tr>
<tr class="codeline" data-linenumber="3846"><td class="num" id="LN3846">3846</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3847"><td class="num" id="LN3847">3847</td><td class="line">   z-&gt;maxcode[16] = 0x10000; <span class='comment'>// sentinel</span></td></tr>
<tr class="codeline" data-linenumber="3848"><td class="num" id="LN3848">3848</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; num; ++i) {</td></tr>
<tr class="codeline" data-linenumber="3849"><td class="num" id="LN3849">3849</td><td class="line">      <span class='keyword'>int</span> s = sizelist[i];</td></tr>
<tr class="codeline" data-linenumber="3850"><td class="num" id="LN3850">3850</td><td class="line">      <span class='keyword'>if</span> (s) {</td></tr>
<tr class="codeline" data-linenumber="3851"><td class="num" id="LN3851">3851</td><td class="line">         <span class='keyword'>int</span> c = next_code[s] - z-&gt;firstcode[s] + z-&gt;firstsymbol[s];</td></tr>
<tr class="codeline" data-linenumber="3852"><td class="num" id="LN3852">3852</td><td class="line">         stbi__uint16 fastv = (stbi__uint16) ((s &lt;&lt; 9) | i);</td></tr>
<tr class="codeline" data-linenumber="3853"><td class="num" id="LN3853">3853</td><td class="line">         z-&gt;size [c] = (stbi_uc     ) s;</td></tr>
<tr class="codeline" data-linenumber="3854"><td class="num" id="LN3854">3854</td><td class="line">         z-&gt;value[c] = (stbi__uint16) i;</td></tr>
<tr class="codeline" data-linenumber="3855"><td class="num" id="LN3855">3855</td><td class="line">         <span class='keyword'>if</span> (s &lt;= <span class='macro'>STBI__ZFAST_BITS<span class='macro_popup'>9</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3856"><td class="num" id="LN3856">3856</td><td class="line">            <span class='keyword'>int</span> j = stbi__bit_reverse(next_code[s],s);</td></tr>
<tr class="codeline" data-linenumber="3857"><td class="num" id="LN3857">3857</td><td class="line">            <span class='keyword'>while</span> (j &lt; (1 &lt;&lt; <span class='macro'>STBI__ZFAST_BITS<span class='macro_popup'>9</span></span>)) {</td></tr>
<tr class="codeline" data-linenumber="3858"><td class="num" id="LN3858">3858</td><td class="line">               z-&gt;fast[j] = fastv;</td></tr>
<tr class="codeline" data-linenumber="3859"><td class="num" id="LN3859">3859</td><td class="line">               j += (1 &lt;&lt; s);</td></tr>
<tr class="codeline" data-linenumber="3860"><td class="num" id="LN3860">3860</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3861"><td class="num" id="LN3861">3861</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="3862"><td class="num" id="LN3862">3862</td><td class="line">         ++next_code[s];</td></tr>
<tr class="codeline" data-linenumber="3863"><td class="num" id="LN3863">3863</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3864"><td class="num" id="LN3864">3864</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3865"><td class="num" id="LN3865">3865</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3866"><td class="num" id="LN3866">3866</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3867"><td class="num" id="LN3867">3867</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3868"><td class="num" id="LN3868">3868</td><td class="line"><span class='comment'>// zlib-from-memory implementation for PNG reading</span></td></tr>
<tr class="codeline" data-linenumber="3869"><td class="num" id="LN3869">3869</td><td class="line"><span class='comment'>//    because PNG allows splitting the zlib stream arbitrarily,</span></td></tr>
<tr class="codeline" data-linenumber="3870"><td class="num" id="LN3870">3870</td><td class="line"><span class='comment'>//    and it's annoying structurally to have PNG call ZLIB call PNG,</span></td></tr>
<tr class="codeline" data-linenumber="3871"><td class="num" id="LN3871">3871</td><td class="line"><span class='comment'>//    we require PNG read all the IDATs and combine them into a single</span></td></tr>
<tr class="codeline" data-linenumber="3872"><td class="num" id="LN3872">3872</td><td class="line"><span class='comment'>//    memory buffer</span></td></tr>
<tr class="codeline" data-linenumber="3873"><td class="num" id="LN3873">3873</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3874"><td class="num" id="LN3874">3874</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="3875"><td class="num" id="LN3875">3875</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3876"><td class="num" id="LN3876">3876</td><td class="line">   stbi_uc *zbuffer, *zbuffer_end;</td></tr>
<tr class="codeline" data-linenumber="3877"><td class="num" id="LN3877">3877</td><td class="line">   <span class='keyword'>int</span> num_bits;</td></tr>
<tr class="codeline" data-linenumber="3878"><td class="num" id="LN3878">3878</td><td class="line">   stbi__uint32 code_buffer;</td></tr>
<tr class="codeline" data-linenumber="3879"><td class="num" id="LN3879">3879</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3880"><td class="num" id="LN3880">3880</td><td class="line">   <span class='keyword'>char</span> *zout;</td></tr>
<tr class="codeline" data-linenumber="3881"><td class="num" id="LN3881">3881</td><td class="line">   <span class='keyword'>char</span> *zout_start;</td></tr>
<tr class="codeline" data-linenumber="3882"><td class="num" id="LN3882">3882</td><td class="line">   <span class='keyword'>char</span> *zout_end;</td></tr>
<tr class="codeline" data-linenumber="3883"><td class="num" id="LN3883">3883</td><td class="line">   <span class='keyword'>int</span>   z_expandable;</td></tr>
<tr class="codeline" data-linenumber="3884"><td class="num" id="LN3884">3884</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3885"><td class="num" id="LN3885">3885</td><td class="line">   stbi__zhuffman z_length, z_distance;</td></tr>
<tr class="codeline" data-linenumber="3886"><td class="num" id="LN3886">3886</td><td class="line">} stbi__zbuf;</td></tr>
<tr class="codeline" data-linenumber="3887"><td class="num" id="LN3887">3887</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3888"><td class="num" id="LN3888">3888</td><td class="line">stbi_inline <span class='keyword'>static</span> stbi_uc stbi__zget8(stbi__zbuf *z)</td></tr>
<tr class="codeline" data-linenumber="3889"><td class="num" id="LN3889">3889</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3890"><td class="num" id="LN3890">3890</td><td class="line">   <span class='keyword'>if</span> (z-&gt;zbuffer &gt;= z-&gt;zbuffer_end) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3891"><td class="num" id="LN3891">3891</td><td class="line">   <span class='keyword'>return</span> *z-&gt;zbuffer++;</td></tr>
<tr class="codeline" data-linenumber="3892"><td class="num" id="LN3892">3892</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3893"><td class="num" id="LN3893">3893</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3894"><td class="num" id="LN3894">3894</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__fill_bits(stbi__zbuf *z)</td></tr>
<tr class="codeline" data-linenumber="3895"><td class="num" id="LN3895">3895</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3896"><td class="num" id="LN3896">3896</td><td class="line">   <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="3897"><td class="num" id="LN3897">3897</td><td class="line">      <span class='macro'>STBI_ASSERT(z-&gt;code_buffer &lt; (1U &lt;&lt; z-&gt;num_bits))<span class='macro_popup'>((void) sizeof ((z-&gt;code_buffer &lt; (1U &lt;&lt; z-&gt;num_bits<br>)) ? 1 : 0), __extension__ ({ if (z-&gt;code_buffer &lt; (1U &lt;&lt;<br> z-&gt;num_bits)) ; else __assert_fail ("z-&gt;code_buffer &lt; (1U &lt;&lt; z-&gt;num_bits)"<br>, "src/stb_image.h", 3897, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3898"><td class="num" id="LN3898">3898</td><td class="line">      z-&gt;code_buffer |= (<span class='keyword'>unsigned</span> <span class='keyword'>int</span>) stbi__zget8(z) &lt;&lt; z-&gt;num_bits;</td></tr>
<tr class="codeline" data-linenumber="3899"><td class="num" id="LN3899">3899</td><td class="line">      z-&gt;num_bits += 8;</td></tr>
<tr class="codeline" data-linenumber="3900"><td class="num" id="LN3900">3900</td><td class="line">   } <span class='keyword'>while</span> (z-&gt;num_bits &lt;= 24);</td></tr>
<tr class="codeline" data-linenumber="3901"><td class="num" id="LN3901">3901</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3902"><td class="num" id="LN3902">3902</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3903"><td class="num" id="LN3903">3903</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> stbi__zreceive(stbi__zbuf *z, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="3904"><td class="num" id="LN3904">3904</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3905"><td class="num" id="LN3905">3905</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="3906"><td class="num" id="LN3906">3906</td><td class="line">   <span class='keyword'>if</span> (z-&gt;num_bits &lt; n) stbi__fill_bits(z);</td></tr>
<tr class="codeline" data-linenumber="3907"><td class="num" id="LN3907">3907</td><td class="line">   k = z-&gt;code_buffer &amp; ((1 &lt;&lt; n) - 1);</td></tr>
<tr class="codeline" data-linenumber="3908"><td class="num" id="LN3908">3908</td><td class="line">   z-&gt;code_buffer &gt;&gt;= n;</td></tr>
<tr class="codeline" data-linenumber="3909"><td class="num" id="LN3909">3909</td><td class="line">   z-&gt;num_bits -= n;</td></tr>
<tr class="codeline" data-linenumber="3910"><td class="num" id="LN3910">3910</td><td class="line">   <span class='keyword'>return</span> k;</td></tr>
<tr class="codeline" data-linenumber="3911"><td class="num" id="LN3911">3911</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3912"><td class="num" id="LN3912">3912</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3913"><td class="num" id="LN3913">3913</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__zhuffman_decode_slowpath(stbi__zbuf *a, stbi__zhuffman *z)</td></tr>
<tr class="codeline" data-linenumber="3914"><td class="num" id="LN3914">3914</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3915"><td class="num" id="LN3915">3915</td><td class="line">   <span class='keyword'>int</span> b,s,k;</td></tr>
<tr class="codeline" data-linenumber="3916"><td class="num" id="LN3916">3916</td><td class="line">   <span class='comment'>// not resolved by fast table, so compute it the slow way</span></td></tr>
<tr class="codeline" data-linenumber="3917"><td class="num" id="LN3917">3917</td><td class="line">   <span class='comment'>// use jpeg approach, which requires MSbits at top</span></td></tr>
<tr class="codeline" data-linenumber="3918"><td class="num" id="LN3918">3918</td><td class="line">   k = stbi__bit_reverse(a-&gt;code_buffer, 16);</td></tr>
<tr class="codeline" data-linenumber="3919"><td class="num" id="LN3919">3919</td><td class="line">   <span class='keyword'>for</span> (s=<span class='macro'>STBI__ZFAST_BITS<span class='macro_popup'>9</span></span>+1; ; ++s)</td></tr>
<tr class="codeline" data-linenumber="3920"><td class="num" id="LN3920">3920</td><td class="line">      <span class='keyword'>if</span> (k &lt; z-&gt;maxcode[s])</td></tr>
<tr class="codeline" data-linenumber="3921"><td class="num" id="LN3921">3921</td><td class="line">         <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3922"><td class="num" id="LN3922">3922</td><td class="line">   <span class='keyword'>if</span> (s == 16) <span class='keyword'>return</span> -1; <span class='comment'>// invalid code!</span></td></tr>
<tr class="codeline" data-linenumber="3923"><td class="num" id="LN3923">3923</td><td class="line">   <span class='comment'>// code size is s, so:</span></td></tr>
<tr class="codeline" data-linenumber="3924"><td class="num" id="LN3924">3924</td><td class="line">   b = (k &gt;&gt; (16-s)) - z-&gt;firstcode[s] + z-&gt;firstsymbol[s];</td></tr>
<tr class="codeline" data-linenumber="3925"><td class="num" id="LN3925">3925</td><td class="line">   <span class='macro'>STBI_ASSERT(z-&gt;size[b] == s)<span class='macro_popup'>((void) sizeof ((z-&gt;size[b] == s) ? 1 : 0), __extension__ (<br>{ if (z-&gt;size[b] == s) ; else __assert_fail ("z-&gt;size[b] == s"<br>, "src/stb_image.h", 3925, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3926"><td class="num" id="LN3926">3926</td><td class="line">   a-&gt;code_buffer &gt;&gt;= s;</td></tr>
<tr class="codeline" data-linenumber="3927"><td class="num" id="LN3927">3927</td><td class="line">   a-&gt;num_bits -= s;</td></tr>
<tr class="codeline" data-linenumber="3928"><td class="num" id="LN3928">3928</td><td class="line">   <span class='keyword'>return</span> z-&gt;value[b];</td></tr>
<tr class="codeline" data-linenumber="3929"><td class="num" id="LN3929">3929</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3930"><td class="num" id="LN3930">3930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3931"><td class="num" id="LN3931">3931</td><td class="line">stbi_inline <span class='keyword'>static</span> <span class='keyword'>int</span> stbi__zhuffman_decode(stbi__zbuf *a, stbi__zhuffman *z)</td></tr>
<tr class="codeline" data-linenumber="3932"><td class="num" id="LN3932">3932</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3933"><td class="num" id="LN3933">3933</td><td class="line">   <span class='keyword'>int</span> b,s;</td></tr>
<tr class="codeline" data-linenumber="3934"><td class="num" id="LN3934">3934</td><td class="line">   <span class='keyword'>if</span> (a-&gt;num_bits &lt; 16) stbi__fill_bits(a);</td></tr>
<tr class="codeline" data-linenumber="3935"><td class="num" id="LN3935">3935</td><td class="line">   b = z-&gt;fast[a-&gt;code_buffer &amp; <span class='macro'>STBI__ZFAST_MASK<span class='macro_popup'>((1 &lt;&lt; 9) - 1)</span></span>];</td></tr>
<tr class="codeline" data-linenumber="3936"><td class="num" id="LN3936">3936</td><td class="line">   <span class='keyword'>if</span> (b) {</td></tr>
<tr class="codeline" data-linenumber="3937"><td class="num" id="LN3937">3937</td><td class="line">      s = b &gt;&gt; 9;</td></tr>
<tr class="codeline" data-linenumber="3938"><td class="num" id="LN3938">3938</td><td class="line">      a-&gt;code_buffer &gt;&gt;= s;</td></tr>
<tr class="codeline" data-linenumber="3939"><td class="num" id="LN3939">3939</td><td class="line">      a-&gt;num_bits -= s;</td></tr>
<tr class="codeline" data-linenumber="3940"><td class="num" id="LN3940">3940</td><td class="line">      <span class='keyword'>return</span> b &amp; 511;</td></tr>
<tr class="codeline" data-linenumber="3941"><td class="num" id="LN3941">3941</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="3942"><td class="num" id="LN3942">3942</td><td class="line">   <span class='keyword'>return</span> stbi__zhuffman_decode_slowpath(a, z);</td></tr>
<tr class="codeline" data-linenumber="3943"><td class="num" id="LN3943">3943</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3944"><td class="num" id="LN3944">3944</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3945"><td class="num" id="LN3945">3945</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__zexpand(stbi__zbuf *z, <span class='keyword'>char</span> *zout, <span class='keyword'>int</span> n)  <span class='comment'>// need to make room for n bytes</span></td></tr>
<tr class="codeline" data-linenumber="3946"><td class="num" id="LN3946">3946</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3947"><td class="num" id="LN3947">3947</td><td class="line">   <span class='keyword'>char</span> *q;</td></tr>
<tr class="codeline" data-linenumber="3948"><td class="num" id="LN3948">3948</td><td class="line">   <span class='keyword'>int</span> cur, limit, old_limit;</td></tr>
<tr class="codeline" data-linenumber="3949"><td class="num" id="LN3949">3949</td><td class="line">   z-&gt;zout = zout;</td></tr>
<tr class="codeline" data-linenumber="3950"><td class="num" id="LN3950">3950</td><td class="line">   <span class='keyword'>if</span> (!z-&gt;z_expandable) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"output buffer limit"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("output buffer limit")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3951"><td class="num" id="LN3951">3951</td><td class="line">   cur   = (<span class='keyword'>int</span>) (z-&gt;zout     - z-&gt;zout_start);</td></tr>
<tr class="codeline" data-linenumber="3952"><td class="num" id="LN3952">3952</td><td class="line">   limit = old_limit = (<span class='keyword'>int</span>) (z-&gt;zout_end - z-&gt;zout_start);</td></tr>
<tr class="codeline" data-linenumber="3953"><td class="num" id="LN3953">3953</td><td class="line">   <span class='keyword'>while</span> (cur + n &gt; limit)</td></tr>
<tr class="codeline" data-linenumber="3954"><td class="num" id="LN3954">3954</td><td class="line">      limit *= 2;</td></tr>
<tr class="codeline" data-linenumber="3955"><td class="num" id="LN3955">3955</td><td class="line">   q = (<span class='keyword'>char</span> *) <span class='macro'>STBI_REALLOC_SIZED(z-&gt;zout_start, old_limit, limit)<span class='macro_popup'>realloc(z-&gt;zout_start,limit)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3956"><td class="num" id="LN3956">3956</td><td class="line">   <span class='macro'>STBI_NOTUSED(old_limit)<span class='macro_popup'>(void)sizeof(old_limit)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3957"><td class="num" id="LN3957">3957</td><td class="line">   <span class='keyword'>if</span> (q == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>stbi__err("outofmem")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3958"><td class="num" id="LN3958">3958</td><td class="line">   z-&gt;zout_start = q;</td></tr>
<tr class="codeline" data-linenumber="3959"><td class="num" id="LN3959">3959</td><td class="line">   z-&gt;zout       = q + cur;</td></tr>
<tr class="codeline" data-linenumber="3960"><td class="num" id="LN3960">3960</td><td class="line">   z-&gt;zout_end   = q + limit;</td></tr>
<tr class="codeline" data-linenumber="3961"><td class="num" id="LN3961">3961</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3962"><td class="num" id="LN3962">3962</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3963"><td class="num" id="LN3963">3963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3964"><td class="num" id="LN3964">3964</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> stbi__zlength_base[31] = {</td></tr>
<tr class="codeline" data-linenumber="3965"><td class="num" id="LN3965">3965</td><td class="line">   3,4,5,6,7,8,9,10,11,13,</td></tr>
<tr class="codeline" data-linenumber="3966"><td class="num" id="LN3966">3966</td><td class="line">   15,17,19,23,27,31,35,43,51,59,</td></tr>
<tr class="codeline" data-linenumber="3967"><td class="num" id="LN3967">3967</td><td class="line">   67,83,99,115,131,163,195,227,258,0,0 };</td></tr>
<tr class="codeline" data-linenumber="3968"><td class="num" id="LN3968">3968</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3969"><td class="num" id="LN3969">3969</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> stbi__zlength_extra[31]=</td></tr>
<tr class="codeline" data-linenumber="3970"><td class="num" id="LN3970">3970</td><td class="line">{ 0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0 };</td></tr>
<tr class="codeline" data-linenumber="3971"><td class="num" id="LN3971">3971</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3972"><td class="num" id="LN3972">3972</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> stbi__zdist_base[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,</td></tr>
<tr class="codeline" data-linenumber="3973"><td class="num" id="LN3973">3973</td><td class="line">257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0};</td></tr>
<tr class="codeline" data-linenumber="3974"><td class="num" id="LN3974">3974</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3975"><td class="num" id="LN3975">3975</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> stbi__zdist_extra[32] =</td></tr>
<tr class="codeline" data-linenumber="3976"><td class="num" id="LN3976">3976</td><td class="line">{ 0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13};</td></tr>
<tr class="codeline" data-linenumber="3977"><td class="num" id="LN3977">3977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3978"><td class="num" id="LN3978">3978</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__parse_huffman_block(stbi__zbuf *a)</td></tr>
<tr class="codeline" data-linenumber="3979"><td class="num" id="LN3979">3979</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3980"><td class="num" id="LN3980">3980</td><td class="line">   <span class='keyword'>char</span> *zout = a-&gt;zout;</td></tr>
<tr class="codeline" data-linenumber="3981"><td class="num" id="LN3981">3981</td><td class="line">   <span class='keyword'>for</span>(;;) {</td></tr>
<tr class="codeline" data-linenumber="3982"><td class="num" id="LN3982">3982</td><td class="line">      <span class='keyword'>int</span> z = stbi__zhuffman_decode(a, &amp;a-&gt;z_length);</td></tr>
<tr class="codeline" data-linenumber="3983"><td class="num" id="LN3983">3983</td><td class="line">      <span class='keyword'>if</span> (z &lt; 256) {</td></tr>
<tr class="codeline" data-linenumber="3984"><td class="num" id="LN3984">3984</td><td class="line">         <span class='keyword'>if</span> (z &lt; 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>; <span class='comment'>// error in huffman codes</span></td></tr>
<tr class="codeline" data-linenumber="3985"><td class="num" id="LN3985">3985</td><td class="line">         <span class='keyword'>if</span> (zout &gt;= a-&gt;zout_end) {</td></tr>
<tr class="codeline" data-linenumber="3986"><td class="num" id="LN3986">3986</td><td class="line">            <span class='keyword'>if</span> (!stbi__zexpand(a, zout, 1)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3987"><td class="num" id="LN3987">3987</td><td class="line">            zout = a-&gt;zout;</td></tr>
<tr class="codeline" data-linenumber="3988"><td class="num" id="LN3988">3988</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="3989"><td class="num" id="LN3989">3989</td><td class="line">         *zout++ = (<span class='keyword'>char</span>) z;</td></tr>
<tr class="codeline" data-linenumber="3990"><td class="num" id="LN3990">3990</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3991"><td class="num" id="LN3991">3991</td><td class="line">         stbi_uc *p;</td></tr>
<tr class="codeline" data-linenumber="3992"><td class="num" id="LN3992">3992</td><td class="line">         <span class='keyword'>int</span> len,dist;</td></tr>
<tr class="codeline" data-linenumber="3993"><td class="num" id="LN3993">3993</td><td class="line">         <span class='keyword'>if</span> (z == 256) {</td></tr>
<tr class="codeline" data-linenumber="3994"><td class="num" id="LN3994">3994</td><td class="line">            a-&gt;zout = zout;</td></tr>
<tr class="codeline" data-linenumber="3995"><td class="num" id="LN3995">3995</td><td class="line">            <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="3996"><td class="num" id="LN3996">3996</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="3997"><td class="num" id="LN3997">3997</td><td class="line">         z -= 257;</td></tr>
<tr class="codeline" data-linenumber="3998"><td class="num" id="LN3998">3998</td><td class="line">         len = stbi__zlength_base[z];</td></tr>
<tr class="codeline" data-linenumber="3999"><td class="num" id="LN3999">3999</td><td class="line">         <span class='keyword'>if</span> (stbi__zlength_extra[z]) len += stbi__zreceive(a, stbi__zlength_extra[z]);</td></tr>
<tr class="codeline" data-linenumber="4000"><td class="num" id="LN4000">4000</td><td class="line">         z = stbi__zhuffman_decode(a, &amp;a-&gt;z_distance);</td></tr>
<tr class="codeline" data-linenumber="4001"><td class="num" id="LN4001">4001</td><td class="line">         <span class='keyword'>if</span> (z &lt; 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad huffman code"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad huffman code")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4002"><td class="num" id="LN4002">4002</td><td class="line">         dist = stbi__zdist_base[z];</td></tr>
<tr class="codeline" data-linenumber="4003"><td class="num" id="LN4003">4003</td><td class="line">         <span class='keyword'>if</span> (stbi__zdist_extra[z]) dist += stbi__zreceive(a, stbi__zdist_extra[z]);</td></tr>
<tr class="codeline" data-linenumber="4004"><td class="num" id="LN4004">4004</td><td class="line">         <span class='keyword'>if</span> (zout - a-&gt;zout_start &lt; dist) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad dist"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad dist")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4005"><td class="num" id="LN4005">4005</td><td class="line">         <span class='keyword'>if</span> (zout + len &gt; a-&gt;zout_end) {</td></tr>
<tr class="codeline" data-linenumber="4006"><td class="num" id="LN4006">4006</td><td class="line">            <span class='keyword'>if</span> (!stbi__zexpand(a, zout, len)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4007"><td class="num" id="LN4007">4007</td><td class="line">            zout = a-&gt;zout;</td></tr>
<tr class="codeline" data-linenumber="4008"><td class="num" id="LN4008">4008</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4009"><td class="num" id="LN4009">4009</td><td class="line">         p = (stbi_uc *) (zout - dist);</td></tr>
<tr class="codeline" data-linenumber="4010"><td class="num" id="LN4010">4010</td><td class="line">         <span class='keyword'>if</span> (dist == 1) { <span class='comment'>// run of one byte; common in images.</span></td></tr>
<tr class="codeline" data-linenumber="4011"><td class="num" id="LN4011">4011</td><td class="line">            stbi_uc v = *p;</td></tr>
<tr class="codeline" data-linenumber="4012"><td class="num" id="LN4012">4012</td><td class="line">            <span class='keyword'>if</span> (len) { <span class='keyword'>do</span> *zout++ = v; <span class='keyword'>while</span> (--len); }</td></tr>
<tr class="codeline" data-linenumber="4013"><td class="num" id="LN4013">4013</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4014"><td class="num" id="LN4014">4014</td><td class="line">            <span class='keyword'>if</span> (len) { <span class='keyword'>do</span> *zout++ = *p++; <span class='keyword'>while</span> (--len); }</td></tr>
<tr class="codeline" data-linenumber="4015"><td class="num" id="LN4015">4015</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4016"><td class="num" id="LN4016">4016</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4017"><td class="num" id="LN4017">4017</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4018"><td class="num" id="LN4018">4018</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4019"><td class="num" id="LN4019">4019</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4020"><td class="num" id="LN4020">4020</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__compute_huffman_codes(stbi__zbuf *a)</td></tr>
<tr class="codeline" data-linenumber="4021"><td class="num" id="LN4021">4021</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4022"><td class="num" id="LN4022">4022</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> stbi_uc length_dezigzag[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };</td></tr>
<tr class="codeline" data-linenumber="4023"><td class="num" id="LN4023">4023</td><td class="line">   stbi__zhuffman z_codelength;</td></tr>
<tr class="codeline" data-linenumber="4024"><td class="num" id="LN4024">4024</td><td class="line">   stbi_uc lencodes[286+32+137];<span class='comment'>//padding for maximum single op</span></td></tr>
<tr class="codeline" data-linenumber="4025"><td class="num" id="LN4025">4025</td><td class="line">   stbi_uc codelength_sizes[19];</td></tr>
<tr class="codeline" data-linenumber="4026"><td class="num" id="LN4026">4026</td><td class="line">   <span class='keyword'>int</span> i,n;</td></tr>
<tr class="codeline" data-linenumber="4027"><td class="num" id="LN4027">4027</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4028"><td class="num" id="LN4028">4028</td><td class="line">   <span class='keyword'>int</span> hlit  = stbi__zreceive(a,5) + 257;</td></tr>
<tr class="codeline" data-linenumber="4029"><td class="num" id="LN4029">4029</td><td class="line">   <span class='keyword'>int</span> hdist = stbi__zreceive(a,5) + 1;</td></tr>
<tr class="codeline" data-linenumber="4030"><td class="num" id="LN4030">4030</td><td class="line">   <span class='keyword'>int</span> hclen = stbi__zreceive(a,4) + 4;</td></tr>
<tr class="codeline" data-linenumber="4031"><td class="num" id="LN4031">4031</td><td class="line">   <span class='keyword'>int</span> ntot  = hlit + hdist;</td></tr>
<tr class="codeline" data-linenumber="4032"><td class="num" id="LN4032">4032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4033"><td class="num" id="LN4033">4033</td><td class="line">   memset(codelength_sizes, 0, <span class='keyword'>sizeof</span>(codelength_sizes));</td></tr>
<tr class="codeline" data-linenumber="4034"><td class="num" id="LN4034">4034</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; hclen; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4035"><td class="num" id="LN4035">4035</td><td class="line">      <span class='keyword'>int</span> s = stbi__zreceive(a,3);</td></tr>
<tr class="codeline" data-linenumber="4036"><td class="num" id="LN4036">4036</td><td class="line">      codelength_sizes[length_dezigzag[i]] = (stbi_uc) s;</td></tr>
<tr class="codeline" data-linenumber="4037"><td class="num" id="LN4037">4037</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4038"><td class="num" id="LN4038">4038</td><td class="line">   <span class='keyword'>if</span> (!stbi__zbuild_huffman(&amp;z_codelength, codelength_sizes, 19)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4039"><td class="num" id="LN4039">4039</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4040"><td class="num" id="LN4040">4040</td><td class="line">   n = 0;</td></tr>
<tr class="codeline" data-linenumber="4041"><td class="num" id="LN4041">4041</td><td class="line">   <span class='keyword'>while</span> (n &lt; ntot) {</td></tr>
<tr class="codeline" data-linenumber="4042"><td class="num" id="LN4042">4042</td><td class="line">      <span class='keyword'>int</span> c = stbi__zhuffman_decode(a, &amp;z_codelength);</td></tr>
<tr class="codeline" data-linenumber="4043"><td class="num" id="LN4043">4043</td><td class="line">      <span class='keyword'>if</span> (c &lt; 0 || c &gt;= 19) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad codelengths"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad codelengths")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4044"><td class="num" id="LN4044">4044</td><td class="line">      <span class='keyword'>if</span> (c &lt; 16)</td></tr>
<tr class="codeline" data-linenumber="4045"><td class="num" id="LN4045">4045</td><td class="line">         lencodes[n++] = (stbi_uc) c;</td></tr>
<tr class="codeline" data-linenumber="4046"><td class="num" id="LN4046">4046</td><td class="line">      <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4047"><td class="num" id="LN4047">4047</td><td class="line">         stbi_uc fill = 0;</td></tr>
<tr class="codeline" data-linenumber="4048"><td class="num" id="LN4048">4048</td><td class="line">         <span class='keyword'>if</span> (c == 16) {</td></tr>
<tr class="codeline" data-linenumber="4049"><td class="num" id="LN4049">4049</td><td class="line">            c = stbi__zreceive(a,2)+3;</td></tr>
<tr class="codeline" data-linenumber="4050"><td class="num" id="LN4050">4050</td><td class="line">            <span class='keyword'>if</span> (n == 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad codelengths"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad codelengths")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4051"><td class="num" id="LN4051">4051</td><td class="line">            fill = lencodes[n-1];</td></tr>
<tr class="codeline" data-linenumber="4052"><td class="num" id="LN4052">4052</td><td class="line">         } <span class='keyword'>else</span> <span class='keyword'>if</span> (c == 17)</td></tr>
<tr class="codeline" data-linenumber="4053"><td class="num" id="LN4053">4053</td><td class="line">            c = stbi__zreceive(a,3)+3;</td></tr>
<tr class="codeline" data-linenumber="4054"><td class="num" id="LN4054">4054</td><td class="line">         <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4055"><td class="num" id="LN4055">4055</td><td class="line">            <span class='macro'>STBI_ASSERT(c == 18)<span class='macro_popup'>((void) sizeof ((c == 18) ? 1 : 0), __extension__ ({ if (c ==<br> 18) ; else __assert_fail ("c == 18", "src/stb_image.h", 4055<br>, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4056"><td class="num" id="LN4056">4056</td><td class="line">            c = stbi__zreceive(a,7)+11;</td></tr>
<tr class="codeline" data-linenumber="4057"><td class="num" id="LN4057">4057</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4058"><td class="num" id="LN4058">4058</td><td class="line">         <span class='keyword'>if</span> (ntot - n &lt; c) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad codelengths"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad codelengths")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4059"><td class="num" id="LN4059">4059</td><td class="line">         memset(lencodes+n, fill, c);</td></tr>
<tr class="codeline" data-linenumber="4060"><td class="num" id="LN4060">4060</td><td class="line">         n += c;</td></tr>
<tr class="codeline" data-linenumber="4061"><td class="num" id="LN4061">4061</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4062"><td class="num" id="LN4062">4062</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4063"><td class="num" id="LN4063">4063</td><td class="line">   <span class='keyword'>if</span> (n != ntot) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad codelengths"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad codelengths")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4064"><td class="num" id="LN4064">4064</td><td class="line">   <span class='keyword'>if</span> (!stbi__zbuild_huffman(&amp;a-&gt;z_length, lencodes, hlit)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4065"><td class="num" id="LN4065">4065</td><td class="line">   <span class='keyword'>if</span> (!stbi__zbuild_huffman(&amp;a-&gt;z_distance, lencodes+hlit, hdist)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4066"><td class="num" id="LN4066">4066</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4067"><td class="num" id="LN4067">4067</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4068"><td class="num" id="LN4068">4068</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4069"><td class="num" id="LN4069">4069</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__parse_uncompressed_block(stbi__zbuf *a)</td></tr>
<tr class="codeline" data-linenumber="4070"><td class="num" id="LN4070">4070</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4071"><td class="num" id="LN4071">4071</td><td class="line">   stbi_uc header[4];</td></tr>
<tr class="codeline" data-linenumber="4072"><td class="num" id="LN4072">4072</td><td class="line">   <span class='keyword'>int</span> len,nlen,k;</td></tr>
<tr class="codeline" data-linenumber="4073"><td class="num" id="LN4073">4073</td><td class="line">   <span class='keyword'>if</span> (a-&gt;num_bits &amp; 7)</td></tr>
<tr class="codeline" data-linenumber="4074"><td class="num" id="LN4074">4074</td><td class="line">      stbi__zreceive(a, a-&gt;num_bits &amp; 7); <span class='comment'>// discard</span></td></tr>
<tr class="codeline" data-linenumber="4075"><td class="num" id="LN4075">4075</td><td class="line">   <span class='comment'>// drain the bit-packed data into header</span></td></tr>
<tr class="codeline" data-linenumber="4076"><td class="num" id="LN4076">4076</td><td class="line">   k = 0;</td></tr>
<tr class="codeline" data-linenumber="4077"><td class="num" id="LN4077">4077</td><td class="line">   <span class='keyword'>while</span> (a-&gt;num_bits &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="4078"><td class="num" id="LN4078">4078</td><td class="line">      header[k++] = (stbi_uc) (a-&gt;code_buffer &amp; 255); <span class='comment'>// suppress MSVC run-time check</span></td></tr>
<tr class="codeline" data-linenumber="4079"><td class="num" id="LN4079">4079</td><td class="line">      a-&gt;code_buffer &gt;&gt;= 8;</td></tr>
<tr class="codeline" data-linenumber="4080"><td class="num" id="LN4080">4080</td><td class="line">      a-&gt;num_bits -= 8;</td></tr>
<tr class="codeline" data-linenumber="4081"><td class="num" id="LN4081">4081</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4082"><td class="num" id="LN4082">4082</td><td class="line">   <span class='macro'>STBI_ASSERT(a-&gt;num_bits == 0)<span class='macro_popup'>((void) sizeof ((a-&gt;num_bits == 0) ? 1 : 0), __extension__<br> ({ if (a-&gt;num_bits == 0) ; else __assert_fail ("a-&gt;num_bits == 0"<br>, "src/stb_image.h", 4082, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4083"><td class="num" id="LN4083">4083</td><td class="line">   <span class='comment'>// now fill header the normal way</span></td></tr>
<tr class="codeline" data-linenumber="4084"><td class="num" id="LN4084">4084</td><td class="line">   <span class='keyword'>while</span> (k &lt; 4)</td></tr>
<tr class="codeline" data-linenumber="4085"><td class="num" id="LN4085">4085</td><td class="line">      header[k++] = stbi__zget8(a);</td></tr>
<tr class="codeline" data-linenumber="4086"><td class="num" id="LN4086">4086</td><td class="line">   len  = header[1] * 256 + header[0];</td></tr>
<tr class="codeline" data-linenumber="4087"><td class="num" id="LN4087">4087</td><td class="line">   nlen = header[3] * 256 + header[2];</td></tr>
<tr class="codeline" data-linenumber="4088"><td class="num" id="LN4088">4088</td><td class="line">   <span class='keyword'>if</span> (nlen != (len ^ 0xffff)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"zlib corrupt"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("zlib corrupt")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4089"><td class="num" id="LN4089">4089</td><td class="line">   <span class='keyword'>if</span> (a-&gt;zbuffer + len &gt; a-&gt;zbuffer_end) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"read past buffer"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("read past buffer")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4090"><td class="num" id="LN4090">4090</td><td class="line">   <span class='keyword'>if</span> (a-&gt;zout + len &gt; a-&gt;zout_end)</td></tr>
<tr class="codeline" data-linenumber="4091"><td class="num" id="LN4091">4091</td><td class="line">      <span class='keyword'>if</span> (!stbi__zexpand(a, a-&gt;zout, len)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4092"><td class="num" id="LN4092">4092</td><td class="line">   memcpy(a-&gt;zout, a-&gt;zbuffer, len);</td></tr>
<tr class="codeline" data-linenumber="4093"><td class="num" id="LN4093">4093</td><td class="line">   a-&gt;zbuffer += len;</td></tr>
<tr class="codeline" data-linenumber="4094"><td class="num" id="LN4094">4094</td><td class="line">   a-&gt;zout += len;</td></tr>
<tr class="codeline" data-linenumber="4095"><td class="num" id="LN4095">4095</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4096"><td class="num" id="LN4096">4096</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4097"><td class="num" id="LN4097">4097</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4098"><td class="num" id="LN4098">4098</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__parse_zlib_header(stbi__zbuf *a)</td></tr>
<tr class="codeline" data-linenumber="4099"><td class="num" id="LN4099">4099</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4100"><td class="num" id="LN4100">4100</td><td class="line">   <span class='keyword'>int</span> cmf   = stbi__zget8(a);</td></tr>
<tr class="codeline" data-linenumber="4101"><td class="num" id="LN4101">4101</td><td class="line">   <span class='keyword'>int</span> cm    = cmf &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="4102"><td class="num" id="LN4102">4102</td><td class="line">   <span class='comment'>/* int cinfo = cmf &gt;&gt; 4; */</span></td></tr>
<tr class="codeline" data-linenumber="4103"><td class="num" id="LN4103">4103</td><td class="line">   <span class='keyword'>int</span> flg   = stbi__zget8(a);</td></tr>
<tr class="codeline" data-linenumber="4104"><td class="num" id="LN4104">4104</td><td class="line">   <span class='keyword'>if</span> ((cmf*256+flg) % 31 != 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad zlib header"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad zlib header")</span></span>; <span class='comment'>// zlib spec</span></td></tr>
<tr class="codeline" data-linenumber="4105"><td class="num" id="LN4105">4105</td><td class="line">   <span class='keyword'>if</span> (flg &amp; 32) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"no preset dict"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("no preset dict")</span></span>; <span class='comment'>// preset dictionary not allowed in png</span></td></tr>
<tr class="codeline" data-linenumber="4106"><td class="num" id="LN4106">4106</td><td class="line">   <span class='keyword'>if</span> (cm != 8) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad compression"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad compression")</span></span>; <span class='comment'>// DEFLATE required for png</span></td></tr>
<tr class="codeline" data-linenumber="4107"><td class="num" id="LN4107">4107</td><td class="line">   <span class='comment'>// window = 1 &lt;&lt; (8 + cinfo)... but who cares, we fully buffer output</span></td></tr>
<tr class="codeline" data-linenumber="4108"><td class="num" id="LN4108">4108</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4109"><td class="num" id="LN4109">4109</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4110"><td class="num" id="LN4110">4110</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4111"><td class="num" id="LN4111">4111</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> stbi_uc stbi__zdefault_length[288] =</td></tr>
<tr class="codeline" data-linenumber="4112"><td class="num" id="LN4112">4112</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4113"><td class="num" id="LN4113">4113</td><td class="line">   8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8, 8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,</td></tr>
<tr class="codeline" data-linenumber="4114"><td class="num" id="LN4114">4114</td><td class="line">   8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8, 8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,</td></tr>
<tr class="codeline" data-linenumber="4115"><td class="num" id="LN4115">4115</td><td class="line">   8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8, 8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,</td></tr>
<tr class="codeline" data-linenumber="4116"><td class="num" id="LN4116">4116</td><td class="line">   8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8, 8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,</td></tr>
<tr class="codeline" data-linenumber="4117"><td class="num" id="LN4117">4117</td><td class="line">   8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8, 9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,</td></tr>
<tr class="codeline" data-linenumber="4118"><td class="num" id="LN4118">4118</td><td class="line">   9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9, 9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,</td></tr>
<tr class="codeline" data-linenumber="4119"><td class="num" id="LN4119">4119</td><td class="line">   9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9, 9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,</td></tr>
<tr class="codeline" data-linenumber="4120"><td class="num" id="LN4120">4120</td><td class="line">   9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9, 9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,</td></tr>
<tr class="codeline" data-linenumber="4121"><td class="num" id="LN4121">4121</td><td class="line">   7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7, 7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8</td></tr>
<tr class="codeline" data-linenumber="4122"><td class="num" id="LN4122">4122</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="4123"><td class="num" id="LN4123">4123</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> stbi_uc stbi__zdefault_distance[32] =</td></tr>
<tr class="codeline" data-linenumber="4124"><td class="num" id="LN4124">4124</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4125"><td class="num" id="LN4125">4125</td><td class="line">   5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5</td></tr>
<tr class="codeline" data-linenumber="4126"><td class="num" id="LN4126">4126</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="4127"><td class="num" id="LN4127">4127</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4128"><td class="num" id="LN4128">4128</td><td class="line"><span class='comment'>Init algorithm:</span></td></tr>
<tr class="codeline" data-linenumber="4129"><td class="num" id="LN4129">4129</td><td class="line"><span class='comment'>{</span></td></tr>
<tr class="codeline" data-linenumber="4130"><td class="num" id="LN4130">4130</td><td class="line">   <span class='comment'>int i;   // use &lt;= to match clearly with spec</span></td></tr>
<tr class="codeline" data-linenumber="4131"><td class="num" id="LN4131">4131</td><td class="line">   <span class='comment'>for (i=0; i &lt;= 143; ++i)     stbi__zdefault_length[i]   = 8;</span></td></tr>
<tr class="codeline" data-linenumber="4132"><td class="num" id="LN4132">4132</td><td class="line">   <span class='comment'>for (   ; i &lt;= 255; ++i)     stbi__zdefault_length[i]   = 9;</span></td></tr>
<tr class="codeline" data-linenumber="4133"><td class="num" id="LN4133">4133</td><td class="line">   <span class='comment'>for (   ; i &lt;= 279; ++i)     stbi__zdefault_length[i]   = 7;</span></td></tr>
<tr class="codeline" data-linenumber="4134"><td class="num" id="LN4134">4134</td><td class="line">   <span class='comment'>for (   ; i &lt;= 287; ++i)     stbi__zdefault_length[i]   = 8;</span></td></tr>
<tr class="codeline" data-linenumber="4135"><td class="num" id="LN4135">4135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4136"><td class="num" id="LN4136">4136</td><td class="line">   <span class='comment'>for (i=0; i &lt;=  31; ++i)     stbi__zdefault_distance[i] = 5;</span></td></tr>
<tr class="codeline" data-linenumber="4137"><td class="num" id="LN4137">4137</td><td class="line"><span class='comment'>}</span></td></tr>
<tr class="codeline" data-linenumber="4138"><td class="num" id="LN4138">4138</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4139"><td class="num" id="LN4139">4139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4140"><td class="num" id="LN4140">4140</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__parse_zlib(stbi__zbuf *a, <span class='keyword'>int</span> parse_header)</td></tr>
<tr class="codeline" data-linenumber="4141"><td class="num" id="LN4141">4141</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4142"><td class="num" id="LN4142">4142</td><td class="line">   <span class='keyword'>int</span> final, type;</td></tr>
<tr class="codeline" data-linenumber="4143"><td class="num" id="LN4143">4143</td><td class="line">   <span class='keyword'>if</span> (parse_header)</td></tr>
<tr class="codeline" data-linenumber="4144"><td class="num" id="LN4144">4144</td><td class="line">      <span class='keyword'>if</span> (!stbi__parse_zlib_header(a)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4145"><td class="num" id="LN4145">4145</td><td class="line">   a-&gt;num_bits = 0;</td></tr>
<tr class="codeline" data-linenumber="4146"><td class="num" id="LN4146">4146</td><td class="line">   a-&gt;code_buffer = 0;</td></tr>
<tr class="codeline" data-linenumber="4147"><td class="num" id="LN4147">4147</td><td class="line">   <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="4148"><td class="num" id="LN4148">4148</td><td class="line">      final = stbi__zreceive(a,1);</td></tr>
<tr class="codeline" data-linenumber="4149"><td class="num" id="LN4149">4149</td><td class="line">      type = stbi__zreceive(a,2);</td></tr>
<tr class="codeline" data-linenumber="4150"><td class="num" id="LN4150">4150</td><td class="line">      <span class='keyword'>if</span> (type == 0) {</td></tr>
<tr class="codeline" data-linenumber="4151"><td class="num" id="LN4151">4151</td><td class="line">         <span class='keyword'>if</span> (!stbi__parse_uncompressed_block(a)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4152"><td class="num" id="LN4152">4152</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (type == 3) {</td></tr>
<tr class="codeline" data-linenumber="4153"><td class="num" id="LN4153">4153</td><td class="line">         <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4154"><td class="num" id="LN4154">4154</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4155"><td class="num" id="LN4155">4155</td><td class="line">         <span class='keyword'>if</span> (type == 1) {</td></tr>
<tr class="codeline" data-linenumber="4156"><td class="num" id="LN4156">4156</td><td class="line">            <span class='comment'>// use fixed code lengths</span></td></tr>
<tr class="codeline" data-linenumber="4157"><td class="num" id="LN4157">4157</td><td class="line">            <span class='keyword'>if</span> (!stbi__zbuild_huffman(&amp;a-&gt;z_length  , stbi__zdefault_length  , 288)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4158"><td class="num" id="LN4158">4158</td><td class="line">            <span class='keyword'>if</span> (!stbi__zbuild_huffman(&amp;a-&gt;z_distance, stbi__zdefault_distance,  32)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4159"><td class="num" id="LN4159">4159</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4160"><td class="num" id="LN4160">4160</td><td class="line">            <span class='keyword'>if</span> (!stbi__compute_huffman_codes(a)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4161"><td class="num" id="LN4161">4161</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4162"><td class="num" id="LN4162">4162</td><td class="line">         <span class='keyword'>if</span> (!stbi__parse_huffman_block(a)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4163"><td class="num" id="LN4163">4163</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4164"><td class="num" id="LN4164">4164</td><td class="line">   } <span class='keyword'>while</span> (!final);</td></tr>
<tr class="codeline" data-linenumber="4165"><td class="num" id="LN4165">4165</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4166"><td class="num" id="LN4166">4166</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4167"><td class="num" id="LN4167">4167</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4168"><td class="num" id="LN4168">4168</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__do_zlib(stbi__zbuf *a, <span class='keyword'>char</span> *obuf, <span class='keyword'>int</span> olen, <span class='keyword'>int</span> exp, <span class='keyword'>int</span> parse_header)</td></tr>
<tr class="codeline" data-linenumber="4169"><td class="num" id="LN4169">4169</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4170"><td class="num" id="LN4170">4170</td><td class="line">   a-&gt;zout_start = obuf;</td></tr>
<tr class="codeline" data-linenumber="4171"><td class="num" id="LN4171">4171</td><td class="line">   a-&gt;zout       = obuf;</td></tr>
<tr class="codeline" data-linenumber="4172"><td class="num" id="LN4172">4172</td><td class="line">   a-&gt;zout_end   = obuf + olen;</td></tr>
<tr class="codeline" data-linenumber="4173"><td class="num" id="LN4173">4173</td><td class="line">   a-&gt;z_expandable = exp;</td></tr>
<tr class="codeline" data-linenumber="4174"><td class="num" id="LN4174">4174</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4175"><td class="num" id="LN4175">4175</td><td class="line">   <span class='keyword'>return</span> stbi__parse_zlib(a, parse_header);</td></tr>
<tr class="codeline" data-linenumber="4176"><td class="num" id="LN4176">4176</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4177"><td class="num" id="LN4177">4177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4178"><td class="num" id="LN4178">4178</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_malloc_guesssize(<span class='keyword'>const</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> initial_size, <span class='keyword'>int</span> *outlen)</td></tr>
<tr class="codeline" data-linenumber="4179"><td class="num" id="LN4179">4179</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4180"><td class="num" id="LN4180">4180</td><td class="line">   stbi__zbuf a;</td></tr>
<tr class="codeline" data-linenumber="4181"><td class="num" id="LN4181">4181</td><td class="line">   <span class='keyword'>char</span> *p = (<span class='keyword'>char</span> *) stbi__malloc(initial_size);</td></tr>
<tr class="codeline" data-linenumber="4182"><td class="num" id="LN4182">4182</td><td class="line">   <span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4183"><td class="num" id="LN4183">4183</td><td class="line">   a.zbuffer = (stbi_uc *) buffer;</td></tr>
<tr class="codeline" data-linenumber="4184"><td class="num" id="LN4184">4184</td><td class="line">   a.zbuffer_end = (stbi_uc *) buffer + len;</td></tr>
<tr class="codeline" data-linenumber="4185"><td class="num" id="LN4185">4185</td><td class="line">   <span class='keyword'>if</span> (stbi__do_zlib(&amp;a, p, initial_size, 1, 1)) {</td></tr>
<tr class="codeline" data-linenumber="4186"><td class="num" id="LN4186">4186</td><td class="line">      <span class='keyword'>if</span> (outlen) *outlen = (<span class='keyword'>int</span>) (a.zout - a.zout_start);</td></tr>
<tr class="codeline" data-linenumber="4187"><td class="num" id="LN4187">4187</td><td class="line">      <span class='keyword'>return</span> a.zout_start;</td></tr>
<tr class="codeline" data-linenumber="4188"><td class="num" id="LN4188">4188</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4189"><td class="num" id="LN4189">4189</td><td class="line">      <span class='macro'>STBI_FREE(a.zout_start)<span class='macro_popup'>free(a.zout_start)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4190"><td class="num" id="LN4190">4190</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4191"><td class="num" id="LN4191">4191</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4192"><td class="num" id="LN4192">4192</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4193"><td class="num" id="LN4193">4193</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4194"><td class="num" id="LN4194">4194</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_malloc(<span class='keyword'>char</span> <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *outlen)</td></tr>
<tr class="codeline" data-linenumber="4195"><td class="num" id="LN4195">4195</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4196"><td class="num" id="LN4196">4196</td><td class="line">   <span class='keyword'>return</span> stbi_zlib_decode_malloc_guesssize(buffer, len, 16384, outlen);</td></tr>
<tr class="codeline" data-linenumber="4197"><td class="num" id="LN4197">4197</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4198"><td class="num" id="LN4198">4198</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4199"><td class="num" id="LN4199">4199</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_malloc_guesssize_headerflag(<span class='keyword'>const</span> <span class='keyword'>char</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> initial_size, <span class='keyword'>int</span> *outlen, <span class='keyword'>int</span> parse_header)</td></tr>
<tr class="codeline" data-linenumber="4200"><td class="num" id="LN4200">4200</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4201"><td class="num" id="LN4201">4201</td><td class="line">   stbi__zbuf a;</td></tr>
<tr class="codeline" data-linenumber="4202"><td class="num" id="LN4202">4202</td><td class="line">   <span class='keyword'>char</span> *p = (<span class='keyword'>char</span> *) stbi__malloc(initial_size);</td></tr>
<tr class="codeline" data-linenumber="4203"><td class="num" id="LN4203">4203</td><td class="line">   <span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4204"><td class="num" id="LN4204">4204</td><td class="line">   a.zbuffer = (stbi_uc *) buffer;</td></tr>
<tr class="codeline" data-linenumber="4205"><td class="num" id="LN4205">4205</td><td class="line">   a.zbuffer_end = (stbi_uc *) buffer + len;</td></tr>
<tr class="codeline" data-linenumber="4206"><td class="num" id="LN4206">4206</td><td class="line">   <span class='keyword'>if</span> (stbi__do_zlib(&amp;a, p, initial_size, 1, parse_header)) {</td></tr>
<tr class="codeline" data-linenumber="4207"><td class="num" id="LN4207">4207</td><td class="line">      <span class='keyword'>if</span> (outlen) *outlen = (<span class='keyword'>int</span>) (a.zout - a.zout_start);</td></tr>
<tr class="codeline" data-linenumber="4208"><td class="num" id="LN4208">4208</td><td class="line">      <span class='keyword'>return</span> a.zout_start;</td></tr>
<tr class="codeline" data-linenumber="4209"><td class="num" id="LN4209">4209</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4210"><td class="num" id="LN4210">4210</td><td class="line">      <span class='macro'>STBI_FREE(a.zout_start)<span class='macro_popup'>free(a.zout_start)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4211"><td class="num" id="LN4211">4211</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4212"><td class="num" id="LN4212">4212</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4213"><td class="num" id="LN4213">4213</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4214"><td class="num" id="LN4214">4214</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4215"><td class="num" id="LN4215">4215</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_zlib_decode_buffer(<span class='keyword'>char</span> *obuffer, <span class='keyword'>int</span> olen, <span class='keyword'>char</span> <span class='keyword'>const</span> *ibuffer, <span class='keyword'>int</span> ilen)</td></tr>
<tr class="codeline" data-linenumber="4216"><td class="num" id="LN4216">4216</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4217"><td class="num" id="LN4217">4217</td><td class="line">   stbi__zbuf a;</td></tr>
<tr class="codeline" data-linenumber="4218"><td class="num" id="LN4218">4218</td><td class="line">   a.zbuffer = (stbi_uc *) ibuffer;</td></tr>
<tr class="codeline" data-linenumber="4219"><td class="num" id="LN4219">4219</td><td class="line">   a.zbuffer_end = (stbi_uc *) ibuffer + ilen;</td></tr>
<tr class="codeline" data-linenumber="4220"><td class="num" id="LN4220">4220</td><td class="line">   <span class='keyword'>if</span> (stbi__do_zlib(&amp;a, obuffer, olen, 0, 1))</td></tr>
<tr class="codeline" data-linenumber="4221"><td class="num" id="LN4221">4221</td><td class="line">      <span class='keyword'>return</span> (<span class='keyword'>int</span>) (a.zout - a.zout_start);</td></tr>
<tr class="codeline" data-linenumber="4222"><td class="num" id="LN4222">4222</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4223"><td class="num" id="LN4223">4223</td><td class="line">      <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="4224"><td class="num" id="LN4224">4224</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4225"><td class="num" id="LN4225">4225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4226"><td class="num" id="LN4226">4226</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>char</span> *stbi_zlib_decode_noheader_malloc(<span class='keyword'>char</span> <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *outlen)</td></tr>
<tr class="codeline" data-linenumber="4227"><td class="num" id="LN4227">4227</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4228"><td class="num" id="LN4228">4228</td><td class="line">   stbi__zbuf a;</td></tr>
<tr class="codeline" data-linenumber="4229"><td class="num" id="LN4229">4229</td><td class="line">   <span class='keyword'>char</span> *p = (<span class='keyword'>char</span> *) stbi__malloc(16384);</td></tr>
<tr class="codeline" data-linenumber="4230"><td class="num" id="LN4230">4230</td><td class="line">   <span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4231"><td class="num" id="LN4231">4231</td><td class="line">   a.zbuffer = (stbi_uc *) buffer;</td></tr>
<tr class="codeline" data-linenumber="4232"><td class="num" id="LN4232">4232</td><td class="line">   a.zbuffer_end = (stbi_uc *) buffer+len;</td></tr>
<tr class="codeline" data-linenumber="4233"><td class="num" id="LN4233">4233</td><td class="line">   <span class='keyword'>if</span> (stbi__do_zlib(&amp;a, p, 16384, 1, 0)) {</td></tr>
<tr class="codeline" data-linenumber="4234"><td class="num" id="LN4234">4234</td><td class="line">      <span class='keyword'>if</span> (outlen) *outlen = (<span class='keyword'>int</span>) (a.zout - a.zout_start);</td></tr>
<tr class="codeline" data-linenumber="4235"><td class="num" id="LN4235">4235</td><td class="line">      <span class='keyword'>return</span> a.zout_start;</td></tr>
<tr class="codeline" data-linenumber="4236"><td class="num" id="LN4236">4236</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4237"><td class="num" id="LN4237">4237</td><td class="line">      <span class='macro'>STBI_FREE(a.zout_start)<span class='macro_popup'>free(a.zout_start)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4238"><td class="num" id="LN4238">4238</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4239"><td class="num" id="LN4239">4239</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4240"><td class="num" id="LN4240">4240</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4241"><td class="num" id="LN4241">4241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4242"><td class="num" id="LN4242">4242</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_zlib_decode_noheader_buffer(<span class='keyword'>char</span> *obuffer, <span class='keyword'>int</span> olen, <span class='keyword'>const</span> <span class='keyword'>char</span> *ibuffer, <span class='keyword'>int</span> ilen)</td></tr>
<tr class="codeline" data-linenumber="4243"><td class="num" id="LN4243">4243</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4244"><td class="num" id="LN4244">4244</td><td class="line">   stbi__zbuf a;</td></tr>
<tr class="codeline" data-linenumber="4245"><td class="num" id="LN4245">4245</td><td class="line">   a.zbuffer = (stbi_uc *) ibuffer;</td></tr>
<tr class="codeline" data-linenumber="4246"><td class="num" id="LN4246">4246</td><td class="line">   a.zbuffer_end = (stbi_uc *) ibuffer + ilen;</td></tr>
<tr class="codeline" data-linenumber="4247"><td class="num" id="LN4247">4247</td><td class="line">   <span class='keyword'>if</span> (stbi__do_zlib(&amp;a, obuffer, olen, 0, 0))</td></tr>
<tr class="codeline" data-linenumber="4248"><td class="num" id="LN4248">4248</td><td class="line">      <span class='keyword'>return</span> (<span class='keyword'>int</span>) (a.zout - a.zout_start);</td></tr>
<tr class="codeline" data-linenumber="4249"><td class="num" id="LN4249">4249</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4250"><td class="num" id="LN4250">4250</td><td class="line">      <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="4251"><td class="num" id="LN4251">4251</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4252"><td class="num" id="LN4252">4252</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4253"><td class="num" id="LN4253">4253</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4254"><td class="num" id="LN4254">4254</td><td class="line"><span class='comment'>// public domain "baseline" PNG decoder   v0.10  Sean Barrett 2006-11-18</span></td></tr>
<tr class="codeline" data-linenumber="4255"><td class="num" id="LN4255">4255</td><td class="line"><span class='comment'>//    simple implementation</span></td></tr>
<tr class="codeline" data-linenumber="4256"><td class="num" id="LN4256">4256</td><td class="line"><span class='comment'>//      - only 8-bit samples</span></td></tr>
<tr class="codeline" data-linenumber="4257"><td class="num" id="LN4257">4257</td><td class="line"><span class='comment'>//      - no CRC checking</span></td></tr>
<tr class="codeline" data-linenumber="4258"><td class="num" id="LN4258">4258</td><td class="line"><span class='comment'>//      - allocates lots of intermediate memory</span></td></tr>
<tr class="codeline" data-linenumber="4259"><td class="num" id="LN4259">4259</td><td class="line"><span class='comment'>//        - avoids problem of streaming data between subsystems</span></td></tr>
<tr class="codeline" data-linenumber="4260"><td class="num" id="LN4260">4260</td><td class="line"><span class='comment'>//        - avoids explicit window management</span></td></tr>
<tr class="codeline" data-linenumber="4261"><td class="num" id="LN4261">4261</td><td class="line"><span class='comment'>//    performance</span></td></tr>
<tr class="codeline" data-linenumber="4262"><td class="num" id="LN4262">4262</td><td class="line"><span class='comment'>//      - uses stb_zlib, a PD zlib implementation with fast huffman decoding</span></td></tr>
<tr class="codeline" data-linenumber="4263"><td class="num" id="LN4263">4263</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4264"><td class="num" id="LN4264">4264</td><td class="line"><span class='directive'>#ifndef STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="4265"><td class="num" id="LN4265">4265</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="4266"><td class="num" id="LN4266">4266</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4267"><td class="num" id="LN4267">4267</td><td class="line">   stbi__uint32 length;</td></tr>
<tr class="codeline" data-linenumber="4268"><td class="num" id="LN4268">4268</td><td class="line">   stbi__uint32 type;</td></tr>
<tr class="codeline" data-linenumber="4269"><td class="num" id="LN4269">4269</td><td class="line">} stbi__pngchunk;</td></tr>
<tr class="codeline" data-linenumber="4270"><td class="num" id="LN4270">4270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4271"><td class="num" id="LN4271">4271</td><td class="line"><span class='keyword'>static</span> stbi__pngchunk stbi__get_chunk_header(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="4272"><td class="num" id="LN4272">4272</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4273"><td class="num" id="LN4273">4273</td><td class="line">   stbi__pngchunk c;</td></tr>
<tr class="codeline" data-linenumber="4274"><td class="num" id="LN4274">4274</td><td class="line">   c.length = stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="4275"><td class="num" id="LN4275">4275</td><td class="line">   c.type   = stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="4276"><td class="num" id="LN4276">4276</td><td class="line">   <span class='keyword'>return</span> c;</td></tr>
<tr class="codeline" data-linenumber="4277"><td class="num" id="LN4277">4277</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4278"><td class="num" id="LN4278">4278</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4279"><td class="num" id="LN4279">4279</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__check_png_header(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="4280"><td class="num" id="LN4280">4280</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4281"><td class="num" id="LN4281">4281</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>const</span> stbi_uc png_sig[8] = { 137,80,78,71,13,10,26,10 };</td></tr>
<tr class="codeline" data-linenumber="4282"><td class="num" id="LN4282">4282</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="4283"><td class="num" id="LN4283">4283</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; 8; ++i)</td></tr>
<tr class="codeline" data-linenumber="4284"><td class="num" id="LN4284">4284</td><td class="line">      <span class='keyword'>if</span> (stbi__get8(s) != png_sig[i]) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad png sig"</span>,<span class='string_literal'>"Not a PNG"</span>)<span class='macro_popup'>stbi__err("bad png sig")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4285"><td class="num" id="LN4285">4285</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4286"><td class="num" id="LN4286">4286</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4287"><td class="num" id="LN4287">4287</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4288"><td class="num" id="LN4288">4288</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="4289"><td class="num" id="LN4289">4289</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4290"><td class="num" id="LN4290">4290</td><td class="line">   stbi__context *s;</td></tr>
<tr class="codeline" data-linenumber="4291"><td class="num" id="LN4291">4291</td><td class="line">   stbi_uc *idata, *expanded, *out;</td></tr>
<tr class="codeline" data-linenumber="4292"><td class="num" id="LN4292">4292</td><td class="line">   <span class='keyword'>int</span> depth;</td></tr>
<tr class="codeline" data-linenumber="4293"><td class="num" id="LN4293">4293</td><td class="line">} stbi__png;</td></tr>
<tr class="codeline" data-linenumber="4294"><td class="num" id="LN4294">4294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4295"><td class="num" id="LN4295">4295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4296"><td class="num" id="LN4296">4296</td><td class="line"><span class='keyword'>enum</span> {</td></tr>
<tr class="codeline" data-linenumber="4297"><td class="num" id="LN4297">4297</td><td class="line">   STBI__F_none=0,</td></tr>
<tr class="codeline" data-linenumber="4298"><td class="num" id="LN4298">4298</td><td class="line">   STBI__F_sub=1,</td></tr>
<tr class="codeline" data-linenumber="4299"><td class="num" id="LN4299">4299</td><td class="line">   STBI__F_up=2,</td></tr>
<tr class="codeline" data-linenumber="4300"><td class="num" id="LN4300">4300</td><td class="line">   STBI__F_avg=3,</td></tr>
<tr class="codeline" data-linenumber="4301"><td class="num" id="LN4301">4301</td><td class="line">   STBI__F_paeth=4,</td></tr>
<tr class="codeline" data-linenumber="4302"><td class="num" id="LN4302">4302</td><td class="line">   <span class='comment'>// synthetic filters used for first scanline to avoid needing a dummy row of 0s</span></td></tr>
<tr class="codeline" data-linenumber="4303"><td class="num" id="LN4303">4303</td><td class="line">   STBI__F_avg_first,</td></tr>
<tr class="codeline" data-linenumber="4304"><td class="num" id="LN4304">4304</td><td class="line">   STBI__F_paeth_first</td></tr>
<tr class="codeline" data-linenumber="4305"><td class="num" id="LN4305">4305</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="4306"><td class="num" id="LN4306">4306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4307"><td class="num" id="LN4307">4307</td><td class="line"><span class='keyword'>static</span> stbi_uc first_row_filter[5] =</td></tr>
<tr class="codeline" data-linenumber="4308"><td class="num" id="LN4308">4308</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4309"><td class="num" id="LN4309">4309</td><td class="line">   STBI__F_none,</td></tr>
<tr class="codeline" data-linenumber="4310"><td class="num" id="LN4310">4310</td><td class="line">   STBI__F_sub,</td></tr>
<tr class="codeline" data-linenumber="4311"><td class="num" id="LN4311">4311</td><td class="line">   STBI__F_none,</td></tr>
<tr class="codeline" data-linenumber="4312"><td class="num" id="LN4312">4312</td><td class="line">   STBI__F_avg_first,</td></tr>
<tr class="codeline" data-linenumber="4313"><td class="num" id="LN4313">4313</td><td class="line">   STBI__F_paeth_first</td></tr>
<tr class="codeline" data-linenumber="4314"><td class="num" id="LN4314">4314</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="4315"><td class="num" id="LN4315">4315</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4316"><td class="num" id="LN4316">4316</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__paeth(<span class='keyword'>int</span> a, <span class='keyword'>int</span> b, <span class='keyword'>int</span> c)</td></tr>
<tr class="codeline" data-linenumber="4317"><td class="num" id="LN4317">4317</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4318"><td class="num" id="LN4318">4318</td><td class="line">   <span class='keyword'>int</span> p = a + b - c;</td></tr>
<tr class="codeline" data-linenumber="4319"><td class="num" id="LN4319">4319</td><td class="line">   <span class='keyword'>int</span> pa = abs(p-a);</td></tr>
<tr class="codeline" data-linenumber="4320"><td class="num" id="LN4320">4320</td><td class="line">   <span class='keyword'>int</span> pb = abs(p-b);</td></tr>
<tr class="codeline" data-linenumber="4321"><td class="num" id="LN4321">4321</td><td class="line">   <span class='keyword'>int</span> pc = abs(p-c);</td></tr>
<tr class="codeline" data-linenumber="4322"><td class="num" id="LN4322">4322</td><td class="line">   <span class='keyword'>if</span> (pa &lt;= pb &amp;&amp; pa &lt;= pc) <span class='keyword'>return</span> a;</td></tr>
<tr class="codeline" data-linenumber="4323"><td class="num" id="LN4323">4323</td><td class="line">   <span class='keyword'>if</span> (pb &lt;= pc) <span class='keyword'>return</span> b;</td></tr>
<tr class="codeline" data-linenumber="4324"><td class="num" id="LN4324">4324</td><td class="line">   <span class='keyword'>return</span> c;</td></tr>
<tr class="codeline" data-linenumber="4325"><td class="num" id="LN4325">4325</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4326"><td class="num" id="LN4326">4326</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4327"><td class="num" id="LN4327">4327</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> stbi_uc stbi__depth_scale_table[9] = { 0, 0xff, 0x55, 0, 0x11, 0,0,0, 0x01 };</td></tr>
<tr class="codeline" data-linenumber="4328"><td class="num" id="LN4328">4328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4329"><td class="num" id="LN4329">4329</td><td class="line"><span class='comment'>// create the png data from post-deflated data</span></td></tr>
<tr class="codeline" data-linenumber="4330"><td class="num" id="LN4330">4330</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__create_png_image_raw(stbi__png *a, stbi_uc *raw, stbi__uint32 raw_len, <span class='keyword'>int</span> out_n, stbi__uint32 x, stbi__uint32 y, <span class='keyword'>int</span> depth, <span class='keyword'>int</span> color)</td></tr>
<tr class="codeline" data-linenumber="4331"><td class="num" id="LN4331">4331</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4332"><td class="num" id="LN4332">4332</td><td class="line">   <span class='keyword'>int</span> bytes = (depth == 16? 2 : 1);</td></tr>
<tr class="codeline" data-linenumber="4333"><td class="num" id="LN4333">4333</td><td class="line">   stbi__context *s = a-&gt;s;</td></tr>
<tr class="codeline" data-linenumber="4334"><td class="num" id="LN4334">4334</td><td class="line">   stbi__uint32 i,j,stride = x*out_n*bytes;</td></tr>
<tr class="codeline" data-linenumber="4335"><td class="num" id="LN4335">4335</td><td class="line">   stbi__uint32 img_len, img_width_bytes;</td></tr>
<tr class="codeline" data-linenumber="4336"><td class="num" id="LN4336">4336</td><td class="line">   <span class='keyword'>int</span> k;</td></tr>
<tr class="codeline" data-linenumber="4337"><td class="num" id="LN4337">4337</td><td class="line">   <span class='keyword'>int</span> img_n = s-&gt;img_n; <span class='comment'>// copy it into a local for later</span></td></tr>
<tr class="codeline" data-linenumber="4338"><td class="num" id="LN4338">4338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4339"><td class="num" id="LN4339">4339</td><td class="line">   <span class='keyword'>int</span> output_bytes = out_n*bytes;</td></tr>
<tr class="codeline" data-linenumber="4340"><td class="num" id="LN4340">4340</td><td class="line">   <span class='keyword'>int</span> filter_bytes = img_n*bytes;</td></tr>
<tr class="codeline" data-linenumber="4341"><td class="num" id="LN4341">4341</td><td class="line">   <span class='keyword'>int</span> width = x;</td></tr>
<tr class="codeline" data-linenumber="4342"><td class="num" id="LN4342">4342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4343"><td class="num" id="LN4343">4343</td><td class="line">   <span class='macro'>STBI_ASSERT(out_n == s-&gt;img_n || out_n == s-&gt;img_n+1)<span class='macro_popup'>((void) sizeof ((out_n == s-&gt;img_n || out_n == s-&gt;img_n<br>+1) ? 1 : 0), __extension__ ({ if (out_n == s-&gt;img_n || out_n<br> == s-&gt;img_n+1) ; else __assert_fail ("out_n == s-&gt;img_n || out_n == s-&gt;img_n+1"<br>, "src/stb_image.h", 4343, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4344"><td class="num" id="LN4344">4344</td><td class="line">   a-&gt;out = (stbi_uc *) stbi__malloc_mad3(x, y, output_bytes, 0); <span class='comment'>// extra bytes to write off the end into</span></td></tr>
<tr class="codeline" data-linenumber="4345"><td class="num" id="LN4345">4345</td><td class="line">   <span class='keyword'>if</span> (!a-&gt;out) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>stbi__err("outofmem")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4346"><td class="num" id="LN4346">4346</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4347"><td class="num" id="LN4347">4347</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(img_n, x, depth, 7)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("too large")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4348"><td class="num" id="LN4348">4348</td><td class="line">   img_width_bytes = (((img_n * x * depth) + 7) &gt;&gt; 3);</td></tr>
<tr class="codeline" data-linenumber="4349"><td class="num" id="LN4349">4349</td><td class="line">   img_len = (img_width_bytes + 1) * y;</td></tr>
<tr class="codeline" data-linenumber="4350"><td class="num" id="LN4350">4350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4351"><td class="num" id="LN4351">4351</td><td class="line">   <span class='comment'>// we used to check for exact match between raw_len and img_len on non-interlaced PNGs,</span></td></tr>
<tr class="codeline" data-linenumber="4352"><td class="num" id="LN4352">4352</td><td class="line">   <span class='comment'>// but issue #276 reported a PNG in the wild that had extra data at the end (all zeros),</span></td></tr>
<tr class="codeline" data-linenumber="4353"><td class="num" id="LN4353">4353</td><td class="line">   <span class='comment'>// so just check for raw_len &lt; img_len always.</span></td></tr>
<tr class="codeline" data-linenumber="4354"><td class="num" id="LN4354">4354</td><td class="line">   <span class='keyword'>if</span> (raw_len &lt; img_len) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"not enough pixels"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("not enough pixels")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4355"><td class="num" id="LN4355">4355</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4356"><td class="num" id="LN4356">4356</td><td class="line">   <span class='keyword'>for</span> (j=0; j &lt; y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="4357"><td class="num" id="LN4357">4357</td><td class="line">      stbi_uc *cur = a-&gt;out + stride*j;</td></tr>
<tr class="codeline" data-linenumber="4358"><td class="num" id="LN4358">4358</td><td class="line">      stbi_uc *prior;</td></tr>
<tr class="codeline" data-linenumber="4359"><td class="num" id="LN4359">4359</td><td class="line">      <span class='keyword'>int</span> filter = *raw++;</td></tr>
<tr class="codeline" data-linenumber="4360"><td class="num" id="LN4360">4360</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4361"><td class="num" id="LN4361">4361</td><td class="line">      <span class='keyword'>if</span> (filter &gt; 4)</td></tr>
<tr class="codeline" data-linenumber="4362"><td class="num" id="LN4362">4362</td><td class="line">         <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"invalid filter"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("invalid filter")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4363"><td class="num" id="LN4363">4363</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4364"><td class="num" id="LN4364">4364</td><td class="line">      <span class='keyword'>if</span> (depth &lt; 8) {</td></tr>
<tr class="codeline" data-linenumber="4365"><td class="num" id="LN4365">4365</td><td class="line">         <span class='macro'>STBI_ASSERT(img_width_bytes &lt;= x)<span class='macro_popup'>((void) sizeof ((img_width_bytes &lt;= x) ? 1 : 0), __extension__<br> ({ if (img_width_bytes &lt;= x) ; else __assert_fail ("img_width_bytes &lt;= x"<br>, "src/stb_image.h", 4365, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4366"><td class="num" id="LN4366">4366</td><td class="line">         cur += x*out_n - img_width_bytes; <span class='comment'>// store output to the rightmost img_len bytes, so we can decode in place</span></td></tr>
<tr class="codeline" data-linenumber="4367"><td class="num" id="LN4367">4367</td><td class="line">         filter_bytes = 1;</td></tr>
<tr class="codeline" data-linenumber="4368"><td class="num" id="LN4368">4368</td><td class="line">         width = img_width_bytes;</td></tr>
<tr class="codeline" data-linenumber="4369"><td class="num" id="LN4369">4369</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4370"><td class="num" id="LN4370">4370</td><td class="line">      prior = cur - stride; <span class='comment'>// bugfix: need to compute this after 'cur +=' computation above</span></td></tr>
<tr class="codeline" data-linenumber="4371"><td class="num" id="LN4371">4371</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4372"><td class="num" id="LN4372">4372</td><td class="line">      <span class='comment'>// if first row, use special filter that doesn't sample previous row</span></td></tr>
<tr class="codeline" data-linenumber="4373"><td class="num" id="LN4373">4373</td><td class="line">      <span class='keyword'>if</span> (j == 0) filter = first_row_filter[filter];</td></tr>
<tr class="codeline" data-linenumber="4374"><td class="num" id="LN4374">4374</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4375"><td class="num" id="LN4375">4375</td><td class="line">      <span class='comment'>// handle first byte explicitly</span></td></tr>
<tr class="codeline" data-linenumber="4376"><td class="num" id="LN4376">4376</td><td class="line">      <span class='keyword'>for</span> (k=0; k &lt; filter_bytes; ++k) {</td></tr>
<tr class="codeline" data-linenumber="4377"><td class="num" id="LN4377">4377</td><td class="line">         <span class='keyword'>switch</span> (filter) {</td></tr>
<tr class="codeline" data-linenumber="4378"><td class="num" id="LN4378">4378</td><td class="line">            <span class='keyword'>case</span> STBI__F_none       : cur[k] = raw[k]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4379"><td class="num" id="LN4379">4379</td><td class="line">            <span class='keyword'>case</span> STBI__F_sub        : cur[k] = raw[k]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4380"><td class="num" id="LN4380">4380</td><td class="line">            <span class='keyword'>case</span> STBI__F_up         : cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + prior[k])<span class='macro_popup'>((stbi_uc) ((raw[k] + prior[k]) &amp; 255))</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4381"><td class="num" id="LN4381">4381</td><td class="line">            <span class='keyword'>case</span> STBI__F_avg        : cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + (prior[k]&gt;&gt;1))<span class='macro_popup'>((stbi_uc) ((raw[k] + (prior[k]&gt;&gt;1)) &amp; 255))</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4382"><td class="num" id="LN4382">4382</td><td class="line">            <span class='keyword'>case</span> STBI__F_paeth      : cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + stbi__paeth(0,prior[k],0))<span class='macro_popup'>((stbi_uc) ((raw[k] + stbi__paeth(0,prior[k],0)) &amp; 255))</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4383"><td class="num" id="LN4383">4383</td><td class="line">            <span class='keyword'>case</span> STBI__F_avg_first  : cur[k] = raw[k]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4384"><td class="num" id="LN4384">4384</td><td class="line">            <span class='keyword'>case</span> STBI__F_paeth_first: cur[k] = raw[k]; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4385"><td class="num" id="LN4385">4385</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4386"><td class="num" id="LN4386">4386</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4387"><td class="num" id="LN4387">4387</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4388"><td class="num" id="LN4388">4388</td><td class="line">      <span class='keyword'>if</span> (depth == 8) {</td></tr>
<tr class="codeline" data-linenumber="4389"><td class="num" id="LN4389">4389</td><td class="line">         <span class='keyword'>if</span> (img_n != out_n)</td></tr>
<tr class="codeline" data-linenumber="4390"><td class="num" id="LN4390">4390</td><td class="line">            cur[img_n] = 255; <span class='comment'>// first pixel</span></td></tr>
<tr class="codeline" data-linenumber="4391"><td class="num" id="LN4391">4391</td><td class="line">         raw += img_n;</td></tr>
<tr class="codeline" data-linenumber="4392"><td class="num" id="LN4392">4392</td><td class="line">         cur += out_n;</td></tr>
<tr class="codeline" data-linenumber="4393"><td class="num" id="LN4393">4393</td><td class="line">         prior += out_n;</td></tr>
<tr class="codeline" data-linenumber="4394"><td class="num" id="LN4394">4394</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (depth == 16) {</td></tr>
<tr class="codeline" data-linenumber="4395"><td class="num" id="LN4395">4395</td><td class="line">         <span class='keyword'>if</span> (img_n != out_n) {</td></tr>
<tr class="codeline" data-linenumber="4396"><td class="num" id="LN4396">4396</td><td class="line">            cur[filter_bytes]   = 255; <span class='comment'>// first pixel top byte</span></td></tr>
<tr class="codeline" data-linenumber="4397"><td class="num" id="LN4397">4397</td><td class="line">            cur[filter_bytes+1] = 255; <span class='comment'>// first pixel bottom byte</span></td></tr>
<tr class="codeline" data-linenumber="4398"><td class="num" id="LN4398">4398</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4399"><td class="num" id="LN4399">4399</td><td class="line">         raw += filter_bytes;</td></tr>
<tr class="codeline" data-linenumber="4400"><td class="num" id="LN4400">4400</td><td class="line">         cur += output_bytes;</td></tr>
<tr class="codeline" data-linenumber="4401"><td class="num" id="LN4401">4401</td><td class="line">         prior += output_bytes;</td></tr>
<tr class="codeline" data-linenumber="4402"><td class="num" id="LN4402">4402</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4403"><td class="num" id="LN4403">4403</td><td class="line">         raw += 1;</td></tr>
<tr class="codeline" data-linenumber="4404"><td class="num" id="LN4404">4404</td><td class="line">         cur += 1;</td></tr>
<tr class="codeline" data-linenumber="4405"><td class="num" id="LN4405">4405</td><td class="line">         prior += 1;</td></tr>
<tr class="codeline" data-linenumber="4406"><td class="num" id="LN4406">4406</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4407"><td class="num" id="LN4407">4407</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4408"><td class="num" id="LN4408">4408</td><td class="line">      <span class='comment'>// this is a little gross, so that we don't switch per-pixel or per-component</span></td></tr>
<tr class="codeline" data-linenumber="4409"><td class="num" id="LN4409">4409</td><td class="line">      <span class='keyword'>if</span> (depth &lt; 8 || img_n == out_n) {</td></tr>
<tr class="codeline" data-linenumber="4410"><td class="num" id="LN4410">4410</td><td class="line">         <span class='keyword'>int</span> nk = (width - 1)*filter_bytes;</td></tr>
<tr class="codeline" data-linenumber="4411"><td class="num" id="LN4411">4411</td><td class="line">         <span class='directive'>#define STBI__CASE(f) \</span></td></tr>
<tr class="codeline" data-linenumber="4412"><td class="num" id="LN4412">4412</td><td class="line">             <span class='directive'>case f:     \</span></td></tr>
<tr class="codeline" data-linenumber="4413"><td class="num" id="LN4413">4413</td><td class="line">                <span class='directive'>for (k=0; k &lt; nk; ++k)</span></td></tr>
<tr class="codeline" data-linenumber="4414"><td class="num" id="LN4414">4414</td><td class="line">         <span class='keyword'>switch</span> (filter) {</td></tr>
<tr class="codeline" data-linenumber="4415"><td class="num" id="LN4415">4415</td><td class="line">            <span class='comment'>// "none" filter turns into a memcpy here; make that explicit.</span></td></tr>
<tr class="codeline" data-linenumber="4416"><td class="num" id="LN4416">4416</td><td class="line">            <span class='keyword'>case</span> STBI__F_none:         memcpy(cur, raw, nk); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4417"><td class="num" id="LN4417">4417</td><td class="line">            STBI__CASE(STBI__F_sub)          { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + cur[k-filter_bytes])<span class='macro_popup'>((stbi_uc) ((raw[k] + cur[k-filter_bytes]) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4418"><td class="num" id="LN4418">4418</td><td class="line">            STBI__CASE(STBI__F_up)           { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + prior[k])<span class='macro_popup'>((stbi_uc) ((raw[k] + prior[k]) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4419"><td class="num" id="LN4419">4419</td><td class="line">            STBI__CASE(STBI__F_avg)          { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + ((prior[k] + cur[k-filter_bytes])&gt;&gt;1))<span class='macro_popup'>((stbi_uc) ((raw[k] + ((prior[k] + cur[k-filter_bytes])&gt;&gt;<br>1)) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4420"><td class="num" id="LN4420">4420</td><td class="line">            STBI__CASE(STBI__F_paeth)        { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + stbi__paeth(cur[k-filter_bytes],prior[k],prior[k-filter_bytes]))<span class='macro_popup'>((stbi_uc) ((raw[k] + stbi__paeth(cur[k-filter_bytes],prior[k<br>],prior[k-filter_bytes])) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4421"><td class="num" id="LN4421">4421</td><td class="line">            STBI__CASE(STBI__F_avg_first)    { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + (cur[k-filter_bytes] &gt;&gt; 1))<span class='macro_popup'>((stbi_uc) ((raw[k] + (cur[k-filter_bytes] &gt;&gt; 1)) &amp;<br> 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4422"><td class="num" id="LN4422">4422</td><td class="line">            STBI__CASE(STBI__F_paeth_first)  { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + stbi__paeth(cur[k-filter_bytes],0,0))<span class='macro_popup'>((stbi_uc) ((raw[k] + stbi__paeth(cur[k-filter_bytes],0,0)) &amp;<br> 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4423"><td class="num" id="LN4423">4423</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4424"><td class="num" id="LN4424">4424</td><td class="line">         <span class='directive'>#undef STBI__CASE</span></td></tr>
<tr class="codeline" data-linenumber="4425"><td class="num" id="LN4425">4425</td><td class="line">         raw += nk;</td></tr>
<tr class="codeline" data-linenumber="4426"><td class="num" id="LN4426">4426</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4427"><td class="num" id="LN4427">4427</td><td class="line">         <span class='macro'>STBI_ASSERT(img_n+1 == out_n)<span class='macro_popup'>((void) sizeof ((img_n+1 == out_n) ? 1 : 0), __extension__ ({<br> if (img_n+1 == out_n) ; else __assert_fail ("img_n+1 == out_n"<br>, "src/stb_image.h", 4427, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4428"><td class="num" id="LN4428">4428</td><td class="line">         <span class='directive'>#define STBI__CASE(f) \</span></td></tr>
<tr class="codeline" data-linenumber="4429"><td class="num" id="LN4429">4429</td><td class="line">             <span class='directive'>case f:     \</span></td></tr>
<tr class="codeline" data-linenumber="4430"><td class="num" id="LN4430">4430</td><td class="line">                <span class='directive'>for (i=x-1; i &gt;= 1; --i, cur[filter_bytes]=255,raw+=filter_bytes,cur+=output_bytes,prior+=output_bytes) \</span></td></tr>
<tr class="codeline" data-linenumber="4431"><td class="num" id="LN4431">4431</td><td class="line">                   <span class='directive'>for (k=0; k &lt; filter_bytes; ++k)</span></td></tr>
<tr class="codeline" data-linenumber="4432"><td class="num" id="LN4432">4432</td><td class="line">         <span class='keyword'>switch</span> (filter) {</td></tr>
<tr class="codeline" data-linenumber="4433"><td class="num" id="LN4433">4433</td><td class="line">            STBI__CASE(STBI__F_none)         { cur[k] = raw[k]; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4434"><td class="num" id="LN4434">4434</td><td class="line">            STBI__CASE(STBI__F_sub)          { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + cur[k- output_bytes])<span class='macro_popup'>((stbi_uc) ((raw[k] + cur[k- output_bytes]) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4435"><td class="num" id="LN4435">4435</td><td class="line">            STBI__CASE(STBI__F_up)           { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + prior[k])<span class='macro_popup'>((stbi_uc) ((raw[k] + prior[k]) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4436"><td class="num" id="LN4436">4436</td><td class="line">            STBI__CASE(STBI__F_avg)          { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + ((prior[k] + cur[k- output_bytes])&gt;&gt;1))<span class='macro_popup'>((stbi_uc) ((raw[k] + ((prior[k] + cur[k- output_bytes])&gt;&gt;<br>1)) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4437"><td class="num" id="LN4437">4437</td><td class="line">            STBI__CASE(STBI__F_paeth)        { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + stbi__paeth(cur[k- output_bytes],prior[k],prior[k- output_bytes]))<span class='macro_popup'>((stbi_uc) ((raw[k] + stbi__paeth(cur[k- output_bytes],prior[<br>k],prior[k- output_bytes])) &amp; 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4438"><td class="num" id="LN4438">4438</td><td class="line">            STBI__CASE(STBI__F_avg_first)    { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + (cur[k- output_bytes] &gt;&gt; 1))<span class='macro_popup'>((stbi_uc) ((raw[k] + (cur[k- output_bytes] &gt;&gt; 1)) &amp;<br> 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4439"><td class="num" id="LN4439">4439</td><td class="line">            STBI__CASE(STBI__F_paeth_first)  { cur[k] = <span class='macro'>STBI__BYTECAST(raw[k] + stbi__paeth(cur[k- output_bytes],0,0))<span class='macro_popup'>((stbi_uc) ((raw[k] + stbi__paeth(cur[k- output_bytes],0,0)) &amp;<br> 255))</span></span>; } <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4440"><td class="num" id="LN4440">4440</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4441"><td class="num" id="LN4441">4441</td><td class="line">         <span class='directive'>#undef STBI__CASE</span></td></tr>
<tr class="codeline" data-linenumber="4442"><td class="num" id="LN4442">4442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4443"><td class="num" id="LN4443">4443</td><td class="line">         <span class='comment'>// the loop above sets the high byte of the pixels' alpha, but for</span></td></tr>
<tr class="codeline" data-linenumber="4444"><td class="num" id="LN4444">4444</td><td class="line">         <span class='comment'>// 16 bit png files we also need the low byte set. we'll do that here.</span></td></tr>
<tr class="codeline" data-linenumber="4445"><td class="num" id="LN4445">4445</td><td class="line">         <span class='keyword'>if</span> (depth == 16) {</td></tr>
<tr class="codeline" data-linenumber="4446"><td class="num" id="LN4446">4446</td><td class="line">            cur = a-&gt;out + stride*j; <span class='comment'>// start at the beginning of the row again</span></td></tr>
<tr class="codeline" data-linenumber="4447"><td class="num" id="LN4447">4447</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; x; ++i,cur+=output_bytes) {</td></tr>
<tr class="codeline" data-linenumber="4448"><td class="num" id="LN4448">4448</td><td class="line">               cur[filter_bytes+1] = 255;</td></tr>
<tr class="codeline" data-linenumber="4449"><td class="num" id="LN4449">4449</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4450"><td class="num" id="LN4450">4450</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4451"><td class="num" id="LN4451">4451</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4452"><td class="num" id="LN4452">4452</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4453"><td class="num" id="LN4453">4453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4454"><td class="num" id="LN4454">4454</td><td class="line">   <span class='comment'>// we make a separate pass to expand bits to pixels; for performance,</span></td></tr>
<tr class="codeline" data-linenumber="4455"><td class="num" id="LN4455">4455</td><td class="line">   <span class='comment'>// this could run two scanlines behind the above code, so it won't</span></td></tr>
<tr class="codeline" data-linenumber="4456"><td class="num" id="LN4456">4456</td><td class="line">   <span class='comment'>// intefere with filtering but will still be in the cache.</span></td></tr>
<tr class="codeline" data-linenumber="4457"><td class="num" id="LN4457">4457</td><td class="line">   <span class='keyword'>if</span> (depth &lt; 8) {</td></tr>
<tr class="codeline" data-linenumber="4458"><td class="num" id="LN4458">4458</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="4459"><td class="num" id="LN4459">4459</td><td class="line">         stbi_uc *cur = a-&gt;out + stride*j;</td></tr>
<tr class="codeline" data-linenumber="4460"><td class="num" id="LN4460">4460</td><td class="line">         stbi_uc *in  = a-&gt;out + stride*j + x*out_n - img_width_bytes;</td></tr>
<tr class="codeline" data-linenumber="4461"><td class="num" id="LN4461">4461</td><td class="line">         <span class='comment'>// unpack 1/2/4-bit into a 8-bit buffer. allows us to keep the common 8-bit path optimal at minimal cost for 1/2/4-bit</span></td></tr>
<tr class="codeline" data-linenumber="4462"><td class="num" id="LN4462">4462</td><td class="line">         <span class='comment'>// png guarante byte alignment, if width is not multiple of 8/4/2 we'll decode dummy trailing data that will be skipped in the later loop</span></td></tr>
<tr class="codeline" data-linenumber="4463"><td class="num" id="LN4463">4463</td><td class="line">         stbi_uc scale = (color == 0) ? stbi__depth_scale_table[depth] : 1; <span class='comment'>// scale grayscale values to 0..255 range</span></td></tr>
<tr class="codeline" data-linenumber="4464"><td class="num" id="LN4464">4464</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4465"><td class="num" id="LN4465">4465</td><td class="line">         <span class='comment'>// note that the final byte might overshoot and write more data than desired.</span></td></tr>
<tr class="codeline" data-linenumber="4466"><td class="num" id="LN4466">4466</td><td class="line">         <span class='comment'>// we can allocate enough data that this never writes out of memory, but it</span></td></tr>
<tr class="codeline" data-linenumber="4467"><td class="num" id="LN4467">4467</td><td class="line">         <span class='comment'>// could also overwrite the next scanline. can it overwrite non-empty data</span></td></tr>
<tr class="codeline" data-linenumber="4468"><td class="num" id="LN4468">4468</td><td class="line">         <span class='comment'>// on the next scanline? yes, consider 1-pixel-wide scanlines with 1-bit-per-pixel.</span></td></tr>
<tr class="codeline" data-linenumber="4469"><td class="num" id="LN4469">4469</td><td class="line">         <span class='comment'>// so we need to explicitly clamp the final ones</span></td></tr>
<tr class="codeline" data-linenumber="4470"><td class="num" id="LN4470">4470</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4471"><td class="num" id="LN4471">4471</td><td class="line">         <span class='keyword'>if</span> (depth == 4) {</td></tr>
<tr class="codeline" data-linenumber="4472"><td class="num" id="LN4472">4472</td><td class="line">            <span class='keyword'>for</span> (k=x*img_n; k &gt;= 2; k-=2, ++in) {</td></tr>
<tr class="codeline" data-linenumber="4473"><td class="num" id="LN4473">4473</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 4)       );</td></tr>
<tr class="codeline" data-linenumber="4474"><td class="num" id="LN4474">4474</td><td class="line">               *cur++ = scale * ((*in     ) &amp; 0x0f);</td></tr>
<tr class="codeline" data-linenumber="4475"><td class="num" id="LN4475">4475</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4476"><td class="num" id="LN4476">4476</td><td class="line">            <span class='keyword'>if</span> (k &gt; 0) *cur++ = scale * ((*in &gt;&gt; 4)       );</td></tr>
<tr class="codeline" data-linenumber="4477"><td class="num" id="LN4477">4477</td><td class="line">         } <span class='keyword'>else</span> <span class='keyword'>if</span> (depth == 2) {</td></tr>
<tr class="codeline" data-linenumber="4478"><td class="num" id="LN4478">4478</td><td class="line">            <span class='keyword'>for</span> (k=x*img_n; k &gt;= 4; k-=4, ++in) {</td></tr>
<tr class="codeline" data-linenumber="4479"><td class="num" id="LN4479">4479</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 6)       );</td></tr>
<tr class="codeline" data-linenumber="4480"><td class="num" id="LN4480">4480</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 4) &amp; 0x03);</td></tr>
<tr class="codeline" data-linenumber="4481"><td class="num" id="LN4481">4481</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 2) &amp; 0x03);</td></tr>
<tr class="codeline" data-linenumber="4482"><td class="num" id="LN4482">4482</td><td class="line">               *cur++ = scale * ((*in     ) &amp; 0x03);</td></tr>
<tr class="codeline" data-linenumber="4483"><td class="num" id="LN4483">4483</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4484"><td class="num" id="LN4484">4484</td><td class="line">            <span class='keyword'>if</span> (k &gt; 0) *cur++ = scale * ((*in &gt;&gt; 6)       );</td></tr>
<tr class="codeline" data-linenumber="4485"><td class="num" id="LN4485">4485</td><td class="line">            <span class='keyword'>if</span> (k &gt; 1) *cur++ = scale * ((*in &gt;&gt; 4) &amp; 0x03);</td></tr>
<tr class="codeline" data-linenumber="4486"><td class="num" id="LN4486">4486</td><td class="line">            <span class='keyword'>if</span> (k &gt; 2) *cur++ = scale * ((*in &gt;&gt; 2) &amp; 0x03);</td></tr>
<tr class="codeline" data-linenumber="4487"><td class="num" id="LN4487">4487</td><td class="line">         } <span class='keyword'>else</span> <span class='keyword'>if</span> (depth == 1) {</td></tr>
<tr class="codeline" data-linenumber="4488"><td class="num" id="LN4488">4488</td><td class="line">            <span class='keyword'>for</span> (k=x*img_n; k &gt;= 8; k-=8, ++in) {</td></tr>
<tr class="codeline" data-linenumber="4489"><td class="num" id="LN4489">4489</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 7)       );</td></tr>
<tr class="codeline" data-linenumber="4490"><td class="num" id="LN4490">4490</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 6) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4491"><td class="num" id="LN4491">4491</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 5) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4492"><td class="num" id="LN4492">4492</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 4) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4493"><td class="num" id="LN4493">4493</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 3) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4494"><td class="num" id="LN4494">4494</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 2) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4495"><td class="num" id="LN4495">4495</td><td class="line">               *cur++ = scale * ((*in &gt;&gt; 1) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4496"><td class="num" id="LN4496">4496</td><td class="line">               *cur++ = scale * ((*in     ) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4497"><td class="num" id="LN4497">4497</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4498"><td class="num" id="LN4498">4498</td><td class="line">            <span class='keyword'>if</span> (k &gt; 0) *cur++ = scale * ((*in &gt;&gt; 7)       );</td></tr>
<tr class="codeline" data-linenumber="4499"><td class="num" id="LN4499">4499</td><td class="line">            <span class='keyword'>if</span> (k &gt; 1) *cur++ = scale * ((*in &gt;&gt; 6) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4500"><td class="num" id="LN4500">4500</td><td class="line">            <span class='keyword'>if</span> (k &gt; 2) *cur++ = scale * ((*in &gt;&gt; 5) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4501"><td class="num" id="LN4501">4501</td><td class="line">            <span class='keyword'>if</span> (k &gt; 3) *cur++ = scale * ((*in &gt;&gt; 4) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4502"><td class="num" id="LN4502">4502</td><td class="line">            <span class='keyword'>if</span> (k &gt; 4) *cur++ = scale * ((*in &gt;&gt; 3) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4503"><td class="num" id="LN4503">4503</td><td class="line">            <span class='keyword'>if</span> (k &gt; 5) *cur++ = scale * ((*in &gt;&gt; 2) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4504"><td class="num" id="LN4504">4504</td><td class="line">            <span class='keyword'>if</span> (k &gt; 6) *cur++ = scale * ((*in &gt;&gt; 1) &amp; 0x01);</td></tr>
<tr class="codeline" data-linenumber="4505"><td class="num" id="LN4505">4505</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4506"><td class="num" id="LN4506">4506</td><td class="line">         <span class='keyword'>if</span> (img_n != out_n) {</td></tr>
<tr class="codeline" data-linenumber="4507"><td class="num" id="LN4507">4507</td><td class="line">            <span class='keyword'>int</span> q;</td></tr>
<tr class="codeline" data-linenumber="4508"><td class="num" id="LN4508">4508</td><td class="line">            <span class='comment'>// insert alpha = 255</span></td></tr>
<tr class="codeline" data-linenumber="4509"><td class="num" id="LN4509">4509</td><td class="line">            cur = a-&gt;out + stride*j;</td></tr>
<tr class="codeline" data-linenumber="4510"><td class="num" id="LN4510">4510</td><td class="line">            <span class='keyword'>if</span> (img_n == 1) {</td></tr>
<tr class="codeline" data-linenumber="4511"><td class="num" id="LN4511">4511</td><td class="line">               <span class='keyword'>for</span> (q=x-1; q &gt;= 0; --q) {</td></tr>
<tr class="codeline" data-linenumber="4512"><td class="num" id="LN4512">4512</td><td class="line">                  cur[q*2+1] = 255;</td></tr>
<tr class="codeline" data-linenumber="4513"><td class="num" id="LN4513">4513</td><td class="line">                  cur[q*2+0] = cur[q];</td></tr>
<tr class="codeline" data-linenumber="4514"><td class="num" id="LN4514">4514</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="4515"><td class="num" id="LN4515">4515</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4516"><td class="num" id="LN4516">4516</td><td class="line">               <span class='macro'>STBI_ASSERT(img_n == 3)<span class='macro_popup'>((void) sizeof ((img_n == 3) ? 1 : 0), __extension__ ({ if (img_n<br> == 3) ; else __assert_fail ("img_n == 3", "src/stb_image.h",<br> 4516, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4517"><td class="num" id="LN4517">4517</td><td class="line">               <span class='keyword'>for</span> (q=x-1; q &gt;= 0; --q) {</td></tr>
<tr class="codeline" data-linenumber="4518"><td class="num" id="LN4518">4518</td><td class="line">                  cur[q*4+3] = 255;</td></tr>
<tr class="codeline" data-linenumber="4519"><td class="num" id="LN4519">4519</td><td class="line">                  cur[q*4+2] = cur[q*3+2];</td></tr>
<tr class="codeline" data-linenumber="4520"><td class="num" id="LN4520">4520</td><td class="line">                  cur[q*4+1] = cur[q*3+1];</td></tr>
<tr class="codeline" data-linenumber="4521"><td class="num" id="LN4521">4521</td><td class="line">                  cur[q*4+0] = cur[q*3+0];</td></tr>
<tr class="codeline" data-linenumber="4522"><td class="num" id="LN4522">4522</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="4523"><td class="num" id="LN4523">4523</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4524"><td class="num" id="LN4524">4524</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4525"><td class="num" id="LN4525">4525</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4526"><td class="num" id="LN4526">4526</td><td class="line">   } <span class='keyword'>else</span> <span class='keyword'>if</span> (depth == 16) {</td></tr>
<tr class="codeline" data-linenumber="4527"><td class="num" id="LN4527">4527</td><td class="line">      <span class='comment'>// force the image data from big-endian to platform-native.</span></td></tr>
<tr class="codeline" data-linenumber="4528"><td class="num" id="LN4528">4528</td><td class="line">      <span class='comment'>// this is done in a separate pass due to the decoding relying</span></td></tr>
<tr class="codeline" data-linenumber="4529"><td class="num" id="LN4529">4529</td><td class="line">      <span class='comment'>// on the data being untouched, but could probably be done</span></td></tr>
<tr class="codeline" data-linenumber="4530"><td class="num" id="LN4530">4530</td><td class="line">      <span class='comment'>// per-line during decode if care is taken.</span></td></tr>
<tr class="codeline" data-linenumber="4531"><td class="num" id="LN4531">4531</td><td class="line">      stbi_uc *cur = a-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="4532"><td class="num" id="LN4532">4532</td><td class="line">      stbi__uint16 *cur16 = (stbi__uint16*)cur;</td></tr>
<tr class="codeline" data-linenumber="4533"><td class="num" id="LN4533">4533</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4534"><td class="num" id="LN4534">4534</td><td class="line">      <span class='keyword'>for</span>(i=0; i &lt; x*y*out_n; ++i,cur16++,cur+=2) {</td></tr>
<tr class="codeline" data-linenumber="4535"><td class="num" id="LN4535">4535</td><td class="line">         *cur16 = (cur[0] &lt;&lt; 8) | cur[1];</td></tr>
<tr class="codeline" data-linenumber="4536"><td class="num" id="LN4536">4536</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4537"><td class="num" id="LN4537">4537</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4538"><td class="num" id="LN4538">4538</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4539"><td class="num" id="LN4539">4539</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4540"><td class="num" id="LN4540">4540</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4541"><td class="num" id="LN4541">4541</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4542"><td class="num" id="LN4542">4542</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__create_png_image(stbi__png *a, stbi_uc *image_data, stbi__uint32 image_data_len, <span class='keyword'>int</span> out_n, <span class='keyword'>int</span> depth, <span class='keyword'>int</span> color, <span class='keyword'>int</span> interlaced)</td></tr>
<tr class="codeline" data-linenumber="4543"><td class="num" id="LN4543">4543</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4544"><td class="num" id="LN4544">4544</td><td class="line">   <span class='keyword'>int</span> bytes = (depth == 16 ? 2 : 1);</td></tr>
<tr class="codeline" data-linenumber="4545"><td class="num" id="LN4545">4545</td><td class="line">   <span class='keyword'>int</span> out_bytes = out_n * bytes;</td></tr>
<tr class="codeline" data-linenumber="4546"><td class="num" id="LN4546">4546</td><td class="line">   stbi_uc *final;</td></tr>
<tr class="codeline" data-linenumber="4547"><td class="num" id="LN4547">4547</td><td class="line">   <span class='keyword'>int</span> p;</td></tr>
<tr class="codeline" data-linenumber="4548"><td class="num" id="LN4548">4548</td><td class="line">   <span class='keyword'>if</span> (!interlaced)</td></tr>
<tr class="codeline" data-linenumber="4549"><td class="num" id="LN4549">4549</td><td class="line">      <span class='keyword'>return</span> stbi__create_png_image_raw(a, image_data, image_data_len, out_n, a-&gt;s-&gt;img_x, a-&gt;s-&gt;img_y, depth, color);</td></tr>
<tr class="codeline" data-linenumber="4550"><td class="num" id="LN4550">4550</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4551"><td class="num" id="LN4551">4551</td><td class="line">   <span class='comment'>// de-interlacing</span></td></tr>
<tr class="codeline" data-linenumber="4552"><td class="num" id="LN4552">4552</td><td class="line">   final = (stbi_uc *) stbi__malloc_mad3(a-&gt;s-&gt;img_x, a-&gt;s-&gt;img_y, out_bytes, 0);</td></tr>
<tr class="codeline" data-linenumber="4553"><td class="num" id="LN4553">4553</td><td class="line">   <span class='keyword'>for</span> (p=0; p &lt; 7; ++p) {</td></tr>
<tr class="codeline" data-linenumber="4554"><td class="num" id="LN4554">4554</td><td class="line">      <span class='keyword'>int</span> xorig[] = { 0,4,0,2,0,1,0 };</td></tr>
<tr class="codeline" data-linenumber="4555"><td class="num" id="LN4555">4555</td><td class="line">      <span class='keyword'>int</span> yorig[] = { 0,0,4,0,2,0,1 };</td></tr>
<tr class="codeline" data-linenumber="4556"><td class="num" id="LN4556">4556</td><td class="line">      <span class='keyword'>int</span> xspc[]  = { 8,8,4,4,2,2,1 };</td></tr>
<tr class="codeline" data-linenumber="4557"><td class="num" id="LN4557">4557</td><td class="line">      <span class='keyword'>int</span> yspc[]  = { 8,8,8,4,4,2,2 };</td></tr>
<tr class="codeline" data-linenumber="4558"><td class="num" id="LN4558">4558</td><td class="line">      <span class='keyword'>int</span> i,j,x,y;</td></tr>
<tr class="codeline" data-linenumber="4559"><td class="num" id="LN4559">4559</td><td class="line">      <span class='comment'>// pass1_x[4] = 0, pass1_x[5] = 1, pass1_x[12] = 1</span></td></tr>
<tr class="codeline" data-linenumber="4560"><td class="num" id="LN4560">4560</td><td class="line">      x = (a-&gt;s-&gt;img_x - xorig[p] + xspc[p]-1) / xspc[p];</td></tr>
<tr class="codeline" data-linenumber="4561"><td class="num" id="LN4561">4561</td><td class="line">      y = (a-&gt;s-&gt;img_y - yorig[p] + yspc[p]-1) / yspc[p];</td></tr>
<tr class="codeline" data-linenumber="4562"><td class="num" id="LN4562">4562</td><td class="line">      <span class='keyword'>if</span> (x &amp;&amp; y) {</td></tr>
<tr class="codeline" data-linenumber="4563"><td class="num" id="LN4563">4563</td><td class="line">         stbi__uint32 img_len = ((((a-&gt;s-&gt;img_n * x * depth) + 7) &gt;&gt; 3) + 1) * y;</td></tr>
<tr class="codeline" data-linenumber="4564"><td class="num" id="LN4564">4564</td><td class="line">         <span class='keyword'>if</span> (!stbi__create_png_image_raw(a, image_data, image_data_len, out_n, x, y, depth, color)) {</td></tr>
<tr class="codeline" data-linenumber="4565"><td class="num" id="LN4565">4565</td><td class="line">            <span class='macro'>STBI_FREE(final)<span class='macro_popup'>free(final)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4566"><td class="num" id="LN4566">4566</td><td class="line">            <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4567"><td class="num" id="LN4567">4567</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4568"><td class="num" id="LN4568">4568</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="4569"><td class="num" id="LN4569">4569</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4570"><td class="num" id="LN4570">4570</td><td class="line">               <span class='keyword'>int</span> out_y = j*yspc[p]+yorig[p];</td></tr>
<tr class="codeline" data-linenumber="4571"><td class="num" id="LN4571">4571</td><td class="line">               <span class='keyword'>int</span> out_x = i*xspc[p]+xorig[p];</td></tr>
<tr class="codeline" data-linenumber="4572"><td class="num" id="LN4572">4572</td><td class="line">               memcpy(final + out_y*a-&gt;s-&gt;img_x*out_bytes + out_x*out_bytes,</td></tr>
<tr class="codeline" data-linenumber="4573"><td class="num" id="LN4573">4573</td><td class="line">                      a-&gt;out + (j*x+i)*out_bytes, out_bytes);</td></tr>
<tr class="codeline" data-linenumber="4574"><td class="num" id="LN4574">4574</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4575"><td class="num" id="LN4575">4575</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4576"><td class="num" id="LN4576">4576</td><td class="line">         <span class='macro'>STBI_FREE(a-&gt;out)<span class='macro_popup'>free(a-&gt;out)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4577"><td class="num" id="LN4577">4577</td><td class="line">         image_data += img_len;</td></tr>
<tr class="codeline" data-linenumber="4578"><td class="num" id="LN4578">4578</td><td class="line">         image_data_len -= img_len;</td></tr>
<tr class="codeline" data-linenumber="4579"><td class="num" id="LN4579">4579</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4580"><td class="num" id="LN4580">4580</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4581"><td class="num" id="LN4581">4581</td><td class="line">   a-&gt;out = final;</td></tr>
<tr class="codeline" data-linenumber="4582"><td class="num" id="LN4582">4582</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4583"><td class="num" id="LN4583">4583</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4584"><td class="num" id="LN4584">4584</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4585"><td class="num" id="LN4585">4585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4586"><td class="num" id="LN4586">4586</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__compute_transparency(stbi__png *z, stbi_uc tc[3], <span class='keyword'>int</span> out_n)</td></tr>
<tr class="codeline" data-linenumber="4587"><td class="num" id="LN4587">4587</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4588"><td class="num" id="LN4588">4588</td><td class="line">   stbi__context *s = z-&gt;s;</td></tr>
<tr class="codeline" data-linenumber="4589"><td class="num" id="LN4589">4589</td><td class="line">   stbi__uint32 i, pixel_count = s-&gt;img_x * s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="4590"><td class="num" id="LN4590">4590</td><td class="line">   stbi_uc *p = z-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="4591"><td class="num" id="LN4591">4591</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4592"><td class="num" id="LN4592">4592</td><td class="line">   <span class='comment'>// compute color-based transparency, assuming we've</span></td></tr>
<tr class="codeline" data-linenumber="4593"><td class="num" id="LN4593">4593</td><td class="line">   <span class='comment'>// already got 255 as the alpha value in the output</span></td></tr>
<tr class="codeline" data-linenumber="4594"><td class="num" id="LN4594">4594</td><td class="line">   <span class='macro'>STBI_ASSERT(out_n == 2 || out_n == 4)<span class='macro_popup'>((void) sizeof ((out_n == 2 || out_n == 4) ? 1 : 0), __extension__<br> ({ if (out_n == 2 || out_n == 4) ; else __assert_fail ("out_n == 2 || out_n == 4"<br>, "src/stb_image.h", 4594, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4595"><td class="num" id="LN4595">4595</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4596"><td class="num" id="LN4596">4596</td><td class="line">   <span class='keyword'>if</span> (out_n == 2) {</td></tr>
<tr class="codeline" data-linenumber="4597"><td class="num" id="LN4597">4597</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4598"><td class="num" id="LN4598">4598</td><td class="line">         p[1] = (p[0] == tc[0] ? 0 : 255);</td></tr>
<tr class="codeline" data-linenumber="4599"><td class="num" id="LN4599">4599</td><td class="line">         p += 2;</td></tr>
<tr class="codeline" data-linenumber="4600"><td class="num" id="LN4600">4600</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4601"><td class="num" id="LN4601">4601</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4602"><td class="num" id="LN4602">4602</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4603"><td class="num" id="LN4603">4603</td><td class="line">         <span class='keyword'>if</span> (p[0] == tc[0] &amp;&amp; p[1] == tc[1] &amp;&amp; p[2] == tc[2])</td></tr>
<tr class="codeline" data-linenumber="4604"><td class="num" id="LN4604">4604</td><td class="line">            p[3] = 0;</td></tr>
<tr class="codeline" data-linenumber="4605"><td class="num" id="LN4605">4605</td><td class="line">         p += 4;</td></tr>
<tr class="codeline" data-linenumber="4606"><td class="num" id="LN4606">4606</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4607"><td class="num" id="LN4607">4607</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4608"><td class="num" id="LN4608">4608</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4609"><td class="num" id="LN4609">4609</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4610"><td class="num" id="LN4610">4610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4611"><td class="num" id="LN4611">4611</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__compute_transparency16(stbi__png *z, stbi__uint16 tc[3], <span class='keyword'>int</span> out_n)</td></tr>
<tr class="codeline" data-linenumber="4612"><td class="num" id="LN4612">4612</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4613"><td class="num" id="LN4613">4613</td><td class="line">   stbi__context *s = z-&gt;s;</td></tr>
<tr class="codeline" data-linenumber="4614"><td class="num" id="LN4614">4614</td><td class="line">   stbi__uint32 i, pixel_count = s-&gt;img_x * s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="4615"><td class="num" id="LN4615">4615</td><td class="line">   stbi__uint16 *p = (stbi__uint16*) z-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="4616"><td class="num" id="LN4616">4616</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4617"><td class="num" id="LN4617">4617</td><td class="line">   <span class='comment'>// compute color-based transparency, assuming we've</span></td></tr>
<tr class="codeline" data-linenumber="4618"><td class="num" id="LN4618">4618</td><td class="line">   <span class='comment'>// already got 65535 as the alpha value in the output</span></td></tr>
<tr class="codeline" data-linenumber="4619"><td class="num" id="LN4619">4619</td><td class="line">   <span class='macro'>STBI_ASSERT(out_n == 2 || out_n == 4)<span class='macro_popup'>((void) sizeof ((out_n == 2 || out_n == 4) ? 1 : 0), __extension__<br> ({ if (out_n == 2 || out_n == 4) ; else __assert_fail ("out_n == 2 || out_n == 4"<br>, "src/stb_image.h", 4619, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4620"><td class="num" id="LN4620">4620</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4621"><td class="num" id="LN4621">4621</td><td class="line">   <span class='keyword'>if</span> (out_n == 2) {</td></tr>
<tr class="codeline" data-linenumber="4622"><td class="num" id="LN4622">4622</td><td class="line">      <span class='keyword'>for</span> (i = 0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4623"><td class="num" id="LN4623">4623</td><td class="line">         p[1] = (p[0] == tc[0] ? 0 : 65535);</td></tr>
<tr class="codeline" data-linenumber="4624"><td class="num" id="LN4624">4624</td><td class="line">         p += 2;</td></tr>
<tr class="codeline" data-linenumber="4625"><td class="num" id="LN4625">4625</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4626"><td class="num" id="LN4626">4626</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4627"><td class="num" id="LN4627">4627</td><td class="line">      <span class='keyword'>for</span> (i = 0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4628"><td class="num" id="LN4628">4628</td><td class="line">         <span class='keyword'>if</span> (p[0] == tc[0] &amp;&amp; p[1] == tc[1] &amp;&amp; p[2] == tc[2])</td></tr>
<tr class="codeline" data-linenumber="4629"><td class="num" id="LN4629">4629</td><td class="line">            p[3] = 0;</td></tr>
<tr class="codeline" data-linenumber="4630"><td class="num" id="LN4630">4630</td><td class="line">         p += 4;</td></tr>
<tr class="codeline" data-linenumber="4631"><td class="num" id="LN4631">4631</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4632"><td class="num" id="LN4632">4632</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4633"><td class="num" id="LN4633">4633</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4634"><td class="num" id="LN4634">4634</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4635"><td class="num" id="LN4635">4635</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4636"><td class="num" id="LN4636">4636</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__expand_png_palette(stbi__png *a, stbi_uc *palette, <span class='keyword'>int</span> len, <span class='keyword'>int</span> pal_img_n)</td></tr>
<tr class="codeline" data-linenumber="4637"><td class="num" id="LN4637">4637</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4638"><td class="num" id="LN4638">4638</td><td class="line">   stbi__uint32 i, pixel_count = a-&gt;s-&gt;img_x * a-&gt;s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="4639"><td class="num" id="LN4639">4639</td><td class="line">   stbi_uc *p, *temp_out, *orig = a-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="4640"><td class="num" id="LN4640">4640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4641"><td class="num" id="LN4641">4641</td><td class="line">   p = (stbi_uc *) stbi__malloc_mad2(pixel_count, pal_img_n, 0);</td></tr>
<tr class="codeline" data-linenumber="4642"><td class="num" id="LN4642">4642</td><td class="line">   <span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>stbi__err("outofmem")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4643"><td class="num" id="LN4643">4643</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4644"><td class="num" id="LN4644">4644</td><td class="line">   <span class='comment'>// between here and free(out) below, exitting would leak</span></td></tr>
<tr class="codeline" data-linenumber="4645"><td class="num" id="LN4645">4645</td><td class="line">   temp_out = p;</td></tr>
<tr class="codeline" data-linenumber="4646"><td class="num" id="LN4646">4646</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4647"><td class="num" id="LN4647">4647</td><td class="line">   <span class='keyword'>if</span> (pal_img_n == 3) {</td></tr>
<tr class="codeline" data-linenumber="4648"><td class="num" id="LN4648">4648</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4649"><td class="num" id="LN4649">4649</td><td class="line">         <span class='keyword'>int</span> n = orig[i]*4;</td></tr>
<tr class="codeline" data-linenumber="4650"><td class="num" id="LN4650">4650</td><td class="line">         p[0] = palette[n  ];</td></tr>
<tr class="codeline" data-linenumber="4651"><td class="num" id="LN4651">4651</td><td class="line">         p[1] = palette[n+1];</td></tr>
<tr class="codeline" data-linenumber="4652"><td class="num" id="LN4652">4652</td><td class="line">         p[2] = palette[n+2];</td></tr>
<tr class="codeline" data-linenumber="4653"><td class="num" id="LN4653">4653</td><td class="line">         p += 3;</td></tr>
<tr class="codeline" data-linenumber="4654"><td class="num" id="LN4654">4654</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4655"><td class="num" id="LN4655">4655</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4656"><td class="num" id="LN4656">4656</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4657"><td class="num" id="LN4657">4657</td><td class="line">         <span class='keyword'>int</span> n = orig[i]*4;</td></tr>
<tr class="codeline" data-linenumber="4658"><td class="num" id="LN4658">4658</td><td class="line">         p[0] = palette[n  ];</td></tr>
<tr class="codeline" data-linenumber="4659"><td class="num" id="LN4659">4659</td><td class="line">         p[1] = palette[n+1];</td></tr>
<tr class="codeline" data-linenumber="4660"><td class="num" id="LN4660">4660</td><td class="line">         p[2] = palette[n+2];</td></tr>
<tr class="codeline" data-linenumber="4661"><td class="num" id="LN4661">4661</td><td class="line">         p[3] = palette[n+3];</td></tr>
<tr class="codeline" data-linenumber="4662"><td class="num" id="LN4662">4662</td><td class="line">         p += 4;</td></tr>
<tr class="codeline" data-linenumber="4663"><td class="num" id="LN4663">4663</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4664"><td class="num" id="LN4664">4664</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4665"><td class="num" id="LN4665">4665</td><td class="line">   <span class='macro'>STBI_FREE(a-&gt;out)<span class='macro_popup'>free(a-&gt;out)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4666"><td class="num" id="LN4666">4666</td><td class="line">   a-&gt;out = temp_out;</td></tr>
<tr class="codeline" data-linenumber="4667"><td class="num" id="LN4667">4667</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4668"><td class="num" id="LN4668">4668</td><td class="line">   <span class='macro'>STBI_NOTUSED(len)<span class='macro_popup'>(void)sizeof(len)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4669"><td class="num" id="LN4669">4669</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4670"><td class="num" id="LN4670">4670</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4671"><td class="num" id="LN4671">4671</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4672"><td class="num" id="LN4672">4672</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4673"><td class="num" id="LN4673">4673</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__unpremultiply_on_load = 0;</td></tr>
<tr class="codeline" data-linenumber="4674"><td class="num" id="LN4674">4674</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__de_iphone_flag = 0;</td></tr>
<tr class="codeline" data-linenumber="4675"><td class="num" id="LN4675">4675</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4676"><td class="num" id="LN4676">4676</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_set_unpremultiply_on_load(<span class='keyword'>int</span> flag_true_if_should_unpremultiply)</td></tr>
<tr class="codeline" data-linenumber="4677"><td class="num" id="LN4677">4677</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4678"><td class="num" id="LN4678">4678</td><td class="line">   stbi__unpremultiply_on_load = flag_true_if_should_unpremultiply;</td></tr>
<tr class="codeline" data-linenumber="4679"><td class="num" id="LN4679">4679</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4680"><td class="num" id="LN4680">4680</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4681"><td class="num" id="LN4681">4681</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>void</span> stbi_convert_iphone_png_to_rgb(<span class='keyword'>int</span> flag_true_if_should_convert)</td></tr>
<tr class="codeline" data-linenumber="4682"><td class="num" id="LN4682">4682</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4683"><td class="num" id="LN4683">4683</td><td class="line">   stbi__de_iphone_flag = flag_true_if_should_convert;</td></tr>
<tr class="codeline" data-linenumber="4684"><td class="num" id="LN4684">4684</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4685"><td class="num" id="LN4685">4685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4686"><td class="num" id="LN4686">4686</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__de_iphone(stbi__png *z)</td></tr>
<tr class="codeline" data-linenumber="4687"><td class="num" id="LN4687">4687</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4688"><td class="num" id="LN4688">4688</td><td class="line">   stbi__context *s = z-&gt;s;</td></tr>
<tr class="codeline" data-linenumber="4689"><td class="num" id="LN4689">4689</td><td class="line">   stbi__uint32 i, pixel_count = s-&gt;img_x * s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="4690"><td class="num" id="LN4690">4690</td><td class="line">   stbi_uc *p = z-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="4691"><td class="num" id="LN4691">4691</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4692"><td class="num" id="LN4692">4692</td><td class="line">   <span class='keyword'>if</span> (s-&gt;img_out_n == 3) {  <span class='comment'>// convert bgr to rgb</span></td></tr>
<tr class="codeline" data-linenumber="4693"><td class="num" id="LN4693">4693</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4694"><td class="num" id="LN4694">4694</td><td class="line">         stbi_uc t = p[0];</td></tr>
<tr class="codeline" data-linenumber="4695"><td class="num" id="LN4695">4695</td><td class="line">         p[0] = p[2];</td></tr>
<tr class="codeline" data-linenumber="4696"><td class="num" id="LN4696">4696</td><td class="line">         p[2] = t;</td></tr>
<tr class="codeline" data-linenumber="4697"><td class="num" id="LN4697">4697</td><td class="line">         p += 3;</td></tr>
<tr class="codeline" data-linenumber="4698"><td class="num" id="LN4698">4698</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4699"><td class="num" id="LN4699">4699</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4700"><td class="num" id="LN4700">4700</td><td class="line">      <span class='macro'>STBI_ASSERT(s-&gt;img_out_n == 4)<span class='macro_popup'>((void) sizeof ((s-&gt;img_out_n == 4) ? 1 : 0), __extension__<br> ({ if (s-&gt;img_out_n == 4) ; else __assert_fail ("s-&gt;img_out_n == 4"<br>, "src/stb_image.h", 4700, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4701"><td class="num" id="LN4701">4701</td><td class="line">      <span class='keyword'>if</span> (stbi__unpremultiply_on_load) {</td></tr>
<tr class="codeline" data-linenumber="4702"><td class="num" id="LN4702">4702</td><td class="line">         <span class='comment'>// convert bgr to rgb and unpremultiply</span></td></tr>
<tr class="codeline" data-linenumber="4703"><td class="num" id="LN4703">4703</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4704"><td class="num" id="LN4704">4704</td><td class="line">            stbi_uc a = p[3];</td></tr>
<tr class="codeline" data-linenumber="4705"><td class="num" id="LN4705">4705</td><td class="line">            stbi_uc t = p[0];</td></tr>
<tr class="codeline" data-linenumber="4706"><td class="num" id="LN4706">4706</td><td class="line">            <span class='keyword'>if</span> (a) {</td></tr>
<tr class="codeline" data-linenumber="4707"><td class="num" id="LN4707">4707</td><td class="line">               stbi_uc half = a / 2;</td></tr>
<tr class="codeline" data-linenumber="4708"><td class="num" id="LN4708">4708</td><td class="line">               p[0] = (p[2] * 255 + half) / a;</td></tr>
<tr class="codeline" data-linenumber="4709"><td class="num" id="LN4709">4709</td><td class="line">               p[1] = (p[1] * 255 + half) / a;</td></tr>
<tr class="codeline" data-linenumber="4710"><td class="num" id="LN4710">4710</td><td class="line">               p[2] = ( t   * 255 + half) / a;</td></tr>
<tr class="codeline" data-linenumber="4711"><td class="num" id="LN4711">4711</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4712"><td class="num" id="LN4712">4712</td><td class="line">               p[0] = p[2];</td></tr>
<tr class="codeline" data-linenumber="4713"><td class="num" id="LN4713">4713</td><td class="line">               p[2] = t;</td></tr>
<tr class="codeline" data-linenumber="4714"><td class="num" id="LN4714">4714</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4715"><td class="num" id="LN4715">4715</td><td class="line">            p += 4;</td></tr>
<tr class="codeline" data-linenumber="4716"><td class="num" id="LN4716">4716</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4717"><td class="num" id="LN4717">4717</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4718"><td class="num" id="LN4718">4718</td><td class="line">         <span class='comment'>// convert bgr to rgb</span></td></tr>
<tr class="codeline" data-linenumber="4719"><td class="num" id="LN4719">4719</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; pixel_count; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4720"><td class="num" id="LN4720">4720</td><td class="line">            stbi_uc t = p[0];</td></tr>
<tr class="codeline" data-linenumber="4721"><td class="num" id="LN4721">4721</td><td class="line">            p[0] = p[2];</td></tr>
<tr class="codeline" data-linenumber="4722"><td class="num" id="LN4722">4722</td><td class="line">            p[2] = t;</td></tr>
<tr class="codeline" data-linenumber="4723"><td class="num" id="LN4723">4723</td><td class="line">            p += 4;</td></tr>
<tr class="codeline" data-linenumber="4724"><td class="num" id="LN4724">4724</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4725"><td class="num" id="LN4725">4725</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4726"><td class="num" id="LN4726">4726</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4727"><td class="num" id="LN4727">4727</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4728"><td class="num" id="LN4728">4728</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4729"><td class="num" id="LN4729">4729</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__PNG_TYPE(a,b,c,d)<span class='macro_popup'>(((unsigned) (a) &lt;&lt; 24) + ((unsigned) (b) &lt;&lt; 16) +<br> ((unsigned) (c) &lt;&lt; 8) + (unsigned) (d))</span></span>  (((unsigned) (a) &lt;&lt; 24) + ((unsigned) (b) &lt;&lt; 16) + ((unsigned) (c) &lt;&lt; 8) + (unsigned) (d))</span></td></tr>
<tr class="codeline" data-linenumber="4730"><td class="num" id="LN4730">4730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4731"><td class="num" id="LN4731">4731</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__parse_png_file(stbi__png *z, <span class='keyword'>int</span> scan, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="4732"><td class="num" id="LN4732">4732</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4733"><td class="num" id="LN4733">4733</td><td class="line">   stbi_uc palette[1024], pal_img_n=0;</td></tr>
<tr class="codeline" data-linenumber="4734"><td class="num" id="LN4734">4734</td><td class="line">   stbi_uc has_trans=0, tc[3];</td></tr>
<tr class="codeline" data-linenumber="4735"><td class="num" id="LN4735">4735</td><td class="line">   stbi__uint16 tc16[3];</td></tr>
<tr class="codeline" data-linenumber="4736"><td class="num" id="LN4736">4736</td><td class="line">   stbi__uint32 ioff=0, idata_limit=0, i, pal_len=0;</td></tr>
<tr class="codeline" data-linenumber="4737"><td class="num" id="LN4737">4737</td><td class="line">   <span class='keyword'>int</span> first=1,k,interlace=0, color=0, is_iphone=0;</td></tr>
<tr class="codeline" data-linenumber="4738"><td class="num" id="LN4738">4738</td><td class="line">   stbi__context *s = z-&gt;s;</td></tr>
<tr class="codeline" data-linenumber="4739"><td class="num" id="LN4739">4739</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4740"><td class="num" id="LN4740">4740</td><td class="line">   z-&gt;expanded = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4741"><td class="num" id="LN4741">4741</td><td class="line">   z-&gt;idata = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4742"><td class="num" id="LN4742">4742</td><td class="line">   z-&gt;out = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4743"><td class="num" id="LN4743">4743</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4744"><td class="num" id="LN4744">4744</td><td class="line">   <span class='keyword'>if</span> (!stbi__check_png_header(s)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4745"><td class="num" id="LN4745">4745</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4746"><td class="num" id="LN4746">4746</td><td class="line">   <span class='keyword'>if</span> (scan == STBI__SCAN_type) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4747"><td class="num" id="LN4747">4747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4748"><td class="num" id="LN4748">4748</td><td class="line">   <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="4749"><td class="num" id="LN4749">4749</td><td class="line">      stbi__pngchunk c = stbi__get_chunk_header(s);</td></tr>
<tr class="codeline" data-linenumber="4750"><td class="num" id="LN4750">4750</td><td class="line">      <span class='keyword'>switch</span> (c.type) {</td></tr>
<tr class="codeline" data-linenumber="4751"><td class="num" id="LN4751">4751</td><td class="line">         <span class='keyword'>case</span> <span class='macro'>STBI__PNG_TYPE('C','g','B','I')<span class='macro_popup'>(((unsigned) ('C') &lt;&lt; 24) + ((unsigned) ('g') &lt;&lt; 16<br>) + ((unsigned) ('B') &lt;&lt; 8) + (unsigned) ('I'))</span></span>:</td></tr>
<tr class="codeline" data-linenumber="4752"><td class="num" id="LN4752">4752</td><td class="line">            is_iphone = 1;</td></tr>
<tr class="codeline" data-linenumber="4753"><td class="num" id="LN4753">4753</td><td class="line">            stbi__skip(s, c.length);</td></tr>
<tr class="codeline" data-linenumber="4754"><td class="num" id="LN4754">4754</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4755"><td class="num" id="LN4755">4755</td><td class="line">         <span class='keyword'>case</span> <span class='macro'>STBI__PNG_TYPE('I','H','D','R')<span class='macro_popup'>(((unsigned) ('I') &lt;&lt; 24) + ((unsigned) ('H') &lt;&lt; 16<br>) + ((unsigned) ('D') &lt;&lt; 8) + (unsigned) ('R'))</span></span>: {</td></tr>
<tr class="codeline" data-linenumber="4756"><td class="num" id="LN4756">4756</td><td class="line">            <span class='keyword'>int</span> comp,filter;</td></tr>
<tr class="codeline" data-linenumber="4757"><td class="num" id="LN4757">4757</td><td class="line">            <span class='keyword'>if</span> (!first) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"multiple IHDR"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("multiple IHDR")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4758"><td class="num" id="LN4758">4758</td><td class="line">            first = 0;</td></tr>
<tr class="codeline" data-linenumber="4759"><td class="num" id="LN4759">4759</td><td class="line">            <span class='keyword'>if</span> (c.length != 13) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad IHDR len"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad IHDR len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4760"><td class="num" id="LN4760">4760</td><td class="line">            s-&gt;img_x = stbi__get32be(s); <span class='keyword'>if</span> (s-&gt;img_x &gt; (1 &lt;&lt; 24)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"too large"</span>,<span class='string_literal'>"Very large image (corrupt?)"</span>)<span class='macro_popup'>stbi__err("too large")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4761"><td class="num" id="LN4761">4761</td><td class="line">            s-&gt;img_y = stbi__get32be(s); <span class='keyword'>if</span> (s-&gt;img_y &gt; (1 &lt;&lt; 24)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"too large"</span>,<span class='string_literal'>"Very large image (corrupt?)"</span>)<span class='macro_popup'>stbi__err("too large")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4762"><td class="num" id="LN4762">4762</td><td class="line">            z-&gt;depth = stbi__get8(s);  <span class='keyword'>if</span> (z-&gt;depth != 1 &amp;&amp; z-&gt;depth != 2 &amp;&amp; z-&gt;depth != 4 &amp;&amp; z-&gt;depth != 8 &amp;&amp; z-&gt;depth != 16)  <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"1/2/4/8/16-bit only"</span>,<span class='string_literal'>"PNG not supported: 1/2/4/8/16-bit only"</span>)<span class='macro_popup'>stbi__err("1/2/4/8/16-bit only")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4763"><td class="num" id="LN4763">4763</td><td class="line">            color = stbi__get8(s);  <span class='keyword'>if</span> (color &gt; 6)         <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad ctype"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad ctype")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4764"><td class="num" id="LN4764">4764</td><td class="line">            <span class='keyword'>if</span> (color == 3 &amp;&amp; z-&gt;depth == 16)                  <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad ctype"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad ctype")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4765"><td class="num" id="LN4765">4765</td><td class="line">            <span class='keyword'>if</span> (color == 3) pal_img_n = 3; <span class='keyword'>else</span> <span class='keyword'>if</span> (color &amp; 1) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad ctype"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad ctype")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4766"><td class="num" id="LN4766">4766</td><td class="line">            comp  = stbi__get8(s);  <span class='keyword'>if</span> (comp) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad comp method"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad comp method")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4767"><td class="num" id="LN4767">4767</td><td class="line">            filter= stbi__get8(s);  <span class='keyword'>if</span> (filter) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad filter method"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad filter method")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4768"><td class="num" id="LN4768">4768</td><td class="line">            interlace = stbi__get8(s); <span class='keyword'>if</span> (interlace&gt;1) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad interlace method"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad interlace method")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4769"><td class="num" id="LN4769">4769</td><td class="line">            <span class='keyword'>if</span> (!s-&gt;img_x || !s-&gt;img_y) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"0-pixel image"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("0-pixel image")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4770"><td class="num" id="LN4770">4770</td><td class="line">            <span class='keyword'>if</span> (!pal_img_n) {</td></tr>
<tr class="codeline" data-linenumber="4771"><td class="num" id="LN4771">4771</td><td class="line">               s-&gt;img_n = (color &amp; 2 ? 3 : 1) + (color &amp; 4 ? 1 : 0);</td></tr>
<tr class="codeline" data-linenumber="4772"><td class="num" id="LN4772">4772</td><td class="line">               <span class='keyword'>if</span> ((1 &lt;&lt; 30) / s-&gt;img_x / s-&gt;img_n &lt; s-&gt;img_y) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"Image too large to decode"</span>)<span class='macro_popup'>stbi__err("too large")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4773"><td class="num" id="LN4773">4773</td><td class="line">               <span class='keyword'>if</span> (scan == STBI__SCAN_header) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4774"><td class="num" id="LN4774">4774</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4775"><td class="num" id="LN4775">4775</td><td class="line">               <span class='comment'>// if paletted, then pal_n is our final components, and</span></td></tr>
<tr class="codeline" data-linenumber="4776"><td class="num" id="LN4776">4776</td><td class="line">               <span class='comment'>// img_n is # components to decompress/filter.</span></td></tr>
<tr class="codeline" data-linenumber="4777"><td class="num" id="LN4777">4777</td><td class="line">               s-&gt;img_n = 1;</td></tr>
<tr class="codeline" data-linenumber="4778"><td class="num" id="LN4778">4778</td><td class="line">               <span class='keyword'>if</span> ((1 &lt;&lt; 30) / s-&gt;img_x / 4 &lt; s-&gt;img_y) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"too large"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("too large")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4779"><td class="num" id="LN4779">4779</td><td class="line">               <span class='comment'>// if SCAN_header, have to scan to see if we have a tRNS</span></td></tr>
<tr class="codeline" data-linenumber="4780"><td class="num" id="LN4780">4780</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4781"><td class="num" id="LN4781">4781</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4782"><td class="num" id="LN4782">4782</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4783"><td class="num" id="LN4783">4783</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4784"><td class="num" id="LN4784">4784</td><td class="line">         <span class='keyword'>case</span> <span class='macro'>STBI__PNG_TYPE('P','L','T','E')<span class='macro_popup'>(((unsigned) ('P') &lt;&lt; 24) + ((unsigned) ('L') &lt;&lt; 16<br>) + ((unsigned) ('T') &lt;&lt; 8) + (unsigned) ('E'))</span></span>:  {</td></tr>
<tr class="codeline" data-linenumber="4785"><td class="num" id="LN4785">4785</td><td class="line">            <span class='keyword'>if</span> (first) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"first not IHDR"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("first not IHDR")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4786"><td class="num" id="LN4786">4786</td><td class="line">            <span class='keyword'>if</span> (c.length &gt; 256*3) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"invalid PLTE"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("invalid PLTE")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4787"><td class="num" id="LN4787">4787</td><td class="line">            pal_len = c.length / 3;</td></tr>
<tr class="codeline" data-linenumber="4788"><td class="num" id="LN4788">4788</td><td class="line">            <span class='keyword'>if</span> (pal_len * 3 != c.length) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"invalid PLTE"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("invalid PLTE")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4789"><td class="num" id="LN4789">4789</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; pal_len; ++i) {</td></tr>
<tr class="codeline" data-linenumber="4790"><td class="num" id="LN4790">4790</td><td class="line">               palette[i*4+0] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="4791"><td class="num" id="LN4791">4791</td><td class="line">               palette[i*4+1] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="4792"><td class="num" id="LN4792">4792</td><td class="line">               palette[i*4+2] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="4793"><td class="num" id="LN4793">4793</td><td class="line">               palette[i*4+3] = 255;</td></tr>
<tr class="codeline" data-linenumber="4794"><td class="num" id="LN4794">4794</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4795"><td class="num" id="LN4795">4795</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4796"><td class="num" id="LN4796">4796</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4797"><td class="num" id="LN4797">4797</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4798"><td class="num" id="LN4798">4798</td><td class="line">         <span class='keyword'>case</span> <span class='macro'>STBI__PNG_TYPE('t','R','N','S')<span class='macro_popup'>(((unsigned) ('t') &lt;&lt; 24) + ((unsigned) ('R') &lt;&lt; 16<br>) + ((unsigned) ('N') &lt;&lt; 8) + (unsigned) ('S'))</span></span>: {</td></tr>
<tr class="codeline" data-linenumber="4799"><td class="num" id="LN4799">4799</td><td class="line">            <span class='keyword'>if</span> (first) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"first not IHDR"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("first not IHDR")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4800"><td class="num" id="LN4800">4800</td><td class="line">            <span class='keyword'>if</span> (z-&gt;idata) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"tRNS after IDAT"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("tRNS after IDAT")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4801"><td class="num" id="LN4801">4801</td><td class="line">            <span class='keyword'>if</span> (pal_img_n) {</td></tr>
<tr class="codeline" data-linenumber="4802"><td class="num" id="LN4802">4802</td><td class="line">               <span class='keyword'>if</span> (scan == STBI__SCAN_header) { s-&gt;img_n = 4; <span class='keyword'>return</span> 1; }</td></tr>
<tr class="codeline" data-linenumber="4803"><td class="num" id="LN4803">4803</td><td class="line">               <span class='keyword'>if</span> (pal_len == 0) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"tRNS before PLTE"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("tRNS before PLTE")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4804"><td class="num" id="LN4804">4804</td><td class="line">               <span class='keyword'>if</span> (c.length &gt; pal_len) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad tRNS len"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad tRNS len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4805"><td class="num" id="LN4805">4805</td><td class="line">               pal_img_n = 4;</td></tr>
<tr class="codeline" data-linenumber="4806"><td class="num" id="LN4806">4806</td><td class="line">               <span class='keyword'>for</span> (i=0; i &lt; c.length; ++i)</td></tr>
<tr class="codeline" data-linenumber="4807"><td class="num" id="LN4807">4807</td><td class="line">                  palette[i*4+3] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="4808"><td class="num" id="LN4808">4808</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4809"><td class="num" id="LN4809">4809</td><td class="line">               <span class='keyword'>if</span> (!(s-&gt;img_n &amp; 1)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"tRNS with alpha"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("tRNS with alpha")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4810"><td class="num" id="LN4810">4810</td><td class="line">               <span class='keyword'>if</span> (c.length != (stbi__uint32) s-&gt;img_n*2) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"bad tRNS len"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("bad tRNS len")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4811"><td class="num" id="LN4811">4811</td><td class="line">               has_trans = 1;</td></tr>
<tr class="codeline" data-linenumber="4812"><td class="num" id="LN4812">4812</td><td class="line">               <span class='keyword'>if</span> (z-&gt;depth == 16) {</td></tr>
<tr class="codeline" data-linenumber="4813"><td class="num" id="LN4813">4813</td><td class="line">                  <span class='keyword'>for</span> (k = 0; k &lt; s-&gt;img_n; ++k) tc16[k] = (stbi__uint16)stbi__get16be(s); <span class='comment'>// copy the values as-is</span></td></tr>
<tr class="codeline" data-linenumber="4814"><td class="num" id="LN4814">4814</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4815"><td class="num" id="LN4815">4815</td><td class="line">                  <span class='keyword'>for</span> (k = 0; k &lt; s-&gt;img_n; ++k) tc[k] = (stbi_uc)(stbi__get16be(s) &amp; 255) * stbi__depth_scale_table[z-&gt;depth]; <span class='comment'>// non 8-bit images will be larger</span></td></tr>
<tr class="codeline" data-linenumber="4816"><td class="num" id="LN4816">4816</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="4817"><td class="num" id="LN4817">4817</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4818"><td class="num" id="LN4818">4818</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4819"><td class="num" id="LN4819">4819</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4820"><td class="num" id="LN4820">4820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4821"><td class="num" id="LN4821">4821</td><td class="line">         <span class='keyword'>case</span> <span class='macro'>STBI__PNG_TYPE('I','D','A','T')<span class='macro_popup'>(((unsigned) ('I') &lt;&lt; 24) + ((unsigned) ('D') &lt;&lt; 16<br>) + ((unsigned) ('A') &lt;&lt; 8) + (unsigned) ('T'))</span></span>: {</td></tr>
<tr class="codeline" data-linenumber="4822"><td class="num" id="LN4822">4822</td><td class="line">            <span class='keyword'>if</span> (first) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"first not IHDR"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("first not IHDR")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4823"><td class="num" id="LN4823">4823</td><td class="line">            <span class='keyword'>if</span> (pal_img_n &amp;&amp; !pal_len) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"no PLTE"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("no PLTE")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4824"><td class="num" id="LN4824">4824</td><td class="line">            <span class='keyword'>if</span> (scan == STBI__SCAN_header) { s-&gt;img_n = pal_img_n; <span class='keyword'>return</span> 1; }</td></tr>
<tr class="codeline" data-linenumber="4825"><td class="num" id="LN4825">4825</td><td class="line">            <span class='keyword'>if</span> ((<span class='keyword'>int</span>)(ioff + c.length) &lt; (<span class='keyword'>int</span>)ioff) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4826"><td class="num" id="LN4826">4826</td><td class="line">            <span class='keyword'>if</span> (ioff + c.length &gt; idata_limit) {</td></tr>
<tr class="codeline" data-linenumber="4827"><td class="num" id="LN4827">4827</td><td class="line">               stbi__uint32 idata_limit_old = idata_limit;</td></tr>
<tr class="codeline" data-linenumber="4828"><td class="num" id="LN4828">4828</td><td class="line">               stbi_uc *p;</td></tr>
<tr class="codeline" data-linenumber="4829"><td class="num" id="LN4829">4829</td><td class="line">               <span class='keyword'>if</span> (idata_limit == 0) idata_limit = c.length &gt; 4096 ? c.length : 4096;</td></tr>
<tr class="codeline" data-linenumber="4830"><td class="num" id="LN4830">4830</td><td class="line">               <span class='keyword'>while</span> (ioff + c.length &gt; idata_limit)</td></tr>
<tr class="codeline" data-linenumber="4831"><td class="num" id="LN4831">4831</td><td class="line">                  idata_limit *= 2;</td></tr>
<tr class="codeline" data-linenumber="4832"><td class="num" id="LN4832">4832</td><td class="line">               <span class='macro'>STBI_NOTUSED(idata_limit_old)<span class='macro_popup'>(void)sizeof(idata_limit_old)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4833"><td class="num" id="LN4833">4833</td><td class="line">               p = (stbi_uc *) <span class='macro'>STBI_REALLOC_SIZED(z-&gt;idata, idata_limit_old, idata_limit)<span class='macro_popup'>realloc(z-&gt;idata,idata_limit)</span></span>; <span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>stbi__err("outofmem")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4834"><td class="num" id="LN4834">4834</td><td class="line">               z-&gt;idata = p;</td></tr>
<tr class="codeline" data-linenumber="4835"><td class="num" id="LN4835">4835</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4836"><td class="num" id="LN4836">4836</td><td class="line">            <span class='keyword'>if</span> (!stbi__getn(s, z-&gt;idata+ioff,c.length)) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"outofdata"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("outofdata")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4837"><td class="num" id="LN4837">4837</td><td class="line">            ioff += c.length;</td></tr>
<tr class="codeline" data-linenumber="4838"><td class="num" id="LN4838">4838</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4839"><td class="num" id="LN4839">4839</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4840"><td class="num" id="LN4840">4840</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4841"><td class="num" id="LN4841">4841</td><td class="line">         <span class='keyword'>case</span> <span class='macro'>STBI__PNG_TYPE('I','E','N','D')<span class='macro_popup'>(((unsigned) ('I') &lt;&lt; 24) + ((unsigned) ('E') &lt;&lt; 16<br>) + ((unsigned) ('N') &lt;&lt; 8) + (unsigned) ('D'))</span></span>: {</td></tr>
<tr class="codeline" data-linenumber="4842"><td class="num" id="LN4842">4842</td><td class="line">            stbi__uint32 raw_len, bpl;</td></tr>
<tr class="codeline" data-linenumber="4843"><td class="num" id="LN4843">4843</td><td class="line">            <span class='keyword'>if</span> (first) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"first not IHDR"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("first not IHDR")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4844"><td class="num" id="LN4844">4844</td><td class="line">            <span class='keyword'>if</span> (scan != STBI__SCAN_load) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4845"><td class="num" id="LN4845">4845</td><td class="line">            <span class='keyword'>if</span> (z-&gt;idata == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"no IDAT"</span>,<span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("no IDAT")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4846"><td class="num" id="LN4846">4846</td><td class="line">            <span class='comment'>// initial guess for decoded data size to avoid unnecessary reallocs</span></td></tr>
<tr class="codeline" data-linenumber="4847"><td class="num" id="LN4847">4847</td><td class="line">            bpl = (s-&gt;img_x * z-&gt;depth + 7) / 8; <span class='comment'>// bytes per line, per component</span></td></tr>
<tr class="codeline" data-linenumber="4848"><td class="num" id="LN4848">4848</td><td class="line">            raw_len = bpl * s-&gt;img_y * s-&gt;img_n <span class='comment'>/* pixels */</span> + s-&gt;img_y <span class='comment'>/* filter mode per row */</span>;</td></tr>
<tr class="codeline" data-linenumber="4849"><td class="num" id="LN4849">4849</td><td class="line">            z-&gt;expanded = (stbi_uc *) stbi_zlib_decode_malloc_guesssize_headerflag((<span class='keyword'>char</span> *) z-&gt;idata, ioff, raw_len, (<span class='keyword'>int</span> *) &amp;raw_len, !is_iphone);</td></tr>
<tr class="codeline" data-linenumber="4850"><td class="num" id="LN4850">4850</td><td class="line">            <span class='keyword'>if</span> (z-&gt;expanded == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0; <span class='comment'>// zlib should set error</span></td></tr>
<tr class="codeline" data-linenumber="4851"><td class="num" id="LN4851">4851</td><td class="line">            <span class='macro'>STBI_FREE(z-&gt;idata)<span class='macro_popup'>free(z-&gt;idata)</span></span>; z-&gt;idata = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4852"><td class="num" id="LN4852">4852</td><td class="line">            <span class='keyword'>if</span> ((req_comp == s-&gt;img_n+1 &amp;&amp; req_comp != 3 &amp;&amp; !pal_img_n) || has_trans)</td></tr>
<tr class="codeline" data-linenumber="4853"><td class="num" id="LN4853">4853</td><td class="line">               s-&gt;img_out_n = s-&gt;img_n+1;</td></tr>
<tr class="codeline" data-linenumber="4854"><td class="num" id="LN4854">4854</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4855"><td class="num" id="LN4855">4855</td><td class="line">               s-&gt;img_out_n = s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="4856"><td class="num" id="LN4856">4856</td><td class="line">            <span class='keyword'>if</span> (!stbi__create_png_image(z, z-&gt;expanded, raw_len, s-&gt;img_out_n, z-&gt;depth, color, interlace)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4857"><td class="num" id="LN4857">4857</td><td class="line">            <span class='keyword'>if</span> (has_trans) {</td></tr>
<tr class="codeline" data-linenumber="4858"><td class="num" id="LN4858">4858</td><td class="line">               <span class='keyword'>if</span> (z-&gt;depth == 16) {</td></tr>
<tr class="codeline" data-linenumber="4859"><td class="num" id="LN4859">4859</td><td class="line">                  <span class='keyword'>if</span> (!stbi__compute_transparency16(z, tc16, s-&gt;img_out_n)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4860"><td class="num" id="LN4860">4860</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="4861"><td class="num" id="LN4861">4861</td><td class="line">                  <span class='keyword'>if</span> (!stbi__compute_transparency(z, tc, s-&gt;img_out_n)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4862"><td class="num" id="LN4862">4862</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="4863"><td class="num" id="LN4863">4863</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4864"><td class="num" id="LN4864">4864</td><td class="line">            <span class='keyword'>if</span> (is_iphone &amp;&amp; stbi__de_iphone_flag &amp;&amp; s-&gt;img_out_n &gt; 2)</td></tr>
<tr class="codeline" data-linenumber="4865"><td class="num" id="LN4865">4865</td><td class="line">               stbi__de_iphone(z);</td></tr>
<tr class="codeline" data-linenumber="4866"><td class="num" id="LN4866">4866</td><td class="line">            <span class='keyword'>if</span> (pal_img_n) {</td></tr>
<tr class="codeline" data-linenumber="4867"><td class="num" id="LN4867">4867</td><td class="line">               <span class='comment'>// pal_img_n == 3 or 4</span></td></tr>
<tr class="codeline" data-linenumber="4868"><td class="num" id="LN4868">4868</td><td class="line">               s-&gt;img_n = pal_img_n; <span class='comment'>// record the actual colors we had</span></td></tr>
<tr class="codeline" data-linenumber="4869"><td class="num" id="LN4869">4869</td><td class="line">               s-&gt;img_out_n = pal_img_n;</td></tr>
<tr class="codeline" data-linenumber="4870"><td class="num" id="LN4870">4870</td><td class="line">               <span class='keyword'>if</span> (req_comp &gt;= 3) s-&gt;img_out_n = req_comp;</td></tr>
<tr class="codeline" data-linenumber="4871"><td class="num" id="LN4871">4871</td><td class="line">               <span class='keyword'>if</span> (!stbi__expand_png_palette(z, palette, pal_len, s-&gt;img_out_n))</td></tr>
<tr class="codeline" data-linenumber="4872"><td class="num" id="LN4872">4872</td><td class="line">                  <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4873"><td class="num" id="LN4873">4873</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (has_trans) {</td></tr>
<tr class="codeline" data-linenumber="4874"><td class="num" id="LN4874">4874</td><td class="line">               <span class='comment'>// non-paletted image with tRNS -&gt; source image has (constant) alpha</span></td></tr>
<tr class="codeline" data-linenumber="4875"><td class="num" id="LN4875">4875</td><td class="line">               ++s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="4876"><td class="num" id="LN4876">4876</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4877"><td class="num" id="LN4877">4877</td><td class="line">            <span class='macro'>STBI_FREE(z-&gt;expanded)<span class='macro_popup'>free(z-&gt;expanded)</span></span>; z-&gt;expanded = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4878"><td class="num" id="LN4878">4878</td><td class="line">            <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4879"><td class="num" id="LN4879">4879</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="4880"><td class="num" id="LN4880">4880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4881"><td class="num" id="LN4881">4881</td><td class="line">         <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="4882"><td class="num" id="LN4882">4882</td><td class="line">            <span class='comment'>// if critical, fail</span></td></tr>
<tr class="codeline" data-linenumber="4883"><td class="num" id="LN4883">4883</td><td class="line">            <span class='keyword'>if</span> (first) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"first not IHDR"</span>, <span class='string_literal'>"Corrupt PNG"</span>)<span class='macro_popup'>stbi__err("first not IHDR")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4884"><td class="num" id="LN4884">4884</td><td class="line">            <span class='keyword'>if</span> ((c.type &amp; (1 &lt;&lt; 29)) == 0) {</td></tr>
<tr class="codeline" data-linenumber="4885"><td class="num" id="LN4885">4885</td><td class="line">               <span class='directive'>#ifndef STBI_NO_FAILURE_STRINGS</span></td></tr>
<tr class="codeline" data-linenumber="4886"><td class="num" id="LN4886">4886</td><td class="line">               <span class='comment'>// not threadsafe</span></td></tr>
<tr class="codeline" data-linenumber="4887"><td class="num" id="LN4887">4887</td><td class="line">               <span class='keyword'>static</span> <span class='keyword'>char</span> invalid_chunk[] = <span class='string_literal'>"XXXX PNG chunk not known"</span>;</td></tr>
<tr class="codeline" data-linenumber="4888"><td class="num" id="LN4888">4888</td><td class="line">               invalid_chunk[0] = <span class='macro'>STBI__BYTECAST(c.type &gt;&gt; 24)<span class='macro_popup'>((stbi_uc) ((c.type &gt;&gt; 24) &amp; 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4889"><td class="num" id="LN4889">4889</td><td class="line">               invalid_chunk[1] = <span class='macro'>STBI__BYTECAST(c.type &gt;&gt; 16)<span class='macro_popup'>((stbi_uc) ((c.type &gt;&gt; 16) &amp; 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4890"><td class="num" id="LN4890">4890</td><td class="line">               invalid_chunk[2] = <span class='macro'>STBI__BYTECAST(c.type &gt;&gt;  8)<span class='macro_popup'>((stbi_uc) ((c.type &gt;&gt; 8) &amp; 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4891"><td class="num" id="LN4891">4891</td><td class="line">               invalid_chunk[3] = <span class='macro'>STBI__BYTECAST(c.type &gt;&gt;  0)<span class='macro_popup'>((stbi_uc) ((c.type &gt;&gt; 0) &amp; 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4892"><td class="num" id="LN4892">4892</td><td class="line">               <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4893"><td class="num" id="LN4893">4893</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__err(invalid_chunk, <span class='string_literal'>"PNG not supported: unknown PNG chunk type"</span>)<span class='macro_popup'>stbi__err(invalid_chunk)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4894"><td class="num" id="LN4894">4894</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4895"><td class="num" id="LN4895">4895</td><td class="line">            stbi__skip(s, c.length);</td></tr>
<tr class="codeline" data-linenumber="4896"><td class="num" id="LN4896">4896</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4897"><td class="num" id="LN4897">4897</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4898"><td class="num" id="LN4898">4898</td><td class="line">      <span class='comment'>// end of PNG chunk, read and skip CRC</span></td></tr>
<tr class="codeline" data-linenumber="4899"><td class="num" id="LN4899">4899</td><td class="line">      stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="4900"><td class="num" id="LN4900">4900</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4901"><td class="num" id="LN4901">4901</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4902"><td class="num" id="LN4902">4902</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4903"><td class="num" id="LN4903">4903</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__do_png(stbi__png *p, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *n, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="4904"><td class="num" id="LN4904">4904</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4905"><td class="num" id="LN4905">4905</td><td class="line">   <span class='keyword'>void</span> *result=<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4906"><td class="num" id="LN4906">4906</td><td class="line">   <span class='keyword'>if</span> (req_comp &lt; 0 || req_comp &gt; 4) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad req_comp"</span>, <span class='string_literal'>"Internal error"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad req_comp")?((void*<br>)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4907"><td class="num" id="LN4907">4907</td><td class="line">   <span class='keyword'>if</span> (stbi__parse_png_file(p, STBI__SCAN_load, req_comp)) {</td></tr>
<tr class="codeline" data-linenumber="4908"><td class="num" id="LN4908">4908</td><td class="line">      <span class='keyword'>if</span> (p-&gt;depth &lt; 8)</td></tr>
<tr class="codeline" data-linenumber="4909"><td class="num" id="LN4909">4909</td><td class="line">         ri-&gt;bits_per_channel = 8;</td></tr>
<tr class="codeline" data-linenumber="4910"><td class="num" id="LN4910">4910</td><td class="line">      <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4911"><td class="num" id="LN4911">4911</td><td class="line">         ri-&gt;bits_per_channel = p-&gt;depth;</td></tr>
<tr class="codeline" data-linenumber="4912"><td class="num" id="LN4912">4912</td><td class="line">      result = p-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="4913"><td class="num" id="LN4913">4913</td><td class="line">      p-&gt;out = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4914"><td class="num" id="LN4914">4914</td><td class="line">      <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != p-&gt;s-&gt;img_out_n) {</td></tr>
<tr class="codeline" data-linenumber="4915"><td class="num" id="LN4915">4915</td><td class="line">         <span class='keyword'>if</span> (ri-&gt;bits_per_channel == 8)</td></tr>
<tr class="codeline" data-linenumber="4916"><td class="num" id="LN4916">4916</td><td class="line">            result = stbi__convert_format((<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *) result, p-&gt;s-&gt;img_out_n, req_comp, p-&gt;s-&gt;img_x, p-&gt;s-&gt;img_y);</td></tr>
<tr class="codeline" data-linenumber="4917"><td class="num" id="LN4917">4917</td><td class="line">         <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4918"><td class="num" id="LN4918">4918</td><td class="line">            result = stbi__convert_format16((stbi__uint16 *) result, p-&gt;s-&gt;img_out_n, req_comp, p-&gt;s-&gt;img_x, p-&gt;s-&gt;img_y);</td></tr>
<tr class="codeline" data-linenumber="4919"><td class="num" id="LN4919">4919</td><td class="line">         p-&gt;s-&gt;img_out_n = req_comp;</td></tr>
<tr class="codeline" data-linenumber="4920"><td class="num" id="LN4920">4920</td><td class="line">         <span class='keyword'>if</span> (result == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="4921"><td class="num" id="LN4921">4921</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4922"><td class="num" id="LN4922">4922</td><td class="line">      *x = p-&gt;s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="4923"><td class="num" id="LN4923">4923</td><td class="line">      *y = p-&gt;s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="4924"><td class="num" id="LN4924">4924</td><td class="line">      <span class='keyword'>if</span> (n) *n = p-&gt;s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="4925"><td class="num" id="LN4925">4925</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4926"><td class="num" id="LN4926">4926</td><td class="line">   <span class='macro'>STBI_FREE(p-&gt;out)<span class='macro_popup'>free(p-&gt;out)</span></span>;      p-&gt;out      = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4927"><td class="num" id="LN4927">4927</td><td class="line">   <span class='macro'>STBI_FREE(p-&gt;expanded)<span class='macro_popup'>free(p-&gt;expanded)</span></span>; p-&gt;expanded = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4928"><td class="num" id="LN4928">4928</td><td class="line">   <span class='macro'>STBI_FREE(p-&gt;idata)<span class='macro_popup'>free(p-&gt;idata)</span></span>;    p-&gt;idata    = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4929"><td class="num" id="LN4929">4929</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4930"><td class="num" id="LN4930">4930</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="4931"><td class="num" id="LN4931">4931</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4932"><td class="num" id="LN4932">4932</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4933"><td class="num" id="LN4933">4933</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__png_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="4934"><td class="num" id="LN4934">4934</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4935"><td class="num" id="LN4935">4935</td><td class="line">   stbi__png p;</td></tr>
<tr class="codeline" data-linenumber="4936"><td class="num" id="LN4936">4936</td><td class="line">   p.s = s;</td></tr>
<tr class="codeline" data-linenumber="4937"><td class="num" id="LN4937">4937</td><td class="line">   <span class='keyword'>return</span> stbi__do_png(&amp;p, x,y,comp,req_comp, ri);</td></tr>
<tr class="codeline" data-linenumber="4938"><td class="num" id="LN4938">4938</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4939"><td class="num" id="LN4939">4939</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4940"><td class="num" id="LN4940">4940</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__png_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="4941"><td class="num" id="LN4941">4941</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4942"><td class="num" id="LN4942">4942</td><td class="line">   <span class='keyword'>int</span> r;</td></tr>
<tr class="codeline" data-linenumber="4943"><td class="num" id="LN4943">4943</td><td class="line">   r = stbi__check_png_header(s);</td></tr>
<tr class="codeline" data-linenumber="4944"><td class="num" id="LN4944">4944</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="4945"><td class="num" id="LN4945">4945</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="4946"><td class="num" id="LN4946">4946</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4947"><td class="num" id="LN4947">4947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4948"><td class="num" id="LN4948">4948</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__png_info_raw(stbi__png *p, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="4949"><td class="num" id="LN4949">4949</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4950"><td class="num" id="LN4950">4950</td><td class="line">   <span class='keyword'>if</span> (!stbi__parse_png_file(p, STBI__SCAN_header, 0)) {</td></tr>
<tr class="codeline" data-linenumber="4951"><td class="num" id="LN4951">4951</td><td class="line">      stbi__rewind( p-&gt;s );</td></tr>
<tr class="codeline" data-linenumber="4952"><td class="num" id="LN4952">4952</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4953"><td class="num" id="LN4953">4953</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4954"><td class="num" id="LN4954">4954</td><td class="line">   <span class='keyword'>if</span> (x) *x = p-&gt;s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="4955"><td class="num" id="LN4955">4955</td><td class="line">   <span class='keyword'>if</span> (y) *y = p-&gt;s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="4956"><td class="num" id="LN4956">4956</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = p-&gt;s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="4957"><td class="num" id="LN4957">4957</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4958"><td class="num" id="LN4958">4958</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4959"><td class="num" id="LN4959">4959</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4960"><td class="num" id="LN4960">4960</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__png_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="4961"><td class="num" id="LN4961">4961</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4962"><td class="num" id="LN4962">4962</td><td class="line">   stbi__png p;</td></tr>
<tr class="codeline" data-linenumber="4963"><td class="num" id="LN4963">4963</td><td class="line">   p.s = s;</td></tr>
<tr class="codeline" data-linenumber="4964"><td class="num" id="LN4964">4964</td><td class="line">   <span class='keyword'>return</span> stbi__png_info_raw(&amp;p, x, y, comp);</td></tr>
<tr class="codeline" data-linenumber="4965"><td class="num" id="LN4965">4965</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4966"><td class="num" id="LN4966">4966</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4967"><td class="num" id="LN4967">4967</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__png_is16(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="4968"><td class="num" id="LN4968">4968</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4969"><td class="num" id="LN4969">4969</td><td class="line">   stbi__png p;</td></tr>
<tr class="codeline" data-linenumber="4970"><td class="num" id="LN4970">4970</td><td class="line">   p.s = s;</td></tr>
<tr class="codeline" data-linenumber="4971"><td class="num" id="LN4971">4971</td><td class="line">   <span class='keyword'>if</span> (!stbi__png_info_raw(&amp;p, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4972"><td class="num" id="LN4972">4972</td><td class="line">	   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4973"><td class="num" id="LN4973">4973</td><td class="line">   <span class='keyword'>if</span> (p.depth != 16) {</td></tr>
<tr class="codeline" data-linenumber="4974"><td class="num" id="LN4974">4974</td><td class="line">      stbi__rewind(p.s);</td></tr>
<tr class="codeline" data-linenumber="4975"><td class="num" id="LN4975">4975</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4976"><td class="num" id="LN4976">4976</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="4977"><td class="num" id="LN4977">4977</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="4978"><td class="num" id="LN4978">4978</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4979"><td class="num" id="LN4979">4979</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4980"><td class="num" id="LN4980">4980</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4981"><td class="num" id="LN4981">4981</td><td class="line"><span class='comment'>// Microsoft/Windows BMP image</span></td></tr>
<tr class="codeline" data-linenumber="4982"><td class="num" id="LN4982">4982</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4983"><td class="num" id="LN4983">4983</td><td class="line"><span class='directive'>#ifndef STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="4984"><td class="num" id="LN4984">4984</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__bmp_test_raw(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="4985"><td class="num" id="LN4985">4985</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4986"><td class="num" id="LN4986">4986</td><td class="line">   <span class='keyword'>int</span> r;</td></tr>
<tr class="codeline" data-linenumber="4987"><td class="num" id="LN4987">4987</td><td class="line">   <span class='keyword'>int</span> sz;</td></tr>
<tr class="codeline" data-linenumber="4988"><td class="num" id="LN4988">4988</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'B') <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4989"><td class="num" id="LN4989">4989</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'M') <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4990"><td class="num" id="LN4990">4990</td><td class="line">   stbi__get32le(s); <span class='comment'>// discard filesize</span></td></tr>
<tr class="codeline" data-linenumber="4991"><td class="num" id="LN4991">4991</td><td class="line">   stbi__get16le(s); <span class='comment'>// discard reserved</span></td></tr>
<tr class="codeline" data-linenumber="4992"><td class="num" id="LN4992">4992</td><td class="line">   stbi__get16le(s); <span class='comment'>// discard reserved</span></td></tr>
<tr class="codeline" data-linenumber="4993"><td class="num" id="LN4993">4993</td><td class="line">   stbi__get32le(s); <span class='comment'>// discard data offset</span></td></tr>
<tr class="codeline" data-linenumber="4994"><td class="num" id="LN4994">4994</td><td class="line">   sz = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="4995"><td class="num" id="LN4995">4995</td><td class="line">   r = (sz == 12 || sz == 40 || sz == 56 || sz == 108 || sz == 124);</td></tr>
<tr class="codeline" data-linenumber="4996"><td class="num" id="LN4996">4996</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="4997"><td class="num" id="LN4997">4997</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4998"><td class="num" id="LN4998">4998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4999"><td class="num" id="LN4999">4999</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__bmp_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="5000"><td class="num" id="LN5000">5000</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5001"><td class="num" id="LN5001">5001</td><td class="line">   <span class='keyword'>int</span> r = stbi__bmp_test_raw(s);</td></tr>
<tr class="codeline" data-linenumber="5002"><td class="num" id="LN5002">5002</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5003"><td class="num" id="LN5003">5003</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="5004"><td class="num" id="LN5004">5004</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5005"><td class="num" id="LN5005">5005</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5006"><td class="num" id="LN5006">5006</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5007"><td class="num" id="LN5007">5007</td><td class="line"><span class='comment'>// returns 0..31 for the highest set bit</span></td></tr>
<tr class="codeline" data-linenumber="5008"><td class="num" id="LN5008">5008</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__high_bit(<span class='keyword'>unsigned</span> <span class='keyword'>int</span> z)</td></tr>
<tr class="codeline" data-linenumber="5009"><td class="num" id="LN5009">5009</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5010"><td class="num" id="LN5010">5010</td><td class="line">   <span class='keyword'>int</span> n=0;</td></tr>
<tr class="codeline" data-linenumber="5011"><td class="num" id="LN5011">5011</td><td class="line">   <span class='keyword'>if</span> (z == 0) <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="5012"><td class="num" id="LN5012">5012</td><td class="line">   <span class='keyword'>if</span> (z &gt;= 0x10000) n += 16, z &gt;&gt;= 16;</td></tr>
<tr class="codeline" data-linenumber="5013"><td class="num" id="LN5013">5013</td><td class="line">   <span class='keyword'>if</span> (z &gt;= 0x00100) n +=  8, z &gt;&gt;=  8;</td></tr>
<tr class="codeline" data-linenumber="5014"><td class="num" id="LN5014">5014</td><td class="line">   <span class='keyword'>if</span> (z &gt;= 0x00010) n +=  4, z &gt;&gt;=  4;</td></tr>
<tr class="codeline" data-linenumber="5015"><td class="num" id="LN5015">5015</td><td class="line">   <span class='keyword'>if</span> (z &gt;= 0x00004) n +=  2, z &gt;&gt;=  2;</td></tr>
<tr class="codeline" data-linenumber="5016"><td class="num" id="LN5016">5016</td><td class="line">   <span class='keyword'>if</span> (z &gt;= 0x00002) n +=  1, z &gt;&gt;=  1;</td></tr>
<tr class="codeline" data-linenumber="5017"><td class="num" id="LN5017">5017</td><td class="line">   <span class='keyword'>return</span> n;</td></tr>
<tr class="codeline" data-linenumber="5018"><td class="num" id="LN5018">5018</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5019"><td class="num" id="LN5019">5019</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5020"><td class="num" id="LN5020">5020</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__bitcount(<span class='keyword'>unsigned</span> <span class='keyword'>int</span> a)</td></tr>
<tr class="codeline" data-linenumber="5021"><td class="num" id="LN5021">5021</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5022"><td class="num" id="LN5022">5022</td><td class="line">   a = (a &amp; 0x55555555) + ((a &gt;&gt;  1) &amp; 0x55555555); <span class='comment'>// max 2</span></td></tr>
<tr class="codeline" data-linenumber="5023"><td class="num" id="LN5023">5023</td><td class="line">   a = (a &amp; 0x33333333) + ((a &gt;&gt;  2) &amp; 0x33333333); <span class='comment'>// max 4</span></td></tr>
<tr class="codeline" data-linenumber="5024"><td class="num" id="LN5024">5024</td><td class="line">   a = (a + (a &gt;&gt; 4)) &amp; 0x0f0f0f0f; <span class='comment'>// max 8 per 4, now 8 bits</span></td></tr>
<tr class="codeline" data-linenumber="5025"><td class="num" id="LN5025">5025</td><td class="line">   a = (a + (a &gt;&gt; 8)); <span class='comment'>// max 16 per 8 bits</span></td></tr>
<tr class="codeline" data-linenumber="5026"><td class="num" id="LN5026">5026</td><td class="line">   a = (a + (a &gt;&gt; 16)); <span class='comment'>// max 32 per 8 bits</span></td></tr>
<tr class="codeline" data-linenumber="5027"><td class="num" id="LN5027">5027</td><td class="line">   <span class='keyword'>return</span> a &amp; 0xff;</td></tr>
<tr class="codeline" data-linenumber="5028"><td class="num" id="LN5028">5028</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5029"><td class="num" id="LN5029">5029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5030"><td class="num" id="LN5030">5030</td><td class="line"><span class='comment'>// extract an arbitrarily-aligned N-bit value (N=bits)</span></td></tr>
<tr class="codeline" data-linenumber="5031"><td class="num" id="LN5031">5031</td><td class="line"><span class='comment'>// from v, and then make it 8-bits long and fractionally</span></td></tr>
<tr class="codeline" data-linenumber="5032"><td class="num" id="LN5032">5032</td><td class="line"><span class='comment'>// extend it to full full range.</span></td></tr>
<tr class="codeline" data-linenumber="5033"><td class="num" id="LN5033">5033</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__shiftsigned(<span class='keyword'>int</span> v, <span class='keyword'>int</span> shift, <span class='keyword'>int</span> bits)</td></tr>
<tr class="codeline" data-linenumber="5034"><td class="num" id="LN5034">5034</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5035"><td class="num" id="LN5035">5035</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> mul_table[9] = {</td></tr>
<tr class="codeline" data-linenumber="5036"><td class="num" id="LN5036">5036</td><td class="line">      0,</td></tr>
<tr class="codeline" data-linenumber="5037"><td class="num" id="LN5037">5037</td><td class="line">      0xff<span class='comment'>/*0b11111111*/</span>, 0x55<span class='comment'>/*0b01010101*/</span>, 0x49<span class='comment'>/*0b01001001*/</span>, 0x11<span class='comment'>/*0b00010001*/</span>,</td></tr>
<tr class="codeline" data-linenumber="5038"><td class="num" id="LN5038">5038</td><td class="line">      0x21<span class='comment'>/*0b00100001*/</span>, 0x41<span class='comment'>/*0b01000001*/</span>, 0x81<span class='comment'>/*0b10000001*/</span>, 0x01<span class='comment'>/*0b00000001*/</span>,</td></tr>
<tr class="codeline" data-linenumber="5039"><td class="num" id="LN5039">5039</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="5040"><td class="num" id="LN5040">5040</td><td class="line">   <span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> shift_table[9] = {</td></tr>
<tr class="codeline" data-linenumber="5041"><td class="num" id="LN5041">5041</td><td class="line">      0, 0,0,1,0,2,4,6,0,</td></tr>
<tr class="codeline" data-linenumber="5042"><td class="num" id="LN5042">5042</td><td class="line">   };</td></tr>
<tr class="codeline" data-linenumber="5043"><td class="num" id="LN5043">5043</td><td class="line">   <span class='keyword'>if</span> (shift &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="5044"><td class="num" id="LN5044">5044</td><td class="line">      v &lt;&lt;= -shift;</td></tr>
<tr class="codeline" data-linenumber="5045"><td class="num" id="LN5045">5045</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="5046"><td class="num" id="LN5046">5046</td><td class="line">      v &gt;&gt;= shift;</td></tr>
<tr class="codeline" data-linenumber="5047"><td class="num" id="LN5047">5047</td><td class="line">   <span class='macro'>STBI_ASSERT(v &gt;= 0 &amp;&amp; v &lt; 256)<span class='macro_popup'>((void) sizeof ((v &gt;= 0 &amp;&amp; v &lt; 256) ? 1 : 0), __extension__<br> ({ if (v &gt;= 0 &amp;&amp; v &lt; 256) ; else __assert_fail<br> ("v &gt;= 0 &amp;&amp; v &lt; 256", "src/stb_image.h", 5047,<br> __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5048"><td class="num" id="LN5048">5048</td><td class="line">   v &gt;&gt;= (8-bits);</td></tr>
<tr class="codeline" data-linenumber="5049"><td class="num" id="LN5049">5049</td><td class="line">   <span class='macro'>STBI_ASSERT(bits &gt;= 0 &amp;&amp; bits &lt;= 8)<span class='macro_popup'>((void) sizeof ((bits &gt;= 0 &amp;&amp; bits &lt;= 8) ? 1 : 0<br>), __extension__ ({ if (bits &gt;= 0 &amp;&amp; bits &lt;= 8)<br> ; else __assert_fail ("bits &gt;= 0 &amp;&amp; bits &lt;= 8"<br>, "src/stb_image.h", 5049, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5050"><td class="num" id="LN5050">5050</td><td class="line">   <span class='keyword'>return</span> (<span class='keyword'>int</span>) ((<span class='keyword'>unsigned</span>) v * mul_table[bits]) &gt;&gt; shift_table[bits];</td></tr>
<tr class="codeline" data-linenumber="5051"><td class="num" id="LN5051">5051</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5052"><td class="num" id="LN5052">5052</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5053"><td class="num" id="LN5053">5053</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="5054"><td class="num" id="LN5054">5054</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5055"><td class="num" id="LN5055">5055</td><td class="line">   <span class='keyword'>int</span> bpp, offset, hsz;</td></tr>
<tr class="codeline" data-linenumber="5056"><td class="num" id="LN5056">5056</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> mr,mg,mb,ma, all_a;</td></tr>
<tr class="codeline" data-linenumber="5057"><td class="num" id="LN5057">5057</td><td class="line">} stbi__bmp_data;</td></tr>
<tr class="codeline" data-linenumber="5058"><td class="num" id="LN5058">5058</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5059"><td class="num" id="LN5059">5059</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__bmp_parse_header(stbi__context *s, stbi__bmp_data *info)</td></tr>
<tr class="codeline" data-linenumber="5060"><td class="num" id="LN5060">5060</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5061"><td class="num" id="LN5061">5061</td><td class="line">   <span class='keyword'>int</span> hsz;</td></tr>
<tr class="codeline" data-linenumber="5062"><td class="num" id="LN5062">5062</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'B' || stbi__get8(s) != 'M') <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"not BMP"</span>, <span class='string_literal'>"Corrupt BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("not BMP")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5063"><td class="num" id="LN5063">5063</td><td class="line">   stbi__get32le(s); <span class='comment'>// discard filesize</span></td></tr>
<tr class="codeline" data-linenumber="5064"><td class="num" id="LN5064">5064</td><td class="line">   stbi__get16le(s); <span class='comment'>// discard reserved</span></td></tr>
<tr class="codeline" data-linenumber="5065"><td class="num" id="LN5065">5065</td><td class="line">   stbi__get16le(s); <span class='comment'>// discard reserved</span></td></tr>
<tr class="codeline" data-linenumber="5066"><td class="num" id="LN5066">5066</td><td class="line">   info-&gt;offset = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5067"><td class="num" id="LN5067">5067</td><td class="line">   info-&gt;hsz = hsz = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5068"><td class="num" id="LN5068">5068</td><td class="line">   info-&gt;mr = info-&gt;mg = info-&gt;mb = info-&gt;ma = 0;</td></tr>
<tr class="codeline" data-linenumber="5069"><td class="num" id="LN5069">5069</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5070"><td class="num" id="LN5070">5070</td><td class="line">   <span class='keyword'>if</span> (hsz != 12 &amp;&amp; hsz != 40 &amp;&amp; hsz != 56 &amp;&amp; hsz != 108 &amp;&amp; hsz != 124) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"unknown BMP"</span>, <span class='string_literal'>"BMP type not supported: unknown"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("unknown BMP")?((void*)<br>0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5071"><td class="num" id="LN5071">5071</td><td class="line">   <span class='keyword'>if</span> (hsz == 12) {</td></tr>
<tr class="codeline" data-linenumber="5072"><td class="num" id="LN5072">5072</td><td class="line">      s-&gt;img_x = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5073"><td class="num" id="LN5073">5073</td><td class="line">      s-&gt;img_y = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5074"><td class="num" id="LN5074">5074</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5075"><td class="num" id="LN5075">5075</td><td class="line">      s-&gt;img_x = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5076"><td class="num" id="LN5076">5076</td><td class="line">      s-&gt;img_y = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5077"><td class="num" id="LN5077">5077</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5078"><td class="num" id="LN5078">5078</td><td class="line">   <span class='keyword'>if</span> (stbi__get16le(s) != 1) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad BMP"</span>, <span class='string_literal'>"bad BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad BMP")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5079"><td class="num" id="LN5079">5079</td><td class="line">   info-&gt;bpp = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5080"><td class="num" id="LN5080">5080</td><td class="line">   <span class='keyword'>if</span> (hsz != 12) {</td></tr>
<tr class="codeline" data-linenumber="5081"><td class="num" id="LN5081">5081</td><td class="line">      <span class='keyword'>int</span> compress = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5082"><td class="num" id="LN5082">5082</td><td class="line">      <span class='keyword'>if</span> (compress == 1 || compress == 2) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"BMP RLE"</span>, <span class='string_literal'>"BMP type not supported: RLE"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("BMP RLE")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5083"><td class="num" id="LN5083">5083</td><td class="line">      stbi__get32le(s); <span class='comment'>// discard sizeof</span></td></tr>
<tr class="codeline" data-linenumber="5084"><td class="num" id="LN5084">5084</td><td class="line">      stbi__get32le(s); <span class='comment'>// discard hres</span></td></tr>
<tr class="codeline" data-linenumber="5085"><td class="num" id="LN5085">5085</td><td class="line">      stbi__get32le(s); <span class='comment'>// discard vres</span></td></tr>
<tr class="codeline" data-linenumber="5086"><td class="num" id="LN5086">5086</td><td class="line">      stbi__get32le(s); <span class='comment'>// discard colorsused</span></td></tr>
<tr class="codeline" data-linenumber="5087"><td class="num" id="LN5087">5087</td><td class="line">      stbi__get32le(s); <span class='comment'>// discard max important</span></td></tr>
<tr class="codeline" data-linenumber="5088"><td class="num" id="LN5088">5088</td><td class="line">      <span class='keyword'>if</span> (hsz == 40 || hsz == 56) {</td></tr>
<tr class="codeline" data-linenumber="5089"><td class="num" id="LN5089">5089</td><td class="line">         <span class='keyword'>if</span> (hsz == 56) {</td></tr>
<tr class="codeline" data-linenumber="5090"><td class="num" id="LN5090">5090</td><td class="line">            stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5091"><td class="num" id="LN5091">5091</td><td class="line">            stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5092"><td class="num" id="LN5092">5092</td><td class="line">            stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5093"><td class="num" id="LN5093">5093</td><td class="line">            stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5094"><td class="num" id="LN5094">5094</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5095"><td class="num" id="LN5095">5095</td><td class="line">         <span class='keyword'>if</span> (info-&gt;bpp == 16 || info-&gt;bpp == 32) {</td></tr>
<tr class="codeline" data-linenumber="5096"><td class="num" id="LN5096">5096</td><td class="line">            <span class='keyword'>if</span> (compress == 0) {</td></tr>
<tr class="codeline" data-linenumber="5097"><td class="num" id="LN5097">5097</td><td class="line">               <span class='keyword'>if</span> (info-&gt;bpp == 32) {</td></tr>
<tr class="codeline" data-linenumber="5098"><td class="num" id="LN5098">5098</td><td class="line">                  info-&gt;mr = 0xffu &lt;&lt; 16;</td></tr>
<tr class="codeline" data-linenumber="5099"><td class="num" id="LN5099">5099</td><td class="line">                  info-&gt;mg = 0xffu &lt;&lt;  8;</td></tr>
<tr class="codeline" data-linenumber="5100"><td class="num" id="LN5100">5100</td><td class="line">                  info-&gt;mb = 0xffu &lt;&lt;  0;</td></tr>
<tr class="codeline" data-linenumber="5101"><td class="num" id="LN5101">5101</td><td class="line">                  info-&gt;ma = 0xffu &lt;&lt; 24;</td></tr>
<tr class="codeline" data-linenumber="5102"><td class="num" id="LN5102">5102</td><td class="line">                  info-&gt;all_a = 0; <span class='comment'>// if all_a is 0 at end, then we loaded alpha channel but it was all 0</span></td></tr>
<tr class="codeline" data-linenumber="5103"><td class="num" id="LN5103">5103</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5104"><td class="num" id="LN5104">5104</td><td class="line">                  info-&gt;mr = 31u &lt;&lt; 10;</td></tr>
<tr class="codeline" data-linenumber="5105"><td class="num" id="LN5105">5105</td><td class="line">                  info-&gt;mg = 31u &lt;&lt;  5;</td></tr>
<tr class="codeline" data-linenumber="5106"><td class="num" id="LN5106">5106</td><td class="line">                  info-&gt;mb = 31u &lt;&lt;  0;</td></tr>
<tr class="codeline" data-linenumber="5107"><td class="num" id="LN5107">5107</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5108"><td class="num" id="LN5108">5108</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (compress == 3) {</td></tr>
<tr class="codeline" data-linenumber="5109"><td class="num" id="LN5109">5109</td><td class="line">               info-&gt;mr = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5110"><td class="num" id="LN5110">5110</td><td class="line">               info-&gt;mg = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5111"><td class="num" id="LN5111">5111</td><td class="line">               info-&gt;mb = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5112"><td class="num" id="LN5112">5112</td><td class="line">               <span class='comment'>// not documented, but generated by photoshop and handled by mspaint</span></td></tr>
<tr class="codeline" data-linenumber="5113"><td class="num" id="LN5113">5113</td><td class="line">               <span class='keyword'>if</span> (info-&gt;mr == info-&gt;mg &amp;&amp; info-&gt;mg == info-&gt;mb) {</td></tr>
<tr class="codeline" data-linenumber="5114"><td class="num" id="LN5114">5114</td><td class="line">                  <span class='comment'>// ?!?!?</span></td></tr>
<tr class="codeline" data-linenumber="5115"><td class="num" id="LN5115">5115</td><td class="line">                  <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad BMP"</span>, <span class='string_literal'>"bad BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad BMP")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5116"><td class="num" id="LN5116">5116</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5117"><td class="num" id="LN5117">5117</td><td class="line">            } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="5118"><td class="num" id="LN5118">5118</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad BMP"</span>, <span class='string_literal'>"bad BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad BMP")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5119"><td class="num" id="LN5119">5119</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5120"><td class="num" id="LN5120">5120</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5121"><td class="num" id="LN5121">5121</td><td class="line">         <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="5122"><td class="num" id="LN5122">5122</td><td class="line">         <span class='keyword'>if</span> (hsz != 108 &amp;&amp; hsz != 124)</td></tr>
<tr class="codeline" data-linenumber="5123"><td class="num" id="LN5123">5123</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad BMP"</span>, <span class='string_literal'>"bad BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad BMP")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5124"><td class="num" id="LN5124">5124</td><td class="line">         info-&gt;mr = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5125"><td class="num" id="LN5125">5125</td><td class="line">         info-&gt;mg = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5126"><td class="num" id="LN5126">5126</td><td class="line">         info-&gt;mb = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5127"><td class="num" id="LN5127">5127</td><td class="line">         info-&gt;ma = stbi__get32le(s);</td></tr>
<tr class="codeline" data-linenumber="5128"><td class="num" id="LN5128">5128</td><td class="line">         stbi__get32le(s); <span class='comment'>// discard color space</span></td></tr>
<tr class="codeline" data-linenumber="5129"><td class="num" id="LN5129">5129</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; 12; ++i)</td></tr>
<tr class="codeline" data-linenumber="5130"><td class="num" id="LN5130">5130</td><td class="line">            stbi__get32le(s); <span class='comment'>// discard color space parameters</span></td></tr>
<tr class="codeline" data-linenumber="5131"><td class="num" id="LN5131">5131</td><td class="line">         <span class='keyword'>if</span> (hsz == 124) {</td></tr>
<tr class="codeline" data-linenumber="5132"><td class="num" id="LN5132">5132</td><td class="line">            stbi__get32le(s); <span class='comment'>// discard rendering intent</span></td></tr>
<tr class="codeline" data-linenumber="5133"><td class="num" id="LN5133">5133</td><td class="line">            stbi__get32le(s); <span class='comment'>// discard offset of profile data</span></td></tr>
<tr class="codeline" data-linenumber="5134"><td class="num" id="LN5134">5134</td><td class="line">            stbi__get32le(s); <span class='comment'>// discard size of profile data</span></td></tr>
<tr class="codeline" data-linenumber="5135"><td class="num" id="LN5135">5135</td><td class="line">            stbi__get32le(s); <span class='comment'>// discard reserved</span></td></tr>
<tr class="codeline" data-linenumber="5136"><td class="num" id="LN5136">5136</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5137"><td class="num" id="LN5137">5137</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5138"><td class="num" id="LN5138">5138</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5139"><td class="num" id="LN5139">5139</td><td class="line">   <span class='keyword'>return</span> (<span class='keyword'>void</span> *) 1;</td></tr>
<tr class="codeline" data-linenumber="5140"><td class="num" id="LN5140">5140</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5141"><td class="num" id="LN5141">5141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5142"><td class="num" id="LN5142">5142</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5143"><td class="num" id="LN5143">5143</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__bmp_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="5144"><td class="num" id="LN5144">5144</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5145"><td class="num" id="LN5145">5145</td><td class="line">   stbi_uc *out;</td></tr>
<tr class="codeline" data-linenumber="5146"><td class="num" id="LN5146">5146</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>int</span> mr=0,mg=0,mb=0,ma=0, all_a;</td></tr>
<tr class="codeline" data-linenumber="5147"><td class="num" id="LN5147">5147</td><td class="line">   stbi_uc pal[256][4];</td></tr>
<tr class="codeline" data-linenumber="5148"><td class="num" id="LN5148">5148</td><td class="line">   <span class='keyword'>int</span> psize=0,i,j,width;</td></tr>
<tr class="codeline" data-linenumber="5149"><td class="num" id="LN5149">5149</td><td class="line">   <span class='keyword'>int</span> flip_vertically, pad, target;</td></tr>
<tr class="codeline" data-linenumber="5150"><td class="num" id="LN5150">5150</td><td class="line">   stbi__bmp_data info;</td></tr>
<tr class="codeline" data-linenumber="5151"><td class="num" id="LN5151">5151</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5152"><td class="num" id="LN5152">5152</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5153"><td class="num" id="LN5153">5153</td><td class="line">   info.all_a = 255;</td></tr>
<tr class="codeline" data-linenumber="5154"><td class="num" id="LN5154">5154</td><td class="line">   <span class='keyword'>if</span> (stbi__bmp_parse_header(s, &amp;info) == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="5155"><td class="num" id="LN5155">5155</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; <span class='comment'>// error code already set</span></td></tr>
<tr class="codeline" data-linenumber="5156"><td class="num" id="LN5156">5156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5157"><td class="num" id="LN5157">5157</td><td class="line">   flip_vertically = ((<span class='keyword'>int</span>) s-&gt;img_y) &gt; 0;</td></tr>
<tr class="codeline" data-linenumber="5158"><td class="num" id="LN5158">5158</td><td class="line">   s-&gt;img_y = abs((<span class='keyword'>int</span>) s-&gt;img_y);</td></tr>
<tr class="codeline" data-linenumber="5159"><td class="num" id="LN5159">5159</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5160"><td class="num" id="LN5160">5160</td><td class="line">   mr = info.mr;</td></tr>
<tr class="codeline" data-linenumber="5161"><td class="num" id="LN5161">5161</td><td class="line">   mg = info.mg;</td></tr>
<tr class="codeline" data-linenumber="5162"><td class="num" id="LN5162">5162</td><td class="line">   mb = info.mb;</td></tr>
<tr class="codeline" data-linenumber="5163"><td class="num" id="LN5163">5163</td><td class="line">   ma = info.ma;</td></tr>
<tr class="codeline" data-linenumber="5164"><td class="num" id="LN5164">5164</td><td class="line">   all_a = info.all_a;</td></tr>
<tr class="codeline" data-linenumber="5165"><td class="num" id="LN5165">5165</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5166"><td class="num" id="LN5166">5166</td><td class="line">   <span class='keyword'>if</span> (info.hsz == 12) {</td></tr>
<tr class="codeline" data-linenumber="5167"><td class="num" id="LN5167">5167</td><td class="line">      <span class='keyword'>if</span> (info.bpp &lt; 24)</td></tr>
<tr class="codeline" data-linenumber="5168"><td class="num" id="LN5168">5168</td><td class="line">         psize = (info.offset - 14 - 24) / 3;</td></tr>
<tr class="codeline" data-linenumber="5169"><td class="num" id="LN5169">5169</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5170"><td class="num" id="LN5170">5170</td><td class="line">      <span class='keyword'>if</span> (info.bpp &lt; 16)</td></tr>
<tr class="codeline" data-linenumber="5171"><td class="num" id="LN5171">5171</td><td class="line">         psize = (info.offset - 14 - info.hsz) &gt;&gt; 2;</td></tr>
<tr class="codeline" data-linenumber="5172"><td class="num" id="LN5172">5172</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5173"><td class="num" id="LN5173">5173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5174"><td class="num" id="LN5174">5174</td><td class="line">   s-&gt;img_n = ma ? 4 : 3;</td></tr>
<tr class="codeline" data-linenumber="5175"><td class="num" id="LN5175">5175</td><td class="line">   <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp &gt;= 3) <span class='comment'>// we can directly decode 3 or 4</span></td></tr>
<tr class="codeline" data-linenumber="5176"><td class="num" id="LN5176">5176</td><td class="line">      target = req_comp;</td></tr>
<tr class="codeline" data-linenumber="5177"><td class="num" id="LN5177">5177</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="5178"><td class="num" id="LN5178">5178</td><td class="line">      target = s-&gt;img_n; <span class='comment'>// if they want monochrome, we'll post-convert</span></td></tr>
<tr class="codeline" data-linenumber="5179"><td class="num" id="LN5179">5179</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5180"><td class="num" id="LN5180">5180</td><td class="line">   <span class='comment'>// sanity-check size</span></td></tr>
<tr class="codeline" data-linenumber="5181"><td class="num" id="LN5181">5181</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(target, s-&gt;img_x, s-&gt;img_y, 0))</td></tr>
<tr class="codeline" data-linenumber="5182"><td class="num" id="LN5182">5182</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"Corrupt BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("too large")?((void*)0)<br>:((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5183"><td class="num" id="LN5183">5183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5184"><td class="num" id="LN5184">5184</td><td class="line">   out = (stbi_uc *) stbi__malloc_mad3(target, s-&gt;img_x, s-&gt;img_y, 0);</td></tr>
<tr class="codeline" data-linenumber="5185"><td class="num" id="LN5185">5185</td><td class="line">   <span class='keyword'>if</span> (!out) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5186"><td class="num" id="LN5186">5186</td><td class="line">   <span class='keyword'>if</span> (info.bpp &lt; 16) {</td></tr>
<tr class="codeline" data-linenumber="5187"><td class="num" id="LN5187">5187</td><td class="line">      <span class='keyword'>int</span> z=0;</td></tr>
<tr class="codeline" data-linenumber="5188"><td class="num" id="LN5188">5188</td><td class="line">      <span class='keyword'>if</span> (psize == 0 || psize &gt; 256) { <span class='macro'>STBI_FREE(out)<span class='macro_popup'>free(out)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"invalid"</span>, <span class='string_literal'>"Corrupt BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("invalid")?((void*)0):(<br>(void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="5189"><td class="num" id="LN5189">5189</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; psize; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5190"><td class="num" id="LN5190">5190</td><td class="line">         pal[i][2] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5191"><td class="num" id="LN5191">5191</td><td class="line">         pal[i][1] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5192"><td class="num" id="LN5192">5192</td><td class="line">         pal[i][0] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5193"><td class="num" id="LN5193">5193</td><td class="line">         <span class='keyword'>if</span> (info.hsz != 12) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5194"><td class="num" id="LN5194">5194</td><td class="line">         pal[i][3] = 255;</td></tr>
<tr class="codeline" data-linenumber="5195"><td class="num" id="LN5195">5195</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5196"><td class="num" id="LN5196">5196</td><td class="line">      stbi__skip(s, info.offset - 14 - info.hsz - psize * (info.hsz == 12 ? 3 : 4));</td></tr>
<tr class="codeline" data-linenumber="5197"><td class="num" id="LN5197">5197</td><td class="line">      <span class='keyword'>if</span> (info.bpp == 1) width = (s-&gt;img_x + 7) &gt;&gt; 3;</td></tr>
<tr class="codeline" data-linenumber="5198"><td class="num" id="LN5198">5198</td><td class="line">      <span class='keyword'>else</span> <span class='keyword'>if</span> (info.bpp == 4) width = (s-&gt;img_x + 1) &gt;&gt; 1;</td></tr>
<tr class="codeline" data-linenumber="5199"><td class="num" id="LN5199">5199</td><td class="line">      <span class='keyword'>else</span> <span class='keyword'>if</span> (info.bpp == 8) width = s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="5200"><td class="num" id="LN5200">5200</td><td class="line">      <span class='keyword'>else</span> { <span class='macro'>STBI_FREE(out)<span class='macro_popup'>free(out)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad bpp"</span>, <span class='string_literal'>"Corrupt BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad bpp")?((void*)0):(<br>(void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="5201"><td class="num" id="LN5201">5201</td><td class="line">      pad = (-width)&amp;3;</td></tr>
<tr class="codeline" data-linenumber="5202"><td class="num" id="LN5202">5202</td><td class="line">      <span class='keyword'>if</span> (info.bpp == 1) {</td></tr>
<tr class="codeline" data-linenumber="5203"><td class="num" id="LN5203">5203</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; (<span class='keyword'>int</span>) s-&gt;img_y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="5204"><td class="num" id="LN5204">5204</td><td class="line">            <span class='keyword'>int</span> bit_offset = 7, v = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5205"><td class="num" id="LN5205">5205</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; (<span class='keyword'>int</span>) s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5206"><td class="num" id="LN5206">5206</td><td class="line">               <span class='keyword'>int</span> color = (v&gt;&gt;bit_offset)&amp;0x1;</td></tr>
<tr class="codeline" data-linenumber="5207"><td class="num" id="LN5207">5207</td><td class="line">               out[z++] = pal[color][0];</td></tr>
<tr class="codeline" data-linenumber="5208"><td class="num" id="LN5208">5208</td><td class="line">               out[z++] = pal[color][1];</td></tr>
<tr class="codeline" data-linenumber="5209"><td class="num" id="LN5209">5209</td><td class="line">               out[z++] = pal[color][2];</td></tr>
<tr class="codeline" data-linenumber="5210"><td class="num" id="LN5210">5210</td><td class="line">               <span class='keyword'>if</span>((--bit_offset) &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="5211"><td class="num" id="LN5211">5211</td><td class="line">                  bit_offset = 7;</td></tr>
<tr class="codeline" data-linenumber="5212"><td class="num" id="LN5212">5212</td><td class="line">                  v = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5213"><td class="num" id="LN5213">5213</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5214"><td class="num" id="LN5214">5214</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5215"><td class="num" id="LN5215">5215</td><td class="line">            stbi__skip(s, pad);</td></tr>
<tr class="codeline" data-linenumber="5216"><td class="num" id="LN5216">5216</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5217"><td class="num" id="LN5217">5217</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5218"><td class="num" id="LN5218">5218</td><td class="line">         <span class='keyword'>for</span> (j=0; j &lt; (<span class='keyword'>int</span>) s-&gt;img_y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="5219"><td class="num" id="LN5219">5219</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; (<span class='keyword'>int</span>) s-&gt;img_x; i += 2) {</td></tr>
<tr class="codeline" data-linenumber="5220"><td class="num" id="LN5220">5220</td><td class="line">               <span class='keyword'>int</span> v=stbi__get8(s),v2=0;</td></tr>
<tr class="codeline" data-linenumber="5221"><td class="num" id="LN5221">5221</td><td class="line">               <span class='keyword'>if</span> (info.bpp == 4) {</td></tr>
<tr class="codeline" data-linenumber="5222"><td class="num" id="LN5222">5222</td><td class="line">                  v2 = v &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="5223"><td class="num" id="LN5223">5223</td><td class="line">                  v &gt;&gt;= 4;</td></tr>
<tr class="codeline" data-linenumber="5224"><td class="num" id="LN5224">5224</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5225"><td class="num" id="LN5225">5225</td><td class="line">               out[z++] = pal[v][0];</td></tr>
<tr class="codeline" data-linenumber="5226"><td class="num" id="LN5226">5226</td><td class="line">               out[z++] = pal[v][1];</td></tr>
<tr class="codeline" data-linenumber="5227"><td class="num" id="LN5227">5227</td><td class="line">               out[z++] = pal[v][2];</td></tr>
<tr class="codeline" data-linenumber="5228"><td class="num" id="LN5228">5228</td><td class="line">               <span class='keyword'>if</span> (target == 4) out[z++] = 255;</td></tr>
<tr class="codeline" data-linenumber="5229"><td class="num" id="LN5229">5229</td><td class="line">               <span class='keyword'>if</span> (i+1 == (<span class='keyword'>int</span>) s-&gt;img_x) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="5230"><td class="num" id="LN5230">5230</td><td class="line">               v = (info.bpp == 8) ? stbi__get8(s) : v2;</td></tr>
<tr class="codeline" data-linenumber="5231"><td class="num" id="LN5231">5231</td><td class="line">               out[z++] = pal[v][0];</td></tr>
<tr class="codeline" data-linenumber="5232"><td class="num" id="LN5232">5232</td><td class="line">               out[z++] = pal[v][1];</td></tr>
<tr class="codeline" data-linenumber="5233"><td class="num" id="LN5233">5233</td><td class="line">               out[z++] = pal[v][2];</td></tr>
<tr class="codeline" data-linenumber="5234"><td class="num" id="LN5234">5234</td><td class="line">               <span class='keyword'>if</span> (target == 4) out[z++] = 255;</td></tr>
<tr class="codeline" data-linenumber="5235"><td class="num" id="LN5235">5235</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5236"><td class="num" id="LN5236">5236</td><td class="line">            stbi__skip(s, pad);</td></tr>
<tr class="codeline" data-linenumber="5237"><td class="num" id="LN5237">5237</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5238"><td class="num" id="LN5238">5238</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5239"><td class="num" id="LN5239">5239</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5240"><td class="num" id="LN5240">5240</td><td class="line">      <span class='keyword'>int</span> rshift=0,gshift=0,bshift=0,ashift=0,rcount=0,gcount=0,bcount=0,acount=0;</td></tr>
<tr class="codeline" data-linenumber="5241"><td class="num" id="LN5241">5241</td><td class="line">      <span class='keyword'>int</span> z = 0;</td></tr>
<tr class="codeline" data-linenumber="5242"><td class="num" id="LN5242">5242</td><td class="line">      <span class='keyword'>int</span> easy=0;</td></tr>
<tr class="codeline" data-linenumber="5243"><td class="num" id="LN5243">5243</td><td class="line">      stbi__skip(s, info.offset - 14 - info.hsz);</td></tr>
<tr class="codeline" data-linenumber="5244"><td class="num" id="LN5244">5244</td><td class="line">      <span class='keyword'>if</span> (info.bpp == 24) width = 3 * s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="5245"><td class="num" id="LN5245">5245</td><td class="line">      <span class='keyword'>else</span> <span class='keyword'>if</span> (info.bpp == 16) width = 2*s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="5246"><td class="num" id="LN5246">5246</td><td class="line">      <span class='keyword'>else</span> <span class='comment'>/* bpp = 32 and pad = 0 */</span> width=0;</td></tr>
<tr class="codeline" data-linenumber="5247"><td class="num" id="LN5247">5247</td><td class="line">      pad = (-width) &amp; 3;</td></tr>
<tr class="codeline" data-linenumber="5248"><td class="num" id="LN5248">5248</td><td class="line">      <span class='keyword'>if</span> (info.bpp == 24) {</td></tr>
<tr class="codeline" data-linenumber="5249"><td class="num" id="LN5249">5249</td><td class="line">         easy = 1;</td></tr>
<tr class="codeline" data-linenumber="5250"><td class="num" id="LN5250">5250</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (info.bpp == 32) {</td></tr>
<tr class="codeline" data-linenumber="5251"><td class="num" id="LN5251">5251</td><td class="line">         <span class='keyword'>if</span> (mb == 0xff &amp;&amp; mg == 0xff00 &amp;&amp; mr == 0x00ff0000 &amp;&amp; ma == 0xff000000)</td></tr>
<tr class="codeline" data-linenumber="5252"><td class="num" id="LN5252">5252</td><td class="line">            easy = 2;</td></tr>
<tr class="codeline" data-linenumber="5253"><td class="num" id="LN5253">5253</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5254"><td class="num" id="LN5254">5254</td><td class="line">      <span class='keyword'>if</span> (!easy) {</td></tr>
<tr class="codeline" data-linenumber="5255"><td class="num" id="LN5255">5255</td><td class="line">         <span class='keyword'>if</span> (!mr || !mg || !mb) { <span class='macro'>STBI_FREE(out)<span class='macro_popup'>free(out)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad masks"</span>, <span class='string_literal'>"Corrupt BMP"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad masks")?((void*)0)<br>:((void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="5256"><td class="num" id="LN5256">5256</td><td class="line">         <span class='comment'>// right shift amt to put high bit in position #7</span></td></tr>
<tr class="codeline" data-linenumber="5257"><td class="num" id="LN5257">5257</td><td class="line">         rshift = stbi__high_bit(mr)-7; rcount = stbi__bitcount(mr);</td></tr>
<tr class="codeline" data-linenumber="5258"><td class="num" id="LN5258">5258</td><td class="line">         gshift = stbi__high_bit(mg)-7; gcount = stbi__bitcount(mg);</td></tr>
<tr class="codeline" data-linenumber="5259"><td class="num" id="LN5259">5259</td><td class="line">         bshift = stbi__high_bit(mb)-7; bcount = stbi__bitcount(mb);</td></tr>
<tr class="codeline" data-linenumber="5260"><td class="num" id="LN5260">5260</td><td class="line">         ashift = stbi__high_bit(ma)-7; acount = stbi__bitcount(ma);</td></tr>
<tr class="codeline" data-linenumber="5261"><td class="num" id="LN5261">5261</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5262"><td class="num" id="LN5262">5262</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; (<span class='keyword'>int</span>) s-&gt;img_y; ++j) {</td></tr>
<tr class="codeline" data-linenumber="5263"><td class="num" id="LN5263">5263</td><td class="line">         <span class='keyword'>if</span> (easy) {</td></tr>
<tr class="codeline" data-linenumber="5264"><td class="num" id="LN5264">5264</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; (<span class='keyword'>int</span>) s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5265"><td class="num" id="LN5265">5265</td><td class="line">               <span class='keyword'>unsigned</span> <span class='keyword'>char</span> a;</td></tr>
<tr class="codeline" data-linenumber="5266"><td class="num" id="LN5266">5266</td><td class="line">               out[z+2] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5267"><td class="num" id="LN5267">5267</td><td class="line">               out[z+1] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5268"><td class="num" id="LN5268">5268</td><td class="line">               out[z+0] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5269"><td class="num" id="LN5269">5269</td><td class="line">               z += 3;</td></tr>
<tr class="codeline" data-linenumber="5270"><td class="num" id="LN5270">5270</td><td class="line">               a = (easy == 2 ? stbi__get8(s) : 255);</td></tr>
<tr class="codeline" data-linenumber="5271"><td class="num" id="LN5271">5271</td><td class="line">               all_a |= a;</td></tr>
<tr class="codeline" data-linenumber="5272"><td class="num" id="LN5272">5272</td><td class="line">               <span class='keyword'>if</span> (target == 4) out[z++] = a;</td></tr>
<tr class="codeline" data-linenumber="5273"><td class="num" id="LN5273">5273</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5274"><td class="num" id="LN5274">5274</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5275"><td class="num" id="LN5275">5275</td><td class="line">            <span class='keyword'>int</span> bpp = info.bpp;</td></tr>
<tr class="codeline" data-linenumber="5276"><td class="num" id="LN5276">5276</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; (<span class='keyword'>int</span>) s-&gt;img_x; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5277"><td class="num" id="LN5277">5277</td><td class="line">               stbi__uint32 v = (bpp == 16 ? (stbi__uint32) stbi__get16le(s) : stbi__get32le(s));</td></tr>
<tr class="codeline" data-linenumber="5278"><td class="num" id="LN5278">5278</td><td class="line">               <span class='keyword'>unsigned</span> <span class='keyword'>int</span> a;</td></tr>
<tr class="codeline" data-linenumber="5279"><td class="num" id="LN5279">5279</td><td class="line">               out[z++] = <span class='macro'>STBI__BYTECAST(stbi__shiftsigned(v &amp; mr, rshift, rcount))<span class='macro_popup'>((stbi_uc) ((stbi__shiftsigned(v &amp; mr, rshift, rcount)) &amp;<br> 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5280"><td class="num" id="LN5280">5280</td><td class="line">               out[z++] = <span class='macro'>STBI__BYTECAST(stbi__shiftsigned(v &amp; mg, gshift, gcount))<span class='macro_popup'>((stbi_uc) ((stbi__shiftsigned(v &amp; mg, gshift, gcount)) &amp;<br> 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5281"><td class="num" id="LN5281">5281</td><td class="line">               out[z++] = <span class='macro'>STBI__BYTECAST(stbi__shiftsigned(v &amp; mb, bshift, bcount))<span class='macro_popup'>((stbi_uc) ((stbi__shiftsigned(v &amp; mb, bshift, bcount)) &amp;<br> 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5282"><td class="num" id="LN5282">5282</td><td class="line">               a = (ma ? stbi__shiftsigned(v &amp; ma, ashift, acount) : 255);</td></tr>
<tr class="codeline" data-linenumber="5283"><td class="num" id="LN5283">5283</td><td class="line">               all_a |= a;</td></tr>
<tr class="codeline" data-linenumber="5284"><td class="num" id="LN5284">5284</td><td class="line">               <span class='keyword'>if</span> (target == 4) out[z++] = <span class='macro'>STBI__BYTECAST(a)<span class='macro_popup'>((stbi_uc) ((a) &amp; 255))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5285"><td class="num" id="LN5285">5285</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5286"><td class="num" id="LN5286">5286</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5287"><td class="num" id="LN5287">5287</td><td class="line">         stbi__skip(s, pad);</td></tr>
<tr class="codeline" data-linenumber="5288"><td class="num" id="LN5288">5288</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5289"><td class="num" id="LN5289">5289</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5290"><td class="num" id="LN5290">5290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5291"><td class="num" id="LN5291">5291</td><td class="line">   <span class='comment'>// if alpha channel is all 0s, replace with all 255s</span></td></tr>
<tr class="codeline" data-linenumber="5292"><td class="num" id="LN5292">5292</td><td class="line">   <span class='keyword'>if</span> (target == 4 &amp;&amp; all_a == 0)</td></tr>
<tr class="codeline" data-linenumber="5293"><td class="num" id="LN5293">5293</td><td class="line">      <span class='keyword'>for</span> (i=4*s-&gt;img_x*s-&gt;img_y-1; i &gt;= 0; i -= 4)</td></tr>
<tr class="codeline" data-linenumber="5294"><td class="num" id="LN5294">5294</td><td class="line">         out[i] = 255;</td></tr>
<tr class="codeline" data-linenumber="5295"><td class="num" id="LN5295">5295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5296"><td class="num" id="LN5296">5296</td><td class="line">   <span class='keyword'>if</span> (flip_vertically) {</td></tr>
<tr class="codeline" data-linenumber="5297"><td class="num" id="LN5297">5297</td><td class="line">      stbi_uc t;</td></tr>
<tr class="codeline" data-linenumber="5298"><td class="num" id="LN5298">5298</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; (<span class='keyword'>int</span>) s-&gt;img_y&gt;&gt;1; ++j) {</td></tr>
<tr class="codeline" data-linenumber="5299"><td class="num" id="LN5299">5299</td><td class="line">         stbi_uc *p1 = out +      j     *s-&gt;img_x*target;</td></tr>
<tr class="codeline" data-linenumber="5300"><td class="num" id="LN5300">5300</td><td class="line">         stbi_uc *p2 = out + (s-&gt;img_y-1-j)*s-&gt;img_x*target;</td></tr>
<tr class="codeline" data-linenumber="5301"><td class="num" id="LN5301">5301</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; (<span class='keyword'>int</span>) s-&gt;img_x*target; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5302"><td class="num" id="LN5302">5302</td><td class="line">            t = p1[i], p1[i] = p2[i], p2[i] = t;</td></tr>
<tr class="codeline" data-linenumber="5303"><td class="num" id="LN5303">5303</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5304"><td class="num" id="LN5304">5304</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5305"><td class="num" id="LN5305">5305</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5306"><td class="num" id="LN5306">5306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5307"><td class="num" id="LN5307">5307</td><td class="line">   <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != target) {</td></tr>
<tr class="codeline" data-linenumber="5308"><td class="num" id="LN5308">5308</td><td class="line">      out = stbi__convert_format(out, target, req_comp, s-&gt;img_x, s-&gt;img_y);</td></tr>
<tr class="codeline" data-linenumber="5309"><td class="num" id="LN5309">5309</td><td class="line">      <span class='keyword'>if</span> (out == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> out; <span class='comment'>// stbi__convert_format frees input on failure</span></td></tr>
<tr class="codeline" data-linenumber="5310"><td class="num" id="LN5310">5310</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5311"><td class="num" id="LN5311">5311</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5312"><td class="num" id="LN5312">5312</td><td class="line">   *x = s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="5313"><td class="num" id="LN5313">5313</td><td class="line">   *y = s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="5314"><td class="num" id="LN5314">5314</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="5315"><td class="num" id="LN5315">5315</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="5316"><td class="num" id="LN5316">5316</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5317"><td class="num" id="LN5317">5317</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="5318"><td class="num" id="LN5318">5318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5319"><td class="num" id="LN5319">5319</td><td class="line"><span class='comment'>// Targa Truevision - TGA</span></td></tr>
<tr class="codeline" data-linenumber="5320"><td class="num" id="LN5320">5320</td><td class="line"><span class='comment'>// by Jonathan Dummer</span></td></tr>
<tr class="codeline" data-linenumber="5321"><td class="num" id="LN5321">5321</td><td class="line"><span class='directive'>#ifndef STBI_NO_TGA</span></td></tr>
<tr class="codeline" data-linenumber="5322"><td class="num" id="LN5322">5322</td><td class="line"><span class='comment'>// returns STBI_rgb or whatever, 0 on error</span></td></tr>
<tr class="codeline" data-linenumber="5323"><td class="num" id="LN5323">5323</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__tga_get_comp(<span class='keyword'>int</span> bits_per_pixel, <span class='keyword'>int</span> is_grey, <span class='keyword'>int</span>* is_rgb16)</td></tr>
<tr class="codeline" data-linenumber="5324"><td class="num" id="LN5324">5324</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5325"><td class="num" id="LN5325">5325</td><td class="line">   <span class='comment'>// only RGB or RGBA (incl. 16bit) or grey allowed</span></td></tr>
<tr class="codeline" data-linenumber="5326"><td class="num" id="LN5326">5326</td><td class="line">   <span class='keyword'>if</span> (is_rgb16) *is_rgb16 = 0;</td></tr>
<tr class="codeline" data-linenumber="5327"><td class="num" id="LN5327">5327</td><td class="line">   <span class='keyword'>switch</span>(bits_per_pixel) {</td></tr>
<tr class="codeline" data-linenumber="5328"><td class="num" id="LN5328">5328</td><td class="line">      <span class='keyword'>case</span> 8:  <span class='keyword'>return</span> STBI_grey;</td></tr>
<tr class="codeline" data-linenumber="5329"><td class="num" id="LN5329">5329</td><td class="line">      <span class='keyword'>case</span> 16: <span class='keyword'>if</span>(is_grey) <span class='keyword'>return</span> STBI_grey_alpha;</td></tr>
<tr class="codeline" data-linenumber="5330"><td class="num" id="LN5330">5330</td><td class="line">               <span class='comment'>// fallthrough</span></td></tr>
<tr class="codeline" data-linenumber="5331"><td class="num" id="LN5331">5331</td><td class="line">      <span class='keyword'>case</span> 15: <span class='keyword'>if</span>(is_rgb16) *is_rgb16 = 1;</td></tr>
<tr class="codeline" data-linenumber="5332"><td class="num" id="LN5332">5332</td><td class="line">               <span class='keyword'>return</span> STBI_rgb;</td></tr>
<tr class="codeline" data-linenumber="5333"><td class="num" id="LN5333">5333</td><td class="line">      <span class='keyword'>case</span> 24: <span class='comment'>// fallthrough</span></td></tr>
<tr class="codeline" data-linenumber="5334"><td class="num" id="LN5334">5334</td><td class="line">      <span class='keyword'>case</span> 32: <span class='keyword'>return</span> bits_per_pixel/8;</td></tr>
<tr class="codeline" data-linenumber="5335"><td class="num" id="LN5335">5335</td><td class="line">      <span class='keyword'>default</span>: <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5336"><td class="num" id="LN5336">5336</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5337"><td class="num" id="LN5337">5337</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5338"><td class="num" id="LN5338">5338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5339"><td class="num" id="LN5339">5339</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__tga_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="5340"><td class="num" id="LN5340">5340</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5341"><td class="num" id="LN5341">5341</td><td class="line">    <span class='keyword'>int</span> tga_w, tga_h, tga_comp, tga_image_type, tga_bits_per_pixel, tga_colormap_bpp;</td></tr>
<tr class="codeline" data-linenumber="5342"><td class="num" id="LN5342">5342</td><td class="line">    <span class='keyword'>int</span> sz, tga_colormap_type;</td></tr>
<tr class="codeline" data-linenumber="5343"><td class="num" id="LN5343">5343</td><td class="line">    stbi__get8(s);                   <span class='comment'>// discard Offset</span></td></tr>
<tr class="codeline" data-linenumber="5344"><td class="num" id="LN5344">5344</td><td class="line">    tga_colormap_type = stbi__get8(s); <span class='comment'>// colormap type</span></td></tr>
<tr class="codeline" data-linenumber="5345"><td class="num" id="LN5345">5345</td><td class="line">    <span class='keyword'>if</span>( tga_colormap_type &gt; 1 ) {</td></tr>
<tr class="codeline" data-linenumber="5346"><td class="num" id="LN5346">5346</td><td class="line">        stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5347"><td class="num" id="LN5347">5347</td><td class="line">        <span class='keyword'>return</span> 0;      <span class='comment'>// only RGB or indexed allowed</span></td></tr>
<tr class="codeline" data-linenumber="5348"><td class="num" id="LN5348">5348</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="5349"><td class="num" id="LN5349">5349</td><td class="line">    tga_image_type = stbi__get8(s); <span class='comment'>// image type</span></td></tr>
<tr class="codeline" data-linenumber="5350"><td class="num" id="LN5350">5350</td><td class="line">    <span class='keyword'>if</span> ( tga_colormap_type == 1 ) { <span class='comment'>// colormapped (paletted) image</span></td></tr>
<tr class="codeline" data-linenumber="5351"><td class="num" id="LN5351">5351</td><td class="line">        <span class='keyword'>if</span> (tga_image_type != 1 &amp;&amp; tga_image_type != 9) {</td></tr>
<tr class="codeline" data-linenumber="5352"><td class="num" id="LN5352">5352</td><td class="line">            stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5353"><td class="num" id="LN5353">5353</td><td class="line">            <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5354"><td class="num" id="LN5354">5354</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="5355"><td class="num" id="LN5355">5355</td><td class="line">        stbi__skip(s,4);       <span class='comment'>// skip index of first colormap entry and number of entries</span></td></tr>
<tr class="codeline" data-linenumber="5356"><td class="num" id="LN5356">5356</td><td class="line">        sz = stbi__get8(s);    <span class='comment'>//   check bits per palette color entry</span></td></tr>
<tr class="codeline" data-linenumber="5357"><td class="num" id="LN5357">5357</td><td class="line">        <span class='keyword'>if</span> ( (sz != 8) &amp;&amp; (sz != 15) &amp;&amp; (sz != 16) &amp;&amp; (sz != 24) &amp;&amp; (sz != 32) ) {</td></tr>
<tr class="codeline" data-linenumber="5358"><td class="num" id="LN5358">5358</td><td class="line">            stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5359"><td class="num" id="LN5359">5359</td><td class="line">            <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5360"><td class="num" id="LN5360">5360</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="5361"><td class="num" id="LN5361">5361</td><td class="line">        stbi__skip(s,4);       <span class='comment'>// skip image x and y origin</span></td></tr>
<tr class="codeline" data-linenumber="5362"><td class="num" id="LN5362">5362</td><td class="line">        tga_colormap_bpp = sz;</td></tr>
<tr class="codeline" data-linenumber="5363"><td class="num" id="LN5363">5363</td><td class="line">    } <span class='keyword'>else</span> { <span class='comment'>// "normal" image w/o colormap - only RGB or grey allowed, +/- RLE</span></td></tr>
<tr class="codeline" data-linenumber="5364"><td class="num" id="LN5364">5364</td><td class="line">        <span class='keyword'>if</span> ( (tga_image_type != 2) &amp;&amp; (tga_image_type != 3) &amp;&amp; (tga_image_type != 10) &amp;&amp; (tga_image_type != 11) ) {</td></tr>
<tr class="codeline" data-linenumber="5365"><td class="num" id="LN5365">5365</td><td class="line">            stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5366"><td class="num" id="LN5366">5366</td><td class="line">            <span class='keyword'>return</span> 0; <span class='comment'>// only RGB or grey allowed, +/- RLE</span></td></tr>
<tr class="codeline" data-linenumber="5367"><td class="num" id="LN5367">5367</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="5368"><td class="num" id="LN5368">5368</td><td class="line">        stbi__skip(s,9); <span class='comment'>// skip colormap specification and image x/y origin</span></td></tr>
<tr class="codeline" data-linenumber="5369"><td class="num" id="LN5369">5369</td><td class="line">        tga_colormap_bpp = 0;</td></tr>
<tr class="codeline" data-linenumber="5370"><td class="num" id="LN5370">5370</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="5371"><td class="num" id="LN5371">5371</td><td class="line">    tga_w = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5372"><td class="num" id="LN5372">5372</td><td class="line">    <span class='keyword'>if</span>( tga_w &lt; 1 ) {</td></tr>
<tr class="codeline" data-linenumber="5373"><td class="num" id="LN5373">5373</td><td class="line">        stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5374"><td class="num" id="LN5374">5374</td><td class="line">        <span class='keyword'>return</span> 0;   <span class='comment'>// test width</span></td></tr>
<tr class="codeline" data-linenumber="5375"><td class="num" id="LN5375">5375</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="5376"><td class="num" id="LN5376">5376</td><td class="line">    tga_h = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5377"><td class="num" id="LN5377">5377</td><td class="line">    <span class='keyword'>if</span>( tga_h &lt; 1 ) {</td></tr>
<tr class="codeline" data-linenumber="5378"><td class="num" id="LN5378">5378</td><td class="line">        stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5379"><td class="num" id="LN5379">5379</td><td class="line">        <span class='keyword'>return</span> 0;   <span class='comment'>// test height</span></td></tr>
<tr class="codeline" data-linenumber="5380"><td class="num" id="LN5380">5380</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="5381"><td class="num" id="LN5381">5381</td><td class="line">    tga_bits_per_pixel = stbi__get8(s); <span class='comment'>// bits per pixel</span></td></tr>
<tr class="codeline" data-linenumber="5382"><td class="num" id="LN5382">5382</td><td class="line">    stbi__get8(s); <span class='comment'>// ignore alpha bits</span></td></tr>
<tr class="codeline" data-linenumber="5383"><td class="num" id="LN5383">5383</td><td class="line">    <span class='keyword'>if</span> (tga_colormap_bpp != 0) {</td></tr>
<tr class="codeline" data-linenumber="5384"><td class="num" id="LN5384">5384</td><td class="line">        <span class='keyword'>if</span>((tga_bits_per_pixel != 8) &amp;&amp; (tga_bits_per_pixel != 16)) {</td></tr>
<tr class="codeline" data-linenumber="5385"><td class="num" id="LN5385">5385</td><td class="line">            <span class='comment'>// when using a colormap, tga_bits_per_pixel is the size of the indexes</span></td></tr>
<tr class="codeline" data-linenumber="5386"><td class="num" id="LN5386">5386</td><td class="line">            <span class='comment'>// I don't think anything but 8 or 16bit indexes makes sense</span></td></tr>
<tr class="codeline" data-linenumber="5387"><td class="num" id="LN5387">5387</td><td class="line">            stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5388"><td class="num" id="LN5388">5388</td><td class="line">            <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5389"><td class="num" id="LN5389">5389</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="5390"><td class="num" id="LN5390">5390</td><td class="line">        tga_comp = stbi__tga_get_comp(tga_colormap_bpp, 0, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="5391"><td class="num" id="LN5391">5391</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5392"><td class="num" id="LN5392">5392</td><td class="line">        tga_comp = stbi__tga_get_comp(tga_bits_per_pixel, (tga_image_type == 3) || (tga_image_type == 11), <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="5393"><td class="num" id="LN5393">5393</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="5394"><td class="num" id="LN5394">5394</td><td class="line">    <span class='keyword'>if</span>(!tga_comp) {</td></tr>
<tr class="codeline" data-linenumber="5395"><td class="num" id="LN5395">5395</td><td class="line">      stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5396"><td class="num" id="LN5396">5396</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5397"><td class="num" id="LN5397">5397</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="5398"><td class="num" id="LN5398">5398</td><td class="line">    <span class='keyword'>if</span> (x) *x = tga_w;</td></tr>
<tr class="codeline" data-linenumber="5399"><td class="num" id="LN5399">5399</td><td class="line">    <span class='keyword'>if</span> (y) *y = tga_h;</td></tr>
<tr class="codeline" data-linenumber="5400"><td class="num" id="LN5400">5400</td><td class="line">    <span class='keyword'>if</span> (comp) *comp = tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5401"><td class="num" id="LN5401">5401</td><td class="line">    <span class='keyword'>return</span> 1;                   <span class='comment'>// seems to have passed everything</span></td></tr>
<tr class="codeline" data-linenumber="5402"><td class="num" id="LN5402">5402</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5403"><td class="num" id="LN5403">5403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5404"><td class="num" id="LN5404">5404</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__tga_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="5405"><td class="num" id="LN5405">5405</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5406"><td class="num" id="LN5406">5406</td><td class="line">   <span class='keyword'>int</span> res = 0;</td></tr>
<tr class="codeline" data-linenumber="5407"><td class="num" id="LN5407">5407</td><td class="line">   <span class='keyword'>int</span> sz, tga_color_type;</td></tr>
<tr class="codeline" data-linenumber="5408"><td class="num" id="LN5408">5408</td><td class="line">   stbi__get8(s);      <span class='comment'>//   discard Offset</span></td></tr>
<tr class="codeline" data-linenumber="5409"><td class="num" id="LN5409">5409</td><td class="line">   tga_color_type = stbi__get8(s);   <span class='comment'>//   color type</span></td></tr>
<tr class="codeline" data-linenumber="5410"><td class="num" id="LN5410">5410</td><td class="line">   <span class='keyword'>if</span> ( tga_color_type &gt; 1 ) <span class='keyword'>goto</span> errorEnd;   <span class='comment'>//   only RGB or indexed allowed</span></td></tr>
<tr class="codeline" data-linenumber="5411"><td class="num" id="LN5411">5411</td><td class="line">   sz = stbi__get8(s);   <span class='comment'>//   image type</span></td></tr>
<tr class="codeline" data-linenumber="5412"><td class="num" id="LN5412">5412</td><td class="line">   <span class='keyword'>if</span> ( tga_color_type == 1 ) { <span class='comment'>// colormapped (paletted) image</span></td></tr>
<tr class="codeline" data-linenumber="5413"><td class="num" id="LN5413">5413</td><td class="line">      <span class='keyword'>if</span> (sz != 1 &amp;&amp; sz != 9) <span class='keyword'>goto</span> errorEnd; <span class='comment'>// colortype 1 demands image type 1 or 9</span></td></tr>
<tr class="codeline" data-linenumber="5414"><td class="num" id="LN5414">5414</td><td class="line">      stbi__skip(s,4);       <span class='comment'>// skip index of first colormap entry and number of entries</span></td></tr>
<tr class="codeline" data-linenumber="5415"><td class="num" id="LN5415">5415</td><td class="line">      sz = stbi__get8(s);    <span class='comment'>//   check bits per palette color entry</span></td></tr>
<tr class="codeline" data-linenumber="5416"><td class="num" id="LN5416">5416</td><td class="line">      <span class='keyword'>if</span> ( (sz != 8) &amp;&amp; (sz != 15) &amp;&amp; (sz != 16) &amp;&amp; (sz != 24) &amp;&amp; (sz != 32) ) <span class='keyword'>goto</span> errorEnd;</td></tr>
<tr class="codeline" data-linenumber="5417"><td class="num" id="LN5417">5417</td><td class="line">      stbi__skip(s,4);       <span class='comment'>// skip image x and y origin</span></td></tr>
<tr class="codeline" data-linenumber="5418"><td class="num" id="LN5418">5418</td><td class="line">   } <span class='keyword'>else</span> { <span class='comment'>// "normal" image w/o colormap</span></td></tr>
<tr class="codeline" data-linenumber="5419"><td class="num" id="LN5419">5419</td><td class="line">      <span class='keyword'>if</span> ( (sz != 2) &amp;&amp; (sz != 3) &amp;&amp; (sz != 10) &amp;&amp; (sz != 11) ) <span class='keyword'>goto</span> errorEnd; <span class='comment'>// only RGB or grey allowed, +/- RLE</span></td></tr>
<tr class="codeline" data-linenumber="5420"><td class="num" id="LN5420">5420</td><td class="line">      stbi__skip(s,9); <span class='comment'>// skip colormap specification and image x/y origin</span></td></tr>
<tr class="codeline" data-linenumber="5421"><td class="num" id="LN5421">5421</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5422"><td class="num" id="LN5422">5422</td><td class="line">   <span class='keyword'>if</span> ( stbi__get16le(s) &lt; 1 ) <span class='keyword'>goto</span> errorEnd;      <span class='comment'>//   test width</span></td></tr>
<tr class="codeline" data-linenumber="5423"><td class="num" id="LN5423">5423</td><td class="line">   <span class='keyword'>if</span> ( stbi__get16le(s) &lt; 1 ) <span class='keyword'>goto</span> errorEnd;      <span class='comment'>//   test height</span></td></tr>
<tr class="codeline" data-linenumber="5424"><td class="num" id="LN5424">5424</td><td class="line">   sz = stbi__get8(s);   <span class='comment'>//   bits per pixel</span></td></tr>
<tr class="codeline" data-linenumber="5425"><td class="num" id="LN5425">5425</td><td class="line">   <span class='keyword'>if</span> ( (tga_color_type == 1) &amp;&amp; (sz != 8) &amp;&amp; (sz != 16) ) <span class='keyword'>goto</span> errorEnd; <span class='comment'>// for colormapped images, bpp is size of an index</span></td></tr>
<tr class="codeline" data-linenumber="5426"><td class="num" id="LN5426">5426</td><td class="line">   <span class='keyword'>if</span> ( (sz != 8) &amp;&amp; (sz != 15) &amp;&amp; (sz != 16) &amp;&amp; (sz != 24) &amp;&amp; (sz != 32) ) <span class='keyword'>goto</span> errorEnd;</td></tr>
<tr class="codeline" data-linenumber="5427"><td class="num" id="LN5427">5427</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5428"><td class="num" id="LN5428">5428</td><td class="line">   res = 1; <span class='comment'>// if we got this far, everything's good and we can return 1 instead of 0</span></td></tr>
<tr class="codeline" data-linenumber="5429"><td class="num" id="LN5429">5429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5430"><td class="num" id="LN5430">5430</td><td class="line">errorEnd:</td></tr>
<tr class="codeline" data-linenumber="5431"><td class="num" id="LN5431">5431</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5432"><td class="num" id="LN5432">5432</td><td class="line">   <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="5433"><td class="num" id="LN5433">5433</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5434"><td class="num" id="LN5434">5434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5435"><td class="num" id="LN5435">5435</td><td class="line"><span class='comment'>// read 16bit value and convert to 24bit RGB</span></td></tr>
<tr class="codeline" data-linenumber="5436"><td class="num" id="LN5436">5436</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__tga_read_rgb16(stbi__context *s, stbi_uc* out)</td></tr>
<tr class="codeline" data-linenumber="5437"><td class="num" id="LN5437">5437</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5438"><td class="num" id="LN5438">5438</td><td class="line">   stbi__uint16 px = (stbi__uint16)stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5439"><td class="num" id="LN5439">5439</td><td class="line">   stbi__uint16 fiveBitMask = 31;</td></tr>
<tr class="codeline" data-linenumber="5440"><td class="num" id="LN5440">5440</td><td class="line">   <span class='comment'>// we have 3 channels with 5bits each</span></td></tr>
<tr class="codeline" data-linenumber="5441"><td class="num" id="LN5441">5441</td><td class="line">   <span class='keyword'>int</span> r = (px &gt;&gt; 10) &amp; fiveBitMask;</td></tr>
<tr class="codeline" data-linenumber="5442"><td class="num" id="LN5442">5442</td><td class="line">   <span class='keyword'>int</span> g = (px &gt;&gt; 5) &amp; fiveBitMask;</td></tr>
<tr class="codeline" data-linenumber="5443"><td class="num" id="LN5443">5443</td><td class="line">   <span class='keyword'>int</span> b = px &amp; fiveBitMask;</td></tr>
<tr class="codeline" data-linenumber="5444"><td class="num" id="LN5444">5444</td><td class="line">   <span class='comment'>// Note that this saves the data in RGB(A) order, so it doesn't need to be swapped later</span></td></tr>
<tr class="codeline" data-linenumber="5445"><td class="num" id="LN5445">5445</td><td class="line">   out[0] = (stbi_uc)((r * 255)/31);</td></tr>
<tr class="codeline" data-linenumber="5446"><td class="num" id="LN5446">5446</td><td class="line">   out[1] = (stbi_uc)((g * 255)/31);</td></tr>
<tr class="codeline" data-linenumber="5447"><td class="num" id="LN5447">5447</td><td class="line">   out[2] = (stbi_uc)((b * 255)/31);</td></tr>
<tr class="codeline" data-linenumber="5448"><td class="num" id="LN5448">5448</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5449"><td class="num" id="LN5449">5449</td><td class="line">   <span class='comment'>// some people claim that the most significant bit might be used for alpha</span></td></tr>
<tr class="codeline" data-linenumber="5450"><td class="num" id="LN5450">5450</td><td class="line">   <span class='comment'>// (possibly if an alpha-bit is set in the "image descriptor byte")</span></td></tr>
<tr class="codeline" data-linenumber="5451"><td class="num" id="LN5451">5451</td><td class="line">   <span class='comment'>// but that only made 16bit test images completely translucent..</span></td></tr>
<tr class="codeline" data-linenumber="5452"><td class="num" id="LN5452">5452</td><td class="line">   <span class='comment'>// so let's treat all 15 and 16bit TGAs as RGB with no alpha.</span></td></tr>
<tr class="codeline" data-linenumber="5453"><td class="num" id="LN5453">5453</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5454"><td class="num" id="LN5454">5454</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5455"><td class="num" id="LN5455">5455</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__tga_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="5456"><td class="num" id="LN5456">5456</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5457"><td class="num" id="LN5457">5457</td><td class="line">   <span class='comment'>//   read in the TGA header stuff</span></td></tr>
<tr class="codeline" data-linenumber="5458"><td class="num" id="LN5458">5458</td><td class="line">   <span class='keyword'>int</span> tga_offset = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5459"><td class="num" id="LN5459">5459</td><td class="line">   <span class='keyword'>int</span> tga_indexed = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5460"><td class="num" id="LN5460">5460</td><td class="line">   <span class='keyword'>int</span> tga_image_type = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5461"><td class="num" id="LN5461">5461</td><td class="line">   <span class='keyword'>int</span> tga_is_RLE = 0;</td></tr>
<tr class="codeline" data-linenumber="5462"><td class="num" id="LN5462">5462</td><td class="line">   <span class='keyword'>int</span> tga_palette_start = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5463"><td class="num" id="LN5463">5463</td><td class="line">   <span class='keyword'>int</span> tga_palette_len = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5464"><td class="num" id="LN5464">5464</td><td class="line">   <span class='keyword'>int</span> tga_palette_bits = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5465"><td class="num" id="LN5465">5465</td><td class="line">   <span class='keyword'>int</span> tga_x_origin = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5466"><td class="num" id="LN5466">5466</td><td class="line">   <span class='keyword'>int</span> tga_y_origin = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5467"><td class="num" id="LN5467">5467</td><td class="line">   <span class='keyword'>int</span> tga_width = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5468"><td class="num" id="LN5468">5468</td><td class="line">   <span class='keyword'>int</span> tga_height = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5469"><td class="num" id="LN5469">5469</td><td class="line">   <span class='keyword'>int</span> tga_bits_per_pixel = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5470"><td class="num" id="LN5470">5470</td><td class="line">   <span class='keyword'>int</span> tga_comp, tga_rgb16=0;</td></tr>
<tr class="codeline" data-linenumber="5471"><td class="num" id="LN5471">5471</td><td class="line">   <span class='keyword'>int</span> tga_inverted = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5472"><td class="num" id="LN5472">5472</td><td class="line">   <span class='comment'>// int tga_alpha_bits = tga_inverted &amp; 15; // the 4 lowest bits - unused (useless?)</span></td></tr>
<tr class="codeline" data-linenumber="5473"><td class="num" id="LN5473">5473</td><td class="line">   <span class='comment'>//   image data</span></td></tr>
<tr class="codeline" data-linenumber="5474"><td class="num" id="LN5474">5474</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *tga_data;</td></tr>
<tr class="codeline" data-linenumber="5475"><td class="num" id="LN5475">5475</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *tga_palette = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5476"><td class="num" id="LN5476">5476</td><td class="line">   <span class='keyword'>int</span> i, j;</td></tr>
<tr class="codeline" data-linenumber="5477"><td class="num" id="LN5477">5477</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> raw_data[4] = {0};</td></tr>
<tr class="codeline" data-linenumber="5478"><td class="num" id="LN5478">5478</td><td class="line">   <span class='keyword'>int</span> RLE_count = 0;</td></tr>
<tr class="codeline" data-linenumber="5479"><td class="num" id="LN5479">5479</td><td class="line">   <span class='keyword'>int</span> RLE_repeating = 0;</td></tr>
<tr class="codeline" data-linenumber="5480"><td class="num" id="LN5480">5480</td><td class="line">   <span class='keyword'>int</span> read_next_pixel = 1;</td></tr>
<tr class="codeline" data-linenumber="5481"><td class="num" id="LN5481">5481</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5482"><td class="num" id="LN5482">5482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5483"><td class="num" id="LN5483">5483</td><td class="line">   <span class='comment'>//   do a tiny bit of precessing</span></td></tr>
<tr class="codeline" data-linenumber="5484"><td class="num" id="LN5484">5484</td><td class="line">   <span class='keyword'>if</span> ( tga_image_type &gt;= 8 )</td></tr>
<tr class="codeline" data-linenumber="5485"><td class="num" id="LN5485">5485</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="5486"><td class="num" id="LN5486">5486</td><td class="line">      tga_image_type -= 8;</td></tr>
<tr class="codeline" data-linenumber="5487"><td class="num" id="LN5487">5487</td><td class="line">      tga_is_RLE = 1;</td></tr>
<tr class="codeline" data-linenumber="5488"><td class="num" id="LN5488">5488</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5489"><td class="num" id="LN5489">5489</td><td class="line">   tga_inverted = 1 - ((tga_inverted &gt;&gt; 5) &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="5490"><td class="num" id="LN5490">5490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5491"><td class="num" id="LN5491">5491</td><td class="line">   <span class='comment'>//   If I'm paletted, then I'll use the number of bits from the palette</span></td></tr>
<tr class="codeline" data-linenumber="5492"><td class="num" id="LN5492">5492</td><td class="line">   <span class='keyword'>if</span> ( tga_indexed ) tga_comp = stbi__tga_get_comp(tga_palette_bits, 0, &amp;tga_rgb16);</td></tr>
<tr class="codeline" data-linenumber="5493"><td class="num" id="LN5493">5493</td><td class="line">   <span class='keyword'>else</span> tga_comp = stbi__tga_get_comp(tga_bits_per_pixel, (tga_image_type == 3), &amp;tga_rgb16);</td></tr>
<tr class="codeline" data-linenumber="5494"><td class="num" id="LN5494">5494</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5495"><td class="num" id="LN5495">5495</td><td class="line">   <span class='keyword'>if</span>(!tga_comp) <span class='comment'>// shouldn't really happen, stbi__tga_test() should have ensured basic consistency</span></td></tr>
<tr class="codeline" data-linenumber="5496"><td class="num" id="LN5496">5496</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad format"</span>, <span class='string_literal'>"Can't find out TGA pixelformat"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad format")?((void*)0<br>):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5497"><td class="num" id="LN5497">5497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5498"><td class="num" id="LN5498">5498</td><td class="line">   <span class='comment'>//   tga info</span></td></tr>
<tr class="codeline" data-linenumber="5499"><td class="num" id="LN5499">5499</td><td class="line">   *x = tga_width;</td></tr>
<tr class="codeline" data-linenumber="5500"><td class="num" id="LN5500">5500</td><td class="line">   *y = tga_height;</td></tr>
<tr class="codeline" data-linenumber="5501"><td class="num" id="LN5501">5501</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5502"><td class="num" id="LN5502">5502</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5503"><td class="num" id="LN5503">5503</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(tga_width, tga_height, tga_comp, 0))</td></tr>
<tr class="codeline" data-linenumber="5504"><td class="num" id="LN5504">5504</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"Corrupt TGA"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("too large")?((void*)0)<br>:((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5505"><td class="num" id="LN5505">5505</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5506"><td class="num" id="LN5506">5506</td><td class="line">   tga_data = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>*)stbi__malloc_mad3(tga_width, tga_height, tga_comp, 0);</td></tr>
<tr class="codeline" data-linenumber="5507"><td class="num" id="LN5507">5507</td><td class="line">   <span class='keyword'>if</span> (!tga_data) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5508"><td class="num" id="LN5508">5508</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5509"><td class="num" id="LN5509">5509</td><td class="line">   <span class='comment'>// skip to the data's starting position (offset usually = 0)</span></td></tr>
<tr class="codeline" data-linenumber="5510"><td class="num" id="LN5510">5510</td><td class="line">   stbi__skip(s, tga_offset );</td></tr>
<tr class="codeline" data-linenumber="5511"><td class="num" id="LN5511">5511</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5512"><td class="num" id="LN5512">5512</td><td class="line">   <span class='keyword'>if</span> ( !tga_indexed &amp;&amp; !tga_is_RLE &amp;&amp; !tga_rgb16 ) {</td></tr>
<tr class="codeline" data-linenumber="5513"><td class="num" id="LN5513">5513</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; tga_height; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5514"><td class="num" id="LN5514">5514</td><td class="line">         <span class='keyword'>int</span> row = tga_inverted ? tga_height -i - 1 : i;</td></tr>
<tr class="codeline" data-linenumber="5515"><td class="num" id="LN5515">5515</td><td class="line">         stbi_uc *tga_row = tga_data + row*tga_width*tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5516"><td class="num" id="LN5516">5516</td><td class="line">         stbi__getn(s, tga_row, tga_width * tga_comp);</td></tr>
<tr class="codeline" data-linenumber="5517"><td class="num" id="LN5517">5517</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5518"><td class="num" id="LN5518">5518</td><td class="line">   } <span class='keyword'>else</span>  {</td></tr>
<tr class="codeline" data-linenumber="5519"><td class="num" id="LN5519">5519</td><td class="line">      <span class='comment'>//   do I need to load a palette?</span></td></tr>
<tr class="codeline" data-linenumber="5520"><td class="num" id="LN5520">5520</td><td class="line">      <span class='keyword'>if</span> ( tga_indexed)</td></tr>
<tr class="codeline" data-linenumber="5521"><td class="num" id="LN5521">5521</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="5522"><td class="num" id="LN5522">5522</td><td class="line">         <span class='comment'>//   any data to skip? (offset usually = 0)</span></td></tr>
<tr class="codeline" data-linenumber="5523"><td class="num" id="LN5523">5523</td><td class="line">         stbi__skip(s, tga_palette_start );</td></tr>
<tr class="codeline" data-linenumber="5524"><td class="num" id="LN5524">5524</td><td class="line">         <span class='comment'>//   load the palette</span></td></tr>
<tr class="codeline" data-linenumber="5525"><td class="num" id="LN5525">5525</td><td class="line">         tga_palette = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>*)stbi__malloc_mad2(tga_palette_len, tga_comp, 0);</td></tr>
<tr class="codeline" data-linenumber="5526"><td class="num" id="LN5526">5526</td><td class="line">         <span class='keyword'>if</span> (!tga_palette) {</td></tr>
<tr class="codeline" data-linenumber="5527"><td class="num" id="LN5527">5527</td><td class="line">            <span class='macro'>STBI_FREE(tga_data)<span class='macro_popup'>free(tga_data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5528"><td class="num" id="LN5528">5528</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5529"><td class="num" id="LN5529">5529</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5530"><td class="num" id="LN5530">5530</td><td class="line">         <span class='keyword'>if</span> (tga_rgb16) {</td></tr>
<tr class="codeline" data-linenumber="5531"><td class="num" id="LN5531">5531</td><td class="line">            stbi_uc *pal_entry = tga_palette;</td></tr>
<tr class="codeline" data-linenumber="5532"><td class="num" id="LN5532">5532</td><td class="line">            <span class='macro'>STBI_ASSERT(tga_comp == STBI_rgb)<span class='macro_popup'>((void) sizeof ((tga_comp == STBI_rgb) ? 1 : 0), __extension__<br> ({ if (tga_comp == STBI_rgb) ; else __assert_fail ("tga_comp == STBI_rgb"<br>, "src/stb_image.h", 5532, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5533"><td class="num" id="LN5533">5533</td><td class="line">            <span class='keyword'>for</span> (i=0; i &lt; tga_palette_len; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5534"><td class="num" id="LN5534">5534</td><td class="line">               stbi__tga_read_rgb16(s, pal_entry);</td></tr>
<tr class="codeline" data-linenumber="5535"><td class="num" id="LN5535">5535</td><td class="line">               pal_entry += tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5536"><td class="num" id="LN5536">5536</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5537"><td class="num" id="LN5537">5537</td><td class="line">         } <span class='keyword'>else</span> <span class='keyword'>if</span> (!stbi__getn(s, tga_palette, tga_palette_len * tga_comp)) {</td></tr>
<tr class="codeline" data-linenumber="5538"><td class="num" id="LN5538">5538</td><td class="line">               <span class='macro'>STBI_FREE(tga_data)<span class='macro_popup'>free(tga_data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5539"><td class="num" id="LN5539">5539</td><td class="line">               <span class='macro'>STBI_FREE(tga_palette)<span class='macro_popup'>free(tga_palette)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5540"><td class="num" id="LN5540">5540</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad palette"</span>, <span class='string_literal'>"Corrupt TGA"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad palette")?((void*)<br>0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5541"><td class="num" id="LN5541">5541</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5542"><td class="num" id="LN5542">5542</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5543"><td class="num" id="LN5543">5543</td><td class="line">      <span class='comment'>//   load the data</span></td></tr>
<tr class="codeline" data-linenumber="5544"><td class="num" id="LN5544">5544</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; tga_width * tga_height; ++i)</td></tr>
<tr class="codeline" data-linenumber="5545"><td class="num" id="LN5545">5545</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="5546"><td class="num" id="LN5546">5546</td><td class="line">         <span class='comment'>//   if I'm in RLE mode, do I need to get a RLE stbi__pngchunk?</span></td></tr>
<tr class="codeline" data-linenumber="5547"><td class="num" id="LN5547">5547</td><td class="line">         <span class='keyword'>if</span> ( tga_is_RLE )</td></tr>
<tr class="codeline" data-linenumber="5548"><td class="num" id="LN5548">5548</td><td class="line">         {</td></tr>
<tr class="codeline" data-linenumber="5549"><td class="num" id="LN5549">5549</td><td class="line">            <span class='keyword'>if</span> ( RLE_count == 0 )</td></tr>
<tr class="codeline" data-linenumber="5550"><td class="num" id="LN5550">5550</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="5551"><td class="num" id="LN5551">5551</td><td class="line">               <span class='comment'>//   yep, get the next byte as a RLE command</span></td></tr>
<tr class="codeline" data-linenumber="5552"><td class="num" id="LN5552">5552</td><td class="line">               <span class='keyword'>int</span> RLE_cmd = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5553"><td class="num" id="LN5553">5553</td><td class="line">               RLE_count = 1 + (RLE_cmd &amp; 127);</td></tr>
<tr class="codeline" data-linenumber="5554"><td class="num" id="LN5554">5554</td><td class="line">               RLE_repeating = RLE_cmd &gt;&gt; 7;</td></tr>
<tr class="codeline" data-linenumber="5555"><td class="num" id="LN5555">5555</td><td class="line">               read_next_pixel = 1;</td></tr>
<tr class="codeline" data-linenumber="5556"><td class="num" id="LN5556">5556</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> ( !RLE_repeating )</td></tr>
<tr class="codeline" data-linenumber="5557"><td class="num" id="LN5557">5557</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="5558"><td class="num" id="LN5558">5558</td><td class="line">               read_next_pixel = 1;</td></tr>
<tr class="codeline" data-linenumber="5559"><td class="num" id="LN5559">5559</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5560"><td class="num" id="LN5560">5560</td><td class="line">         } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="5561"><td class="num" id="LN5561">5561</td><td class="line">         {</td></tr>
<tr class="codeline" data-linenumber="5562"><td class="num" id="LN5562">5562</td><td class="line">            read_next_pixel = 1;</td></tr>
<tr class="codeline" data-linenumber="5563"><td class="num" id="LN5563">5563</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5564"><td class="num" id="LN5564">5564</td><td class="line">         <span class='comment'>//   OK, if I need to read a pixel, do it now</span></td></tr>
<tr class="codeline" data-linenumber="5565"><td class="num" id="LN5565">5565</td><td class="line">         <span class='keyword'>if</span> ( read_next_pixel )</td></tr>
<tr class="codeline" data-linenumber="5566"><td class="num" id="LN5566">5566</td><td class="line">         {</td></tr>
<tr class="codeline" data-linenumber="5567"><td class="num" id="LN5567">5567</td><td class="line">            <span class='comment'>//   load however much data we did have</span></td></tr>
<tr class="codeline" data-linenumber="5568"><td class="num" id="LN5568">5568</td><td class="line">            <span class='keyword'>if</span> ( tga_indexed )</td></tr>
<tr class="codeline" data-linenumber="5569"><td class="num" id="LN5569">5569</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="5570"><td class="num" id="LN5570">5570</td><td class="line">               <span class='comment'>// read in index, then perform the lookup</span></td></tr>
<tr class="codeline" data-linenumber="5571"><td class="num" id="LN5571">5571</td><td class="line">               <span class='keyword'>int</span> pal_idx = (tga_bits_per_pixel == 8) ? stbi__get8(s) : stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="5572"><td class="num" id="LN5572">5572</td><td class="line">               <span class='keyword'>if</span> ( pal_idx &gt;= tga_palette_len ) {</td></tr>
<tr class="codeline" data-linenumber="5573"><td class="num" id="LN5573">5573</td><td class="line">                  <span class='comment'>// invalid index</span></td></tr>
<tr class="codeline" data-linenumber="5574"><td class="num" id="LN5574">5574</td><td class="line">                  pal_idx = 0;</td></tr>
<tr class="codeline" data-linenumber="5575"><td class="num" id="LN5575">5575</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5576"><td class="num" id="LN5576">5576</td><td class="line">               pal_idx *= tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5577"><td class="num" id="LN5577">5577</td><td class="line">               <span class='keyword'>for</span> (j = 0; j &lt; tga_comp; ++j) {</td></tr>
<tr class="codeline" data-linenumber="5578"><td class="num" id="LN5578">5578</td><td class="line">                  raw_data[j] = tga_palette[pal_idx+j];</td></tr>
<tr class="codeline" data-linenumber="5579"><td class="num" id="LN5579">5579</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5580"><td class="num" id="LN5580">5580</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span>(tga_rgb16) {</td></tr>
<tr class="codeline" data-linenumber="5581"><td class="num" id="LN5581">5581</td><td class="line">               <span class='macro'>STBI_ASSERT(tga_comp == STBI_rgb)<span class='macro_popup'>((void) sizeof ((tga_comp == STBI_rgb) ? 1 : 0), __extension__<br> ({ if (tga_comp == STBI_rgb) ; else __assert_fail ("tga_comp == STBI_rgb"<br>, "src/stb_image.h", 5581, __extension__ __PRETTY_FUNCTION__)<br>; }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5582"><td class="num" id="LN5582">5582</td><td class="line">               stbi__tga_read_rgb16(s, raw_data);</td></tr>
<tr class="codeline" data-linenumber="5583"><td class="num" id="LN5583">5583</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5584"><td class="num" id="LN5584">5584</td><td class="line">               <span class='comment'>//   read in the data raw</span></td></tr>
<tr class="codeline" data-linenumber="5585"><td class="num" id="LN5585">5585</td><td class="line">               <span class='keyword'>for</span> (j = 0; j &lt; tga_comp; ++j) {</td></tr>
<tr class="codeline" data-linenumber="5586"><td class="num" id="LN5586">5586</td><td class="line">                  raw_data[j] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5587"><td class="num" id="LN5587">5587</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5588"><td class="num" id="LN5588">5588</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5589"><td class="num" id="LN5589">5589</td><td class="line">            <span class='comment'>//   clear the reading flag for the next pixel</span></td></tr>
<tr class="codeline" data-linenumber="5590"><td class="num" id="LN5590">5590</td><td class="line">            read_next_pixel = 0;</td></tr>
<tr class="codeline" data-linenumber="5591"><td class="num" id="LN5591">5591</td><td class="line">         } <span class='comment'>// end of reading a pixel</span></td></tr>
<tr class="codeline" data-linenumber="5592"><td class="num" id="LN5592">5592</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5593"><td class="num" id="LN5593">5593</td><td class="line">         <span class='comment'>// copy data</span></td></tr>
<tr class="codeline" data-linenumber="5594"><td class="num" id="LN5594">5594</td><td class="line">         <span class='keyword'>for</span> (j = 0; j &lt; tga_comp; ++j)</td></tr>
<tr class="codeline" data-linenumber="5595"><td class="num" id="LN5595">5595</td><td class="line">           tga_data[i*tga_comp+j] = raw_data[j];</td></tr>
<tr class="codeline" data-linenumber="5596"><td class="num" id="LN5596">5596</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5597"><td class="num" id="LN5597">5597</td><td class="line">         <span class='comment'>//   in case we're in RLE mode, keep counting down</span></td></tr>
<tr class="codeline" data-linenumber="5598"><td class="num" id="LN5598">5598</td><td class="line">         --RLE_count;</td></tr>
<tr class="codeline" data-linenumber="5599"><td class="num" id="LN5599">5599</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5600"><td class="num" id="LN5600">5600</td><td class="line">      <span class='comment'>//   do I need to invert the image?</span></td></tr>
<tr class="codeline" data-linenumber="5601"><td class="num" id="LN5601">5601</td><td class="line">      <span class='keyword'>if</span> ( tga_inverted )</td></tr>
<tr class="codeline" data-linenumber="5602"><td class="num" id="LN5602">5602</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="5603"><td class="num" id="LN5603">5603</td><td class="line">         <span class='keyword'>for</span> (j = 0; j*2 &lt; tga_height; ++j)</td></tr>
<tr class="codeline" data-linenumber="5604"><td class="num" id="LN5604">5604</td><td class="line">         {</td></tr>
<tr class="codeline" data-linenumber="5605"><td class="num" id="LN5605">5605</td><td class="line">            <span class='keyword'>int</span> index1 = j * tga_width * tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5606"><td class="num" id="LN5606">5606</td><td class="line">            <span class='keyword'>int</span> index2 = (tga_height - 1 - j) * tga_width * tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5607"><td class="num" id="LN5607">5607</td><td class="line">            <span class='keyword'>for</span> (i = tga_width * tga_comp; i &gt; 0; --i)</td></tr>
<tr class="codeline" data-linenumber="5608"><td class="num" id="LN5608">5608</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="5609"><td class="num" id="LN5609">5609</td><td class="line">               <span class='keyword'>unsigned</span> <span class='keyword'>char</span> temp = tga_data[index1];</td></tr>
<tr class="codeline" data-linenumber="5610"><td class="num" id="LN5610">5610</td><td class="line">               tga_data[index1] = tga_data[index2];</td></tr>
<tr class="codeline" data-linenumber="5611"><td class="num" id="LN5611">5611</td><td class="line">               tga_data[index2] = temp;</td></tr>
<tr class="codeline" data-linenumber="5612"><td class="num" id="LN5612">5612</td><td class="line">               ++index1;</td></tr>
<tr class="codeline" data-linenumber="5613"><td class="num" id="LN5613">5613</td><td class="line">               ++index2;</td></tr>
<tr class="codeline" data-linenumber="5614"><td class="num" id="LN5614">5614</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5615"><td class="num" id="LN5615">5615</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5616"><td class="num" id="LN5616">5616</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5617"><td class="num" id="LN5617">5617</td><td class="line">      <span class='comment'>//   clear my palette, if I had one</span></td></tr>
<tr class="codeline" data-linenumber="5618"><td class="num" id="LN5618">5618</td><td class="line">      <span class='keyword'>if</span> ( tga_palette != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="5619"><td class="num" id="LN5619">5619</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="5620"><td class="num" id="LN5620">5620</td><td class="line">         <span class='macro'>STBI_FREE( tga_palette )<span class='macro_popup'>free(tga_palette)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5621"><td class="num" id="LN5621">5621</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5622"><td class="num" id="LN5622">5622</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5623"><td class="num" id="LN5623">5623</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5624"><td class="num" id="LN5624">5624</td><td class="line">   <span class='comment'>// swap RGB - if the source data was RGB16, it already is in the right order</span></td></tr>
<tr class="codeline" data-linenumber="5625"><td class="num" id="LN5625">5625</td><td class="line">   <span class='keyword'>if</span> (tga_comp &gt;= 3 &amp;&amp; !tga_rgb16)</td></tr>
<tr class="codeline" data-linenumber="5626"><td class="num" id="LN5626">5626</td><td class="line">   {</td></tr>
<tr class="codeline" data-linenumber="5627"><td class="num" id="LN5627">5627</td><td class="line">      <span class='keyword'>unsigned</span> <span class='keyword'>char</span>* tga_pixel = tga_data;</td></tr>
<tr class="codeline" data-linenumber="5628"><td class="num" id="LN5628">5628</td><td class="line">      <span class='keyword'>for</span> (i=0; i &lt; tga_width * tga_height; ++i)</td></tr>
<tr class="codeline" data-linenumber="5629"><td class="num" id="LN5629">5629</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="5630"><td class="num" id="LN5630">5630</td><td class="line">         <span class='keyword'>unsigned</span> <span class='keyword'>char</span> temp = tga_pixel[0];</td></tr>
<tr class="codeline" data-linenumber="5631"><td class="num" id="LN5631">5631</td><td class="line">         tga_pixel[0] = tga_pixel[2];</td></tr>
<tr class="codeline" data-linenumber="5632"><td class="num" id="LN5632">5632</td><td class="line">         tga_pixel[2] = temp;</td></tr>
<tr class="codeline" data-linenumber="5633"><td class="num" id="LN5633">5633</td><td class="line">         tga_pixel += tga_comp;</td></tr>
<tr class="codeline" data-linenumber="5634"><td class="num" id="LN5634">5634</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5635"><td class="num" id="LN5635">5635</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5636"><td class="num" id="LN5636">5636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5637"><td class="num" id="LN5637">5637</td><td class="line">   <span class='comment'>// convert to target component count</span></td></tr>
<tr class="codeline" data-linenumber="5638"><td class="num" id="LN5638">5638</td><td class="line">   <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != tga_comp)</td></tr>
<tr class="codeline" data-linenumber="5639"><td class="num" id="LN5639">5639</td><td class="line">      tga_data = stbi__convert_format(tga_data, tga_comp, req_comp, tga_width, tga_height);</td></tr>
<tr class="codeline" data-linenumber="5640"><td class="num" id="LN5640">5640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5641"><td class="num" id="LN5641">5641</td><td class="line">   <span class='comment'>//   the things I do to get rid of an error message, and yet keep</span></td></tr>
<tr class="codeline" data-linenumber="5642"><td class="num" id="LN5642">5642</td><td class="line">   <span class='comment'>//   Microsoft's C compilers happy... [8^(</span></td></tr>
<tr class="codeline" data-linenumber="5643"><td class="num" id="LN5643">5643</td><td class="line">   tga_palette_start = tga_palette_len = tga_palette_bits =</td></tr>
<tr class="codeline" data-linenumber="5644"><td class="num" id="LN5644">5644</td><td class="line">         tga_x_origin = tga_y_origin = 0;</td></tr>
<tr class="codeline" data-linenumber="5645"><td class="num" id="LN5645">5645</td><td class="line">   <span class='comment'>//   OK, done</span></td></tr>
<tr class="codeline" data-linenumber="5646"><td class="num" id="LN5646">5646</td><td class="line">   <span class='keyword'>return</span> tga_data;</td></tr>
<tr class="codeline" data-linenumber="5647"><td class="num" id="LN5647">5647</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5648"><td class="num" id="LN5648">5648</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="5649"><td class="num" id="LN5649">5649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5650"><td class="num" id="LN5650">5650</td><td class="line"><span class='comment'>// *************************************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="5651"><td class="num" id="LN5651">5651</td><td class="line"><span class='comment'>// Photoshop PSD loader -- PD by Thatcher Ulrich, integration by Nicolas Schulz, tweaked by STB</span></td></tr>
<tr class="codeline" data-linenumber="5652"><td class="num" id="LN5652">5652</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5653"><td class="num" id="LN5653">5653</td><td class="line"><span class='directive'>#ifndef STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="5654"><td class="num" id="LN5654">5654</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__psd_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="5655"><td class="num" id="LN5655">5655</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5656"><td class="num" id="LN5656">5656</td><td class="line">   <span class='keyword'>int</span> r = (stbi__get32be(s) == 0x38425053);</td></tr>
<tr class="codeline" data-linenumber="5657"><td class="num" id="LN5657">5657</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="5658"><td class="num" id="LN5658">5658</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="5659"><td class="num" id="LN5659">5659</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5660"><td class="num" id="LN5660">5660</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5661"><td class="num" id="LN5661">5661</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__psd_decode_rle(stbi__context *s, stbi_uc *p, <span class='keyword'>int</span> pixelCount)</td></tr>
<tr class="codeline" data-linenumber="5662"><td class="num" id="LN5662">5662</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5663"><td class="num" id="LN5663">5663</td><td class="line">   <span class='keyword'>int</span> count, nleft, len;</td></tr>
<tr class="codeline" data-linenumber="5664"><td class="num" id="LN5664">5664</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5665"><td class="num" id="LN5665">5665</td><td class="line">   count = 0;</td></tr>
<tr class="codeline" data-linenumber="5666"><td class="num" id="LN5666">5666</td><td class="line">   <span class='keyword'>while</span> ((nleft = pixelCount - count) &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="5667"><td class="num" id="LN5667">5667</td><td class="line">      len = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5668"><td class="num" id="LN5668">5668</td><td class="line">      <span class='keyword'>if</span> (len == 128) {</td></tr>
<tr class="codeline" data-linenumber="5669"><td class="num" id="LN5669">5669</td><td class="line">         <span class='comment'>// No-op.</span></td></tr>
<tr class="codeline" data-linenumber="5670"><td class="num" id="LN5670">5670</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (len &lt; 128) {</td></tr>
<tr class="codeline" data-linenumber="5671"><td class="num" id="LN5671">5671</td><td class="line">         <span class='comment'>// Copy next len+1 bytes literally.</span></td></tr>
<tr class="codeline" data-linenumber="5672"><td class="num" id="LN5672">5672</td><td class="line">         len++;</td></tr>
<tr class="codeline" data-linenumber="5673"><td class="num" id="LN5673">5673</td><td class="line">         <span class='keyword'>if</span> (len &gt; nleft) <span class='keyword'>return</span> 0; <span class='comment'>// corrupt data</span></td></tr>
<tr class="codeline" data-linenumber="5674"><td class="num" id="LN5674">5674</td><td class="line">         count += len;</td></tr>
<tr class="codeline" data-linenumber="5675"><td class="num" id="LN5675">5675</td><td class="line">         <span class='keyword'>while</span> (len) {</td></tr>
<tr class="codeline" data-linenumber="5676"><td class="num" id="LN5676">5676</td><td class="line">            *p = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5677"><td class="num" id="LN5677">5677</td><td class="line">            p += 4;</td></tr>
<tr class="codeline" data-linenumber="5678"><td class="num" id="LN5678">5678</td><td class="line">            len--;</td></tr>
<tr class="codeline" data-linenumber="5679"><td class="num" id="LN5679">5679</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5680"><td class="num" id="LN5680">5680</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (len &gt; 128) {</td></tr>
<tr class="codeline" data-linenumber="5681"><td class="num" id="LN5681">5681</td><td class="line">         stbi_uc   val;</td></tr>
<tr class="codeline" data-linenumber="5682"><td class="num" id="LN5682">5682</td><td class="line">         <span class='comment'>// Next -len+1 bytes in the dest are replicated from next source byte.</span></td></tr>
<tr class="codeline" data-linenumber="5683"><td class="num" id="LN5683">5683</td><td class="line">         <span class='comment'>// (Interpret len as a negative 8-bit int.)</span></td></tr>
<tr class="codeline" data-linenumber="5684"><td class="num" id="LN5684">5684</td><td class="line">         len = 257 - len;</td></tr>
<tr class="codeline" data-linenumber="5685"><td class="num" id="LN5685">5685</td><td class="line">         <span class='keyword'>if</span> (len &gt; nleft) <span class='keyword'>return</span> 0; <span class='comment'>// corrupt data</span></td></tr>
<tr class="codeline" data-linenumber="5686"><td class="num" id="LN5686">5686</td><td class="line">         val = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5687"><td class="num" id="LN5687">5687</td><td class="line">         count += len;</td></tr>
<tr class="codeline" data-linenumber="5688"><td class="num" id="LN5688">5688</td><td class="line">         <span class='keyword'>while</span> (len) {</td></tr>
<tr class="codeline" data-linenumber="5689"><td class="num" id="LN5689">5689</td><td class="line">            *p = val;</td></tr>
<tr class="codeline" data-linenumber="5690"><td class="num" id="LN5690">5690</td><td class="line">            p += 4;</td></tr>
<tr class="codeline" data-linenumber="5691"><td class="num" id="LN5691">5691</td><td class="line">            len--;</td></tr>
<tr class="codeline" data-linenumber="5692"><td class="num" id="LN5692">5692</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5693"><td class="num" id="LN5693">5693</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5694"><td class="num" id="LN5694">5694</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5695"><td class="num" id="LN5695">5695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5696"><td class="num" id="LN5696">5696</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="5697"><td class="num" id="LN5697">5697</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5698"><td class="num" id="LN5698">5698</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5699"><td class="num" id="LN5699">5699</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__psd_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri, <span class='keyword'>int</span> bpc)</td></tr>
<tr class="codeline" data-linenumber="5700"><td class="num" id="LN5700">5700</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5701"><td class="num" id="LN5701">5701</td><td class="line">   <span class='keyword'>int</span> pixelCount;</td></tr>
<tr class="codeline" data-linenumber="5702"><td class="num" id="LN5702">5702</td><td class="line">   <span class='keyword'>int</span> channelCount, compression;</td></tr>
<tr class="codeline" data-linenumber="5703"><td class="num" id="LN5703">5703</td><td class="line">   <span class='keyword'>int</span> channel, i;</td></tr>
<tr class="codeline" data-linenumber="5704"><td class="num" id="LN5704">5704</td><td class="line">   <span class='keyword'>int</span> bitdepth;</td></tr>
<tr class="codeline" data-linenumber="5705"><td class="num" id="LN5705">5705</td><td class="line">   <span class='keyword'>int</span> w,h;</td></tr>
<tr class="codeline" data-linenumber="5706"><td class="num" id="LN5706">5706</td><td class="line">   stbi_uc *out;</td></tr>
<tr class="codeline" data-linenumber="5707"><td class="num" id="LN5707">5707</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5708"><td class="num" id="LN5708">5708</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5709"><td class="num" id="LN5709">5709</td><td class="line">   <span class='comment'>// Check identifier</span></td></tr>
<tr class="codeline" data-linenumber="5710"><td class="num" id="LN5710">5710</td><td class="line">   <span class='keyword'>if</span> (stbi__get32be(s) != 0x38425053)   <span class='comment'>// "8BPS"</span></td></tr>
<tr class="codeline" data-linenumber="5711"><td class="num" id="LN5711">5711</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"not PSD"</span>, <span class='string_literal'>"Corrupt PSD image"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("not PSD")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5712"><td class="num" id="LN5712">5712</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5713"><td class="num" id="LN5713">5713</td><td class="line">   <span class='comment'>// Check file type version.</span></td></tr>
<tr class="codeline" data-linenumber="5714"><td class="num" id="LN5714">5714</td><td class="line">   <span class='keyword'>if</span> (stbi__get16be(s) != 1)</td></tr>
<tr class="codeline" data-linenumber="5715"><td class="num" id="LN5715">5715</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"wrong version"</span>, <span class='string_literal'>"Unsupported version of PSD image"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("wrong version")?((void<br>*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5716"><td class="num" id="LN5716">5716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5717"><td class="num" id="LN5717">5717</td><td class="line">   <span class='comment'>// Skip 6 reserved bytes.</span></td></tr>
<tr class="codeline" data-linenumber="5718"><td class="num" id="LN5718">5718</td><td class="line">   stbi__skip(s, 6 );</td></tr>
<tr class="codeline" data-linenumber="5719"><td class="num" id="LN5719">5719</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5720"><td class="num" id="LN5720">5720</td><td class="line">   <span class='comment'>// Read the number of channels (R, G, B, A, etc).</span></td></tr>
<tr class="codeline" data-linenumber="5721"><td class="num" id="LN5721">5721</td><td class="line">   channelCount = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="5722"><td class="num" id="LN5722">5722</td><td class="line">   <span class='keyword'>if</span> (channelCount &lt; 0 || channelCount &gt; 16)</td></tr>
<tr class="codeline" data-linenumber="5723"><td class="num" id="LN5723">5723</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"wrong channel count"</span>, <span class='string_literal'>"Unsupported number of channels in PSD image"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("wrong channel count")?<br>((void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5724"><td class="num" id="LN5724">5724</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5725"><td class="num" id="LN5725">5725</td><td class="line">   <span class='comment'>// Read the rows and columns of the image.</span></td></tr>
<tr class="codeline" data-linenumber="5726"><td class="num" id="LN5726">5726</td><td class="line">   h = stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="5727"><td class="num" id="LN5727">5727</td><td class="line">   w = stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="5728"><td class="num" id="LN5728">5728</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5729"><td class="num" id="LN5729">5729</td><td class="line">   <span class='comment'>// Make sure the depth is 8 bits.</span></td></tr>
<tr class="codeline" data-linenumber="5730"><td class="num" id="LN5730">5730</td><td class="line">   bitdepth = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="5731"><td class="num" id="LN5731">5731</td><td class="line">   <span class='keyword'>if</span> (bitdepth != 8 &amp;&amp; bitdepth != 16)</td></tr>
<tr class="codeline" data-linenumber="5732"><td class="num" id="LN5732">5732</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"unsupported bit depth"</span>, <span class='string_literal'>"PSD bit depth is not 8 or 16 bit"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("unsupported bit depth"<br>)?((void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5733"><td class="num" id="LN5733">5733</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5734"><td class="num" id="LN5734">5734</td><td class="line">   <span class='comment'>// Make sure the color mode is RGB.</span></td></tr>
<tr class="codeline" data-linenumber="5735"><td class="num" id="LN5735">5735</td><td class="line">   <span class='comment'>// Valid options are:</span></td></tr>
<tr class="codeline" data-linenumber="5736"><td class="num" id="LN5736">5736</td><td class="line">   <span class='comment'>//   0: Bitmap</span></td></tr>
<tr class="codeline" data-linenumber="5737"><td class="num" id="LN5737">5737</td><td class="line">   <span class='comment'>//   1: Grayscale</span></td></tr>
<tr class="codeline" data-linenumber="5738"><td class="num" id="LN5738">5738</td><td class="line">   <span class='comment'>//   2: Indexed color</span></td></tr>
<tr class="codeline" data-linenumber="5739"><td class="num" id="LN5739">5739</td><td class="line">   <span class='comment'>//   3: RGB color</span></td></tr>
<tr class="codeline" data-linenumber="5740"><td class="num" id="LN5740">5740</td><td class="line">   <span class='comment'>//   4: CMYK color</span></td></tr>
<tr class="codeline" data-linenumber="5741"><td class="num" id="LN5741">5741</td><td class="line">   <span class='comment'>//   7: Multichannel</span></td></tr>
<tr class="codeline" data-linenumber="5742"><td class="num" id="LN5742">5742</td><td class="line">   <span class='comment'>//   8: Duotone</span></td></tr>
<tr class="codeline" data-linenumber="5743"><td class="num" id="LN5743">5743</td><td class="line">   <span class='comment'>//   9: Lab color</span></td></tr>
<tr class="codeline" data-linenumber="5744"><td class="num" id="LN5744">5744</td><td class="line">   <span class='keyword'>if</span> (stbi__get16be(s) != 3)</td></tr>
<tr class="codeline" data-linenumber="5745"><td class="num" id="LN5745">5745</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"wrong color format"</span>, <span class='string_literal'>"PSD is not in RGB color format"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("wrong color format")?(<br>(void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5746"><td class="num" id="LN5746">5746</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5747"><td class="num" id="LN5747">5747</td><td class="line">   <span class='comment'>// Skip the Mode Data.  (It's the palette for indexed color; other info for other modes.)</span></td></tr>
<tr class="codeline" data-linenumber="5748"><td class="num" id="LN5748">5748</td><td class="line">   stbi__skip(s,stbi__get32be(s) );</td></tr>
<tr class="codeline" data-linenumber="5749"><td class="num" id="LN5749">5749</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5750"><td class="num" id="LN5750">5750</td><td class="line">   <span class='comment'>// Skip the image resources.  (resolution, pen tool paths, etc)</span></td></tr>
<tr class="codeline" data-linenumber="5751"><td class="num" id="LN5751">5751</td><td class="line">   stbi__skip(s, stbi__get32be(s) );</td></tr>
<tr class="codeline" data-linenumber="5752"><td class="num" id="LN5752">5752</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5753"><td class="num" id="LN5753">5753</td><td class="line">   <span class='comment'>// Skip the reserved data.</span></td></tr>
<tr class="codeline" data-linenumber="5754"><td class="num" id="LN5754">5754</td><td class="line">   stbi__skip(s, stbi__get32be(s) );</td></tr>
<tr class="codeline" data-linenumber="5755"><td class="num" id="LN5755">5755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5756"><td class="num" id="LN5756">5756</td><td class="line">   <span class='comment'>// Find out if the data is compressed.</span></td></tr>
<tr class="codeline" data-linenumber="5757"><td class="num" id="LN5757">5757</td><td class="line">   <span class='comment'>// Known values:</span></td></tr>
<tr class="codeline" data-linenumber="5758"><td class="num" id="LN5758">5758</td><td class="line">   <span class='comment'>//   0: no compression</span></td></tr>
<tr class="codeline" data-linenumber="5759"><td class="num" id="LN5759">5759</td><td class="line">   <span class='comment'>//   1: RLE compressed</span></td></tr>
<tr class="codeline" data-linenumber="5760"><td class="num" id="LN5760">5760</td><td class="line">   compression = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="5761"><td class="num" id="LN5761">5761</td><td class="line">   <span class='keyword'>if</span> (compression &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="5762"><td class="num" id="LN5762">5762</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad compression"</span>, <span class='string_literal'>"PSD has an unknown compression format"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad compression")?((void<br>*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5763"><td class="num" id="LN5763">5763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5764"><td class="num" id="LN5764">5764</td><td class="line">   <span class='comment'>// Check size</span></td></tr>
<tr class="codeline" data-linenumber="5765"><td class="num" id="LN5765">5765</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(4, w, h, 0))</td></tr>
<tr class="codeline" data-linenumber="5766"><td class="num" id="LN5766">5766</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"Corrupt PSD"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("too large")?((void*)0)<br>:((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5767"><td class="num" id="LN5767">5767</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5768"><td class="num" id="LN5768">5768</td><td class="line">   <span class='comment'>// Create the destination image.</span></td></tr>
<tr class="codeline" data-linenumber="5769"><td class="num" id="LN5769">5769</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5770"><td class="num" id="LN5770">5770</td><td class="line">   <span class='keyword'>if</span> (!compression &amp;&amp; bitdepth == 16 &amp;&amp; bpc == 16) {</td></tr>
<tr class="codeline" data-linenumber="5771"><td class="num" id="LN5771">5771</td><td class="line">      out = (stbi_uc *) stbi__malloc_mad3(8, w, h, 0);</td></tr>
<tr class="codeline" data-linenumber="5772"><td class="num" id="LN5772">5772</td><td class="line">      ri-&gt;bits_per_channel = 16;</td></tr>
<tr class="codeline" data-linenumber="5773"><td class="num" id="LN5773">5773</td><td class="line">   } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="5774"><td class="num" id="LN5774">5774</td><td class="line">      out = (stbi_uc *) stbi__malloc(4 * w*h);</td></tr>
<tr class="codeline" data-linenumber="5775"><td class="num" id="LN5775">5775</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5776"><td class="num" id="LN5776">5776</td><td class="line">   <span class='keyword'>if</span> (!out) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5777"><td class="num" id="LN5777">5777</td><td class="line">   pixelCount = w*h;</td></tr>
<tr class="codeline" data-linenumber="5778"><td class="num" id="LN5778">5778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5779"><td class="num" id="LN5779">5779</td><td class="line">   <span class='comment'>// Initialize the data to zero.</span></td></tr>
<tr class="codeline" data-linenumber="5780"><td class="num" id="LN5780">5780</td><td class="line">   <span class='comment'>//memset( out, 0, pixelCount * 4 );</span></td></tr>
<tr class="codeline" data-linenumber="5781"><td class="num" id="LN5781">5781</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5782"><td class="num" id="LN5782">5782</td><td class="line">   <span class='comment'>// Finally, the image data.</span></td></tr>
<tr class="codeline" data-linenumber="5783"><td class="num" id="LN5783">5783</td><td class="line">   <span class='keyword'>if</span> (compression) {</td></tr>
<tr class="codeline" data-linenumber="5784"><td class="num" id="LN5784">5784</td><td class="line">      <span class='comment'>// RLE as used by .PSD and .TIFF</span></td></tr>
<tr class="codeline" data-linenumber="5785"><td class="num" id="LN5785">5785</td><td class="line">      <span class='comment'>// Loop until you get the number of unpacked bytes you are expecting:</span></td></tr>
<tr class="codeline" data-linenumber="5786"><td class="num" id="LN5786">5786</td><td class="line">      <span class='comment'>//     Read the next source byte into n.</span></td></tr>
<tr class="codeline" data-linenumber="5787"><td class="num" id="LN5787">5787</td><td class="line">      <span class='comment'>//     If n is between 0 and 127 inclusive, copy the next n+1 bytes literally.</span></td></tr>
<tr class="codeline" data-linenumber="5788"><td class="num" id="LN5788">5788</td><td class="line">      <span class='comment'>//     Else if n is between -127 and -1 inclusive, copy the next byte -n+1 times.</span></td></tr>
<tr class="codeline" data-linenumber="5789"><td class="num" id="LN5789">5789</td><td class="line">      <span class='comment'>//     Else if n is 128, noop.</span></td></tr>
<tr class="codeline" data-linenumber="5790"><td class="num" id="LN5790">5790</td><td class="line">      <span class='comment'>// Endloop</span></td></tr>
<tr class="codeline" data-linenumber="5791"><td class="num" id="LN5791">5791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5792"><td class="num" id="LN5792">5792</td><td class="line">      <span class='comment'>// The RLE-compressed data is preceeded by a 2-byte data count for each row in the data,</span></td></tr>
<tr class="codeline" data-linenumber="5793"><td class="num" id="LN5793">5793</td><td class="line">      <span class='comment'>// which we're going to just skip.</span></td></tr>
<tr class="codeline" data-linenumber="5794"><td class="num" id="LN5794">5794</td><td class="line">      stbi__skip(s, h * channelCount * 2 );</td></tr>
<tr class="codeline" data-linenumber="5795"><td class="num" id="LN5795">5795</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5796"><td class="num" id="LN5796">5796</td><td class="line">      <span class='comment'>// Read the RLE data by channel.</span></td></tr>
<tr class="codeline" data-linenumber="5797"><td class="num" id="LN5797">5797</td><td class="line">      <span class='keyword'>for</span> (channel = 0; channel &lt; 4; channel++) {</td></tr>
<tr class="codeline" data-linenumber="5798"><td class="num" id="LN5798">5798</td><td class="line">         stbi_uc *p;</td></tr>
<tr class="codeline" data-linenumber="5799"><td class="num" id="LN5799">5799</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5800"><td class="num" id="LN5800">5800</td><td class="line">         p = out+channel;</td></tr>
<tr class="codeline" data-linenumber="5801"><td class="num" id="LN5801">5801</td><td class="line">         <span class='keyword'>if</span> (channel &gt;= channelCount) {</td></tr>
<tr class="codeline" data-linenumber="5802"><td class="num" id="LN5802">5802</td><td class="line">            <span class='comment'>// Fill this channel with default data.</span></td></tr>
<tr class="codeline" data-linenumber="5803"><td class="num" id="LN5803">5803</td><td class="line">            <span class='keyword'>for</span> (i = 0; i &lt; pixelCount; i++, p += 4)</td></tr>
<tr class="codeline" data-linenumber="5804"><td class="num" id="LN5804">5804</td><td class="line">               *p = (channel == 3 ? 255 : 0);</td></tr>
<tr class="codeline" data-linenumber="5805"><td class="num" id="LN5805">5805</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5806"><td class="num" id="LN5806">5806</td><td class="line">            <span class='comment'>// Read the RLE data.</span></td></tr>
<tr class="codeline" data-linenumber="5807"><td class="num" id="LN5807">5807</td><td class="line">            <span class='keyword'>if</span> (!stbi__psd_decode_rle(s, p, pixelCount)) {</td></tr>
<tr class="codeline" data-linenumber="5808"><td class="num" id="LN5808">5808</td><td class="line">               <span class='macro'>STBI_FREE(out)<span class='macro_popup'>free(out)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5809"><td class="num" id="LN5809">5809</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"corrupt"</span>, <span class='string_literal'>"bad RLE data"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("corrupt")?((void*)0):(<br>(void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5810"><td class="num" id="LN5810">5810</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5811"><td class="num" id="LN5811">5811</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5812"><td class="num" id="LN5812">5812</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5813"><td class="num" id="LN5813">5813</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5814"><td class="num" id="LN5814">5814</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5815"><td class="num" id="LN5815">5815</td><td class="line">      <span class='comment'>// We're at the raw image data.  It's each channel in order (Red, Green, Blue, Alpha, ...)</span></td></tr>
<tr class="codeline" data-linenumber="5816"><td class="num" id="LN5816">5816</td><td class="line">      <span class='comment'>// where each channel consists of an 8-bit (or 16-bit) value for each pixel in the image.</span></td></tr>
<tr class="codeline" data-linenumber="5817"><td class="num" id="LN5817">5817</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5818"><td class="num" id="LN5818">5818</td><td class="line">      <span class='comment'>// Read the data by channel.</span></td></tr>
<tr class="codeline" data-linenumber="5819"><td class="num" id="LN5819">5819</td><td class="line">      <span class='keyword'>for</span> (channel = 0; channel &lt; 4; channel++) {</td></tr>
<tr class="codeline" data-linenumber="5820"><td class="num" id="LN5820">5820</td><td class="line">         <span class='keyword'>if</span> (channel &gt;= channelCount) {</td></tr>
<tr class="codeline" data-linenumber="5821"><td class="num" id="LN5821">5821</td><td class="line">            <span class='comment'>// Fill this channel with default data.</span></td></tr>
<tr class="codeline" data-linenumber="5822"><td class="num" id="LN5822">5822</td><td class="line">            <span class='keyword'>if</span> (bitdepth == 16 &amp;&amp; bpc == 16) {</td></tr>
<tr class="codeline" data-linenumber="5823"><td class="num" id="LN5823">5823</td><td class="line">               stbi__uint16 *q = ((stbi__uint16 *) out) + channel;</td></tr>
<tr class="codeline" data-linenumber="5824"><td class="num" id="LN5824">5824</td><td class="line">               stbi__uint16 val = channel == 3 ? 65535 : 0;</td></tr>
<tr class="codeline" data-linenumber="5825"><td class="num" id="LN5825">5825</td><td class="line">               <span class='keyword'>for</span> (i = 0; i &lt; pixelCount; i++, q += 4)</td></tr>
<tr class="codeline" data-linenumber="5826"><td class="num" id="LN5826">5826</td><td class="line">                  *q = val;</td></tr>
<tr class="codeline" data-linenumber="5827"><td class="num" id="LN5827">5827</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5828"><td class="num" id="LN5828">5828</td><td class="line">               stbi_uc *p = out+channel;</td></tr>
<tr class="codeline" data-linenumber="5829"><td class="num" id="LN5829">5829</td><td class="line">               stbi_uc val = channel == 3 ? 255 : 0;</td></tr>
<tr class="codeline" data-linenumber="5830"><td class="num" id="LN5830">5830</td><td class="line">               <span class='keyword'>for</span> (i = 0; i &lt; pixelCount; i++, p += 4)</td></tr>
<tr class="codeline" data-linenumber="5831"><td class="num" id="LN5831">5831</td><td class="line">                  *p = val;</td></tr>
<tr class="codeline" data-linenumber="5832"><td class="num" id="LN5832">5832</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5833"><td class="num" id="LN5833">5833</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5834"><td class="num" id="LN5834">5834</td><td class="line">            <span class='keyword'>if</span> (ri-&gt;bits_per_channel == 16) {    <span class='comment'>// output bpc</span></td></tr>
<tr class="codeline" data-linenumber="5835"><td class="num" id="LN5835">5835</td><td class="line">               stbi__uint16 *q = ((stbi__uint16 *) out) + channel;</td></tr>
<tr class="codeline" data-linenumber="5836"><td class="num" id="LN5836">5836</td><td class="line">               <span class='keyword'>for</span> (i = 0; i &lt; pixelCount; i++, q += 4)</td></tr>
<tr class="codeline" data-linenumber="5837"><td class="num" id="LN5837">5837</td><td class="line">                  *q = (stbi__uint16) stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="5838"><td class="num" id="LN5838">5838</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5839"><td class="num" id="LN5839">5839</td><td class="line">               stbi_uc *p = out+channel;</td></tr>
<tr class="codeline" data-linenumber="5840"><td class="num" id="LN5840">5840</td><td class="line">               <span class='keyword'>if</span> (bitdepth == 16) {  <span class='comment'>// input bpc</span></td></tr>
<tr class="codeline" data-linenumber="5841"><td class="num" id="LN5841">5841</td><td class="line">                  <span class='keyword'>for</span> (i = 0; i &lt; pixelCount; i++, p += 4)</td></tr>
<tr class="codeline" data-linenumber="5842"><td class="num" id="LN5842">5842</td><td class="line">                     *p = (stbi_uc) (stbi__get16be(s) &gt;&gt; 8);</td></tr>
<tr class="codeline" data-linenumber="5843"><td class="num" id="LN5843">5843</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5844"><td class="num" id="LN5844">5844</td><td class="line">                  <span class='keyword'>for</span> (i = 0; i &lt; pixelCount; i++, p += 4)</td></tr>
<tr class="codeline" data-linenumber="5845"><td class="num" id="LN5845">5845</td><td class="line">                     *p = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5846"><td class="num" id="LN5846">5846</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="5847"><td class="num" id="LN5847">5847</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5848"><td class="num" id="LN5848">5848</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5849"><td class="num" id="LN5849">5849</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5850"><td class="num" id="LN5850">5850</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5851"><td class="num" id="LN5851">5851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5852"><td class="num" id="LN5852">5852</td><td class="line">   <span class='comment'>// remove weird white matte from PSD</span></td></tr>
<tr class="codeline" data-linenumber="5853"><td class="num" id="LN5853">5853</td><td class="line">   <span class='keyword'>if</span> (channelCount &gt;= 4) {</td></tr>
<tr class="codeline" data-linenumber="5854"><td class="num" id="LN5854">5854</td><td class="line">      <span class='keyword'>if</span> (ri-&gt;bits_per_channel == 16) {</td></tr>
<tr class="codeline" data-linenumber="5855"><td class="num" id="LN5855">5855</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; w*h; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5856"><td class="num" id="LN5856">5856</td><td class="line">            stbi__uint16 *pixel = (stbi__uint16 *) out + 4*i;</td></tr>
<tr class="codeline" data-linenumber="5857"><td class="num" id="LN5857">5857</td><td class="line">            <span class='keyword'>if</span> (pixel[3] != 0 &amp;&amp; pixel[3] != 65535) {</td></tr>
<tr class="codeline" data-linenumber="5858"><td class="num" id="LN5858">5858</td><td class="line">               <span class='keyword'>float</span> a = pixel[3] / 65535.0f;</td></tr>
<tr class="codeline" data-linenumber="5859"><td class="num" id="LN5859">5859</td><td class="line">               <span class='keyword'>float</span> ra = 1.0f / a;</td></tr>
<tr class="codeline" data-linenumber="5860"><td class="num" id="LN5860">5860</td><td class="line">               <span class='keyword'>float</span> inv_a = 65535.0f * (1 - ra);</td></tr>
<tr class="codeline" data-linenumber="5861"><td class="num" id="LN5861">5861</td><td class="line">               pixel[0] = (stbi__uint16) (pixel[0]*ra + inv_a);</td></tr>
<tr class="codeline" data-linenumber="5862"><td class="num" id="LN5862">5862</td><td class="line">               pixel[1] = (stbi__uint16) (pixel[1]*ra + inv_a);</td></tr>
<tr class="codeline" data-linenumber="5863"><td class="num" id="LN5863">5863</td><td class="line">               pixel[2] = (stbi__uint16) (pixel[2]*ra + inv_a);</td></tr>
<tr class="codeline" data-linenumber="5864"><td class="num" id="LN5864">5864</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5865"><td class="num" id="LN5865">5865</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5866"><td class="num" id="LN5866">5866</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="5867"><td class="num" id="LN5867">5867</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; w*h; ++i) {</td></tr>
<tr class="codeline" data-linenumber="5868"><td class="num" id="LN5868">5868</td><td class="line">            <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pixel = out + 4*i;</td></tr>
<tr class="codeline" data-linenumber="5869"><td class="num" id="LN5869">5869</td><td class="line">            <span class='keyword'>if</span> (pixel[3] != 0 &amp;&amp; pixel[3] != 255) {</td></tr>
<tr class="codeline" data-linenumber="5870"><td class="num" id="LN5870">5870</td><td class="line">               <span class='keyword'>float</span> a = pixel[3] / 255.0f;</td></tr>
<tr class="codeline" data-linenumber="5871"><td class="num" id="LN5871">5871</td><td class="line">               <span class='keyword'>float</span> ra = 1.0f / a;</td></tr>
<tr class="codeline" data-linenumber="5872"><td class="num" id="LN5872">5872</td><td class="line">               <span class='keyword'>float</span> inv_a = 255.0f * (1 - ra);</td></tr>
<tr class="codeline" data-linenumber="5873"><td class="num" id="LN5873">5873</td><td class="line">               pixel[0] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) (pixel[0]*ra + inv_a);</td></tr>
<tr class="codeline" data-linenumber="5874"><td class="num" id="LN5874">5874</td><td class="line">               pixel[1] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) (pixel[1]*ra + inv_a);</td></tr>
<tr class="codeline" data-linenumber="5875"><td class="num" id="LN5875">5875</td><td class="line">               pixel[2] = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span>) (pixel[2]*ra + inv_a);</td></tr>
<tr class="codeline" data-linenumber="5876"><td class="num" id="LN5876">5876</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="5877"><td class="num" id="LN5877">5877</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="5878"><td class="num" id="LN5878">5878</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5879"><td class="num" id="LN5879">5879</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5880"><td class="num" id="LN5880">5880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5881"><td class="num" id="LN5881">5881</td><td class="line">   <span class='comment'>// convert to desired output format</span></td></tr>
<tr class="codeline" data-linenumber="5882"><td class="num" id="LN5882">5882</td><td class="line">   <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != 4) {</td></tr>
<tr class="codeline" data-linenumber="5883"><td class="num" id="LN5883">5883</td><td class="line">      <span class='keyword'>if</span> (ri-&gt;bits_per_channel == 16)</td></tr>
<tr class="codeline" data-linenumber="5884"><td class="num" id="LN5884">5884</td><td class="line">         out = (stbi_uc *) stbi__convert_format16((stbi__uint16 *) out, 4, req_comp, w, h);</td></tr>
<tr class="codeline" data-linenumber="5885"><td class="num" id="LN5885">5885</td><td class="line">      <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="5886"><td class="num" id="LN5886">5886</td><td class="line">         out = stbi__convert_format(out, 4, req_comp, w, h);</td></tr>
<tr class="codeline" data-linenumber="5887"><td class="num" id="LN5887">5887</td><td class="line">      <span class='keyword'>if</span> (out == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> out; <span class='comment'>// stbi__convert_format frees input on failure</span></td></tr>
<tr class="codeline" data-linenumber="5888"><td class="num" id="LN5888">5888</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5889"><td class="num" id="LN5889">5889</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5890"><td class="num" id="LN5890">5890</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = 4;</td></tr>
<tr class="codeline" data-linenumber="5891"><td class="num" id="LN5891">5891</td><td class="line">   *y = h;</td></tr>
<tr class="codeline" data-linenumber="5892"><td class="num" id="LN5892">5892</td><td class="line">   *x = w;</td></tr>
<tr class="codeline" data-linenumber="5893"><td class="num" id="LN5893">5893</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5894"><td class="num" id="LN5894">5894</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="5895"><td class="num" id="LN5895">5895</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5896"><td class="num" id="LN5896">5896</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="5897"><td class="num" id="LN5897">5897</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5898"><td class="num" id="LN5898">5898</td><td class="line"><span class='comment'>// *************************************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="5899"><td class="num" id="LN5899">5899</td><td class="line"><span class='comment'>// Softimage PIC loader</span></td></tr>
<tr class="codeline" data-linenumber="5900"><td class="num" id="LN5900">5900</td><td class="line"><span class='comment'>// by Tom Seddon</span></td></tr>
<tr class="codeline" data-linenumber="5901"><td class="num" id="LN5901">5901</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="5902"><td class="num" id="LN5902">5902</td><td class="line"><span class='comment'>// See http://softimage.wiki.softimage.com/index.php/INFO:_PIC_file_format</span></td></tr>
<tr class="codeline" data-linenumber="5903"><td class="num" id="LN5903">5903</td><td class="line"><span class='comment'>// See http://ozviz.wasp.uwa.edu.au/~pbourke/dataformats/softimagepic/</span></td></tr>
<tr class="codeline" data-linenumber="5904"><td class="num" id="LN5904">5904</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5905"><td class="num" id="LN5905">5905</td><td class="line"><span class='directive'>#ifndef STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="5906"><td class="num" id="LN5906">5906</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__pic_is4(stbi__context *s,<span class='keyword'>const</span> <span class='keyword'>char</span> *str)</td></tr>
<tr class="codeline" data-linenumber="5907"><td class="num" id="LN5907">5907</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5908"><td class="num" id="LN5908">5908</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="5909"><td class="num" id="LN5909">5909</td><td class="line">   <span class='keyword'>for</span> (i=0; i&lt;4; ++i)</td></tr>
<tr class="codeline" data-linenumber="5910"><td class="num" id="LN5910">5910</td><td class="line">      <span class='keyword'>if</span> (stbi__get8(s) != (stbi_uc)str[i])</td></tr>
<tr class="codeline" data-linenumber="5911"><td class="num" id="LN5911">5911</td><td class="line">         <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5912"><td class="num" id="LN5912">5912</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5913"><td class="num" id="LN5913">5913</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="5914"><td class="num" id="LN5914">5914</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5915"><td class="num" id="LN5915">5915</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5916"><td class="num" id="LN5916">5916</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__pic_test_core(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="5917"><td class="num" id="LN5917">5917</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5918"><td class="num" id="LN5918">5918</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="5919"><td class="num" id="LN5919">5919</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5920"><td class="num" id="LN5920">5920</td><td class="line">   <span class='keyword'>if</span> (!stbi__pic_is4(s,<span class='string_literal'>"\x53\x80\xF6\x34"</span>))</td></tr>
<tr class="codeline" data-linenumber="5921"><td class="num" id="LN5921">5921</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5922"><td class="num" id="LN5922">5922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5923"><td class="num" id="LN5923">5923</td><td class="line">   <span class='keyword'>for</span>(i=0;i&lt;84;++i)</td></tr>
<tr class="codeline" data-linenumber="5924"><td class="num" id="LN5924">5924</td><td class="line">      stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5925"><td class="num" id="LN5925">5925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5926"><td class="num" id="LN5926">5926</td><td class="line">   <span class='keyword'>if</span> (!stbi__pic_is4(s,<span class='string_literal'>"PICT"</span>))</td></tr>
<tr class="codeline" data-linenumber="5927"><td class="num" id="LN5927">5927</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="5928"><td class="num" id="LN5928">5928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5929"><td class="num" id="LN5929">5929</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="5930"><td class="num" id="LN5930">5930</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5931"><td class="num" id="LN5931">5931</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5932"><td class="num" id="LN5932">5932</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="5933"><td class="num" id="LN5933">5933</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5934"><td class="num" id="LN5934">5934</td><td class="line">   stbi_uc size,type,channel;</td></tr>
<tr class="codeline" data-linenumber="5935"><td class="num" id="LN5935">5935</td><td class="line">} stbi__pic_packet;</td></tr>
<tr class="codeline" data-linenumber="5936"><td class="num" id="LN5936">5936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5937"><td class="num" id="LN5937">5937</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__readval(stbi__context *s, <span class='keyword'>int</span> channel, stbi_uc *dest)</td></tr>
<tr class="codeline" data-linenumber="5938"><td class="num" id="LN5938">5938</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5939"><td class="num" id="LN5939">5939</td><td class="line">   <span class='keyword'>int</span> mask=0x80, i;</td></tr>
<tr class="codeline" data-linenumber="5940"><td class="num" id="LN5940">5940</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5941"><td class="num" id="LN5941">5941</td><td class="line">   <span class='keyword'>for</span> (i=0; i&lt;4; ++i, mask&gt;&gt;=1) {</td></tr>
<tr class="codeline" data-linenumber="5942"><td class="num" id="LN5942">5942</td><td class="line">      <span class='keyword'>if</span> (channel &amp; mask) {</td></tr>
<tr class="codeline" data-linenumber="5943"><td class="num" id="LN5943">5943</td><td class="line">         <span class='keyword'>if</span> (stbi__at_eof(s)) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"PIC file too short"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5944"><td class="num" id="LN5944">5944</td><td class="line">         dest[i]=stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5945"><td class="num" id="LN5945">5945</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="5946"><td class="num" id="LN5946">5946</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="5947"><td class="num" id="LN5947">5947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5948"><td class="num" id="LN5948">5948</td><td class="line">   <span class='keyword'>return</span> dest;</td></tr>
<tr class="codeline" data-linenumber="5949"><td class="num" id="LN5949">5949</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5950"><td class="num" id="LN5950">5950</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5951"><td class="num" id="LN5951">5951</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__copyval(<span class='keyword'>int</span> channel,stbi_uc *dest,<span class='keyword'>const</span> stbi_uc *src)</td></tr>
<tr class="codeline" data-linenumber="5952"><td class="num" id="LN5952">5952</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5953"><td class="num" id="LN5953">5953</td><td class="line">   <span class='keyword'>int</span> mask=0x80,i;</td></tr>
<tr class="codeline" data-linenumber="5954"><td class="num" id="LN5954">5954</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5955"><td class="num" id="LN5955">5955</td><td class="line">   <span class='keyword'>for</span> (i=0;i&lt;4; ++i, mask&gt;&gt;=1)</td></tr>
<tr class="codeline" data-linenumber="5956"><td class="num" id="LN5956">5956</td><td class="line">      <span class='keyword'>if</span> (channel&amp;mask)</td></tr>
<tr class="codeline" data-linenumber="5957"><td class="num" id="LN5957">5957</td><td class="line">         dest[i]=src[i];</td></tr>
<tr class="codeline" data-linenumber="5958"><td class="num" id="LN5958">5958</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="5959"><td class="num" id="LN5959">5959</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5960"><td class="num" id="LN5960">5960</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__pic_load_core(stbi__context *s,<span class='keyword'>int</span> width,<span class='keyword'>int</span> height,<span class='keyword'>int</span> *comp, stbi_uc *result)</td></tr>
<tr class="codeline" data-linenumber="5961"><td class="num" id="LN5961">5961</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="5962"><td class="num" id="LN5962">5962</td><td class="line">   <span class='keyword'>int</span> act_comp=0,num_packets=0,y,chained;</td></tr>
<tr class="codeline" data-linenumber="5963"><td class="num" id="LN5963">5963</td><td class="line">   stbi__pic_packet packets[10];</td></tr>
<tr class="codeline" data-linenumber="5964"><td class="num" id="LN5964">5964</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5965"><td class="num" id="LN5965">5965</td><td class="line">   <span class='comment'>// this will (should...) cater for even some bizarre stuff like having data</span></td></tr>
<tr class="codeline" data-linenumber="5966"><td class="num" id="LN5966">5966</td><td class="line">    <span class='comment'>// for the same channel in multiple packets.</span></td></tr>
<tr class="codeline" data-linenumber="5967"><td class="num" id="LN5967">5967</td><td class="line">   <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="5968"><td class="num" id="LN5968">5968</td><td class="line">      stbi__pic_packet *packet;</td></tr>
<tr class="codeline" data-linenumber="5969"><td class="num" id="LN5969">5969</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5970"><td class="num" id="LN5970">5970</td><td class="line">      <span class='keyword'>if</span> (num_packets==<span class='keyword'>sizeof</span>(packets)/<span class='keyword'>sizeof</span>(packets[0]))</td></tr>
<tr class="codeline" data-linenumber="5971"><td class="num" id="LN5971">5971</td><td class="line">         <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad format"</span>,<span class='string_literal'>"too many packets"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad format")?((void*)0<br>):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5972"><td class="num" id="LN5972">5972</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5973"><td class="num" id="LN5973">5973</td><td class="line">      packet = &amp;packets[num_packets++];</td></tr>
<tr class="codeline" data-linenumber="5974"><td class="num" id="LN5974">5974</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5975"><td class="num" id="LN5975">5975</td><td class="line">      chained = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5976"><td class="num" id="LN5976">5976</td><td class="line">      packet-&gt;size    = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5977"><td class="num" id="LN5977">5977</td><td class="line">      packet-&gt;type    = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5978"><td class="num" id="LN5978">5978</td><td class="line">      packet-&gt;channel = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="5979"><td class="num" id="LN5979">5979</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5980"><td class="num" id="LN5980">5980</td><td class="line">      act_comp |= packet-&gt;channel;</td></tr>
<tr class="codeline" data-linenumber="5981"><td class="num" id="LN5981">5981</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5982"><td class="num" id="LN5982">5982</td><td class="line">      <span class='keyword'>if</span> (stbi__at_eof(s))          <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"file too short (reading packets)"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5983"><td class="num" id="LN5983">5983</td><td class="line">      <span class='keyword'>if</span> (packet-&gt;size != 8)  <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad format"</span>,<span class='string_literal'>"packet isn't 8bpp"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad format")?((void*)0<br>):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5984"><td class="num" id="LN5984">5984</td><td class="line">   } <span class='keyword'>while</span> (chained);</td></tr>
<tr class="codeline" data-linenumber="5985"><td class="num" id="LN5985">5985</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5986"><td class="num" id="LN5986">5986</td><td class="line">   *comp = (act_comp &amp; 0x10 ? 4 : 3); <span class='comment'>// has alpha channel?</span></td></tr>
<tr class="codeline" data-linenumber="5987"><td class="num" id="LN5987">5987</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5988"><td class="num" id="LN5988">5988</td><td class="line">   <span class='keyword'>for</span>(y=0; y&lt;height; ++y) {</td></tr>
<tr class="codeline" data-linenumber="5989"><td class="num" id="LN5989">5989</td><td class="line">      <span class='keyword'>int</span> packet_idx;</td></tr>
<tr class="codeline" data-linenumber="5990"><td class="num" id="LN5990">5990</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5991"><td class="num" id="LN5991">5991</td><td class="line">      <span class='keyword'>for</span>(packet_idx=0; packet_idx &lt; num_packets; ++packet_idx) {</td></tr>
<tr class="codeline" data-linenumber="5992"><td class="num" id="LN5992">5992</td><td class="line">         stbi__pic_packet *packet = &amp;packets[packet_idx];</td></tr>
<tr class="codeline" data-linenumber="5993"><td class="num" id="LN5993">5993</td><td class="line">         stbi_uc *dest = result+y*width*4;</td></tr>
<tr class="codeline" data-linenumber="5994"><td class="num" id="LN5994">5994</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5995"><td class="num" id="LN5995">5995</td><td class="line">         <span class='keyword'>switch</span> (packet-&gt;type) {</td></tr>
<tr class="codeline" data-linenumber="5996"><td class="num" id="LN5996">5996</td><td class="line">            <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="5997"><td class="num" id="LN5997">5997</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad format"</span>,<span class='string_literal'>"packet has bad compression type"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad format")?((void*)0<br>):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="5998"><td class="num" id="LN5998">5998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5999"><td class="num" id="LN5999">5999</td><td class="line">            <span class='keyword'>case</span> 0: {<span class='comment'>//uncompressed</span></td></tr>
<tr class="codeline" data-linenumber="6000"><td class="num" id="LN6000">6000</td><td class="line">               <span class='keyword'>int</span> x;</td></tr>
<tr class="codeline" data-linenumber="6001"><td class="num" id="LN6001">6001</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6002"><td class="num" id="LN6002">6002</td><td class="line">               <span class='keyword'>for</span>(x=0;x&lt;width;++x, dest+=4)</td></tr>
<tr class="codeline" data-linenumber="6003"><td class="num" id="LN6003">6003</td><td class="line">                  <span class='keyword'>if</span> (!stbi__readval(s,packet-&gt;channel,dest))</td></tr>
<tr class="codeline" data-linenumber="6004"><td class="num" id="LN6004">6004</td><td class="line">                     <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6005"><td class="num" id="LN6005">6005</td><td class="line">               <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6006"><td class="num" id="LN6006">6006</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6007"><td class="num" id="LN6007">6007</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6008"><td class="num" id="LN6008">6008</td><td class="line">            <span class='keyword'>case</span> 1:<span class='comment'>//Pure RLE</span></td></tr>
<tr class="codeline" data-linenumber="6009"><td class="num" id="LN6009">6009</td><td class="line">               {</td></tr>
<tr class="codeline" data-linenumber="6010"><td class="num" id="LN6010">6010</td><td class="line">                  <span class='keyword'>int</span> left=width, i;</td></tr>
<tr class="codeline" data-linenumber="6011"><td class="num" id="LN6011">6011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6012"><td class="num" id="LN6012">6012</td><td class="line">                  <span class='keyword'>while</span> (left&gt;0) {</td></tr>
<tr class="codeline" data-linenumber="6013"><td class="num" id="LN6013">6013</td><td class="line">                     stbi_uc count,value[4];</td></tr>
<tr class="codeline" data-linenumber="6014"><td class="num" id="LN6014">6014</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6015"><td class="num" id="LN6015">6015</td><td class="line">                     count=stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6016"><td class="num" id="LN6016">6016</td><td class="line">                     <span class='keyword'>if</span> (stbi__at_eof(s))   <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"file too short (pure read count)"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6017"><td class="num" id="LN6017">6017</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6018"><td class="num" id="LN6018">6018</td><td class="line">                     <span class='keyword'>if</span> (count &gt; left)</td></tr>
<tr class="codeline" data-linenumber="6019"><td class="num" id="LN6019">6019</td><td class="line">                        count = (stbi_uc) left;</td></tr>
<tr class="codeline" data-linenumber="6020"><td class="num" id="LN6020">6020</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6021"><td class="num" id="LN6021">6021</td><td class="line">                     <span class='keyword'>if</span> (!stbi__readval(s,packet-&gt;channel,value))  <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6022"><td class="num" id="LN6022">6022</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6023"><td class="num" id="LN6023">6023</td><td class="line">                     <span class='keyword'>for</span>(i=0; i&lt;count; ++i,dest+=4)</td></tr>
<tr class="codeline" data-linenumber="6024"><td class="num" id="LN6024">6024</td><td class="line">                        stbi__copyval(packet-&gt;channel,dest,value);</td></tr>
<tr class="codeline" data-linenumber="6025"><td class="num" id="LN6025">6025</td><td class="line">                     left -= count;</td></tr>
<tr class="codeline" data-linenumber="6026"><td class="num" id="LN6026">6026</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="6027"><td class="num" id="LN6027">6027</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6028"><td class="num" id="LN6028">6028</td><td class="line">               <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6029"><td class="num" id="LN6029">6029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6030"><td class="num" id="LN6030">6030</td><td class="line">            <span class='keyword'>case</span> 2: {<span class='comment'>//Mixed RLE</span></td></tr>
<tr class="codeline" data-linenumber="6031"><td class="num" id="LN6031">6031</td><td class="line">               <span class='keyword'>int</span> left=width;</td></tr>
<tr class="codeline" data-linenumber="6032"><td class="num" id="LN6032">6032</td><td class="line">               <span class='keyword'>while</span> (left&gt;0) {</td></tr>
<tr class="codeline" data-linenumber="6033"><td class="num" id="LN6033">6033</td><td class="line">                  <span class='keyword'>int</span> count = stbi__get8(s), i;</td></tr>
<tr class="codeline" data-linenumber="6034"><td class="num" id="LN6034">6034</td><td class="line">                  <span class='keyword'>if</span> (stbi__at_eof(s))  <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"file too short (mixed read count)"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6035"><td class="num" id="LN6035">6035</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6036"><td class="num" id="LN6036">6036</td><td class="line">                  <span class='keyword'>if</span> (count &gt;= 128) { <span class='comment'>// Repeated</span></td></tr>
<tr class="codeline" data-linenumber="6037"><td class="num" id="LN6037">6037</td><td class="line">                     stbi_uc value[4];</td></tr>
<tr class="codeline" data-linenumber="6038"><td class="num" id="LN6038">6038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6039"><td class="num" id="LN6039">6039</td><td class="line">                     <span class='keyword'>if</span> (count==128)</td></tr>
<tr class="codeline" data-linenumber="6040"><td class="num" id="LN6040">6040</td><td class="line">                        count = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6041"><td class="num" id="LN6041">6041</td><td class="line">                     <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="6042"><td class="num" id="LN6042">6042</td><td class="line">                        count -= 127;</td></tr>
<tr class="codeline" data-linenumber="6043"><td class="num" id="LN6043">6043</td><td class="line">                     <span class='keyword'>if</span> (count &gt; left)</td></tr>
<tr class="codeline" data-linenumber="6044"><td class="num" id="LN6044">6044</td><td class="line">                        <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"scanline overrun"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6045"><td class="num" id="LN6045">6045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6046"><td class="num" id="LN6046">6046</td><td class="line">                     <span class='keyword'>if</span> (!stbi__readval(s,packet-&gt;channel,value))</td></tr>
<tr class="codeline" data-linenumber="6047"><td class="num" id="LN6047">6047</td><td class="line">                        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6048"><td class="num" id="LN6048">6048</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6049"><td class="num" id="LN6049">6049</td><td class="line">                     <span class='keyword'>for</span>(i=0;i&lt;count;++i, dest += 4)</td></tr>
<tr class="codeline" data-linenumber="6050"><td class="num" id="LN6050">6050</td><td class="line">                        stbi__copyval(packet-&gt;channel,dest,value);</td></tr>
<tr class="codeline" data-linenumber="6051"><td class="num" id="LN6051">6051</td><td class="line">                  } <span class='keyword'>else</span> { <span class='comment'>// Raw</span></td></tr>
<tr class="codeline" data-linenumber="6052"><td class="num" id="LN6052">6052</td><td class="line">                     ++count;</td></tr>
<tr class="codeline" data-linenumber="6053"><td class="num" id="LN6053">6053</td><td class="line">                     <span class='keyword'>if</span> (count&gt;left) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"scanline overrun"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6054"><td class="num" id="LN6054">6054</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6055"><td class="num" id="LN6055">6055</td><td class="line">                     <span class='keyword'>for</span>(i=0;i&lt;count;++i, dest+=4)</td></tr>
<tr class="codeline" data-linenumber="6056"><td class="num" id="LN6056">6056</td><td class="line">                        <span class='keyword'>if</span> (!stbi__readval(s,packet-&gt;channel,dest))</td></tr>
<tr class="codeline" data-linenumber="6057"><td class="num" id="LN6057">6057</td><td class="line">                           <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6058"><td class="num" id="LN6058">6058</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="6059"><td class="num" id="LN6059">6059</td><td class="line">                  left-=count;</td></tr>
<tr class="codeline" data-linenumber="6060"><td class="num" id="LN6060">6060</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6061"><td class="num" id="LN6061">6061</td><td class="line">               <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6062"><td class="num" id="LN6062">6062</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6063"><td class="num" id="LN6063">6063</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6064"><td class="num" id="LN6064">6064</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6065"><td class="num" id="LN6065">6065</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6066"><td class="num" id="LN6066">6066</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6067"><td class="num" id="LN6067">6067</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="6068"><td class="num" id="LN6068">6068</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6069"><td class="num" id="LN6069">6069</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6070"><td class="num" id="LN6070">6070</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__pic_load(stbi__context *s,<span class='keyword'>int</span> *px,<span class='keyword'>int</span> *py,<span class='keyword'>int</span> *comp,<span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="6071"><td class="num" id="LN6071">6071</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6072"><td class="num" id="LN6072">6072</td><td class="line">   stbi_uc *result;</td></tr>
<tr class="codeline" data-linenumber="6073"><td class="num" id="LN6073">6073</td><td class="line">   <span class='keyword'>int</span> i, x,y, internal_comp;</td></tr>
<tr class="codeline" data-linenumber="6074"><td class="num" id="LN6074">6074</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6075"><td class="num" id="LN6075">6075</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6076"><td class="num" id="LN6076">6076</td><td class="line">   <span class='keyword'>if</span> (!comp) comp = &amp;internal_comp;</td></tr>
<tr class="codeline" data-linenumber="6077"><td class="num" id="LN6077">6077</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6078"><td class="num" id="LN6078">6078</td><td class="line">   <span class='keyword'>for</span> (i=0; i&lt;92; ++i)</td></tr>
<tr class="codeline" data-linenumber="6079"><td class="num" id="LN6079">6079</td><td class="line">      stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6080"><td class="num" id="LN6080">6080</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6081"><td class="num" id="LN6081">6081</td><td class="line">   x = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6082"><td class="num" id="LN6082">6082</td><td class="line">   y = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6083"><td class="num" id="LN6083">6083</td><td class="line">   <span class='keyword'>if</span> (stbi__at_eof(s))  <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad file"</span>,<span class='string_literal'>"file too short (pic header)"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad file")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6084"><td class="num" id="LN6084">6084</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(x, y, 4, 0)) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"PIC image too large to decode"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("too large")?((void*)0)<br>:((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6085"><td class="num" id="LN6085">6085</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6086"><td class="num" id="LN6086">6086</td><td class="line">   stbi__get32be(s); <span class='comment'>//skip `ratio'</span></td></tr>
<tr class="codeline" data-linenumber="6087"><td class="num" id="LN6087">6087</td><td class="line">   stbi__get16be(s); <span class='comment'>//skip `fields'</span></td></tr>
<tr class="codeline" data-linenumber="6088"><td class="num" id="LN6088">6088</td><td class="line">   stbi__get16be(s); <span class='comment'>//skip `pad'</span></td></tr>
<tr class="codeline" data-linenumber="6089"><td class="num" id="LN6089">6089</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6090"><td class="num" id="LN6090">6090</td><td class="line">   <span class='comment'>// intermediate buffer is RGBA</span></td></tr>
<tr class="codeline" data-linenumber="6091"><td class="num" id="LN6091">6091</td><td class="line">   result = (stbi_uc *) stbi__malloc_mad3(x, y, 4, 0);</td></tr>
<tr class="codeline" data-linenumber="6092"><td class="num" id="LN6092">6092</td><td class="line">   <span class="mrange">memset</span>(result, 0xff, x*y*4);</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:4ex; max-width:58em">Call to function 'memset' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memset_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="6093"><td class="num" id="LN6093">6093</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6094"><td class="num" id="LN6094">6094</td><td class="line">   <span class='keyword'>if</span> (!stbi__pic_load_core(s,x,y,comp, result)) {</td></tr>
<tr class="codeline" data-linenumber="6095"><td class="num" id="LN6095">6095</td><td class="line">      <span class='macro'>STBI_FREE(result)<span class='macro_popup'>free(result)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6096"><td class="num" id="LN6096">6096</td><td class="line">      result=0;</td></tr>
<tr class="codeline" data-linenumber="6097"><td class="num" id="LN6097">6097</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6098"><td class="num" id="LN6098">6098</td><td class="line">   *px = x;</td></tr>
<tr class="codeline" data-linenumber="6099"><td class="num" id="LN6099">6099</td><td class="line">   *py = y;</td></tr>
<tr class="codeline" data-linenumber="6100"><td class="num" id="LN6100">6100</td><td class="line">   <span class='keyword'>if</span> (req_comp == 0) req_comp = *comp;</td></tr>
<tr class="codeline" data-linenumber="6101"><td class="num" id="LN6101">6101</td><td class="line">   result=stbi__convert_format(result,4,req_comp,x,y);</td></tr>
<tr class="codeline" data-linenumber="6102"><td class="num" id="LN6102">6102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6103"><td class="num" id="LN6103">6103</td><td class="line">   <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="6104"><td class="num" id="LN6104">6104</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6105"><td class="num" id="LN6105">6105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6106"><td class="num" id="LN6106">6106</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__pic_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="6107"><td class="num" id="LN6107">6107</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6108"><td class="num" id="LN6108">6108</td><td class="line">   <span class='keyword'>int</span> r = stbi__pic_test_core(s);</td></tr>
<tr class="codeline" data-linenumber="6109"><td class="num" id="LN6109">6109</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="6110"><td class="num" id="LN6110">6110</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="6111"><td class="num" id="LN6111">6111</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6112"><td class="num" id="LN6112">6112</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="6113"><td class="num" id="LN6113">6113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6114"><td class="num" id="LN6114">6114</td><td class="line"><span class='comment'>// *************************************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="6115"><td class="num" id="LN6115">6115</td><td class="line"><span class='comment'>// GIF loader -- public domain by Jean-Marc Lienher -- simplified/shrunk by stb</span></td></tr>
<tr class="codeline" data-linenumber="6116"><td class="num" id="LN6116">6116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6117"><td class="num" id="LN6117">6117</td><td class="line"><span class='directive'>#ifndef STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="6118"><td class="num" id="LN6118">6118</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="6119"><td class="num" id="LN6119">6119</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6120"><td class="num" id="LN6120">6120</td><td class="line">   stbi__int16 prefix;</td></tr>
<tr class="codeline" data-linenumber="6121"><td class="num" id="LN6121">6121</td><td class="line">   stbi_uc first;</td></tr>
<tr class="codeline" data-linenumber="6122"><td class="num" id="LN6122">6122</td><td class="line">   stbi_uc suffix;</td></tr>
<tr class="codeline" data-linenumber="6123"><td class="num" id="LN6123">6123</td><td class="line">} stbi__gif_lzw;</td></tr>
<tr class="codeline" data-linenumber="6124"><td class="num" id="LN6124">6124</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6125"><td class="num" id="LN6125">6125</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="6126"><td class="num" id="LN6126">6126</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6127"><td class="num" id="LN6127">6127</td><td class="line">   <span class='keyword'>int</span> w,h;</td></tr>
<tr class="codeline" data-linenumber="6128"><td class="num" id="LN6128">6128</td><td class="line">   stbi_uc *out;                 <span class='comment'>// output buffer (always 4 components)</span></td></tr>
<tr class="codeline" data-linenumber="6129"><td class="num" id="LN6129">6129</td><td class="line">   stbi_uc *background;          <span class='comment'>// The current "background" as far as a gif is concerned</span></td></tr>
<tr class="codeline" data-linenumber="6130"><td class="num" id="LN6130">6130</td><td class="line">   stbi_uc *history; </td></tr>
<tr class="codeline" data-linenumber="6131"><td class="num" id="LN6131">6131</td><td class="line">   <span class='keyword'>int</span> flags, bgindex, ratio, transparent, eflags;</td></tr>
<tr class="codeline" data-linenumber="6132"><td class="num" id="LN6132">6132</td><td class="line">   stbi_uc  pal[256][4];</td></tr>
<tr class="codeline" data-linenumber="6133"><td class="num" id="LN6133">6133</td><td class="line">   stbi_uc lpal[256][4];</td></tr>
<tr class="codeline" data-linenumber="6134"><td class="num" id="LN6134">6134</td><td class="line">   stbi__gif_lzw codes[8192];</td></tr>
<tr class="codeline" data-linenumber="6135"><td class="num" id="LN6135">6135</td><td class="line">   stbi_uc *color_table;</td></tr>
<tr class="codeline" data-linenumber="6136"><td class="num" id="LN6136">6136</td><td class="line">   <span class='keyword'>int</span> parse, step;</td></tr>
<tr class="codeline" data-linenumber="6137"><td class="num" id="LN6137">6137</td><td class="line">   <span class='keyword'>int</span> lflags;</td></tr>
<tr class="codeline" data-linenumber="6138"><td class="num" id="LN6138">6138</td><td class="line">   <span class='keyword'>int</span> start_x, start_y;</td></tr>
<tr class="codeline" data-linenumber="6139"><td class="num" id="LN6139">6139</td><td class="line">   <span class='keyword'>int</span> max_x, max_y;</td></tr>
<tr class="codeline" data-linenumber="6140"><td class="num" id="LN6140">6140</td><td class="line">   <span class='keyword'>int</span> cur_x, cur_y;</td></tr>
<tr class="codeline" data-linenumber="6141"><td class="num" id="LN6141">6141</td><td class="line">   <span class='keyword'>int</span> line_size;</td></tr>
<tr class="codeline" data-linenumber="6142"><td class="num" id="LN6142">6142</td><td class="line">   <span class='keyword'>int</span> delay;</td></tr>
<tr class="codeline" data-linenumber="6143"><td class="num" id="LN6143">6143</td><td class="line">} stbi__gif;</td></tr>
<tr class="codeline" data-linenumber="6144"><td class="num" id="LN6144">6144</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6145"><td class="num" id="LN6145">6145</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__gif_test_raw(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="6146"><td class="num" id="LN6146">6146</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6147"><td class="num" id="LN6147">6147</td><td class="line">   <span class='keyword'>int</span> sz;</td></tr>
<tr class="codeline" data-linenumber="6148"><td class="num" id="LN6148">6148</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8') <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6149"><td class="num" id="LN6149">6149</td><td class="line">   sz = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6150"><td class="num" id="LN6150">6150</td><td class="line">   <span class='keyword'>if</span> (sz != '9' &amp;&amp; sz != '7') <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6151"><td class="num" id="LN6151">6151</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'a') <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6152"><td class="num" id="LN6152">6152</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6153"><td class="num" id="LN6153">6153</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6154"><td class="num" id="LN6154">6154</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6155"><td class="num" id="LN6155">6155</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__gif_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="6156"><td class="num" id="LN6156">6156</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6157"><td class="num" id="LN6157">6157</td><td class="line">   <span class='keyword'>int</span> r = stbi__gif_test_raw(s);</td></tr>
<tr class="codeline" data-linenumber="6158"><td class="num" id="LN6158">6158</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="6159"><td class="num" id="LN6159">6159</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="6160"><td class="num" id="LN6160">6160</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6161"><td class="num" id="LN6161">6161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6162"><td class="num" id="LN6162">6162</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__gif_parse_colortable(stbi__context *s, stbi_uc pal[256][4], <span class='keyword'>int</span> num_entries, <span class='keyword'>int</span> transp)</td></tr>
<tr class="codeline" data-linenumber="6163"><td class="num" id="LN6163">6163</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6164"><td class="num" id="LN6164">6164</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="6165"><td class="num" id="LN6165">6165</td><td class="line">   <span class='keyword'>for</span> (i=0; i &lt; num_entries; ++i) {</td></tr>
<tr class="codeline" data-linenumber="6166"><td class="num" id="LN6166">6166</td><td class="line">      pal[i][2] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6167"><td class="num" id="LN6167">6167</td><td class="line">      pal[i][1] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6168"><td class="num" id="LN6168">6168</td><td class="line">      pal[i][0] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6169"><td class="num" id="LN6169">6169</td><td class="line">      pal[i][3] = transp == i ? 0 : 255;</td></tr>
<tr class="codeline" data-linenumber="6170"><td class="num" id="LN6170">6170</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6171"><td class="num" id="LN6171">6171</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6172"><td class="num" id="LN6172">6172</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6173"><td class="num" id="LN6173">6173</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__gif_header(stbi__context *s, stbi__gif *g, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> is_info)</td></tr>
<tr class="codeline" data-linenumber="6174"><td class="num" id="LN6174">6174</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6175"><td class="num" id="LN6175">6175</td><td class="line">   stbi_uc version;</td></tr>
<tr class="codeline" data-linenumber="6176"><td class="num" id="LN6176">6176</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')</td></tr>
<tr class="codeline" data-linenumber="6177"><td class="num" id="LN6177">6177</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"not GIF"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>stbi__err("not GIF")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6178"><td class="num" id="LN6178">6178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6179"><td class="num" id="LN6179">6179</td><td class="line">   version = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6180"><td class="num" id="LN6180">6180</td><td class="line">   <span class='keyword'>if</span> (version != '7' &amp;&amp; version != '9')    <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"not GIF"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>stbi__err("not GIF")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6181"><td class="num" id="LN6181">6181</td><td class="line">   <span class='keyword'>if</span> (stbi__get8(s) != 'a')                <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"not GIF"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>stbi__err("not GIF")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6182"><td class="num" id="LN6182">6182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6183"><td class="num" id="LN6183">6183</td><td class="line">   stbi__g_failure_reason = <span class='string_literal'>""</span>;</td></tr>
<tr class="codeline" data-linenumber="6184"><td class="num" id="LN6184">6184</td><td class="line">   g-&gt;w = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="6185"><td class="num" id="LN6185">6185</td><td class="line">   g-&gt;h = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="6186"><td class="num" id="LN6186">6186</td><td class="line">   g-&gt;flags = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6187"><td class="num" id="LN6187">6187</td><td class="line">   g-&gt;bgindex = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6188"><td class="num" id="LN6188">6188</td><td class="line">   g-&gt;ratio = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6189"><td class="num" id="LN6189">6189</td><td class="line">   g-&gt;transparent = -1;</td></tr>
<tr class="codeline" data-linenumber="6190"><td class="num" id="LN6190">6190</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6191"><td class="num" id="LN6191">6191</td><td class="line">   <span class='keyword'>if</span> (comp != 0) *comp = 4;  <span class='comment'>// can't actually tell whether it's 3 or 4 until we parse the comments</span></td></tr>
<tr class="codeline" data-linenumber="6192"><td class="num" id="LN6192">6192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6193"><td class="num" id="LN6193">6193</td><td class="line">   <span class='keyword'>if</span> (is_info) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6194"><td class="num" id="LN6194">6194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6195"><td class="num" id="LN6195">6195</td><td class="line">   <span class='keyword'>if</span> (g-&gt;flags &amp; 0x80)</td></tr>
<tr class="codeline" data-linenumber="6196"><td class="num" id="LN6196">6196</td><td class="line">      stbi__gif_parse_colortable(s,g-&gt;pal, 2 &lt;&lt; (g-&gt;flags &amp; 7), -1);</td></tr>
<tr class="codeline" data-linenumber="6197"><td class="num" id="LN6197">6197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6198"><td class="num" id="LN6198">6198</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6199"><td class="num" id="LN6199">6199</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6200"><td class="num" id="LN6200">6200</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6201"><td class="num" id="LN6201">6201</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__gif_info_raw(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="6202"><td class="num" id="LN6202">6202</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6203"><td class="num" id="LN6203">6203</td><td class="line">   stbi__gif* g = (stbi__gif*) stbi__malloc(<span class='keyword'>sizeof</span>(stbi__gif));</td></tr>
<tr class="codeline" data-linenumber="6204"><td class="num" id="LN6204">6204</td><td class="line">   <span class='keyword'>if</span> (!stbi__gif_header(s, g, comp, 1)) {</td></tr>
<tr class="codeline" data-linenumber="6205"><td class="num" id="LN6205">6205</td><td class="line">      <span class='macro'>STBI_FREE(g)<span class='macro_popup'>free(g)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6206"><td class="num" id="LN6206">6206</td><td class="line">      stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6207"><td class="num" id="LN6207">6207</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6208"><td class="num" id="LN6208">6208</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6209"><td class="num" id="LN6209">6209</td><td class="line">   <span class='keyword'>if</span> (x) *x = g-&gt;w;</td></tr>
<tr class="codeline" data-linenumber="6210"><td class="num" id="LN6210">6210</td><td class="line">   <span class='keyword'>if</span> (y) *y = g-&gt;h;</td></tr>
<tr class="codeline" data-linenumber="6211"><td class="num" id="LN6211">6211</td><td class="line">   <span class='macro'>STBI_FREE(g)<span class='macro_popup'>free(g)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6212"><td class="num" id="LN6212">6212</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6213"><td class="num" id="LN6213">6213</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6214"><td class="num" id="LN6214">6214</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6215"><td class="num" id="LN6215">6215</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__out_gif_code(stbi__gif *g, stbi__uint16 code)</td></tr>
<tr class="codeline" data-linenumber="6216"><td class="num" id="LN6216">6216</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6217"><td class="num" id="LN6217">6217</td><td class="line">   stbi_uc *p, *c;</td></tr>
<tr class="codeline" data-linenumber="6218"><td class="num" id="LN6218">6218</td><td class="line">   <span class='keyword'>int</span> idx; </td></tr>
<tr class="codeline" data-linenumber="6219"><td class="num" id="LN6219">6219</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6220"><td class="num" id="LN6220">6220</td><td class="line">   <span class='comment'>// recurse to decode the prefixes, since the linked-list is backwards,</span></td></tr>
<tr class="codeline" data-linenumber="6221"><td class="num" id="LN6221">6221</td><td class="line">   <span class='comment'>// and working backwards through an interleaved image would be nasty</span></td></tr>
<tr class="codeline" data-linenumber="6222"><td class="num" id="LN6222">6222</td><td class="line">   <span class='keyword'>if</span> (g-&gt;codes[code].prefix &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="6223"><td class="num" id="LN6223">6223</td><td class="line">      stbi__out_gif_code(g, g-&gt;codes[code].prefix);</td></tr>
<tr class="codeline" data-linenumber="6224"><td class="num" id="LN6224">6224</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6225"><td class="num" id="LN6225">6225</td><td class="line">   <span class='keyword'>if</span> (g-&gt;cur_y &gt;= g-&gt;max_y) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="6226"><td class="num" id="LN6226">6226</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6227"><td class="num" id="LN6227">6227</td><td class="line">   idx = g-&gt;cur_x + g-&gt;cur_y; </td></tr>
<tr class="codeline" data-linenumber="6228"><td class="num" id="LN6228">6228</td><td class="line">   p = &amp;g-&gt;out[idx];</td></tr>
<tr class="codeline" data-linenumber="6229"><td class="num" id="LN6229">6229</td><td class="line">   g-&gt;history[idx / 4] = 1;  </td></tr>
<tr class="codeline" data-linenumber="6230"><td class="num" id="LN6230">6230</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6231"><td class="num" id="LN6231">6231</td><td class="line">   c = &amp;g-&gt;color_table[g-&gt;codes[code].suffix * 4];</td></tr>
<tr class="codeline" data-linenumber="6232"><td class="num" id="LN6232">6232</td><td class="line">   <span class='keyword'>if</span> (c[3] &gt; 128) { <span class='comment'>// don't render transparent pixels; </span></td></tr>
<tr class="codeline" data-linenumber="6233"><td class="num" id="LN6233">6233</td><td class="line">      p[0] = c[2];</td></tr>
<tr class="codeline" data-linenumber="6234"><td class="num" id="LN6234">6234</td><td class="line">      p[1] = c[1];</td></tr>
<tr class="codeline" data-linenumber="6235"><td class="num" id="LN6235">6235</td><td class="line">      p[2] = c[0];</td></tr>
<tr class="codeline" data-linenumber="6236"><td class="num" id="LN6236">6236</td><td class="line">      p[3] = c[3];</td></tr>
<tr class="codeline" data-linenumber="6237"><td class="num" id="LN6237">6237</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6238"><td class="num" id="LN6238">6238</td><td class="line">   g-&gt;cur_x += 4;</td></tr>
<tr class="codeline" data-linenumber="6239"><td class="num" id="LN6239">6239</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6240"><td class="num" id="LN6240">6240</td><td class="line">   <span class='keyword'>if</span> (g-&gt;cur_x &gt;= g-&gt;max_x) {</td></tr>
<tr class="codeline" data-linenumber="6241"><td class="num" id="LN6241">6241</td><td class="line">      g-&gt;cur_x = g-&gt;start_x;</td></tr>
<tr class="codeline" data-linenumber="6242"><td class="num" id="LN6242">6242</td><td class="line">      g-&gt;cur_y += g-&gt;step;</td></tr>
<tr class="codeline" data-linenumber="6243"><td class="num" id="LN6243">6243</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6244"><td class="num" id="LN6244">6244</td><td class="line">      <span class='keyword'>while</span> (g-&gt;cur_y &gt;= g-&gt;max_y &amp;&amp; g-&gt;parse &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="6245"><td class="num" id="LN6245">6245</td><td class="line">         g-&gt;step = (1 &lt;&lt; g-&gt;parse) * g-&gt;line_size;</td></tr>
<tr class="codeline" data-linenumber="6246"><td class="num" id="LN6246">6246</td><td class="line">         g-&gt;cur_y = g-&gt;start_y + (g-&gt;step &gt;&gt; 1);</td></tr>
<tr class="codeline" data-linenumber="6247"><td class="num" id="LN6247">6247</td><td class="line">         --g-&gt;parse;</td></tr>
<tr class="codeline" data-linenumber="6248"><td class="num" id="LN6248">6248</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6249"><td class="num" id="LN6249">6249</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6250"><td class="num" id="LN6250">6250</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6251"><td class="num" id="LN6251">6251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6252"><td class="num" id="LN6252">6252</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__process_gif_raster(stbi__context *s, stbi__gif *g)</td></tr>
<tr class="codeline" data-linenumber="6253"><td class="num" id="LN6253">6253</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6254"><td class="num" id="LN6254">6254</td><td class="line">   stbi_uc lzw_cs;</td></tr>
<tr class="codeline" data-linenumber="6255"><td class="num" id="LN6255">6255</td><td class="line">   stbi__int32 len, init_code;</td></tr>
<tr class="codeline" data-linenumber="6256"><td class="num" id="LN6256">6256</td><td class="line">   stbi__uint32 first;</td></tr>
<tr class="codeline" data-linenumber="6257"><td class="num" id="LN6257">6257</td><td class="line">   stbi__int32 codesize, codemask, avail, oldcode, bits, valid_bits, clear;</td></tr>
<tr class="codeline" data-linenumber="6258"><td class="num" id="LN6258">6258</td><td class="line">   stbi__gif_lzw *p;</td></tr>
<tr class="codeline" data-linenumber="6259"><td class="num" id="LN6259">6259</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6260"><td class="num" id="LN6260">6260</td><td class="line">   lzw_cs = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6261"><td class="num" id="LN6261">6261</td><td class="line">   <span class='keyword'>if</span> (lzw_cs &gt; 12) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6262"><td class="num" id="LN6262">6262</td><td class="line">   clear = 1 &lt;&lt; lzw_cs;</td></tr>
<tr class="codeline" data-linenumber="6263"><td class="num" id="LN6263">6263</td><td class="line">   first = 1;</td></tr>
<tr class="codeline" data-linenumber="6264"><td class="num" id="LN6264">6264</td><td class="line">   codesize = lzw_cs + 1;</td></tr>
<tr class="codeline" data-linenumber="6265"><td class="num" id="LN6265">6265</td><td class="line">   codemask = (1 &lt;&lt; codesize) - 1;</td></tr>
<tr class="codeline" data-linenumber="6266"><td class="num" id="LN6266">6266</td><td class="line">   bits = 0;</td></tr>
<tr class="codeline" data-linenumber="6267"><td class="num" id="LN6267">6267</td><td class="line">   valid_bits = 0;</td></tr>
<tr class="codeline" data-linenumber="6268"><td class="num" id="LN6268">6268</td><td class="line">   <span class='keyword'>for</span> (init_code = 0; init_code &lt; clear; init_code++) {</td></tr>
<tr class="codeline" data-linenumber="6269"><td class="num" id="LN6269">6269</td><td class="line">      g-&gt;codes[init_code].prefix = -1;</td></tr>
<tr class="codeline" data-linenumber="6270"><td class="num" id="LN6270">6270</td><td class="line">      g-&gt;codes[init_code].first = (stbi_uc) init_code;</td></tr>
<tr class="codeline" data-linenumber="6271"><td class="num" id="LN6271">6271</td><td class="line">      g-&gt;codes[init_code].suffix = (stbi_uc) init_code;</td></tr>
<tr class="codeline" data-linenumber="6272"><td class="num" id="LN6272">6272</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6273"><td class="num" id="LN6273">6273</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6274"><td class="num" id="LN6274">6274</td><td class="line">   <span class='comment'>// support no starting clear code</span></td></tr>
<tr class="codeline" data-linenumber="6275"><td class="num" id="LN6275">6275</td><td class="line">   avail = clear+2;</td></tr>
<tr class="codeline" data-linenumber="6276"><td class="num" id="LN6276">6276</td><td class="line">   oldcode = -1;</td></tr>
<tr class="codeline" data-linenumber="6277"><td class="num" id="LN6277">6277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6278"><td class="num" id="LN6278">6278</td><td class="line">   len = 0;</td></tr>
<tr class="codeline" data-linenumber="6279"><td class="num" id="LN6279">6279</td><td class="line">   <span class='keyword'>for</span>(;;) {</td></tr>
<tr class="codeline" data-linenumber="6280"><td class="num" id="LN6280">6280</td><td class="line">      <span class='keyword'>if</span> (valid_bits &lt; codesize) {</td></tr>
<tr class="codeline" data-linenumber="6281"><td class="num" id="LN6281">6281</td><td class="line">         <span class='keyword'>if</span> (len == 0) {</td></tr>
<tr class="codeline" data-linenumber="6282"><td class="num" id="LN6282">6282</td><td class="line">            len = stbi__get8(s); <span class='comment'>// start new block</span></td></tr>
<tr class="codeline" data-linenumber="6283"><td class="num" id="LN6283">6283</td><td class="line">            <span class='keyword'>if</span> (len == 0)</td></tr>
<tr class="codeline" data-linenumber="6284"><td class="num" id="LN6284">6284</td><td class="line">               <span class='keyword'>return</span> g-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="6285"><td class="num" id="LN6285">6285</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6286"><td class="num" id="LN6286">6286</td><td class="line">         --len;</td></tr>
<tr class="codeline" data-linenumber="6287"><td class="num" id="LN6287">6287</td><td class="line">         bits |= (stbi__int32) stbi__get8(s) &lt;&lt; valid_bits;</td></tr>
<tr class="codeline" data-linenumber="6288"><td class="num" id="LN6288">6288</td><td class="line">         valid_bits += 8;</td></tr>
<tr class="codeline" data-linenumber="6289"><td class="num" id="LN6289">6289</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6290"><td class="num" id="LN6290">6290</td><td class="line">         stbi__int32 code = bits &amp; codemask;</td></tr>
<tr class="codeline" data-linenumber="6291"><td class="num" id="LN6291">6291</td><td class="line">         bits &gt;&gt;= codesize;</td></tr>
<tr class="codeline" data-linenumber="6292"><td class="num" id="LN6292">6292</td><td class="line">         valid_bits -= codesize;</td></tr>
<tr class="codeline" data-linenumber="6293"><td class="num" id="LN6293">6293</td><td class="line">         <span class='comment'>// @OPTIMIZE: is there some way we can accelerate the non-clear path?</span></td></tr>
<tr class="codeline" data-linenumber="6294"><td class="num" id="LN6294">6294</td><td class="line">         <span class='keyword'>if</span> (code == clear) {  <span class='comment'>// clear code</span></td></tr>
<tr class="codeline" data-linenumber="6295"><td class="num" id="LN6295">6295</td><td class="line">            codesize = lzw_cs + 1;</td></tr>
<tr class="codeline" data-linenumber="6296"><td class="num" id="LN6296">6296</td><td class="line">            codemask = (1 &lt;&lt; codesize) - 1;</td></tr>
<tr class="codeline" data-linenumber="6297"><td class="num" id="LN6297">6297</td><td class="line">            avail = clear + 2;</td></tr>
<tr class="codeline" data-linenumber="6298"><td class="num" id="LN6298">6298</td><td class="line">            oldcode = -1;</td></tr>
<tr class="codeline" data-linenumber="6299"><td class="num" id="LN6299">6299</td><td class="line">            first = 0;</td></tr>
<tr class="codeline" data-linenumber="6300"><td class="num" id="LN6300">6300</td><td class="line">         } <span class='keyword'>else</span> <span class='keyword'>if</span> (code == clear + 1) { <span class='comment'>// end of stream code</span></td></tr>
<tr class="codeline" data-linenumber="6301"><td class="num" id="LN6301">6301</td><td class="line">            stbi__skip(s, len);</td></tr>
<tr class="codeline" data-linenumber="6302"><td class="num" id="LN6302">6302</td><td class="line">            <span class='keyword'>while</span> ((len = stbi__get8(s)) &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="6303"><td class="num" id="LN6303">6303</td><td class="line">               stbi__skip(s,len);</td></tr>
<tr class="codeline" data-linenumber="6304"><td class="num" id="LN6304">6304</td><td class="line">            <span class='keyword'>return</span> g-&gt;out;</td></tr>
<tr class="codeline" data-linenumber="6305"><td class="num" id="LN6305">6305</td><td class="line">         } <span class='keyword'>else</span> <span class='keyword'>if</span> (code &lt;= avail) {</td></tr>
<tr class="codeline" data-linenumber="6306"><td class="num" id="LN6306">6306</td><td class="line">            <span class='keyword'>if</span> (first) {</td></tr>
<tr class="codeline" data-linenumber="6307"><td class="num" id="LN6307">6307</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"no clear code"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("no clear code")?((void<br>*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6308"><td class="num" id="LN6308">6308</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6309"><td class="num" id="LN6309">6309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6310"><td class="num" id="LN6310">6310</td><td class="line">            <span class='keyword'>if</span> (oldcode &gt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="6311"><td class="num" id="LN6311">6311</td><td class="line">               p = &amp;g-&gt;codes[avail++];</td></tr>
<tr class="codeline" data-linenumber="6312"><td class="num" id="LN6312">6312</td><td class="line">               <span class='keyword'>if</span> (avail &gt; 8192) {</td></tr>
<tr class="codeline" data-linenumber="6313"><td class="num" id="LN6313">6313</td><td class="line">                  <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"too many codes"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("too many codes")?((void<br>*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6314"><td class="num" id="LN6314">6314</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6315"><td class="num" id="LN6315">6315</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6316"><td class="num" id="LN6316">6316</td><td class="line">               p-&gt;prefix = (stbi__int16) oldcode;</td></tr>
<tr class="codeline" data-linenumber="6317"><td class="num" id="LN6317">6317</td><td class="line">               p-&gt;first = g-&gt;codes[oldcode].first;</td></tr>
<tr class="codeline" data-linenumber="6318"><td class="num" id="LN6318">6318</td><td class="line">               p-&gt;suffix = (code == avail) ? p-&gt;first : g-&gt;codes[code].first;</td></tr>
<tr class="codeline" data-linenumber="6319"><td class="num" id="LN6319">6319</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (code == avail)</td></tr>
<tr class="codeline" data-linenumber="6320"><td class="num" id="LN6320">6320</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"illegal code in raster"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("illegal code in raster"<br>)?((void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6321"><td class="num" id="LN6321">6321</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6322"><td class="num" id="LN6322">6322</td><td class="line">            stbi__out_gif_code(g, (stbi__uint16) code);</td></tr>
<tr class="codeline" data-linenumber="6323"><td class="num" id="LN6323">6323</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6324"><td class="num" id="LN6324">6324</td><td class="line">            <span class='keyword'>if</span> ((avail &amp; codemask) == 0 &amp;&amp; avail &lt;= 0x0FFF) {</td></tr>
<tr class="codeline" data-linenumber="6325"><td class="num" id="LN6325">6325</td><td class="line">               codesize++;</td></tr>
<tr class="codeline" data-linenumber="6326"><td class="num" id="LN6326">6326</td><td class="line">               codemask = (1 &lt;&lt; codesize) - 1;</td></tr>
<tr class="codeline" data-linenumber="6327"><td class="num" id="LN6327">6327</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6328"><td class="num" id="LN6328">6328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6329"><td class="num" id="LN6329">6329</td><td class="line">            oldcode = code;</td></tr>
<tr class="codeline" data-linenumber="6330"><td class="num" id="LN6330">6330</td><td class="line">         } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6331"><td class="num" id="LN6331">6331</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"illegal code in raster"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("illegal code in raster"<br>)?((void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6332"><td class="num" id="LN6332">6332</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6333"><td class="num" id="LN6333">6333</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6334"><td class="num" id="LN6334">6334</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6335"><td class="num" id="LN6335">6335</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6336"><td class="num" id="LN6336">6336</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6337"><td class="num" id="LN6337">6337</td><td class="line"><span class='comment'>// this function is designed to support animated gifs, although stb_image doesn't support it</span></td></tr>
<tr class="codeline" data-linenumber="6338"><td class="num" id="LN6338">6338</td><td class="line"><span class='comment'>// two back is the image from two frames ago, used for a very specific disposal format</span></td></tr>
<tr class="codeline" data-linenumber="6339"><td class="num" id="LN6339">6339</td><td class="line"><span class='keyword'>static</span> stbi_uc *stbi__gif_load_next(stbi__context *s, stbi__gif *g, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi_uc *two_back)</td></tr>
<tr class="codeline" data-linenumber="6340"><td class="num" id="LN6340">6340</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6341"><td class="num" id="LN6341">6341</td><td class="line">   <span class='keyword'>int</span> dispose; </td></tr>
<tr class="codeline" data-linenumber="6342"><td class="num" id="LN6342">6342</td><td class="line">   <span class='keyword'>int</span> first_frame; </td></tr>
<tr class="codeline" data-linenumber="6343"><td class="num" id="LN6343">6343</td><td class="line">   <span class='keyword'>int</span> pi; </td></tr>
<tr class="codeline" data-linenumber="6344"><td class="num" id="LN6344">6344</td><td class="line">   <span class='keyword'>int</span> pcount; </td></tr>
<tr class="codeline" data-linenumber="6345"><td class="num" id="LN6345">6345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6346"><td class="num" id="LN6346">6346</td><td class="line">   <span class='comment'>// on first frame, any non-written pixels get the background colour (non-transparent)</span></td></tr>
<tr class="codeline" data-linenumber="6347"><td class="num" id="LN6347">6347</td><td class="line">   first_frame = 0; </td></tr>
<tr class="codeline" data-linenumber="6348"><td class="num" id="LN6348">6348</td><td class="line">   <span class='keyword'>if</span> (g-&gt;out == 0) {</td></tr>
<tr class="codeline" data-linenumber="6349"><td class="num" id="LN6349">6349</td><td class="line">      <span class='keyword'>if</span> (!stbi__gif_header(s, g, comp,0))     <span class='keyword'>return</span> 0; <span class='comment'>// stbi__g_failure_reason set by stbi__gif_header</span></td></tr>
<tr class="codeline" data-linenumber="6350"><td class="num" id="LN6350">6350</td><td class="line">      g-&gt;out = (stbi_uc *) stbi__malloc(4 * g-&gt;w * g-&gt;h);</td></tr>
<tr class="codeline" data-linenumber="6351"><td class="num" id="LN6351">6351</td><td class="line">      g-&gt;background = (stbi_uc *) stbi__malloc(4 * g-&gt;w * g-&gt;h); </td></tr>
<tr class="codeline" data-linenumber="6352"><td class="num" id="LN6352">6352</td><td class="line">      g-&gt;history = (stbi_uc *) stbi__malloc(g-&gt;w * g-&gt;h); </td></tr>
<tr class="codeline" data-linenumber="6353"><td class="num" id="LN6353">6353</td><td class="line">      <span class='keyword'>if</span> (g-&gt;out == 0)                      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6354"><td class="num" id="LN6354">6354</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6355"><td class="num" id="LN6355">6355</td><td class="line">      <span class='comment'>// image is treated as "tranparent" at the start - ie, nothing overwrites the current background; </span></td></tr>
<tr class="codeline" data-linenumber="6356"><td class="num" id="LN6356">6356</td><td class="line">      <span class='comment'>// background colour is only used for pixels that are not rendered first frame, after that "background"</span></td></tr>
<tr class="codeline" data-linenumber="6357"><td class="num" id="LN6357">6357</td><td class="line">      <span class='comment'>// color refers to teh color that was there the previous frame. </span></td></tr>
<tr class="codeline" data-linenumber="6358"><td class="num" id="LN6358">6358</td><td class="line">      memset( g-&gt;out, 0x00, 4 * g-&gt;w * g-&gt;h ); </td></tr>
<tr class="codeline" data-linenumber="6359"><td class="num" id="LN6359">6359</td><td class="line">      memset( g-&gt;background, 0x00, 4 * g-&gt;w * g-&gt;h ); <span class='comment'>// state of the background (starts transparent)</span></td></tr>
<tr class="codeline" data-linenumber="6360"><td class="num" id="LN6360">6360</td><td class="line">      memset( g-&gt;history, 0x00, g-&gt;w * g-&gt;h );        <span class='comment'>// pixels that were affected previous frame</span></td></tr>
<tr class="codeline" data-linenumber="6361"><td class="num" id="LN6361">6361</td><td class="line">      first_frame = 1; </td></tr>
<tr class="codeline" data-linenumber="6362"><td class="num" id="LN6362">6362</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6363"><td class="num" id="LN6363">6363</td><td class="line">      <span class='comment'>// second frame - how do we dispoase of the previous one?</span></td></tr>
<tr class="codeline" data-linenumber="6364"><td class="num" id="LN6364">6364</td><td class="line">      dispose = (g-&gt;eflags &amp; 0x1C) &gt;&gt; 2; </td></tr>
<tr class="codeline" data-linenumber="6365"><td class="num" id="LN6365">6365</td><td class="line">      pcount = g-&gt;w * g-&gt;h; </td></tr>
<tr class="codeline" data-linenumber="6366"><td class="num" id="LN6366">6366</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6367"><td class="num" id="LN6367">6367</td><td class="line">      <span class='keyword'>if</span> ((dispose == 3) &amp;&amp; (two_back == 0)) {</td></tr>
<tr class="codeline" data-linenumber="6368"><td class="num" id="LN6368">6368</td><td class="line">         dispose = 2; <span class='comment'>// if I don't have an image to revert back to, default to the old background</span></td></tr>
<tr class="codeline" data-linenumber="6369"><td class="num" id="LN6369">6369</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6370"><td class="num" id="LN6370">6370</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6371"><td class="num" id="LN6371">6371</td><td class="line">      <span class='keyword'>if</span> (dispose == 3) { <span class='comment'>// use previous graphic</span></td></tr>
<tr class="codeline" data-linenumber="6372"><td class="num" id="LN6372">6372</td><td class="line">         <span class='keyword'>for</span> (pi = 0; pi &lt; pcount; ++pi) {</td></tr>
<tr class="codeline" data-linenumber="6373"><td class="num" id="LN6373">6373</td><td class="line">            <span class='keyword'>if</span> (g-&gt;history[pi]) {</td></tr>
<tr class="codeline" data-linenumber="6374"><td class="num" id="LN6374">6374</td><td class="line">               memcpy( &amp;g-&gt;out[pi * 4], &amp;two_back[pi * 4], 4 ); </td></tr>
<tr class="codeline" data-linenumber="6375"><td class="num" id="LN6375">6375</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6376"><td class="num" id="LN6376">6376</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6377"><td class="num" id="LN6377">6377</td><td class="line">      } <span class='keyword'>else</span> <span class='keyword'>if</span> (dispose == 2) { </td></tr>
<tr class="codeline" data-linenumber="6378"><td class="num" id="LN6378">6378</td><td class="line">         <span class='comment'>// restore what was changed last frame to background before that frame; </span></td></tr>
<tr class="codeline" data-linenumber="6379"><td class="num" id="LN6379">6379</td><td class="line">         <span class='keyword'>for</span> (pi = 0; pi &lt; pcount; ++pi) {</td></tr>
<tr class="codeline" data-linenumber="6380"><td class="num" id="LN6380">6380</td><td class="line">            <span class='keyword'>if</span> (g-&gt;history[pi]) {</td></tr>
<tr class="codeline" data-linenumber="6381"><td class="num" id="LN6381">6381</td><td class="line">               memcpy( &amp;g-&gt;out[pi * 4], &amp;g-&gt;background[pi * 4], 4 ); </td></tr>
<tr class="codeline" data-linenumber="6382"><td class="num" id="LN6382">6382</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6383"><td class="num" id="LN6383">6383</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6384"><td class="num" id="LN6384">6384</td><td class="line">      } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6385"><td class="num" id="LN6385">6385</td><td class="line">         <span class='comment'>// This is a non-disposal case eithe way, so just </span></td></tr>
<tr class="codeline" data-linenumber="6386"><td class="num" id="LN6386">6386</td><td class="line">         <span class='comment'>// leave the pixels as is, and they will become the new background</span></td></tr>
<tr class="codeline" data-linenumber="6387"><td class="num" id="LN6387">6387</td><td class="line">         <span class='comment'>// 1: do not dispose</span></td></tr>
<tr class="codeline" data-linenumber="6388"><td class="num" id="LN6388">6388</td><td class="line">         <span class='comment'>// 0:  not specified.</span></td></tr>
<tr class="codeline" data-linenumber="6389"><td class="num" id="LN6389">6389</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6390"><td class="num" id="LN6390">6390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6391"><td class="num" id="LN6391">6391</td><td class="line">      <span class='comment'>// background is what out is after the undoing of the previou frame; </span></td></tr>
<tr class="codeline" data-linenumber="6392"><td class="num" id="LN6392">6392</td><td class="line">      memcpy( g-&gt;background, g-&gt;out, 4 * g-&gt;w * g-&gt;h ); </td></tr>
<tr class="codeline" data-linenumber="6393"><td class="num" id="LN6393">6393</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6394"><td class="num" id="LN6394">6394</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6395"><td class="num" id="LN6395">6395</td><td class="line">   <span class='comment'>// clear my history; </span></td></tr>
<tr class="codeline" data-linenumber="6396"><td class="num" id="LN6396">6396</td><td class="line">   memset( g-&gt;history, 0x00, g-&gt;w * g-&gt;h );        <span class='comment'>// pixels that were affected previous frame</span></td></tr>
<tr class="codeline" data-linenumber="6397"><td class="num" id="LN6397">6397</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6398"><td class="num" id="LN6398">6398</td><td class="line">   <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="6399"><td class="num" id="LN6399">6399</td><td class="line">      <span class='keyword'>int</span> tag = stbi__get8(s); </td></tr>
<tr class="codeline" data-linenumber="6400"><td class="num" id="LN6400">6400</td><td class="line">      <span class='keyword'>switch</span> (tag) {</td></tr>
<tr class="codeline" data-linenumber="6401"><td class="num" id="LN6401">6401</td><td class="line">         <span class='keyword'>case</span> 0x2C: <span class='comment'>/* Image Descriptor */</span></td></tr>
<tr class="codeline" data-linenumber="6402"><td class="num" id="LN6402">6402</td><td class="line">         {</td></tr>
<tr class="codeline" data-linenumber="6403"><td class="num" id="LN6403">6403</td><td class="line">            stbi__int32 x, y, w, h;</td></tr>
<tr class="codeline" data-linenumber="6404"><td class="num" id="LN6404">6404</td><td class="line">            stbi_uc *o;</td></tr>
<tr class="codeline" data-linenumber="6405"><td class="num" id="LN6405">6405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6406"><td class="num" id="LN6406">6406</td><td class="line">            x = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="6407"><td class="num" id="LN6407">6407</td><td class="line">            y = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="6408"><td class="num" id="LN6408">6408</td><td class="line">            w = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="6409"><td class="num" id="LN6409">6409</td><td class="line">            h = stbi__get16le(s);</td></tr>
<tr class="codeline" data-linenumber="6410"><td class="num" id="LN6410">6410</td><td class="line">            <span class='keyword'>if</span> (((x + w) &gt; (g-&gt;w)) || ((y + h) &gt; (g-&gt;h)))</td></tr>
<tr class="codeline" data-linenumber="6411"><td class="num" id="LN6411">6411</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"bad Image Descriptor"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("bad Image Descriptor")<br>?((void*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6412"><td class="num" id="LN6412">6412</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6413"><td class="num" id="LN6413">6413</td><td class="line">            g-&gt;line_size = g-&gt;w * 4;</td></tr>
<tr class="codeline" data-linenumber="6414"><td class="num" id="LN6414">6414</td><td class="line">            g-&gt;start_x = x * 4;</td></tr>
<tr class="codeline" data-linenumber="6415"><td class="num" id="LN6415">6415</td><td class="line">            g-&gt;start_y = y * g-&gt;line_size;</td></tr>
<tr class="codeline" data-linenumber="6416"><td class="num" id="LN6416">6416</td><td class="line">            g-&gt;max_x   = g-&gt;start_x + w * 4;</td></tr>
<tr class="codeline" data-linenumber="6417"><td class="num" id="LN6417">6417</td><td class="line">            g-&gt;max_y   = g-&gt;start_y + h * g-&gt;line_size;</td></tr>
<tr class="codeline" data-linenumber="6418"><td class="num" id="LN6418">6418</td><td class="line">            g-&gt;cur_x   = g-&gt;start_x;</td></tr>
<tr class="codeline" data-linenumber="6419"><td class="num" id="LN6419">6419</td><td class="line">            g-&gt;cur_y   = g-&gt;start_y;</td></tr>
<tr class="codeline" data-linenumber="6420"><td class="num" id="LN6420">6420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6421"><td class="num" id="LN6421">6421</td><td class="line">            g-&gt;lflags = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6422"><td class="num" id="LN6422">6422</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6423"><td class="num" id="LN6423">6423</td><td class="line">            <span class='keyword'>if</span> (g-&gt;lflags &amp; 0x40) {</td></tr>
<tr class="codeline" data-linenumber="6424"><td class="num" id="LN6424">6424</td><td class="line">               g-&gt;step = 8 * g-&gt;line_size; <span class='comment'>// first interlaced spacing</span></td></tr>
<tr class="codeline" data-linenumber="6425"><td class="num" id="LN6425">6425</td><td class="line">               g-&gt;parse = 3;</td></tr>
<tr class="codeline" data-linenumber="6426"><td class="num" id="LN6426">6426</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6427"><td class="num" id="LN6427">6427</td><td class="line">               g-&gt;step = g-&gt;line_size;</td></tr>
<tr class="codeline" data-linenumber="6428"><td class="num" id="LN6428">6428</td><td class="line">               g-&gt;parse = 0;</td></tr>
<tr class="codeline" data-linenumber="6429"><td class="num" id="LN6429">6429</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6430"><td class="num" id="LN6430">6430</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6431"><td class="num" id="LN6431">6431</td><td class="line">            <span class='keyword'>if</span> (g-&gt;lflags &amp; 0x80) {</td></tr>
<tr class="codeline" data-linenumber="6432"><td class="num" id="LN6432">6432</td><td class="line">               stbi__gif_parse_colortable(s,g-&gt;lpal, 2 &lt;&lt; (g-&gt;lflags &amp; 7), g-&gt;eflags &amp; 0x01 ? g-&gt;transparent : -1);</td></tr>
<tr class="codeline" data-linenumber="6433"><td class="num" id="LN6433">6433</td><td class="line">               g-&gt;color_table = (stbi_uc *) g-&gt;lpal;</td></tr>
<tr class="codeline" data-linenumber="6434"><td class="num" id="LN6434">6434</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (g-&gt;flags &amp; 0x80) {</td></tr>
<tr class="codeline" data-linenumber="6435"><td class="num" id="LN6435">6435</td><td class="line">               g-&gt;color_table = (stbi_uc *) g-&gt;pal;</td></tr>
<tr class="codeline" data-linenumber="6436"><td class="num" id="LN6436">6436</td><td class="line">            } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="6437"><td class="num" id="LN6437">6437</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"missing color table"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("missing color table")?<br>((void*)0):((void*)0)))</span></span>;            </td></tr>
<tr class="codeline" data-linenumber="6438"><td class="num" id="LN6438">6438</td><td class="line">            </td></tr>
<tr class="codeline" data-linenumber="6439"><td class="num" id="LN6439">6439</td><td class="line">            o = stbi__process_gif_raster(s, g);</td></tr>
<tr class="codeline" data-linenumber="6440"><td class="num" id="LN6440">6440</td><td class="line">            <span class='keyword'>if</span> (o == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6441"><td class="num" id="LN6441">6441</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6442"><td class="num" id="LN6442">6442</td><td class="line">            <span class='comment'>// if this was the first frame, </span></td></tr>
<tr class="codeline" data-linenumber="6443"><td class="num" id="LN6443">6443</td><td class="line">            pcount = g-&gt;w * g-&gt;h; </td></tr>
<tr class="codeline" data-linenumber="6444"><td class="num" id="LN6444">6444</td><td class="line">            <span class='keyword'>if</span> (first_frame &amp;&amp; (g-&gt;bgindex &gt; 0)) {</td></tr>
<tr class="codeline" data-linenumber="6445"><td class="num" id="LN6445">6445</td><td class="line">               <span class='comment'>// if first frame, any pixel not drawn to gets the background color</span></td></tr>
<tr class="codeline" data-linenumber="6446"><td class="num" id="LN6446">6446</td><td class="line">               <span class='keyword'>for</span> (pi = 0; pi &lt; pcount; ++pi) {</td></tr>
<tr class="codeline" data-linenumber="6447"><td class="num" id="LN6447">6447</td><td class="line">                  <span class='keyword'>if</span> (g-&gt;history[pi] == 0) {</td></tr>
<tr class="codeline" data-linenumber="6448"><td class="num" id="LN6448">6448</td><td class="line">                     g-&gt;pal[g-&gt;bgindex][3] = 255; <span class='comment'>// just in case it was made transparent, undo that; It will be reset next frame if need be; </span></td></tr>
<tr class="codeline" data-linenumber="6449"><td class="num" id="LN6449">6449</td><td class="line">                     memcpy( &amp;g-&gt;out[pi * 4], &amp;g-&gt;pal[g-&gt;bgindex], 4 ); </td></tr>
<tr class="codeline" data-linenumber="6450"><td class="num" id="LN6450">6450</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="6451"><td class="num" id="LN6451">6451</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6452"><td class="num" id="LN6452">6452</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6453"><td class="num" id="LN6453">6453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6454"><td class="num" id="LN6454">6454</td><td class="line">            <span class='keyword'>return</span> o;</td></tr>
<tr class="codeline" data-linenumber="6455"><td class="num" id="LN6455">6455</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6456"><td class="num" id="LN6456">6456</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6457"><td class="num" id="LN6457">6457</td><td class="line">         <span class='keyword'>case</span> 0x21: <span class='comment'>// Comment Extension.</span></td></tr>
<tr class="codeline" data-linenumber="6458"><td class="num" id="LN6458">6458</td><td class="line">         {</td></tr>
<tr class="codeline" data-linenumber="6459"><td class="num" id="LN6459">6459</td><td class="line">            <span class='keyword'>int</span> len;</td></tr>
<tr class="codeline" data-linenumber="6460"><td class="num" id="LN6460">6460</td><td class="line">            <span class='keyword'>int</span> ext = stbi__get8(s); </td></tr>
<tr class="codeline" data-linenumber="6461"><td class="num" id="LN6461">6461</td><td class="line">            <span class='keyword'>if</span> (ext == 0xF9) { <span class='comment'>// Graphic Control Extension.</span></td></tr>
<tr class="codeline" data-linenumber="6462"><td class="num" id="LN6462">6462</td><td class="line">               len = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6463"><td class="num" id="LN6463">6463</td><td class="line">               <span class='keyword'>if</span> (len == 4) {</td></tr>
<tr class="codeline" data-linenumber="6464"><td class="num" id="LN6464">6464</td><td class="line">                  g-&gt;eflags = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6465"><td class="num" id="LN6465">6465</td><td class="line">                  g-&gt;delay = 10 * stbi__get16le(s); <span class='comment'>// delay - 1/100th of a second, saving as 1/1000ths.</span></td></tr>
<tr class="codeline" data-linenumber="6466"><td class="num" id="LN6466">6466</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6467"><td class="num" id="LN6467">6467</td><td class="line">                  <span class='comment'>// unset old transparent</span></td></tr>
<tr class="codeline" data-linenumber="6468"><td class="num" id="LN6468">6468</td><td class="line">                  <span class='keyword'>if</span> (g-&gt;transparent &gt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="6469"><td class="num" id="LN6469">6469</td><td class="line">                     g-&gt;pal[g-&gt;transparent][3] = 255; </td></tr>
<tr class="codeline" data-linenumber="6470"><td class="num" id="LN6470">6470</td><td class="line">                  } </td></tr>
<tr class="codeline" data-linenumber="6471"><td class="num" id="LN6471">6471</td><td class="line">                  <span class='keyword'>if</span> (g-&gt;eflags &amp; 0x01) {</td></tr>
<tr class="codeline" data-linenumber="6472"><td class="num" id="LN6472">6472</td><td class="line">                     g-&gt;transparent = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6473"><td class="num" id="LN6473">6473</td><td class="line">                     <span class='keyword'>if</span> (g-&gt;transparent &gt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="6474"><td class="num" id="LN6474">6474</td><td class="line">                        g-&gt;pal[g-&gt;transparent][3] = 0; </td></tr>
<tr class="codeline" data-linenumber="6475"><td class="num" id="LN6475">6475</td><td class="line">                     }</td></tr>
<tr class="codeline" data-linenumber="6476"><td class="num" id="LN6476">6476</td><td class="line">                  } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6477"><td class="num" id="LN6477">6477</td><td class="line">                     <span class='comment'>// don't need transparent</span></td></tr>
<tr class="codeline" data-linenumber="6478"><td class="num" id="LN6478">6478</td><td class="line">                     stbi__skip(s, 1); </td></tr>
<tr class="codeline" data-linenumber="6479"><td class="num" id="LN6479">6479</td><td class="line">                     g-&gt;transparent = -1; </td></tr>
<tr class="codeline" data-linenumber="6480"><td class="num" id="LN6480">6480</td><td class="line">                  }</td></tr>
<tr class="codeline" data-linenumber="6481"><td class="num" id="LN6481">6481</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6482"><td class="num" id="LN6482">6482</td><td class="line">                  stbi__skip(s, len);</td></tr>
<tr class="codeline" data-linenumber="6483"><td class="num" id="LN6483">6483</td><td class="line">                  <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6484"><td class="num" id="LN6484">6484</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6485"><td class="num" id="LN6485">6485</td><td class="line">            } </td></tr>
<tr class="codeline" data-linenumber="6486"><td class="num" id="LN6486">6486</td><td class="line">            <span class='keyword'>while</span> ((len = stbi__get8(s)) != 0) {</td></tr>
<tr class="codeline" data-linenumber="6487"><td class="num" id="LN6487">6487</td><td class="line">               stbi__skip(s, len);</td></tr>
<tr class="codeline" data-linenumber="6488"><td class="num" id="LN6488">6488</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6489"><td class="num" id="LN6489">6489</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6490"><td class="num" id="LN6490">6490</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6491"><td class="num" id="LN6491">6491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6492"><td class="num" id="LN6492">6492</td><td class="line">         <span class='keyword'>case</span> 0x3B: <span class='comment'>// gif stream termination code</span></td></tr>
<tr class="codeline" data-linenumber="6493"><td class="num" id="LN6493">6493</td><td class="line">            <span class='keyword'>return</span> (stbi_uc *) s; <span class='comment'>// using '1' causes warning on some compilers</span></td></tr>
<tr class="codeline" data-linenumber="6494"><td class="num" id="LN6494">6494</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6495"><td class="num" id="LN6495">6495</td><td class="line">         <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="6496"><td class="num" id="LN6496">6496</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"unknown code"</span>, <span class='string_literal'>"Corrupt GIF"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("unknown code")?((void*<br>)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6497"><td class="num" id="LN6497">6497</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6498"><td class="num" id="LN6498">6498</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6499"><td class="num" id="LN6499">6499</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6500"><td class="num" id="LN6500">6500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6501"><td class="num" id="LN6501">6501</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__load_gif_main(stbi__context *s, <span class='keyword'>int</span> **delays, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *z, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="6502"><td class="num" id="LN6502">6502</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6503"><td class="num" id="LN6503">6503</td><td class="line">   <span class='keyword'>if</span> (stbi__gif_test(s)) {</td></tr>
<tr class="codeline" data-linenumber="6504"><td class="num" id="LN6504">6504</td><td class="line">      <span class='keyword'>int</span> layers = 0; </td></tr>
<tr class="codeline" data-linenumber="6505"><td class="num" id="LN6505">6505</td><td class="line">      stbi_uc *u = 0;</td></tr>
<tr class="codeline" data-linenumber="6506"><td class="num" id="LN6506">6506</td><td class="line">      stbi_uc *out = 0;</td></tr>
<tr class="codeline" data-linenumber="6507"><td class="num" id="LN6507">6507</td><td class="line">      stbi_uc *two_back = 0; </td></tr>
<tr class="codeline" data-linenumber="6508"><td class="num" id="LN6508">6508</td><td class="line">      stbi__gif g;</td></tr>
<tr class="codeline" data-linenumber="6509"><td class="num" id="LN6509">6509</td><td class="line">      <span class='keyword'>int</span> stride; </td></tr>
<tr class="codeline" data-linenumber="6510"><td class="num" id="LN6510">6510</td><td class="line">      memset(&amp;g, 0, <span class='keyword'>sizeof</span>(g));</td></tr>
<tr class="codeline" data-linenumber="6511"><td class="num" id="LN6511">6511</td><td class="line">      <span class='keyword'>if</span> (delays) {</td></tr>
<tr class="codeline" data-linenumber="6512"><td class="num" id="LN6512">6512</td><td class="line">         *delays = 0; </td></tr>
<tr class="codeline" data-linenumber="6513"><td class="num" id="LN6513">6513</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6514"><td class="num" id="LN6514">6514</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6515"><td class="num" id="LN6515">6515</td><td class="line">      <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="6516"><td class="num" id="LN6516">6516</td><td class="line">         u = stbi__gif_load_next(s, &amp;g, comp, req_comp, two_back);</td></tr>
<tr class="codeline" data-linenumber="6517"><td class="num" id="LN6517">6517</td><td class="line">         <span class='keyword'>if</span> (u == (stbi_uc *) s) u = 0;  <span class='comment'>// end of animated gif marker</span></td></tr>
<tr class="codeline" data-linenumber="6518"><td class="num" id="LN6518">6518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6519"><td class="num" id="LN6519">6519</td><td class="line">         <span class='keyword'>if</span> (u) {</td></tr>
<tr class="codeline" data-linenumber="6520"><td class="num" id="LN6520">6520</td><td class="line">            *x = g.w;</td></tr>
<tr class="codeline" data-linenumber="6521"><td class="num" id="LN6521">6521</td><td class="line">            *y = g.h;</td></tr>
<tr class="codeline" data-linenumber="6522"><td class="num" id="LN6522">6522</td><td class="line">            ++layers; </td></tr>
<tr class="codeline" data-linenumber="6523"><td class="num" id="LN6523">6523</td><td class="line">            stride = g.w * g.h * 4; </td></tr>
<tr class="codeline" data-linenumber="6524"><td class="num" id="LN6524">6524</td><td class="line">         </td></tr>
<tr class="codeline" data-linenumber="6525"><td class="num" id="LN6525">6525</td><td class="line">            <span class='keyword'>if</span> (out) {</td></tr>
<tr class="codeline" data-linenumber="6526"><td class="num" id="LN6526">6526</td><td class="line">               out = (stbi_uc*) <span class='macro'>STBI_REALLOC( out, layers * stride )<span class='macro_popup'>realloc(out,layers * stride)</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6527"><td class="num" id="LN6527">6527</td><td class="line">               <span class='keyword'>if</span> (delays) {</td></tr>
<tr class="codeline" data-linenumber="6528"><td class="num" id="LN6528">6528</td><td class="line">                  *delays = (<span class='keyword'>int</span>*) <span class='macro'>STBI_REALLOC( *delays, <span class='keyword'>sizeof</span>(<span class='keyword'>int</span>) * layers )<span class='macro_popup'>realloc(*delays,sizeof(int) * layers)</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6529"><td class="num" id="LN6529">6529</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6530"><td class="num" id="LN6530">6530</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6531"><td class="num" id="LN6531">6531</td><td class="line">               out = (stbi_uc*)stbi__malloc( layers * stride ); </td></tr>
<tr class="codeline" data-linenumber="6532"><td class="num" id="LN6532">6532</td><td class="line">               <span class='keyword'>if</span> (delays) {</td></tr>
<tr class="codeline" data-linenumber="6533"><td class="num" id="LN6533">6533</td><td class="line">                  *delays = (<span class='keyword'>int</span>*) stbi__malloc( layers * <span class='keyword'>sizeof</span>(<span class='keyword'>int</span>) ); </td></tr>
<tr class="codeline" data-linenumber="6534"><td class="num" id="LN6534">6534</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6535"><td class="num" id="LN6535">6535</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6536"><td class="num" id="LN6536">6536</td><td class="line">            memcpy( out + ((layers - 1) * stride), u, stride ); </td></tr>
<tr class="codeline" data-linenumber="6537"><td class="num" id="LN6537">6537</td><td class="line">            <span class='keyword'>if</span> (layers &gt;= 2) {</td></tr>
<tr class="codeline" data-linenumber="6538"><td class="num" id="LN6538">6538</td><td class="line">               two_back = out - 2 * stride; </td></tr>
<tr class="codeline" data-linenumber="6539"><td class="num" id="LN6539">6539</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6540"><td class="num" id="LN6540">6540</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6541"><td class="num" id="LN6541">6541</td><td class="line">            <span class='keyword'>if</span> (delays) {</td></tr>
<tr class="codeline" data-linenumber="6542"><td class="num" id="LN6542">6542</td><td class="line">               (*delays)[layers - 1U] = g.delay; </td></tr>
<tr class="codeline" data-linenumber="6543"><td class="num" id="LN6543">6543</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6544"><td class="num" id="LN6544">6544</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6545"><td class="num" id="LN6545">6545</td><td class="line">      } <span class='keyword'>while</span> (u != 0); </td></tr>
<tr class="codeline" data-linenumber="6546"><td class="num" id="LN6546">6546</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6547"><td class="num" id="LN6547">6547</td><td class="line">      <span class='comment'>// free temp buffer; </span></td></tr>
<tr class="codeline" data-linenumber="6548"><td class="num" id="LN6548">6548</td><td class="line">      <span class='macro'>STBI_FREE(g.out)<span class='macro_popup'>free(g.out)</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6549"><td class="num" id="LN6549">6549</td><td class="line">      <span class='macro'>STBI_FREE(g.history)<span class='macro_popup'>free(g.history)</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6550"><td class="num" id="LN6550">6550</td><td class="line">      <span class='macro'>STBI_FREE(g.background)<span class='macro_popup'>free(g.background)</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6551"><td class="num" id="LN6551">6551</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6552"><td class="num" id="LN6552">6552</td><td class="line">      <span class='comment'>// do the final conversion after loading everything; </span></td></tr>
<tr class="codeline" data-linenumber="6553"><td class="num" id="LN6553">6553</td><td class="line">      <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != 4)</td></tr>
<tr class="codeline" data-linenumber="6554"><td class="num" id="LN6554">6554</td><td class="line">         out = stbi__convert_format(out, 4, req_comp, layers * g.w, g.h);</td></tr>
<tr class="codeline" data-linenumber="6555"><td class="num" id="LN6555">6555</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6556"><td class="num" id="LN6556">6556</td><td class="line">      *z = layers; </td></tr>
<tr class="codeline" data-linenumber="6557"><td class="num" id="LN6557">6557</td><td class="line">      <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="6558"><td class="num" id="LN6558">6558</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6559"><td class="num" id="LN6559">6559</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"not GIF"</span>, <span class='string_literal'>"Image was not as a gif type."</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("not GIF")?((void*)0):(<br>(void*)0)))</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6560"><td class="num" id="LN6560">6560</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6561"><td class="num" id="LN6561">6561</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6562"><td class="num" id="LN6562">6562</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6563"><td class="num" id="LN6563">6563</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__gif_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="6564"><td class="num" id="LN6564">6564</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6565"><td class="num" id="LN6565">6565</td><td class="line">   stbi_uc *u = 0;</td></tr>
<tr class="codeline" data-linenumber="6566"><td class="num" id="LN6566">6566</td><td class="line">   stbi__gif g;</td></tr>
<tr class="codeline" data-linenumber="6567"><td class="num" id="LN6567">6567</td><td class="line">   memset(&amp;g, 0, <span class='keyword'>sizeof</span>(g));</td></tr>
<tr class="codeline" data-linenumber="6568"><td class="num" id="LN6568">6568</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6569"><td class="num" id="LN6569">6569</td><td class="line">   u = stbi__gif_load_next(s, &amp;g, comp, req_comp, 0);</td></tr>
<tr class="codeline" data-linenumber="6570"><td class="num" id="LN6570">6570</td><td class="line">   <span class='keyword'>if</span> (u == (stbi_uc *) s) u = 0;  <span class='comment'>// end of animated gif marker</span></td></tr>
<tr class="codeline" data-linenumber="6571"><td class="num" id="LN6571">6571</td><td class="line">   <span class='keyword'>if</span> (u) {</td></tr>
<tr class="codeline" data-linenumber="6572"><td class="num" id="LN6572">6572</td><td class="line">      *x = g.w;</td></tr>
<tr class="codeline" data-linenumber="6573"><td class="num" id="LN6573">6573</td><td class="line">      *y = g.h;</td></tr>
<tr class="codeline" data-linenumber="6574"><td class="num" id="LN6574">6574</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6575"><td class="num" id="LN6575">6575</td><td class="line">      <span class='comment'>// moved conversion to after successful load so that the same</span></td></tr>
<tr class="codeline" data-linenumber="6576"><td class="num" id="LN6576">6576</td><td class="line">      <span class='comment'>// can be done for multiple frames. </span></td></tr>
<tr class="codeline" data-linenumber="6577"><td class="num" id="LN6577">6577</td><td class="line">      <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != 4)</td></tr>
<tr class="codeline" data-linenumber="6578"><td class="num" id="LN6578">6578</td><td class="line">         u = stbi__convert_format(u, 4, req_comp, g.w, g.h);</td></tr>
<tr class="codeline" data-linenumber="6579"><td class="num" id="LN6579">6579</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6580"><td class="num" id="LN6580">6580</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6581"><td class="num" id="LN6581">6581</td><td class="line">   <span class='comment'>// free buffers needed for multiple frame loading; </span></td></tr>
<tr class="codeline" data-linenumber="6582"><td class="num" id="LN6582">6582</td><td class="line">   <span class='macro'>STBI_FREE(g.history)<span class='macro_popup'>free(g.history)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6583"><td class="num" id="LN6583">6583</td><td class="line">   <span class='macro'>STBI_FREE(g.background)<span class='macro_popup'>free(g.background)</span></span>; </td></tr>
<tr class="codeline" data-linenumber="6584"><td class="num" id="LN6584">6584</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6585"><td class="num" id="LN6585">6585</td><td class="line">   <span class='keyword'>return</span> u;</td></tr>
<tr class="codeline" data-linenumber="6586"><td class="num" id="LN6586">6586</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6587"><td class="num" id="LN6587">6587</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6588"><td class="num" id="LN6588">6588</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__gif_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="6589"><td class="num" id="LN6589">6589</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6590"><td class="num" id="LN6590">6590</td><td class="line">   <span class='keyword'>return</span> stbi__gif_info_raw(s,x,y,comp);</td></tr>
<tr class="codeline" data-linenumber="6591"><td class="num" id="LN6591">6591</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6592"><td class="num" id="LN6592">6592</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="6593"><td class="num" id="LN6593">6593</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6594"><td class="num" id="LN6594">6594</td><td class="line"><span class='comment'>// *************************************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="6595"><td class="num" id="LN6595">6595</td><td class="line"><span class='comment'>// Radiance RGBE HDR loader</span></td></tr>
<tr class="codeline" data-linenumber="6596"><td class="num" id="LN6596">6596</td><td class="line"><span class='comment'>// originally by Nicolas Schulz</span></td></tr>
<tr class="codeline" data-linenumber="6597"><td class="num" id="LN6597">6597</td><td class="line"><span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="6598"><td class="num" id="LN6598">6598</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__hdr_test_core(stbi__context *s, <span class='keyword'>const</span> <span class='keyword'>char</span> *signature)</td></tr>
<tr class="codeline" data-linenumber="6599"><td class="num" id="LN6599">6599</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6600"><td class="num" id="LN6600">6600</td><td class="line">   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="6601"><td class="num" id="LN6601">6601</td><td class="line">   <span class='keyword'>for</span> (i=0; signature[i]; ++i)</td></tr>
<tr class="codeline" data-linenumber="6602"><td class="num" id="LN6602">6602</td><td class="line">      <span class='keyword'>if</span> (stbi__get8(s) != signature[i])</td></tr>
<tr class="codeline" data-linenumber="6603"><td class="num" id="LN6603">6603</td><td class="line">          <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6604"><td class="num" id="LN6604">6604</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="6605"><td class="num" id="LN6605">6605</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6606"><td class="num" id="LN6606">6606</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6607"><td class="num" id="LN6607">6607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6608"><td class="num" id="LN6608">6608</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__hdr_test(stbi__context* s)</td></tr>
<tr class="codeline" data-linenumber="6609"><td class="num" id="LN6609">6609</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6610"><td class="num" id="LN6610">6610</td><td class="line">   <span class='keyword'>int</span> r = stbi__hdr_test_core(s, <span class='string_literal'>"#?RADIANCE\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="6611"><td class="num" id="LN6611">6611</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="6612"><td class="num" id="LN6612">6612</td><td class="line">   <span class='keyword'>if</span>(!r) {</td></tr>
<tr class="codeline" data-linenumber="6613"><td class="num" id="LN6613">6613</td><td class="line">       r = stbi__hdr_test_core(s, <span class='string_literal'>"#?RGBE\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="6614"><td class="num" id="LN6614">6614</td><td class="line">       stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="6615"><td class="num" id="LN6615">6615</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6616"><td class="num" id="LN6616">6616</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="6617"><td class="num" id="LN6617">6617</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6618"><td class="num" id="LN6618">6618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6619"><td class="num" id="LN6619">6619</td><td class="line"><span class='directive'>#define <span class='macro'>STBI__HDR_BUFLEN<span class='macro_popup'>1024</span></span>  1024</span></td></tr>
<tr class="codeline" data-linenumber="6620"><td class="num" id="LN6620">6620</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *stbi__hdr_gettoken(stbi__context *z, <span class='keyword'>char</span> *buffer)</td></tr>
<tr class="codeline" data-linenumber="6621"><td class="num" id="LN6621">6621</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6622"><td class="num" id="LN6622">6622</td><td class="line">   <span class='keyword'>int</span> len=0;</td></tr>
<tr class="codeline" data-linenumber="6623"><td class="num" id="LN6623">6623</td><td class="line">   <span class='keyword'>char</span> c = '\0';</td></tr>
<tr class="codeline" data-linenumber="6624"><td class="num" id="LN6624">6624</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6625"><td class="num" id="LN6625">6625</td><td class="line">   c = (<span class='keyword'>char</span>) stbi__get8(z);</td></tr>
<tr class="codeline" data-linenumber="6626"><td class="num" id="LN6626">6626</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6627"><td class="num" id="LN6627">6627</td><td class="line">   <span class='keyword'>while</span> (!stbi__at_eof(z) &amp;&amp; c != '\n') {</td></tr>
<tr class="codeline" data-linenumber="6628"><td class="num" id="LN6628">6628</td><td class="line">      buffer[len++] = c;</td></tr>
<tr class="codeline" data-linenumber="6629"><td class="num" id="LN6629">6629</td><td class="line">      <span class='keyword'>if</span> (len == <span class='macro'>STBI__HDR_BUFLEN<span class='macro_popup'>1024</span></span>-1) {</td></tr>
<tr class="codeline" data-linenumber="6630"><td class="num" id="LN6630">6630</td><td class="line">         <span class='comment'>// flush to end of line</span></td></tr>
<tr class="codeline" data-linenumber="6631"><td class="num" id="LN6631">6631</td><td class="line">         <span class='keyword'>while</span> (!stbi__at_eof(z) &amp;&amp; stbi__get8(z) != '\n')</td></tr>
<tr class="codeline" data-linenumber="6632"><td class="num" id="LN6632">6632</td><td class="line">            ;</td></tr>
<tr class="codeline" data-linenumber="6633"><td class="num" id="LN6633">6633</td><td class="line">         <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6634"><td class="num" id="LN6634">6634</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6635"><td class="num" id="LN6635">6635</td><td class="line">      c = (<span class='keyword'>char</span>) stbi__get8(z);</td></tr>
<tr class="codeline" data-linenumber="6636"><td class="num" id="LN6636">6636</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6637"><td class="num" id="LN6637">6637</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6638"><td class="num" id="LN6638">6638</td><td class="line">   buffer[len] = 0;</td></tr>
<tr class="codeline" data-linenumber="6639"><td class="num" id="LN6639">6639</td><td class="line">   <span class='keyword'>return</span> buffer;</td></tr>
<tr class="codeline" data-linenumber="6640"><td class="num" id="LN6640">6640</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6641"><td class="num" id="LN6641">6641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6642"><td class="num" id="LN6642">6642</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> stbi__hdr_convert(<span class='keyword'>float</span> *output, stbi_uc *input, <span class='keyword'>int</span> req_comp)</td></tr>
<tr class="codeline" data-linenumber="6643"><td class="num" id="LN6643">6643</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6644"><td class="num" id="LN6644">6644</td><td class="line">   <span class='keyword'>if</span> ( input[3] != 0 ) {</td></tr>
<tr class="codeline" data-linenumber="6645"><td class="num" id="LN6645">6645</td><td class="line">      <span class='keyword'>float</span> f1;</td></tr>
<tr class="codeline" data-linenumber="6646"><td class="num" id="LN6646">6646</td><td class="line">      <span class='comment'>// Exponent</span></td></tr>
<tr class="codeline" data-linenumber="6647"><td class="num" id="LN6647">6647</td><td class="line">      f1 = (<span class='keyword'>float</span>) ldexp(1.0f, input[3] - (<span class='keyword'>int</span>)(128 + 8));</td></tr>
<tr class="codeline" data-linenumber="6648"><td class="num" id="LN6648">6648</td><td class="line">      <span class='keyword'>if</span> (req_comp &lt;= 2)</td></tr>
<tr class="codeline" data-linenumber="6649"><td class="num" id="LN6649">6649</td><td class="line">         output[0] = (input[0] + input[1] + input[2]) * f1 / 3;</td></tr>
<tr class="codeline" data-linenumber="6650"><td class="num" id="LN6650">6650</td><td class="line">      <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6651"><td class="num" id="LN6651">6651</td><td class="line">         output[0] = input[0] * f1;</td></tr>
<tr class="codeline" data-linenumber="6652"><td class="num" id="LN6652">6652</td><td class="line">         output[1] = input[1] * f1;</td></tr>
<tr class="codeline" data-linenumber="6653"><td class="num" id="LN6653">6653</td><td class="line">         output[2] = input[2] * f1;</td></tr>
<tr class="codeline" data-linenumber="6654"><td class="num" id="LN6654">6654</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6655"><td class="num" id="LN6655">6655</td><td class="line">      <span class='keyword'>if</span> (req_comp == 2) output[1] = 1;</td></tr>
<tr class="codeline" data-linenumber="6656"><td class="num" id="LN6656">6656</td><td class="line">      <span class='keyword'>if</span> (req_comp == 4) output[3] = 1;</td></tr>
<tr class="codeline" data-linenumber="6657"><td class="num" id="LN6657">6657</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6658"><td class="num" id="LN6658">6658</td><td class="line">      <span class='keyword'>switch</span> (req_comp) {</td></tr>
<tr class="codeline" data-linenumber="6659"><td class="num" id="LN6659">6659</td><td class="line">         <span class='keyword'>case</span> 4: output[3] = 1; <span class='comment'>/* fallthrough */</span></td></tr>
<tr class="codeline" data-linenumber="6660"><td class="num" id="LN6660">6660</td><td class="line">         <span class='keyword'>case</span> 3: output[0] = output[1] = output[2] = 0;</td></tr>
<tr class="codeline" data-linenumber="6661"><td class="num" id="LN6661">6661</td><td class="line">                 <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6662"><td class="num" id="LN6662">6662</td><td class="line">         <span class='keyword'>case</span> 2: output[1] = 1; <span class='comment'>/* fallthrough */</span></td></tr>
<tr class="codeline" data-linenumber="6663"><td class="num" id="LN6663">6663</td><td class="line">         <span class='keyword'>case</span> 1: output[0] = 0;</td></tr>
<tr class="codeline" data-linenumber="6664"><td class="num" id="LN6664">6664</td><td class="line">                 <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6665"><td class="num" id="LN6665">6665</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6666"><td class="num" id="LN6666">6666</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6667"><td class="num" id="LN6667">6667</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6668"><td class="num" id="LN6668">6668</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6669"><td class="num" id="LN6669">6669</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>float</span> *stbi__hdr_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="6670"><td class="num" id="LN6670">6670</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6671"><td class="num" id="LN6671">6671</td><td class="line">   <span class='keyword'>char</span> buffer[<span class='macro'>STBI__HDR_BUFLEN<span class='macro_popup'>1024</span></span>];</td></tr>
<tr class="codeline" data-linenumber="6672"><td class="num" id="LN6672">6672</td><td class="line">   <span class='keyword'>char</span> *token;</td></tr>
<tr class="codeline" data-linenumber="6673"><td class="num" id="LN6673">6673</td><td class="line">   <span class='keyword'>int</span> valid = 0;</td></tr>
<tr class="codeline" data-linenumber="6674"><td class="num" id="LN6674">6674</td><td class="line">   <span class='keyword'>int</span> width, height;</td></tr>
<tr class="codeline" data-linenumber="6675"><td class="num" id="LN6675">6675</td><td class="line">   stbi_uc *scanline;</td></tr>
<tr class="codeline" data-linenumber="6676"><td class="num" id="LN6676">6676</td><td class="line">   <span class='keyword'>float</span> *hdr_data;</td></tr>
<tr class="codeline" data-linenumber="6677"><td class="num" id="LN6677">6677</td><td class="line">   <span class='keyword'>int</span> len;</td></tr>
<tr class="codeline" data-linenumber="6678"><td class="num" id="LN6678">6678</td><td class="line">   <span class='keyword'>unsigned</span> <span class='keyword'>char</span> count, value;</td></tr>
<tr class="codeline" data-linenumber="6679"><td class="num" id="LN6679">6679</td><td class="line">   <span class='keyword'>int</span> i, j, k, c1,c2, z;</td></tr>
<tr class="codeline" data-linenumber="6680"><td class="num" id="LN6680">6680</td><td class="line">   <span class='keyword'>const</span> <span class='keyword'>char</span> *headerToken;</td></tr>
<tr class="codeline" data-linenumber="6681"><td class="num" id="LN6681">6681</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6682"><td class="num" id="LN6682">6682</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6683"><td class="num" id="LN6683">6683</td><td class="line">   <span class='comment'>// Check identifier</span></td></tr>
<tr class="codeline" data-linenumber="6684"><td class="num" id="LN6684">6684</td><td class="line">   headerToken = stbi__hdr_gettoken(s,buffer);</td></tr>
<tr class="codeline" data-linenumber="6685"><td class="num" id="LN6685">6685</td><td class="line">   <span class='keyword'>if</span> (strcmp(headerToken, <span class='string_literal'>"#?RADIANCE"</span>) != 0 &amp;&amp; strcmp(headerToken, <span class='string_literal'>"#?RGBE"</span>) != 0)</td></tr>
<tr class="codeline" data-linenumber="6686"><td class="num" id="LN6686">6686</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"not HDR"</span>, <span class='string_literal'>"Corrupt HDR image"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("not HDR")?((void*)0):((void*)0<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6687"><td class="num" id="LN6687">6687</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6688"><td class="num" id="LN6688">6688</td><td class="line">   <span class='comment'>// Parse header</span></td></tr>
<tr class="codeline" data-linenumber="6689"><td class="num" id="LN6689">6689</td><td class="line">   <span class='keyword'>for</span>(;;) {</td></tr>
<tr class="codeline" data-linenumber="6690"><td class="num" id="LN6690">6690</td><td class="line">      token = stbi__hdr_gettoken(s,buffer);</td></tr>
<tr class="codeline" data-linenumber="6691"><td class="num" id="LN6691">6691</td><td class="line">      <span class='keyword'>if</span> (token[0] == 0) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6692"><td class="num" id="LN6692">6692</td><td class="line">      <span class='keyword'>if</span> (strcmp(token, <span class='string_literal'>"FORMAT=32-bit_rle_rgbe"</span>) == 0) valid = 1;</td></tr>
<tr class="codeline" data-linenumber="6693"><td class="num" id="LN6693">6693</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6694"><td class="num" id="LN6694">6694</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6695"><td class="num" id="LN6695">6695</td><td class="line">   <span class='keyword'>if</span> (!valid)    <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"unsupported format"</span>, <span class='string_literal'>"Unsupported HDR format"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("unsupported format")?((void*)0<br>):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6696"><td class="num" id="LN6696">6696</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6697"><td class="num" id="LN6697">6697</td><td class="line">   <span class='comment'>// Parse width and height</span></td></tr>
<tr class="codeline" data-linenumber="6698"><td class="num" id="LN6698">6698</td><td class="line">   <span class='comment'>// can't use sscanf() if we're not using stdio!</span></td></tr>
<tr class="codeline" data-linenumber="6699"><td class="num" id="LN6699">6699</td><td class="line">   token = stbi__hdr_gettoken(s,buffer);</td></tr>
<tr class="codeline" data-linenumber="6700"><td class="num" id="LN6700">6700</td><td class="line">   <span class='keyword'>if</span> (strncmp(token, <span class='string_literal'>"-Y "</span>, 3))  <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"unsupported data layout"</span>, <span class='string_literal'>"Unsupported HDR format"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("unsupported data layout")?((void<br>*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6701"><td class="num" id="LN6701">6701</td><td class="line">   token += 3;</td></tr>
<tr class="codeline" data-linenumber="6702"><td class="num" id="LN6702">6702</td><td class="line">   height = (<span class='keyword'>int</span>) strtol(token, &amp;token, 10);</td></tr>
<tr class="codeline" data-linenumber="6703"><td class="num" id="LN6703">6703</td><td class="line">   <span class='keyword'>while</span> (*token == ' ') ++token;</td></tr>
<tr class="codeline" data-linenumber="6704"><td class="num" id="LN6704">6704</td><td class="line">   <span class='keyword'>if</span> (strncmp(token, <span class='string_literal'>"+X "</span>, 3))  <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"unsupported data layout"</span>, <span class='string_literal'>"Unsupported HDR format"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("unsupported data layout")?((void<br>*)0):((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6705"><td class="num" id="LN6705">6705</td><td class="line">   token += 3;</td></tr>
<tr class="codeline" data-linenumber="6706"><td class="num" id="LN6706">6706</td><td class="line">   width = (<span class='keyword'>int</span>) strtol(token, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 10);</td></tr>
<tr class="codeline" data-linenumber="6707"><td class="num" id="LN6707">6707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6708"><td class="num" id="LN6708">6708</td><td class="line">   *x = width;</td></tr>
<tr class="codeline" data-linenumber="6709"><td class="num" id="LN6709">6709</td><td class="line">   *y = height;</td></tr>
<tr class="codeline" data-linenumber="6710"><td class="num" id="LN6710">6710</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6711"><td class="num" id="LN6711">6711</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = 3;</td></tr>
<tr class="codeline" data-linenumber="6712"><td class="num" id="LN6712">6712</td><td class="line">   <span class='keyword'>if</span> (req_comp == 0) req_comp = 3;</td></tr>
<tr class="codeline" data-linenumber="6713"><td class="num" id="LN6713">6713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6714"><td class="num" id="LN6714">6714</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad4sizes_valid(width, height, req_comp, <span class='keyword'>sizeof</span>(<span class='keyword'>float</span>), 0))</td></tr>
<tr class="codeline" data-linenumber="6715"><td class="num" id="LN6715">6715</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"HDR image is too large"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("too large")?((void*)0):((void*<br>)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6716"><td class="num" id="LN6716">6716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6717"><td class="num" id="LN6717">6717</td><td class="line">   <span class='comment'>// Read data</span></td></tr>
<tr class="codeline" data-linenumber="6718"><td class="num" id="LN6718">6718</td><td class="line">   hdr_data = (<span class='keyword'>float</span> *) stbi__malloc_mad4(width, height, req_comp, <span class='keyword'>sizeof</span>(<span class='keyword'>float</span>), 0);</td></tr>
<tr class="codeline" data-linenumber="6719"><td class="num" id="LN6719">6719</td><td class="line">   <span class='keyword'>if</span> (!hdr_data)</td></tr>
<tr class="codeline" data-linenumber="6720"><td class="num" id="LN6720">6720</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("outofmem")?((void*)0):((void*)<br>0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6721"><td class="num" id="LN6721">6721</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6722"><td class="num" id="LN6722">6722</td><td class="line">   <span class='comment'>// Load image data</span></td></tr>
<tr class="codeline" data-linenumber="6723"><td class="num" id="LN6723">6723</td><td class="line">   <span class='comment'>// image data is stored as some number of sca</span></td></tr>
<tr class="codeline" data-linenumber="6724"><td class="num" id="LN6724">6724</td><td class="line">   <span class='keyword'>if</span> ( width &lt; 8 || width &gt;= 32768) {</td></tr>
<tr class="codeline" data-linenumber="6725"><td class="num" id="LN6725">6725</td><td class="line">      <span class='comment'>// Read flat data</span></td></tr>
<tr class="codeline" data-linenumber="6726"><td class="num" id="LN6726">6726</td><td class="line">      <span class='keyword'>for</span> (j=0; j &lt; height; ++j) {</td></tr>
<tr class="codeline" data-linenumber="6727"><td class="num" id="LN6727">6727</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; width; ++i) {</td></tr>
<tr class="codeline" data-linenumber="6728"><td class="num" id="LN6728">6728</td><td class="line">            stbi_uc rgbe[4];</td></tr>
<tr class="codeline" data-linenumber="6729"><td class="num" id="LN6729">6729</td><td class="line">           main_decode_loop:</td></tr>
<tr class="codeline" data-linenumber="6730"><td class="num" id="LN6730">6730</td><td class="line">            stbi__getn(s, rgbe, 4);</td></tr>
<tr class="codeline" data-linenumber="6731"><td class="num" id="LN6731">6731</td><td class="line">            stbi__hdr_convert(hdr_data + j * width * req_comp + i * req_comp, rgbe, req_comp);</td></tr>
<tr class="codeline" data-linenumber="6732"><td class="num" id="LN6732">6732</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6733"><td class="num" id="LN6733">6733</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6734"><td class="num" id="LN6734">6734</td><td class="line">   } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6735"><td class="num" id="LN6735">6735</td><td class="line">      <span class='comment'>// Read RLE-encoded data</span></td></tr>
<tr class="codeline" data-linenumber="6736"><td class="num" id="LN6736">6736</td><td class="line">      scanline = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6737"><td class="num" id="LN6737">6737</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6738"><td class="num" id="LN6738">6738</td><td class="line">      <span class='keyword'>for</span> (j = 0; j &lt; height; ++j) {</td></tr>
<tr class="codeline" data-linenumber="6739"><td class="num" id="LN6739">6739</td><td class="line">         c1 = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6740"><td class="num" id="LN6740">6740</td><td class="line">         c2 = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6741"><td class="num" id="LN6741">6741</td><td class="line">         len = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6742"><td class="num" id="LN6742">6742</td><td class="line">         <span class='keyword'>if</span> (c1 != 2 || c2 != 2 || (len &amp; 0x80)) {</td></tr>
<tr class="codeline" data-linenumber="6743"><td class="num" id="LN6743">6743</td><td class="line">            <span class='comment'>// not run-length encoded, so we have to actually use THIS data as a decoded</span></td></tr>
<tr class="codeline" data-linenumber="6744"><td class="num" id="LN6744">6744</td><td class="line">            <span class='comment'>// pixel (note this can't be a valid pixel--one of RGB must be &gt;= 128)</span></td></tr>
<tr class="codeline" data-linenumber="6745"><td class="num" id="LN6745">6745</td><td class="line">            stbi_uc rgbe[4];</td></tr>
<tr class="codeline" data-linenumber="6746"><td class="num" id="LN6746">6746</td><td class="line">            rgbe[0] = (stbi_uc) c1;</td></tr>
<tr class="codeline" data-linenumber="6747"><td class="num" id="LN6747">6747</td><td class="line">            rgbe[1] = (stbi_uc) c2;</td></tr>
<tr class="codeline" data-linenumber="6748"><td class="num" id="LN6748">6748</td><td class="line">            rgbe[2] = (stbi_uc) len;</td></tr>
<tr class="codeline" data-linenumber="6749"><td class="num" id="LN6749">6749</td><td class="line">            rgbe[3] = (stbi_uc) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6750"><td class="num" id="LN6750">6750</td><td class="line">            stbi__hdr_convert(hdr_data, rgbe, req_comp);</td></tr>
<tr class="codeline" data-linenumber="6751"><td class="num" id="LN6751">6751</td><td class="line">            i = 1;</td></tr>
<tr class="codeline" data-linenumber="6752"><td class="num" id="LN6752">6752</td><td class="line">            j = 0;</td></tr>
<tr class="codeline" data-linenumber="6753"><td class="num" id="LN6753">6753</td><td class="line">            <span class='macro'>STBI_FREE(scanline)<span class='macro_popup'>free(scanline)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6754"><td class="num" id="LN6754">6754</td><td class="line">            <span class='keyword'>goto</span> main_decode_loop; <span class='comment'>// yes, this makes no sense</span></td></tr>
<tr class="codeline" data-linenumber="6755"><td class="num" id="LN6755">6755</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6756"><td class="num" id="LN6756">6756</td><td class="line">         len &lt;&lt;= 8;</td></tr>
<tr class="codeline" data-linenumber="6757"><td class="num" id="LN6757">6757</td><td class="line">         len |= stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6758"><td class="num" id="LN6758">6758</td><td class="line">         <span class='keyword'>if</span> (len != width) { <span class='macro'>STBI_FREE(hdr_data)<span class='macro_popup'>free(hdr_data)</span></span>; <span class='macro'>STBI_FREE(scanline)<span class='macro_popup'>free(scanline)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"invalid decoded scanline length"</span>, <span class='string_literal'>"corrupt HDR"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("invalid decoded scanline length"<br>)?((void*)0):((void*)0)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="6759"><td class="num" id="LN6759">6759</td><td class="line">         <span class='keyword'>if</span> (scanline == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="6760"><td class="num" id="LN6760">6760</td><td class="line">            scanline = (stbi_uc *) stbi__malloc_mad2(width, 4, 0);</td></tr>
<tr class="codeline" data-linenumber="6761"><td class="num" id="LN6761">6761</td><td class="line">            <span class='keyword'>if</span> (!scanline) {</td></tr>
<tr class="codeline" data-linenumber="6762"><td class="num" id="LN6762">6762</td><td class="line">               <span class='macro'>STBI_FREE(hdr_data)<span class='macro_popup'>free(hdr_data)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6763"><td class="num" id="LN6763">6763</td><td class="line">               <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("outofmem")?((void*)0):((void*)<br>0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6764"><td class="num" id="LN6764">6764</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6765"><td class="num" id="LN6765">6765</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6766"><td class="num" id="LN6766">6766</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6767"><td class="num" id="LN6767">6767</td><td class="line">         <span class='keyword'>for</span> (k = 0; k &lt; 4; ++k) {</td></tr>
<tr class="codeline" data-linenumber="6768"><td class="num" id="LN6768">6768</td><td class="line">            <span class='keyword'>int</span> nleft;</td></tr>
<tr class="codeline" data-linenumber="6769"><td class="num" id="LN6769">6769</td><td class="line">            i = 0;</td></tr>
<tr class="codeline" data-linenumber="6770"><td class="num" id="LN6770">6770</td><td class="line">            <span class='keyword'>while</span> ((nleft = width - i) &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="6771"><td class="num" id="LN6771">6771</td><td class="line">               count = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6772"><td class="num" id="LN6772">6772</td><td class="line">               <span class='keyword'>if</span> (count &gt; 128) {</td></tr>
<tr class="codeline" data-linenumber="6773"><td class="num" id="LN6773">6773</td><td class="line">                  <span class='comment'>// Run</span></td></tr>
<tr class="codeline" data-linenumber="6774"><td class="num" id="LN6774">6774</td><td class="line">                  value = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6775"><td class="num" id="LN6775">6775</td><td class="line">                  count -= 128;</td></tr>
<tr class="codeline" data-linenumber="6776"><td class="num" id="LN6776">6776</td><td class="line">                  <span class='keyword'>if</span> (count &gt; nleft) { <span class='macro'>STBI_FREE(hdr_data)<span class='macro_popup'>free(hdr_data)</span></span>; <span class='macro'>STBI_FREE(scanline)<span class='macro_popup'>free(scanline)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"corrupt"</span>, <span class='string_literal'>"bad RLE data in HDR"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("corrupt")?((void*)0):((void*)0<br>)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="6777"><td class="num" id="LN6777">6777</td><td class="line">                  <span class='keyword'>for</span> (z = 0; z &lt; count; ++z)</td></tr>
<tr class="codeline" data-linenumber="6778"><td class="num" id="LN6778">6778</td><td class="line">                     scanline[i++ * 4 + k] = value;</td></tr>
<tr class="codeline" data-linenumber="6779"><td class="num" id="LN6779">6779</td><td class="line">               } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="6780"><td class="num" id="LN6780">6780</td><td class="line">                  <span class='comment'>// Dump</span></td></tr>
<tr class="codeline" data-linenumber="6781"><td class="num" id="LN6781">6781</td><td class="line">                  <span class='keyword'>if</span> (count &gt; nleft) { <span class='macro'>STBI_FREE(hdr_data)<span class='macro_popup'>free(hdr_data)</span></span>; <span class='macro'>STBI_FREE(scanline)<span class='macro_popup'>free(scanline)</span></span>; <span class='keyword'>return</span> <span class='macro'>stbi__errpf(<span class='string_literal'>"corrupt"</span>, <span class='string_literal'>"bad RLE data in HDR"</span>)<span class='macro_popup'>((float *)(size_t) (stbi__err("corrupt")?((void*)0):((void*)0<br>)))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="6782"><td class="num" id="LN6782">6782</td><td class="line">                  <span class='keyword'>for</span> (z = 0; z &lt; count; ++z)</td></tr>
<tr class="codeline" data-linenumber="6783"><td class="num" id="LN6783">6783</td><td class="line">                     scanline[i++ * 4 + k] = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6784"><td class="num" id="LN6784">6784</td><td class="line">               }</td></tr>
<tr class="codeline" data-linenumber="6785"><td class="num" id="LN6785">6785</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="6786"><td class="num" id="LN6786">6786</td><td class="line">         }</td></tr>
<tr class="codeline" data-linenumber="6787"><td class="num" id="LN6787">6787</td><td class="line">         <span class='keyword'>for</span> (i=0; i &lt; width; ++i)</td></tr>
<tr class="codeline" data-linenumber="6788"><td class="num" id="LN6788">6788</td><td class="line">            stbi__hdr_convert(hdr_data+(j*width + i)*req_comp, scanline + i*4, req_comp);</td></tr>
<tr class="codeline" data-linenumber="6789"><td class="num" id="LN6789">6789</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6790"><td class="num" id="LN6790">6790</td><td class="line">      <span class='keyword'>if</span> (scanline)</td></tr>
<tr class="codeline" data-linenumber="6791"><td class="num" id="LN6791">6791</td><td class="line">         <span class='macro'>STBI_FREE(scanline)<span class='macro_popup'>free(scanline)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="6792"><td class="num" id="LN6792">6792</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6793"><td class="num" id="LN6793">6793</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6794"><td class="num" id="LN6794">6794</td><td class="line">   <span class='keyword'>return</span> hdr_data;</td></tr>
<tr class="codeline" data-linenumber="6795"><td class="num" id="LN6795">6795</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6796"><td class="num" id="LN6796">6796</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6797"><td class="num" id="LN6797">6797</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__hdr_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="6798"><td class="num" id="LN6798">6798</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6799"><td class="num" id="LN6799">6799</td><td class="line">   <span class='keyword'>char</span> buffer[<span class='macro'>STBI__HDR_BUFLEN<span class='macro_popup'>1024</span></span>];</td></tr>
<tr class="codeline" data-linenumber="6800"><td class="num" id="LN6800">6800</td><td class="line">   <span class='keyword'>char</span> *token;</td></tr>
<tr class="codeline" data-linenumber="6801"><td class="num" id="LN6801">6801</td><td class="line">   <span class='keyword'>int</span> valid = 0;</td></tr>
<tr class="codeline" data-linenumber="6802"><td class="num" id="LN6802">6802</td><td class="line">   <span class='keyword'>int</span> dummy;</td></tr>
<tr class="codeline" data-linenumber="6803"><td class="num" id="LN6803">6803</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6804"><td class="num" id="LN6804">6804</td><td class="line">   <span class='keyword'>if</span> (!x) x = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6805"><td class="num" id="LN6805">6805</td><td class="line">   <span class='keyword'>if</span> (!y) y = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6806"><td class="num" id="LN6806">6806</td><td class="line">   <span class='keyword'>if</span> (!comp) comp = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6807"><td class="num" id="LN6807">6807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6808"><td class="num" id="LN6808">6808</td><td class="line">   <span class='keyword'>if</span> (stbi__hdr_test(s) == 0) {</td></tr>
<tr class="codeline" data-linenumber="6809"><td class="num" id="LN6809">6809</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6810"><td class="num" id="LN6810">6810</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6811"><td class="num" id="LN6811">6811</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6812"><td class="num" id="LN6812">6812</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6813"><td class="num" id="LN6813">6813</td><td class="line">   <span class='keyword'>for</span>(;;) {</td></tr>
<tr class="codeline" data-linenumber="6814"><td class="num" id="LN6814">6814</td><td class="line">      token = stbi__hdr_gettoken(s,buffer);</td></tr>
<tr class="codeline" data-linenumber="6815"><td class="num" id="LN6815">6815</td><td class="line">      <span class='keyword'>if</span> (token[0] == 0) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="6816"><td class="num" id="LN6816">6816</td><td class="line">      <span class='keyword'>if</span> (strcmp(token, <span class='string_literal'>"FORMAT=32-bit_rle_rgbe"</span>) == 0) valid = 1;</td></tr>
<tr class="codeline" data-linenumber="6817"><td class="num" id="LN6817">6817</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6818"><td class="num" id="LN6818">6818</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6819"><td class="num" id="LN6819">6819</td><td class="line">   <span class='keyword'>if</span> (!valid) {</td></tr>
<tr class="codeline" data-linenumber="6820"><td class="num" id="LN6820">6820</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6821"><td class="num" id="LN6821">6821</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6822"><td class="num" id="LN6822">6822</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6823"><td class="num" id="LN6823">6823</td><td class="line">   token = stbi__hdr_gettoken(s,buffer);</td></tr>
<tr class="codeline" data-linenumber="6824"><td class="num" id="LN6824">6824</td><td class="line">   <span class='keyword'>if</span> (strncmp(token, <span class='string_literal'>"-Y "</span>, 3)) {</td></tr>
<tr class="codeline" data-linenumber="6825"><td class="num" id="LN6825">6825</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6826"><td class="num" id="LN6826">6826</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6827"><td class="num" id="LN6827">6827</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6828"><td class="num" id="LN6828">6828</td><td class="line">   token += 3;</td></tr>
<tr class="codeline" data-linenumber="6829"><td class="num" id="LN6829">6829</td><td class="line">   *y = (<span class='keyword'>int</span>) strtol(token, &amp;token, 10);</td></tr>
<tr class="codeline" data-linenumber="6830"><td class="num" id="LN6830">6830</td><td class="line">   <span class='keyword'>while</span> (*token == ' ') ++token;</td></tr>
<tr class="codeline" data-linenumber="6831"><td class="num" id="LN6831">6831</td><td class="line">   <span class='keyword'>if</span> (strncmp(token, <span class='string_literal'>"+X "</span>, 3)) {</td></tr>
<tr class="codeline" data-linenumber="6832"><td class="num" id="LN6832">6832</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6833"><td class="num" id="LN6833">6833</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6834"><td class="num" id="LN6834">6834</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6835"><td class="num" id="LN6835">6835</td><td class="line">   token += 3;</td></tr>
<tr class="codeline" data-linenumber="6836"><td class="num" id="LN6836">6836</td><td class="line">   *x = (<span class='keyword'>int</span>) strtol(token, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 10);</td></tr>
<tr class="codeline" data-linenumber="6837"><td class="num" id="LN6837">6837</td><td class="line">   *comp = 3;</td></tr>
<tr class="codeline" data-linenumber="6838"><td class="num" id="LN6838">6838</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6839"><td class="num" id="LN6839">6839</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6840"><td class="num" id="LN6840">6840</td><td class="line"><span class='directive'>#endif // STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="6841"><td class="num" id="LN6841">6841</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6842"><td class="num" id="LN6842">6842</td><td class="line"><span class='directive'>#ifndef STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="6843"><td class="num" id="LN6843">6843</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__bmp_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="6844"><td class="num" id="LN6844">6844</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6845"><td class="num" id="LN6845">6845</td><td class="line">   <span class='keyword'>void</span> *p;</td></tr>
<tr class="codeline" data-linenumber="6846"><td class="num" id="LN6846">6846</td><td class="line">   stbi__bmp_data info;</td></tr>
<tr class="codeline" data-linenumber="6847"><td class="num" id="LN6847">6847</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6848"><td class="num" id="LN6848">6848</td><td class="line">   info.all_a = 255;</td></tr>
<tr class="codeline" data-linenumber="6849"><td class="num" id="LN6849">6849</td><td class="line">   p = stbi__bmp_parse_header(s, &amp;info);</td></tr>
<tr class="codeline" data-linenumber="6850"><td class="num" id="LN6850">6850</td><td class="line">   stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6851"><td class="num" id="LN6851">6851</td><td class="line">   <span class='keyword'>if</span> (p == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="6852"><td class="num" id="LN6852">6852</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6853"><td class="num" id="LN6853">6853</td><td class="line">   <span class='keyword'>if</span> (x) *x = s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="6854"><td class="num" id="LN6854">6854</td><td class="line">   <span class='keyword'>if</span> (y) *y = s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="6855"><td class="num" id="LN6855">6855</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = info.ma ? 4 : 3;</td></tr>
<tr class="codeline" data-linenumber="6856"><td class="num" id="LN6856">6856</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6857"><td class="num" id="LN6857">6857</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6858"><td class="num" id="LN6858">6858</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="6859"><td class="num" id="LN6859">6859</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6860"><td class="num" id="LN6860">6860</td><td class="line"><span class='directive'>#ifndef STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="6861"><td class="num" id="LN6861">6861</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__psd_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="6862"><td class="num" id="LN6862">6862</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6863"><td class="num" id="LN6863">6863</td><td class="line">   <span class='keyword'>int</span> channelCount, dummy, depth;</td></tr>
<tr class="codeline" data-linenumber="6864"><td class="num" id="LN6864">6864</td><td class="line">   <span class='keyword'>if</span> (!x) x = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6865"><td class="num" id="LN6865">6865</td><td class="line">   <span class='keyword'>if</span> (!y) y = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6866"><td class="num" id="LN6866">6866</td><td class="line">   <span class='keyword'>if</span> (!comp) comp = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6867"><td class="num" id="LN6867">6867</td><td class="line">   <span class='keyword'>if</span> (stbi__get32be(s) != 0x38425053) {</td></tr>
<tr class="codeline" data-linenumber="6868"><td class="num" id="LN6868">6868</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6869"><td class="num" id="LN6869">6869</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6870"><td class="num" id="LN6870">6870</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6871"><td class="num" id="LN6871">6871</td><td class="line">   <span class='keyword'>if</span> (stbi__get16be(s) != 1) {</td></tr>
<tr class="codeline" data-linenumber="6872"><td class="num" id="LN6872">6872</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6873"><td class="num" id="LN6873">6873</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6874"><td class="num" id="LN6874">6874</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6875"><td class="num" id="LN6875">6875</td><td class="line">   stbi__skip(s, 6);</td></tr>
<tr class="codeline" data-linenumber="6876"><td class="num" id="LN6876">6876</td><td class="line">   channelCount = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6877"><td class="num" id="LN6877">6877</td><td class="line">   <span class='keyword'>if</span> (channelCount &lt; 0 || channelCount &gt; 16) {</td></tr>
<tr class="codeline" data-linenumber="6878"><td class="num" id="LN6878">6878</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6879"><td class="num" id="LN6879">6879</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6880"><td class="num" id="LN6880">6880</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6881"><td class="num" id="LN6881">6881</td><td class="line">   *y = stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="6882"><td class="num" id="LN6882">6882</td><td class="line">   *x = stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="6883"><td class="num" id="LN6883">6883</td><td class="line">   depth = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6884"><td class="num" id="LN6884">6884</td><td class="line">   <span class='keyword'>if</span> (depth != 8 &amp;&amp; depth != 16) {</td></tr>
<tr class="codeline" data-linenumber="6885"><td class="num" id="LN6885">6885</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6886"><td class="num" id="LN6886">6886</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6887"><td class="num" id="LN6887">6887</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6888"><td class="num" id="LN6888">6888</td><td class="line">   <span class='keyword'>if</span> (stbi__get16be(s) != 3) {</td></tr>
<tr class="codeline" data-linenumber="6889"><td class="num" id="LN6889">6889</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6890"><td class="num" id="LN6890">6890</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6891"><td class="num" id="LN6891">6891</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6892"><td class="num" id="LN6892">6892</td><td class="line">   *comp = 4;</td></tr>
<tr class="codeline" data-linenumber="6893"><td class="num" id="LN6893">6893</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6894"><td class="num" id="LN6894">6894</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6895"><td class="num" id="LN6895">6895</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6896"><td class="num" id="LN6896">6896</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__psd_is16(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="6897"><td class="num" id="LN6897">6897</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6898"><td class="num" id="LN6898">6898</td><td class="line">   <span class='keyword'>int</span> channelCount, depth;</td></tr>
<tr class="codeline" data-linenumber="6899"><td class="num" id="LN6899">6899</td><td class="line">   <span class='keyword'>if</span> (stbi__get32be(s) != 0x38425053) {</td></tr>
<tr class="codeline" data-linenumber="6900"><td class="num" id="LN6900">6900</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6901"><td class="num" id="LN6901">6901</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6902"><td class="num" id="LN6902">6902</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6903"><td class="num" id="LN6903">6903</td><td class="line">   <span class='keyword'>if</span> (stbi__get16be(s) != 1) {</td></tr>
<tr class="codeline" data-linenumber="6904"><td class="num" id="LN6904">6904</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6905"><td class="num" id="LN6905">6905</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6906"><td class="num" id="LN6906">6906</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6907"><td class="num" id="LN6907">6907</td><td class="line">   stbi__skip(s, 6);</td></tr>
<tr class="codeline" data-linenumber="6908"><td class="num" id="LN6908">6908</td><td class="line">   channelCount = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6909"><td class="num" id="LN6909">6909</td><td class="line">   <span class='keyword'>if</span> (channelCount &lt; 0 || channelCount &gt; 16) {</td></tr>
<tr class="codeline" data-linenumber="6910"><td class="num" id="LN6910">6910</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6911"><td class="num" id="LN6911">6911</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6912"><td class="num" id="LN6912">6912</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6913"><td class="num" id="LN6913">6913</td><td class="line">   (<span class='keyword'>void</span>) stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="6914"><td class="num" id="LN6914">6914</td><td class="line">   (<span class='keyword'>void</span>) stbi__get32be(s);</td></tr>
<tr class="codeline" data-linenumber="6915"><td class="num" id="LN6915">6915</td><td class="line">   depth = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6916"><td class="num" id="LN6916">6916</td><td class="line">   <span class='keyword'>if</span> (depth != 16) {</td></tr>
<tr class="codeline" data-linenumber="6917"><td class="num" id="LN6917">6917</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6918"><td class="num" id="LN6918">6918</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6919"><td class="num" id="LN6919">6919</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6920"><td class="num" id="LN6920">6920</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6921"><td class="num" id="LN6921">6921</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6922"><td class="num" id="LN6922">6922</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="6923"><td class="num" id="LN6923">6923</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6924"><td class="num" id="LN6924">6924</td><td class="line"><span class='directive'>#ifndef STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="6925"><td class="num" id="LN6925">6925</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__pic_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="6926"><td class="num" id="LN6926">6926</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6927"><td class="num" id="LN6927">6927</td><td class="line">   <span class='keyword'>int</span> act_comp=0,num_packets=0,chained,dummy;</td></tr>
<tr class="codeline" data-linenumber="6928"><td class="num" id="LN6928">6928</td><td class="line">   stbi__pic_packet packets[10];</td></tr>
<tr class="codeline" data-linenumber="6929"><td class="num" id="LN6929">6929</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6930"><td class="num" id="LN6930">6930</td><td class="line">   <span class='keyword'>if</span> (!x) x = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6931"><td class="num" id="LN6931">6931</td><td class="line">   <span class='keyword'>if</span> (!y) y = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6932"><td class="num" id="LN6932">6932</td><td class="line">   <span class='keyword'>if</span> (!comp) comp = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="6933"><td class="num" id="LN6933">6933</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6934"><td class="num" id="LN6934">6934</td><td class="line">   <span class='keyword'>if</span> (!stbi__pic_is4(s,<span class='string_literal'>"\x53\x80\xF6\x34"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="6935"><td class="num" id="LN6935">6935</td><td class="line">      stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="6936"><td class="num" id="LN6936">6936</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6937"><td class="num" id="LN6937">6937</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6938"><td class="num" id="LN6938">6938</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6939"><td class="num" id="LN6939">6939</td><td class="line">   stbi__skip(s, 88);</td></tr>
<tr class="codeline" data-linenumber="6940"><td class="num" id="LN6940">6940</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6941"><td class="num" id="LN6941">6941</td><td class="line">   *x = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6942"><td class="num" id="LN6942">6942</td><td class="line">   *y = stbi__get16be(s);</td></tr>
<tr class="codeline" data-linenumber="6943"><td class="num" id="LN6943">6943</td><td class="line">   <span class='keyword'>if</span> (stbi__at_eof(s)) {</td></tr>
<tr class="codeline" data-linenumber="6944"><td class="num" id="LN6944">6944</td><td class="line">      stbi__rewind( s);</td></tr>
<tr class="codeline" data-linenumber="6945"><td class="num" id="LN6945">6945</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6946"><td class="num" id="LN6946">6946</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6947"><td class="num" id="LN6947">6947</td><td class="line">   <span class='keyword'>if</span> ( (*x) != 0 &amp;&amp; (1 &lt;&lt; 28) / (*x) &lt; (*y)) {</td></tr>
<tr class="codeline" data-linenumber="6948"><td class="num" id="LN6948">6948</td><td class="line">      stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6949"><td class="num" id="LN6949">6949</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6950"><td class="num" id="LN6950">6950</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="6951"><td class="num" id="LN6951">6951</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6952"><td class="num" id="LN6952">6952</td><td class="line">   stbi__skip(s, 8);</td></tr>
<tr class="codeline" data-linenumber="6953"><td class="num" id="LN6953">6953</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6954"><td class="num" id="LN6954">6954</td><td class="line">   <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="6955"><td class="num" id="LN6955">6955</td><td class="line">      stbi__pic_packet *packet;</td></tr>
<tr class="codeline" data-linenumber="6956"><td class="num" id="LN6956">6956</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6957"><td class="num" id="LN6957">6957</td><td class="line">      <span class='keyword'>if</span> (num_packets==<span class='keyword'>sizeof</span>(packets)/<span class='keyword'>sizeof</span>(packets[0]))</td></tr>
<tr class="codeline" data-linenumber="6958"><td class="num" id="LN6958">6958</td><td class="line">         <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6959"><td class="num" id="LN6959">6959</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6960"><td class="num" id="LN6960">6960</td><td class="line">      packet = &amp;packets[num_packets++];</td></tr>
<tr class="codeline" data-linenumber="6961"><td class="num" id="LN6961">6961</td><td class="line">      chained = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6962"><td class="num" id="LN6962">6962</td><td class="line">      packet-&gt;size    = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6963"><td class="num" id="LN6963">6963</td><td class="line">      packet-&gt;type    = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6964"><td class="num" id="LN6964">6964</td><td class="line">      packet-&gt;channel = stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="6965"><td class="num" id="LN6965">6965</td><td class="line">      act_comp |= packet-&gt;channel;</td></tr>
<tr class="codeline" data-linenumber="6966"><td class="num" id="LN6966">6966</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6967"><td class="num" id="LN6967">6967</td><td class="line">      <span class='keyword'>if</span> (stbi__at_eof(s)) {</td></tr>
<tr class="codeline" data-linenumber="6968"><td class="num" id="LN6968">6968</td><td class="line">          stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6969"><td class="num" id="LN6969">6969</td><td class="line">          <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6970"><td class="num" id="LN6970">6970</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6971"><td class="num" id="LN6971">6971</td><td class="line">      <span class='keyword'>if</span> (packet-&gt;size != 8) {</td></tr>
<tr class="codeline" data-linenumber="6972"><td class="num" id="LN6972">6972</td><td class="line">          stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="6973"><td class="num" id="LN6973">6973</td><td class="line">          <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="6974"><td class="num" id="LN6974">6974</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="6975"><td class="num" id="LN6975">6975</td><td class="line">   } <span class='keyword'>while</span> (chained);</td></tr>
<tr class="codeline" data-linenumber="6976"><td class="num" id="LN6976">6976</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6977"><td class="num" id="LN6977">6977</td><td class="line">   *comp = (act_comp &amp; 0x10 ? 4 : 3);</td></tr>
<tr class="codeline" data-linenumber="6978"><td class="num" id="LN6978">6978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6979"><td class="num" id="LN6979">6979</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="6980"><td class="num" id="LN6980">6980</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="6981"><td class="num" id="LN6981">6981</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="6982"><td class="num" id="LN6982">6982</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6983"><td class="num" id="LN6983">6983</td><td class="line"><span class='comment'>// *************************************************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="6984"><td class="num" id="LN6984">6984</td><td class="line"><span class='comment'>// Portable Gray Map and Portable Pixel Map loader</span></td></tr>
<tr class="codeline" data-linenumber="6985"><td class="num" id="LN6985">6985</td><td class="line"><span class='comment'>// by Ken Miller</span></td></tr>
<tr class="codeline" data-linenumber="6986"><td class="num" id="LN6986">6986</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="6987"><td class="num" id="LN6987">6987</td><td class="line"><span class='comment'>// PGM: http://netpbm.sourceforge.net/doc/pgm.html</span></td></tr>
<tr class="codeline" data-linenumber="6988"><td class="num" id="LN6988">6988</td><td class="line"><span class='comment'>// PPM: http://netpbm.sourceforge.net/doc/ppm.html</span></td></tr>
<tr class="codeline" data-linenumber="6989"><td class="num" id="LN6989">6989</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="6990"><td class="num" id="LN6990">6990</td><td class="line"><span class='comment'>// Known limitations:</span></td></tr>
<tr class="codeline" data-linenumber="6991"><td class="num" id="LN6991">6991</td><td class="line"><span class='comment'>//    Does not support comments in the header section</span></td></tr>
<tr class="codeline" data-linenumber="6992"><td class="num" id="LN6992">6992</td><td class="line"><span class='comment'>//    Does not support ASCII image data (formats P2 and P3)</span></td></tr>
<tr class="codeline" data-linenumber="6993"><td class="num" id="LN6993">6993</td><td class="line"><span class='comment'>//    Does not support 16-bit-per-channel</span></td></tr>
<tr class="codeline" data-linenumber="6994"><td class="num" id="LN6994">6994</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6995"><td class="num" id="LN6995">6995</td><td class="line"><span class='directive'>#ifndef STBI_NO_PNM</span></td></tr>
<tr class="codeline" data-linenumber="6996"><td class="num" id="LN6996">6996</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6997"><td class="num" id="LN6997">6997</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_test(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="6998"><td class="num" id="LN6998">6998</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="6999"><td class="num" id="LN6999">6999</td><td class="line">   <span class='keyword'>char</span> p, t;</td></tr>
<tr class="codeline" data-linenumber="7000"><td class="num" id="LN7000">7000</td><td class="line">   p = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7001"><td class="num" id="LN7001">7001</td><td class="line">   t = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7002"><td class="num" id="LN7002">7002</td><td class="line">   <span class='keyword'>if</span> (p != 'P' || (t != '5' &amp;&amp; t != '6')) {</td></tr>
<tr class="codeline" data-linenumber="7003"><td class="num" id="LN7003">7003</td><td class="line">       stbi__rewind( s );</td></tr>
<tr class="codeline" data-linenumber="7004"><td class="num" id="LN7004">7004</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="7005"><td class="num" id="LN7005">7005</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="7006"><td class="num" id="LN7006">7006</td><td class="line">   <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7007"><td class="num" id="LN7007">7007</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7008"><td class="num" id="LN7008">7008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7009"><td class="num" id="LN7009">7009</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *stbi__pnm_load(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp, <span class='keyword'>int</span> req_comp, stbi__result_info *ri)</td></tr>
<tr class="codeline" data-linenumber="7010"><td class="num" id="LN7010">7010</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7011"><td class="num" id="LN7011">7011</td><td class="line">   stbi_uc *out;</td></tr>
<tr class="codeline" data-linenumber="7012"><td class="num" id="LN7012">7012</td><td class="line">   <span class='macro'>STBI_NOTUSED(ri)<span class='macro_popup'>(void)sizeof(ri)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7013"><td class="num" id="LN7013">7013</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7014"><td class="num" id="LN7014">7014</td><td class="line">   <span class='keyword'>if</span> (!stbi__pnm_info(s, (<span class='keyword'>int</span> *)&amp;s-&gt;img_x, (<span class='keyword'>int</span> *)&amp;s-&gt;img_y, (<span class='keyword'>int</span> *)&amp;s-&gt;img_n))</td></tr>
<tr class="codeline" data-linenumber="7015"><td class="num" id="LN7015">7015</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="7016"><td class="num" id="LN7016">7016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7017"><td class="num" id="LN7017">7017</td><td class="line">   *x = s-&gt;img_x;</td></tr>
<tr class="codeline" data-linenumber="7018"><td class="num" id="LN7018">7018</td><td class="line">   *y = s-&gt;img_y;</td></tr>
<tr class="codeline" data-linenumber="7019"><td class="num" id="LN7019">7019</td><td class="line">   <span class='keyword'>if</span> (comp) *comp = s-&gt;img_n;</td></tr>
<tr class="codeline" data-linenumber="7020"><td class="num" id="LN7020">7020</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7021"><td class="num" id="LN7021">7021</td><td class="line">   <span class='keyword'>if</span> (!stbi__mad3sizes_valid(s-&gt;img_n, s-&gt;img_x, s-&gt;img_y, 0))</td></tr>
<tr class="codeline" data-linenumber="7022"><td class="num" id="LN7022">7022</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"too large"</span>, <span class='string_literal'>"PNM too large"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("too large")?((void*)0)<br>:((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7023"><td class="num" id="LN7023">7023</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7024"><td class="num" id="LN7024">7024</td><td class="line">   out = (stbi_uc *) stbi__malloc_mad3(s-&gt;img_n, s-&gt;img_x, s-&gt;img_y, 0);</td></tr>
<tr class="codeline" data-linenumber="7025"><td class="num" id="LN7025">7025</td><td class="line">   <span class='keyword'>if</span> (!out) <span class='keyword'>return</span> <span class='macro'>stbi__errpuc(<span class='string_literal'>"outofmem"</span>, <span class='string_literal'>"Out of memory"</span>)<span class='macro_popup'>((unsigned char *)(size_t) (stbi__err("outofmem")?((void*)0):<br>((void*)0)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7026"><td class="num" id="LN7026">7026</td><td class="line">   stbi__getn(s, out, s-&gt;img_n * s-&gt;img_x * s-&gt;img_y);</td></tr>
<tr class="codeline" data-linenumber="7027"><td class="num" id="LN7027">7027</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7028"><td class="num" id="LN7028">7028</td><td class="line">   <span class='keyword'>if</span> (req_comp &amp;&amp; req_comp != s-&gt;img_n) {</td></tr>
<tr class="codeline" data-linenumber="7029"><td class="num" id="LN7029">7029</td><td class="line">      out = stbi__convert_format(out, s-&gt;img_n, req_comp, s-&gt;img_x, s-&gt;img_y);</td></tr>
<tr class="codeline" data-linenumber="7030"><td class="num" id="LN7030">7030</td><td class="line">      <span class='keyword'>if</span> (out == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> out; <span class='comment'>// stbi__convert_format frees input on failure</span></td></tr>
<tr class="codeline" data-linenumber="7031"><td class="num" id="LN7031">7031</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="7032"><td class="num" id="LN7032">7032</td><td class="line">   <span class='keyword'>return</span> out;</td></tr>
<tr class="codeline" data-linenumber="7033"><td class="num" id="LN7033">7033</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7034"><td class="num" id="LN7034">7034</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7035"><td class="num" id="LN7035">7035</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_isspace(<span class='keyword'>char</span> c)</td></tr>
<tr class="codeline" data-linenumber="7036"><td class="num" id="LN7036">7036</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7037"><td class="num" id="LN7037">7037</td><td class="line">   <span class='keyword'>return</span> c == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';</td></tr>
<tr class="codeline" data-linenumber="7038"><td class="num" id="LN7038">7038</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7039"><td class="num" id="LN7039">7039</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7040"><td class="num" id="LN7040">7040</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>     stbi__pnm_skip_whitespace(stbi__context *s, <span class='keyword'>char</span> *c)</td></tr>
<tr class="codeline" data-linenumber="7041"><td class="num" id="LN7041">7041</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7042"><td class="num" id="LN7042">7042</td><td class="line">   <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="7043"><td class="num" id="LN7043">7043</td><td class="line">      <span class='keyword'>while</span> (!stbi__at_eof(s) &amp;&amp; stbi__pnm_isspace(*c))</td></tr>
<tr class="codeline" data-linenumber="7044"><td class="num" id="LN7044">7044</td><td class="line">         *c = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7045"><td class="num" id="LN7045">7045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7046"><td class="num" id="LN7046">7046</td><td class="line">      <span class='keyword'>if</span> (stbi__at_eof(s) || *c != '#')</td></tr>
<tr class="codeline" data-linenumber="7047"><td class="num" id="LN7047">7047</td><td class="line">         <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="7048"><td class="num" id="LN7048">7048</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7049"><td class="num" id="LN7049">7049</td><td class="line">      <span class='keyword'>while</span> (!stbi__at_eof(s) &amp;&amp; *c != '\n' &amp;&amp; *c != '\r' )</td></tr>
<tr class="codeline" data-linenumber="7050"><td class="num" id="LN7050">7050</td><td class="line">         *c = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7051"><td class="num" id="LN7051">7051</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="7052"><td class="num" id="LN7052">7052</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7053"><td class="num" id="LN7053">7053</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7054"><td class="num" id="LN7054">7054</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_isdigit(<span class='keyword'>char</span> c)</td></tr>
<tr class="codeline" data-linenumber="7055"><td class="num" id="LN7055">7055</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7056"><td class="num" id="LN7056">7056</td><td class="line">   <span class='keyword'>return</span> c &gt;= '0' &amp;&amp; c &lt;= '9';</td></tr>
<tr class="codeline" data-linenumber="7057"><td class="num" id="LN7057">7057</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7058"><td class="num" id="LN7058">7058</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7059"><td class="num" id="LN7059">7059</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_getinteger(stbi__context *s, <span class='keyword'>char</span> *c)</td></tr>
<tr class="codeline" data-linenumber="7060"><td class="num" id="LN7060">7060</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7061"><td class="num" id="LN7061">7061</td><td class="line">   <span class='keyword'>int</span> value = 0;</td></tr>
<tr class="codeline" data-linenumber="7062"><td class="num" id="LN7062">7062</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7063"><td class="num" id="LN7063">7063</td><td class="line">   <span class='keyword'>while</span> (!stbi__at_eof(s) &amp;&amp; stbi__pnm_isdigit(*c)) {</td></tr>
<tr class="codeline" data-linenumber="7064"><td class="num" id="LN7064">7064</td><td class="line">      value = value*10 + (*c - '0');</td></tr>
<tr class="codeline" data-linenumber="7065"><td class="num" id="LN7065">7065</td><td class="line">      *c = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7066"><td class="num" id="LN7066">7066</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="7067"><td class="num" id="LN7067">7067</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7068"><td class="num" id="LN7068">7068</td><td class="line">   <span class='keyword'>return</span> value;</td></tr>
<tr class="codeline" data-linenumber="7069"><td class="num" id="LN7069">7069</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7070"><td class="num" id="LN7070">7070</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7071"><td class="num" id="LN7071">7071</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span>      stbi__pnm_info(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="7072"><td class="num" id="LN7072">7072</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7073"><td class="num" id="LN7073">7073</td><td class="line">   <span class='keyword'>int</span> maxv, dummy;</td></tr>
<tr class="codeline" data-linenumber="7074"><td class="num" id="LN7074">7074</td><td class="line">   <span class='keyword'>char</span> c, p, t;</td></tr>
<tr class="codeline" data-linenumber="7075"><td class="num" id="LN7075">7075</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7076"><td class="num" id="LN7076">7076</td><td class="line">   <span class='keyword'>if</span> (!x) x = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="7077"><td class="num" id="LN7077">7077</td><td class="line">   <span class='keyword'>if</span> (!y) y = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="7078"><td class="num" id="LN7078">7078</td><td class="line">   <span class='keyword'>if</span> (!comp) comp = &amp;dummy;</td></tr>
<tr class="codeline" data-linenumber="7079"><td class="num" id="LN7079">7079</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7080"><td class="num" id="LN7080">7080</td><td class="line">   stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="7081"><td class="num" id="LN7081">7081</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7082"><td class="num" id="LN7082">7082</td><td class="line">   <span class='comment'>// Get identifier</span></td></tr>
<tr class="codeline" data-linenumber="7083"><td class="num" id="LN7083">7083</td><td class="line">   p = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7084"><td class="num" id="LN7084">7084</td><td class="line">   t = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7085"><td class="num" id="LN7085">7085</td><td class="line">   <span class='keyword'>if</span> (p != 'P' || (t != '5' &amp;&amp; t != '6')) {</td></tr>
<tr class="codeline" data-linenumber="7086"><td class="num" id="LN7086">7086</td><td class="line">       stbi__rewind(s);</td></tr>
<tr class="codeline" data-linenumber="7087"><td class="num" id="LN7087">7087</td><td class="line">       <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="7088"><td class="num" id="LN7088">7088</td><td class="line">   }</td></tr>
<tr class="codeline" data-linenumber="7089"><td class="num" id="LN7089">7089</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7090"><td class="num" id="LN7090">7090</td><td class="line">   *comp = (t == '6') ? 3 : 1;  <span class='comment'>// '5' is 1-component .pgm; '6' is 3-component .ppm</span></td></tr>
<tr class="codeline" data-linenumber="7091"><td class="num" id="LN7091">7091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7092"><td class="num" id="LN7092">7092</td><td class="line">   c = (<span class='keyword'>char</span>) stbi__get8(s);</td></tr>
<tr class="codeline" data-linenumber="7093"><td class="num" id="LN7093">7093</td><td class="line">   stbi__pnm_skip_whitespace(s, &amp;c);</td></tr>
<tr class="codeline" data-linenumber="7094"><td class="num" id="LN7094">7094</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7095"><td class="num" id="LN7095">7095</td><td class="line">   *x = stbi__pnm_getinteger(s, &amp;c); <span class='comment'>// read width</span></td></tr>
<tr class="codeline" data-linenumber="7096"><td class="num" id="LN7096">7096</td><td class="line">   stbi__pnm_skip_whitespace(s, &amp;c);</td></tr>
<tr class="codeline" data-linenumber="7097"><td class="num" id="LN7097">7097</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7098"><td class="num" id="LN7098">7098</td><td class="line">   *y = stbi__pnm_getinteger(s, &amp;c); <span class='comment'>// read height</span></td></tr>
<tr class="codeline" data-linenumber="7099"><td class="num" id="LN7099">7099</td><td class="line">   stbi__pnm_skip_whitespace(s, &amp;c);</td></tr>
<tr class="codeline" data-linenumber="7100"><td class="num" id="LN7100">7100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7101"><td class="num" id="LN7101">7101</td><td class="line">   maxv = stbi__pnm_getinteger(s, &amp;c);  <span class='comment'>// read max value</span></td></tr>
<tr class="codeline" data-linenumber="7102"><td class="num" id="LN7102">7102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7103"><td class="num" id="LN7103">7103</td><td class="line">   <span class='keyword'>if</span> (maxv &gt; 255)</td></tr>
<tr class="codeline" data-linenumber="7104"><td class="num" id="LN7104">7104</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"max value &gt; 255"</span>, <span class='string_literal'>"PPM image not 8-bit"</span>)<span class='macro_popup'>stbi__err("max value &gt; 255")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7105"><td class="num" id="LN7105">7105</td><td class="line">   <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="7106"><td class="num" id="LN7106">7106</td><td class="line">      <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7107"><td class="num" id="LN7107">7107</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7108"><td class="num" id="LN7108">7108</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7109"><td class="num" id="LN7109">7109</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7110"><td class="num" id="LN7110">7110</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__info_main(stbi__context *s, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="7111"><td class="num" id="LN7111">7111</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7112"><td class="num" id="LN7112">7112</td><td class="line">   <span class='directive'>#ifndef STBI_NO_JPEG</span></td></tr>
<tr class="codeline" data-linenumber="7113"><td class="num" id="LN7113">7113</td><td class="line">   <span class='keyword'>if</span> (stbi__jpeg_info(s, x, y, comp)) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7114"><td class="num" id="LN7114">7114</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7115"><td class="num" id="LN7115">7115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7116"><td class="num" id="LN7116">7116</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="7117"><td class="num" id="LN7117">7117</td><td class="line">   <span class='keyword'>if</span> (stbi__png_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7118"><td class="num" id="LN7118">7118</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7119"><td class="num" id="LN7119">7119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7120"><td class="num" id="LN7120">7120</td><td class="line">   <span class='directive'>#ifndef STBI_NO_GIF</span></td></tr>
<tr class="codeline" data-linenumber="7121"><td class="num" id="LN7121">7121</td><td class="line">   <span class='keyword'>if</span> (stbi__gif_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7122"><td class="num" id="LN7122">7122</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7123"><td class="num" id="LN7123">7123</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7124"><td class="num" id="LN7124">7124</td><td class="line">   <span class='directive'>#ifndef STBI_NO_BMP</span></td></tr>
<tr class="codeline" data-linenumber="7125"><td class="num" id="LN7125">7125</td><td class="line">   <span class='keyword'>if</span> (stbi__bmp_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7126"><td class="num" id="LN7126">7126</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7127"><td class="num" id="LN7127">7127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7128"><td class="num" id="LN7128">7128</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="7129"><td class="num" id="LN7129">7129</td><td class="line">   <span class='keyword'>if</span> (stbi__psd_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7130"><td class="num" id="LN7130">7130</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7131"><td class="num" id="LN7131">7131</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7132"><td class="num" id="LN7132">7132</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PIC</span></td></tr>
<tr class="codeline" data-linenumber="7133"><td class="num" id="LN7133">7133</td><td class="line">   <span class='keyword'>if</span> (stbi__pic_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7134"><td class="num" id="LN7134">7134</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7135"><td class="num" id="LN7135">7135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7136"><td class="num" id="LN7136">7136</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PNM</span></td></tr>
<tr class="codeline" data-linenumber="7137"><td class="num" id="LN7137">7137</td><td class="line">   <span class='keyword'>if</span> (stbi__pnm_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7138"><td class="num" id="LN7138">7138</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7139"><td class="num" id="LN7139">7139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7140"><td class="num" id="LN7140">7140</td><td class="line">   <span class='directive'>#ifndef STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="7141"><td class="num" id="LN7141">7141</td><td class="line">   <span class='keyword'>if</span> (stbi__hdr_info(s, x, y, comp))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7142"><td class="num" id="LN7142">7142</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7143"><td class="num" id="LN7143">7143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7144"><td class="num" id="LN7144">7144</td><td class="line">   <span class='comment'>// test tga last because it's a crappy test!</span></td></tr>
<tr class="codeline" data-linenumber="7145"><td class="num" id="LN7145">7145</td><td class="line">   <span class='directive'>#ifndef STBI_NO_TGA</span></td></tr>
<tr class="codeline" data-linenumber="7146"><td class="num" id="LN7146">7146</td><td class="line">   <span class='keyword'>if</span> (stbi__tga_info(s, x, y, comp))</td></tr>
<tr class="codeline" data-linenumber="7147"><td class="num" id="LN7147">7147</td><td class="line">       <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7148"><td class="num" id="LN7148">7148</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7149"><td class="num" id="LN7149">7149</td><td class="line">   <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"unknown image type"</span>, <span class='string_literal'>"Image not of any known type, or corrupt"</span>)<span class='macro_popup'>stbi__err("unknown image type")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7150"><td class="num" id="LN7150">7150</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7151"><td class="num" id="LN7151">7151</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7152"><td class="num" id="LN7152">7152</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stbi__is_16_main(stbi__context *s)</td></tr>
<tr class="codeline" data-linenumber="7153"><td class="num" id="LN7153">7153</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7154"><td class="num" id="LN7154">7154</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PNG</span></td></tr>
<tr class="codeline" data-linenumber="7155"><td class="num" id="LN7155">7155</td><td class="line">   <span class='keyword'>if</span> (stbi__png_is16(s))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7156"><td class="num" id="LN7156">7156</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7157"><td class="num" id="LN7157">7157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7158"><td class="num" id="LN7158">7158</td><td class="line">   <span class='directive'>#ifndef STBI_NO_PSD</span></td></tr>
<tr class="codeline" data-linenumber="7159"><td class="num" id="LN7159">7159</td><td class="line">   <span class='keyword'>if</span> (stbi__psd_is16(s))  <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="7160"><td class="num" id="LN7160">7160</td><td class="line">   <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="7161"><td class="num" id="LN7161">7161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7162"><td class="num" id="LN7162">7162</td><td class="line">   <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="7163"><td class="num" id="LN7163">7163</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7164"><td class="num" id="LN7164">7164</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7165"><td class="num" id="LN7165">7165</td><td class="line"><span class='directive'>#ifndef STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="7166"><td class="num" id="LN7166">7166</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_info(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="7167"><td class="num" id="LN7167">7167</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7168"><td class="num" id="LN7168">7168</td><td class="line">    FILE *f = stbi__fopen(filename, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="7169"><td class="num" id="LN7169">7169</td><td class="line">    <span class='keyword'>int</span> result;</td></tr>
<tr class="codeline" data-linenumber="7170"><td class="num" id="LN7170">7170</td><td class="line">    <span class='keyword'>if</span> (!f) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"can't fopen"</span>, <span class='string_literal'>"Unable to open file"</span>)<span class='macro_popup'>stbi__err("can't fopen")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7171"><td class="num" id="LN7171">7171</td><td class="line">    result = stbi_info_from_file(f, x, y, comp);</td></tr>
<tr class="codeline" data-linenumber="7172"><td class="num" id="LN7172">7172</td><td class="line">    fclose(f);</td></tr>
<tr class="codeline" data-linenumber="7173"><td class="num" id="LN7173">7173</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="7174"><td class="num" id="LN7174">7174</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7175"><td class="num" id="LN7175">7175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7176"><td class="num" id="LN7176">7176</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_info_from_file(FILE *f, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="7177"><td class="num" id="LN7177">7177</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7178"><td class="num" id="LN7178">7178</td><td class="line">   <span class='keyword'>int</span> r;</td></tr>
<tr class="codeline" data-linenumber="7179"><td class="num" id="LN7179">7179</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="7180"><td class="num" id="LN7180">7180</td><td class="line">   <span class='keyword'>long</span> pos = ftell(f);</td></tr>
<tr class="codeline" data-linenumber="7181"><td class="num" id="LN7181">7181</td><td class="line">   stbi__start_file(&amp;s, f);</td></tr>
<tr class="codeline" data-linenumber="7182"><td class="num" id="LN7182">7182</td><td class="line">   r = stbi__info_main(&amp;s,x,y,comp);</td></tr>
<tr class="codeline" data-linenumber="7183"><td class="num" id="LN7183">7183</td><td class="line">   fseek(f,pos,<span class='macro'>SEEK_SET<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="7184"><td class="num" id="LN7184">7184</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="7185"><td class="num" id="LN7185">7185</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7186"><td class="num" id="LN7186">7186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7187"><td class="num" id="LN7187">7187</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_is_16_bit(<span class='keyword'>char</span> <span class='keyword'>const</span> *filename)</td></tr>
<tr class="codeline" data-linenumber="7188"><td class="num" id="LN7188">7188</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7189"><td class="num" id="LN7189">7189</td><td class="line">    FILE *f = stbi__fopen(filename, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="7190"><td class="num" id="LN7190">7190</td><td class="line">    <span class='keyword'>int</span> result;</td></tr>
<tr class="codeline" data-linenumber="7191"><td class="num" id="LN7191">7191</td><td class="line">    <span class='keyword'>if</span> (!f) <span class='keyword'>return</span> <span class='macro'>stbi__err(<span class='string_literal'>"can't fopen"</span>, <span class='string_literal'>"Unable to open file"</span>)<span class='macro_popup'>stbi__err("can't fopen")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="7192"><td class="num" id="LN7192">7192</td><td class="line">    result = stbi_is_16_bit_from_file(f);</td></tr>
<tr class="codeline" data-linenumber="7193"><td class="num" id="LN7193">7193</td><td class="line">    fclose(f);</td></tr>
<tr class="codeline" data-linenumber="7194"><td class="num" id="LN7194">7194</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="7195"><td class="num" id="LN7195">7195</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7196"><td class="num" id="LN7196">7196</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7197"><td class="num" id="LN7197">7197</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_is_16_bit_from_file(FILE *f)</td></tr>
<tr class="codeline" data-linenumber="7198"><td class="num" id="LN7198">7198</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7199"><td class="num" id="LN7199">7199</td><td class="line">   <span class='keyword'>int</span> r;</td></tr>
<tr class="codeline" data-linenumber="7200"><td class="num" id="LN7200">7200</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="7201"><td class="num" id="LN7201">7201</td><td class="line">   <span class='keyword'>long</span> pos = ftell(f);</td></tr>
<tr class="codeline" data-linenumber="7202"><td class="num" id="LN7202">7202</td><td class="line">   stbi__start_file(&amp;s, f);</td></tr>
<tr class="codeline" data-linenumber="7203"><td class="num" id="LN7203">7203</td><td class="line">   r = stbi__is_16_main(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="7204"><td class="num" id="LN7204">7204</td><td class="line">   fseek(f,pos,<span class='macro'>SEEK_SET<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="7205"><td class="num" id="LN7205">7205</td><td class="line">   <span class='keyword'>return</span> r;</td></tr>
<tr class="codeline" data-linenumber="7206"><td class="num" id="LN7206">7206</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7207"><td class="num" id="LN7207">7207</td><td class="line"><span class='directive'>#endif // !STBI_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="7208"><td class="num" id="LN7208">7208</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7209"><td class="num" id="LN7209">7209</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_info_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="7210"><td class="num" id="LN7210">7210</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7211"><td class="num" id="LN7211">7211</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="7212"><td class="num" id="LN7212">7212</td><td class="line">   stbi__start_mem(&amp;s,buffer,len);</td></tr>
<tr class="codeline" data-linenumber="7213"><td class="num" id="LN7213">7213</td><td class="line">   <span class='keyword'>return</span> stbi__info_main(&amp;s,x,y,comp);</td></tr>
<tr class="codeline" data-linenumber="7214"><td class="num" id="LN7214">7214</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7215"><td class="num" id="LN7215">7215</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7216"><td class="num" id="LN7216">7216</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_info_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *c, <span class='keyword'>void</span> *user, <span class='keyword'>int</span> *x, <span class='keyword'>int</span> *y, <span class='keyword'>int</span> *comp)</td></tr>
<tr class="codeline" data-linenumber="7217"><td class="num" id="LN7217">7217</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7218"><td class="num" id="LN7218">7218</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="7219"><td class="num" id="LN7219">7219</td><td class="line">   stbi__start_callbacks(&amp;s, (stbi_io_callbacks *) c, user);</td></tr>
<tr class="codeline" data-linenumber="7220"><td class="num" id="LN7220">7220</td><td class="line">   <span class='keyword'>return</span> stbi__info_main(&amp;s,x,y,comp);</td></tr>
<tr class="codeline" data-linenumber="7221"><td class="num" id="LN7221">7221</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7222"><td class="num" id="LN7222">7222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7223"><td class="num" id="LN7223">7223</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_is_16_bit_from_memory(stbi_uc <span class='keyword'>const</span> *buffer, <span class='keyword'>int</span> len)</td></tr>
<tr class="codeline" data-linenumber="7224"><td class="num" id="LN7224">7224</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7225"><td class="num" id="LN7225">7225</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="7226"><td class="num" id="LN7226">7226</td><td class="line">   stbi__start_mem(&amp;s,buffer,len);</td></tr>
<tr class="codeline" data-linenumber="7227"><td class="num" id="LN7227">7227</td><td class="line">   <span class='keyword'>return</span> stbi__is_16_main(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="7228"><td class="num" id="LN7228">7228</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7229"><td class="num" id="LN7229">7229</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7230"><td class="num" id="LN7230">7230</td><td class="line"><span class='macro'>STBIDEF<span class='macro_popup'>extern</span></span> <span class='keyword'>int</span> stbi_is_16_bit_from_callbacks(stbi_io_callbacks <span class='keyword'>const</span> *c, <span class='keyword'>void</span> *user)</td></tr>
<tr class="codeline" data-linenumber="7231"><td class="num" id="LN7231">7231</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="7232"><td class="num" id="LN7232">7232</td><td class="line">   stbi__context s;</td></tr>
<tr class="codeline" data-linenumber="7233"><td class="num" id="LN7233">7233</td><td class="line">   stbi__start_callbacks(&amp;s, (stbi_io_callbacks *) c, user);</td></tr>
<tr class="codeline" data-linenumber="7234"><td class="num" id="LN7234">7234</td><td class="line">   <span class='keyword'>return</span> stbi__is_16_main(&amp;s);</td></tr>
<tr class="codeline" data-linenumber="7235"><td class="num" id="LN7235">7235</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="7236"><td class="num" id="LN7236">7236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7237"><td class="num" id="LN7237">7237</td><td class="line"><span class='directive'>#endif // STB_IMAGE_IMPLEMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="7238"><td class="num" id="LN7238">7238</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7239"><td class="num" id="LN7239">7239</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="7240"><td class="num" id="LN7240">7240</td><td class="line">   <span class='comment'>revision history:</span></td></tr>
<tr class="codeline" data-linenumber="7241"><td class="num" id="LN7241">7241</td><td class="line">      <span class='comment'>2.19  (2018-02-11) fix warning</span></td></tr>
<tr class="codeline" data-linenumber="7242"><td class="num" id="LN7242">7242</td><td class="line">      <span class='comment'>2.18  (2018-01-30) fix warnings</span></td></tr>
<tr class="codeline" data-linenumber="7243"><td class="num" id="LN7243">7243</td><td class="line">      <span class='comment'>2.17  (2018-01-29) change sbti__shiftsigned to avoid clang -O2 bug</span></td></tr>
<tr class="codeline" data-linenumber="7244"><td class="num" id="LN7244">7244</td><td class="line">                         <span class='comment'>1-bit BMP</span></td></tr>
<tr class="codeline" data-linenumber="7245"><td class="num" id="LN7245">7245</td><td class="line">                         <span class='comment'>*_is_16_bit api</span></td></tr>
<tr class="codeline" data-linenumber="7246"><td class="num" id="LN7246">7246</td><td class="line">                         <span class='comment'>avoid warnings</span></td></tr>
<tr class="codeline" data-linenumber="7247"><td class="num" id="LN7247">7247</td><td class="line">      <span class='comment'>2.16  (2017-07-23) all functions have 16-bit variants;</span></td></tr>
<tr class="codeline" data-linenumber="7248"><td class="num" id="LN7248">7248</td><td class="line">                         <span class='comment'>STBI_NO_STDIO works again;</span></td></tr>
<tr class="codeline" data-linenumber="7249"><td class="num" id="LN7249">7249</td><td class="line">                         <span class='comment'>compilation fixes;</span></td></tr>
<tr class="codeline" data-linenumber="7250"><td class="num" id="LN7250">7250</td><td class="line">                         <span class='comment'>fix rounding in unpremultiply;</span></td></tr>
<tr class="codeline" data-linenumber="7251"><td class="num" id="LN7251">7251</td><td class="line">                         <span class='comment'>optimize vertical flip;</span></td></tr>
<tr class="codeline" data-linenumber="7252"><td class="num" id="LN7252">7252</td><td class="line">                         <span class='comment'>disable raw_len validation;</span></td></tr>
<tr class="codeline" data-linenumber="7253"><td class="num" id="LN7253">7253</td><td class="line">                         <span class='comment'>documentation fixes</span></td></tr>
<tr class="codeline" data-linenumber="7254"><td class="num" id="LN7254">7254</td><td class="line">      <span class='comment'>2.15  (2017-03-18) fix png-1,2,4 bug; now all Imagenet JPGs decode;</span></td></tr>
<tr class="codeline" data-linenumber="7255"><td class="num" id="LN7255">7255</td><td class="line">                         <span class='comment'>warning fixes; disable run-time SSE detection on gcc;</span></td></tr>
<tr class="codeline" data-linenumber="7256"><td class="num" id="LN7256">7256</td><td class="line">                         <span class='comment'>uniform handling of optional "return" values;</span></td></tr>
<tr class="codeline" data-linenumber="7257"><td class="num" id="LN7257">7257</td><td class="line">                         <span class='comment'>thread-safe initialization of zlib tables</span></td></tr>
<tr class="codeline" data-linenumber="7258"><td class="num" id="LN7258">7258</td><td class="line">      <span class='comment'>2.14  (2017-03-03) remove deprecated STBI_JPEG_OLD; fixes for Imagenet JPGs</span></td></tr>
<tr class="codeline" data-linenumber="7259"><td class="num" id="LN7259">7259</td><td class="line">      <span class='comment'>2.13  (2016-11-29) add 16-bit API, only supported for PNG right now</span></td></tr>
<tr class="codeline" data-linenumber="7260"><td class="num" id="LN7260">7260</td><td class="line">      <span class='comment'>2.12  (2016-04-02) fix typo in 2.11 PSD fix that caused crashes</span></td></tr>
<tr class="codeline" data-linenumber="7261"><td class="num" id="LN7261">7261</td><td class="line">      <span class='comment'>2.11  (2016-04-02) allocate large structures on the stack</span></td></tr>
<tr class="codeline" data-linenumber="7262"><td class="num" id="LN7262">7262</td><td class="line">                         <span class='comment'>remove white matting for transparent PSD</span></td></tr>
<tr class="codeline" data-linenumber="7263"><td class="num" id="LN7263">7263</td><td class="line">                         <span class='comment'>fix reported channel count for PNG &amp; BMP</span></td></tr>
<tr class="codeline" data-linenumber="7264"><td class="num" id="LN7264">7264</td><td class="line">                         <span class='comment'>re-enable SSE2 in non-gcc 64-bit</span></td></tr>
<tr class="codeline" data-linenumber="7265"><td class="num" id="LN7265">7265</td><td class="line">                         <span class='comment'>support RGB-formatted JPEG</span></td></tr>
<tr class="codeline" data-linenumber="7266"><td class="num" id="LN7266">7266</td><td class="line">                         <span class='comment'>read 16-bit PNGs (only as 8-bit)</span></td></tr>
<tr class="codeline" data-linenumber="7267"><td class="num" id="LN7267">7267</td><td class="line">      <span class='comment'>2.10  (2016-01-22) avoid warning introduced in 2.09 by STBI_REALLOC_SIZED</span></td></tr>
<tr class="codeline" data-linenumber="7268"><td class="num" id="LN7268">7268</td><td class="line">      <span class='comment'>2.09  (2016-01-16) allow comments in PNM files</span></td></tr>
<tr class="codeline" data-linenumber="7269"><td class="num" id="LN7269">7269</td><td class="line">                         <span class='comment'>16-bit-per-pixel TGA (not bit-per-component)</span></td></tr>
<tr class="codeline" data-linenumber="7270"><td class="num" id="LN7270">7270</td><td class="line">                         <span class='comment'>info() for TGA could break due to .hdr handling</span></td></tr>
<tr class="codeline" data-linenumber="7271"><td class="num" id="LN7271">7271</td><td class="line">                         <span class='comment'>info() for BMP to shares code instead of sloppy parse</span></td></tr>
<tr class="codeline" data-linenumber="7272"><td class="num" id="LN7272">7272</td><td class="line">                         <span class='comment'>can use STBI_REALLOC_SIZED if allocator doesn't support realloc</span></td></tr>
<tr class="codeline" data-linenumber="7273"><td class="num" id="LN7273">7273</td><td class="line">                         <span class='comment'>code cleanup</span></td></tr>
<tr class="codeline" data-linenumber="7274"><td class="num" id="LN7274">7274</td><td class="line">      <span class='comment'>2.08  (2015-09-13) fix to 2.07 cleanup, reading RGB PSD as RGBA</span></td></tr>
<tr class="codeline" data-linenumber="7275"><td class="num" id="LN7275">7275</td><td class="line">      <span class='comment'>2.07  (2015-09-13) fix compiler warnings</span></td></tr>
<tr class="codeline" data-linenumber="7276"><td class="num" id="LN7276">7276</td><td class="line">                         <span class='comment'>partial animated GIF support</span></td></tr>
<tr class="codeline" data-linenumber="7277"><td class="num" id="LN7277">7277</td><td class="line">                         <span class='comment'>limited 16-bpc PSD support</span></td></tr>
<tr class="codeline" data-linenumber="7278"><td class="num" id="LN7278">7278</td><td class="line">                         <span class='comment'>#ifdef unused functions</span></td></tr>
<tr class="codeline" data-linenumber="7279"><td class="num" id="LN7279">7279</td><td class="line">                         <span class='comment'>bug with &lt; 92 byte PIC,PNM,HDR,TGA</span></td></tr>
<tr class="codeline" data-linenumber="7280"><td class="num" id="LN7280">7280</td><td class="line">      <span class='comment'>2.06  (2015-04-19) fix bug where PSD returns wrong '*comp' value</span></td></tr>
<tr class="codeline" data-linenumber="7281"><td class="num" id="LN7281">7281</td><td class="line">      <span class='comment'>2.05  (2015-04-19) fix bug in progressive JPEG handling, fix warning</span></td></tr>
<tr class="codeline" data-linenumber="7282"><td class="num" id="LN7282">7282</td><td class="line">      <span class='comment'>2.04  (2015-04-15) try to re-enable SIMD on MinGW 64-bit</span></td></tr>
<tr class="codeline" data-linenumber="7283"><td class="num" id="LN7283">7283</td><td class="line">      <span class='comment'>2.03  (2015-04-12) extra corruption checking (mmozeiko)</span></td></tr>
<tr class="codeline" data-linenumber="7284"><td class="num" id="LN7284">7284</td><td class="line">                         <span class='comment'>stbi_set_flip_vertically_on_load (nguillemot)</span></td></tr>
<tr class="codeline" data-linenumber="7285"><td class="num" id="LN7285">7285</td><td class="line">                         <span class='comment'>fix NEON support; fix mingw support</span></td></tr>
<tr class="codeline" data-linenumber="7286"><td class="num" id="LN7286">7286</td><td class="line">      <span class='comment'>2.02  (2015-01-19) fix incorrect assert, fix warning</span></td></tr>
<tr class="codeline" data-linenumber="7287"><td class="num" id="LN7287">7287</td><td class="line">      <span class='comment'>2.01  (2015-01-17) fix various warnings; suppress SIMD on gcc 32-bit without -msse2</span></td></tr>
<tr class="codeline" data-linenumber="7288"><td class="num" id="LN7288">7288</td><td class="line">      <span class='comment'>2.00b (2014-12-25) fix STBI_MALLOC in progressive JPEG</span></td></tr>
<tr class="codeline" data-linenumber="7289"><td class="num" id="LN7289">7289</td><td class="line">      <span class='comment'>2.00  (2014-12-25) optimize JPG, including x86 SSE2 &amp; NEON SIMD (ryg)</span></td></tr>
<tr class="codeline" data-linenumber="7290"><td class="num" id="LN7290">7290</td><td class="line">                         <span class='comment'>progressive JPEG (stb)</span></td></tr>
<tr class="codeline" data-linenumber="7291"><td class="num" id="LN7291">7291</td><td class="line">                         <span class='comment'>PGM/PPM support (Ken Miller)</span></td></tr>
<tr class="codeline" data-linenumber="7292"><td class="num" id="LN7292">7292</td><td class="line">                         <span class='comment'>STBI_MALLOC,STBI_REALLOC,STBI_FREE</span></td></tr>
<tr class="codeline" data-linenumber="7293"><td class="num" id="LN7293">7293</td><td class="line">                         <span class='comment'>GIF bugfix -- seemingly never worked</span></td></tr>
<tr class="codeline" data-linenumber="7294"><td class="num" id="LN7294">7294</td><td class="line">                         <span class='comment'>STBI_NO_*, STBI_ONLY_*</span></td></tr>
<tr class="codeline" data-linenumber="7295"><td class="num" id="LN7295">7295</td><td class="line">      <span class='comment'>1.48  (2014-12-14) fix incorrectly-named assert()</span></td></tr>
<tr class="codeline" data-linenumber="7296"><td class="num" id="LN7296">7296</td><td class="line">      <span class='comment'>1.47  (2014-12-14) 1/2/4-bit PNG support, both direct and paletted (Omar Cornut &amp; stb)</span></td></tr>
<tr class="codeline" data-linenumber="7297"><td class="num" id="LN7297">7297</td><td class="line">                         <span class='comment'>optimize PNG (ryg)</span></td></tr>
<tr class="codeline" data-linenumber="7298"><td class="num" id="LN7298">7298</td><td class="line">                         <span class='comment'>fix bug in interlaced PNG with user-specified channel count (stb)</span></td></tr>
<tr class="codeline" data-linenumber="7299"><td class="num" id="LN7299">7299</td><td class="line">      <span class='comment'>1.46  (2014-08-26)</span></td></tr>
<tr class="codeline" data-linenumber="7300"><td class="num" id="LN7300">7300</td><td class="line">              <span class='comment'>fix broken tRNS chunk (colorkey-style transparency) in non-paletted PNG</span></td></tr>
<tr class="codeline" data-linenumber="7301"><td class="num" id="LN7301">7301</td><td class="line">      <span class='comment'>1.45  (2014-08-16)</span></td></tr>
<tr class="codeline" data-linenumber="7302"><td class="num" id="LN7302">7302</td><td class="line">              <span class='comment'>fix MSVC-ARM internal compiler error by wrapping malloc</span></td></tr>
<tr class="codeline" data-linenumber="7303"><td class="num" id="LN7303">7303</td><td class="line">      <span class='comment'>1.44  (2014-08-07)</span></td></tr>
<tr class="codeline" data-linenumber="7304"><td class="num" id="LN7304">7304</td><td class="line">              <span class='comment'>various warning fixes from Ronny Chevalier</span></td></tr>
<tr class="codeline" data-linenumber="7305"><td class="num" id="LN7305">7305</td><td class="line">      <span class='comment'>1.43  (2014-07-15)</span></td></tr>
<tr class="codeline" data-linenumber="7306"><td class="num" id="LN7306">7306</td><td class="line">              <span class='comment'>fix MSVC-only compiler problem in code changed in 1.42</span></td></tr>
<tr class="codeline" data-linenumber="7307"><td class="num" id="LN7307">7307</td><td class="line">      <span class='comment'>1.42  (2014-07-09)</span></td></tr>
<tr class="codeline" data-linenumber="7308"><td class="num" id="LN7308">7308</td><td class="line">              <span class='comment'>don't define _CRT_SECURE_NO_WARNINGS (affects user code)</span></td></tr>
<tr class="codeline" data-linenumber="7309"><td class="num" id="LN7309">7309</td><td class="line">              <span class='comment'>fixes to stbi__cleanup_jpeg path</span></td></tr>
<tr class="codeline" data-linenumber="7310"><td class="num" id="LN7310">7310</td><td class="line">              <span class='comment'>added STBI_ASSERT to avoid requiring assert.h</span></td></tr>
<tr class="codeline" data-linenumber="7311"><td class="num" id="LN7311">7311</td><td class="line">      <span class='comment'>1.41  (2014-06-25)</span></td></tr>
<tr class="codeline" data-linenumber="7312"><td class="num" id="LN7312">7312</td><td class="line">              <span class='comment'>fix search&amp;replace from 1.36 that messed up comments/error messages</span></td></tr>
<tr class="codeline" data-linenumber="7313"><td class="num" id="LN7313">7313</td><td class="line">      <span class='comment'>1.40  (2014-06-22)</span></td></tr>
<tr class="codeline" data-linenumber="7314"><td class="num" id="LN7314">7314</td><td class="line">              <span class='comment'>fix gcc struct-initialization warning</span></td></tr>
<tr class="codeline" data-linenumber="7315"><td class="num" id="LN7315">7315</td><td class="line">      <span class='comment'>1.39  (2014-06-15)</span></td></tr>
<tr class="codeline" data-linenumber="7316"><td class="num" id="LN7316">7316</td><td class="line">              <span class='comment'>fix to TGA optimization when req_comp != number of components in TGA;</span></td></tr>
<tr class="codeline" data-linenumber="7317"><td class="num" id="LN7317">7317</td><td class="line">              <span class='comment'>fix to GIF loading because BMP wasn't rewinding (whoops, no GIFs in my test suite)</span></td></tr>
<tr class="codeline" data-linenumber="7318"><td class="num" id="LN7318">7318</td><td class="line">              <span class='comment'>add support for BMP version 5 (more ignored fields)</span></td></tr>
<tr class="codeline" data-linenumber="7319"><td class="num" id="LN7319">7319</td><td class="line">      <span class='comment'>1.38  (2014-06-06)</span></td></tr>
<tr class="codeline" data-linenumber="7320"><td class="num" id="LN7320">7320</td><td class="line">              <span class='comment'>suppress MSVC warnings on integer casts truncating values</span></td></tr>
<tr class="codeline" data-linenumber="7321"><td class="num" id="LN7321">7321</td><td class="line">              <span class='comment'>fix accidental rename of 'skip' field of I/O</span></td></tr>
<tr class="codeline" data-linenumber="7322"><td class="num" id="LN7322">7322</td><td class="line">      <span class='comment'>1.37  (2014-06-04)</span></td></tr>
<tr class="codeline" data-linenumber="7323"><td class="num" id="LN7323">7323</td><td class="line">              <span class='comment'>remove duplicate typedef</span></td></tr>
<tr class="codeline" data-linenumber="7324"><td class="num" id="LN7324">7324</td><td class="line">      <span class='comment'>1.36  (2014-06-03)</span></td></tr>
<tr class="codeline" data-linenumber="7325"><td class="num" id="LN7325">7325</td><td class="line">              <span class='comment'>convert to header file single-file library</span></td></tr>
<tr class="codeline" data-linenumber="7326"><td class="num" id="LN7326">7326</td><td class="line">              <span class='comment'>if de-iphone isn't set, load iphone images color-swapped instead of returning NULL</span></td></tr>
<tr class="codeline" data-linenumber="7327"><td class="num" id="LN7327">7327</td><td class="line">      <span class='comment'>1.35  (2014-05-27)</span></td></tr>
<tr class="codeline" data-linenumber="7328"><td class="num" id="LN7328">7328</td><td class="line">              <span class='comment'>various warnings</span></td></tr>
<tr class="codeline" data-linenumber="7329"><td class="num" id="LN7329">7329</td><td class="line">              <span class='comment'>fix broken STBI_SIMD path</span></td></tr>
<tr class="codeline" data-linenumber="7330"><td class="num" id="LN7330">7330</td><td class="line">              <span class='comment'>fix bug where stbi_load_from_file no longer left file pointer in correct place</span></td></tr>
<tr class="codeline" data-linenumber="7331"><td class="num" id="LN7331">7331</td><td class="line">              <span class='comment'>fix broken non-easy path for 32-bit BMP (possibly never used)</span></td></tr>
<tr class="codeline" data-linenumber="7332"><td class="num" id="LN7332">7332</td><td class="line">              <span class='comment'>TGA optimization by Arseny Kapoulkine</span></td></tr>
<tr class="codeline" data-linenumber="7333"><td class="num" id="LN7333">7333</td><td class="line">      <span class='comment'>1.34  (unknown)</span></td></tr>
<tr class="codeline" data-linenumber="7334"><td class="num" id="LN7334">7334</td><td class="line">              <span class='comment'>use STBI_NOTUSED in stbi__resample_row_generic(), fix one more leak in tga failure case</span></td></tr>
<tr class="codeline" data-linenumber="7335"><td class="num" id="LN7335">7335</td><td class="line">      <span class='comment'>1.33  (2011-07-14)</span></td></tr>
<tr class="codeline" data-linenumber="7336"><td class="num" id="LN7336">7336</td><td class="line">              <span class='comment'>make stbi_is_hdr work in STBI_NO_HDR (as specified), minor compiler-friendly improvements</span></td></tr>
<tr class="codeline" data-linenumber="7337"><td class="num" id="LN7337">7337</td><td class="line">      <span class='comment'>1.32  (2011-07-13)</span></td></tr>
<tr class="codeline" data-linenumber="7338"><td class="num" id="LN7338">7338</td><td class="line">              <span class='comment'>support for "info" function for all supported filetypes (SpartanJ)</span></td></tr>
<tr class="codeline" data-linenumber="7339"><td class="num" id="LN7339">7339</td><td class="line">      <span class='comment'>1.31  (2011-06-20)</span></td></tr>
<tr class="codeline" data-linenumber="7340"><td class="num" id="LN7340">7340</td><td class="line">              <span class='comment'>a few more leak fixes, bug in PNG handling (SpartanJ)</span></td></tr>
<tr class="codeline" data-linenumber="7341"><td class="num" id="LN7341">7341</td><td class="line">      <span class='comment'>1.30  (2011-06-11)</span></td></tr>
<tr class="codeline" data-linenumber="7342"><td class="num" id="LN7342">7342</td><td class="line">              <span class='comment'>added ability to load files via callbacks to accomidate custom input streams (Ben Wenger)</span></td></tr>
<tr class="codeline" data-linenumber="7343"><td class="num" id="LN7343">7343</td><td class="line">              <span class='comment'>removed deprecated format-specific test/load functions</span></td></tr>
<tr class="codeline" data-linenumber="7344"><td class="num" id="LN7344">7344</td><td class="line">              <span class='comment'>removed support for installable file formats (stbi_loader) -- would have been broken for IO callbacks anyway</span></td></tr>
<tr class="codeline" data-linenumber="7345"><td class="num" id="LN7345">7345</td><td class="line">              <span class='comment'>error cases in bmp and tga give messages and don't leak (Raymond Barbiero, grisha)</span></td></tr>
<tr class="codeline" data-linenumber="7346"><td class="num" id="LN7346">7346</td><td class="line">              <span class='comment'>fix inefficiency in decoding 32-bit BMP (David Woo)</span></td></tr>
<tr class="codeline" data-linenumber="7347"><td class="num" id="LN7347">7347</td><td class="line">      <span class='comment'>1.29  (2010-08-16)</span></td></tr>
<tr class="codeline" data-linenumber="7348"><td class="num" id="LN7348">7348</td><td class="line">              <span class='comment'>various warning fixes from Aurelien Pocheville</span></td></tr>
<tr class="codeline" data-linenumber="7349"><td class="num" id="LN7349">7349</td><td class="line">      <span class='comment'>1.28  (2010-08-01)</span></td></tr>
<tr class="codeline" data-linenumber="7350"><td class="num" id="LN7350">7350</td><td class="line">              <span class='comment'>fix bug in GIF palette transparency (SpartanJ)</span></td></tr>
<tr class="codeline" data-linenumber="7351"><td class="num" id="LN7351">7351</td><td class="line">      <span class='comment'>1.27  (2010-08-01)</span></td></tr>
<tr class="codeline" data-linenumber="7352"><td class="num" id="LN7352">7352</td><td class="line">              <span class='comment'>cast-to-stbi_uc to fix warnings</span></td></tr>
<tr class="codeline" data-linenumber="7353"><td class="num" id="LN7353">7353</td><td class="line">      <span class='comment'>1.26  (2010-07-24)</span></td></tr>
<tr class="codeline" data-linenumber="7354"><td class="num" id="LN7354">7354</td><td class="line">              <span class='comment'>fix bug in file buffering for PNG reported by SpartanJ</span></td></tr>
<tr class="codeline" data-linenumber="7355"><td class="num" id="LN7355">7355</td><td class="line">      <span class='comment'>1.25  (2010-07-17)</span></td></tr>
<tr class="codeline" data-linenumber="7356"><td class="num" id="LN7356">7356</td><td class="line">              <span class='comment'>refix trans_data warning (Won Chun)</span></td></tr>
<tr class="codeline" data-linenumber="7357"><td class="num" id="LN7357">7357</td><td class="line">      <span class='comment'>1.24  (2010-07-12)</span></td></tr>
<tr class="codeline" data-linenumber="7358"><td class="num" id="LN7358">7358</td><td class="line">              <span class='comment'>perf improvements reading from files on platforms with lock-heavy fgetc()</span></td></tr>
<tr class="codeline" data-linenumber="7359"><td class="num" id="LN7359">7359</td><td class="line">              <span class='comment'>minor perf improvements for jpeg</span></td></tr>
<tr class="codeline" data-linenumber="7360"><td class="num" id="LN7360">7360</td><td class="line">              <span class='comment'>deprecated type-specific functions so we'll get feedback if they're needed</span></td></tr>
<tr class="codeline" data-linenumber="7361"><td class="num" id="LN7361">7361</td><td class="line">              <span class='comment'>attempt to fix trans_data warning (Won Chun)</span></td></tr>
<tr class="codeline" data-linenumber="7362"><td class="num" id="LN7362">7362</td><td class="line">      <span class='comment'>1.23    fixed bug in iPhone support</span></td></tr>
<tr class="codeline" data-linenumber="7363"><td class="num" id="LN7363">7363</td><td class="line">      <span class='comment'>1.22  (2010-07-10)</span></td></tr>
<tr class="codeline" data-linenumber="7364"><td class="num" id="LN7364">7364</td><td class="line">              <span class='comment'>removed image *writing* support</span></td></tr>
<tr class="codeline" data-linenumber="7365"><td class="num" id="LN7365">7365</td><td class="line">              <span class='comment'>stbi_info support from Jetro Lauha</span></td></tr>
<tr class="codeline" data-linenumber="7366"><td class="num" id="LN7366">7366</td><td class="line">              <span class='comment'>GIF support from Jean-Marc Lienher</span></td></tr>
<tr class="codeline" data-linenumber="7367"><td class="num" id="LN7367">7367</td><td class="line">              <span class='comment'>iPhone PNG-extensions from James Brown</span></td></tr>
<tr class="codeline" data-linenumber="7368"><td class="num" id="LN7368">7368</td><td class="line">              <span class='comment'>warning-fixes from Nicolas Schulz and Janez Zemva (i.stbi__err. Janez (U+017D)emva)</span></td></tr>
<tr class="codeline" data-linenumber="7369"><td class="num" id="LN7369">7369</td><td class="line">      <span class='comment'>1.21    fix use of 'stbi_uc' in header (reported by jon blow)</span></td></tr>
<tr class="codeline" data-linenumber="7370"><td class="num" id="LN7370">7370</td><td class="line">      <span class='comment'>1.20    added support for Softimage PIC, by Tom Seddon</span></td></tr>
<tr class="codeline" data-linenumber="7371"><td class="num" id="LN7371">7371</td><td class="line">      <span class='comment'>1.19    bug in interlaced PNG corruption check (found by ryg)</span></td></tr>
<tr class="codeline" data-linenumber="7372"><td class="num" id="LN7372">7372</td><td class="line">      <span class='comment'>1.18  (2008-08-02)</span></td></tr>
<tr class="codeline" data-linenumber="7373"><td class="num" id="LN7373">7373</td><td class="line">              <span class='comment'>fix a threading bug (local mutable static)</span></td></tr>
<tr class="codeline" data-linenumber="7374"><td class="num" id="LN7374">7374</td><td class="line">      <span class='comment'>1.17    support interlaced PNG</span></td></tr>
<tr class="codeline" data-linenumber="7375"><td class="num" id="LN7375">7375</td><td class="line">      <span class='comment'>1.16    major bugfix - stbi__convert_format converted one too many pixels</span></td></tr>
<tr class="codeline" data-linenumber="7376"><td class="num" id="LN7376">7376</td><td class="line">      <span class='comment'>1.15    initialize some fields for thread safety</span></td></tr>
<tr class="codeline" data-linenumber="7377"><td class="num" id="LN7377">7377</td><td class="line">      <span class='comment'>1.14    fix threadsafe conversion bug</span></td></tr>
<tr class="codeline" data-linenumber="7378"><td class="num" id="LN7378">7378</td><td class="line">              <span class='comment'>header-file-only version (#define STBI_HEADER_FILE_ONLY before including)</span></td></tr>
<tr class="codeline" data-linenumber="7379"><td class="num" id="LN7379">7379</td><td class="line">      <span class='comment'>1.13    threadsafe</span></td></tr>
<tr class="codeline" data-linenumber="7380"><td class="num" id="LN7380">7380</td><td class="line">      <span class='comment'>1.12    const qualifiers in the API</span></td></tr>
<tr class="codeline" data-linenumber="7381"><td class="num" id="LN7381">7381</td><td class="line">      <span class='comment'>1.11    Support installable IDCT, colorspace conversion routines</span></td></tr>
<tr class="codeline" data-linenumber="7382"><td class="num" id="LN7382">7382</td><td class="line">      <span class='comment'>1.10    Fixes for 64-bit (don't use "unsigned long")</span></td></tr>
<tr class="codeline" data-linenumber="7383"><td class="num" id="LN7383">7383</td><td class="line">              <span class='comment'>optimized upsampling by Fabian "ryg" Giesen</span></td></tr>
<tr class="codeline" data-linenumber="7384"><td class="num" id="LN7384">7384</td><td class="line">      <span class='comment'>1.09    Fix format-conversion for PSD code (bad global variables!)</span></td></tr>
<tr class="codeline" data-linenumber="7385"><td class="num" id="LN7385">7385</td><td class="line">      <span class='comment'>1.08    Thatcher Ulrich's PSD code integrated by Nicolas Schulz</span></td></tr>
<tr class="codeline" data-linenumber="7386"><td class="num" id="LN7386">7386</td><td class="line">      <span class='comment'>1.07    attempt to fix C++ warning/errors again</span></td></tr>
<tr class="codeline" data-linenumber="7387"><td class="num" id="LN7387">7387</td><td class="line">      <span class='comment'>1.06    attempt to fix C++ warning/errors again</span></td></tr>
<tr class="codeline" data-linenumber="7388"><td class="num" id="LN7388">7388</td><td class="line">      <span class='comment'>1.05    fix TGA loading to return correct *comp and use good luminance calc</span></td></tr>
<tr class="codeline" data-linenumber="7389"><td class="num" id="LN7389">7389</td><td class="line">      <span class='comment'>1.04    default float alpha is 1, not 255; use 'void *' for stbi_image_free</span></td></tr>
<tr class="codeline" data-linenumber="7390"><td class="num" id="LN7390">7390</td><td class="line">      <span class='comment'>1.03    bugfixes to STBI_NO_STDIO, STBI_NO_HDR</span></td></tr>
<tr class="codeline" data-linenumber="7391"><td class="num" id="LN7391">7391</td><td class="line">      <span class='comment'>1.02    support for (subset of) HDR files, float interface for preferred access to them</span></td></tr>
<tr class="codeline" data-linenumber="7392"><td class="num" id="LN7392">7392</td><td class="line">      <span class='comment'>1.01    fix bug: possible bug in handling right-side up bmps... not sure</span></td></tr>
<tr class="codeline" data-linenumber="7393"><td class="num" id="LN7393">7393</td><td class="line">              <span class='comment'>fix bug: the stbi__bmp_load() and stbi__tga_load() functions didn't work at all</span></td></tr>
<tr class="codeline" data-linenumber="7394"><td class="num" id="LN7394">7394</td><td class="line">      <span class='comment'>1.00    interface to zlib that skips zlib header</span></td></tr>
<tr class="codeline" data-linenumber="7395"><td class="num" id="LN7395">7395</td><td class="line">      <span class='comment'>0.99    correct handling of alpha in palette</span></td></tr>
<tr class="codeline" data-linenumber="7396"><td class="num" id="LN7396">7396</td><td class="line">      <span class='comment'>0.98    TGA loader by lonesock; dynamically add loaders (untested)</span></td></tr>
<tr class="codeline" data-linenumber="7397"><td class="num" id="LN7397">7397</td><td class="line">      <span class='comment'>0.97    jpeg errors on too large a file; also catch another malloc failure</span></td></tr>
<tr class="codeline" data-linenumber="7398"><td class="num" id="LN7398">7398</td><td class="line">      <span class='comment'>0.96    fix detection of invalid v value - particleman@mollyrocket forum</span></td></tr>
<tr class="codeline" data-linenumber="7399"><td class="num" id="LN7399">7399</td><td class="line">      <span class='comment'>0.95    during header scan, seek to markers in case of padding</span></td></tr>
<tr class="codeline" data-linenumber="7400"><td class="num" id="LN7400">7400</td><td class="line">      <span class='comment'>0.94    STBI_NO_STDIO to disable stdio usage; rename all #defines the same</span></td></tr>
<tr class="codeline" data-linenumber="7401"><td class="num" id="LN7401">7401</td><td class="line">      <span class='comment'>0.93    handle jpegtran output; verbose errors</span></td></tr>
<tr class="codeline" data-linenumber="7402"><td class="num" id="LN7402">7402</td><td class="line">      <span class='comment'>0.92    read 4,8,16,24,32-bit BMP files of several formats</span></td></tr>
<tr class="codeline" data-linenumber="7403"><td class="num" id="LN7403">7403</td><td class="line">      <span class='comment'>0.91    output 24-bit Windows 3.0 BMP files</span></td></tr>
<tr class="codeline" data-linenumber="7404"><td class="num" id="LN7404">7404</td><td class="line">      <span class='comment'>0.90    fix a few more warnings; bump version number to approach 1.0</span></td></tr>
<tr class="codeline" data-linenumber="7405"><td class="num" id="LN7405">7405</td><td class="line">      <span class='comment'>0.61    bugfixes due to Marc LeBlanc, Christopher Lloyd</span></td></tr>
<tr class="codeline" data-linenumber="7406"><td class="num" id="LN7406">7406</td><td class="line">      <span class='comment'>0.60    fix compiling as c++</span></td></tr>
<tr class="codeline" data-linenumber="7407"><td class="num" id="LN7407">7407</td><td class="line">      <span class='comment'>0.59    fix warnings: merge Dave Moore's -Wall fixes</span></td></tr>
<tr class="codeline" data-linenumber="7408"><td class="num" id="LN7408">7408</td><td class="line">      <span class='comment'>0.58    fix bug: zlib uncompressed mode len/nlen was wrong endian</span></td></tr>
<tr class="codeline" data-linenumber="7409"><td class="num" id="LN7409">7409</td><td class="line">      <span class='comment'>0.57    fix bug: jpg last huffman symbol before marker was &gt;9 bits but less than 16 available</span></td></tr>
<tr class="codeline" data-linenumber="7410"><td class="num" id="LN7410">7410</td><td class="line">      <span class='comment'>0.56    fix bug: zlib uncompressed mode len vs. nlen</span></td></tr>
<tr class="codeline" data-linenumber="7411"><td class="num" id="LN7411">7411</td><td class="line">      <span class='comment'>0.55    fix bug: restart_interval not initialized to 0</span></td></tr>
<tr class="codeline" data-linenumber="7412"><td class="num" id="LN7412">7412</td><td class="line">      <span class='comment'>0.54    allow NULL for 'int *comp'</span></td></tr>
<tr class="codeline" data-linenumber="7413"><td class="num" id="LN7413">7413</td><td class="line">      <span class='comment'>0.53    fix bug in png 3-&gt;4; speedup png decoding</span></td></tr>
<tr class="codeline" data-linenumber="7414"><td class="num" id="LN7414">7414</td><td class="line">      <span class='comment'>0.52    png handles req_comp=3,4 directly; minor cleanup; jpeg comments</span></td></tr>
<tr class="codeline" data-linenumber="7415"><td class="num" id="LN7415">7415</td><td class="line">      <span class='comment'>0.51    obey req_comp requests, 1-component jpegs return as 1-component,</span></td></tr>
<tr class="codeline" data-linenumber="7416"><td class="num" id="LN7416">7416</td><td class="line">              <span class='comment'>on 'test' only check type, not whether we support this variant</span></td></tr>
<tr class="codeline" data-linenumber="7417"><td class="num" id="LN7417">7417</td><td class="line">      <span class='comment'>0.50  (2006-11-19)</span></td></tr>
<tr class="codeline" data-linenumber="7418"><td class="num" id="LN7418">7418</td><td class="line">              <span class='comment'>first released version</span></td></tr>
<tr class="codeline" data-linenumber="7419"><td class="num" id="LN7419">7419</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="7420"><td class="num" id="LN7420">7420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7421"><td class="num" id="LN7421">7421</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7422"><td class="num" id="LN7422">7422</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="7423"><td class="num" id="LN7423">7423</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="7424"><td class="num" id="LN7424">7424</td><td class="line"><span class='comment'>This software is available under 2 licenses -- choose whichever you prefer.</span></td></tr>
<tr class="codeline" data-linenumber="7425"><td class="num" id="LN7425">7425</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="7426"><td class="num" id="LN7426">7426</td><td class="line"><span class='comment'>ALTERNATIVE A - MIT License</span></td></tr>
<tr class="codeline" data-linenumber="7427"><td class="num" id="LN7427">7427</td><td class="line"><span class='comment'>Copyright (c) 2017 Sean Barrett</span></td></tr>
<tr class="codeline" data-linenumber="7428"><td class="num" id="LN7428">7428</td><td class="line"><span class='comment'>Permission is hereby granted, free of charge, to any person obtaining a copy of</span></td></tr>
<tr class="codeline" data-linenumber="7429"><td class="num" id="LN7429">7429</td><td class="line"><span class='comment'>this software and associated documentation files (the "Software"), to deal in</span></td></tr>
<tr class="codeline" data-linenumber="7430"><td class="num" id="LN7430">7430</td><td class="line"><span class='comment'>the Software without restriction, including without limitation the rights to</span></td></tr>
<tr class="codeline" data-linenumber="7431"><td class="num" id="LN7431">7431</td><td class="line"><span class='comment'>use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies</span></td></tr>
<tr class="codeline" data-linenumber="7432"><td class="num" id="LN7432">7432</td><td class="line"><span class='comment'>of the Software, and to permit persons to whom the Software is furnished to do</span></td></tr>
<tr class="codeline" data-linenumber="7433"><td class="num" id="LN7433">7433</td><td class="line"><span class='comment'>so, subject to the following conditions:</span></td></tr>
<tr class="codeline" data-linenumber="7434"><td class="num" id="LN7434">7434</td><td class="line"><span class='comment'>The above copyright notice and this permission notice shall be included in all</span></td></tr>
<tr class="codeline" data-linenumber="7435"><td class="num" id="LN7435">7435</td><td class="line"><span class='comment'>copies or substantial portions of the Software.</span></td></tr>
<tr class="codeline" data-linenumber="7436"><td class="num" id="LN7436">7436</td><td class="line"><span class='comment'>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></td></tr>
<tr class="codeline" data-linenumber="7437"><td class="num" id="LN7437">7437</td><td class="line"><span class='comment'>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></td></tr>
<tr class="codeline" data-linenumber="7438"><td class="num" id="LN7438">7438</td><td class="line"><span class='comment'>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></td></tr>
<tr class="codeline" data-linenumber="7439"><td class="num" id="LN7439">7439</td><td class="line"><span class='comment'>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></td></tr>
<tr class="codeline" data-linenumber="7440"><td class="num" id="LN7440">7440</td><td class="line"><span class='comment'>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></td></tr>
<tr class="codeline" data-linenumber="7441"><td class="num" id="LN7441">7441</td><td class="line"><span class='comment'>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></td></tr>
<tr class="codeline" data-linenumber="7442"><td class="num" id="LN7442">7442</td><td class="line"><span class='comment'>SOFTWARE.</span></td></tr>
<tr class="codeline" data-linenumber="7443"><td class="num" id="LN7443">7443</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="7444"><td class="num" id="LN7444">7444</td><td class="line"><span class='comment'>ALTERNATIVE B - Public Domain (www.unlicense.org)</span></td></tr>
<tr class="codeline" data-linenumber="7445"><td class="num" id="LN7445">7445</td><td class="line"><span class='comment'>This is free and unencumbered software released into the public domain.</span></td></tr>
<tr class="codeline" data-linenumber="7446"><td class="num" id="LN7446">7446</td><td class="line"><span class='comment'>Anyone is free to copy, modify, publish, use, compile, sell, or distribute this</span></td></tr>
<tr class="codeline" data-linenumber="7447"><td class="num" id="LN7447">7447</td><td class="line"><span class='comment'>software, either in source code form or as a compiled binary, for any purpose,</span></td></tr>
<tr class="codeline" data-linenumber="7448"><td class="num" id="LN7448">7448</td><td class="line"><span class='comment'>commercial or non-commercial, and by any means.</span></td></tr>
<tr class="codeline" data-linenumber="7449"><td class="num" id="LN7449">7449</td><td class="line"><span class='comment'>In jurisdictions that recognize copyright laws, the author or authors of this</span></td></tr>
<tr class="codeline" data-linenumber="7450"><td class="num" id="LN7450">7450</td><td class="line"><span class='comment'>software dedicate any and all copyright interest in the software to the public</span></td></tr>
<tr class="codeline" data-linenumber="7451"><td class="num" id="LN7451">7451</td><td class="line"><span class='comment'>domain. We make this dedication for the benefit of the public at large and to</span></td></tr>
<tr class="codeline" data-linenumber="7452"><td class="num" id="LN7452">7452</td><td class="line"><span class='comment'>the detriment of our heirs and successors. We intend this dedication to be an</span></td></tr>
<tr class="codeline" data-linenumber="7453"><td class="num" id="LN7453">7453</td><td class="line"><span class='comment'>overt act of relinquishment in perpetuity of all present and future rights to</span></td></tr>
<tr class="codeline" data-linenumber="7454"><td class="num" id="LN7454">7454</td><td class="line"><span class='comment'>this software under copyright law.</span></td></tr>
<tr class="codeline" data-linenumber="7455"><td class="num" id="LN7455">7455</td><td class="line"><span class='comment'>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></td></tr>
<tr class="codeline" data-linenumber="7456"><td class="num" id="LN7456">7456</td><td class="line"><span class='comment'>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></td></tr>
<tr class="codeline" data-linenumber="7457"><td class="num" id="LN7457">7457</td><td class="line"><span class='comment'>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></td></tr>
<tr class="codeline" data-linenumber="7458"><td class="num" id="LN7458">7458</td><td class="line"><span class='comment'>AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span></td></tr>
<tr class="codeline" data-linenumber="7459"><td class="num" id="LN7459">7459</td><td class="line"><span class='comment'>ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span></td></tr>
<tr class="codeline" data-linenumber="7460"><td class="num" id="LN7460">7460</td><td class="line"><span class='comment'>WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></td></tr>
<tr class="codeline" data-linenumber="7461"><td class="num" id="LN7461">7461</td><td class="line"><span class='comment'>------------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="7462"><td class="num" id="LN7462">7462</td><td class="line"><span class='comment'>*/</span></td></tr>
</table></body></html>
