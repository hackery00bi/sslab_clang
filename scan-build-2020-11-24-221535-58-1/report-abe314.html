<!doctype html>
<html>
<head>
<title>../deps/v8/third_party/zlib/deflate.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memcpy' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memcpy_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memcpy' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/sslab_clang/cpp_node/node/out/../deps/v8/third_party/zlib/deflate.c -->

<!-- FILENAME deflate.c -->

<!-- FUNCTIONNAME Cr_z_deflateCopy -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT e7e347360fd877a1df6155331ab27f62 -->

<!-- BUGLINE 1159 -->

<!-- BUGCOLUMN 5 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>out/../deps/v8/third_party/zlib/deflate.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 1159, column 5</a><br />Call to function 'memcpy' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memcpy_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name deflate.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=all -relaxed-aliasing -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -ffunction-sections -fdata-sections -resource-dir /llvm-project/build/lib/clang/12.0.0 -D V8_GYP_BUILD -D V8_TYPED_ARRAY_MAX_SIZE_IN_HEAP=64 -D __STDC_FORMAT_MACROS -D OPENSSL_NO_PINSHARED -D OPENSSL_THREADS -D V8_TARGET_ARCH_X64 -D V8_EMBEDDER_STRING="-node.17" -D ENABLE_DISASSEMBLER -D V8_PROMISE_INTERNAL_FIELD_COUNT=1 -D ENABLE_MINOR_MC -D OBJECT_PRINT -D V8_INTL_SUPPORT -D V8_CONCURRENT_MARKING -D V8_ENABLE_LAZY_SOURCE_POSITIONS -D V8_USE_SIPHASH -D DISABLE_UNTRUSTED_CODE_MITIGATIONS -D V8_WIN64_UNWINDING_INFO -D V8_ENABLE_REGEXP_INTERPRETER_THREADED_DISPATCH -D V8_SNAPSHOT_COMPRESSION -D ZLIB_IMPLEMENTATION -I ../deps/v8 -I ../deps/v8/include -I ../deps/v8/third_party/zlib -I ../deps/v8/third_party/zlib/google -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O3 -Wno-unused-parameter -Wno-return-type -fdebug-compilation-dir /tmp/sslab_clang/cpp_node/node/out -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-24-221535-58-1 -x c ../deps/v8/third_party/zlib/deflate.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"1159": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/* deflate.c -- compress data using the deflation algorithm</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>* Copyright (C) 1995-2017 Jean-loup Gailly and Mark Adler</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>* For conditions of distribution and use, see copyright notice in zlib.h</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> <span class='comment'>*  ALGORITHM</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> <span class='comment'>*      The "deflation" process depends on being able to identify portions</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"> <span class='comment'>*      of the input text which are identical to earlier input (within a</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"> <span class='comment'>*      sliding window trailing behind the input currently being processed).</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"> <span class='comment'>*      The most straightforward technique turns out to be the fastest for</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"> <span class='comment'>*      most input files: try all possible matches and select the longest.</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"> <span class='comment'>*      The key feature of this algorithm is that insertions into the string</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"> <span class='comment'>*      dictionary are very simple and thus fast, and deletions are avoided</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"> <span class='comment'>*      completely. Insertions are performed at each input character, whereas</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"> <span class='comment'>*      string matches are performed only when the previous match ends. So it</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"> <span class='comment'>*      is preferable to spend more time in matches to allow very fast string</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"> <span class='comment'>*      insertions and avoid deletions. The matching algorithm for small</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"> <span class='comment'>*      strings is inspired from that of Rabin &amp; Karp. A brute force approach</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> <span class='comment'>*      is used to find longer strings when a small match has been found.</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"> <span class='comment'>*      A similar algorithm is used in comic (by Jan-Mark Wams) and freeze</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> <span class='comment'>*      (by Leonid Broukhis).</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"> <span class='comment'>*         A previous version of this file used a more sophisticated algorithm</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"> <span class='comment'>*      (by Fiala and Greene) which is guaranteed to run in linear amortized</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"> <span class='comment'>*      time, but has a larger average cost, uses more memory and is patented.</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"> <span class='comment'>*      However the F&amp;G algorithm may be faster for some highly redundant</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> <span class='comment'>*      files if the parameter max_chain_length (described below) is too large.</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"> <span class='comment'>*  ACKNOWLEDGEMENTS</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"> <span class='comment'>*      The idea of lazy evaluation of matches is due to Jan-Mark Wams, and</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"> <span class='comment'>*      I found it in 'freeze' written by Leonid Broukhis.</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> <span class='comment'>*      Thanks to many people for bug reports and testing.</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"> <span class='comment'>*  REFERENCES</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"> <span class='comment'>*      Deutsch, L.P.,"DEFLATE Compressed Data Format Specification".</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> <span class='comment'>*      Available in http://tools.ietf.org/html/rfc1951</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"> <span class='comment'>*      A description of the Rabin and Karp algorithm is given in the book</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> <span class='comment'>*         "Algorithms" by R. Sedgewick, Addison-Wesley, p252.</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"> <span class='comment'>*      Fiala,E.R., and Greene,D.H.</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"> <span class='comment'>*         Data Compression with Finite Windows, Comm.ACM, 32,4 (1989) 490-595</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"><span class='comment'>/* @(#) $Id$ */</span></td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='directive'>#include &lt;assert.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"><span class='directive'>#include "deflate.h"</span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"><span class='directive'>#include "cpu_features.h"</span></td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"><span class='directive'>#include "contrib/optimizations/insert_string.h"</span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='directive'>#if (defined(__ARM_NEON__) || defined(__ARM_NEON))</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"><span class='directive'>#include "contrib/optimizations/slide_hash_neon.h"</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='directive'>#if defined(CRC32_ARMV8_CRC32)</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"><span class='directive'>#include "crc32_simd.h"</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> <span class='macro'>deflate_copyright<span class='macro_popup'>Cr_z_deflate_copyright</span></span>[] =</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">   <span class='string_literal'>" deflate 1.2.11 Copyright 1995-2017 Jean-loup Gailly and Mark Adler "</span>;</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">  <span class='comment'>If you use the zlib library in a product, an acknowledgment is welcome</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">  <span class='comment'>in the documentation of your product. If for some reason you cannot</span></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">  <span class='comment'>include such an acknowledgment, I would appreciate that you keep this</span></td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">  <span class='comment'>copyright string in the executable of your product.</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line"> <span class='comment'>*  Function prototypes.</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span> {</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">    need_more,      <span class='comment'>/* block not completed, need more input or more output */</span></td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">    block_done,     <span class='comment'>/* block flush performed */</span></td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">    finish_started, <span class='comment'>/* finish started, need only more output at next deflate */</span></td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    finish_done     <span class='comment'>/* finish done, accept no more input or output */</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">} block_state;</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"><span class='keyword'>typedef</span> block_state (*compress_func) <span class='macro'>OF((deflate_state *s, <span class='keyword'>int</span> flush))<span class='macro_popup'>(deflate_state *s, int flush)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"><span class='comment'>/* Compression function. Returns the block state after the call. */</span></td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>int</span> deflateStateCheck      <span class='macro'>OF((z_streamp strm))<span class='macro_popup'>(z_streamp strm)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> slide_hash     <span class='macro'>OF((deflate_state *s))<span class='macro_popup'>(deflate_state *s)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> fill_window    <span class='macro'>OF((deflate_state *s))<span class='macro_popup'>(deflate_state *s)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_stored <span class='macro'>OF((deflate_state *s, <span class='keyword'>int</span> flush))<span class='macro_popup'>(deflate_state *s, int flush)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_fast   <span class='macro'>OF((deflate_state *s, <span class='keyword'>int</span> flush))<span class='macro_popup'>(deflate_state *s, int flush)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_slow   <span class='macro'>OF((deflate_state *s, <span class='keyword'>int</span> flush))<span class='macro_popup'>(deflate_state *s, int flush)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_rle    <span class='macro'>OF((deflate_state *s, <span class='keyword'>int</span> flush))<span class='macro_popup'>(deflate_state *s, int flush)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_huff   <span class='macro'>OF((deflate_state *s, <span class='keyword'>int</span> flush))<span class='macro_popup'>(deflate_state *s, int flush)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> lm_init        <span class='macro'>OF((deflate_state *s))<span class='macro_popup'>(deflate_state *s)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> putShortMSB    <span class='macro'>OF((deflate_state *s, uInt b))<span class='macro_popup'>(deflate_state *s, Cr_z_uInt b)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> flush_pending  <span class='macro'>OF((z_streamp strm))<span class='macro_popup'>(z_streamp strm)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"><span class='keyword'>unsigned</span> ZLIB_INTERNAL <span class='macro'>deflate_read_buf<span class='macro_popup'>Cr_z_deflate_read_buf</span></span> <span class='macro'>OF((z_streamp strm, Bytef *buf, <span class='keyword'>unsigned</span> size))<span class='macro_popup'>(z_streamp strm, Cr_z_Bytef *buf, unsigned size)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line"><span class='directive'>#ifdef ASMV</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"><span class='directive'>#  pragma message("Assembler code may have bugs -- use at your own risk")</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">      <span class='keyword'>void</span> match_init <span class='macro'>OF((<span class='keyword'>void</span>))<span class='macro_popup'>(void)</span></span>; <span class='comment'>/* asm code initialization */</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">      <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> longest_match  <span class='macro'>OF((deflate_state *s, IPos cur_match))<span class='macro_popup'>(deflate_state *s, IPos cur_match)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> longest_match  <span class='macro'>OF((deflate_state *s, IPos cur_match))<span class='macro_popup'>(deflate_state *s, IPos cur_match)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"><span class='directive'>#ifdef ZLIB_DEBUG</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span>  <span class='keyword'>void</span> check_match <span class='macro'>OF((deflate_state *s, IPos start, IPos match,<span class='macro_popup'>(deflate_state *s, IPos start, IPos match, int length)</span></span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">                            <span class='keyword'><span class='macro'>int</span> length))<span class='macro_popup'>(deflate_state *s, IPos start, IPos match, int length)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"><span class='comment'>/* From crc32.c */</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>void</span> ZLIB_INTERNAL <span class='macro'>crc_reset<span class='macro_popup'>Cr_z_crc_reset</span></span>(deflate_state *<span class='keyword'>const</span> s);</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>void</span> ZLIB_INTERNAL <span class='macro'>crc_finalize<span class='macro_popup'>Cr_z_crc_finalize</span></span>(deflate_state *<span class='keyword'>const</span> s);</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>void</span> ZLIB_INTERNAL <span class='macro'>copy_with_crc<span class='macro_popup'>Cr_z_copy_with_crc</span></span>(z_streamp strm, <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *dst, <span class='keyword'>long</span> size);</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"> <span class='comment'>* Local data</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line"><span class='directive'>#define <span class='macro'>NIL<span class='macro_popup'>0</span></span> 0</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"><span class='comment'>/* Tail of hash chains */</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"><span class='directive'>#ifndef <span class='macro'>TOO_FAR<span class='macro_popup'>4096</span></span></span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"><span class='directive'>#  define <span class='macro'>TOO_FAR<span class='macro_popup'>4096</span></span> 4096</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line"><span class='comment'>/* Matches of length 3 are discarded if their distance exceeds TOO_FAR */</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='comment'>/* Values for max_lazy_match, good_match and max_chain_length, depending on</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"> <span class='comment'>* the desired pack level (0..9). The values given below have been tuned to</span></td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"> <span class='comment'>* exclude worst case performance for pathological files. Better values may be</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"> <span class='comment'>* found for specific files.</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span> config_s {</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">   ush good_length; <span class='comment'>/* reduce lazy search above this match length */</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">   ush max_lazy;    <span class='comment'>/* do not perform lazy search above this match length */</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">   ush nice_length; <span class='comment'>/* quit search above this match length */</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">   ush max_chain;</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">   compress_func func;</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">} config;</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='directive'>#ifdef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>const</span> config configuration_table[2] = {</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"><span class='comment'>/*      good lazy nice chain */</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line"><span class='comment'>/* 0 */</span> {0,    0,  0,    0, deflate_stored},  <span class='comment'>/* store only */</span></td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line"><span class='comment'>/* 1 */</span> {4,    4,  8,    4, deflate_fast}}; <span class='comment'>/* max speed, no lazy matches */</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>const</span> config configuration_table[10] = {</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='comment'>/*      good lazy nice chain */</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"><span class='comment'>/* 0 */</span> {0,    0,  0,    0, deflate_stored},  <span class='comment'>/* store only */</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='comment'>/* 1 */</span> {4,    4,  8,    4, deflate_fast}, <span class='comment'>/* max speed, no lazy matches */</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"><span class='comment'>/* 2 */</span> {4,    5, 16,    8, deflate_fast},</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line"><span class='comment'>/* 3 */</span> {4,    6, 32,   32, deflate_fast},</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='comment'>/* 4 */</span> {4,    4, 16,   16, deflate_slow},  <span class='comment'>/* lazy matches */</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='comment'>/* 5 */</span> {8,   16, 32,   32, deflate_slow},</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='comment'>/* 6 */</span> {8,   16, 128, 128, deflate_slow},</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='comment'>/* 7 */</span> {8,   32, 128, 256, deflate_slow},</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"><span class='comment'>/* 8 */</span> {32, 128, 258, 1024, deflate_slow},</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='comment'>/* 9 */</span> {32, 258, 258, 4096, deflate_slow}}; <span class='comment'>/* max compression */</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"><span class='comment'>/* Note: the deflate() code requires max_lazy &gt;= MIN_MATCH and max_chain &gt;= 4</span></td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"> <span class='comment'>* For deflate_fast() (levels &lt;= 3) good is ignored and lazy has a different</span></td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"> <span class='comment'>* meaning.</span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"><span class='comment'>/* rank Z_BLOCK between Z_NO_FLUSH and Z_PARTIAL_FLUSH */</span></td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"><span class='directive'>#define <span class='macro'>RANK(f)<span class='macro_popup'>(((f) * 2) - ((f) &gt; 4 ? 9 : 0))</span></span> (((f) * 2) - ((f) &gt; 4 ? 9 : 0))</span></td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"> <span class='comment'>* Initialize the hash table (avoiding 64K overflow for 16 bit systems).</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"> <span class='comment'>* prev[] will be initialized on the fly.</span></td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"><span class='directive'>#define <span class='macro'>CLEAR_HASH(s)<span class='macro_popup'>s-&gt;head[s-&gt;hash_size-1] = 0; memset((Cr_z_Bytef *)s-&gt;<br>head, 0, (unsigned)(s-&gt;hash_size-1)*sizeof(*s-&gt;head));</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">    <span class='directive'>s-&gt;head[s-&gt;hash_size-1] = <span class='macro'>NIL<span class='macro_popup'>0</span></span>; \</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">    <span class='directive'><span class='macro'>zmemzero((Bytef *)s-&gt;head, (unsigned)(s-&gt;hash_size-1)*sizeof(*s-&gt;head))<span class='macro_popup'>memset((Cr_z_Bytef *)s-&gt;head, 0, (unsigned)(s-&gt;hash_size<br>-1)*sizeof(*s-&gt;head))</span></span>;</span></td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"> <span class='comment'>* Slide the hash table when sliding the window down (could be avoided with 32</span></td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line"> <span class='comment'>* bit values at the expense of memory usage). We slide even when level == 0 to</span></td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"> <span class='comment'>* keep the hash table consistent if we switch back to level &gt; 0 later.</span></td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> slide_hash(s)</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"><span class='directive'>#if (defined(__ARM_NEON__) || defined(__ARM_NEON))</span></td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">    <span class='comment'>/* NEON based hash table rebase. */</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">    <span class='keyword'>return</span> neon_slide_hash(s-&gt;head, s-&gt;prev, s-&gt;w_size, s-&gt;hash_size);</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">    <span class='keyword'>unsigned</span> n, m;</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">    Posf *p;</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> wsize = s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">    n = s-&gt;hash_size;</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">    p = &amp;s-&gt;head[n];</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">        m = *--p;</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">        *p = (Pos)(m &gt;= wsize ? m - wsize : <span class='macro'>NIL<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">    } <span class='keyword'>while</span> (--n);</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">    n = wsize;</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">    p = &amp;s-&gt;prev[n];</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">        m = *--p;</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">        *p = (Pos)(m &gt;= wsize ? m - wsize : <span class='macro'>NIL<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">        <span class='comment'>/* If n is not on any hash chain, prev[n] is garbage but</span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">         <span class='comment'>* its value will never be used.</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">    } <span class='keyword'>while</span> (--n);</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateInit_<span class='macro_popup'>Cr_z_deflateInit_</span></span>(strm, level, version, stream_size)</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">    <span class='keyword'>int</span> level;</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *version;</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">    <span class='keyword'>int</span> stream_size;</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>deflateInit2_<span class='macro_popup'>Cr_z_deflateInit2_</span></span>(strm, level, <span class='macro'>Z_DEFLATED<span class='macro_popup'>8</span></span>, <span class='macro'>MAX_WBITS<span class='macro_popup'>15</span></span>, <span class='macro'>DEF_MEM_LEVEL<span class='macro_popup'>8</span></span>,</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">                         <span class='macro'>Z_DEFAULT_STRATEGY<span class='macro_popup'>0</span></span>, version, stream_size);</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">    <span class='comment'>/* To do: ignore strm-&gt;next_in if we use it as window */</span></td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateInit2_<span class='macro_popup'>Cr_z_deflateInit2_</span></span>(strm, level, method, windowBits, memLevel, strategy,</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">                  version, stream_size)</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">    <span class='keyword'>int</span>  level;</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">    <span class='keyword'>int</span>  method;</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    <span class='keyword'>int</span>  windowBits;</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">    <span class='keyword'>int</span>  memLevel;</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">    <span class='keyword'>int</span>  strategy;</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *version;</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">    <span class='keyword'>int</span> stream_size;</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">    <span class='keyword'>unsigned</span> window_padding = 8;</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">    <span class='keyword'>int</span> wrap = 1;</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> my_version[] = <span class='macro'>ZLIB_VERSION<span class='macro_popup'>"1.2.11"</span></span>;</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">    <span class='comment'>// Needed to activate optimized insert_string() that helps compression</span></td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">    <span class='comment'>// for all wrapper formats (e.g. RAW, ZLIB, GZIP).</span></td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">    <span class='comment'>// Feature detection is not triggered while using RAW mode (i.e. we never</span></td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">    <span class='comment'>// call crc32() with a NULL buffer).</span></td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"><span class='directive'>#if defined(CRC32_ARMV8_CRC32) || defined(CRC32_SIMD_SSE42_PCLMUL)</span></td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">    <span class='macro'>cpu_check_features<span class='macro_popup'>Cr_z_cpu_check_features</span></span>();</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">    <span class='keyword'>if</span> (version == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> || version[0] != my_version[0] ||</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">        stream_size != <span class='keyword'>sizeof</span>(z_stream)) {</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_VERSION_ERROR<span class='macro_popup'>(-6)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">    <span class='keyword'>if</span> (strm == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">    strm-&gt;msg = <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">    <span class='keyword'>if</span> (strm-&gt;zalloc == (<span class='macro'>alloc_func<span class='macro_popup'>Cr_z_alloc_func</span></span>)0) {</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"><span class='directive'>#ifdef Z_SOLO</span></td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">        strm-&gt;zalloc = <span class='macro'>zcalloc<span class='macro_popup'>Cr_z_zcalloc</span></span>;</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">        strm-&gt;opaque = (<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)0;</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">    <span class='keyword'>if</span> (strm-&gt;zfree == (<span class='macro'>free_func<span class='macro_popup'>Cr_z_free_func</span></span>)0)</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line"><span class='directive'>#ifdef Z_SOLO</span></td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">        strm-&gt;zfree = <span class='macro'>zcfree<span class='macro_popup'>Cr_z_zcfree</span></span>;</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"><span class='directive'>#ifdef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">    <span class='keyword'>if</span> (level != 0) level = 1;</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">    <span class='keyword'>if</span> (level == <span class='macro'>Z_DEFAULT_COMPRESSION<span class='macro_popup'>(-1)</span></span>) level = 6;</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">    <span class='keyword'>if</span> (windowBits &lt; 0) { <span class='comment'>/* suppress zlib wrapper */</span></td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">        wrap = 0;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">        windowBits = -windowBits;</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (windowBits &gt; 15) {</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">        wrap = 2;       <span class='comment'>/* write gzip wrapper instead */</span></td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">        windowBits -= 16;</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">    <span class='keyword'>if</span> (memLevel &lt; 1 || memLevel &gt; <span class='macro'>MAX_MEM_LEVEL<span class='macro_popup'>9</span></span> || method != <span class='macro'>Z_DEFLATED<span class='macro_popup'>8</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">        windowBits &lt; 8 || windowBits &gt; 15 || level &lt; 0 || level &gt; 9 ||</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">        strategy &lt; 0 || strategy &gt; <span class='macro'>Z_FIXED<span class='macro_popup'>4</span></span> || (windowBits == 8 &amp;&amp; wrap != 1)) {</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">    <span class='keyword'>if</span> (windowBits == 8) windowBits = 9;  <span class='comment'>/* until 256-byte window bug fixed */</span></td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">    s = (deflate_state *) <span class='macro'>ZALLOC(strm, 1, <span class='keyword'>sizeof</span>(deflate_state))<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (1), (sizeof(deflate_state<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">    <span class='keyword'>if</span> (s == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) <span class='keyword'>return</span> <span class='macro'>Z_MEM_ERROR<span class='macro_popup'>(-4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">    strm-&gt;state = (<span class='keyword'>struct</span> internal_state FAR *)s;</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">    s-&gt;strm = strm;</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">    s-&gt;status = <span class='macro'>INIT_STATE<span class='macro_popup'>42</span></span>;     <span class='comment'>/* to pass state test in deflateReset() */</span></td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">    s-&gt;wrap = wrap;</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">    s-&gt;gzhead = <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">    s-&gt;w_bits = (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)windowBits;</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">    s-&gt;w_size = 1 &lt;&lt; s-&gt;w_bits;</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">    s-&gt;w_mask = s-&gt;w_size - 1;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>x86_cpu_enable_simd<span class='macro_popup'>Cr_z_x86_cpu_enable_simd</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">        s-&gt;hash_bits = 15;</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">        s-&gt;hash_bits = memLevel + 7;</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">    s-&gt;hash_size = 1 &lt;&lt; s-&gt;hash_bits;</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">    s-&gt;hash_mask = s-&gt;hash_size - 1;</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">    s-&gt;hash_shift =  ((s-&gt;hash_bits+<span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1)/<span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>);</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">    s-&gt;window = (<span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *) <span class='macro'>ZALLOC(strm,<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (s-&gt;w_size + window_padding<br>), (2*sizeof(Byte)))</span></span></td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">                                 <span class='macro'>s-&gt;w_size + window_padding,<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (s-&gt;w_size + window_padding<br>), (2*sizeof(Byte)))</span></span></td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">                                 <span class='macro'>2*<span class='keyword'>sizeof</span>(Byte))<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (s-&gt;w_size + window_padding<br>), (2*sizeof(Byte)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">    s-&gt;prev   = (Posf *)  <span class='macro'>ZALLOC(strm, s-&gt;w_size, <span class='keyword'>sizeof</span>(Pos))<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (s-&gt;w_size), (sizeof<br>(Pos)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">    <span class='comment'>/* Avoid use of uninitialized value, see:</span></td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">     <span class='comment'>* https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=11360</span></td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">    <span class='macro'>zmemzero(s-&gt;prev, s-&gt;w_size * <span class='keyword'>sizeof</span>(Pos))<span class='macro_popup'>memset(s-&gt;prev, 0, s-&gt;w_size * sizeof(Pos))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">    s-&gt;head   = (Posf *)  <span class='macro'>ZALLOC(strm, s-&gt;hash_size, <span class='keyword'>sizeof</span>(Pos))<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (s-&gt;hash_size), (<br>sizeof(Pos)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">    s-&gt;high_water = 0;      <span class='comment'>/* nothing written to s-&gt;window yet */</span></td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">    s-&gt;lit_bufsize = 1 &lt;&lt; (memLevel + 6); <span class='comment'>/* 16K elements by default */</span></td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">    <span class='comment'>/* We overlay pending_buf and sym_buf. This works since the average size</span></td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">     <span class='comment'>* for length/distance pairs over any compressed block is assured to be 31</span></td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">     <span class='comment'>* bits or less.</span></td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">     <span class='comment'>* Analysis: The longest fixed codes are a length code of 8 bits plus 5</span></td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">     <span class='comment'>* extra bits, for lengths 131 to 257. The longest fixed distance codes are</span></td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">     <span class='comment'>* 5 bits plus 13 extra bits, for distances 16385 to 32768. The longest</span></td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">     <span class='comment'>* possible fixed-codes length/distance pair is then 31 bits total.</span></td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">     <span class='comment'>* sym_buf starts one-fourth of the way into pending_buf. So there are</span></td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">     <span class='comment'>* three bytes in sym_buf for every four bytes in pending_buf. Each symbol</span></td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">     <span class='comment'>* in sym_buf is three bytes -- two for the distance and one for the</span></td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">     <span class='comment'>* literal/length. As each symbol is consumed, the pointer to the next</span></td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">     <span class='comment'>* sym_buf value to read moves forward three bytes. From that symbol, up to</span></td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">     <span class='comment'>* 31 bits are written to pending_buf. The closest the written pending_buf</span></td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">     <span class='comment'>* bits gets to the next sym_buf symbol to read is just before the last</span></td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">     <span class='comment'>* code is written. At that time, 31*(n-2) bits have been written, just</span></td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">     <span class='comment'>* after 24*(n-2) bits have been consumed from sym_buf. sym_buf starts at</span></td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">     <span class='comment'>* 8*n bits into pending_buf. (Note that the symbol buffer fills when n-1</span></td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">     <span class='comment'>* symbols are written.) The closest the writing gets to what is unread is</span></td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">     <span class='comment'>* then n+14 bits. Here n is lit_bufsize, which is 16384 by default, and</span></td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">     <span class='comment'>* can range from 128 to 32768.</span></td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">     <span class='comment'>* Therefore, at a minimum, there are 142 bits of space between what is</span></td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">     <span class='comment'>* written and what is read in the overlain buffers, so the symbols cannot</span></td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">     <span class='comment'>* be overwritten by the compressed data. That space is actually 139 bits,</span></td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">     <span class='comment'>* due to the three-bit fixed-code block header.</span></td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">     <span class='comment'>* That covers the case where either Z_FIXED is specified, forcing fixed</span></td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">     <span class='comment'>* codes, or when the use of fixed codes is chosen, because that choice</span></td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">     <span class='comment'>* results in a smaller compressed block than dynamic codes. That latter</span></td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">     <span class='comment'>* condition then assures that the above analysis also covers all dynamic</span></td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">     <span class='comment'>* blocks. A dynamic-code block will only be chosen to be emitted if it has</span></td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">     <span class='comment'>* fewer bits than a fixed-code block would for the same set of symbols.</span></td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">     <span class='comment'>* Therefore its average symbol length is assured to be less than 31. So</span></td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">     <span class='comment'>* the compressed data for a dynamic block also cannot overwrite the</span></td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">     <span class='comment'>* symbols from which it is being constructed.</span></td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">    s-&gt;pending_buf = (uchf *) <span class='macro'>ZALLOC(strm, s-&gt;lit_bufsize, 4)<span class='macro_popup'>(*((strm)-&gt;zalloc))((strm)-&gt;opaque, (s-&gt;lit_bufsize)<br>, (4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">    s-&gt;pending_buf_size = (ulg)s-&gt;lit_bufsize * 4;</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">    <span class='keyword'>if</span> (s-&gt;window == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> || s-&gt;prev == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> || s-&gt;head == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">        s-&gt;pending_buf == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">        s-&gt;status = <span class='macro'>FINISH_STATE<span class='macro_popup'>666</span></span>;</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">        strm-&gt;msg = <span class='macro'>ERR_MSG(Z_MEM_ERROR)<span class='macro_popup'>Cr_z_z_errmsg[2 -((-4))]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">        <span class='macro'>deflateEnd<span class='macro_popup'>Cr_z_deflateEnd</span></span> (strm);</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_MEM_ERROR<span class='macro_popup'>(-4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">    s-&gt;sym_buf = s-&gt;pending_buf + s-&gt;lit_bufsize;</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">    s-&gt;sym_end = (s-&gt;lit_bufsize - 1) * 3;</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">    <span class='comment'>/* We avoid equality with lit_bufsize*3 because of wraparound at 64K</span></td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">     <span class='comment'>* on 16 bit machines and because stored blocks are restricted to</span></td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">     <span class='comment'>* 64K-1 bytes.</span></td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">    s-&gt;level = level;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">    s-&gt;strategy = strategy;</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">    s-&gt;method = (Byte)method;</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>deflateReset<span class='macro_popup'>Cr_z_deflateReset</span></span>(strm);</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"><span class='comment'>/* =========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line"> <span class='comment'>* Check for a valid deflate stream state. Return 0 if ok, 1 if not.</span></td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>int</span> deflateStateCheck (strm)</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">    <span class='keyword'>if</span> (strm == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">        strm-&gt;zalloc == (<span class='macro'>alloc_func<span class='macro_popup'>Cr_z_alloc_func</span></span>)0 || strm-&gt;zfree == (<span class='macro'>free_func<span class='macro_popup'>Cr_z_free_func</span></span>)0)</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">        <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">    <span class='keyword'>if</span> (s == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> || s-&gt;strm != strm || (s-&gt;status != <span class='macro'>INIT_STATE<span class='macro_popup'>42</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">                                           s-&gt;status != <span class='macro'>GZIP_STATE<span class='macro_popup'>57</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">                                           s-&gt;status != <span class='macro'>EXTRA_STATE<span class='macro_popup'>69</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">                                           s-&gt;status != <span class='macro'>NAME_STATE<span class='macro_popup'>73</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">                                           s-&gt;status != <span class='macro'>COMMENT_STATE<span class='macro_popup'>91</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">                                           s-&gt;status != <span class='macro'>HCRC_STATE<span class='macro_popup'>103</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">                                           s-&gt;status != <span class='macro'>BUSY_STATE<span class='macro_popup'>113</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">                                           s-&gt;status != <span class='macro'>FINISH_STATE<span class='macro_popup'>666</span></span>))</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">        <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateSetDictionary<span class='macro_popup'>Cr_z_deflateSetDictionary</span></span> (strm, dictionary, dictLength)</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">    <span class='keyword'>const</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *dictionary;</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>  dictLength;</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> str, n;</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">    <span class='keyword'>int</span> wrap;</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">    <span class='keyword'>unsigned</span> avail;</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">    z_const <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *next;</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm) || dictionary == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">    wrap = s-&gt;wrap;</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">    <span class='keyword'>if</span> (wrap == 2 || (wrap == 1 &amp;&amp; s-&gt;status != <span class='macro'>INIT_STATE<span class='macro_popup'>42</span></span>) || s-&gt;lookahead)</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">    <span class='comment'>/* when using zlib wrappers, compute Adler-32 for provided dictionary */</span></td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">    <span class='keyword'>if</span> (wrap == 1)</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">        strm-&gt;adler = <span class='macro'>adler32<span class='macro_popup'>Cr_z_adler32</span></span>(strm-&gt;adler, dictionary, dictLength);</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">    s-&gt;wrap = 0;                    <span class='comment'>/* avoid computing Adler-32 in deflate_read_buf */</span></td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">    <span class='comment'>/* if dictionary would fill window, just replace the history */</span></td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">    <span class='keyword'>if</span> (dictLength &gt;= s-&gt;w_size) {</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">        <span class='keyword'>if</span> (wrap == 0) {            <span class='comment'>/* already empty otherwise */</span></td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">            <span class='macro'>CLEAR_HASH(s)<span class='macro_popup'>s-&gt;head[s-&gt;hash_size-1] = 0; memset((Cr_z_Bytef *)s-&gt;<br>head, 0, (unsigned)(s-&gt;hash_size-1)*sizeof(*s-&gt;head));</span></span>;</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">            s-&gt;strstart = 0;</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">            s-&gt;block_start = 0L;</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">            s-&gt;insert = 0;</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">        dictionary += dictLength - s-&gt;w_size;  <span class='comment'>/* use the tail */</span></td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">        dictLength = s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">    <span class='comment'>/* insert dictionary into window and hash */</span></td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">    avail = strm-&gt;avail_in;</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">    next = strm-&gt;next_in;</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">    strm-&gt;avail_in = dictLength;</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">    strm-&gt;next_in = (z_const <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *)dictionary;</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">    fill_window(s);</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">    <span class='keyword'>while</span> (s-&gt;lookahead &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">        str = s-&gt;strstart;</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">        n = s-&gt;lookahead - (<span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1);</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">        <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">            insert_string(s, str);</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">            str++;</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">        } <span class='keyword'>while</span> (--n);</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">        s-&gt;strstart = str;</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">        s-&gt;lookahead = <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">        fill_window(s);</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">    s-&gt;strstart += s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">    s-&gt;block_start = (<span class='keyword'>long</span>)s-&gt;strstart;</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">    s-&gt;insert = s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">    s-&gt;lookahead = 0;</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">    s-&gt;match_length = s-&gt;prev_length = <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">    s-&gt;match_available = 0;</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">    strm-&gt;next_in = next;</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">    strm-&gt;avail_in = avail;</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">    s-&gt;wrap = wrap;</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateGetDictionary<span class='macro_popup'>Cr_z_deflateGetDictionary</span></span> (strm, dictionary, dictLength)</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">    <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *dictionary;</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>  *dictLength;</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> len;</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm))</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">    len = s-&gt;strstart + s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">    <span class='keyword'>if</span> (len &gt; s-&gt;w_size)</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">        len = s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">    <span class='keyword'>if</span> (dictionary != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> &amp;&amp; len)</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">        <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(dictionary, s-&gt;window + s-&gt;strstart + s-&gt;lookahead - len, len);</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">    <span class='keyword'>if</span> (dictLength != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">        *dictLength = len;</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateResetKeep<span class='macro_popup'>Cr_z_deflateResetKeep</span></span> (strm)</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm)) {</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">    strm-&gt;total_in = strm-&gt;total_out = 0;</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">    strm-&gt;msg = <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>; <span class='comment'>/* use zfree if we ever allocate msg dynamically */</span></td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">    strm-&gt;data_type = <span class='macro'>Z_UNKNOWN<span class='macro_popup'>2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">    s = (deflate_state *)strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">    s-&gt;pending = 0;</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">    s-&gt;pending_out = s-&gt;pending_buf;</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">    <span class='keyword'>if</span> (s-&gt;wrap &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">        s-&gt;wrap = -s-&gt;wrap; <span class='comment'>/* was made negative by deflate(..., Z_FINISH); */</span></td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">    s-&gt;status =</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">        s-&gt;wrap == 2 ? <span class='macro'>GZIP_STATE<span class='macro_popup'>57</span></span> :</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">        s-&gt;wrap ? <span class='macro'>INIT_STATE<span class='macro_popup'>42</span></span> : <span class='macro'>BUSY_STATE<span class='macro_popup'>113</span></span>;</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">    strm-&gt;adler =</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">        s-&gt;wrap == 2 ? <span class='macro'>crc32<span class='macro_popup'>Cr_z_crc32</span></span>(0L, <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>, 0) :</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">        <span class='macro'>adler32<span class='macro_popup'>Cr_z_adler32</span></span>(0L, <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">    s-&gt;last_flush = <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">    <span class='macro'>_tr_init<span class='macro_popup'>Cr_z__tr_init</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateReset<span class='macro_popup'>Cr_z_deflateReset</span></span> (strm)</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">    <span class='keyword'>int</span> ret;</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">    ret = <span class='macro'>deflateResetKeep<span class='macro_popup'>Cr_z_deflateResetKeep</span></span>(strm);</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">    <span class='keyword'>if</span> (ret == <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">        lm_init(strm-&gt;state);</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">    <span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateSetHeader<span class='macro_popup'>Cr_z_deflateSetHeader</span></span> (strm, head)</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">    <span class='macro'>gz_headerp<span class='macro_popup'>Cr_z_gz_headerp</span></span> head;</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm) || strm-&gt;state-&gt;wrap != 2)</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">    strm-&gt;state-&gt;gzhead = head;</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflatePending<span class='macro_popup'>Cr_z_deflatePending</span></span> (strm, pending, bits)</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">    <span class='keyword'>unsigned</span> *pending;</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">    <span class='keyword'>int</span> *bits;</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm)) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">    <span class='keyword'>if</span> (pending != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">        *pending = strm-&gt;state-&gt;pending;</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">    <span class='keyword'>if</span> (bits != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">        *bits = strm-&gt;state-&gt;bi_valid;</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflatePrime<span class='macro_popup'>Cr_z_deflatePrime</span></span> (strm, bits, value)</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">    <span class='keyword'>int</span> bits;</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">    <span class='keyword'>int</span> value;</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">    <span class='keyword'>int</span> put;</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm)) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">    <span class='keyword'>if</span> (s-&gt;sym_buf &lt; s-&gt;pending_out + ((<span class='macro'>Buf_size<span class='macro_popup'>16</span></span> + 7) &gt;&gt; 3))</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_BUF_ERROR<span class='macro_popup'>(-5)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">        put = <span class='macro'>Buf_size<span class='macro_popup'>16</span></span> - s-&gt;bi_valid;</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">        <span class='keyword'>if</span> (put &gt; bits)</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">            put = bits;</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">        s-&gt;bi_buf |= (ush)((value &amp; ((1 &lt;&lt; put) - 1)) &lt;&lt; s-&gt;bi_valid);</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">        s-&gt;bi_valid += put;</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">        <span class='macro'>_tr_flush_bits<span class='macro_popup'>Cr_z__tr_flush_bits</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">        value &gt;&gt;= put;</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">        bits -= put;</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">    } <span class='keyword'>while</span> (bits);</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateParams<span class='macro_popup'>Cr_z_deflateParams</span></span>(strm, level, strategy)</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">    <span class='keyword'>int</span> level;</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">    <span class='keyword'>int</span> strategy;</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">    compress_func func;</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm)) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line"><span class='directive'>#ifdef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">    <span class='keyword'>if</span> (level != 0) level = 1;</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">    <span class='keyword'>if</span> (level == <span class='macro'>Z_DEFAULT_COMPRESSION<span class='macro_popup'>(-1)</span></span>) level = 6;</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">    <span class='keyword'>if</span> (level &lt; 0 || level &gt; 9 || strategy &lt; 0 || strategy &gt; <span class='macro'>Z_FIXED<span class='macro_popup'>4</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">    func = configuration_table[s-&gt;level].func;</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">    <span class='keyword'>if</span> ((strategy != s-&gt;strategy || func != configuration_table[level].func) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">        s-&gt;high_water) {</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">        <span class='comment'>/* Flush the last buffer: */</span></td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">        <span class='keyword'>int</span> err = <span class='macro'>deflate<span class='macro_popup'>Cr_z_deflate</span></span>(strm, <span class='macro'>Z_BLOCK<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">        <span class='keyword'>if</span> (err == <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">            <span class='keyword'>return</span> err;</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">        <span class='keyword'>if</span> (strm-&gt;avail_out == 0)</td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>Z_BUF_ERROR<span class='macro_popup'>(-5)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">    <span class='keyword'>if</span> (s-&gt;level != level) {</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">        <span class='keyword'>if</span> (s-&gt;level == 0 &amp;&amp; s-&gt;matches != 0) {</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">            <span class='keyword'>if</span> (s-&gt;matches == 1)</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">                slide_hash(s);</td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">                <span class='macro'>CLEAR_HASH(s)<span class='macro_popup'>s-&gt;head[s-&gt;hash_size-1] = 0; memset((Cr_z_Bytef *)s-&gt;<br>head, 0, (unsigned)(s-&gt;hash_size-1)*sizeof(*s-&gt;head));</span></span>;</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">            s-&gt;matches = 0;</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">        s-&gt;level = level;</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">        s-&gt;max_lazy_match   = configuration_table[level].max_lazy;</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">        s-&gt;good_match       = configuration_table[level].good_length;</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">        s-&gt;nice_match       = configuration_table[level].nice_length;</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">        s-&gt;max_chain_length = configuration_table[level].max_chain;</td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">    s-&gt;strategy = strategy;</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateTune<span class='macro_popup'>Cr_z_deflateTune</span></span>(strm, good_length, max_lazy, nice_length, max_chain)</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">    <span class='keyword'>int</span> good_length;</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">    <span class='keyword'>int</span> max_lazy;</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">    <span class='keyword'>int</span> nice_length;</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">    <span class='keyword'>int</span> max_chain;</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm)) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">    s-&gt;good_match = (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)good_length;</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line">    s-&gt;max_lazy_match = (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)max_lazy;</td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">    s-&gt;nice_match = nice_length;</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">    s-&gt;max_chain_length = (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)max_chain;</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line"><span class='comment'>/* =========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line"> <span class='comment'>* For the default windowBits of 15 and memLevel of 8, this function returns</span></td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line"> <span class='comment'>* a close to exact, as well as small, upper bound on the compressed size.</span></td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line"> <span class='comment'>* They are coded as constants here for a reason--if the #define's are</span></td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line"> <span class='comment'>* changed, then this function needs to be changed as well.  The return</span></td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line"> <span class='comment'>* value for 15 and 8 only works for those exact settings.</span></td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line"> <span class='comment'>* For any setting other than those defaults for windowBits and memLevel,</span></td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line"> <span class='comment'>* the value returned is a conservative worst case for the maximum expansion</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line"> <span class='comment'>* resulting from using fixed blocks instead of stored blocks, which deflate</span></td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line"> <span class='comment'>* can emit on compressed data for some combinations of the parameters.</span></td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line"> <span class='comment'>* This function could be more sophisticated to provide closer upper bounds for</span></td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line"> <span class='comment'>* every combination of windowBits and memLevel.  But even the conservative</span></td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line"> <span class='comment'>* upper bound of about 14% expansion does not seem onerous for output buffer</span></td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line"> <span class='comment'>* allocation.</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line"><span class='macro'>uLong<span class='macro_popup'>Cr_z_uLong</span></span> ZEXPORT <span class='macro'>deflateBound<span class='macro_popup'>Cr_z_deflateBound</span></span>(strm, sourceLen)</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">    <span class='macro'>uLong<span class='macro_popup'>Cr_z_uLong</span></span> sourceLen;</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">    <span class='macro'>uLong<span class='macro_popup'>Cr_z_uLong</span></span> complen, wraplen;</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">    <span class='comment'>/* conservative upper bound for compressed data */</span></td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">    complen = sourceLen +</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">              ((sourceLen + 7) &gt;&gt; 3) + ((sourceLen + 63) &gt;&gt; 6) + 5;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">    <span class='comment'>/* if can't get parameters, return conservative bound plus zlib wrapper */</span></td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm))</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">        <span class='keyword'>return</span> complen + 6;</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">    <span class='comment'>/* compute wrapper length */</span></td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">    <span class='keyword'>switch</span> (s-&gt;wrap) {</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line">    <span class='keyword'>case</span> 0:                                 <span class='comment'>/* raw deflate */</span></td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">        wraplen = 0;</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">    <span class='keyword'>case</span> 1:                                 <span class='comment'>/* zlib wrapper */</span></td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">        wraplen = 6 + (s-&gt;strstart ? 4 : 0);</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">    <span class='keyword'>case</span> 2:                                 <span class='comment'>/* gzip wrapper */</span></td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">        wraplen = 18;</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">        <span class='keyword'>if</span> (s-&gt;gzhead != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {          <span class='comment'>/* user-supplied gzip header */</span></td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">            <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *str;</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">            <span class='keyword'>if</span> (s-&gt;gzhead-&gt;extra != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">                wraplen += 2 + s-&gt;gzhead-&gt;extra_len;</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">            str = s-&gt;gzhead-&gt;name;</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">            <span class='keyword'>if</span> (str != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">                <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">                    wraplen++;</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">                } <span class='keyword'>while</span> (*str++);</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">            str = s-&gt;gzhead-&gt;comment;</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">            <span class='keyword'>if</span> (str != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">                <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">                    wraplen++;</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">                } <span class='keyword'>while</span> (*str++);</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">            <span class='keyword'>if</span> (s-&gt;gzhead-&gt;hcrc)</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">                wraplen += 2;</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">    <span class='keyword'>default</span>:                                <span class='comment'>/* for compiler happiness */</span></td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">        wraplen = 6;</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">    <span class='comment'>/* if not default parameters, return conservative bound */</span></td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">    <span class='keyword'>if</span> (s-&gt;w_bits != 15 || s-&gt;hash_bits != 8 + 7)</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">        <span class='keyword'>return</span> complen + wraplen;</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">    <span class='comment'>/* default settings: return tight bound for that case */</span></td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">    <span class='keyword'>return</span> sourceLen + (sourceLen &gt;&gt; 12) + (sourceLen &gt;&gt; 14) +</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">           (sourceLen &gt;&gt; 25) + 13 - 6 + wraplen;</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line"><span class='comment'>/* =========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line"> <span class='comment'>* Put a short in the pending buffer. The 16-bit value is put in MSB order.</span></td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line"> <span class='comment'>* IN assertion: the stream state is correct and there is enough room in</span></td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line"> <span class='comment'>* pending_buf.</span></td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> putShortMSB (s, b)</td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> b;</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">    <span class='macro'>put_byte(s, (Byte)(b &gt;&gt; 8))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)(b &gt;&gt;<br> 8));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">    <span class='macro'>put_byte(s, (Byte)(b &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)(b &amp;<br> 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line"><span class='comment'>/* =========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line"> <span class='comment'>* Flush as much pending output as possible. All deflate() output, except for</span></td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line"> <span class='comment'>* some deflate_stored() output, goes through this function so some</span></td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line"> <span class='comment'>* applications may wish to modify it to avoid allocating a large</span></td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line"> <span class='comment'>* strm-&gt;next_out buffer and copying into it. (See also deflate_read_buf()).</span></td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> flush_pending(strm)</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">    <span class='keyword'>unsigned</span> len;</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">    deflate_state *s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">    <span class='macro'>_tr_flush_bits<span class='macro_popup'>Cr_z__tr_flush_bits</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">    len = s-&gt;pending;</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">    <span class='keyword'>if</span> (len &gt; strm-&gt;avail_out) len = strm-&gt;avail_out;</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line">    <span class='keyword'>if</span> (len == 0) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">    <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(strm-&gt;next_out, s-&gt;pending_out, len);</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">    strm-&gt;next_out  += len;</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">    s-&gt;pending_out  += len;</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">    strm-&gt;total_out += len;</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">    strm-&gt;avail_out -= len;</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">    s-&gt;pending      -= len;</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">    <span class='keyword'>if</span> (s-&gt;pending == 0) {</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">        s-&gt;pending_out = s-&gt;pending_buf;</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line"> <span class='comment'>* Update the header CRC with the bytes s-&gt;pending_buf[beg..s-&gt;pending - 1].</span></td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line"><span class='directive'>#define <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line">    <span class='directive'>do { \</span></td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">        <span class='directive'>if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (beg)) \</span></td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">            <span class='directive'>strm-&gt;adler = <span class='macro'>crc32<span class='macro_popup'>Cr_z_crc32</span></span>(strm-&gt;adler, s-&gt;pending_buf + (beg), \</span></td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">                                <span class='directive'>s-&gt;pending - (beg)); \</span></td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">    <span class='directive'>} while (0)</span></td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflate<span class='macro_popup'>Cr_z_deflate</span></span> (strm, flush)</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">    <span class='keyword'>int</span> flush;</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">    <span class='keyword'>int</span> old_flush; <span class='comment'>/* value of flush param for previous deflate call */</span></td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm) || flush &gt; <span class='macro'>Z_BLOCK<span class='macro_popup'>5</span></span> || flush &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">    s = strm-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line">    <span class='keyword'>if</span> (strm-&gt;next_out == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">        (strm-&gt;avail_in != 0 &amp;&amp; strm-&gt;next_in == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) ||</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">        (s-&gt;status == <span class='macro'>FINISH_STATE<span class='macro_popup'>666</span></span> &amp;&amp; flush != <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>)) {</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">        <span class='macro'>ERR_RETURN(strm, Z_STREAM_ERROR)<span class='macro_popup'>return (strm-&gt;msg = Cr_z_z_errmsg[2 -((-2))], ((-2)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">    <span class='keyword'>if</span> (strm-&gt;avail_out == 0) <span class='macro'>ERR_RETURN(strm, Z_BUF_ERROR)<span class='macro_popup'>return (strm-&gt;msg = Cr_z_z_errmsg[2 -((-5))], ((-5)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">    old_flush = s-&gt;last_flush;</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line">    s-&gt;last_flush = flush;</td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line">    <span class='comment'>/* Flush as much pending output as possible */</span></td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">    <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">        flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">        <span class='keyword'>if</span> (strm-&gt;avail_out == 0) {</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">            <span class='comment'>/* Since avail_out is 0, deflate will be called again with</span></td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">             <span class='comment'>* more output space, but possibly with both pending and</span></td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line">             <span class='comment'>* avail_in equal to zero. There won't be anything to do,</span></td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">             <span class='comment'>* but this is not an error situation so make sure we</span></td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">             <span class='comment'>* return OK instead of BUF_ERROR at next call of deflate:</span></td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line">            s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">    <span class='comment'>/* Make sure there is something to do and avoid duplicate consecutive</span></td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">     <span class='comment'>* flushes. For repeated and useless calls with Z_FINISH, we keep</span></td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">     <span class='comment'>* returning Z_STREAM_END instead of Z_BUF_ERROR.</span></td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (strm-&gt;avail_in == 0 &amp;&amp; <span class='macro'>RANK(flush)<span class='macro_popup'>(((flush) * 2) - ((flush) &gt; 4 ? 9 : 0))</span></span> &lt;= <span class='macro'>RANK(old_flush)<span class='macro_popup'>(((old_flush) * 2) - ((old_flush) &gt; 4 ? 9 : 0))</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">               flush != <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line">        <span class='macro'>ERR_RETURN(strm, Z_BUF_ERROR)<span class='macro_popup'>return (strm-&gt;msg = Cr_z_z_errmsg[2 -((-5))], ((-5)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">    <span class='comment'>/* User must not provide more input after the first FINISH: */</span></td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>FINISH_STATE<span class='macro_popup'>666</span></span> &amp;&amp; strm-&gt;avail_in != 0) {</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">        <span class='macro'>ERR_RETURN(strm, Z_BUF_ERROR)<span class='macro_popup'>return (strm-&gt;msg = Cr_z_z_errmsg[2 -((-5))], ((-5)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">    <span class='comment'>/* Write the header */</span></td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>INIT_STATE<span class='macro_popup'>42</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">        <span class='comment'>/* zlib header */</span></td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">        <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> header = (<span class='macro'>Z_DEFLATED<span class='macro_popup'>8</span></span> + ((s-&gt;w_bits-8)&lt;&lt;4)) &lt;&lt; 8;</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">        <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> level_flags;</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">        <span class='keyword'>if</span> (s-&gt;strategy &gt;= <span class='macro'>Z_HUFFMAN_ONLY<span class='macro_popup'>2</span></span> || s-&gt;level &lt; 2)</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">            level_flags = 0;</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span> (s-&gt;level &lt; 6)</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line">            level_flags = 1;</td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span> (s-&gt;level == 6)</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">            level_flags = 2;</td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">            level_flags = 3;</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">        header |= (level_flags &lt;&lt; 6);</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">        <span class='keyword'>if</span> (s-&gt;strstart != 0) header |= <span class='macro'>PRESET_DICT<span class='macro_popup'>0x20</span></span>;</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">        header += 31 - (header % 31);</td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">        putShortMSB(s, header);</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">        <span class='comment'>/* Save the adler32 of the preset dictionary: */</span></td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">        <span class='keyword'>if</span> (s-&gt;strstart != 0) {</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">            putShortMSB(s, (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)(strm-&gt;adler &gt;&gt; 16));</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">            putShortMSB(s, (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)(strm-&gt;adler &amp; 0xffff));</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">        strm-&gt;adler = <span class='macro'>adler32<span class='macro_popup'>Cr_z_adler32</span></span>(0L, <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line">        s-&gt;status = <span class='macro'>BUSY_STATE<span class='macro_popup'>113</span></span>;</td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">        <span class='comment'>/* Compression must start with an empty pending buffer */</span></td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">        flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">        <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">            s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>GZIP_STATE<span class='macro_popup'>57</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">        <span class='comment'>/* gzip header */</span></td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">        <span class='macro'>crc_reset<span class='macro_popup'>Cr_z_crc_reset</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">        <span class='macro'>put_byte(s, 31)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(31);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">        <span class='macro'>put_byte(s, 139)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(139);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">        <span class='macro'>put_byte(s, 8)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(8);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">        <span class='keyword'>if</span> (s-&gt;gzhead == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line">            <span class='macro'>put_byte(s, 0)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(0);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line">            <span class='macro'>put_byte(s, 0)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(0);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">            <span class='macro'>put_byte(s, 0)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(0);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">            <span class='macro'>put_byte(s, 0)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(0);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line">            <span class='macro'>put_byte(s, 0)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(0);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">            <span class='macro'>put_byte(s, s-&gt;level == 9 ? 2 :<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;level<br> == 9 ? 2 : (s-&gt;strategy &gt;= 2 || s-&gt;level &lt; 2 ? 4<br> : 0));}</span></span></td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line">                     <span class='macro'>(s-&gt;strategy &gt;= Z_HUFFMAN_ONLY || s-&gt;level &lt; 2 ?<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;level<br> == 9 ? 2 : (s-&gt;strategy &gt;= 2 || s-&gt;level &lt; 2 ? 4<br> : 0));}</span></span></td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">                      <span class='macro'>4 : 0))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;level<br> == 9 ? 2 : (s-&gt;strategy &gt;= 2 || s-&gt;level &lt; 2 ? 4<br> : 0));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">            <span class='macro'>put_byte(s, OS_CODE)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(3);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">            s-&gt;status = <span class='macro'>BUSY_STATE<span class='macro_popup'>113</span></span>;</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">            <span class='comment'>/* Compression must start with an empty pending buffer */</span></td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">            flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">            <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">                s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">                <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">        <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">            <span class='macro'>put_byte(s, (s-&gt;gzhead-&gt;text ? 1 : 0) +<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;text ? 1 : 0) + (s-&gt;gzhead-&gt;hcrc ? 2 : 0) + (s-&gt;<br>gzhead-&gt;extra == 0 ? 0 : 4) + (s-&gt;gzhead-&gt;name == 0 ?<br> 0 : 8) + (s-&gt;gzhead-&gt;comment == 0 ? 0 : 16));}</span></span></td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">                     <span class='macro'>(s-&gt;gzhead-&gt;hcrc ? 2 : 0) +<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;text ? 1 : 0) + (s-&gt;gzhead-&gt;hcrc ? 2 : 0) + (s-&gt;<br>gzhead-&gt;extra == 0 ? 0 : 4) + (s-&gt;gzhead-&gt;name == 0 ?<br> 0 : 8) + (s-&gt;gzhead-&gt;comment == 0 ? 0 : 16));}</span></span></td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line">                     <span class='macro'>(s-&gt;gzhead-&gt;extra == Z_NULL ? 0 : 4) +<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;text ? 1 : 0) + (s-&gt;gzhead-&gt;hcrc ? 2 : 0) + (s-&gt;<br>gzhead-&gt;extra == 0 ? 0 : 4) + (s-&gt;gzhead-&gt;name == 0 ?<br> 0 : 8) + (s-&gt;gzhead-&gt;comment == 0 ? 0 : 16));}</span></span></td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">                     <span class='macro'>(s-&gt;gzhead-&gt;name == Z_NULL ? 0 : 8) +<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;text ? 1 : 0) + (s-&gt;gzhead-&gt;hcrc ? 2 : 0) + (s-&gt;<br>gzhead-&gt;extra == 0 ? 0 : 4) + (s-&gt;gzhead-&gt;name == 0 ?<br> 0 : 8) + (s-&gt;gzhead-&gt;comment == 0 ? 0 : 16));}</span></span></td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">                     <span class='macro'>(s-&gt;gzhead-&gt;comment == Z_NULL ? 0 : 16)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;text ? 1 : 0) + (s-&gt;gzhead-&gt;hcrc ? 2 : 0) + (s-&gt;<br>gzhead-&gt;extra == 0 ? 0 : 4) + (s-&gt;gzhead-&gt;name == 0 ?<br> 0 : 8) + (s-&gt;gzhead-&gt;comment == 0 ? 0 : 16));}</span></span></td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">                     <span class='macro'>)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;text ? 1 : 0) + (s-&gt;gzhead-&gt;hcrc ? 2 : 0) + (s-&gt;<br>gzhead-&gt;extra == 0 ? 0 : 4) + (s-&gt;gzhead-&gt;name == 0 ?<br> 0 : 8) + (s-&gt;gzhead-&gt;comment == 0 ? 0 : 16));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">            <span class='macro'>put_byte(s, (Byte)(s-&gt;gzhead-&gt;time &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)(s-&gt;<br>gzhead-&gt;time &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">            <span class='macro'>put_byte(s, (Byte)((s-&gt;gzhead-&gt;time &gt;&gt; 8) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((s-&gt;<br>gzhead-&gt;time &gt;&gt; 8) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">            <span class='macro'>put_byte(s, (Byte)((s-&gt;gzhead-&gt;time &gt;&gt; 16) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((s-&gt;<br>gzhead-&gt;time &gt;&gt; 16) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line">            <span class='macro'>put_byte(s, (Byte)((s-&gt;gzhead-&gt;time &gt;&gt; 24) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((s-&gt;<br>gzhead-&gt;time &gt;&gt; 24) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">            <span class='macro'>put_byte(s, s-&gt;level == 9 ? 2 :<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;level<br> == 9 ? 2 : (s-&gt;strategy &gt;= 2 || s-&gt;level &lt; 2 ? 4<br> : 0));}</span></span></td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">                     <span class='macro'>(s-&gt;strategy &gt;= Z_HUFFMAN_ONLY || s-&gt;level &lt; 2 ?<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;level<br> == 9 ? 2 : (s-&gt;strategy &gt;= 2 || s-&gt;level &lt; 2 ? 4<br> : 0));}</span></span></td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">                      <span class='macro'>4 : 0))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;level<br> == 9 ? 2 : (s-&gt;strategy &gt;= 2 || s-&gt;level &lt; 2 ? 4<br> : 0));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">            <span class='macro'>put_byte(s, s-&gt;gzhead-&gt;os &amp; 0xff)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;gzhead<br>-&gt;os &amp; 0xff);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line">            <span class='keyword'>if</span> (s-&gt;gzhead-&gt;extra != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line">                <span class='macro'>put_byte(s, s-&gt;gzhead-&gt;extra_len &amp; 0xff)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(s-&gt;gzhead<br>-&gt;extra_len &amp; 0xff);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line">                <span class='macro'>put_byte(s, (s-&gt;gzhead-&gt;extra_len &gt;&gt; 8) &amp; 0xff)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((s-&gt;gzhead<br>-&gt;extra_len &gt;&gt; 8) &amp; 0xff);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">            <span class='keyword'>if</span> (s-&gt;gzhead-&gt;hcrc)</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">                strm-&gt;adler = <span class='macro'>crc32<span class='macro_popup'>Cr_z_crc32</span></span>(strm-&gt;adler, s-&gt;pending_buf,</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">                                    s-&gt;pending);</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">            s-&gt;gzindex = 0;</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line">            s-&gt;status = <span class='macro'>EXTRA_STATE<span class='macro_popup'>69</span></span>;</td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>EXTRA_STATE<span class='macro_popup'>69</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">        <span class='keyword'>if</span> (s-&gt;gzhead-&gt;extra != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">            ulg beg = s-&gt;pending;   <span class='comment'>/* start of bytes to update crc */</span></td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">            <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> left = (s-&gt;gzhead-&gt;extra_len &amp; 0xffff) - s-&gt;gzindex;</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">            <span class='keyword'>while</span> (s-&gt;pending + left &gt; s-&gt;pending_buf_size) {</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">                <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> copy = s-&gt;pending_buf_size - s-&gt;pending;</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">                <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;pending_buf + s-&gt;pending,</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">                        s-&gt;gzhead-&gt;extra + s-&gt;gzindex, copy);</td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line">                s-&gt;pending = s-&gt;pending_buf_size;</td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">                <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">                s-&gt;gzindex += copy;</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">                flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">                <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">                    s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line">                    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">                beg = 0;</td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">                left -= copy;</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">            <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;pending_buf + s-&gt;pending,</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line">                    s-&gt;gzhead-&gt;extra + s-&gt;gzindex, left);</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">            s-&gt;pending += left;</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">            <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">            s-&gt;gzindex = 0;</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">        s-&gt;status = <span class='macro'>NAME_STATE<span class='macro_popup'>73</span></span>;</td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>NAME_STATE<span class='macro_popup'>73</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">        <span class='keyword'>if</span> (s-&gt;gzhead-&gt;name != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">            ulg beg = s-&gt;pending;   <span class='comment'>/* start of bytes to update crc */</span></td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">            <span class='keyword'>int</span> val;</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">            <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line">                <span class='keyword'>if</span> (s-&gt;pending == s-&gt;pending_buf_size) {</td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line">                    <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">                    flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">                    <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">                        s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">                        <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line">                    beg = 0;</td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">                val = s-&gt;gzhead-&gt;name[s-&gt;gzindex++];</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">                <span class='macro'>put_byte(s, val)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(val);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">            } <span class='keyword'>while</span> (val != 0);</td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">            <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">            s-&gt;gzindex = 0;</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">        s-&gt;status = <span class='macro'>COMMENT_STATE<span class='macro_popup'>91</span></span>;</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>COMMENT_STATE<span class='macro_popup'>91</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">        <span class='keyword'>if</span> (s-&gt;gzhead-&gt;comment != <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">            ulg beg = s-&gt;pending;   <span class='comment'>/* start of bytes to update crc */</span></td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">            <span class='keyword'>int</span> val;</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">            <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">                <span class='keyword'>if</span> (s-&gt;pending == s-&gt;pending_buf_size) {</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">                    <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">                    flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">                    <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">                        s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">                        <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">                    beg = 0;</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">                val = s-&gt;gzhead-&gt;comment[s-&gt;gzindex++];</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">                <span class='macro'>put_byte(s, val)<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)(val);}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">            } <span class='keyword'>while</span> (val != 0);</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">            <span class='macro'>HCRC_UPDATE(beg)<span class='macro_popup'>do { if (s-&gt;gzhead-&gt;hcrc &amp;&amp; s-&gt;pending &gt; (<br>beg)) strm-&gt;adler = Cr_z_crc32(strm-&gt;adler, s-&gt;pending_buf<br> + (beg), s-&gt;pending - (beg)); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">        s-&gt;status = <span class='macro'>HCRC_STATE<span class='macro_popup'>103</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">    <span class='keyword'>if</span> (s-&gt;status == <span class='macro'>HCRC_STATE<span class='macro_popup'>103</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">        <span class='keyword'>if</span> (s-&gt;gzhead-&gt;hcrc) {</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">            <span class='keyword'>if</span> (s-&gt;pending + 2 &gt; s-&gt;pending_buf_size) {</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">                flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">                <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">                    s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">                    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">            <span class='macro'>put_byte(s, (Byte)(strm-&gt;adler &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)(strm<br>-&gt;adler &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">            <span class='macro'>put_byte(s, (Byte)((strm-&gt;adler &gt;&gt; 8) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;adler &gt;&gt; 8) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">            strm-&gt;adler = <span class='macro'>crc32<span class='macro_popup'>Cr_z_crc32</span></span>(0L, <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">        s-&gt;status = <span class='macro'>BUSY_STATE<span class='macro_popup'>113</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">        <span class='comment'>/* Compression must start with an empty pending buffer */</span></td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">        flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">        <span class='keyword'>if</span> (s-&gt;pending != 0) {</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">            s-&gt;last_flush = -1;</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">    <span class='comment'>/* Start a new block or continue the current one.</span></td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">    <span class='keyword'>if</span> (strm-&gt;avail_in != 0 || s-&gt;lookahead != 0 ||</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">        (flush != <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span> &amp;&amp; s-&gt;status != <span class='macro'>FINISH_STATE<span class='macro_popup'>666</span></span>)) {</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">        block_state bstate;</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">        bstate = s-&gt;level == 0 ? deflate_stored(s, flush) :</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">                 s-&gt;strategy == <span class='macro'>Z_HUFFMAN_ONLY<span class='macro_popup'>2</span></span> ? deflate_huff(s, flush) :</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">                 s-&gt;strategy == <span class='macro'>Z_RLE<span class='macro_popup'>3</span></span> ? deflate_rle(s, flush) :</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">                 (*(configuration_table[s-&gt;level].func))(s, flush);</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">        <span class='keyword'>if</span> (bstate == finish_started || bstate == finish_done) {</td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">            s-&gt;status = <span class='macro'>FINISH_STATE<span class='macro_popup'>666</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">        <span class='keyword'>if</span> (bstate == need_more || bstate == finish_started) {</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">            <span class='keyword'>if</span> (strm-&gt;avail_out == 0) {</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">                s-&gt;last_flush = -1; <span class='comment'>/* avoid BUF_ERROR next call, see above */</span></td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">            <span class='comment'>/* If flush != Z_NO_FLUSH &amp;&amp; avail_out == 0, the next call</span></td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">             <span class='comment'>* of deflate should use the same flush parameter to make sure</span></td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">             <span class='comment'>* that the flush is complete. So we don't have to output an</span></td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">             <span class='comment'>* empty block here, this will be done at next call. This also</span></td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">             <span class='comment'>* ensures that for a very small output buffer, we emit at most</span></td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">             <span class='comment'>* one empty block.</span></td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">        <span class='keyword'>if</span> (bstate == block_done) {</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">            <span class='keyword'>if</span> (flush == <span class='macro'>Z_PARTIAL_FLUSH<span class='macro_popup'>1</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">                <span class='macro'>_tr_align<span class='macro_popup'>Cr_z__tr_align</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (flush != <span class='macro'>Z_BLOCK<span class='macro_popup'>5</span></span>) { <span class='comment'>/* FULL_FLUSH or SYNC_FLUSH */</span></td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">                <span class='macro'>_tr_stored_block<span class='macro_popup'>Cr_z__tr_stored_block</span></span>(s, (<span class='keyword'>char</span>*)0, 0L, 0);</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">                <span class='comment'>/* For a full flush, this empty block will be recognized</span></td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">                 <span class='comment'>* as a special marker by inflate_sync().</span></td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">                 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">                <span class='keyword'>if</span> (flush == <span class='macro'>Z_FULL_FLUSH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">                    <span class='macro'>CLEAR_HASH(s)<span class='macro_popup'>s-&gt;head[s-&gt;hash_size-1] = 0; memset((Cr_z_Bytef *)s-&gt;<br>head, 0, (unsigned)(s-&gt;hash_size-1)*sizeof(*s-&gt;head));</span></span>;             <span class='comment'>/* forget history */</span></td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">                    <span class='keyword'>if</span> (s-&gt;lookahead == 0) {</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">                        s-&gt;strstart = 0;</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">                        s-&gt;block_start = 0L;</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">                        s-&gt;insert = 0;</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">            flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">            <span class='keyword'>if</span> (strm-&gt;avail_out == 0) {</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">              s-&gt;last_flush = -1; <span class='comment'>/* avoid BUF_ERROR at next call, see above */</span></td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">              <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">    <span class='keyword'>if</span> (flush != <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">    <span class='keyword'>if</span> (s-&gt;wrap &lt;= 0) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_END<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">    <span class='comment'>/* Write the trailer */</span></td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">    <span class='keyword'>if</span> (s-&gt;wrap == 2) {</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">        <span class='macro'>crc_finalize<span class='macro_popup'>Cr_z_crc_finalize</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">        <span class='macro'>put_byte(s, (Byte)(strm-&gt;adler &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)(strm<br>-&gt;adler &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">        <span class='macro'>put_byte(s, (Byte)((strm-&gt;adler &gt;&gt; 8) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;adler &gt;&gt; 8) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">        <span class='macro'>put_byte(s, (Byte)((strm-&gt;adler &gt;&gt; 16) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;adler &gt;&gt; 16) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">        <span class='macro'>put_byte(s, (Byte)((strm-&gt;adler &gt;&gt; 24) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;adler &gt;&gt; 24) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">        <span class='macro'>put_byte(s, (Byte)(strm-&gt;total_in &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)(strm<br>-&gt;total_in &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">        <span class='macro'>put_byte(s, (Byte)((strm-&gt;total_in &gt;&gt; 8) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;total_in &gt;&gt; 8) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line">        <span class='macro'>put_byte(s, (Byte)((strm-&gt;total_in &gt;&gt; 16) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;total_in &gt;&gt; 16) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">        <span class='macro'>put_byte(s, (Byte)((strm-&gt;total_in &gt;&gt; 24) &amp; 0xff))<span class='macro_popup'>{s-&gt;pending_buf[s-&gt;pending++] = (Cr_z_Bytef)((Byte)((strm<br>-&gt;total_in &gt;&gt; 24) &amp; 0xff));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">        putShortMSB(s, (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)(strm-&gt;adler &gt;&gt; 16));</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">        putShortMSB(s, (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)(strm-&gt;adler &amp; 0xffff));</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">    flush_pending(strm);</td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">    <span class='comment'>/* If avail_out is zero, the application will call deflate again</span></td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">     <span class='comment'>* to flush the rest.</span></td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">    <span class='keyword'>if</span> (s-&gt;wrap &gt; 0) s-&gt;wrap = -s-&gt;wrap; <span class='comment'>/* write the trailer only once! */</span></td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">    <span class='keyword'>return</span> s-&gt;pending != 0 ? <span class='macro'>Z_OK<span class='macro_popup'>0</span></span> : <span class='macro'>Z_STREAM_END<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line"><span class='comment'>/* ========================================================================= */</span></td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateEnd<span class='macro_popup'>Cr_z_deflateEnd</span></span> (strm)</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">    <span class='keyword'>int</span> status;</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(strm)) <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">    status = strm-&gt;state-&gt;status;</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">    <span class='comment'>/* Deallocate in reverse order of allocations: */</span></td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">    <span class='macro'>TRY_FREE(strm, strm-&gt;state-&gt;pending_buf)<span class='macro_popup'>{if (strm-&gt;state-&gt;pending_buf) (*((strm)-&gt;zfree))((strm<br>)-&gt;opaque, (Cr_z_voidpf)(strm-&gt;state-&gt;pending_buf));<br>}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">    <span class='macro'>TRY_FREE(strm, strm-&gt;state-&gt;head)<span class='macro_popup'>{if (strm-&gt;state-&gt;head) (*((strm)-&gt;zfree))((strm)-&gt;<br>opaque, (Cr_z_voidpf)(strm-&gt;state-&gt;head));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">    <span class='macro'>TRY_FREE(strm, strm-&gt;state-&gt;prev)<span class='macro_popup'>{if (strm-&gt;state-&gt;prev) (*((strm)-&gt;zfree))((strm)-&gt;<br>opaque, (Cr_z_voidpf)(strm-&gt;state-&gt;prev));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">    <span class='macro'>TRY_FREE(strm, strm-&gt;state-&gt;window)<span class='macro_popup'>{if (strm-&gt;state-&gt;window) (*((strm)-&gt;zfree))((strm)-&gt;<br>opaque, (Cr_z_voidpf)(strm-&gt;state-&gt;window));}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">    <span class='macro'>ZFREE(strm, strm-&gt;state)<span class='macro_popup'>(*((strm)-&gt;zfree))((strm)-&gt;opaque, (Cr_z_voidpf)(strm-&gt;<br>state))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">    strm-&gt;state = <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">    <span class='keyword'>return</span> status == <span class='macro'>BUSY_STATE<span class='macro_popup'>113</span></span> ? <span class='macro'>Z_DATA_ERROR<span class='macro_popup'>(-3)</span></span> : <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line"><span class='comment'>/* =========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line"> <span class='comment'>* Copy the source state to the destination state.</span></td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line"> <span class='comment'>* To simplify the source, this is not supported for 16-bit MSDOS (which</span></td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line"> <span class='comment'>* doesn't have enough memory anyway to duplicate compression states).</span></td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line"><span class='keyword'>int</span> ZEXPORT <span class='macro'>deflateCopy<span class='macro_popup'>Cr_z_deflateCopy</span></span> (dest, source)</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">    z_streamp dest;</td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">    z_streamp source;</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line"><span class='directive'>#ifdef MAXSEG_64K</span></td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">    deflate_state *ds;</td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">    deflate_state *ss;</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">    <span class='keyword'>if</span> (deflateStateCheck(source) || dest == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_STREAM_ERROR<span class='macro_popup'>(-2)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">    ss = source-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">    <span class="mrange"><span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span></span>((<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)dest, (<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)source, <span class='keyword'>sizeof</span>(z_stream));</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:5ex; max-width:58em">Call to function 'memcpy' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memcpy_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">    ds = (deflate_state *) <span class='macro'>ZALLOC(dest, 1, <span class='keyword'>sizeof</span>(deflate_state))<span class='macro_popup'>(*((dest)-&gt;zalloc))((dest)-&gt;opaque, (1), (sizeof(deflate_state<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">    <span class='keyword'>if</span> (ds == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) <span class='keyword'>return</span> <span class='macro'>Z_MEM_ERROR<span class='macro_popup'>(-4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">    dest-&gt;state = (<span class='keyword'>struct</span> internal_state FAR *) ds;</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">    <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>((<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)ds, (<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)ss, <span class='keyword'>sizeof</span>(deflate_state));</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">    ds-&gt;strm = dest;</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">    ds-&gt;window = (<span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *) <span class='macro'>ZALLOC(dest, ds-&gt;w_size, 2*<span class='keyword'>sizeof</span>(Byte))<span class='macro_popup'>(*((dest)-&gt;zalloc))((dest)-&gt;opaque, (ds-&gt;w_size), (2<br>*sizeof(Byte)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">    ds-&gt;prev   = (Posf *)  <span class='macro'>ZALLOC(dest, ds-&gt;w_size, <span class='keyword'>sizeof</span>(Pos))<span class='macro_popup'>(*((dest)-&gt;zalloc))((dest)-&gt;opaque, (ds-&gt;w_size), (sizeof<br>(Pos)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">    ds-&gt;head   = (Posf *)  <span class='macro'>ZALLOC(dest, ds-&gt;hash_size, <span class='keyword'>sizeof</span>(Pos))<span class='macro_popup'>(*((dest)-&gt;zalloc))((dest)-&gt;opaque, (ds-&gt;hash_size),<br> (sizeof(Pos)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line">    ds-&gt;pending_buf = (uchf *) <span class='macro'>ZALLOC(dest, ds-&gt;lit_bufsize, 4)<span class='macro_popup'>(*((dest)-&gt;zalloc))((dest)-&gt;opaque, (ds-&gt;lit_bufsize<br>), (4))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">    <span class='keyword'>if</span> (ds-&gt;window == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> || ds-&gt;prev == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> || ds-&gt;head == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">        ds-&gt;pending_buf == <span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">        <span class='macro'>deflateEnd<span class='macro_popup'>Cr_z_deflateEnd</span></span> (dest);</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>Z_MEM_ERROR<span class='macro_popup'>(-4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">    <span class='comment'>/* following zmemcpy do not work for 16-bit MSDOS */</span></td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">    <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(ds-&gt;window, ss-&gt;window, ds-&gt;w_size * 2 * <span class='keyword'>sizeof</span>(Byte));</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">    <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>((<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)ds-&gt;prev, (<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)ss-&gt;prev, ds-&gt;w_size * <span class='keyword'>sizeof</span>(Pos));</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">    <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>((<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)ds-&gt;head, (<span class='macro'>voidpf<span class='macro_popup'>Cr_z_voidpf</span></span>)ss-&gt;head, ds-&gt;hash_size * <span class='keyword'>sizeof</span>(Pos));</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">    <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(ds-&gt;pending_buf, ss-&gt;pending_buf, (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)ds-&gt;pending_buf_size);</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">    ds-&gt;pending_out = ds-&gt;pending_buf + (ss-&gt;pending_out - ss-&gt;pending_buf);</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">    ds-&gt;sym_buf = ds-&gt;pending_buf + ds-&gt;lit_bufsize;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">    ds-&gt;l_desc.dyn_tree = ds-&gt;dyn_ltree;</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">    ds-&gt;d_desc.dyn_tree = ds-&gt;dyn_dtree;</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">    ds-&gt;bl_desc.dyn_tree = ds-&gt;bl_tree;</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>Z_OK<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line"><span class='directive'>#endif /* MAXSEG_64K */</span></td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line"> <span class='comment'>* Read a new buffer from the current input stream, update the adler32</span></td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line"> <span class='comment'>* and total number of bytes read.  All deflate() input goes through</span></td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line"> <span class='comment'>* this function so some applications may wish to modify it to avoid</span></td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line"> <span class='comment'>* allocating a large strm-&gt;next_in buffer and copying from it.</span></td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line"> <span class='comment'>* (See also flush_pending()).</span></td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">ZLIB_INTERNAL <span class='keyword'>unsigned</span> <span class='macro'>deflate_read_buf<span class='macro_popup'>Cr_z_deflate_read_buf</span></span>(strm, buf, size)</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">    z_streamp strm;</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">    <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *buf;</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">    <span class='keyword'>unsigned</span> size;</td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">    <span class='keyword'>unsigned</span> len = strm-&gt;avail_in;</td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">    <span class='keyword'>if</span> (len &gt; size) len = size;</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">    <span class='keyword'>if</span> (len == 0) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">    strm-&gt;avail_in  -= len;</td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line"><span class='directive'>#ifdef GZIP</span></td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">    <span class='keyword'>if</span> (strm-&gt;state-&gt;wrap == 2)</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">        <span class='macro'>copy_with_crc<span class='macro_popup'>Cr_z_copy_with_crc</span></span>(strm, buf, len);</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">        <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(buf, strm-&gt;next_in, len);</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">        <span class='keyword'>if</span> (strm-&gt;state-&gt;wrap == 1)</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">            strm-&gt;adler = <span class='macro'>adler32<span class='macro_popup'>Cr_z_adler32</span></span>(strm-&gt;adler, buf, len);</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">    strm-&gt;next_in  += len;</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">    strm-&gt;total_in += len;</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">    <span class='keyword'>return</span> len;</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line"> <span class='comment'>* Initialize the "longest match" routines for a new zlib stream</span></td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> lm_init (s)</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">    s-&gt;window_size = (ulg)2L*s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">    <span class='macro'>CLEAR_HASH(s)<span class='macro_popup'>s-&gt;head[s-&gt;hash_size-1] = 0; memset((Cr_z_Bytef *)s-&gt;<br>head, 0, (unsigned)(s-&gt;hash_size-1)*sizeof(*s-&gt;head));</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">    <span class='comment'>/* Set the default configuration parameters:</span></td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">    s-&gt;max_lazy_match   = configuration_table[s-&gt;level].max_lazy;</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">    s-&gt;good_match       = configuration_table[s-&gt;level].good_length;</td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">    s-&gt;nice_match       = configuration_table[s-&gt;level].nice_length;</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">    s-&gt;max_chain_length = configuration_table[s-&gt;level].max_chain;</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">    s-&gt;strstart = 0;</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">    s-&gt;block_start = 0L;</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">    s-&gt;lookahead = 0;</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">    s-&gt;insert = 0;</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">    s-&gt;match_length = s-&gt;prev_length = <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">    s-&gt;match_available = 0;</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">    s-&gt;ins_h = 0;</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line"><span class='directive'>#ifdef ASMV</span></td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">    match_init(); <span class='comment'>/* initialize the asm code */</span></td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line"> <span class='comment'>* Set match_start to the longest match starting at the given string and</span></td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line"> <span class='comment'>* return its length. Matches shorter or equal to prev_length are discarded,</span></td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line"> <span class='comment'>* in which case the result is equal to prev_length and match_start is</span></td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line"> <span class='comment'>* garbage.</span></td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line"> <span class='comment'>* IN assertions: cur_match is the head of the hash chain for the current</span></td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line"> <span class='comment'>*   string (strstart) and its distance is &lt;= MAX_DIST, and prev_length &gt;= 1</span></td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line"> <span class='comment'>* OUT assertion: the match length is not greater than s-&gt;lookahead.</span></td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line"><span class='directive'>#ifndef ASMV</span></td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line"><span class='comment'>/* For 80x86 and 680x0, an optimized version will be provided in match.asm or</span></td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line"> <span class='comment'>* match.S. The code will be functionally equivalent.</span></td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> longest_match(s, cur_match)</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">    IPos cur_match;                             <span class='comment'>/* current match */</span></td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">    <span class='keyword'>unsigned</span> chain_length = s-&gt;max_chain_length;<span class='comment'>/* max hash chain length */</span></td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *scan = s-&gt;window + s-&gt;strstart; <span class='comment'>/* current string */</span></td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *match;                      <span class='comment'>/* matched string */</span></td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">    <span class='keyword'>register</span> <span class='keyword'>int</span> len;                           <span class='comment'>/* length of current match */</span></td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">    <span class='keyword'>int</span> best_len = (<span class='keyword'>int</span>)s-&gt;prev_length;         <span class='comment'>/* best match length so far */</span></td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">    <span class='keyword'>int</span> nice_match = s-&gt;nice_match;             <span class='comment'>/* stop if match long enough */</span></td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">    IPos limit = s-&gt;strstart &gt; (IPos)<span class='macro'>MAX_DIST(s)<span class='macro_popup'>((s)-&gt;w_size-(258 +3 +1))</span></span> ?</td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">        s-&gt;strstart - (IPos)<span class='macro'>MAX_DIST(s)<span class='macro_popup'>((s)-&gt;w_size-(258 +3 +1))</span></span> : <span class='macro'>NIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">    <span class='comment'>/* Stop when cur_match becomes &lt;= limit. To simplify the code,</span></td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">     <span class='comment'>* we prevent matches with the string of window index 0.</span></td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">    Posf *prev = s-&gt;prev;</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> wmask = s-&gt;w_mask;</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line"><span class='directive'>#ifdef UNALIGNED_OK</span></td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">    <span class='comment'>/* Compare two bytes at a time. Note: this is not always beneficial.</span></td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">     <span class='comment'>* Try with and without -DUNALIGNED_OK to check.</span></td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *strend = s-&gt;window + s-&gt;strstart + <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> - 1;</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">    <span class='keyword'>register</span> ush scan_start = *(ushf*)scan;</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">    <span class='keyword'>register</span> ush scan_end   = *(ushf*)(scan+best_len-1);</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *strend = s-&gt;window + s-&gt;strstart + <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">    <span class='keyword'>register</span> Byte scan_end1  = scan[best_len-1];</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">    <span class='keyword'>register</span> Byte scan_end   = scan[best_len];</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line">    <span class='comment'>/* The code is optimized for HASH_BITS &gt;= 8 and MAX_MATCH-2 multiple of 16.</span></td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line">     <span class='comment'>* It is easy to get rid of this optimization if necessary.</span></td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">    Assert(s-&gt;hash_bits &gt;= 8 &amp;&amp; MAX_MATCH == 258, <span class='string_literal'>"Code too clever"</span>);</td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line">    <span class='comment'>/* Do not waste too much time if we already have a good match: */</span></td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line">    <span class='keyword'>if</span> (s-&gt;prev_length &gt;= s-&gt;good_match) {</td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">        chain_length &gt;&gt;= 2;</td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">    <span class='comment'>/* Do not look for matches beyond the end of the input. This is necessary</span></td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">     <span class='comment'>* to make deflate deterministic.</span></td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line">    <span class='keyword'>if</span> ((<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)nice_match &gt; s-&gt;lookahead) nice_match = (<span class='keyword'>int</span>)s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">    Assert((ulg)s-&gt;strstart &lt;= s-&gt;window_size-MIN_LOOKAHEAD, <span class='string_literal'>"need lookahead"</span>);</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">        Assert(cur_match &lt; s-&gt;strstart, <span class='string_literal'>"no future"</span>);</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">        match = s-&gt;window + cur_match;</td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">        <span class='comment'>/* Skip to next match if the match length cannot increase</span></td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">         <span class='comment'>* or if the match length is less than 2.  Note that the checks below</span></td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">         <span class='comment'>* for insufficient lookahead only occur occasionally for performance</span></td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">         <span class='comment'>* reasons.  Therefore uninitialized memory will be accessed, and</span></td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">         <span class='comment'>* conditional jumps will be made that depend on those values.</span></td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">         <span class='comment'>* However the length of the match is limited to the lookahead, so</span></td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">         <span class='comment'>* the output of deflate is not affected by the uninitialized values.</span></td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line"><span class='directive'>#if (defined(UNALIGNED_OK) &amp;&amp; <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> == 258)</span></td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">        <span class='comment'>/* This code assumes sizeof(unsigned short) == 2. Do not use</span></td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">         <span class='comment'>* UNALIGNED_OK if your compiler uses a different size.</span></td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">        <span class='keyword'>if</span> (*(ushf*)(match+best_len-1) != scan_end ||</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">            *(ushf*)match != scan_start) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">        <span class='comment'>/* It is not necessary to compare scan[2] and match[2] since they are</span></td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">         <span class='comment'>* always equal when the other bytes match, given that the hash keys</span></td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">         <span class='comment'>* are equal and that HASH_BITS &gt;= 8. Compare 2 bytes at a time at</span></td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">         <span class='comment'>* strstart+3, +5, ... up to strstart+257. We check for insufficient</span></td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">         <span class='comment'>* lookahead only every 4th comparison; the 128th check will be made</span></td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">         <span class='comment'>* at strstart+257. If MAX_MATCH-2 is not a multiple of 8, it is</span></td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">         <span class='comment'>* necessary to put more guard bytes at the end of the window, or</span></td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">         <span class='comment'>* to check more often for insufficient lookahead.</span></td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">        Assert(scan[2] == match[2], <span class='string_literal'>"scan[2]?"</span>);</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">        scan++, match++;</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">        <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">        } <span class='keyword'>while</span> (*(ushf*)(scan+=2) == *(ushf*)(match+=2) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">                 *(ushf*)(scan+=2) == *(ushf*)(match+=2) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">                 *(ushf*)(scan+=2) == *(ushf*)(match+=2) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">                 *(ushf*)(scan+=2) == *(ushf*)(match+=2) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">                 scan &lt; strend);</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">        <span class='comment'>/* The funny "do {}" generates better code on most compilers */</span></td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">        <span class='comment'>/* Here, scan &lt;= window+strstart+257 */</span></td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">        Assert(scan &lt;= s-&gt;window+(<span class='keyword'>unsigned</span>)(s-&gt;window_size-1), <span class='string_literal'>"wild scan"</span>);</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line">        <span class='keyword'>if</span> (*scan == *match) scan++;</td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">        len = (<span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> - 1) - (<span class='keyword'>int</span>)(strend-scan);</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line">        scan = strend - (<span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span>-1);</td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"><span class='directive'>#else /* UNALIGNED_OK */</span></td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line">        <span class='keyword'>if</span> (match[best_len]   != scan_end  ||</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line">            match[best_len-1] != scan_end1 ||</td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line">            *match            != *scan     ||</td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">            *++match          != scan[1])      <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">        <span class='comment'>/* The check at best_len-1 can be removed because it will be made</span></td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">         <span class='comment'>* again later. (This heuristic is not always a win.)</span></td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">         <span class='comment'>* It is not necessary to compare scan[2] and match[2] since they</span></td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">         <span class='comment'>* are always equal when the other bytes match, given that</span></td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">         <span class='comment'>* the hash keys are equal and that HASH_BITS &gt;= 8.</span></td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">        scan += 2, match++;</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">        Assert(*scan == *match, <span class='string_literal'>"match[2]?"</span>);</td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">        <span class='comment'>/* We check for insufficient lookahead only every 8th comparison;</span></td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">         <span class='comment'>* the 256th check will be made at strstart+258.</span></td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">        <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">        } <span class='keyword'>while</span> (*++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">                 *++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">                 *++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">                 *++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">                 scan &lt; strend);</td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">        Assert(scan &lt;= s-&gt;window+(<span class='keyword'>unsigned</span>)(s-&gt;window_size-1), <span class='string_literal'>"wild scan"</span>);</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">        len = <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> - (<span class='keyword'>int</span>)(strend - scan);</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">        scan = strend - <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line"><span class='directive'>#endif /* UNALIGNED_OK */</span></td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">        <span class='keyword'>if</span> (len &gt; best_len) {</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">            s-&gt;match_start = cur_match;</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">            best_len = len;</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">            <span class='keyword'>if</span> (len &gt;= nice_match) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line"><span class='directive'>#ifdef UNALIGNED_OK</span></td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">            scan_end = *(ushf*)(scan+best_len-1);</td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line">            scan_end1  = scan[best_len-1];</td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">            scan_end   = scan[best_len];</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">    } <span class='keyword'>while</span> ((cur_match = prev[cur_match &amp; wmask]) &gt; limit</td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">             &amp;&amp; --chain_length != 0);</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">    <span class='keyword'>if</span> ((<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)best_len &lt;= s-&gt;lookahead) <span class='keyword'>return</span> (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)best_len;</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">    <span class='keyword'>return</span> s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line"><span class='directive'>#endif /* ASMV */</span></td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line"><span class='directive'>#else /* FASTEST */</span></td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line"><span class='comment'>/* ---------------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line"> <span class='comment'>* Optimized version for FASTEST only</span></td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> longest_match(s, cur_match)</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">    IPos cur_match;                             <span class='comment'>/* current match */</span></td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *scan = s-&gt;window + s-&gt;strstart; <span class='comment'>/* current string */</span></td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *match;                       <span class='comment'>/* matched string */</span></td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">    <span class='keyword'>register</span> <span class='keyword'>int</span> len;                           <span class='comment'>/* length of current match */</span></td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">    <span class='keyword'>register</span> <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *strend = s-&gt;window + s-&gt;strstart + <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">    <span class='comment'>/* The code is optimized for HASH_BITS &gt;= 8 and MAX_MATCH-2 multiple of 16.</span></td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">     <span class='comment'>* It is easy to get rid of this optimization if necessary.</span></td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">    Assert(s-&gt;hash_bits &gt;= 8 &amp;&amp; MAX_MATCH == 258, <span class='string_literal'>"Code too clever"</span>);</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">    Assert((ulg)s-&gt;strstart &lt;= s-&gt;window_size-MIN_LOOKAHEAD, <span class='string_literal'>"need lookahead"</span>);</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">    Assert(cur_match &lt; s-&gt;strstart, <span class='string_literal'>"no future"</span>);</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">    match = s-&gt;window + cur_match;</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">    <span class='comment'>/* Return failure if the match length is less than 2:</span></td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line">    <span class='keyword'>if</span> (match[0] != scan[0] || match[1] != scan[1]) <span class='keyword'>return</span> <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">    <span class='comment'>/* The check at best_len-1 can be removed because it will be made</span></td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">     <span class='comment'>* again later. (This heuristic is not always a win.)</span></td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">     <span class='comment'>* It is not necessary to compare scan[2] and match[2] since they</span></td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">     <span class='comment'>* are always equal when the other bytes match, given that</span></td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">     <span class='comment'>* the hash keys are equal and that HASH_BITS &gt;= 8.</span></td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">    scan += 2, match += 2;</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line">    Assert(*scan == *match, <span class='string_literal'>"match[2]?"</span>);</td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">    <span class='comment'>/* We check for insufficient lookahead only every 8th comparison;</span></td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">     <span class='comment'>* the 256th check will be made at strstart+258.</span></td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">    } <span class='keyword'>while</span> (*++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">             *++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">             *++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">             *++scan == *++match &amp;&amp; *++scan == *++match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">             scan &lt; strend);</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">    Assert(scan &lt;= s-&gt;window+(<span class='keyword'>unsigned</span>)(s-&gt;window_size-1), <span class='string_literal'>"wild scan"</span>);</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">    len = <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> - (<span class='keyword'>int</span>)(strend - scan);</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">    <span class='keyword'>if</span> (len &lt; <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) <span class='keyword'>return</span> <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span> - 1;</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">    s-&gt;match_start = cur_match;</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">    <span class='keyword'>return</span> (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)len &lt;= s-&gt;lookahead ? (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)len : s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line"><span class='directive'>#endif /* FASTEST */</span></td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line"><span class='directive'>#ifdef ZLIB_DEBUG</span></td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line"><span class='directive'>#define EQUAL 0</span></td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line"><span class='comment'>/* result of memcmp for equal strings */</span></td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line"> <span class='comment'>* Check that the match at match_start is indeed a match.</span></td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> check_match(s, start, match, length)</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">    IPos start, match;</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">    <span class='keyword'>int</span> length;</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">    <span class='comment'>/* check that the match is indeed a match */</span></td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>zmemcmp<span class='macro_popup'>memcmp</span></span>(s-&gt;window + match,</td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">                s-&gt;window + start, length) != EQUAL) {</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">        fprintf(stderr, <span class='string_literal'>" start %u, match %u, length %d\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">                start, match, length);</td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">        <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">            fprintf(stderr, <span class='string_literal'>"%c%c"</span>, s-&gt;window[match++], s-&gt;window[start++]);</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">        } <span class='keyword'>while</span> (--length != 0);</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">        z_error(<span class='string_literal'>"invalid match"</span>);</td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">    <span class='keyword'>if</span> (z_verbose &gt; 1) {</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">        fprintf(stderr,<span class='string_literal'>"\\[%d,%d]"</span>, start-match, length);</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">        <span class='keyword'>do</span> { putc(s-&gt;window[start++], stderr); } <span class='keyword'>while</span> (--length != 0);</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line"><span class='directive'>#  define check_match(s, start, match, length)</span></td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line"><span class='directive'>#endif /* ZLIB_DEBUG */</span></td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line"> <span class='comment'>* Fill the window when the lookahead becomes insufficient.</span></td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line"> <span class='comment'>* Updates strstart and lookahead.</span></td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line"> <span class='comment'>* IN assertion: lookahead &lt; MIN_LOOKAHEAD</span></td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line"> <span class='comment'>* OUT assertions: strstart &lt;= window_size-MIN_LOOKAHEAD</span></td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line"> <span class='comment'>*    At least one byte has been read, or avail_in == 0; reads are</span></td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line"> <span class='comment'>*    performed for at least two bytes (required for the zip translate_eol</span></td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line"> <span class='comment'>*    option -- not supported here).</span></td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> fill_window_c(deflate_state *s);</td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> fill_window(deflate_state *s)</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line"><span class='directive'>#ifdef DEFLATE_FILL_WINDOW_SSE2</span></td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>x86_cpu_enable_simd<span class='macro_popup'>Cr_z_x86_cpu_enable_simd</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">        <span class='macro'>fill_window_sse<span class='macro_popup'>Cr_z_fill_window_sse</span></span>(s);</td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">        <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">    fill_window_c(s);</td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> <span class='keyword'>void</span> fill_window_c(s)</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">    <span class='keyword'>unsigned</span> n;</td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">    <span class='keyword'>unsigned</span> more;    <span class='comment'>/* Amount of free space at the end of the window. */</span></td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> wsize = s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">    Assert(s-&gt;lookahead &lt; MIN_LOOKAHEAD, <span class='string_literal'>"already enough lookahead"</span>);</td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">        more = (<span class='keyword'>unsigned</span>)(s-&gt;window_size -(ulg)s-&gt;lookahead -(ulg)s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">        <span class='comment'>/* Deal with !@#$% 64K limit: */</span></td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">        <span class='keyword'>if</span> (<span class='keyword'>sizeof</span>(<span class='keyword'>int</span>) &lt;= 2) {</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">            <span class='keyword'>if</span> (more == 0 &amp;&amp; s-&gt;strstart == 0 &amp;&amp; s-&gt;lookahead == 0) {</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">                more = wsize;</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (more == (<span class='keyword'>unsigned</span>)(-1)) {</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">                <span class='comment'>/* Very unlikely, but possible on 16 bit machine if</span></td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">                 <span class='comment'>* strstart == 0 &amp;&amp; lookahead == 1 (input done a byte at time)</span></td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">                 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">                more--;</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">        <span class='comment'>/* If the window is almost full and there is insufficient lookahead,</span></td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">         <span class='comment'>* move the upper half to the lower one to make room in the upper half.</span></td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">        <span class='keyword'>if</span> (s-&gt;strstart &gt;= wsize+<span class='macro'>MAX_DIST(s)<span class='macro_popup'>((s)-&gt;w_size-(258 +3 +1))</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">            <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;window, s-&gt;window+wsize, (<span class='keyword'>unsigned</span>)wsize - more);</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">            s-&gt;match_start -= wsize;</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">            s-&gt;strstart    -= wsize; <span class='comment'>/* we now have strstart &gt;= MAX_DIST */</span></td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">            s-&gt;block_start -= (<span class='keyword'>long</span>) wsize;</td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line">            slide_hash(s);</td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">            more += wsize;</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">        <span class='keyword'>if</span> (s-&gt;strm-&gt;avail_in == 0) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">        <span class='comment'>/* If there was no sliding:</span></td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">         <span class='comment'>*    strstart &lt;= WSIZE+MAX_DIST-1 &amp;&amp; lookahead &lt;= MIN_LOOKAHEAD - 1 &amp;&amp;</span></td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">         <span class='comment'>*    more == window_size - lookahead - strstart</span></td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">         <span class='comment'>* =&gt; more &gt;= window_size - (MIN_LOOKAHEAD-1 + WSIZE + MAX_DIST-1)</span></td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">         <span class='comment'>* =&gt; more &gt;= window_size - 2*WSIZE + 2</span></td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">         <span class='comment'>* In the BIG_MEM or MMAP case (not yet supported),</span></td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">         <span class='comment'>*   window_size == input_size + MIN_LOOKAHEAD  &amp;&amp;</span></td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">         <span class='comment'>*   strstart + s-&gt;lookahead &lt;= input_size =&gt; more &gt;= MIN_LOOKAHEAD.</span></td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">         <span class='comment'>* Otherwise, window_size == 2*WSIZE so more &gt;= 2.</span></td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line">         <span class='comment'>* If there was sliding, more &gt;= WSIZE. So in all cases, more &gt;= 2.</span></td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">        Assert(more &gt;= 2, <span class='string_literal'>"more &lt; 2"</span>);</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">        n = <span class='macro'>deflate_read_buf<span class='macro_popup'>Cr_z_deflate_read_buf</span></span>(s-&gt;strm, s-&gt;window + s-&gt;strstart + s-&gt;lookahead, more);</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">        s-&gt;lookahead += n;</td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">        <span class='comment'>/* Initialize the hash value now that we have some input: */</span></td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead + s-&gt;insert &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">            <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> str = s-&gt;strstart - s-&gt;insert;</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line">            s-&gt;ins_h = s-&gt;window[str];</td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">            <span class='macro'>UPDATE_HASH(s, s-&gt;ins_h, s-&gt;window[str + 1])<span class='macro_popup'>(s-&gt;ins_h = (((s-&gt;ins_h) &lt;&lt; s-&gt;hash_shift) ^ (<br>s-&gt;window[str + 1])) &amp; s-&gt;hash_mask)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line"><span class='directive'>#if <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span> != 3</span></td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">            Call UPDATE_HASH() <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-3 more times</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line">            <span class='keyword'>while</span> (s-&gt;insert) {</td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">                <span class='macro'>UPDATE_HASH(s, s-&gt;ins_h, s-&gt;window[str + MIN_MATCH-1])<span class='macro_popup'>(s-&gt;ins_h = (((s-&gt;ins_h) &lt;&lt; s-&gt;hash_shift) ^ (<br>s-&gt;window[str + 3 -1])) &amp; s-&gt;hash_mask)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">                s-&gt;prev[str &amp; s-&gt;w_mask] = s-&gt;head[s-&gt;ins_h];</td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">                s-&gt;head[s-&gt;ins_h] = (Pos)str;</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">                str++;</td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">                s-&gt;insert--;</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">                <span class='keyword'>if</span> (s-&gt;lookahead + s-&gt;insert &lt; <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line">        <span class='comment'>/* If the whole input has less than MIN_MATCH bytes, ins_h is garbage,</span></td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">         <span class='comment'>* but this is not important since only literal bytes will be emitted.</span></td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">    } <span class='keyword'>while</span> (s-&gt;lookahead &lt; <span class='macro'>MIN_LOOKAHEAD<span class='macro_popup'>(258 +3 +1)</span></span> &amp;&amp; s-&gt;strm-&gt;avail_in != 0);</td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line">    <span class='comment'>/* If the WIN_INIT bytes after the end of the current data have never been</span></td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">     <span class='comment'>* written, then zero those bytes in order to avoid memory check reports of</span></td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">     <span class='comment'>* the use of uninitialized (or uninitialised as Julian writes) bytes by</span></td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">     <span class='comment'>* the longest match routines.  Update the high water mark for the next</span></td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">     <span class='comment'>* time through here.  WIN_INIT is set to MAX_MATCH since the longest match</span></td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">     <span class='comment'>* routines allow scanning to strstart + MAX_MATCH, ignoring lookahead.</span></td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">    <span class='keyword'>if</span> (s-&gt;high_water &lt; s-&gt;window_size) {</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line">        ulg curr = s-&gt;strstart + (ulg)(s-&gt;lookahead);</td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">        ulg init;</td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">        <span class='keyword'>if</span> (s-&gt;high_water &lt; curr) {</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">            <span class='comment'>/* Previous high water mark below current data -- zero WIN_INIT</span></td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">             <span class='comment'>* bytes or up to end of window, whichever is less.</span></td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">            init = s-&gt;window_size - curr;</td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">            <span class='keyword'>if</span> (init &gt; <span class='macro'>WIN_INIT<span class='macro_popup'>258</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">                init = <span class='macro'>WIN_INIT<span class='macro_popup'>258</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">            <span class='macro'>zmemzero(s-&gt;window + curr, (<span class='keyword'>unsigned</span>)init)<span class='macro_popup'>memset(s-&gt;window + curr, 0, (unsigned)init)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">            s-&gt;high_water = curr + init;</td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span> (s-&gt;high_water &lt; (ulg)curr + <span class='macro'>WIN_INIT<span class='macro_popup'>258</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">            <span class='comment'>/* High water mark at or above current data, but below current data</span></td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">             <span class='comment'>* plus WIN_INIT -- zero out to current data plus WIN_INIT, or up</span></td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">             <span class='comment'>* to end of window, whichever is less.</span></td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">            init = (ulg)curr + <span class='macro'>WIN_INIT<span class='macro_popup'>258</span></span> - s-&gt;high_water;</td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">            <span class='keyword'>if</span> (init &gt; s-&gt;window_size - s-&gt;high_water)</td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">                init = s-&gt;window_size - s-&gt;high_water;</td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">            <span class='macro'>zmemzero(s-&gt;window + s-&gt;high_water, (<span class='keyword'>unsigned</span>)init)<span class='macro_popup'>memset(s-&gt;window + s-&gt;high_water, 0, (unsigned)init)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">            s-&gt;high_water += init;</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">    Assert((ulg)s-&gt;strstart &lt;= s-&gt;window_size - MIN_LOOKAHEAD,</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">           <span class='string_literal'>"not enough room for search"</span>);</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line"> <span class='comment'>* Flush the current block, with given end-of-file flag.</span></td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line"> <span class='comment'>* IN assertion: strstart is set to the end of the current match.</span></td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line"><span class='directive'>#define <span class='macro'>FLUSH_BLOCK_ONLY(s, last)<span class='macro_popup'>{ Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (last<br>)); s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }</span></span> { \</span></td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">   <span class='directive'><span class='macro'>_tr_flush_block<span class='macro_popup'>Cr_z__tr_flush_block</span></span>(s, (s-&gt;block_start &gt;= 0L ? \</span></td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">                   <span class='directive'>(<span class='macro'>charf<span class='macro_popup'>Cr_z_charf</span></span> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : \</span></td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">                   <span class='directive'>(<span class='macro'>charf<span class='macro_popup'>Cr_z_charf</span></span> *)<span class='macro'>Z_NULL<span class='macro_popup'>0</span></span>), \</span></td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">                <span class='directive'>(ulg)((long)s-&gt;strstart - s-&gt;block_start), \</span></td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">                <span class='directive'>(last)); \</span></td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">   <span class='directive'>s-&gt;block_start = s-&gt;strstart; \</span></td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line">   <span class='directive'>flush_pending(s-&gt;strm); \</span></td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">   <span class='directive'>Tracev((stderr,"[FLUSH]")); \</span></td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line"><span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line"><span class='comment'>/* Same but force premature exit if necessary. */</span></td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line"><span class='directive'>#define <span class='macro'>FLUSH_BLOCK(s, last)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (last<br>)); s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (last) ? finish_started<br> : need_more; }</span></span> { \</span></td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line">   <span class='directive'><span class='macro'>FLUSH_BLOCK_ONLY(s, last)<span class='macro_popup'>{ Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (last<br>)); s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }</span></span>; \</span></td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line">   <span class='directive'>if (s-&gt;strm-&gt;avail_out == 0) return (last) ? finish_started : need_more; \</span></td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line"><span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line"><span class='comment'>/* Maximum stored block length in deflate format (not including header). */</span></td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line"><span class='directive'>#define <span class='macro'>MAX_STORED<span class='macro_popup'>65535</span></span> 65535</span></td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line"><span class='comment'>/* Minimum of a and b. */</span></td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line"><span class='directive'>#define <span class='macro'>MIN(a, b)<span class='macro_popup'>((a) &gt; (b) ? (b) : (a))</span></span> ((a) &gt; (b) ? (b) : (a))</span></td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line"> <span class='comment'>* Copy without compression as much as possible from the input stream, return</span></td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line"> <span class='comment'>* the current block state.</span></td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line"> <span class='comment'>* In case deflateParams() is used to later switch to a non-zero compression</span></td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line"> <span class='comment'>* level, s-&gt;matches (otherwise unused when storing) keeps track of the number</span></td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line"> <span class='comment'>* of hash table slides to perform. If s-&gt;matches is 1, then one hash table</span></td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line"> <span class='comment'>* slide will be done when switching. If s-&gt;matches is 2, the maximum value</span></td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line"> <span class='comment'>* allowed here, then the hash table will be cleared, since two or more slides</span></td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line"> <span class='comment'>* is the same as a clear.</span></td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line"> <span class='comment'>* deflate_stored() is written to minimize the number of times an input byte is</span></td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line"> <span class='comment'>* copied. It is most efficient with large input and output buffers, which</span></td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line"> <span class='comment'>* maximizes the opportunites to have a single copy from next_in to next_out.</span></td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_stored(s, flush)</td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">    <span class='keyword'>int</span> flush;</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">    <span class='comment'>/* Smallest worthy block size when not flushing or finishing. By default</span></td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">     <span class='comment'>* this is 32K. This can be as small as 507 bytes for memLevel == 1. For</span></td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">     <span class='comment'>* large input and output buffers, the stored block size will be larger.</span></td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">    <span class='keyword'>unsigned</span> min_block = <span class='macro'>MIN(s-&gt;pending_buf_size - 5, s-&gt;w_size)<span class='macro_popup'>((s-&gt;pending_buf_size - 5) &gt; (s-&gt;w_size) ? (s-&gt;w_size<br>) : (s-&gt;pending_buf_size - 5))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line">    <span class='comment'>/* Copy as many min_block or larger stored blocks directly to next_out as</span></td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">     <span class='comment'>* possible. If flushing, copy the remaining available input to next_out as</span></td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">     <span class='comment'>* stored blocks, if there is enough space.</span></td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">    <span class='keyword'>unsigned</span> len, left, have, last = 0;</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">    <span class='keyword'>unsigned</span> used = s-&gt;strm-&gt;avail_in;</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">        <span class='comment'>/* Set len to the maximum size block that we can copy directly with the</span></td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">         <span class='comment'>* available input data and output space. Set left to how much of that</span></td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line">         <span class='comment'>* would be copied from what's left in the window.</span></td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">        len = <span class='macro'>MAX_STORED<span class='macro_popup'>65535</span></span>;       <span class='comment'>/* maximum deflate stored block length */</span></td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">        have = (s-&gt;bi_valid + 42) &gt;&gt; 3;         <span class='comment'>/* number of header bytes */</span></td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line">        <span class='keyword'>if</span> (s-&gt;strm-&gt;avail_out &lt; have)          <span class='comment'>/* need room for header */</span></td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">            <span class='comment'>/* maximum stored block length that will fit in avail_out: */</span></td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">        have = s-&gt;strm-&gt;avail_out - have;</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">        left = s-&gt;strstart - s-&gt;block_start;    <span class='comment'>/* bytes left in window */</span></td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">        <span class='keyword'>if</span> (len &gt; (ulg)left + s-&gt;strm-&gt;avail_in)</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">            len = left + s-&gt;strm-&gt;avail_in;     <span class='comment'>/* limit len to the input */</span></td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">        <span class='keyword'>if</span> (len &gt; have)</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">            len = have;                         <span class='comment'>/* limit len to the output */</span></td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">        <span class='comment'>/* If the stored block would be less than min_block in length, or if</span></td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">         <span class='comment'>* unable to copy all of the available input when flushing, then try</span></td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">         <span class='comment'>* copying to the window and the pending buffer instead. Also don't</span></td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line">         <span class='comment'>* write an empty block when flushing -- deflate() does that.</span></td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">        <span class='keyword'>if</span> (len &lt; min_block &amp;&amp; ((len == 0 &amp;&amp; flush != <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) ||</td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line">                                flush == <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line">                                len != left + s-&gt;strm-&gt;avail_in))</td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">        <span class='comment'>/* Make a dummy stored block in pending to get the header bytes,</span></td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">         <span class='comment'>* including any pending bits. This also updates the debugging counts.</span></td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line">        last = flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span> &amp;&amp; len == left + s-&gt;strm-&gt;avail_in ? 1 : 0;</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">        <span class='macro'>_tr_stored_block<span class='macro_popup'>Cr_z__tr_stored_block</span></span>(s, (<span class='keyword'>char</span> *)0, 0L, last);</td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">        <span class='comment'>/* Replace the lengths in the dummy stored block with len. */</span></td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">        s-&gt;pending_buf[s-&gt;pending - 4] = len;</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">        s-&gt;pending_buf[s-&gt;pending - 3] = len &gt;&gt; 8;</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">        s-&gt;pending_buf[s-&gt;pending - 2] = ~len;</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line">        s-&gt;pending_buf[s-&gt;pending - 1] = ~len &gt;&gt; 8;</td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">        <span class='comment'>/* Write the stored block header bytes. */</span></td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">        flush_pending(s-&gt;strm);</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line"><span class='directive'>#ifdef ZLIB_DEBUG</span></td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">        <span class='comment'>/* Update debugging counts for the data about to be copied. */</span></td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">        s-&gt;compressed_len += len &lt;&lt; 3;</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">        s-&gt;bits_sent += len &lt;&lt; 3;</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">        <span class='comment'>/* Copy uncompressed bytes from the window to next_out. */</span></td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">        <span class='keyword'>if</span> (left) {</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line">            <span class='keyword'>if</span> (left &gt; len)</td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">                left = len;</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">            <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;strm-&gt;next_out, s-&gt;window + s-&gt;block_start, left);</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line">            s-&gt;strm-&gt;next_out += left;</td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line">            s-&gt;strm-&gt;avail_out -= left;</td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line">            s-&gt;strm-&gt;total_out += left;</td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line">            s-&gt;block_start += left;</td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">            len -= left;</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">        <span class='comment'>/* Copy uncompressed bytes directly from next_in to next_out, updating</span></td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">         <span class='comment'>* the check value.</span></td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">        <span class='keyword'>if</span> (len) {</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">            <span class='macro'>deflate_read_buf<span class='macro_popup'>Cr_z_deflate_read_buf</span></span>(s-&gt;strm, s-&gt;strm-&gt;next_out, len);</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">            s-&gt;strm-&gt;next_out += len;</td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">            s-&gt;strm-&gt;avail_out -= len;</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line">            s-&gt;strm-&gt;total_out += len;</td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">    } <span class='keyword'>while</span> (last == 0);</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">    <span class='comment'>/* Update the sliding window with the last s-&gt;w_size bytes of the copied</span></td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">     <span class='comment'>* data, or append all of the copied data to the existing window if less</span></td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">     <span class='comment'>* than s-&gt;w_size bytes were copied. Also update the number of bytes to</span></td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">     <span class='comment'>* insert in the hash tables, in the event that deflateParams() switches to</span></td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">     <span class='comment'>* a non-zero compression level.</span></td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">    used -= s-&gt;strm-&gt;avail_in;      <span class='comment'>/* number of input bytes directly copied */</span></td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">    <span class='keyword'>if</span> (used) {</td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">        <span class='comment'>/* If any input was used, then no unused input remains in the window,</span></td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">         <span class='comment'>* therefore s-&gt;block_start == s-&gt;strstart.</span></td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">        <span class='keyword'>if</span> (used &gt;= s-&gt;w_size) {    <span class='comment'>/* supplant the previous history */</span></td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line">            s-&gt;matches = 2;         <span class='comment'>/* clear hash */</span></td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">            <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;window, s-&gt;strm-&gt;next_in - s-&gt;w_size, s-&gt;w_size);</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">            s-&gt;strstart = s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">        <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">            <span class='keyword'>if</span> (s-&gt;window_size - s-&gt;strstart &lt;= used) {</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">                <span class='comment'>/* Slide the window down. */</span></td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">                s-&gt;strstart -= s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">                <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;window, s-&gt;window + s-&gt;w_size, s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">                <span class='keyword'>if</span> (s-&gt;matches &lt; 2)</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">                    s-&gt;matches++;   <span class='comment'>/* add a pending slide_hash() */</span></td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">            <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;window + s-&gt;strstart, s-&gt;strm-&gt;next_in - used, used);</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">            s-&gt;strstart += used;</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">        s-&gt;block_start = s-&gt;strstart;</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line">        s-&gt;insert += <span class='macro'>MIN(used, s-&gt;w_size - s-&gt;insert)<span class='macro_popup'>((used) &gt; (s-&gt;w_size - s-&gt;insert) ? (s-&gt;w_size - s<br>-&gt;insert) : (used))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">    <span class='keyword'>if</span> (s-&gt;high_water &lt; s-&gt;strstart)</td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line">        s-&gt;high_water = s-&gt;strstart;</td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">    <span class='comment'>/* If the last block was written to next_out, then done. */</span></td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">    <span class='keyword'>if</span> (last)</td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">        <span class='keyword'>return</span> finish_done;</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">    <span class='comment'>/* If flushing and all input has been consumed, then done. */</span></td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line">    <span class='keyword'>if</span> (flush != <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span> &amp;&amp; flush != <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line">        s-&gt;strm-&gt;avail_in == 0 &amp;&amp; (<span class='keyword'>long</span>)s-&gt;strstart == s-&gt;block_start)</td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">        <span class='keyword'>return</span> block_done;</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">    <span class='comment'>/* Fill the window with any remaining input. */</span></td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">    have = s-&gt;window_size - s-&gt;strstart - 1;</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">    <span class='keyword'>if</span> (s-&gt;strm-&gt;avail_in &gt; have &amp;&amp; s-&gt;block_start &gt;= (<span class='keyword'>long</span>)s-&gt;w_size) {</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">        <span class='comment'>/* Slide the window down. */</span></td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">        s-&gt;block_start -= s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">        s-&gt;strstart -= s-&gt;w_size;</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">        <span class='macro'>zmemcpy<span class='macro_popup'>memcpy</span></span>(s-&gt;window, s-&gt;window + s-&gt;w_size, s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">        <span class='keyword'>if</span> (s-&gt;matches &lt; 2)</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">            s-&gt;matches++;           <span class='comment'>/* add a pending slide_hash() */</span></td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">        have += s-&gt;w_size;          <span class='comment'>/* more space now */</span></td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">    <span class='keyword'>if</span> (have &gt; s-&gt;strm-&gt;avail_in)</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">        have = s-&gt;strm-&gt;avail_in;</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">    <span class='keyword'>if</span> (have) {</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">        <span class='macro'>deflate_read_buf<span class='macro_popup'>Cr_z_deflate_read_buf</span></span>(s-&gt;strm, s-&gt;window + s-&gt;strstart, have);</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">        s-&gt;strstart += have;</td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line">    <span class='keyword'>if</span> (s-&gt;high_water &lt; s-&gt;strstart)</td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line">        s-&gt;high_water = s-&gt;strstart;</td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line">    <span class='comment'>/* There was not enough avail_out to write a complete worthy or flushed</span></td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line">     <span class='comment'>* stored block to next_out. Write a stored block to pending instead, if we</span></td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">     <span class='comment'>* have enough input for a worthy block, or if flushing and there is enough</span></td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">     <span class='comment'>* room for the remaining input as a stored block in the pending buffer.</span></td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">    have = (s-&gt;bi_valid + 42) &gt;&gt; 3;         <span class='comment'>/* number of header bytes */</span></td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line">        <span class='comment'>/* maximum stored block length that will fit in pending: */</span></td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line">    have = <span class='macro'>MIN(s-&gt;pending_buf_size - have, MAX_STORED)<span class='macro_popup'>((s-&gt;pending_buf_size - have) &gt; (65535) ? (65535) : (s-&gt;<br>pending_buf_size - have))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line">    min_block = <span class='macro'>MIN(have, s-&gt;w_size)<span class='macro_popup'>((have) &gt; (s-&gt;w_size) ? (s-&gt;w_size) : (have))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line">    left = s-&gt;strstart - s-&gt;block_start;</td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line">    <span class='keyword'>if</span> (left &gt;= min_block ||</td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">        ((left || flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) &amp;&amp; flush != <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">         s-&gt;strm-&gt;avail_in == 0 &amp;&amp; left &lt;= have)) {</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">        len = <span class='macro'>MIN(left, have)<span class='macro_popup'>((left) &gt; (have) ? (have) : (left))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">        last = flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span> &amp;&amp; s-&gt;strm-&gt;avail_in == 0 &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">               len == left ? 1 : 0;</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line">        <span class='macro'>_tr_stored_block<span class='macro_popup'>Cr_z__tr_stored_block</span></span>(s, (<span class='macro'>charf<span class='macro_popup'>Cr_z_charf</span></span> *)s-&gt;window + s-&gt;block_start, len, last);</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">        s-&gt;block_start += len;</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line">        flush_pending(s-&gt;strm);</td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line">    <span class='comment'>/* We've done all we can with the available input and output. */</span></td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">    <span class='keyword'>return</span> last ? finish_started : need_more;</td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line"> <span class='comment'>* Compress as much as possible from the input stream, return the current</span></td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line"> <span class='comment'>* block state.</span></td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line"> <span class='comment'>* This function does not perform lazy evaluation of matches and inserts</span></td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line"> <span class='comment'>* new strings in the dictionary only for unmatched strings or for short</span></td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line"> <span class='comment'>* matches. It is used only for the fast compression options.</span></td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_fast(s, flush)</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">    <span class='keyword'>int</span> flush;</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line">    IPos hash_head;       <span class='comment'>/* head of the hash chain */</span></td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">    <span class='keyword'>int</span> bflush;           <span class='comment'>/* set if current block must be flushed */</span></td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">    <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line">        <span class='comment'>/* Make sure that we always have enough lookahead, except</span></td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">         <span class='comment'>* at the end of the input file. We need MAX_MATCH bytes</span></td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line">         <span class='comment'>* for the next match, plus MIN_MATCH bytes to insert the</span></td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">         <span class='comment'>* string following the next match.</span></td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead &lt; <span class='macro'>MIN_LOOKAHEAD<span class='macro_popup'>(258 +3 +1)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line">            fill_window(s);</td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead &lt; <span class='macro'>MIN_LOOKAHEAD<span class='macro_popup'>(258 +3 +1)</span></span> &amp;&amp; flush == <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line">                <span class='keyword'>return</span> need_more;</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead == 0) <span class='keyword'>break</span>; <span class='comment'>/* flush the current block */</span></td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line">        <span class='comment'>/* Insert the string window[strstart .. strstart+2] in the</span></td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">         <span class='comment'>* dictionary, and set hash_head to the head of the hash chain:</span></td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line">        hash_head = <span class='macro'>NIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line">            hash_head = insert_string(s, s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line">        <span class='comment'>/* Find the longest match, discarding those &lt;= prev_length.</span></td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line">         <span class='comment'>* At this point we have always match_length &lt; MIN_MATCH</span></td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line">        <span class='keyword'>if</span> (hash_head != <span class='macro'>NIL<span class='macro_popup'>0</span></span> &amp;&amp; s-&gt;strstart - hash_head &lt;= <span class='macro'>MAX_DIST(s)<span class='macro_popup'>((s)-&gt;w_size-(258 +3 +1))</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">            <span class='comment'>/* To simplify the code, we prevent matches with the string</span></td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">             <span class='comment'>* of window index 0 (in particular we have to avoid a match</span></td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">             <span class='comment'>* of the string with itself at the start of the input file).</span></td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">            s-&gt;match_length = longest_match (s, hash_head);</td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">            <span class='comment'>/* longest_match() sets match_start */</span></td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">        <span class='keyword'>if</span> (s-&gt;match_length &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">            check_match(s, s-&gt;strstart, s-&gt;match_start, s-&gt;match_length);</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">            <span class='macro'>_tr_tally_dist(s, s-&gt;strstart - s-&gt;match_start,<span class='macro_popup'>{ uch len = (uch)(s-&gt;match_length - 3); ush dist = (ush)(s<br>-&gt;strstart - s-&gt;match_start); s-&gt;sym_buf[s-&gt;sym_next<br>++] = dist; s-&gt;sym_buf[s-&gt;sym_next++] = dist &gt;&gt; 8<br>; s-&gt;sym_buf[s-&gt;sym_next++] = len; dist--; s-&gt;dyn_ltree<br>[Cr_z__length_code[len]+256 +1].fc.freq++; s-&gt;dyn_dtree[((<br>dist) &lt; 256 ? Cr_z__dist_code[dist] : Cr_z__dist_code[256+<br>((dist)&gt;&gt;7)])].fc.freq++; bflush = (s-&gt;sym_next == s<br>-&gt;sym_end); }</span></span></td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">                           <span class='macro'>s-&gt;match_length - MIN_MATCH, bflush)<span class='macro_popup'>{ uch len = (uch)(s-&gt;match_length - 3); ush dist = (ush)(s<br>-&gt;strstart - s-&gt;match_start); s-&gt;sym_buf[s-&gt;sym_next<br>++] = dist; s-&gt;sym_buf[s-&gt;sym_next++] = dist &gt;&gt; 8<br>; s-&gt;sym_buf[s-&gt;sym_next++] = len; dist--; s-&gt;dyn_ltree<br>[Cr_z__length_code[len]+256 +1].fc.freq++; s-&gt;dyn_dtree[((<br>dist) &lt; 256 ? Cr_z__dist_code[dist] : Cr_z__dist_code[256+<br>((dist)&gt;&gt;7)])].fc.freq++; bflush = (s-&gt;sym_next == s<br>-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">            s-&gt;lookahead -= s-&gt;match_length;</td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line">            <span class='comment'>/* Insert new strings in the hash table only if the match length</span></td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line">             <span class='comment'>* is not too large. This saves time but degrades compression.</span></td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line">            <span class='keyword'>if</span> (s-&gt;match_length &lt;= s-&gt;<span class='macro'>max_insert_length<span class='macro_popup'>max_lazy_match</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">                s-&gt;lookahead &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">                s-&gt;match_length--; <span class='comment'>/* string at strstart already in table */</span></td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">                <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">                    s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line">                    hash_head = insert_string(s, s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line">                    <span class='comment'>/* strstart never exceeds WSIZE-MAX_MATCH, so there are</span></td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">                     <span class='comment'>* always MIN_MATCH bytes ahead.</span></td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line">                     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line">                } <span class='keyword'>while</span> (--s-&gt;match_length != 0);</td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line">                s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line">            } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">                s-&gt;strstart += s-&gt;match_length;</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line">                s-&gt;match_length = 0;</td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">                s-&gt;ins_h = s-&gt;window[s-&gt;strstart];</td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">                <span class='macro'>UPDATE_HASH(s, s-&gt;ins_h, s-&gt;window[s-&gt;strstart+1])<span class='macro_popup'>(s-&gt;ins_h = (((s-&gt;ins_h) &lt;&lt; s-&gt;hash_shift) ^ (<br>s-&gt;window[s-&gt;strstart+1])) &amp; s-&gt;hash_mask)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line"><span class='directive'>#if <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span> != 3</span></td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line">                Call UPDATE_HASH() <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-3 more times</td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">                <span class='comment'>/* If lookahead &lt; MIN_MATCH, ins_h is garbage, but it does not</span></td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line">                 <span class='comment'>* matter since it will be recomputed at next deflate call.</span></td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line">                 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line">            <span class='comment'>/* No match, output a literal byte */</span></td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line">            Tracevv((stderr,<span class='string_literal'>"%c"</span>, s-&gt;window[s-&gt;strstart]));</td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">            <span class='macro'>_tr_tally_lit (s, s-&gt;window[s-&gt;strstart], bflush)<span class='macro_popup'>{ uch cc = (s-&gt;window[s-&gt;strstart]); s-&gt;sym_buf[s-&gt;<br>sym_next++] = 0; s-&gt;sym_buf[s-&gt;sym_next++] = 0; s-&gt;sym_buf<br>[s-&gt;sym_next++] = cc; s-&gt;dyn_ltree[cc].fc.freq++; bflush<br> = (s-&gt;sym_next == s-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">            s-&gt;lookahead--;</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line">            s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line">        <span class='keyword'>if</span> (bflush) <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line">    s-&gt;insert = s-&gt;strstart &lt; <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1 ? s-&gt;strstart : <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line">    <span class='keyword'>if</span> (flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 1)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (1));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (1) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">        <span class='keyword'>return</span> finish_done;</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">    <span class='keyword'>if</span> (s-&gt;sym_next)</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">    <span class='keyword'>return</span> block_done;</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line"><span class='directive'>#ifndef FASTEST</span></td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line"> <span class='comment'>* Same as above, but achieves better compression. We use a lazy</span></td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line"> <span class='comment'>* evaluation for matches: a match is finally adopted only if there is</span></td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line"> <span class='comment'>* no better match at the next window position.</span></td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_slow(s, flush)</td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line">    <span class='keyword'>int</span> flush;</td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line">    IPos hash_head;          <span class='comment'>/* head of hash chain */</span></td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">    <span class='keyword'>int</span> bflush;              <span class='comment'>/* set if current block must be flushed */</span></td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">    <span class='comment'>/* Process the input block. */</span></td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">    <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line">        <span class='comment'>/* Make sure that we always have enough lookahead, except</span></td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">         <span class='comment'>* at the end of the input file. We need MAX_MATCH bytes</span></td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">         <span class='comment'>* for the next match, plus MIN_MATCH bytes to insert the</span></td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line">         <span class='comment'>* string following the next match.</span></td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead &lt; <span class='macro'>MIN_LOOKAHEAD<span class='macro_popup'>(258 +3 +1)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line">            fill_window(s);</td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead &lt; <span class='macro'>MIN_LOOKAHEAD<span class='macro_popup'>(258 +3 +1)</span></span> &amp;&amp; flush == <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">                <span class='keyword'>return</span> need_more;</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead == 0) <span class='keyword'>break</span>; <span class='comment'>/* flush the current block */</span></td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line">        <span class='comment'>/* Insert the string window[strstart .. strstart+2] in the</span></td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">         <span class='comment'>* dictionary, and set hash_head to the head of the hash chain:</span></td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">        hash_head = <span class='macro'>NIL<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">            hash_head = insert_string(s, s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line">        <span class='comment'>/* Find the longest match, discarding those &lt;= prev_length.</span></td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">        s-&gt;prev_length = s-&gt;match_length, s-&gt;prev_match = s-&gt;match_start;</td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">        s-&gt;match_length = <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">        <span class='keyword'>if</span> (hash_head != <span class='macro'>NIL<span class='macro_popup'>0</span></span> &amp;&amp; s-&gt;prev_length &lt; s-&gt;max_lazy_match &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line">            s-&gt;strstart - hash_head &lt;= <span class='macro'>MAX_DIST(s)<span class='macro_popup'>((s)-&gt;w_size-(258 +3 +1))</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">            <span class='comment'>/* To simplify the code, we prevent matches with the string</span></td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">             <span class='comment'>* of window index 0 (in particular we have to avoid a match</span></td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line">             <span class='comment'>* of the string with itself at the start of the input file).</span></td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line">            s-&gt;match_length = longest_match (s, hash_head);</td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line">            <span class='comment'>/* longest_match() sets match_start */</span></td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">            <span class='keyword'>if</span> (s-&gt;match_length &lt;= 5 &amp;&amp; (s-&gt;strategy == <span class='macro'>Z_FILTERED<span class='macro_popup'>1</span></span></td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line"><span class='directive'>#if <span class='macro'>TOO_FAR<span class='macro_popup'>4096</span></span> &lt;= 32767</span></td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">                || (s-&gt;match_length == <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span> &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">                    s-&gt;strstart - s-&gt;match_start &gt; <span class='macro'>TOO_FAR<span class='macro_popup'>4096</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">                )) {</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line">                <span class='comment'>/* If prev_match is also MIN_MATCH, match_start is garbage</span></td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line">                 <span class='comment'>* but we will ignore the current match anyway.</span></td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line">                 <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line">                s-&gt;match_length = <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">        <span class='comment'>/* If there was a match at the previous step and the current</span></td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line">         <span class='comment'>* match is not better, output the previous match:</span></td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line">        <span class='keyword'>if</span> (s-&gt;prev_length &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span> &amp;&amp; s-&gt;match_length &lt;= s-&gt;prev_length) {</td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line">            <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> max_insert = s-&gt;strstart + s-&gt;lookahead - <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line">            <span class='comment'>/* Do not insert strings in hash table beyond this. */</span></td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line">            check_match(s, s-&gt;strstart-1, s-&gt;prev_match, s-&gt;prev_length);</td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line">            <span class='macro'>_tr_tally_dist(s, s-&gt;strstart -1 - s-&gt;prev_match,<span class='macro_popup'>{ uch len = (uch)(s-&gt;prev_length - 3); ush dist = (ush)(s-&gt;<br>strstart -1 - s-&gt;prev_match); s-&gt;sym_buf[s-&gt;sym_next<br>++] = dist; s-&gt;sym_buf[s-&gt;sym_next++] = dist &gt;&gt; 8<br>; s-&gt;sym_buf[s-&gt;sym_next++] = len; dist--; s-&gt;dyn_ltree<br>[Cr_z__length_code[len]+256 +1].fc.freq++; s-&gt;dyn_dtree[((<br>dist) &lt; 256 ? Cr_z__dist_code[dist] : Cr_z__dist_code[256+<br>((dist)&gt;&gt;7)])].fc.freq++; bflush = (s-&gt;sym_next == s<br>-&gt;sym_end); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line">                           <span class='macro'>s-&gt;prev_length - MIN_MATCH, bflush)<span class='macro_popup'>{ uch len = (uch)(s-&gt;prev_length - 3); ush dist = (ush)(s-&gt;<br>strstart -1 - s-&gt;prev_match); s-&gt;sym_buf[s-&gt;sym_next<br>++] = dist; s-&gt;sym_buf[s-&gt;sym_next++] = dist &gt;&gt; 8<br>; s-&gt;sym_buf[s-&gt;sym_next++] = len; dist--; s-&gt;dyn_ltree<br>[Cr_z__length_code[len]+256 +1].fc.freq++; s-&gt;dyn_dtree[((<br>dist) &lt; 256 ? Cr_z__dist_code[dist] : Cr_z__dist_code[256+<br>((dist)&gt;&gt;7)])].fc.freq++; bflush = (s-&gt;sym_next == s<br>-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">            <span class='comment'>/* Insert in hash table all strings up to the end of the match.</span></td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line">             <span class='comment'>* strstart-1 and strstart are already inserted. If there is not</span></td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">             <span class='comment'>* enough lookahead, the last two strings are not inserted in</span></td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">             <span class='comment'>* the hash table.</span></td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line">            s-&gt;lookahead -= s-&gt;prev_length-1;</td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line">            s-&gt;prev_length -= 2;</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line">            <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line">                <span class='keyword'>if</span> (++s-&gt;strstart &lt;= max_insert) {</td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line">                    hash_head = insert_string(s, s-&gt;strstart);</td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">            } <span class='keyword'>while</span> (--s-&gt;prev_length != 0);</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line">            s-&gt;match_available = 0;</td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">            s-&gt;match_length = <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line">            s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line">            <span class='keyword'>if</span> (bflush) <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (s-&gt;match_available) {</td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line">            <span class='comment'>/* If there was no match at the previous position, output a</span></td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line">             <span class='comment'>* single literal. If there was a match but the current match</span></td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line">             <span class='comment'>* is longer, truncate the previous match to a single literal.</span></td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line">            Tracevv((stderr,<span class='string_literal'>"%c"</span>, s-&gt;window[s-&gt;strstart-1]));</td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line">            <span class='macro'>_tr_tally_lit(s, s-&gt;window[s-&gt;strstart-1], bflush)<span class='macro_popup'>{ uch cc = (s-&gt;window[s-&gt;strstart-1]); s-&gt;sym_buf[s-&gt;<br>sym_next++] = 0; s-&gt;sym_buf[s-&gt;sym_next++] = 0; s-&gt;sym_buf<br>[s-&gt;sym_next++] = cc; s-&gt;dyn_ltree[cc].fc.freq++; bflush<br> = (s-&gt;sym_next == s-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line">            <span class='keyword'>if</span> (bflush) {</td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">                <span class='macro'>FLUSH_BLOCK_ONLY(s, 0)<span class='macro_popup'>{ Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line">            s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">            s-&gt;lookahead--;</td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line">            <span class='keyword'>if</span> (s-&gt;strm-&gt;avail_out == 0) <span class='keyword'>return</span> need_more;</td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line">            <span class='comment'>/* There is no previous match to compare with, wait for</span></td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">             <span class='comment'>* the next step to decide.</span></td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line">             <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line">            s-&gt;match_available = 1;</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">            s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line">            s-&gt;lookahead--;</td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line">    Assert (flush != Z_NO_FLUSH, <span class='string_literal'>"no flush?"</span>);</td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">    <span class='keyword'>if</span> (s-&gt;match_available) {</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line">        Tracevv((stderr,<span class='string_literal'>"%c"</span>, s-&gt;window[s-&gt;strstart-1]));</td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line">        <span class='macro'>_tr_tally_lit(s, s-&gt;window[s-&gt;strstart-1], bflush)<span class='macro_popup'>{ uch cc = (s-&gt;window[s-&gt;strstart-1]); s-&gt;sym_buf[s-&gt;<br>sym_next++] = 0; s-&gt;sym_buf[s-&gt;sym_next++] = 0; s-&gt;sym_buf<br>[s-&gt;sym_next++] = cc; s-&gt;dyn_ltree[cc].fc.freq++; bflush<br> = (s-&gt;sym_next == s-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line">        s-&gt;match_available = 0;</td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line">    s-&gt;insert = s-&gt;strstart &lt; <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1 ? s-&gt;strstart : <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>-1;</td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line">    <span class='keyword'>if</span> (flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 1)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (1));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (1) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line">        <span class='keyword'>return</span> finish_done;</td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">    <span class='keyword'>if</span> (s-&gt;sym_next)</td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line">    <span class='keyword'>return</span> block_done;</td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line"><span class='directive'>#endif /* FASTEST */</span></td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line"> <span class='comment'>* For Z_RLE, simply look for runs of bytes, generate matches only of distance</span></td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line"> <span class='comment'>* one.  Do not maintain a hash table.  (It will be regenerated if this run of</span></td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line"> <span class='comment'>* deflate switches away from Z_RLE.)</span></td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_rle(s, flush)</td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line">    <span class='keyword'>int</span> flush;</td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line">    <span class='keyword'>int</span> bflush;             <span class='comment'>/* set if current block must be flushed */</span></td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line">    <span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span> prev;              <span class='comment'>/* byte at distance one to match */</span></td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">    <span class='macro'>Bytef<span class='macro_popup'>Cr_z_Bytef</span></span> *scan, *strend;   <span class='comment'>/* scan goes up to strend for length of run */</span></td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line">    <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">        <span class='comment'>/* Make sure that we always have enough lookahead, except</span></td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line">         <span class='comment'>* at the end of the input file. We need MAX_MATCH bytes</span></td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line">         <span class='comment'>* for the longest run, plus one for the unrolled loop.</span></td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead &lt;= <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">            fill_window(s);</td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead &lt;= <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> &amp;&amp; flush == <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">                <span class='keyword'>return</span> need_more;</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead == 0) <span class='keyword'>break</span>; <span class='comment'>/* flush the current block */</span></td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">        <span class='comment'>/* See how many times the previous byte repeats */</span></td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">        s-&gt;match_length = 0;</td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span> &amp;&amp; s-&gt;strstart &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">            scan = s-&gt;window + s-&gt;strstart - 1;</td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">            prev = *scan;</td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line">            <span class='keyword'>if</span> (prev == *++scan &amp;&amp; prev == *++scan &amp;&amp; prev == *++scan) {</td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line">                strend = s-&gt;window + s-&gt;strstart + <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">                <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">                } <span class='keyword'>while</span> (prev == *++scan &amp;&amp; prev == *++scan &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">                         prev == *++scan &amp;&amp; prev == *++scan &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line">                         prev == *++scan &amp;&amp; prev == *++scan &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">                         prev == *++scan &amp;&amp; prev == *++scan &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line">                         scan &lt; strend);</td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line">                s-&gt;match_length = <span class='macro'>MAX_MATCH<span class='macro_popup'>258</span></span> - (<span class='macro'>uInt<span class='macro_popup'>Cr_z_uInt</span></span>)(strend - scan);</td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">                <span class='keyword'>if</span> (s-&gt;match_length &gt; s-&gt;lookahead)</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line">                    s-&gt;match_length = s-&gt;lookahead;</td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line">            Assert(scan &lt;= s-&gt;window+(uInt)(s-&gt;window_size-1), <span class='string_literal'>"wild scan"</span>);</td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line">        <span class='comment'>/* Emit match if have run of MIN_MATCH or longer, else emit literal */</span></td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line">        <span class='keyword'>if</span> (s-&gt;match_length &gt;= <span class='macro'>MIN_MATCH<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line">            check_match(s, s-&gt;strstart, s-&gt;strstart - 1, s-&gt;match_length);</td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line">            <span class='macro'>_tr_tally_dist(s, 1, s-&gt;match_length - MIN_MATCH, bflush)<span class='macro_popup'>{ uch len = (uch)(s-&gt;match_length - 3); ush dist = (ush)(1<br>); s-&gt;sym_buf[s-&gt;sym_next++] = dist; s-&gt;sym_buf[s-&gt;<br>sym_next++] = dist &gt;&gt; 8; s-&gt;sym_buf[s-&gt;sym_next++<br>] = len; dist--; s-&gt;dyn_ltree[Cr_z__length_code[len]+256 +<br>1].fc.freq++; s-&gt;dyn_dtree[((dist) &lt; 256 ? Cr_z__dist_code<br>[dist] : Cr_z__dist_code[256+((dist)&gt;&gt;7)])].fc.freq++; bflush<br> = (s-&gt;sym_next == s-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">            s-&gt;lookahead -= s-&gt;match_length;</td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line">            s-&gt;strstart += s-&gt;match_length;</td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line">            s-&gt;match_length = 0;</td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line">            <span class='comment'>/* No match, output a literal byte */</span></td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">            Tracevv((stderr,<span class='string_literal'>"%c"</span>, s-&gt;window[s-&gt;strstart]));</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">            <span class='macro'>_tr_tally_lit (s, s-&gt;window[s-&gt;strstart], bflush)<span class='macro_popup'>{ uch cc = (s-&gt;window[s-&gt;strstart]); s-&gt;sym_buf[s-&gt;<br>sym_next++] = 0; s-&gt;sym_buf[s-&gt;sym_next++] = 0; s-&gt;sym_buf<br>[s-&gt;sym_next++] = cc; s-&gt;dyn_ltree[cc].fc.freq++; bflush<br> = (s-&gt;sym_next == s-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line">            s-&gt;lookahead--;</td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line">            s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line">        <span class='keyword'>if</span> (bflush) <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line">    s-&gt;insert = 0;</td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line">    <span class='keyword'>if</span> (flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 1)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (1));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (1) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line">        <span class='keyword'>return</span> finish_done;</td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line">    <span class='keyword'>if</span> (s-&gt;sym_next)</td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">    <span class='keyword'>return</span> block_done;</td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line"><span class='comment'>/* ===========================================================================</span></td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line"> <span class='comment'>* For Z_HUFFMAN_ONLY, do not look for matches.  Do not maintain a hash table.</span></td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line"> <span class='comment'>* (It will be regenerated if this run of deflate switches away from Huffman.)</span></td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line"><span class='macro'>local<span class='macro_popup'>static</span></span> block_state deflate_huff(s, flush)</td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line">    deflate_state *s;</td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line">    <span class='keyword'>int</span> flush;</td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line">    <span class='keyword'>int</span> bflush;             <span class='comment'>/* set if current block must be flushed */</span></td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line">    <span class='keyword'>for</span> (;;) {</td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">        <span class='comment'>/* Make sure that we have a literal to write. */</span></td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line">        <span class='keyword'>if</span> (s-&gt;lookahead == 0) {</td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line">            fill_window(s);</td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line">            <span class='keyword'>if</span> (s-&gt;lookahead == 0) {</td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line">                <span class='keyword'>if</span> (flush == <span class='macro'>Z_NO_FLUSH<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line">                    <span class='keyword'>return</span> need_more;</td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line">                <span class='keyword'>break</span>;      <span class='comment'>/* flush the current block */</span></td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">        <span class='comment'>/* Output a literal byte */</span></td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">        s-&gt;match_length = 0;</td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line">        Tracevv((stderr,<span class='string_literal'>"%c"</span>, s-&gt;window[s-&gt;strstart]));</td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">        <span class='macro'>_tr_tally_lit (s, s-&gt;window[s-&gt;strstart], bflush)<span class='macro_popup'>{ uch cc = (s-&gt;window[s-&gt;strstart]); s-&gt;sym_buf[s-&gt;<br>sym_next++] = 0; s-&gt;sym_buf[s-&gt;sym_next++] = 0; s-&gt;sym_buf<br>[s-&gt;sym_next++] = cc; s-&gt;dyn_ltree[cc].fc.freq++; bflush<br> = (s-&gt;sym_next == s-&gt;sym_end); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line">        s-&gt;lookahead--;</td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line">        s-&gt;strstart++;</td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line">        <span class='keyword'>if</span> (bflush) <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">    s-&gt;insert = 0;</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">    <span class='keyword'>if</span> (flush == <span class='macro'>Z_FINISH<span class='macro_popup'>4</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 1)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (1));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (1) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line">        <span class='keyword'>return</span> finish_done;</td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">    <span class='keyword'>if</span> (s-&gt;sym_next)</td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">        <span class='macro'>FLUSH_BLOCK(s, 0)<span class='macro_popup'>{ { Cr_z__tr_flush_block(s, (s-&gt;block_start &gt;= 0L ? (Cr_z_charf<br> *)&amp;s-&gt;window[(unsigned)s-&gt;block_start] : (Cr_z_charf<br> *)0), (ulg)((long)s-&gt;strstart - s-&gt;block_start), (0));<br> s-&gt;block_start = s-&gt;strstart; flush_pending(s-&gt;strm<br>); ; }; if (s-&gt;strm-&gt;avail_out == 0) return (0) ? finish_started<br> : need_more; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">    <span class='keyword'>return</span> block_done;</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">}</td></tr>
</table></body></html>
