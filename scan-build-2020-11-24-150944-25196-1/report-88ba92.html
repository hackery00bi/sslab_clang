<!doctype html>
<html>
<head>
<title>../lib/compress/zstd_compress.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Call to function 'memcpy' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memcpy_s' in case of C11 -->

<!-- BUGTYPE Potential insecure memory buffer bounds restriction in call 'memcpy' -->

<!-- BUGCATEGORY Security -->

<!-- BUGFILE /tmp/sslab_clang/c_zstd/zstd/programs/../lib/compress/zstd_compress.c -->

<!-- FILENAME zstd_compress.c -->

<!-- FUNCTIONNAME ZSTD_copyCCtx_internal -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT e01ff8dcba0b66c07ada28ea95c1b47c -->

<!-- BUGLINE 1803 -->

<!-- BUGCOLUMN 9 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>programs/../lib/compress/zstd_compress.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 1803, column 9</a><br />Call to function 'memcpy' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memcpy_s' in case of C11</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -main-file-name zstd_compress.c -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debugger-tuning=gdb -resource-dir /llvm-project/build/lib/clang/12.0.0 -D XXH_NAMESPACE=ZSTD_ -D ZSTD_MULTITHREAD -D ZSTD_GZCOMPRESS -D ZSTD_GZDECOMPRESS -D ZSTD_LZMACOMPRESS -D ZSTD_LZMADECOMPRESS -D ZSTD_LZ4COMPRESS -D ZSTD_LZ4DECOMPRESS -D ZSTD_LEGACY_SUPPORT=5 -D BACKTRACE_ENABLE=0 -internal-isystem /usr/local/include -internal-isystem /llvm-project/build/lib/clang/12.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O3 -fdebug-compilation-dir /tmp/sslab_clang/c_zstd/zstd/programs -ferror-limit 19 -fgnuc-version=4.2.1 -vectorize-loops -vectorize-slp -analyzer-checker core -analyzer-checker cplusplus -analyzer-checker nullability -analyzer-checker optin -analyzer-checker security -analyzer-checker unix -analyzer-checker osx -analyzer-checker fuchsia -analyzer-checker webkit -analyzer-output=html -faddrsig -o /tmp/scan-build-2020-11-24-150944-25196-1 -x c ../lib/compress/zstd_compress.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"1803": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>* Copyright (c) 2016-2020, Yann Collet, Facebook, Inc.</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>* All rights reserved.</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> <span class='comment'>* This source code is licensed under both the BSD-style license (found in the</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"> <span class='comment'>* LICENSE file in the root directory of this source tree) and the GPLv2 (found</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> <span class='comment'>* in the COPYING file in the root directory of this source tree).</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> <span class='comment'>* You may select, at your option, one of the above-listed licenses.</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='comment'>/*-*************************************</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='comment'>*  Dependencies</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='comment'>***************************************/</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;limits.h&gt;         /* INT_MAX */</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;string.h&gt;         /* memset */</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "../common/cpu.h"</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include "../common/mem.h"</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include "hist.h"           /* HIST_countFast_wksp */</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#define FSE_STATIC_LINKING_ONLY   /* FSE_encodeSymbol */</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "../common/fse.h"</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#define HUF_STATIC_LINKING_ONLY</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include "../common/huf.h"</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include "zstd_compress_internal.h"</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include "zstd_compress_sequences.h"</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include "zstd_compress_literals.h"</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include "zstd_fast.h"</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include "zstd_double_fast.h"</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='directive'>#include "zstd_lazy.h"</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='directive'>#include "zstd_opt.h"</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'>#include "zstd_ldm.h"</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#include "zstd_compress_superblock.h"</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='comment'>/*-*************************************</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"><span class='comment'>*  Helper functions</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='comment'>***************************************/</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"><span class='comment'>/* ZSTD_compressBound()</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> <span class='comment'>* Note that the result from this function is only compatible with the "normal"</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"> <span class='comment'>* full-block strategy.</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> <span class='comment'>* When there are a lot of small blocks due to frequent flush in streaming mode</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> <span class='comment'>* the overhead of headers can make the compressed data to be larger than the</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"> <span class='comment'>* return value of ZSTD_compressBound().</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">size_t ZSTD_compressBound(size_t srcSize) {</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>ZSTD_COMPRESSBOUND(srcSize)<span class='macro_popup'>((srcSize) + ((srcSize)&gt;&gt;8) + (((srcSize) &lt; (128&lt;&lt;<br>10)) ? (((128&lt;&lt;10) - (srcSize)) &gt;&gt; 11) : 0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='comment'>/*-*************************************</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"><span class='comment'>*  Context memory management</span></td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='comment'>***************************************/</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"><span class='keyword'>struct</span> ZSTD_CDict_s {</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>void</span>* dictContent;</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">    size_t dictContentSize;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">    U32* entropyWorkspace; <span class='comment'>/* entropy workspace of HUF_WORKSPACE_SIZE bytes */</span></td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">    ZSTD_cwksp workspace;</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">    ZSTD_matchState_t matchState;</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">    ZSTD_compressedBlockState_t cBlockState;</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">    ZSTD_customMem customMem;</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">    U32 dictID;</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">    <span class='keyword'>int</span> compressionLevel; <span class='comment'>/* 0 indicates that advanced API was used to select CDict params */</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">};  <span class='comment'>/* typedef'd to ZSTD_CDict within "zstd.h" */</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">ZSTD_CCtx* ZSTD_createCCtx(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">    <span class='keyword'>return</span> ZSTD_createCCtx_advanced(ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_initCCtx(ZSTD_CCtx* cctx, ZSTD_customMem memManager)</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">    <span class='macro'>assert(cctx != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">    memset(cctx, 0, <span class='keyword'>sizeof</span>(*cctx));</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">    cctx-&gt;customMem = memManager;</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">    cctx-&gt;bmi2 = ZSTD_cpuid_bmi2(ZSTD_cpuid());</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">    {   size_t <span class='keyword'>const</span> err = ZSTD_CCtx_reset(cctx, ZSTD_reset_parameters);</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">        <span class='macro'>assert(!ZSTD_isError(err))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">        (<span class='keyword'>void</span>)err;</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">ZSTD_CCtx* ZSTD_createCCtx_advanced(ZSTD_customMem customMem)</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">    <span class='macro'>ZSTD_STATIC_ASSERT(zcss_init==0)<span class='macro_popup'>(void)sizeof(char[(zcss_init==0) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">    <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_CONTENTSIZE_UNKNOWN==(0ULL - 1))<span class='macro_popup'>(void)sizeof(char[((0ULL - 1)==(0ULL - 1)) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">    <span class='keyword'>if</span> (!customMem.customAlloc ^ !customMem.customFree) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">    {   ZSTD_CCtx* <span class='keyword'>const</span> cctx = (ZSTD_CCtx*)ZSTD_malloc(<span class='keyword'>sizeof</span>(ZSTD_CCtx), customMem);</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">        <span class='keyword'>if</span> (!cctx) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">        ZSTD_initCCtx(cctx, customMem);</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">        <span class='keyword'>return</span> cctx;</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">ZSTD_CCtx* ZSTD_initStaticCCtx(<span class='keyword'>void</span>* workspace, size_t workspaceSize)</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    ZSTD_cwksp ws;</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    ZSTD_CCtx* cctx;</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    <span class='keyword'>if</span> (workspaceSize &lt;= <span class='keyword'>sizeof</span>(ZSTD_CCtx)) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;  <span class='comment'>/* minimum size */</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">    <span class='keyword'>if</span> ((size_t)workspace &amp; 7) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;  <span class='comment'>/* must be 8-aligned */</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    ZSTD_cwksp_init(&amp;ws, workspace, workspaceSize);</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">    cctx = (ZSTD_CCtx*)ZSTD_cwksp_reserve_object(&amp;ws, <span class='keyword'>sizeof</span>(ZSTD_CCtx));</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">    <span class='keyword'>if</span> (cctx == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">    memset(cctx, 0, <span class='keyword'>sizeof</span>(ZSTD_CCtx));</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">    ZSTD_cwksp_move(&amp;cctx-&gt;workspace, &amp;ws);</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">    cctx-&gt;staticSize = workspaceSize;</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">    <span class='comment'>/* statically sized space. entropyWorkspace never moves (but prev/next block swap places) */</span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">    <span class='keyword'>if</span> (!ZSTD_cwksp_check_available(&amp;cctx-&gt;workspace, <span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span> + 2 * <span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t))) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">    cctx-&gt;blockState.prevCBlock = (ZSTD_compressedBlockState_t*)ZSTD_cwksp_reserve_object(&amp;cctx-&gt;workspace, <span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t));</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">    cctx-&gt;blockState.nextCBlock = (ZSTD_compressedBlockState_t*)ZSTD_cwksp_reserve_object(&amp;cctx-&gt;workspace, <span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t));</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">    cctx-&gt;entropyWorkspace = (U32*)ZSTD_cwksp_reserve_object(&amp;cctx-&gt;workspace, <span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">    cctx-&gt;bmi2 = ZSTD_cpuid_bmi2(ZSTD_cpuid());</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">    <span class='keyword'>return</span> cctx;</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"> <span class='comment'>* Clears and frees all of the dictionaries in the CCtx.</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_clearAllDicts(ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">    ZSTD_free(cctx-&gt;localDict.dictBuffer, cctx-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">    ZSTD_freeCDict(cctx-&gt;localDict.cdict);</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">    memset(&amp;cctx-&gt;localDict, 0, <span class='keyword'>sizeof</span>(cctx-&gt;localDict));</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">    memset(&amp;cctx-&gt;prefixDict, 0, <span class='keyword'>sizeof</span>(cctx-&gt;prefixDict));</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">    cctx-&gt;cdict = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_sizeof_localDict(ZSTD_localDict dict)</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">    size_t <span class='keyword'>const</span> bufferSize = dict.dictBuffer != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> ? dict.dictSize : 0;</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">    size_t <span class='keyword'>const</span> cdictSize = ZSTD_sizeof_CDict(dict.cdict);</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">    <span class='keyword'>return</span> bufferSize + cdictSize;</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_freeCCtxContent(ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">    <span class='macro'>assert(cctx != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">    <span class='macro'>assert(cctx-&gt;staticSize == 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">    ZSTD_clearAllDicts(cctx);</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">    ZSTDMT_freeCCtx(cctx-&gt;mtctx); cctx-&gt;mtctx = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">    ZSTD_cwksp_free(&amp;cctx-&gt;workspace, cctx-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">size_t ZSTD_freeCCtx(ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">    <span class='keyword'>if</span> (cctx==<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0;   <span class='comment'>/* support free on NULL */</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;staticSize, memory_allocation,<span class='macro_popup'>if (cctx-&gt;staticSize) { {}; if (0) { _force_has_format_string<br>("not compatible with static CCtx"); }; {}; {}; return ((size_t<br>)-ZSTD_error_memory_allocation); }</span></span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">                    <span class='string_literal'><span class='macro'>"not compatible with static CCtx"</span>)<span class='macro_popup'>if (cctx-&gt;staticSize) { {}; if (0) { _force_has_format_string<br>("not compatible with static CCtx"); }; {}; {}; return ((size_t<br>)-ZSTD_error_memory_allocation); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">        <span class='keyword'>int</span> cctxInWorkspace = ZSTD_cwksp_owns_buffer(&amp;cctx-&gt;workspace, cctx);</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">        ZSTD_freeCCtxContent(cctx);</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">        <span class='keyword'>if</span> (!cctxInWorkspace) {</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">            ZSTD_free(cctx, cctx-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_sizeof_mtctx(<span class='keyword'>const</span> ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">    <span class='keyword'>return</span> ZSTDMT_sizeof_CCtx(cctx-&gt;mtctx);</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">    (<span class='keyword'>void</span>)cctx;</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">size_t ZSTD_sizeof_CCtx(<span class='keyword'>const</span> ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">    <span class='keyword'>if</span> (cctx==<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0;   <span class='comment'>/* support sizeof on NULL */</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">    <span class='comment'>/* cctx may be in the workspace */</span></td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">    <span class='keyword'>return</span> (cctx-&gt;workspace.workspace == cctx ? 0 : <span class='keyword'>sizeof</span>(*cctx))</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">           + ZSTD_cwksp_sizeof(&amp;cctx-&gt;workspace)</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">           + ZSTD_sizeof_localDict(cctx-&gt;localDict)</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">           + ZSTD_sizeof_mtctx(cctx);</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">size_t ZSTD_sizeof_CStream(<span class='keyword'>const</span> ZSTD_CStream* zcs)</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">    <span class='keyword'>return</span> ZSTD_sizeof_CCtx(zcs);  <span class='comment'>/* same object */</span></td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"><span class='comment'>/* private API call, for dictBuilder only */</span></td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line"><span class='keyword'>const</span> seqStore_t* ZSTD_getSeqStore(<span class='keyword'>const</span> ZSTD_CCtx* ctx) { <span class='keyword'>return</span> &amp;(ctx-&gt;seqStore); }</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"><span class='keyword'>static</span> ZSTD_CCtx_params ZSTD_makeCCtxParamsFromCParams(</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">        ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">    ZSTD_CCtx_params cctxParams;</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">    memset(&amp;cctxParams, 0, <span class='keyword'>sizeof</span>(cctxParams));</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">    cctxParams.cParams = cParams;</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">    cctxParams.compressionLevel = <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>;  <span class='comment'>/* should not matter, as all cParams are presumed properly defined */</span></td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">    <span class='macro'>assert(!ZSTD_checkCParams(cParams))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">    cctxParams.fParams.contentSizeFlag = 1;</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">    <span class='keyword'>return</span> cctxParams;</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"><span class='keyword'>static</span> ZSTD_CCtx_params* ZSTD_createCCtxParams_advanced(</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">        ZSTD_customMem customMem)</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">    ZSTD_CCtx_params* params;</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">    <span class='keyword'>if</span> (!customMem.customAlloc ^ !customMem.customFree) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">    params = (ZSTD_CCtx_params*)ZSTD_calloc(</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">            <span class='keyword'>sizeof</span>(ZSTD_CCtx_params), customMem);</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">    <span class='keyword'>if</span> (!params) { <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">    params-&gt;customMem = customMem;</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">    params-&gt;compressionLevel = <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">    params-&gt;fParams.contentSizeFlag = 1;</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">    <span class='keyword'>return</span> params;</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">ZSTD_CCtx_params* ZSTD_createCCtxParams(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">    <span class='keyword'>return</span> ZSTD_createCCtxParams_advanced(ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">size_t ZSTD_freeCCtxParams(ZSTD_CCtx_params* params)</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">    <span class='keyword'>if</span> (params == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) { <span class='keyword'>return</span> 0; }</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">    ZSTD_free(params, params-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">size_t ZSTD_CCtxParams_reset(ZSTD_CCtx_params* params)</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    <span class='keyword'>return</span> ZSTD_CCtxParams_init(params, <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>);</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">size_t ZSTD_CCtxParams_init(ZSTD_CCtx_params* cctxParams, <span class='keyword'>int</span> compressionLevel) {</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(!cctxParams, GENERIC, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (!cctxParams) { {}; if (0) { _force_has_format_string("NULL pointer!"<br>); }; {}; {}; return ((size_t)-ZSTD_error_GENERIC); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">    memset(cctxParams, 0, <span class='keyword'>sizeof</span>(*cctxParams));</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">    cctxParams-&gt;compressionLevel = compressionLevel;</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">    cctxParams-&gt;fParams.contentSizeFlag = 1;</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">size_t ZSTD_CCtxParams_init_advanced(ZSTD_CCtx_params* cctxParams, ZSTD_parameters params)</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(!cctxParams, GENERIC, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (!cctxParams) { {}; if (0) { _force_has_format_string("NULL pointer!"<br>); }; {}; {}; return ((size_t)-ZSTD_error_GENERIC); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_checkCParams(params.cParams) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkCParams(params.cParams<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">    memset(cctxParams, 0, <span class='keyword'>sizeof</span>(*cctxParams));</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">    <span class='macro'>assert(!ZSTD_checkCParams(params.cParams))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">    cctxParams-&gt;cParams = params.cParams;</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">    cctxParams-&gt;fParams = params.fParams;</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">    cctxParams-&gt;compressionLevel = <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>;   <span class='comment'>/* should not matter, as all cParams are presumed properly defined */</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line"><span class='comment'>/* ZSTD_assignParamsToCCtxParams() :</span></td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line"> <span class='comment'>* params is presumed valid at this stage */</span></td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line"><span class='keyword'>static</span> ZSTD_CCtx_params ZSTD_assignParamsToCCtxParams(</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">        <span class='keyword'>const</span> ZSTD_CCtx_params* cctxParams, <span class='keyword'>const</span> ZSTD_parameters* params)</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">    ZSTD_CCtx_params ret = *cctxParams;</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">    <span class='macro'>assert(!ZSTD_checkCParams(params-&gt;cParams))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">    ret.cParams = params-&gt;cParams;</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">    ret.fParams = params-&gt;fParams;</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">    ret.compressionLevel = <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>;   <span class='comment'>/* should not matter, as all cParams are presumed properly defined */</span></td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">    <span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">ZSTD_bounds ZSTD_cParam_getBounds(ZSTD_cParameter param)</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">    ZSTD_bounds bounds = { 0, 0, 0 };</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">    <span class='keyword'>switch</span>(param)</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_compressionLevel:</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">        bounds.lowerBound = ZSTD_minCLevel();</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">        bounds.upperBound = ZSTD_maxCLevel();</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_windowLog:</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_WINDOWLOG_MIN<span class='macro_popup'>10</span></span>;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_WINDOWLOG_MAX<span class='macro_popup'>((int)(sizeof(size_t) == 4 ? 30 : 31))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_hashLog:</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_HASHLOG_MIN<span class='macro_popup'>6</span></span>;</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_HASHLOG_MAX<span class='macro_popup'>((((int)(sizeof(size_t) == 4 ? 30 : 31)) &lt; 30) ? ((int)(sizeof<br>(size_t) == 4 ? 30 : 31)) : 30)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_chainLog:</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_CHAINLOG_MIN<span class='macro_popup'>6</span></span>;</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_CHAINLOG_MAX<span class='macro_popup'>((int)(sizeof(size_t) == 4 ? 29 : 30))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_searchLog:</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_SEARCHLOG_MIN<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_SEARCHLOG_MAX<span class='macro_popup'>(((int)(sizeof(size_t) == 4 ? 30 : 31))-1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_minMatch:</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_MINMATCH_MIN<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_MINMATCH_MAX<span class='macro_popup'>7</span></span>;</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_targetLength:</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_TARGETLENGTH_MIN<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_TARGETLENGTH_MAX<span class='macro_popup'>(1&lt;&lt;17)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_strategy:</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_STRATEGY_MIN<span class='macro_popup'>ZSTD_fast</span></span>;</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_STRATEGY_MAX<span class='macro_popup'>ZSTD_btultra2</span></span>;</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_contentSizeFlag:</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">        bounds.upperBound = 1;</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_checksumFlag:</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">        bounds.upperBound = 1;</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_dictIDFlag:</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">        bounds.upperBound = 1;</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_nbWorkers:</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTDMT_NBWORKERS_MAX<span class='macro_popup'>200</span></span>;</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">        bounds.upperBound = 0;</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_jobSize:</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTDMT_JOBSIZE_MAX<span class='macro_popup'>(MEM_32bits() ? (512 *(1 &lt;&lt;20)) : (1024 *(1 &lt;&lt;20)<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">        bounds.upperBound = 0;</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_overlapLog:</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_OVERLAPLOG_MIN<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_OVERLAPLOG_MAX<span class='macro_popup'>9</span></span>;</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">        bounds.upperBound = 0;</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_enableLongDistanceMatching:</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">        bounds.upperBound = 1;</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashLog:</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_LDM_HASHLOG_MIN<span class='macro_popup'>6</span></span>;</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_LDM_HASHLOG_MAX<span class='macro_popup'>((((int)(sizeof(size_t) == 4 ? 30 : 31)) &lt; 30) ? ((int)(sizeof<br>(size_t) == 4 ? 30 : 31)) : 30)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmMinMatch:</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_LDM_MINMATCH_MIN<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_LDM_MINMATCH_MAX<span class='macro_popup'>4096</span></span>;</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmBucketSizeLog:</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_LDM_BUCKETSIZELOG_MIN<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_LDM_BUCKETSIZELOG_MAX<span class='macro_popup'>8</span></span>;</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashRateLog:</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_LDM_HASHRATELOG_MIN<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_LDM_HASHRATELOG_MAX<span class='macro_popup'>(((int)(sizeof(size_t) == 4 ? 30 : 31)) - 6)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">    <span class='comment'>/* experimental parameters */</span></td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_rsyncable<span class='macro_popup'>ZSTD_c_experimentalParam1</span></span>:</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">        bounds.upperBound = 1;</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceMaxWindow<span class='macro_popup'>ZSTD_c_experimentalParam3</span></span> :</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">        bounds.lowerBound = 0;</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">        bounds.upperBound = 1;</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_format<span class='macro_popup'>ZSTD_c_experimentalParam2</span></span>:</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_f_zstd1 &lt; ZSTD_f_zstd1_magicless)<span class='macro_popup'>(void)sizeof(char[(ZSTD_f_zstd1 &lt; ZSTD_f_zstd1_magicless) ?<br> 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">        bounds.lowerBound = ZSTD_f_zstd1;</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">        bounds.upperBound = ZSTD_f_zstd1_magicless;   <span class='comment'>/* note : how to ensure at compile time that this is the highest value enum ? */</span></td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceAttachDict<span class='macro_popup'>ZSTD_c_experimentalParam4</span></span>:</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_dictDefaultAttach &lt; ZSTD_dictForceCopy)<span class='macro_popup'>(void)sizeof(char[(ZSTD_dictDefaultAttach &lt; ZSTD_dictForceCopy<br>) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">        bounds.lowerBound = ZSTD_dictDefaultAttach;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">        bounds.upperBound = ZSTD_dictForceLoad;       <span class='comment'>/* note : how to ensure at compile time that this is the highest value enum ? */</span></td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_literalCompressionMode<span class='macro_popup'>ZSTD_c_experimentalParam5</span></span>:</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_lcm_auto &lt; ZSTD_lcm_huffman &amp;&amp; ZSTD_lcm_huffman &lt; ZSTD_lcm_uncompressed)<span class='macro_popup'>(void)sizeof(char[(ZSTD_lcm_auto &lt; ZSTD_lcm_huffman &amp;&amp;<br> ZSTD_lcm_huffman &lt; ZSTD_lcm_uncompressed) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">        bounds.lowerBound = ZSTD_lcm_auto;</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">        bounds.upperBound = ZSTD_lcm_uncompressed;</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_targetCBlockSize<span class='macro_popup'>ZSTD_c_experimentalParam6</span></span>:</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_TARGETCBLOCKSIZE_MIN<span class='macro_popup'>64</span></span>;</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_TARGETCBLOCKSIZE_MAX<span class='macro_popup'>(1&lt;&lt;17)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_srcSizeHint<span class='macro_popup'>ZSTD_c_experimentalParam7</span></span>:</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">        bounds.lowerBound = <span class='macro'>ZSTD_SRCSIZEHINT_MIN<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">        bounds.upperBound = <span class='macro'>ZSTD_SRCSIZEHINT_MAX<span class='macro_popup'>2147483647</span></span>;</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">        bounds.error = <span class='macro'>ERROR(parameter_unsupported)<span class='macro_popup'>((size_t)-ZSTD_error_parameter_unsupported)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">        <span class='keyword'>return</span> bounds;</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line"><span class='comment'>/* ZSTD_cParam_clampBounds:</span></td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line"> <span class='comment'>* Clamps the value into the bounded range.</span></td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_cParam_clampBounds(ZSTD_cParameter cParam, <span class='keyword'>int</span>* value)</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">    ZSTD_bounds <span class='keyword'>const</span> bounds = ZSTD_cParam_getBounds(cParam);</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>ZSTD_isError<span class='macro_popup'>ERR_isError</span></span>(bounds.error)) <span class='keyword'>return</span> bounds.error;</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">    <span class='keyword'>if</span> (*value &lt; bounds.lowerBound) *value = bounds.lowerBound;</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">    <span class='keyword'>if</span> (*value &gt; bounds.upperBound) *value = bounds.upperBound;</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line"><span class='directive'>#define <span class='macro'>BOUNDCHECK(cParam, val)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(cParam,val)) { {}; if (0) { _force_has_format_string<br>("Param out of bounds"); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span> { \</span></td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">    <span class='directive'><span class='macro'>RETURN_ERROR_IF(!ZSTD_cParam_withinBounds(cParam,val), \<span class='macro_popup'>if (!ZSTD_cParam_withinBounds(cParam,val)) { {}; if (0) { _force_has_format_string<br>("Param out of bounds"); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }</span></span></span></td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">                    <span class='directive'><span class='macro'>parameter_outOfBound, "Param out of bounds")<span class='macro_popup'>if (!ZSTD_cParam_withinBounds(cParam,val)) { {}; if (0) { _force_has_format_string<br>("Param out of bounds"); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }</span></span>; \</span></td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line"><span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ZSTD_isUpdateAuthorized(ZSTD_cParameter param)</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">    <span class='keyword'>switch</span>(param)</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_compressionLevel:</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_hashLog:</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_chainLog:</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_searchLog:</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_minMatch:</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_targetLength:</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_strategy:</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">        <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_format<span class='macro_popup'>ZSTD_c_experimentalParam2</span></span>:</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_windowLog:</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_contentSizeFlag:</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_checksumFlag:</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_dictIDFlag:</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceMaxWindow<span class='macro_popup'>ZSTD_c_experimentalParam3</span></span> :</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_nbWorkers:</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_jobSize:</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_overlapLog:</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_rsyncable<span class='macro_popup'>ZSTD_c_experimentalParam1</span></span>:</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_enableLongDistanceMatching:</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashLog:</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmMinMatch:</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmBucketSizeLog:</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashRateLog:</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceAttachDict<span class='macro_popup'>ZSTD_c_experimentalParam4</span></span>:</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_literalCompressionMode<span class='macro_popup'>ZSTD_c_experimentalParam5</span></span>:</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_targetCBlockSize<span class='macro_popup'>ZSTD_c_experimentalParam6</span></span>:</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_srcSizeHint<span class='macro_popup'>ZSTD_c_experimentalParam7</span></span>:</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">size_t ZSTD_CCtx_setParameter(ZSTD_CCtx* cctx, ZSTD_cParameter param, <span class='keyword'>int</span> value)</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_CCtx_setParameter (%i, %i)"</span>, (<span class='keyword'>int</span>)param, value)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;streamStage != zcss_init) {</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">        <span class='keyword'>if</span> (ZSTD_isUpdateAuthorized(param)) {</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">            cctx-&gt;cParamsChanged = 1;</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">            <span class='macro'>RETURN_ERROR(stage_wrong, <span class='string_literal'>"can only set params in ctx init stage"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("can only set params in ctx init stage"<br>); }; {}; {}; return ((size_t)-ZSTD_error_stage_wrong); } while<br>(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">    <span class='keyword'>switch</span>(param)</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_nbWorkers:</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">        <span class='macro'>RETURN_ERROR_IF((value!=0) &amp;&amp; cctx-&gt;staticSize, parameter_unsupported,<span class='macro_popup'>if ((value!=0) &amp;&amp; cctx-&gt;staticSize) { {}; if (0) {<br> _force_has_format_string("MT not compatible with static alloc"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">                        <span class='string_literal'><span class='macro'>"MT not compatible with static alloc"</span>)<span class='macro_popup'>if ((value!=0) &amp;&amp; cctx-&gt;staticSize) { {}; if (0) {<br> _force_has_format_string("MT not compatible with static alloc"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_compressionLevel:</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_windowLog:</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_hashLog:</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_chainLog:</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_searchLog:</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_minMatch:</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_targetLength:</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_strategy:</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashRateLog:</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_format<span class='macro_popup'>ZSTD_c_experimentalParam2</span></span>:</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_contentSizeFlag:</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_checksumFlag:</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_dictIDFlag:</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceMaxWindow<span class='macro_popup'>ZSTD_c_experimentalParam3</span></span>:</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceAttachDict<span class='macro_popup'>ZSTD_c_experimentalParam4</span></span>:</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_literalCompressionMode<span class='macro_popup'>ZSTD_c_experimentalParam5</span></span>:</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_jobSize:</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_overlapLog:</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_rsyncable<span class='macro_popup'>ZSTD_c_experimentalParam1</span></span>:</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_enableLongDistanceMatching:</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashLog:</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmMinMatch:</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmBucketSizeLog:</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_targetCBlockSize<span class='macro_popup'>ZSTD_c_experimentalParam6</span></span>:</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_srcSizeHint<span class='macro_popup'>ZSTD_c_experimentalParam7</span></span>:</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">    <span class='keyword'>default</span>: <span class='macro'>RETURN_ERROR(parameter_unsupported, <span class='string_literal'>"unknown parameter"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("unknown parameter"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">    <span class='keyword'>return</span> ZSTD_CCtxParams_setParameter(&amp;cctx-&gt;requestedParams, param, value);</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">size_t ZSTD_CCtxParams_setParameter(ZSTD_CCtx_params* CCtxParams,</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">                                    ZSTD_cParameter param, <span class='keyword'>int</span> value)</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_CCtxParams_setParameter (%i, %i)"</span>, (<span class='keyword'>int</span>)param, value)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">    <span class='keyword'>switch</span>(param)</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_format<span class='macro_popup'>ZSTD_c_experimentalParam2</span></span> :</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">        <span class='macro'>BOUNDCHECK(ZSTD_c_format, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_experimentalParam2,value<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">        CCtxParams-&gt;format = (ZSTD_format_e)value;</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">        <span class='keyword'>return</span> (size_t)CCtxParams-&gt;format;</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_compressionLevel : {</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_cParam_clampBounds(param, &amp;value), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_cParam_clampBounds(param, &amp;<br>value)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">        <span class='keyword'>if</span> (value) {  <span class='comment'>/* 0 : does not change current level */</span></td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">            CCtxParams-&gt;compressionLevel = value;</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">        <span class='keyword'>if</span> (CCtxParams-&gt;compressionLevel &gt;= 0) <span class='keyword'>return</span> (size_t)CCtxParams-&gt;compressionLevel;</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">        <span class='keyword'>return</span> 0;  <span class='comment'>/* return type (size_t) cannot represent negative values */</span></td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_windowLog :</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 =&gt; use default */</span></td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_windowLog, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_windowLog,value)) { {}<br>; if (0) { _force_has_format_string("Param out of bounds"); }<br>; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">        CCtxParams-&gt;cParams.windowLog = (U32)value;</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_hashLog :</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 =&gt; use default */</span></td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_hashLog, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_hashLog,value)) { {}; if<br> (0) { _force_has_format_string("Param out of bounds"); }; {}<br>; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">        CCtxParams-&gt;cParams.hashLog = (U32)value;</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;cParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_chainLog :</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 =&gt; use default */</span></td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_chainLog, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_chainLog,value)) { {};<br> if (0) { _force_has_format_string("Param out of bounds"); };<br> {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">        CCtxParams-&gt;cParams.chainLog = (U32)value;</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;cParams.chainLog;</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_searchLog :</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 =&gt; use default */</span></td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_searchLog, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_searchLog,value)) { {}<br>; if (0) { _force_has_format_string("Param out of bounds"); }<br>; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">        CCtxParams-&gt;cParams.searchLog = (U32)value;</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">        <span class='keyword'>return</span> (size_t)value;</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_minMatch :</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 =&gt; use default */</span></td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_minMatch, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_minMatch,value)) { {};<br> if (0) { _force_has_format_string("Param out of bounds"); };<br> {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">        CCtxParams-&gt;cParams.minMatch = value;</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;cParams.minMatch;</td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_targetLength :</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">        <span class='macro'>BOUNDCHECK(ZSTD_c_targetLength, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_targetLength,value)) {<br> {}; if (0) { _force_has_format_string("Param out of bounds")<br>; }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">        CCtxParams-&gt;cParams.targetLength = value;</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;cParams.targetLength;</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_strategy :</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 =&gt; use default */</span></td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_strategy, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_strategy,value)) { {};<br> if (0) { _force_has_format_string("Param out of bounds"); };<br> {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">        CCtxParams-&gt;cParams.strategy = (ZSTD_strategy)value;</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">        <span class='keyword'>return</span> (size_t)CCtxParams-&gt;cParams.strategy;</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_contentSizeFlag :</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">        <span class='comment'>/* Content size written in frame header _when known_ (default:1) */</span></td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"set content size flag = %u"</span>, (value!=0))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">        CCtxParams-&gt;fParams.contentSizeFlag = value != 0;</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;fParams.contentSizeFlag;</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_checksumFlag :</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">        <span class='comment'>/* A 32-bits content checksum will be calculated and written at end of frame (default:0) */</span></td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">        CCtxParams-&gt;fParams.checksumFlag = value != 0;</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;fParams.checksumFlag;</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_dictIDFlag : <span class='comment'>/* When applicable, dictionary's dictID is provided in frame header (default:1) */</span></td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"set dictIDFlag = %u"</span>, (value!=0))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">        CCtxParams-&gt;fParams.noDictIDFlag = !value;</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">        <span class='keyword'>return</span> !CCtxParams-&gt;fParams.noDictIDFlag;</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceMaxWindow<span class='macro_popup'>ZSTD_c_experimentalParam3</span></span> :</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">        CCtxParams-&gt;forceWindow = (value != 0);</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;forceWindow;</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceAttachDict<span class='macro_popup'>ZSTD_c_experimentalParam4</span></span> : {</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">        <span class='keyword'>const</span> ZSTD_dictAttachPref_e pref = (ZSTD_dictAttachPref_e)value;</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">        <span class='macro'>BOUNDCHECK(ZSTD_c_forceAttachDict, pref)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_experimentalParam4,pref<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">        CCtxParams-&gt;attachDictPref = pref;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;attachDictPref;</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_literalCompressionMode<span class='macro_popup'>ZSTD_c_experimentalParam5</span></span> : {</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">        <span class='keyword'>const</span> ZSTD_literalCompressionMode_e lcm = (ZSTD_literalCompressionMode_e)value;</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">        <span class='macro'>BOUNDCHECK(ZSTD_c_literalCompressionMode, lcm)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_experimentalParam5,lcm<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">        CCtxParams-&gt;literalCompressionMode = lcm;</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;literalCompressionMode;</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_nbWorkers :</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(value!=0, parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>if (value!=0) { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_cParam_clampBounds(param, &amp;value), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_cParam_clampBounds(param, &amp;<br>value)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">        CCtxParams-&gt;nbWorkers = value;</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;nbWorkers;</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_jobSize :</td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(value!=0, parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>if (value!=0) { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">        <span class='comment'>/* Adjust to the minimum non-default value. */</span></td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">        <span class='keyword'>if</span> (value != 0 &amp;&amp; value &lt; <span class='macro'>ZSTDMT_JOBSIZE_MIN<span class='macro_popup'>(1 *(1 &lt;&lt;20))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">            value = <span class='macro'>ZSTDMT_JOBSIZE_MIN<span class='macro_popup'>(1 *(1 &lt;&lt;20))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_cParam_clampBounds(param, &amp;value), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_cParam_clampBounds(param, &amp;<br>value)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">        <span class='macro'>assert(value &gt;= 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">        CCtxParams-&gt;jobSize = value;</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;jobSize;</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_overlapLog :</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(value!=0, parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>if (value!=0) { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_cParam_clampBounds(ZSTD_c_overlapLog, &amp;value), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_cParam_clampBounds(ZSTD_c_overlapLog<br>, &amp;value)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">        CCtxParams-&gt;overlapLog = value;</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;overlapLog;</td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_rsyncable<span class='macro_popup'>ZSTD_c_experimentalParam1</span></span> :</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(value!=0, parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>if (value!=0) { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_cParam_clampBounds(ZSTD_c_overlapLog, &amp;value), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_cParam_clampBounds(ZSTD_c_overlapLog<br>, &amp;value)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">        CCtxParams-&gt;rsyncable = value;</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;rsyncable;</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_enableLongDistanceMatching :</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">        CCtxParams-&gt;ldmParams.enableLdm = (value!=0);</td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;ldmParams.enableLdm;</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashLog :</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 ==&gt; auto */</span></td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_ldmHashLog, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_ldmHashLog,value)) { {<br>}; if (0) { _force_has_format_string("Param out of bounds"); }<br>; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">        CCtxParams-&gt;ldmParams.hashLog = value;</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;ldmParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmMinMatch :</td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 ==&gt; default */</span></td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_ldmMinMatch, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_ldmMinMatch,value)) { {<br>}; if (0) { _force_has_format_string("Param out of bounds"); }<br>; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound); }<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">        CCtxParams-&gt;ldmParams.minMatchLength = value;</td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;ldmParams.minMatchLength;</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmBucketSizeLog :</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 ==&gt; default */</span></td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_ldmBucketSizeLog, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_ldmBucketSizeLog,value<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">        CCtxParams-&gt;ldmParams.bucketSizeLog = value;</td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;ldmParams.bucketSizeLog;</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashRateLog :</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(value &gt; ZSTD_WINDOWLOG_MAX - ZSTD_HASHLOG_MIN,<span class='macro_popup'>if (value &gt; ((int)(sizeof(size_t) == 4 ? 30 : 31)) - 6) { {<br>}; if (0) { _force_has_format_string("Param out of bounds!");<br> }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound)<br>; }</span></span></td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">                        <span class='macro'>parameter_outOfBound, <span class='string_literal'>"Param out of bounds!"</span>)<span class='macro_popup'>if (value &gt; ((int)(sizeof(size_t) == 4 ? 30 : 31)) - 6) { {<br>}; if (0) { _force_has_format_string("Param out of bounds!");<br> }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound)<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">        CCtxParams-&gt;ldmParams.hashRateLog = value;</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;ldmParams.hashRateLog;</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_targetCBlockSize<span class='macro_popup'>ZSTD_c_experimentalParam6</span></span> :</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">        <span class='keyword'>if</span> (value!=0)   <span class='comment'>/* 0 ==&gt; default */</span></td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_targetCBlockSize, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_experimentalParam6,value<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line">        CCtxParams-&gt;targetCBlockSize = value;</td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;targetCBlockSize;</td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_srcSizeHint<span class='macro_popup'>ZSTD_c_experimentalParam7</span></span> :</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">        <span class='keyword'>if</span> (value!=0)    <span class='comment'>/* 0 ==&gt; default */</span></td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">            <span class='macro'>BOUNDCHECK(ZSTD_c_srcSizeHint, value)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_experimentalParam7,value<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">        CCtxParams-&gt;srcSizeHint = value;</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">        <span class='keyword'>return</span> CCtxParams-&gt;srcSizeHint;</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">    <span class='keyword'>default</span>: <span class='macro'>RETURN_ERROR(parameter_unsupported, <span class='string_literal'>"unknown parameter"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("unknown parameter"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">size_t ZSTD_CCtx_getParameter(ZSTD_CCtx* cctx, ZSTD_cParameter param, <span class='keyword'>int</span>* value)</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">    <span class='keyword'>return</span> ZSTD_CCtxParams_getParameter(&amp;cctx-&gt;requestedParams, param, value);</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">size_t ZSTD_CCtxParams_getParameter(</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">        ZSTD_CCtx_params* CCtxParams, ZSTD_cParameter param, <span class='keyword'>int</span>* value)</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">    <span class='keyword'>switch</span>(param)</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_format<span class='macro_popup'>ZSTD_c_experimentalParam2</span></span> :</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">        *value = CCtxParams-&gt;format;</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_compressionLevel :</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">        *value = CCtxParams-&gt;compressionLevel;</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_windowLog :</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">        *value = (<span class='keyword'>int</span>)CCtxParams-&gt;cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_hashLog :</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">        *value = (<span class='keyword'>int</span>)CCtxParams-&gt;cParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_chainLog :</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">        *value = (<span class='keyword'>int</span>)CCtxParams-&gt;cParams.chainLog;</td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_searchLog :</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">        *value = CCtxParams-&gt;cParams.searchLog;</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_minMatch :</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">        *value = CCtxParams-&gt;cParams.minMatch;</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_targetLength :</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">        *value = CCtxParams-&gt;cParams.targetLength;</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_strategy :</td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">        *value = (<span class='keyword'>unsigned</span>)CCtxParams-&gt;cParams.strategy;</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_contentSizeFlag :</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">        *value = CCtxParams-&gt;fParams.contentSizeFlag;</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_checksumFlag :</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line">        *value = CCtxParams-&gt;fParams.checksumFlag;</td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_dictIDFlag :</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">        *value = !CCtxParams-&gt;fParams.noDictIDFlag;</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceMaxWindow<span class='macro_popup'>ZSTD_c_experimentalParam3</span></span> :</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">        *value = CCtxParams-&gt;forceWindow;</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_forceAttachDict<span class='macro_popup'>ZSTD_c_experimentalParam4</span></span> :</td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">        *value = CCtxParams-&gt;attachDictPref;</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_literalCompressionMode<span class='macro_popup'>ZSTD_c_experimentalParam5</span></span> :</td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">        *value = CCtxParams-&gt;literalCompressionMode;</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_nbWorkers :</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">        <span class='macro'>assert(CCtxParams-&gt;nbWorkers == 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">        *value = CCtxParams-&gt;nbWorkers;</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_jobSize :</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">        <span class='macro'>RETURN_ERROR(parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">        <span class='macro'>assert(CCtxParams-&gt;jobSize &lt;= INT_MAX)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">        *value = (<span class='keyword'>int</span>)CCtxParams-&gt;jobSize;</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_overlapLog :</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">        <span class='macro'>RETURN_ERROR(parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">        *value = CCtxParams-&gt;overlapLog;</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_rsyncable<span class='macro_popup'>ZSTD_c_experimentalParam1</span></span> :</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line"><span class='directive'>#ifndef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">        <span class='macro'>RETURN_ERROR(parameter_unsupported, <span class='string_literal'>"not compiled with multithreading"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("not compiled with multithreading"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">        *value = CCtxParams-&gt;rsyncable;</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_enableLongDistanceMatching :</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">        *value = CCtxParams-&gt;ldmParams.enableLdm;</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashLog :</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">        *value = CCtxParams-&gt;ldmParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmMinMatch :</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">        *value = CCtxParams-&gt;ldmParams.minMatchLength;</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmBucketSizeLog :</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">        *value = CCtxParams-&gt;ldmParams.bucketSizeLog;</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">    <span class='keyword'>case</span> ZSTD_c_ldmHashRateLog :</td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">        *value = CCtxParams-&gt;ldmParams.hashRateLog;</td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_targetCBlockSize<span class='macro_popup'>ZSTD_c_experimentalParam6</span></span> :</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line">        *value = (<span class='keyword'>int</span>)CCtxParams-&gt;targetCBlockSize;</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">    <span class='keyword'>case</span> <span class='macro'>ZSTD_c_srcSizeHint<span class='macro_popup'>ZSTD_c_experimentalParam7</span></span> :</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">        *value = (<span class='keyword'>int</span>)CCtxParams-&gt;srcSizeHint;</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">    <span class='keyword'>default</span>: <span class='macro'>RETURN_ERROR(parameter_unsupported, <span class='string_literal'>"unknown parameter"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("unknown parameter"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_unsupported<br>); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line"><span class='comment'>/** ZSTD_CCtx_setParametersUsingCCtxParams() :</span></td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line"> <span class='comment'>*  just applies `params` into `cctx`</span></td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line"> <span class='comment'>*  no action is performed, parameters are merely stored.</span></td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line"> <span class='comment'>*  If ZSTDMT is enabled, parameters are pushed to cctx-&gt;mtctx.</span></td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line"> <span class='comment'>*    This is possible even if a compression is ongoing.</span></td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line"> <span class='comment'>*    In which case, new parameters will be applied on the fly, starting with next compression job.</span></td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line">size_t ZSTD_CCtx_setParametersUsingCCtxParams(</td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">        ZSTD_CCtx* cctx, <span class='keyword'>const</span> ZSTD_CCtx_params* params)</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_CCtx_setParametersUsingCCtxParams"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;streamStage != zcss_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("The context is in the wrong stage!"); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line">                    <span class='string_literal'><span class='macro'>"The context is in the wrong stage!"</span>)<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("The context is in the wrong stage!"); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;cdict, stage_wrong,<span class='macro_popup'>if (cctx-&gt;cdict) { {}; if (0) { _force_has_format_string("Can't override parameters with cdict attached (some must "<br> "be inherited from the cdict)."); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">                    <span class='string_literal'><span class='macro'>"Can't override parameters with cdict attached (some must "<span class='macro_popup'>if (cctx-&gt;cdict) { {}; if (0) { _force_has_format_string("Can't override parameters with cdict attached (some must "<br> "be inherited from the cdict)."); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span></span></td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">                    <span class='string_literal'><span class='macro'>"be inherited from the cdict)."</span>)<span class='macro_popup'>if (cctx-&gt;cdict) { {}; if (0) { _force_has_format_string("Can't override parameters with cdict attached (some must "<br> "be inherited from the cdict)."); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">    cctx-&gt;requestedParams = *params;</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"><span class='macro'>ZSTDLIB_API<span class='macro_popup'>__attribute__ ((visibility ("default")))</span></span> size_t ZSTD_CCtx_setPledgedSrcSize(ZSTD_CCtx* cctx, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_CCtx_setPledgedSrcSize to %u bytes"</span>, (U32)pledgedSrcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;streamStage != zcss_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't set pledgedSrcSize when not in init stage."); }; {}; {<br>}; return ((size_t)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">                    <span class='string_literal'><span class='macro'>"Can't set pledgedSrcSize when not in init stage."</span>)<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't set pledgedSrcSize when not in init stage."); }; {}; {<br>}; return ((size_t)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">    cctx-&gt;pledgedSrcSizePlusOne = pledgedSrcSize+1;</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line"> <span class='comment'>* Initializes the local dict using the requested parameters.</span></td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line"> <span class='comment'>* NOTE: This does not use the pledged src size, because it may be used for more</span></td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line"> <span class='comment'>* than one compression.</span></td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_initLocalDict(ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">    ZSTD_localDict* <span class='keyword'>const</span> dl = &amp;cctx-&gt;localDict;</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line">    ZSTD_compressionParameters <span class='keyword'>const</span> cParams = ZSTD_getCParamsFromCCtxParams(</td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">            &amp;cctx-&gt;requestedParams, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, dl-&gt;dictSize);</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">    <span class='keyword'>if</span> (dl-&gt;dict == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">        <span class='comment'>/* No local dictionary. */</span></td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">        <span class='macro'>assert(dl-&gt;dictBuffer == NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">        <span class='macro'>assert(dl-&gt;cdict == NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">        <span class='macro'>assert(dl-&gt;dictSize == 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">    <span class='keyword'>if</span> (dl-&gt;cdict != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">        <span class='macro'>assert(cctx-&gt;cdict == dl-&gt;cdict)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">        <span class='comment'>/* Local dictionary already initialized. */</span></td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">    <span class='macro'>assert(dl-&gt;dictSize &gt; 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">    <span class='macro'>assert(cctx-&gt;cdict == NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">    <span class='macro'>assert(cctx-&gt;prefixDict.dict == NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">    dl-&gt;cdict = ZSTD_createCDict_advanced(</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">            dl-&gt;dict,</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">            dl-&gt;dictSize,</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">            ZSTD_dlm_byRef,</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">            dl-&gt;dictContentType,</td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">            cParams,</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line">            cctx-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(!dl-&gt;cdict, memory_allocation, <span class='string_literal'>"ZSTD_createCDict_advanced failed"</span>)<span class='macro_popup'>if (!dl-&gt;cdict) { {}; if (0) { _force_has_format_string("ZSTD_createCDict_advanced failed"<br>); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation);<br> }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">    cctx-&gt;cdict = dl-&gt;cdict;</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">size_t ZSTD_CCtx_loadDictionary_advanced(</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">        ZSTD_CCtx* cctx, <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">        ZSTD_dictLoadMethod_e dictLoadMethod, ZSTD_dictContentType_e dictContentType)</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;streamStage != zcss_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't load a dictionary when ctx is not in init stage."); }<br>; {}; {}; return ((size_t)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line">                    <span class='string_literal'><span class='macro'>"Can't load a dictionary when ctx is not in init stage."</span>)<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't load a dictionary when ctx is not in init stage."); }<br>; {}; {}; return ((size_t)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;staticSize, memory_allocation,<span class='macro_popup'>if (cctx-&gt;staticSize) { {}; if (0) { _force_has_format_string<br>("no malloc for static CCtx"); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">                    <span class='string_literal'><span class='macro'>"no malloc for static CCtx"</span>)<span class='macro_popup'>if (cctx-&gt;staticSize) { {}; if (0) { _force_has_format_string<br>("no malloc for static CCtx"); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_CCtx_loadDictionary_advanced (size: %u)"</span>, (U32)dictSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">    ZSTD_clearAllDicts(cctx);  <span class='comment'>/* in case one already exists */</span></td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line">    <span class='keyword'>if</span> (dict == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> || dictSize == 0)  <span class='comment'>/* no dictionary mode */</span></td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">    <span class='keyword'>if</span> (dictLoadMethod == ZSTD_dlm_byRef) {</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">        cctx-&gt;localDict.dict = dict;</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">        <span class='keyword'>void</span>* dictBuffer = ZSTD_malloc(dictSize, cctx-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(!dictBuffer, memory_allocation, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (!dictBuffer) { {}; if (0) { _force_has_format_string("NULL pointer!"<br>); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation);<br> }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">        memcpy(dictBuffer, dict, dictSize);</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">        cctx-&gt;localDict.dictBuffer = dictBuffer;</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">        cctx-&gt;localDict.dict = dictBuffer;</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">    cctx-&gt;localDict.dictSize = dictSize;</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">    cctx-&gt;localDict.dictContentType = dictContentType;</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line"><span class='macro'>ZSTDLIB_API<span class='macro_popup'>__attribute__ ((visibility ("default")))</span></span> size_t ZSTD_CCtx_loadDictionary_byReference(</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">      ZSTD_CCtx* cctx, <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">    <span class='keyword'>return</span> ZSTD_CCtx_loadDictionary_advanced(</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">            cctx, dict, dictSize, ZSTD_dlm_byRef, ZSTD_dct_auto);</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line"><span class='macro'>ZSTDLIB_API<span class='macro_popup'>__attribute__ ((visibility ("default")))</span></span> size_t ZSTD_CCtx_loadDictionary(ZSTD_CCtx* cctx, <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">    <span class='keyword'>return</span> ZSTD_CCtx_loadDictionary_advanced(</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">            cctx, dict, dictSize, ZSTD_dlm_byCopy, ZSTD_dct_auto);</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">size_t ZSTD_CCtx_refCDict(ZSTD_CCtx* cctx, <span class='keyword'>const</span> ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;streamStage != zcss_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't ref a dict when ctx not in init stage."); }; {}; {}; return<br> ((size_t)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">                    <span class='string_literal'><span class='macro'>"Can't ref a dict when ctx not in init stage."</span>)<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't ref a dict when ctx not in init stage."); }; {}; {}; return<br> ((size_t)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">    <span class='comment'>/* Free the existing local cdict (if any) to save memory. */</span></td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line">    ZSTD_clearAllDicts(cctx);</td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">    cctx-&gt;cdict = cdict;</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">size_t ZSTD_CCtx_refPrefix(ZSTD_CCtx* cctx, <span class='keyword'>const</span> <span class='keyword'>void</span>* prefix, size_t prefixSize)</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">    <span class='keyword'>return</span> ZSTD_CCtx_refPrefix_advanced(cctx, prefix, prefixSize, ZSTD_dct_rawContent);</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">size_t ZSTD_CCtx_refPrefix_advanced(</td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line">        ZSTD_CCtx* cctx, <span class='keyword'>const</span> <span class='keyword'>void</span>* prefix, size_t prefixSize, ZSTD_dictContentType_e dictContentType)</td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;streamStage != zcss_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't ref a prefix when ctx not in init stage."); }; {}; {}<br>; return ((size_t)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">                    <span class='string_literal'><span class='macro'>"Can't ref a prefix when ctx not in init stage."</span>)<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't ref a prefix when ctx not in init stage."); }; {}; {}<br>; return ((size_t)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">    ZSTD_clearAllDicts(cctx);</td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">    <span class='keyword'>if</span> (prefix != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> &amp;&amp; prefixSize &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line">        cctx-&gt;prefixDict.dict = prefix;</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">        cctx-&gt;prefixDict.dictSize = prefixSize;</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">        cctx-&gt;prefixDict.dictContentType = dictContentType;</td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line"><span class='comment'>/*! ZSTD_CCtx_reset() :</span></td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line"> <span class='comment'>*  Also dumps dictionary */</span></td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">size_t ZSTD_CCtx_reset(ZSTD_CCtx* cctx, ZSTD_ResetDirective reset)</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">    <span class='keyword'>if</span> ( (reset == ZSTD_reset_session_only)</td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">      || (reset == ZSTD_reset_session_and_parameters) ) {</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">        cctx-&gt;streamStage = zcss_init;</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">        cctx-&gt;pledgedSrcSizePlusOne = 0;</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">    <span class='keyword'>if</span> ( (reset == ZSTD_reset_parameters)</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">      || (reset == ZSTD_reset_session_and_parameters) ) {</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(cctx-&gt;streamStage != zcss_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't reset parameters only when not in init stage."); }; {<br>}; {}; return ((size_t)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line">                        <span class='string_literal'><span class='macro'>"Can't reset parameters only when not in init stage."</span>)<span class='macro_popup'>if (cctx-&gt;streamStage != zcss_init) { {}; if (0) { _force_has_format_string<br>("Can't reset parameters only when not in init stage."); }; {<br>}; {}; return ((size_t)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">        ZSTD_clearAllDicts(cctx);</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">        <span class='keyword'>return</span> ZSTD_CCtxParams_reset(&amp;cctx-&gt;requestedParams);</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line"><span class='comment'>/** ZSTD_checkCParams() :</span></td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">    <span class='comment'>control CParam values remain within authorized range.</span></td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">    <span class='comment'>@return : 0, or an error code if one value is beyond authorized range */</span></td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">size_t ZSTD_checkCParams(ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_windowLog, (<span class='keyword'>int</span>)cParams.windowLog)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_windowLog,(int)cParams<br>.windowLog)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_chainLog,  (<span class='keyword'>int</span>)cParams.chainLog)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_chainLog,(int)cParams.<br>chainLog)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_hashLog,   (<span class='keyword'>int</span>)cParams.hashLog)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_hashLog,(int)cParams.hashLog<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_searchLog, (<span class='keyword'>int</span>)cParams.searchLog)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_searchLog,(int)cParams<br>.searchLog)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_minMatch,  (<span class='keyword'>int</span>)cParams.minMatch)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_minMatch,(int)cParams.<br>minMatch)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_targetLength,(<span class='keyword'>int</span>)cParams.targetLength)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_targetLength,(int)cParams<br>.targetLength)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">    <span class='macro'>BOUNDCHECK(ZSTD_c_strategy,  cParams.strategy)<span class='macro_popup'>{ if (!ZSTD_cParam_withinBounds(ZSTD_c_strategy,cParams.strategy<br>)) { {}; if (0) { _force_has_format_string("Param out of bounds"<br>); }; {}; {}; return ((size_t)-ZSTD_error_parameter_outOfBound<br>); }; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line"><span class='comment'>/** ZSTD_clampCParams() :</span></td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line"> <span class='comment'>*  make CParam values within valid range.</span></td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line"> <span class='comment'>*  @return : valid CParams */</span></td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line"><span class='keyword'>static</span> ZSTD_compressionParameters</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">ZSTD_clampCParams(ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line"><span class='directive'>#   define <span class='macro'>CLAMP_TYPE(cParam, val, type)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(cParam); if<br> ((int)val&lt;bounds.lowerBound) val=(type)bounds.lowerBound;<br> else if ((int)val&gt;bounds.upperBound) val=(type)bounds.upperBound<br>; }</span></span> {                                \</span></td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">        <span class='directive'>ZSTD_bounds const bounds = ZSTD_cParam_getBounds(cParam);         \</span></td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">        <span class='directive'>if ((int)val&lt;bounds.lowerBound) val=(type)bounds.lowerBound;      \</span></td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">        <span class='directive'>else if ((int)val&gt;bounds.upperBound) val=(type)bounds.upperBound; \</span></td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">    <span class='directive'>}</span></td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line"><span class='directive'>#   define <span class='macro'>CLAMP(cParam, val)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(cParam); if<br> ((int)val&lt;bounds.lowerBound) val=(unsigned)bounds.lowerBound<br>; else if ((int)val&gt;bounds.upperBound) val=(unsigned)bounds<br>.upperBound; }</span></span> <span class='macro'>CLAMP_TYPE(cParam, val, unsigned)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(cParam); if<br> ((int)val&lt;bounds.lowerBound) val=(unsigned)bounds.lowerBound<br>; else if ((int)val&gt;bounds.upperBound) val=(unsigned)bounds<br>.upperBound; }</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">    <span class='macro'>CLAMP(ZSTD_c_windowLog, cParams.windowLog)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_windowLog<br>); if ((int)cParams.windowLog&lt;bounds.lowerBound) cParams.windowLog<br>=(unsigned)bounds.lowerBound; else if ((int)cParams.windowLog<br>&gt;bounds.upperBound) cParams.windowLog=(unsigned)bounds.upperBound<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">    <span class='macro'>CLAMP(ZSTD_c_chainLog,  cParams.chainLog)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_chainLog<br>); if ((int)cParams.chainLog&lt;bounds.lowerBound) cParams.chainLog<br>=(unsigned)bounds.lowerBound; else if ((int)cParams.chainLog&gt;<br>bounds.upperBound) cParams.chainLog=(unsigned)bounds.upperBound<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">    <span class='macro'>CLAMP(ZSTD_c_hashLog,   cParams.hashLog)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_hashLog<br>); if ((int)cParams.hashLog&lt;bounds.lowerBound) cParams.hashLog<br>=(unsigned)bounds.lowerBound; else if ((int)cParams.hashLog&gt;<br>bounds.upperBound) cParams.hashLog=(unsigned)bounds.upperBound<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">    <span class='macro'>CLAMP(ZSTD_c_searchLog, cParams.searchLog)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_searchLog<br>); if ((int)cParams.searchLog&lt;bounds.lowerBound) cParams.searchLog<br>=(unsigned)bounds.lowerBound; else if ((int)cParams.searchLog<br>&gt;bounds.upperBound) cParams.searchLog=(unsigned)bounds.upperBound<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">    <span class='macro'>CLAMP(ZSTD_c_minMatch,  cParams.minMatch)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_minMatch<br>); if ((int)cParams.minMatch&lt;bounds.lowerBound) cParams.minMatch<br>=(unsigned)bounds.lowerBound; else if ((int)cParams.minMatch&gt;<br>bounds.upperBound) cParams.minMatch=(unsigned)bounds.upperBound<br>; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">    <span class='macro'>CLAMP(ZSTD_c_targetLength,cParams.targetLength)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_targetLength<br>); if ((int)cParams.targetLength&lt;bounds.lowerBound) cParams<br>.targetLength=(unsigned)bounds.lowerBound; else if ((int)cParams<br>.targetLength&gt;bounds.upperBound) cParams.targetLength=(unsigned<br>)bounds.upperBound; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">    <span class='macro'>CLAMP_TYPE(ZSTD_c_strategy,cParams.strategy, ZSTD_strategy)<span class='macro_popup'>{ ZSTD_bounds const bounds = ZSTD_cParam_getBounds(ZSTD_c_strategy<br>); if ((int)cParams.strategy&lt;bounds.lowerBound) cParams.strategy<br>=(ZSTD_strategy)bounds.lowerBound; else if ((int)cParams.strategy<br>&gt;bounds.upperBound) cParams.strategy=(ZSTD_strategy)bounds<br>.upperBound; }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">    <span class='keyword'>return</span> cParams;</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line"><span class='comment'>/** ZSTD_cycleLog() :</span></td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line"> <span class='comment'>*  condition for correct operation : hashLog &gt; 1 */</span></td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">U32 ZSTD_cycleLog(U32 hashLog, ZSTD_strategy strat)</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">    U32 <span class='keyword'>const</span> btScale = ((U32)strat &gt;= (U32)ZSTD_btlazy2);</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">    <span class='keyword'>return</span> hashLog - btScale;</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line"><span class='comment'>/** ZSTD_adjustCParams_internal() :</span></td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line"> <span class='comment'>*  optimize `cPar` for a specified input (`srcSize` and `dictSize`).</span></td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line"> <span class='comment'>*  mostly downsize to reduce memory consumption and initialization latency.</span></td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line"> <span class='comment'>* `srcSize` can be ZSTD_CONTENTSIZE_UNKNOWN when not known.</span></td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line"> <span class='comment'>*  note : `srcSize==0` means 0!</span></td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line"> <span class='comment'>*  condition : cPar is presumed validated (can be checked using ZSTD_checkCParams()). */</span></td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line"><span class='keyword'>static</span> ZSTD_compressionParameters</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line">ZSTD_adjustCParams_internal(ZSTD_compressionParameters cPar,</td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">                            <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSize,</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">                            size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> U64 minSrcSize = 513; <span class='comment'>/* (1&lt;&lt;9) + 1 */</span></td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> U64 maxWindowResize = 1ULL &lt;&lt; (<span class='macro'>ZSTD_WINDOWLOG_MAX<span class='macro_popup'>((int)(sizeof(size_t) == 4 ? 30 : 31))</span></span>-1);</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line">    <span class='macro'>assert(ZSTD_checkCParams(cPar)==0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">    <span class='keyword'>if</span> (dictSize &amp;&amp; srcSize == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">        srcSize = minSrcSize;</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">    <span class='comment'>/* resize windowLog if input is small enough, to use less memory */</span></td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">    <span class='keyword'>if</span> ( (srcSize &lt; maxWindowResize)</td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">      &amp;&amp; (dictSize &lt; maxWindowResize) )  {</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">        U32 <span class='keyword'>const</span> tSize = (U32)(srcSize + dictSize);</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">        <span class='keyword'>static</span> U32 <span class='keyword'>const</span> hashSizeMin = 1 &lt;&lt; <span class='macro'>ZSTD_HASHLOG_MIN<span class='macro_popup'>6</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">        U32 <span class='keyword'>const</span> srcLog = (tSize &lt; hashSizeMin) ? <span class='macro'>ZSTD_HASHLOG_MIN<span class='macro_popup'>6</span></span> :</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">                            ZSTD_highbit32(tSize-1) + 1;</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">        <span class='keyword'>if</span> (cPar.windowLog &gt; srcLog) cPar.windowLog = srcLog;</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">    <span class='keyword'>if</span> (cPar.hashLog &gt; cPar.windowLog+1) cPar.hashLog = cPar.windowLog+1;</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">    {   U32 <span class='keyword'>const</span> cycleLog = ZSTD_cycleLog(cPar.chainLog, cPar.strategy);</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">        <span class='keyword'>if</span> (cycleLog &gt; cPar.windowLog)</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">            cPar.chainLog -= (cycleLog - cPar.windowLog);</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">    <span class='keyword'>if</span> (cPar.windowLog &lt; <span class='macro'>ZSTD_WINDOWLOG_ABSOLUTEMIN<span class='macro_popup'>10</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">        cPar.windowLog = <span class='macro'>ZSTD_WINDOWLOG_ABSOLUTEMIN<span class='macro_popup'>10</span></span>;  <span class='comment'>/* minimum wlog required for valid frame header */</span></td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">    <span class='keyword'>return</span> cPar;</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">ZSTD_compressionParameters</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">ZSTD_adjustCParams(ZSTD_compressionParameters cPar,</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">                   <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSize,</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">                   size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">    cPar = ZSTD_clampCParams(cPar);   <span class='comment'>/* resulting cPar is necessarily valid (all parameters within range) */</span></td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">    <span class='keyword'>if</span> (srcSize == 0) srcSize = <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">    <span class='keyword'>return</span> ZSTD_adjustCParams_internal(cPar, srcSize, dictSize);</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line"><span class='keyword'>static</span> ZSTD_compressionParameters ZSTD_getCParams_internal(<span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSizeHint, size_t dictSize);</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line"><span class='keyword'>static</span> ZSTD_parameters ZSTD_getParams_internal(<span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSizeHint, size_t dictSize);</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">ZSTD_compressionParameters ZSTD_getCParamsFromCCtxParams(</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">        <span class='keyword'>const</span> ZSTD_CCtx_params* CCtxParams, U64 srcSizeHint, size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">    ZSTD_compressionParameters cParams;</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">    <span class='keyword'>if</span> (srcSizeHint == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span> &amp;&amp; CCtxParams-&gt;srcSizeHint &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">      srcSizeHint = CCtxParams-&gt;srcSizeHint;</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">    cParams = ZSTD_getCParams_internal(CCtxParams-&gt;compressionLevel, srcSizeHint, dictSize);</td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;ldmParams.enableLdm) cParams.windowLog = <span class='macro'>ZSTD_LDM_DEFAULT_WINDOW_LOG<span class='macro_popup'>27</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.windowLog) cParams.windowLog = CCtxParams-&gt;cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.hashLog) cParams.hashLog = CCtxParams-&gt;cParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.chainLog) cParams.chainLog = CCtxParams-&gt;cParams.chainLog;</td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.searchLog) cParams.searchLog = CCtxParams-&gt;cParams.searchLog;</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.minMatch) cParams.minMatch = CCtxParams-&gt;cParams.minMatch;</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.targetLength) cParams.targetLength = CCtxParams-&gt;cParams.targetLength;</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">    <span class='keyword'>if</span> (CCtxParams-&gt;cParams.strategy) cParams.strategy = CCtxParams-&gt;cParams.strategy;</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">    <span class='macro'>assert(!ZSTD_checkCParams(cParams))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">    <span class='comment'>/* srcSizeHint == 0 means 0 */</span></td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">    <span class='keyword'>return</span> ZSTD_adjustCParams_internal(cParams, srcSizeHint, dictSize);</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line"><span class='keyword'>static</span> size_t</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">ZSTD_sizeof_matchState(<span class='keyword'>const</span> ZSTD_compressionParameters* <span class='keyword'>const</span> cParams,</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">                       <span class='keyword'>const</span> U32 forCCtx)</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">    size_t <span class='keyword'>const</span> chainSize = (cParams-&gt;strategy == ZSTD_fast) ? 0 : ((size_t)1 &lt;&lt; cParams-&gt;chainLog);</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">    size_t <span class='keyword'>const</span> hSize = ((size_t)1) &lt;&lt; cParams-&gt;hashLog;</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">    U32    <span class='keyword'>const</span> hashLog3 = (forCCtx &amp;&amp; cParams-&gt;minMatch==3) ? <span class='macro'>MIN(ZSTD_HASHLOG3_MAX, cParams-&gt;windowLog)<span class='macro_popup'>((17)&lt;(cParams-&gt;windowLog) ? (17) : (cParams-&gt;windowLog<br>))</span></span> : 0;</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">    size_t <span class='keyword'>const</span> h3Size = hashLog3 ? ((size_t)1) &lt;&lt; hashLog3 : 0;</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">    <span class='comment'>/* We don't use ZSTD_cwksp_alloc_size() here because the tables aren't</span></td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">     <span class='comment'>* surrounded by redzones in ASAN. */</span></td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">    size_t <span class='keyword'>const</span> tableSpace = chainSize * <span class='keyword'>sizeof</span>(U32)</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">                            + hSize * <span class='keyword'>sizeof</span>(U32)</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">                            + h3Size * <span class='keyword'>sizeof</span>(U32);</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">    size_t <span class='keyword'>const</span> optPotentialSpace =</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">        ZSTD_cwksp_alloc_size((<span class='macro'>MaxML<span class='macro_popup'>52</span></span>+1) * <span class='keyword'>sizeof</span>(U32))</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">      + ZSTD_cwksp_alloc_size((<span class='macro'>MaxLL<span class='macro_popup'>35</span></span>+1) * <span class='keyword'>sizeof</span>(U32))</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line">      + ZSTD_cwksp_alloc_size((<span class='macro'>MaxOff<span class='macro_popup'>31</span></span>+1) * <span class='keyword'>sizeof</span>(U32))</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">      + ZSTD_cwksp_alloc_size((1&lt;&lt;<span class='macro'>Litbits<span class='macro_popup'>8</span></span>) * <span class='keyword'>sizeof</span>(U32))</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line">      + ZSTD_cwksp_alloc_size((<span class='macro'>ZSTD_OPT_NUM<span class='macro_popup'>(1&lt;&lt;12)</span></span>+1) * <span class='keyword'>sizeof</span>(ZSTD_match_t))</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">      + ZSTD_cwksp_alloc_size((<span class='macro'>ZSTD_OPT_NUM<span class='macro_popup'>(1&lt;&lt;12)</span></span>+1) * <span class='keyword'>sizeof</span>(ZSTD_optimal_t));</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">    size_t <span class='keyword'>const</span> optSpace = (forCCtx &amp;&amp; (cParams-&gt;strategy &gt;= ZSTD_btopt))</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">                                ? optPotentialSpace</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">                                : 0;</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"chainSize: %u - hSize: %u - h3Size: %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">                <span class='macro'>(U32)chainSize, (U32)hSize, (U32)h3Size)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">    <span class='keyword'>return</span> tableSpace + optSpace;</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">size_t ZSTD_estimateCCtxSize_usingCCtxParams(<span class='keyword'>const</span> ZSTD_CCtx_params* params)</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(params-&gt;nbWorkers &gt; 0, GENERIC, <span class='string_literal'>"Estimate CCtx size is supported for single-threaded compression only."</span>)<span class='macro_popup'>if (params-&gt;nbWorkers &gt; 0) { {}; if (0) { _force_has_format_string<br>("Estimate CCtx size is supported for single-threaded compression only."<br>); }; {}; {}; return ((size_t)-ZSTD_error_GENERIC); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">    {   ZSTD_compressionParameters <span class='keyword'>const</span> cParams =</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">                ZSTD_getCParamsFromCCtxParams(params, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">        size_t <span class='keyword'>const</span> blockSize = <span class='macro'>MIN(ZSTD_BLOCKSIZE_MAX, (size_t)1 &lt;&lt; cParams.windowLog)<span class='macro_popup'>(((1&lt;&lt;17))&lt;((size_t)1 &lt;&lt; cParams.windowLog) ? (<br>(1&lt;&lt;17)) : ((size_t)1 &lt;&lt; cParams.windowLog))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">        U32    <span class='keyword'>const</span> divider = (cParams.minMatch==3) ? 3 : 4;</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">        size_t <span class='keyword'>const</span> maxNbSeq = blockSize / divider;</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">        size_t <span class='keyword'>const</span> tokenSpace = ZSTD_cwksp_alloc_size(<span class='macro'>WILDCOPY_OVERLENGTH<span class='macro_popup'>32</span></span> + blockSize)</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">                                + ZSTD_cwksp_alloc_size(maxNbSeq * <span class='keyword'>sizeof</span>(seqDef))</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">                                + 3 * ZSTD_cwksp_alloc_size(maxNbSeq * <span class='keyword'>sizeof</span>(BYTE));</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line">        size_t <span class='keyword'>const</span> entropySpace = ZSTD_cwksp_alloc_size(<span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">        size_t <span class='keyword'>const</span> blockStateSpace = 2 * ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t));</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">        size_t <span class='keyword'>const</span> matchStateSize = ZSTD_sizeof_matchState(&amp;cParams, <span class='comment'>/* forCCtx */</span> 1);</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">        size_t <span class='keyword'>const</span> ldmSpace = ZSTD_ldm_getTableSize(params-&gt;ldmParams);</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line">        size_t <span class='keyword'>const</span> ldmSeqSpace = ZSTD_cwksp_alloc_size(ZSTD_ldm_getMaxNbSeq(params-&gt;ldmParams, blockSize) * <span class='keyword'>sizeof</span>(rawSeq));</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">        <span class='comment'>/* estimateCCtxSize is for one-shot compression. So no buffers should</span></td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line">         <span class='comment'>* be needed. However, we still allocate two 0-sized buffers, which can</span></td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">         <span class='comment'>* take space under ASAN. */</span></td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">        size_t <span class='keyword'>const</span> bufferSpace = ZSTD_cwksp_alloc_size(0)</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">                                 + ZSTD_cwksp_alloc_size(0);</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">        size_t <span class='keyword'>const</span> cctxSpace = ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_CCtx));</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">        size_t <span class='keyword'>const</span> neededSpace =</td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">            cctxSpace +</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">            entropySpace +</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">            blockStateSpace +</td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">            ldmSpace +</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">            ldmSeqSpace +</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">            matchStateSize +</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">            tokenSpace +</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">            bufferSpace;</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">        <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"estimate workspace : %u"</span>, (U32)neededSpace)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">        <span class='keyword'>return</span> neededSpace;</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">size_t ZSTD_estimateCCtxSize_usingCParams(ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">    ZSTD_CCtx_params <span class='keyword'>const</span> params = ZSTD_makeCCtxParamsFromCParams(cParams);</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line">    <span class='keyword'>return</span> ZSTD_estimateCCtxSize_usingCCtxParams(&amp;params);</td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_estimateCCtxSize_internal(<span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">    ZSTD_compressionParameters <span class='keyword'>const</span> cParams = ZSTD_getCParams_internal(compressionLevel, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">    <span class='keyword'>return</span> ZSTD_estimateCCtxSize_usingCParams(cParams);</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">size_t ZSTD_estimateCCtxSize(<span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">    <span class='keyword'>int</span> level;</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">    size_t memBudget = 0;</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">    <span class='keyword'>for</span> (level=<span class='macro'>MIN(compressionLevel, 1)<span class='macro_popup'>((compressionLevel)&lt;(1) ? (compressionLevel) : (1))</span></span>; level&lt;=compressionLevel; level++) {</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">        size_t <span class='keyword'>const</span> newMB = ZSTD_estimateCCtxSize_internal(level);</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">        <span class='keyword'>if</span> (newMB &gt; memBudget) memBudget = newMB;</td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">    <span class='keyword'>return</span> memBudget;</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">size_t ZSTD_estimateCStreamSize_usingCCtxParams(<span class='keyword'>const</span> ZSTD_CCtx_params* params)</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(params-&gt;nbWorkers &gt; 0, GENERIC, <span class='string_literal'>"Estimate CCtx size is supported for single-threaded compression only."</span>)<span class='macro_popup'>if (params-&gt;nbWorkers &gt; 0) { {}; if (0) { _force_has_format_string<br>("Estimate CCtx size is supported for single-threaded compression only."<br>); }; {}; {}; return ((size_t)-ZSTD_error_GENERIC); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">    {   ZSTD_compressionParameters <span class='keyword'>const</span> cParams =</td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">                ZSTD_getCParamsFromCCtxParams(params, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">        size_t <span class='keyword'>const</span> CCtxSize = ZSTD_estimateCCtxSize_usingCCtxParams(params);</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">        size_t <span class='keyword'>const</span> blockSize = <span class='macro'>MIN(ZSTD_BLOCKSIZE_MAX, (size_t)1 &lt;&lt; cParams.windowLog)<span class='macro_popup'>(((1&lt;&lt;17))&lt;((size_t)1 &lt;&lt; cParams.windowLog) ? (<br>(1&lt;&lt;17)) : ((size_t)1 &lt;&lt; cParams.windowLog))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">        size_t <span class='keyword'>const</span> inBuffSize = ((size_t)1 &lt;&lt; cParams.windowLog) + blockSize;</td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">        size_t <span class='keyword'>const</span> outBuffSize = ZSTD_compressBound(blockSize) + 1;</td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">        size_t <span class='keyword'>const</span> streamingSize = ZSTD_cwksp_alloc_size(inBuffSize)</td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">                                   + ZSTD_cwksp_alloc_size(outBuffSize);</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">        <span class='keyword'>return</span> CCtxSize + streamingSize;</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">size_t ZSTD_estimateCStreamSize_usingCParams(ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">    ZSTD_CCtx_params <span class='keyword'>const</span> params = ZSTD_makeCCtxParamsFromCParams(cParams);</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">    <span class='keyword'>return</span> ZSTD_estimateCStreamSize_usingCCtxParams(&amp;params);</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_estimateCStreamSize_internal(<span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">    ZSTD_compressionParameters <span class='keyword'>const</span> cParams = ZSTD_getCParams_internal(compressionLevel, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">    <span class='keyword'>return</span> ZSTD_estimateCStreamSize_usingCParams(cParams);</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">size_t ZSTD_estimateCStreamSize(<span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">    <span class='keyword'>int</span> level;</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">    size_t memBudget = 0;</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line">    <span class='keyword'>for</span> (level=<span class='macro'>MIN(compressionLevel, 1)<span class='macro_popup'>((compressionLevel)&lt;(1) ? (compressionLevel) : (1))</span></span>; level&lt;=compressionLevel; level++) {</td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">        size_t <span class='keyword'>const</span> newMB = ZSTD_estimateCStreamSize_internal(level);</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">        <span class='keyword'>if</span> (newMB &gt; memBudget) memBudget = newMB;</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">    <span class='keyword'>return</span> memBudget;</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line"><span class='comment'>/* ZSTD_getFrameProgression():</span></td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line"> <span class='comment'>* tells how much data has been consumed (input) and produced (output) for current frame.</span></td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line"> <span class='comment'>* able to count progression inside worker threads (non-blocking mode).</span></td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">ZSTD_frameProgression ZSTD_getFrameProgression(<span class='keyword'>const</span> ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.nbWorkers &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">        <span class='keyword'>return</span> ZSTDMT_getFrameProgression(cctx-&gt;mtctx);</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">    {   ZSTD_frameProgression fp;</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">        size_t <span class='keyword'>const</span> buffered = (cctx-&gt;inBuff == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) ? 0 :</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">                                cctx-&gt;inBuffPos - cctx-&gt;inToCompress;</td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">        <span class='keyword'>if</span> (buffered) <span class='macro'>assert(cctx-&gt;inBuffPos &gt;= cctx-&gt;inToCompress)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">        <span class='macro'>assert(buffered &lt;= ZSTD_BLOCKSIZE_MAX)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">        fp.ingested = cctx-&gt;consumedSrcSize + buffered;</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">        fp.consumed = cctx-&gt;consumedSrcSize;</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">        fp.produced = cctx-&gt;producedCSize;</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">        fp.flushed  = cctx-&gt;producedCSize;   <span class='comment'>/* simplified; some data might still be left within streaming output buffer */</span></td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">        fp.currentJobID = 0;</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">        fp.nbActiveWorkers = 0;</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">        <span class='keyword'>return</span> fp;</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">}   }</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line"><span class='comment'>/*! ZSTD_toFlushNow()</span></td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line"> <span class='comment'>*  Only useful for multithreading scenarios currently (nbWorkers &gt;= 1).</span></td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">size_t ZSTD_toFlushNow(ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.nbWorkers &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">        <span class='keyword'>return</span> ZSTDMT_toFlushNow(cctx-&gt;mtctx);</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">    (<span class='keyword'>void</span>)cctx;</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">    <span class='keyword'>return</span> 0;   <span class='comment'>/* over-simplification; could also check if context is currently running in streaming mode, and in which case, report how many bytes are left to be flushed within output buffer */</span></td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_assertEqualCParams(ZSTD_compressionParameters cParams1,</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">                                    ZSTD_compressionParameters cParams2)</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">    (<span class='keyword'>void</span>)cParams1;</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">    (<span class='keyword'>void</span>)cParams2;</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">    <span class='macro'>assert(cParams1.windowLog    == cParams2.windowLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">    <span class='macro'>assert(cParams1.chainLog     == cParams2.chainLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">    <span class='macro'>assert(cParams1.hashLog      == cParams2.hashLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">    <span class='macro'>assert(cParams1.searchLog    == cParams2.searchLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">    <span class='macro'>assert(cParams1.minMatch     == cParams2.minMatch)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">    <span class='macro'>assert(cParams1.targetLength == cParams2.targetLength)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">    <span class='macro'>assert(cParams1.strategy     == cParams2.strategy)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line"><span class='keyword'>void</span> ZSTD_reset_compressedBlockState(ZSTD_compressedBlockState_t* bs)</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">    <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>ZSTD_REP_NUM<span class='macro_popup'>3</span></span>; ++i)</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">        bs-&gt;rep[i] = repStartValue[i];</td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">    bs-&gt;entropy.huf.repeatMode = HUF_repeat_none;</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">    bs-&gt;entropy.fse.offcode_repeatMode = FSE_repeat_none;</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">    bs-&gt;entropy.fse.matchlength_repeatMode = FSE_repeat_none;</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">    bs-&gt;entropy.fse.litlength_repeatMode = FSE_repeat_none;</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line"><span class='comment'>/*! ZSTD_invalidateMatchState()</span></td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line"> <span class='comment'>*  Invalidate all the matches in the match finder tables.</span></td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line"> <span class='comment'>*  Requires nextSrc and base to be set (can be NULL).</span></td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_invalidateMatchState(ZSTD_matchState_t* ms)</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">    ZSTD_window_clear(&amp;ms-&gt;window);</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">    ms-&gt;nextToUpdate = ms-&gt;window.dictLimit;</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">    ms-&gt;loadedDictEnd = 0;</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line">    ms-&gt;opt.litLengthSum = 0;  <span class='comment'>/* force reset of btopt stats */</span></td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line">    ms-&gt;dictMatchState = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line"> <span class='comment'>* Indicates whether this compression proceeds directly from user-provided</span></td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line"> <span class='comment'>* source buffer to user-provided destination buffer (ZSTDb_not_buffered), or</span></td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line"> <span class='comment'>* whether the context needs to buffer the input/output (ZSTDb_buffered).</span></td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span> {</td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">    ZSTDb_not_buffered,</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">    ZSTDb_buffered</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">} ZSTD_buffered_policy_e;</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line"> <span class='comment'>* Controls, for this matchState reset, whether the tables need to be cleared /</span></td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line"> <span class='comment'>* prepared for the coming compression (ZSTDcrp_makeClean), or whether the</span></td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line"> <span class='comment'>* tables can be left unclean (ZSTDcrp_leaveDirty), because we know that a</span></td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line"> <span class='comment'>* subsequent operation will overwrite the table space anyways (e.g., copying</span></td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line"> <span class='comment'>* the matchState contents in from a CDict).</span></td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span> {</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">    ZSTDcrp_makeClean,</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">    ZSTDcrp_leaveDirty</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">} ZSTD_compResetPolicy_e;</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line"> <span class='comment'>* Controls, for this matchState reset, whether indexing can continue where it</span></td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line"> <span class='comment'>* left off (ZSTDirp_continue), or whether it needs to be restarted from zero</span></td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line"> <span class='comment'>* (ZSTDirp_reset).</span></td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span> {</td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">    ZSTDirp_continue,</td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">    ZSTDirp_reset</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">} ZSTD_indexResetPolicy_e;</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span> {</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">    ZSTD_resetTarget_CDict,</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">    ZSTD_resetTarget_CCtx</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">} ZSTD_resetTarget_e;</td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line"><span class='keyword'>static</span> size_t</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">ZSTD_reset_matchState(ZSTD_matchState_t* ms,</td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">                      ZSTD_cwksp* ws,</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">                <span class='keyword'>const</span> ZSTD_compressionParameters* cParams,</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">                <span class='keyword'>const</span> ZSTD_compResetPolicy_e crp,</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">                <span class='keyword'>const</span> ZSTD_indexResetPolicy_e forceResetIndex,</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">                <span class='keyword'>const</span> ZSTD_resetTarget_e forWho)</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">    size_t <span class='keyword'>const</span> chainSize = (cParams-&gt;strategy == ZSTD_fast) ? 0 : ((size_t)1 &lt;&lt; cParams-&gt;chainLog);</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">    size_t <span class='keyword'>const</span> hSize = ((size_t)1) &lt;&lt; cParams-&gt;hashLog;</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">    U32    <span class='keyword'>const</span> hashLog3 = ((forWho == ZSTD_resetTarget_CCtx) &amp;&amp; cParams-&gt;minMatch==3) ? <span class='macro'>MIN(ZSTD_HASHLOG3_MAX, cParams-&gt;windowLog)<span class='macro_popup'>((17)&lt;(cParams-&gt;windowLog) ? (17) : (cParams-&gt;windowLog<br>))</span></span> : 0;</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">    size_t <span class='keyword'>const</span> h3Size = hashLog3 ? ((size_t)1) &lt;&lt; hashLog3 : 0;</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"reset indices : %u"</span>, forceResetIndex == ZSTDirp_reset)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">    <span class='keyword'>if</span> (forceResetIndex == ZSTDirp_reset) {</td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">        ZSTD_window_init(&amp;ms-&gt;window);</td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">        ZSTD_cwksp_mark_tables_dirty(ws);</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">    ms-&gt;hashLog3 = hashLog3;</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line">    ZSTD_invalidateMatchState(ms);</td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line">    <span class='macro'>assert(!ZSTD_cwksp_reserve_failed(ws))<span class='macro_popup'>((void)0)</span></span>; <span class='comment'>/* check that allocation hasn't already failed */</span></td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line">    ZSTD_cwksp_clear_tables(ws);</td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"reserving table space"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line">    <span class='comment'>/* table Space */</span></td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">    ms-&gt;hashTable = (U32*)ZSTD_cwksp_reserve_table(ws, hSize * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">    ms-&gt;chainTable = (U32*)ZSTD_cwksp_reserve_table(ws, chainSize * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">    ms-&gt;hashTable3 = (U32*)ZSTD_cwksp_reserve_table(ws, h3Size * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(ZSTD_cwksp_reserve_failed(ws), memory_allocation,<span class='macro_popup'>if (ZSTD_cwksp_reserve_failed(ws)) { {}; if (0) { _force_has_format_string<br>("failed a workspace allocation in ZSTD_reset_matchState"); }<br>; {}; {}; return ((size_t)-ZSTD_error_memory_allocation); }</span></span></td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">                    <span class='string_literal'><span class='macro'>"failed a workspace allocation in ZSTD_reset_matchState"</span>)<span class='macro_popup'>if (ZSTD_cwksp_reserve_failed(ws)) { {}; if (0) { _force_has_format_string<br>("failed a workspace allocation in ZSTD_reset_matchState"); }<br>; {}; {}; return ((size_t)-ZSTD_error_memory_allocation); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"reset table : %u"</span>, crp!=ZSTDcrp_leaveDirty)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">    <span class='keyword'>if</span> (crp!=ZSTDcrp_leaveDirty) {</td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">        <span class='comment'>/* reset tables only */</span></td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">        ZSTD_cwksp_clean_tables(ws);</td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">    <span class='comment'>/* opt parser space */</span></td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">    <span class='keyword'>if</span> ((forWho == ZSTD_resetTarget_CCtx) &amp;&amp; (cParams-&gt;strategy &gt;= ZSTD_btopt)) {</td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"reserving optimal parser space"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">        ms-&gt;opt.litFreq = (<span class='keyword'>unsigned</span>*)ZSTD_cwksp_reserve_aligned(ws, (1&lt;&lt;<span class='macro'>Litbits<span class='macro_popup'>8</span></span>) * <span class='keyword'>sizeof</span>(<span class='keyword'>unsigned</span>));</td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">        ms-&gt;opt.litLengthFreq = (<span class='keyword'>unsigned</span>*)ZSTD_cwksp_reserve_aligned(ws, (<span class='macro'>MaxLL<span class='macro_popup'>35</span></span>+1) * <span class='keyword'>sizeof</span>(<span class='keyword'>unsigned</span>));</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">        ms-&gt;opt.matchLengthFreq = (<span class='keyword'>unsigned</span>*)ZSTD_cwksp_reserve_aligned(ws, (<span class='macro'>MaxML<span class='macro_popup'>52</span></span>+1) * <span class='keyword'>sizeof</span>(<span class='keyword'>unsigned</span>));</td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line">        ms-&gt;opt.offCodeFreq = (<span class='keyword'>unsigned</span>*)ZSTD_cwksp_reserve_aligned(ws, (<span class='macro'>MaxOff<span class='macro_popup'>31</span></span>+1) * <span class='keyword'>sizeof</span>(<span class='keyword'>unsigned</span>));</td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">        ms-&gt;opt.matchTable = (ZSTD_match_t*)ZSTD_cwksp_reserve_aligned(ws, (<span class='macro'>ZSTD_OPT_NUM<span class='macro_popup'>(1&lt;&lt;12)</span></span>+1) * <span class='keyword'>sizeof</span>(ZSTD_match_t));</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">        ms-&gt;opt.priceTable = (ZSTD_optimal_t*)ZSTD_cwksp_reserve_aligned(ws, (<span class='macro'>ZSTD_OPT_NUM<span class='macro_popup'>(1&lt;&lt;12)</span></span>+1) * <span class='keyword'>sizeof</span>(ZSTD_optimal_t));</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">    ms-&gt;cParams = *cParams;</td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(ZSTD_cwksp_reserve_failed(ws), memory_allocation,<span class='macro_popup'>if (ZSTD_cwksp_reserve_failed(ws)) { {}; if (0) { _force_has_format_string<br>("failed a workspace allocation in ZSTD_reset_matchState"); }<br>; {}; {}; return ((size_t)-ZSTD_error_memory_allocation); }</span></span></td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">                    <span class='string_literal'><span class='macro'>"failed a workspace allocation in ZSTD_reset_matchState"</span>)<span class='macro_popup'>if (ZSTD_cwksp_reserve_failed(ws)) { {}; if (0) { _force_has_format_string<br>("failed a workspace allocation in ZSTD_reset_matchState"); }<br>; {}; {}; return ((size_t)-ZSTD_error_memory_allocation); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line"><span class='comment'>/* ZSTD_indexTooCloseToMax() :</span></td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line"> <span class='comment'>* minor optimization : prefer memset() rather than reduceIndex()</span></td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line"> <span class='comment'>* which is measurably slow in some circumstances (reported for Visual Studio).</span></td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line"> <span class='comment'>* Works when re-using a context for a lot of smallish inputs :</span></td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line"> <span class='comment'>* if all inputs are smaller than ZSTD_INDEXOVERFLOW_MARGIN,</span></td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line"> <span class='comment'>* memset() will be triggered before reduceIndex().</span></td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line"><span class='directive'>#define <span class='macro'>ZSTD_INDEXOVERFLOW_MARGIN<span class='macro_popup'>(16 *(1 &lt;&lt;20))</span></span> (16 <span class='macro'>MB<span class='macro_popup'>*(1 &lt;&lt;20)</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ZSTD_indexTooCloseToMax(ZSTD_window_t w)</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">    <span class='keyword'>return</span> (size_t)(w.nextSrc - w.base) &gt; (<span class='macro'>ZSTD_CURRENT_MAX<span class='macro_popup'>((3U &lt;&lt; 29) + (1U &lt;&lt; ((int)(sizeof(size_t) == 4 ?<br> 30 : 31))))</span></span> - <span class='macro'>ZSTD_INDEXOVERFLOW_MARGIN<span class='macro_popup'>(16 *(1 &lt;&lt;20))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line"><span class='comment'>/*! ZSTD_resetCCtx_internal() :</span></td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">    <span class='comment'>note : `params` are assumed fully validated at this stage */</span></td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_resetCCtx_internal(ZSTD_CCtx* zc,</td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">                                      ZSTD_CCtx_params params,</td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line">                                      U64 <span class='keyword'>const</span> pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">                                      ZSTD_compResetPolicy_e <span class='keyword'>const</span> crp,</td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">                                      ZSTD_buffered_policy_e <span class='keyword'>const</span> zbuff)</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">    ZSTD_cwksp* <span class='keyword'>const</span> ws = &amp;zc-&gt;workspace;</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_resetCCtx_internal: pledgedSrcSize=%u, wlog=%u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">                <span class='macro'>(U32)pledgedSrcSize, params.cParams.windowLog)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line">    <span class='macro'>assert(!ZSTD_isError(ZSTD_checkCParams(params.cParams)))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">    zc-&gt;isFirstBlock = 1;</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">    <span class='keyword'>if</span> (params.ldmParams.enableLdm) {</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">        <span class='comment'>/* Adjust long distance matching parameters */</span></td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">        ZSTD_ldm_adjustParameters(&amp;params.ldmParams, &amp;params.cParams);</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">        <span class='macro'>assert(params.ldmParams.hashLog &gt;= params.ldmParams.bucketSizeLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">        <span class='macro'>assert(params.ldmParams.hashRateLog &lt; 32)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">        zc-&gt;ldmState.hashPower = ZSTD_rollingHash_primePower(params.ldmParams.minMatchLength);</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line">    {   size_t <span class='keyword'>const</span> windowSize = <span class='macro'>MAX(1, (size_t)MIN(((U64)1 &lt;&lt; params.cParams.windowLog), pledgedSrcSize))<span class='macro_popup'>((1)&gt;((size_t)((((U64)1 &lt;&lt; params.cParams.windowLog)<br>)&lt;(pledgedSrcSize) ? (((U64)1 &lt;&lt; params.cParams.windowLog<br>)) : (pledgedSrcSize))) ? (1) : ((size_t)((((U64)1 &lt;&lt; params<br>.cParams.windowLog))&lt;(pledgedSrcSize) ? (((U64)1 &lt;&lt; params<br>.cParams.windowLog)) : (pledgedSrcSize))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">        size_t <span class='keyword'>const</span> blockSize = <span class='macro'>MIN(ZSTD_BLOCKSIZE_MAX, windowSize)<span class='macro_popup'>(((1&lt;&lt;17))&lt;(windowSize) ? ((1&lt;&lt;17)) : (windowSize<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line">        U32    <span class='keyword'>const</span> divider = (params.cParams.minMatch==3) ? 3 : 4;</td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">        size_t <span class='keyword'>const</span> maxNbSeq = blockSize / divider;</td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">        size_t <span class='keyword'>const</span> tokenSpace = ZSTD_cwksp_alloc_size(<span class='macro'>WILDCOPY_OVERLENGTH<span class='macro_popup'>32</span></span> + blockSize)</td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line">                                + ZSTD_cwksp_alloc_size(maxNbSeq * <span class='keyword'>sizeof</span>(seqDef))</td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">                                + 3 * ZSTD_cwksp_alloc_size(maxNbSeq * <span class='keyword'>sizeof</span>(BYTE));</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">        size_t <span class='keyword'>const</span> buffOutSize = (zbuff==ZSTDb_buffered) ? ZSTD_compressBound(blockSize)+1 : 0;</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">        size_t <span class='keyword'>const</span> buffInSize = (zbuff==ZSTDb_buffered) ? windowSize + blockSize : 0;</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">        size_t <span class='keyword'>const</span> matchStateSize = ZSTD_sizeof_matchState(&amp;params.cParams, <span class='comment'>/* forCCtx */</span> 1);</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">        size_t <span class='keyword'>const</span> maxNbLdmSeq = ZSTD_ldm_getMaxNbSeq(params.ldmParams, blockSize);</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">        ZSTD_indexResetPolicy_e needsIndexReset = zc-&gt;initialized ? ZSTDirp_continue : ZSTDirp_reset;</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line">        <span class='keyword'>if</span> (ZSTD_indexTooCloseToMax(zc-&gt;blockState.matchState.window)) {</td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">            needsIndexReset = ZSTDirp_reset;</td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">        <span class='keyword'>if</span> (!zc-&gt;staticSize) ZSTD_cwksp_bump_oversized_duration(ws, 0);</td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">        <span class='comment'>/* Check if workspace is large enough, alloc a new one if needed */</span></td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">        {   size_t <span class='keyword'>const</span> cctxSpace = zc-&gt;staticSize ? ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_CCtx)) : 0;</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">            size_t <span class='keyword'>const</span> entropySpace = ZSTD_cwksp_alloc_size(<span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">            size_t <span class='keyword'>const</span> blockStateSpace = 2 * ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t));</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">            size_t <span class='keyword'>const</span> bufferSpace = ZSTD_cwksp_alloc_size(buffInSize) + ZSTD_cwksp_alloc_size(buffOutSize);</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">            size_t <span class='keyword'>const</span> ldmSpace = ZSTD_ldm_getTableSize(params.ldmParams);</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">            size_t <span class='keyword'>const</span> ldmSeqSpace = ZSTD_cwksp_alloc_size(maxNbLdmSeq * <span class='keyword'>sizeof</span>(rawSeq));</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">            size_t <span class='keyword'>const</span> neededSpace =</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line">                cctxSpace +</td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">                entropySpace +</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">                blockStateSpace +</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">                ldmSpace +</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">                ldmSeqSpace +</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">                matchStateSize +</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">                tokenSpace +</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">                bufferSpace;</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> workspaceTooSmall = ZSTD_cwksp_sizeof(ws) &lt; neededSpace;</td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> workspaceWasteful = ZSTD_cwksp_check_wasteful(ws, neededSpace);</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line">            <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"Need %zuKB workspace, including %zuKB for match state, and %zuKB for buffers"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line">                        <span class='macro'>neededSpace&gt;&gt;10, matchStateSize&gt;&gt;10, bufferSpace&gt;&gt;10)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line">            <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"windowSize: %zu - blockSize: %zu"</span>, windowSize, blockSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line">            <span class='keyword'>if</span> (workspaceTooSmall || workspaceWasteful) {</td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">                <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"Resize workspaceSize from %zuKB to %zuKB"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">                            <span class='macro'>ZSTD_cwksp_sizeof(ws) &gt;&gt; 10,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">                            <span class='macro'>neededSpace &gt;&gt; 10)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(zc-&gt;staticSize, memory_allocation, <span class='string_literal'>"static cctx : no resize"</span>)<span class='macro_popup'>if (zc-&gt;staticSize) { {}; if (0) { _force_has_format_string<br>("static cctx : no resize"); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">                needsIndexReset = ZSTDirp_reset;</td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">                ZSTD_cwksp_free(ws, zc-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">                <span class='macro'>FORWARD_IF_ERROR(ZSTD_cwksp_create(ws, neededSpace, zc-&gt;customMem), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_cwksp_create(ws, neededSpace<br>, zc-&gt;customMem)); if (ERR_isError(err_code)) { {}; if (0)<br> { _force_has_format_string(""); }; {}; {}; return err_code; }<br> } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">                <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"reserving object space"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">                <span class='comment'>/* Statically sized space.</span></td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">                 <span class='comment'>* entropyWorkspace never moves,</span></td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">                 <span class='comment'>* though prev/next block swap places */</span></td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">                <span class='macro'>assert(ZSTD_cwksp_check_available(ws, 2 * <span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t)))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">                zc-&gt;blockState.prevCBlock = (ZSTD_compressedBlockState_t*) ZSTD_cwksp_reserve_object(ws, <span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t));</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(zc-&gt;blockState.prevCBlock == NULL, memory_allocation, <span class='string_literal'>"couldn't allocate prevCBlock"</span>)<span class='macro_popup'>if (zc-&gt;blockState.prevCBlock == ((void*)0)) { {}; if (0) {<br> _force_has_format_string("couldn't allocate prevCBlock"); };<br> {}; {}; return ((size_t)-ZSTD_error_memory_allocation); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">                zc-&gt;blockState.nextCBlock = (ZSTD_compressedBlockState_t*) ZSTD_cwksp_reserve_object(ws, <span class='keyword'>sizeof</span>(ZSTD_compressedBlockState_t));</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(zc-&gt;blockState.nextCBlock == NULL, memory_allocation, <span class='string_literal'>"couldn't allocate nextCBlock"</span>)<span class='macro_popup'>if (zc-&gt;blockState.nextCBlock == ((void*)0)) { {}; if (0) {<br> _force_has_format_string("couldn't allocate nextCBlock"); };<br> {}; {}; return ((size_t)-ZSTD_error_memory_allocation); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">                zc-&gt;entropyWorkspace = (U32*) ZSTD_cwksp_reserve_object(ws, <span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(zc-&gt;blockState.nextCBlock == NULL, memory_allocation, <span class='string_literal'>"couldn't allocate entropyWorkspace"</span>)<span class='macro_popup'>if (zc-&gt;blockState.nextCBlock == ((void*)0)) { {}; if (0) {<br> _force_has_format_string("couldn't allocate entropyWorkspace"<br>); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation);<br> }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">        }   }</td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">        ZSTD_cwksp_clear(ws);</td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">        <span class='comment'>/* init params */</span></td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">        zc-&gt;appliedParams = params;</td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">        zc-&gt;blockState.matchState.cParams = params.cParams;</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">        zc-&gt;pledgedSrcSizePlusOne = pledgedSrcSize+1;</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">        zc-&gt;consumedSrcSize = 0;</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">        zc-&gt;producedCSize = 0;</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line">        <span class='keyword'>if</span> (pledgedSrcSize == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">            zc-&gt;appliedParams.fParams.contentSizeFlag = 0;</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"pledged content size : %u ; flag : %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">            <span class='macro'>(<span class='keyword'>unsigned</span>)pledgedSrcSize, zc-&gt;appliedParams.fParams.contentSizeFlag)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">        zc-&gt;blockSize = blockSize;</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">        <span class='macro'>XXH64_reset<span class='macro_popup'>ZSTD_XXH64_reset</span></span>(&amp;zc-&gt;xxhState, 0);</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">        zc-&gt;stage = ZSTDcs_init;</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">        zc-&gt;dictID = 0;</td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">        ZSTD_reset_compressedBlockState(zc-&gt;blockState.prevCBlock);</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">        <span class='comment'>/* ZSTD_wildcopy() is used to copy into the literals buffer,</span></td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">         <span class='comment'>* so we have to oversize the buffer by WILDCOPY_OVERLENGTH bytes.</span></td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">        zc-&gt;seqStore.litStart = ZSTD_cwksp_reserve_buffer(ws, blockSize + <span class='macro'>WILDCOPY_OVERLENGTH<span class='macro_popup'>32</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">        zc-&gt;seqStore.maxNbLit = blockSize;</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">        <span class='comment'>/* buffers */</span></td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">        zc-&gt;inBuffSize = buffInSize;</td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">        zc-&gt;inBuff = (<span class='keyword'>char</span>*)ZSTD_cwksp_reserve_buffer(ws, buffInSize);</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">        zc-&gt;outBuffSize = buffOutSize;</td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">        zc-&gt;outBuff = (<span class='keyword'>char</span>*)ZSTD_cwksp_reserve_buffer(ws, buffOutSize);</td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">        <span class='comment'>/* ldm bucketOffsets table */</span></td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">        <span class='keyword'>if</span> (params.ldmParams.enableLdm) {</td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">            <span class='comment'>/* TODO: avoid memset? */</span></td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">            size_t <span class='keyword'>const</span> ldmBucketSize =</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">                  ((size_t)1) &lt;&lt; (params.ldmParams.hashLog -</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">                                  params.ldmParams.bucketSizeLog);</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">            zc-&gt;ldmState.bucketOffsets = ZSTD_cwksp_reserve_buffer(ws, ldmBucketSize);</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">            memset(zc-&gt;ldmState.bucketOffsets, 0, ldmBucketSize);</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">        <span class='comment'>/* sequences storage */</span></td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">        ZSTD_referenceExternalSequences(zc, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">        zc-&gt;seqStore.maxNbSeq = maxNbSeq;</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">        zc-&gt;seqStore.llCode = ZSTD_cwksp_reserve_buffer(ws, maxNbSeq * <span class='keyword'>sizeof</span>(BYTE));</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">        zc-&gt;seqStore.mlCode = ZSTD_cwksp_reserve_buffer(ws, maxNbSeq * <span class='keyword'>sizeof</span>(BYTE));</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">        zc-&gt;seqStore.ofCode = ZSTD_cwksp_reserve_buffer(ws, maxNbSeq * <span class='keyword'>sizeof</span>(BYTE));</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">        zc-&gt;seqStore.sequencesStart = (seqDef*)ZSTD_cwksp_reserve_aligned(ws, maxNbSeq * <span class='keyword'>sizeof</span>(seqDef));</td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_reset_matchState(<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">            <span class='macro'>&amp;zc-&gt;blockState.matchState,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line">            <span class='macro'>ws,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">            <span class='macro'>&amp;params.cParams,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">            <span class='macro'>crp,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">            <span class='macro'>needsIndexReset,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">            <span class='macro'>ZSTD_resetTarget_CCtx), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;zc-&gt;<br>blockState.matchState, ws, &amp;params.cParams, crp, needsIndexReset<br>, ZSTD_resetTarget_CCtx)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">        <span class='comment'>/* ldm hash table */</span></td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">        <span class='keyword'>if</span> (params.ldmParams.enableLdm) {</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">            <span class='comment'>/* TODO: avoid memset? */</span></td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line">            size_t <span class='keyword'>const</span> ldmHSize = ((size_t)1) &lt;&lt; params.ldmParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">            zc-&gt;ldmState.hashTable = (ldmEntry_t*)ZSTD_cwksp_reserve_aligned(ws, ldmHSize * <span class='keyword'>sizeof</span>(ldmEntry_t));</td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">            memset(zc-&gt;ldmState.hashTable, 0, ldmHSize * <span class='keyword'>sizeof</span>(ldmEntry_t));</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">            zc-&gt;ldmSequences = (rawSeq*)ZSTD_cwksp_reserve_aligned(ws, maxNbLdmSeq * <span class='keyword'>sizeof</span>(rawSeq));</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">            zc-&gt;maxNbLdmSequences = maxNbLdmSeq;</td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">            ZSTD_window_init(&amp;zc-&gt;ldmState.window);</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">            ZSTD_window_clear(&amp;zc-&gt;ldmState.window);</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">            zc-&gt;ldmState.loadedDictEnd = 0;</td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">        <span class='macro'>DEBUGLOG(3, <span class='string_literal'>"wksp: finished allocating, %zd bytes remain available"</span>, ZSTD_cwksp_available_space(ws))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">        zc-&gt;initialized = 1;</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line"><span class='comment'>/* ZSTD_invalidateRepCodes() :</span></td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line"> <span class='comment'>* ensures next compression will not use repcodes from previous block.</span></td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line"> <span class='comment'>* Note : only works with regular variant;</span></td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line"> <span class='comment'>*        do not use with extDict variant ! */</span></td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line"><span class='keyword'>void</span> ZSTD_invalidateRepCodes(ZSTD_CCtx* cctx) {</td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">    <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">    <span class='keyword'>for</span> (i=0; i&lt;<span class='macro'>ZSTD_REP_NUM<span class='macro_popup'>3</span></span>; i++) cctx-&gt;blockState.prevCBlock-&gt;rep[i] = 0;</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line">    <span class='macro'>assert(!ZSTD_window_hasExtDict(cctx-&gt;blockState.matchState.window))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line"><span class='comment'>/* These are the approximate sizes for each strategy past which copying the</span></td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line"> <span class='comment'>* dictionary tables into the working context is faster than using them</span></td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line"> <span class='comment'>* in-place.</span></td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> size_t attachDictSizeCutoffs[<span class='macro'>ZSTD_STRATEGY_MAX<span class='macro_popup'>ZSTD_btultra2</span></span>+1] = {</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">    8 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>,  <span class='comment'>/* unused */</span></td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">    8 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>,  <span class='comment'>/* ZSTD_fast */</span></td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">    16 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>, <span class='comment'>/* ZSTD_dfast */</span></td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line">    32 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>, <span class='comment'>/* ZSTD_greedy */</span></td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line">    32 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>, <span class='comment'>/* ZSTD_lazy */</span></td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">    32 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>, <span class='comment'>/* ZSTD_lazy2 */</span></td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">    32 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>, <span class='comment'>/* ZSTD_btlazy2 */</span></td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line">    32 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>, <span class='comment'>/* ZSTD_btopt */</span></td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">    8 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>,  <span class='comment'>/* ZSTD_btultra */</span></td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">    8 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>   <span class='comment'>/* ZSTD_btultra2 */</span></td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ZSTD_shouldAttachDict(<span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">                                 <span class='keyword'>const</span> ZSTD_CCtx_params* params,</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">                                 U64 pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">    size_t cutoff = attachDictSizeCutoffs[cdict-&gt;matchState.cParams.strategy];</td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">    <span class='keyword'>return</span> ( pledgedSrcSize &lt;= cutoff</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line">          || pledgedSrcSize == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span></td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">          || params-&gt;attachDictPref == ZSTD_dictForceAttach )</td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">        &amp;&amp; params-&gt;attachDictPref != ZSTD_dictForceCopy</td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">        &amp;&amp; !params-&gt;forceWindow; <span class='comment'>/* dictMatchState isn't correctly</span></td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">                                 <span class='comment'>* handled in _enforceMaxDist */</span></td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line"><span class='keyword'>static</span> size_t</td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">ZSTD_resetCCtx_byAttachingCDict(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">                        <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">                        ZSTD_CCtx_params params,</td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">                        U64 pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">                        ZSTD_buffered_policy_e zbuff)</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">    {   <span class='keyword'>const</span> ZSTD_compressionParameters* <span class='keyword'>const</span> cdict_cParams = &amp;cdict-&gt;matchState.cParams;</td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">        <span class='keyword'>unsigned</span> <span class='keyword'>const</span> windowLog = params.cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">        <span class='macro'>assert(windowLog != 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">        <span class='comment'>/* Resize working context table params for input only, since the dict</span></td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">         <span class='comment'>* has its own tables. */</span></td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">        <span class='comment'>/* pledgeSrcSize == 0 means 0! */</span></td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">        params.cParams = ZSTD_adjustCParams_internal(*cdict_cParams, pledgedSrcSize, 0);</td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">        params.cParams.windowLog = windowLog;</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_resetCCtx_internal(cctx, params, pledgedSrcSize,<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCCtx_internal(cctx, params<br>, pledgedSrcSize, ZSTDcrp_makeClean, zbuff)); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string(""); }; {<br>}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">                                                 <span class='macro'>ZSTDcrp_makeClean, zbuff), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCCtx_internal(cctx, params<br>, pledgedSrcSize, ZSTDcrp_makeClean, zbuff)); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string(""); }; {<br>}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">        <span class='macro'>assert(cctx-&gt;appliedParams.cParams.strategy == cdict_cParams-&gt;strategy)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">    {   <span class='keyword'>const</span> U32 cdictEnd = (U32)( cdict-&gt;matchState.window.nextSrc</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">                                  - cdict-&gt;matchState.window.base);</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">        <span class='keyword'>const</span> U32 cdictLen = cdictEnd - cdict-&gt;matchState.window.dictLimit;</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">        <span class='keyword'>if</span> (cdictLen == 0) {</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">            <span class='comment'>/* don't even attach dictionaries with no contents */</span></td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line">            <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"skipping attaching empty dictionary"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">            <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"attaching dictionary into context"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">            cctx-&gt;blockState.matchState.dictMatchState = &amp;cdict-&gt;matchState;</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">            <span class='comment'>/* prep working match state so dict matches never have negative indices</span></td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">             <span class='comment'>* when they are translated to the working context's index space. */</span></td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">            <span class='keyword'>if</span> (cctx-&gt;blockState.matchState.window.dictLimit &lt; cdictEnd) {</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">                cctx-&gt;blockState.matchState.window.nextSrc =</td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line">                    cctx-&gt;blockState.matchState.window.base + cdictEnd;</td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">                ZSTD_window_clear(&amp;cctx-&gt;blockState.matchState.window);</td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">            <span class='comment'>/* loadedDictEnd is expressed within the referential of the active context */</span></td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line">            cctx-&gt;blockState.matchState.loadedDictEnd = cctx-&gt;blockState.matchState.window.dictLimit;</td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line">    cctx-&gt;dictID = cdict-&gt;dictID;</td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">    <span class='comment'>/* copy block state */</span></td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line">    memcpy(cctx-&gt;blockState.prevCBlock, &amp;cdict-&gt;cBlockState, <span class='keyword'>sizeof</span>(cdict-&gt;cBlockState));</td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_resetCCtx_byCopyingCDict(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">                            <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">                            ZSTD_CCtx_params params,</td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line">                            U64 pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line">                            ZSTD_buffered_policy_e zbuff)</td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">    <span class='keyword'>const</span> ZSTD_compressionParameters *cdict_cParams = &amp;cdict-&gt;matchState.cParams;</td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"copying dictionary into context"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">    {   <span class='keyword'>unsigned</span> <span class='keyword'>const</span> windowLog = params.cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line">        <span class='macro'>assert(windowLog != 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">        <span class='comment'>/* Copy only compression parameters related to tables. */</span></td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">        params.cParams = *cdict_cParams;</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">        params.cParams.windowLog = windowLog;</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_resetCCtx_internal(cctx, params, pledgedSrcSize,<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCCtx_internal(cctx, params<br>, pledgedSrcSize, ZSTDcrp_leaveDirty, zbuff)); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string(""); }; {<br>}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line">                                                 <span class='macro'>ZSTDcrp_leaveDirty, zbuff), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCCtx_internal(cctx, params<br>, pledgedSrcSize, ZSTDcrp_leaveDirty, zbuff)); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string(""); }; {<br>}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">        <span class='macro'>assert(cctx-&gt;appliedParams.cParams.strategy == cdict_cParams-&gt;strategy)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">        <span class='macro'>assert(cctx-&gt;appliedParams.cParams.hashLog == cdict_cParams-&gt;hashLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">        <span class='macro'>assert(cctx-&gt;appliedParams.cParams.chainLog == cdict_cParams-&gt;chainLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">    ZSTD_cwksp_mark_tables_dirty(&amp;cctx-&gt;workspace);</td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">    <span class='comment'>/* copy tables */</span></td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">    {   size_t <span class='keyword'>const</span> chainSize = (cdict_cParams-&gt;strategy == ZSTD_fast) ? 0 : ((size_t)1 &lt;&lt; cdict_cParams-&gt;chainLog);</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line">        size_t <span class='keyword'>const</span> hSize =  (size_t)1 &lt;&lt; cdict_cParams-&gt;hashLog;</td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">        memcpy(cctx-&gt;blockState.matchState.hashTable,</td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">               cdict-&gt;matchState.hashTable,</td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">               hSize * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">        memcpy(cctx-&gt;blockState.matchState.chainTable,</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">               cdict-&gt;matchState.chainTable,</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">               chainSize * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">    <span class='comment'>/* Zero the hashTable3, since the cdict never fills it */</span></td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">    {   <span class='keyword'>int</span> <span class='keyword'>const</span> h3log = cctx-&gt;blockState.matchState.hashLog3;</td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">        size_t <span class='keyword'>const</span> h3Size = h3log ? ((size_t)1 &lt;&lt; h3log) : 0;</td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line">        <span class='macro'>assert(cdict-&gt;matchState.hashLog3 == 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">        memset(cctx-&gt;blockState.matchState.hashTable3, 0, h3Size * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">    ZSTD_cwksp_mark_tables_clean(&amp;cctx-&gt;workspace);</td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">    <span class='comment'>/* copy dictionary offsets */</span></td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">    {   ZSTD_matchState_t <span class='keyword'>const</span>* srcMatchState = &amp;cdict-&gt;matchState;</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">        ZSTD_matchState_t* dstMatchState = &amp;cctx-&gt;blockState.matchState;</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line">        dstMatchState-&gt;window       = srcMatchState-&gt;window;</td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">        dstMatchState-&gt;nextToUpdate = srcMatchState-&gt;nextToUpdate;</td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">        dstMatchState-&gt;loadedDictEnd= srcMatchState-&gt;loadedDictEnd;</td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">    cctx-&gt;dictID = cdict-&gt;dictID;</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line">    <span class='comment'>/* copy block state */</span></td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line">    memcpy(cctx-&gt;blockState.prevCBlock, &amp;cdict-&gt;cBlockState, <span class='keyword'>sizeof</span>(cdict-&gt;cBlockState));</td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line"><span class='comment'>/* We have a choice between copying the dictionary context into the working</span></td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line"> <span class='comment'>* context, or referencing the dictionary context from the working context</span></td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line"> <span class='comment'>* in-place. We decide here which strategy to use. */</span></td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_resetCCtx_usingCDict(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">                            <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">                            <span class='keyword'>const</span> ZSTD_CCtx_params* params,</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">                            U64 pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">                            ZSTD_buffered_policy_e zbuff)</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_resetCCtx_usingCDict (pledgedSrcSize=%u)"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">                <span class='macro'>(<span class='keyword'>unsigned</span>)pledgedSrcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">    <span class='keyword'>if</span> (ZSTD_shouldAttachDict(cdict, params, pledgedSrcSize)) {</td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">        <span class='keyword'>return</span> ZSTD_resetCCtx_byAttachingCDict(</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">            cctx, cdict, *params, pledgedSrcSize, zbuff);</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">        <span class='keyword'>return</span> ZSTD_resetCCtx_byCopyingCDict(</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">            cctx, cdict, *params, pledgedSrcSize, zbuff);</td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line"><span class='comment'>/*! ZSTD_copyCCtx_internal() :</span></td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line"> <span class='comment'>*  Duplicate an existing context `srcCCtx` into another one `dstCCtx`.</span></td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line"> <span class='comment'>*  Only works during stage ZSTDcs_init (i.e. after creation, but before first call to ZSTD_compressContinue()).</span></td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line"> <span class='comment'>*  The "context", in this case, refers to the hash and chain tables,</span></td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line"> <span class='comment'>*  entropy tables, and dictionary references.</span></td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line"> <span class='comment'>* `windowLog` value is enforced if != 0, otherwise value is copied from srcCCtx.</span></td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line"> <span class='comment'>* @return : 0, or an error code */</span></td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_copyCCtx_internal(ZSTD_CCtx* dstCCtx,</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">                            <span class='keyword'>const</span> ZSTD_CCtx* srcCCtx,</td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">                            ZSTD_frameParameters fParams,</td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">                            U64 pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">                            ZSTD_buffered_policy_e zbuff)</td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_copyCCtx_internal"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(srcCCtx-&gt;stage!=ZSTDcs_init, stage_wrong,<span class='macro_popup'>if (srcCCtx-&gt;stage!=ZSTDcs_init) { {}; if (0) { _force_has_format_string<br>("Can't copy a ctx that's not in init stage."); }; {}; {}; return<br> ((size_t)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">                    <span class='string_literal'><span class='macro'>"Can't copy a ctx that's not in init stage."</span>)<span class='macro_popup'>if (srcCCtx-&gt;stage!=ZSTDcs_init) { {}; if (0) { _force_has_format_string<br>("Can't copy a ctx that's not in init stage."); }; {}; {}; return<br> ((size_t)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">    memcpy(&amp;dstCCtx-&gt;customMem, &amp;srcCCtx-&gt;customMem, <span class='keyword'>sizeof</span>(ZSTD_customMem));</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">    {   ZSTD_CCtx_params params = dstCCtx-&gt;requestedParams;</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line">        <span class='comment'>/* Copy only compression parameters related to tables. */</span></td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">        params.cParams = srcCCtx-&gt;appliedParams.cParams;</td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">        params.fParams = fParams;</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">        ZSTD_resetCCtx_internal(dstCCtx, params, pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">                                ZSTDcrp_leaveDirty, zbuff);</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">        <span class='macro'>assert(dstCCtx-&gt;appliedParams.cParams.windowLog == srcCCtx-&gt;appliedParams.cParams.windowLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">        <span class='macro'>assert(dstCCtx-&gt;appliedParams.cParams.strategy == srcCCtx-&gt;appliedParams.cParams.strategy)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">        <span class='macro'>assert(dstCCtx-&gt;appliedParams.cParams.hashLog == srcCCtx-&gt;appliedParams.cParams.hashLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">        <span class='macro'>assert(dstCCtx-&gt;appliedParams.cParams.chainLog == srcCCtx-&gt;appliedParams.cParams.chainLog)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">        <span class='macro'>assert(dstCCtx-&gt;blockState.matchState.hashLog3 == srcCCtx-&gt;blockState.matchState.hashLog3)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">    ZSTD_cwksp_mark_tables_dirty(&amp;dstCCtx-&gt;workspace);</td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">    <span class='comment'>/* copy tables */</span></td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">    {   size_t <span class='keyword'>const</span> chainSize = (srcCCtx-&gt;appliedParams.cParams.strategy == ZSTD_fast) ? 0 : ((size_t)1 &lt;&lt; srcCCtx-&gt;appliedParams.cParams.chainLog);</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">        size_t <span class='keyword'>const</span> hSize =  (size_t)1 &lt;&lt; srcCCtx-&gt;appliedParams.cParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">        <span class='keyword'>int</span> <span class='keyword'>const</span> h3log = srcCCtx-&gt;blockState.matchState.hashLog3;</td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">        size_t <span class='keyword'>const</span> h3Size = h3log ? ((size_t)1 &lt;&lt; h3log) : 0;</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">        memcpy(dstCCtx-&gt;blockState.matchState.hashTable,</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">               srcCCtx-&gt;blockState.matchState.hashTable,</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">               hSize * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">        <span class="mrange">memcpy</span>(dstCCtx-&gt;blockState.matchState.chainTable,</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:9ex; max-width:58em">Call to function 'memcpy' is insecure as it does not provide security checks introduced in the C11 standard. Replace with analogous functions that support length arguments or provides boundary checks such as 'memcpy_s' in case of C11</div></td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">               srcCCtx-&gt;blockState.matchState.chainTable,</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">               chainSize * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">        memcpy(dstCCtx-&gt;blockState.matchState.hashTable3,</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">               srcCCtx-&gt;blockState.matchState.hashTable3,</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">               h3Size * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">    ZSTD_cwksp_mark_tables_clean(&amp;dstCCtx-&gt;workspace);</td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line">    <span class='comment'>/* copy dictionary offsets */</span></td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">        <span class='keyword'>const</span> ZSTD_matchState_t* srcMatchState = &amp;srcCCtx-&gt;blockState.matchState;</td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">        ZSTD_matchState_t* dstMatchState = &amp;dstCCtx-&gt;blockState.matchState;</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line">        dstMatchState-&gt;window       = srcMatchState-&gt;window;</td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">        dstMatchState-&gt;nextToUpdate = srcMatchState-&gt;nextToUpdate;</td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line">        dstMatchState-&gt;loadedDictEnd= srcMatchState-&gt;loadedDictEnd;</td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">    dstCCtx-&gt;dictID = srcCCtx-&gt;dictID;</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">    <span class='comment'>/* copy block state */</span></td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">    memcpy(dstCCtx-&gt;blockState.prevCBlock, srcCCtx-&gt;blockState.prevCBlock, <span class='keyword'>sizeof</span>(*srcCCtx-&gt;blockState.prevCBlock));</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line"><span class='comment'>/*! ZSTD_copyCCtx() :</span></td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line"> <span class='comment'>*  Duplicate an existing context `srcCCtx` into another one `dstCCtx`.</span></td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line"> <span class='comment'>*  Only works during stage ZSTDcs_init (i.e. after creation, but before first call to ZSTD_compressContinue()).</span></td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line"> <span class='comment'>*  pledgedSrcSize==0 means "unknown".</span></td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line"><span class='comment'>*   @return : 0, or an error code */</span></td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">size_t ZSTD_copyCCtx(ZSTD_CCtx* dstCCtx, <span class='keyword'>const</span> ZSTD_CCtx* srcCCtx, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">    ZSTD_frameParameters fParams = { 1 <span class='comment'>/*content*/</span>, 0 <span class='comment'>/*checksum*/</span>, 0 <span class='comment'>/*noDictID*/</span> };</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">    ZSTD_buffered_policy_e <span class='keyword'>const</span> zbuff = (ZSTD_buffered_policy_e)(srcCCtx-&gt;inBuffSize&gt;0);</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">    <span class='macro'>ZSTD_STATIC_ASSERT((U32)ZSTDb_buffered==1)<span class='macro_popup'>(void)sizeof(char[((U32)ZSTDb_buffered==1) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">    <span class='keyword'>if</span> (pledgedSrcSize==0) pledgedSrcSize = <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line">    fParams.contentSizeFlag = (pledgedSrcSize != <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line">    <span class='keyword'>return</span> ZSTD_copyCCtx_internal(dstCCtx, srcCCtx,</td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line">                                fParams, pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line">                                zbuff);</td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line"><span class='directive'>#define <span class='macro'>ZSTD_ROWSIZE<span class='macro_popup'>16</span></span> 16</span></td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line"><span class='comment'>/*! ZSTD_reduceTable() :</span></td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line"> <span class='comment'>*  reduce table indexes by `reducerValue`, or squash to zero.</span></td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line"> <span class='comment'>*  PreserveMark preserves "unsorted mark" for btlazy2 strategy.</span></td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line"> <span class='comment'>*  It must be set to a clear 0/1 value, to remove branch during inlining.</span></td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line"> <span class='comment'>*  Presume table size is a multiple of ZSTD_ROWSIZE</span></td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line"> <span class='comment'>*  to help auto-vectorization */</span></td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line"><span class='macro'>FORCE_INLINE_TEMPLATE<span class='macro_popup'>static inline __attribute__((always_inline))</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">ZSTD_reduceTable_internal (U32* <span class='keyword'>const</span> table, U32 <span class='keyword'>const</span> size, U32 <span class='keyword'>const</span> reducerValue, <span class='keyword'>int</span> <span class='keyword'>const</span> preserveMark)</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">    <span class='keyword'>int</span> <span class='keyword'>const</span> nbRows = (<span class='keyword'>int</span>)size / <span class='macro'>ZSTD_ROWSIZE<span class='macro_popup'>16</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line">    <span class='keyword'>int</span> cellNb = 0;</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">    <span class='keyword'>int</span> rowNb;</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line">    <span class='macro'>assert((size &amp; (ZSTD_ROWSIZE-1)) == 0)<span class='macro_popup'>((void)0)</span></span>;  <span class='comment'>/* multiple of ZSTD_ROWSIZE */</span></td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">    <span class='macro'>assert(size &lt; (1U&lt;&lt;31))<span class='macro_popup'>((void)0)</span></span>;   <span class='comment'>/* can be casted to int */</span></td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line"><span class='directive'>#if defined (MEMORY_SANITIZER) &amp;&amp; !defined (ZSTD_MSAN_DONT_POISON_WORKSPACE)</span></td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">    <span class='comment'>/* To validate that the table re-use logic is sound, and that we don't</span></td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">     <span class='comment'>* access table space that we haven't cleaned, we re-"poison" the table</span></td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">     <span class='comment'>* space every time we mark it dirty.</span></td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line">     <span class='comment'>* This function however is intended to operate on those dirty tables and</span></td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">     <span class='comment'>* re-clean them. So when this function is used correctly, we can unpoison</span></td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line">     <span class='comment'>* the memory it operated on. This introduces a blind spot though, since</span></td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line">     <span class='comment'>* if we now try to operate on __actually__ poisoned memory, we will not</span></td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line">     <span class='comment'>* detect that. */</span></td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line">    __msan_unpoison(table, size * <span class='keyword'>sizeof</span>(U32));</td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">    <span class='keyword'>for</span> (rowNb=0 ; rowNb &lt; nbRows ; rowNb++) {</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">        <span class='keyword'>int</span> column;</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line">        <span class='keyword'>for</span> (column=0; column&lt;<span class='macro'>ZSTD_ROWSIZE<span class='macro_popup'>16</span></span>; column++) {</td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">            <span class='keyword'>if</span> (preserveMark) {</td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">                U32 <span class='keyword'>const</span> adder = (table[cellNb] == <span class='macro'>ZSTD_DUBT_UNSORTED_MARK<span class='macro_popup'>1</span></span>) ? reducerValue : 0;</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">                table[cellNb] += adder;</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">            <span class='keyword'>if</span> (table[cellNb] &lt; reducerValue) table[cellNb] = 0;</td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line">            <span class='keyword'>else</span> table[cellNb] -= reducerValue;</td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">            cellNb++;</td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_reduceTable(U32* <span class='keyword'>const</span> table, U32 <span class='keyword'>const</span> size, U32 <span class='keyword'>const</span> reducerValue)</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">    ZSTD_reduceTable_internal(table, size, reducerValue, 0);</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_reduceTable_btlazy2(U32* <span class='keyword'>const</span> table, U32 <span class='keyword'>const</span> size, U32 <span class='keyword'>const</span> reducerValue)</td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">    ZSTD_reduceTable_internal(table, size, reducerValue, 1);</td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line"><span class='comment'>/*! ZSTD_reduceIndex() :</span></td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line"><span class='comment'>*   rescale all indexes to avoid future overflow (indexes are U32) */</span></td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_reduceIndex (ZSTD_matchState_t* ms, ZSTD_CCtx_params <span class='keyword'>const</span>* params, <span class='keyword'>const</span> U32 reducerValue)</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line">    {   U32 <span class='keyword'>const</span> hSize = (U32)1 &lt;&lt; params-&gt;cParams.hashLog;</td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line">        ZSTD_reduceTable(ms-&gt;hashTable, hSize, reducerValue);</td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">    <span class='keyword'>if</span> (params-&gt;cParams.strategy != ZSTD_fast) {</td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">        U32 <span class='keyword'>const</span> chainSize = (U32)1 &lt;&lt; params-&gt;cParams.chainLog;</td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">        <span class='keyword'>if</span> (params-&gt;cParams.strategy == ZSTD_btlazy2)</td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">            ZSTD_reduceTable_btlazy2(ms-&gt;chainTable, chainSize, reducerValue);</td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">            ZSTD_reduceTable(ms-&gt;chainTable, chainSize, reducerValue);</td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">    <span class='keyword'>if</span> (ms-&gt;hashLog3) {</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line">        U32 <span class='keyword'>const</span> h3Size = (U32)1 &lt;&lt; ms-&gt;hashLog3;</td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">        ZSTD_reduceTable(ms-&gt;hashTable3, h3Size, reducerValue);</td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line"><span class='comment'>/*-*******************************************************</span></td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line"><span class='comment'>*  Block entropic compression</span></td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line"><span class='comment'>*********************************************************/</span></td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line"><span class='comment'>/* See doc/zstd_compression_format.md for detailed format description */</span></td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line"><span class='keyword'>void</span> ZSTD_seqToCodes(<span class='keyword'>const</span> seqStore_t* seqStorePtr)</td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">    <span class='keyword'>const</span> seqDef* <span class='keyword'>const</span> sequences = seqStorePtr-&gt;sequencesStart;</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line">    BYTE* <span class='keyword'>const</span> llCodeTable = seqStorePtr-&gt;llCode;</td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line">    BYTE* <span class='keyword'>const</span> ofCodeTable = seqStorePtr-&gt;ofCode;</td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">    BYTE* <span class='keyword'>const</span> mlCodeTable = seqStorePtr-&gt;mlCode;</td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line">    U32 <span class='keyword'>const</span> nbSeq = (U32)(seqStorePtr-&gt;sequences - seqStorePtr-&gt;sequencesStart);</td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line">    U32 u;</td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line">    <span class='macro'>assert(nbSeq &lt;= seqStorePtr-&gt;maxNbSeq)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line">    <span class='keyword'>for</span> (u=0; u&lt;nbSeq; u++) {</td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line">        U32 <span class='keyword'>const</span> llv = sequences[u].litLength;</td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">        U32 <span class='keyword'>const</span> mlv = sequences[u].matchLength;</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">        llCodeTable[u] = (BYTE)ZSTD_LLcode(llv);</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line">        ofCodeTable[u] = (BYTE)ZSTD_highbit32(sequences[u].offset);</td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">        mlCodeTable[u] = (BYTE)ZSTD_MLcode(mlv);</td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line">    <span class='keyword'>if</span> (seqStorePtr-&gt;longLengthID==1)</td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line">        llCodeTable[seqStorePtr-&gt;longLengthPos] = <span class='macro'>MaxLL<span class='macro_popup'>35</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line">    <span class='keyword'>if</span> (seqStorePtr-&gt;longLengthID==2)</td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">        mlCodeTable[seqStorePtr-&gt;longLengthPos] = <span class='macro'>MaxML<span class='macro_popup'>52</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line"><span class='comment'>/* ZSTD_useTargetCBlockSize():</span></td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line"> <span class='comment'>* Returns if target compressed block size param is being used.</span></td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line"> <span class='comment'>* If used, compression will do best effort to make a compressed block size to be around targetCBlockSize.</span></td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line"> <span class='comment'>* Returns 1 if true, 0 otherwise. */</span></td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ZSTD_useTargetCBlockSize(<span class='keyword'>const</span> ZSTD_CCtx_params* cctxParams)</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_useTargetCBlockSize (targetCBlockSize=%zu)"</span>, cctxParams-&gt;targetCBlockSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line">    <span class='keyword'>return</span> (cctxParams-&gt;targetCBlockSize != 0);</td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line"><span class='comment'>/* ZSTD_compressSequences_internal():</span></td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line"> <span class='comment'>* actually compresses both literals and sequences */</span></td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line"><span class='macro'>MEM_STATIC<span class='macro_popup'>static __inline __attribute__((unused))</span></span> size_t</td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">ZSTD_compressSequences_internal(seqStore_t* seqStorePtr,</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">                          <span class='keyword'>const</span> ZSTD_entropyCTables_t* prevEntropy,</td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">                                ZSTD_entropyCTables_t* nextEntropy,</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">                          <span class='keyword'>const</span> ZSTD_CCtx_params* cctxParams,</td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">                                <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">                                <span class='keyword'>void</span>* entropyWorkspace, size_t entropyWkspSize,</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line">                          <span class='keyword'>const</span> <span class='keyword'>int</span> bmi2)</td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> longOffsets = cctxParams-&gt;cParams.windowLog &gt; <span class='macro'>STREAM_ACCUMULATOR_MIN<span class='macro_popup'>((U32)(MEM_32bits() ? 25 : 57))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line">    ZSTD_strategy <span class='keyword'>const</span> strategy = cctxParams-&gt;cParams.strategy;</td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line">    <span class='keyword'>unsigned</span> count[<span class='macro'>MaxSeq<span class='macro_popup'>((35)&gt;(52) ? (35) : (52))</span></span>+1];</td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">    FSE_CTable* CTable_LitLength = nextEntropy-&gt;fse.litlengthCTable;</td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">    FSE_CTable* CTable_OffsetBits = nextEntropy-&gt;fse.offcodeCTable;</td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line">    FSE_CTable* CTable_MatchLength = nextEntropy-&gt;fse.matchlengthCTable;</td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">    U32 LLtype, Offtype, MLtype;   <span class='comment'>/* compressed, raw or rle */</span></td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line">    <span class='keyword'>const</span> seqDef* <span class='keyword'>const</span> sequences = seqStorePtr-&gt;sequencesStart;</td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">    <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> ofCodeTable = seqStorePtr-&gt;ofCode;</td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line">    <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> llCodeTable = seqStorePtr-&gt;llCode;</td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">    <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> mlCodeTable = seqStorePtr-&gt;mlCode;</td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line">    BYTE* <span class='keyword'>const</span> ostart = (BYTE*)dst;</td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">    BYTE* <span class='keyword'>const</span> oend = ostart + dstCapacity;</td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">    BYTE* op = ostart;</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line">    size_t <span class='keyword'>const</span> nbSeq = (size_t)(seqStorePtr-&gt;sequences - seqStorePtr-&gt;sequencesStart);</td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">    BYTE* seqHead;</td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">    BYTE* lastNCount = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressSequences_internal (nbSeq=%zu)"</span>, nbSeq)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">    <span class='macro'>ZSTD_STATIC_ASSERT(HUF_WORKSPACE_SIZE &gt;= (1&lt;&lt;MAX(MLFSELog,LLFSELog)))<span class='macro_popup'>(void)sizeof(char[(((6 &lt;&lt; 10) + 256) &gt;= (1&lt;&lt;((<br>9)&gt;(9) ? (9) : (9)))) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">    <span class='comment'>/* Compress literals */</span></td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">    {   <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> literals = seqStorePtr-&gt;litStart;</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">        size_t <span class='keyword'>const</span> litSize = (size_t)(seqStorePtr-&gt;lit - literals);</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">        size_t <span class='keyword'>const</span> cSize = ZSTD_compressLiterals(</td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">                                    &amp;prevEntropy-&gt;huf, &amp;nextEntropy-&gt;huf,</td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line">                                    cctxParams-&gt;cParams.strategy,</td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line">                                    ZSTD_disableLiteralsCompression(cctxParams),</td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">                                    op, dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">                                    literals, litSize,</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">                                    entropyWorkspace, entropyWkspSize,</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">                                    bmi2);</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressLiterals failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressLiterals failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line">        <span class='macro'>assert(cSize &lt;= dstCapacity)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line">        op += cSize;</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">    <span class='comment'>/* Sequences Header */</span></td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">    <span class='macro'>RETURN_ERROR_IF((oend-op) &lt; 3 <span class='comment'>/*max nbSeq Size*/</span> + 1 <span class='comment'>/*seqHead*/</span>,<span class='macro_popup'>if ((oend-op) &lt; 3 + 1) { {}; if (0) { _force_has_format_string<br>("Can't fit seq hdr in output buf!"); }; {}; {}; return ((size_t<br>)-ZSTD_error_dstSize_tooSmall); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line">                    <span class='macro'>dstSize_tooSmall, <span class='string_literal'>"Can't fit seq hdr in output buf!"</span>)<span class='macro_popup'>if ((oend-op) &lt; 3 + 1) { {}; if (0) { _force_has_format_string<br>("Can't fit seq hdr in output buf!"); }; {}; {}; return ((size_t<br>)-ZSTD_error_dstSize_tooSmall); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">    <span class='keyword'>if</span> (nbSeq &lt; 128) {</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line">        *op++ = (BYTE)nbSeq;</td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (nbSeq &lt; <span class='macro'>LONGNBSEQ<span class='macro_popup'>0x7F00</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">        op[0] = (BYTE)((nbSeq&gt;&gt;8) + 0x80);</td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line">        op[1] = (BYTE)nbSeq;</td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line">        op+=2;</td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line">        op[0]=0xFF;</td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line">        MEM_writeLE16(op+1, (U16)(nbSeq - <span class='macro'>LONGNBSEQ<span class='macro_popup'>0x7F00</span></span>));</td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">        op+=3;</td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">    <span class='macro'>assert(op &lt;= oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">    <span class='keyword'>if</span> (nbSeq==0) {</td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line">        <span class='comment'>/* Copy the old tables over as if we repeated them */</span></td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">        memcpy(&amp;nextEntropy-&gt;fse, &amp;prevEntropy-&gt;fse, <span class='keyword'>sizeof</span>(prevEntropy-&gt;fse));</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">        <span class='keyword'>return</span> (size_t)(op - ostart);</td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line">    <span class='comment'>/* seqHead : flags for FSE encoding type */</span></td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line">    seqHead = op++;</td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line">    <span class='macro'>assert(op &lt;= oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">    <span class='comment'>/* convert length/distances into codes */</span></td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line">    ZSTD_seqToCodes(seqStorePtr);</td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line">    <span class='comment'>/* build CTable for Literal Lengths */</span></td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line">    {   <span class='keyword'>unsigned</span> max = <span class='macro'>MaxLL<span class='macro_popup'>35</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line">        size_t <span class='keyword'>const</span> mostFrequent = HIST_countFast_wksp(count, &amp;max, llCodeTable, nbSeq, entropyWorkspace, entropyWkspSize);   <span class='comment'>/* can't fail */</span></td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line">        <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"Building LL table"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line">        nextEntropy-&gt;fse.litlength_repeatMode = prevEntropy-&gt;fse.litlength_repeatMode;</td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line">        LLtype = ZSTD_selectEncodingType(&amp;nextEntropy-&gt;fse.litlength_repeatMode,</td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line">                                        count, max, mostFrequent, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line">                                        <span class='macro'>LLFSELog<span class='macro_popup'>9</span></span>, prevEntropy-&gt;fse.litlengthCTable,</td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line">                                        LL_defaultNorm, LL_defaultNormLog,</td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line">                                        ZSTD_defaultAllowed, strategy);</td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">        <span class='macro'>assert(set_basic &lt; set_compressed &amp;&amp; set_rle &lt; set_compressed)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line">        <span class='macro'>assert(!(LLtype &lt; set_compressed &amp;&amp; nextEntropy-&gt;fse.litlength_repeatMode != FSE_repeat_none))<span class='macro_popup'>((void)0)</span></span>; <span class='comment'>/* We don't copy tables */</span></td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">        {   size_t <span class='keyword'>const</span> countSize = ZSTD_buildCTable(</td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">                op, (size_t)(oend - op),</td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line">                CTable_LitLength, <span class='macro'>LLFSELog<span class='macro_popup'>9</span></span>, (symbolEncodingType_e)LLtype,</td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line">                count, max, llCodeTable, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line">                LL_defaultNorm, LL_defaultNormLog, <span class='macro'>MaxLL<span class='macro_popup'>35</span></span>,</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line">                prevEntropy-&gt;fse.litlengthCTable,</td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line">                <span class='keyword'>sizeof</span>(prevEntropy-&gt;fse.litlengthCTable),</td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line">                entropyWorkspace, entropyWkspSize);</td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR(countSize, <span class='string_literal'>"ZSTD_buildCTable for LitLens failed"</span>)<span class='macro_popup'>do { size_t const err_code = (countSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_buildCTable for LitLens failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">            <span class='keyword'>if</span> (LLtype == set_compressed)</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line">                lastNCount = op;</td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">            op += countSize;</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line">            <span class='macro'>assert(op &lt;= oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line">    <span class='comment'>/* build CTable for Offsets */</span></td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line">    {   <span class='keyword'>unsigned</span> max = <span class='macro'>MaxOff<span class='macro_popup'>31</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line">        size_t <span class='keyword'>const</span> mostFrequent = HIST_countFast_wksp(</td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line">            count, &amp;max, ofCodeTable, nbSeq, entropyWorkspace, entropyWkspSize);  <span class='comment'>/* can't fail */</span></td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line">        <span class='comment'>/* We can only use the basic table if max &lt;= DefaultMaxOff, otherwise the offsets are too large */</span></td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line">        ZSTD_defaultPolicy_e <span class='keyword'>const</span> defaultPolicy = (max &lt;= <span class='macro'>DefaultMaxOff<span class='macro_popup'>28</span></span>) ? ZSTD_defaultAllowed : ZSTD_defaultDisallowed;</td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">        <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"Building OF table"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line">        nextEntropy-&gt;fse.offcode_repeatMode = prevEntropy-&gt;fse.offcode_repeatMode;</td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line">        Offtype = ZSTD_selectEncodingType(&amp;nextEntropy-&gt;fse.offcode_repeatMode,</td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line">                                        count, max, mostFrequent, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">                                        <span class='macro'>OffFSELog<span class='macro_popup'>8</span></span>, prevEntropy-&gt;fse.offcodeCTable,</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">                                        OF_defaultNorm, OF_defaultNormLog,</td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line">                                        defaultPolicy, strategy);</td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">        <span class='macro'>assert(!(Offtype &lt; set_compressed &amp;&amp; nextEntropy-&gt;fse.offcode_repeatMode != FSE_repeat_none))<span class='macro_popup'>((void)0)</span></span>; <span class='comment'>/* We don't copy tables */</span></td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line">        {   size_t <span class='keyword'>const</span> countSize = ZSTD_buildCTable(</td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">                op, (size_t)(oend - op),</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line">                CTable_OffsetBits, <span class='macro'>OffFSELog<span class='macro_popup'>8</span></span>, (symbolEncodingType_e)Offtype,</td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">                count, max, ofCodeTable, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line">                OF_defaultNorm, OF_defaultNormLog, <span class='macro'>DefaultMaxOff<span class='macro_popup'>28</span></span>,</td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line">                prevEntropy-&gt;fse.offcodeCTable,</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">                <span class='keyword'>sizeof</span>(prevEntropy-&gt;fse.offcodeCTable),</td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line">                entropyWorkspace, entropyWkspSize);</td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR(countSize, <span class='string_literal'>"ZSTD_buildCTable for Offsets failed"</span>)<span class='macro_popup'>do { size_t const err_code = (countSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_buildCTable for Offsets failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line">            <span class='keyword'>if</span> (Offtype == set_compressed)</td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line">                lastNCount = op;</td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">            op += countSize;</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line">            <span class='macro'>assert(op &lt;= oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line">    <span class='comment'>/* build CTable for MatchLengths */</span></td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line">    {   <span class='keyword'>unsigned</span> max = <span class='macro'>MaxML<span class='macro_popup'>52</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line">        size_t <span class='keyword'>const</span> mostFrequent = HIST_countFast_wksp(</td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line">            count, &amp;max, mlCodeTable, nbSeq, entropyWorkspace, entropyWkspSize);   <span class='comment'>/* can't fail */</span></td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line">        <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"Building ML table (remaining space : %i)"</span>, (<span class='keyword'>int</span>)(oend-op))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line">        nextEntropy-&gt;fse.matchlength_repeatMode = prevEntropy-&gt;fse.matchlength_repeatMode;</td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line">        MLtype = ZSTD_selectEncodingType(&amp;nextEntropy-&gt;fse.matchlength_repeatMode,</td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">                                        count, max, mostFrequent, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">                                        <span class='macro'>MLFSELog<span class='macro_popup'>9</span></span>, prevEntropy-&gt;fse.matchlengthCTable,</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line">                                        ML_defaultNorm, ML_defaultNormLog,</td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">                                        ZSTD_defaultAllowed, strategy);</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line">        <span class='macro'>assert(!(MLtype &lt; set_compressed &amp;&amp; nextEntropy-&gt;fse.matchlength_repeatMode != FSE_repeat_none))<span class='macro_popup'>((void)0)</span></span>; <span class='comment'>/* We don't copy tables */</span></td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line">        {   size_t <span class='keyword'>const</span> countSize = ZSTD_buildCTable(</td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line">                op, (size_t)(oend - op),</td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line">                CTable_MatchLength, <span class='macro'>MLFSELog<span class='macro_popup'>9</span></span>, (symbolEncodingType_e)MLtype,</td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line">                count, max, mlCodeTable, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line">                ML_defaultNorm, ML_defaultNormLog, <span class='macro'>MaxML<span class='macro_popup'>52</span></span>,</td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line">                prevEntropy-&gt;fse.matchlengthCTable,</td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line">                <span class='keyword'>sizeof</span>(prevEntropy-&gt;fse.matchlengthCTable),</td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line">                entropyWorkspace, entropyWkspSize);</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR(countSize, <span class='string_literal'>"ZSTD_buildCTable for MatchLengths failed"</span>)<span class='macro_popup'>do { size_t const err_code = (countSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_buildCTable for MatchLengths failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line">            <span class='keyword'>if</span> (MLtype == set_compressed)</td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line">                lastNCount = op;</td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line">            op += countSize;</td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">            <span class='macro'>assert(op &lt;= oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">    *seqHead = (BYTE)((LLtype&lt;&lt;6) + (Offtype&lt;&lt;4) + (MLtype&lt;&lt;2));</td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line">    {   size_t <span class='keyword'>const</span> bitstreamSize = ZSTD_encodeSequences(</td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">                                        op, (size_t)(oend - op),</td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">                                        CTable_MatchLength, mlCodeTable,</td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">                                        CTable_OffsetBits, ofCodeTable,</td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line">                                        CTable_LitLength, llCodeTable,</td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">                                        sequences, nbSeq,</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line">                                        longOffsets, bmi2);</td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(bitstreamSize, <span class='string_literal'>"ZSTD_encodeSequences failed"</span>)<span class='macro_popup'>do { size_t const err_code = (bitstreamSize); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string("ZSTD_encodeSequences failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line">        op += bitstreamSize;</td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line">        <span class='macro'>assert(op &lt;= oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">        <span class='comment'>/* zstd versions &lt;= 1.3.4 mistakenly report corruption when</span></td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">         <span class='comment'>* FSE_readNCount() receives a buffer &lt; 4 bytes.</span></td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">         <span class='comment'>* Fixed by https://github.com/facebook/zstd/pull/1146.</span></td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">         <span class='comment'>* This can happen when the last set_compressed table present is 2</span></td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">         <span class='comment'>* bytes and the bitstream is only one byte.</span></td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line">         <span class='comment'>* In this exceedingly rare case, we will simply emit an uncompressed</span></td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line">         <span class='comment'>* block, since it isn't worth optimizing.</span></td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">        <span class='keyword'>if</span> (lastNCount &amp;&amp; (op - lastNCount) &lt; 4) {</td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">            <span class='comment'>/* NCountSize &gt;= 2 &amp;&amp; bitstreamSize &gt; 0 ==&gt; lastCountSize == 3 */</span></td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line">            <span class='macro'>assert(op - lastNCount == 3)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">            <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"Avoiding bug in zstd decoder in versions &lt;= 1.3.4 by "<span class='macro_popup'>{}</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line">                        <span class='string_literal'><span class='macro'>"emitting an uncompressed block."</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line">            <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"compressed block size : %u"</span>, (<span class='keyword'>unsigned</span>)(op - ostart))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line">    <span class='keyword'>return</span> (size_t)(op - ostart);</td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line"><span class='macro'>MEM_STATIC<span class='macro_popup'>static __inline __attribute__((unused))</span></span> size_t</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line">ZSTD_compressSequences(seqStore_t* seqStorePtr,</td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line">                       <span class='keyword'>const</span> ZSTD_entropyCTables_t* prevEntropy,</td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line">                             ZSTD_entropyCTables_t* nextEntropy,</td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line">                       <span class='keyword'>const</span> ZSTD_CCtx_params* cctxParams,</td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">                             <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line">                             size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line">                             <span class='keyword'>void</span>* entropyWorkspace, size_t entropyWkspSize,</td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">                             <span class='keyword'>int</span> bmi2)</td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">    size_t <span class='keyword'>const</span> cSize = ZSTD_compressSequences_internal(</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">                            seqStorePtr, prevEntropy, nextEntropy, cctxParams,</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line">                            dst, dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line">                            entropyWorkspace, entropyWkspSize, bmi2);</td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line">    <span class='keyword'>if</span> (cSize == 0) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line">    <span class='comment'>/* When srcSize &lt;= dstCapacity, there is enough space to write a raw uncompressed block.</span></td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line">     <span class='comment'>* Since we ran out of space, block must be not compressible, so fall back to raw uncompressed block.</span></td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line">    <span class='keyword'>if</span> ((cSize == <span class='macro'>ERROR(dstSize_tooSmall)<span class='macro_popup'>((size_t)-ZSTD_error_dstSize_tooSmall)</span></span>) &amp; (srcSize &lt;= dstCapacity))</td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">        <span class='keyword'>return</span> 0;  <span class='comment'>/* block not compressed */</span></td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressSequences_internal failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressSequences_internal failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line">    <span class='comment'>/* Check compressibility */</span></td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line">    {   size_t <span class='keyword'>const</span> maxCSize = srcSize - ZSTD_minGain(srcSize, cctxParams-&gt;cParams.strategy);</td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">        <span class='keyword'>if</span> (cSize &gt;= maxCSize) <span class='keyword'>return</span> 0;  <span class='comment'>/* block not compressed */</span></td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line">    <span class='keyword'>return</span> cSize;</td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line"><span class='comment'>/* ZSTD_selectBlockCompressor() :</span></td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line"> <span class='comment'>* Not static, but internal use only (used by long distance matcher)</span></td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line"> <span class='comment'>* assumption : strat is a valid strategy */</span></td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line">ZSTD_blockCompressor ZSTD_selectBlockCompressor(ZSTD_strategy strat, ZSTD_dictMode_e dictMode)</td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> ZSTD_blockCompressor blockCompressor[3][<span class='macro'>ZSTD_STRATEGY_MAX<span class='macro_popup'>ZSTD_btultra2</span></span>+1] = {</td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line">        { ZSTD_compressBlock_fast  <span class='comment'>/* default for 0 */</span>,</td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line">          ZSTD_compressBlock_fast,</td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">          ZSTD_compressBlock_doubleFast,</td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line">          ZSTD_compressBlock_greedy,</td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line">          ZSTD_compressBlock_lazy,</td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line">          ZSTD_compressBlock_lazy2,</td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line">          ZSTD_compressBlock_btlazy2,</td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line">          ZSTD_compressBlock_btopt,</td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line">          ZSTD_compressBlock_btultra,</td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line">          ZSTD_compressBlock_btultra2 },</td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">        { ZSTD_compressBlock_fast_extDict  <span class='comment'>/* default for 0 */</span>,</td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line">          ZSTD_compressBlock_fast_extDict,</td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">          ZSTD_compressBlock_doubleFast_extDict,</td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">          ZSTD_compressBlock_greedy_extDict,</td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line">          ZSTD_compressBlock_lazy_extDict,</td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">          ZSTD_compressBlock_lazy2_extDict,</td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line">          ZSTD_compressBlock_btlazy2_extDict,</td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line">          ZSTD_compressBlock_btopt_extDict,</td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line">          ZSTD_compressBlock_btultra_extDict,</td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">          ZSTD_compressBlock_btultra_extDict },</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">        { ZSTD_compressBlock_fast_dictMatchState  <span class='comment'>/* default for 0 */</span>,</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">          ZSTD_compressBlock_fast_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">          ZSTD_compressBlock_doubleFast_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line">          ZSTD_compressBlock_greedy_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line">          ZSTD_compressBlock_lazy_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">          ZSTD_compressBlock_lazy2_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">          ZSTD_compressBlock_btlazy2_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">          ZSTD_compressBlock_btopt_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">          ZSTD_compressBlock_btultra_dictMatchState,</td></tr>
<tr class="codeline" data-linenumber="2215"><td class="num" id="LN2215">2215</td><td class="line">          ZSTD_compressBlock_btultra_dictMatchState }</td></tr>
<tr class="codeline" data-linenumber="2216"><td class="num" id="LN2216">2216</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="2217"><td class="num" id="LN2217">2217</td><td class="line">    ZSTD_blockCompressor selectedCompressor;</td></tr>
<tr class="codeline" data-linenumber="2218"><td class="num" id="LN2218">2218</td><td class="line">    <span class='macro'>ZSTD_STATIC_ASSERT((<span class='keyword'>unsigned</span>)ZSTD_fast == 1)<span class='macro_popup'>(void)sizeof(char[((unsigned)ZSTD_fast == 1) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2219"><td class="num" id="LN2219">2219</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2220"><td class="num" id="LN2220">2220</td><td class="line">    <span class='macro'>assert(ZSTD_cParam_withinBounds(ZSTD_c_strategy, strat))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2221"><td class="num" id="LN2221">2221</td><td class="line">    selectedCompressor = blockCompressor[(<span class='keyword'>int</span>)dictMode][(<span class='keyword'>int</span>)strat];</td></tr>
<tr class="codeline" data-linenumber="2222"><td class="num" id="LN2222">2222</td><td class="line">    <span class='macro'>assert(selectedCompressor != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2223"><td class="num" id="LN2223">2223</td><td class="line">    <span class='keyword'>return</span> selectedCompressor;</td></tr>
<tr class="codeline" data-linenumber="2224"><td class="num" id="LN2224">2224</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2225"><td class="num" id="LN2225">2225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2226"><td class="num" id="LN2226">2226</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_storeLastLiterals(seqStore_t* seqStorePtr,</td></tr>
<tr class="codeline" data-linenumber="2227"><td class="num" id="LN2227">2227</td><td class="line">                                   <span class='keyword'>const</span> BYTE* anchor, size_t lastLLSize)</td></tr>
<tr class="codeline" data-linenumber="2228"><td class="num" id="LN2228">2228</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2229"><td class="num" id="LN2229">2229</td><td class="line">    memcpy(seqStorePtr-&gt;lit, anchor, lastLLSize);</td></tr>
<tr class="codeline" data-linenumber="2230"><td class="num" id="LN2230">2230</td><td class="line">    seqStorePtr-&gt;lit += lastLLSize;</td></tr>
<tr class="codeline" data-linenumber="2231"><td class="num" id="LN2231">2231</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2232"><td class="num" id="LN2232">2232</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2233"><td class="num" id="LN2233">2233</td><td class="line"><span class='keyword'>void</span> ZSTD_resetSeqStore(seqStore_t* ssPtr)</td></tr>
<tr class="codeline" data-linenumber="2234"><td class="num" id="LN2234">2234</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2235"><td class="num" id="LN2235">2235</td><td class="line">    ssPtr-&gt;lit = ssPtr-&gt;litStart;</td></tr>
<tr class="codeline" data-linenumber="2236"><td class="num" id="LN2236">2236</td><td class="line">    ssPtr-&gt;sequences = ssPtr-&gt;sequencesStart;</td></tr>
<tr class="codeline" data-linenumber="2237"><td class="num" id="LN2237">2237</td><td class="line">    ssPtr-&gt;longLengthID = 0;</td></tr>
<tr class="codeline" data-linenumber="2238"><td class="num" id="LN2238">2238</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2239"><td class="num" id="LN2239">2239</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2240"><td class="num" id="LN2240">2240</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span> { ZSTDbss_compress, ZSTDbss_noCompress } ZSTD_buildSeqStore_e;</td></tr>
<tr class="codeline" data-linenumber="2241"><td class="num" id="LN2241">2241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2242"><td class="num" id="LN2242">2242</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_buildSeqStore(ZSTD_CCtx* zc, <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize)</td></tr>
<tr class="codeline" data-linenumber="2243"><td class="num" id="LN2243">2243</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2244"><td class="num" id="LN2244">2244</td><td class="line">    ZSTD_matchState_t* <span class='keyword'>const</span> ms = &amp;zc-&gt;blockState.matchState;</td></tr>
<tr class="codeline" data-linenumber="2245"><td class="num" id="LN2245">2245</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_buildSeqStore (srcSize=%zu)"</span>, srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2246"><td class="num" id="LN2246">2246</td><td class="line">    <span class='macro'>assert(srcSize &lt;= ZSTD_BLOCKSIZE_MAX)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2247"><td class="num" id="LN2247">2247</td><td class="line">    <span class='comment'>/* Assert that we have correctly flushed the ctx params into the ms's copy */</span></td></tr>
<tr class="codeline" data-linenumber="2248"><td class="num" id="LN2248">2248</td><td class="line">    ZSTD_assertEqualCParams(zc-&gt;appliedParams.cParams, ms-&gt;cParams);</td></tr>
<tr class="codeline" data-linenumber="2249"><td class="num" id="LN2249">2249</td><td class="line">    <span class='keyword'>if</span> (srcSize &lt; <span class='macro'>MIN_CBLOCK_SIZE<span class='macro_popup'>(1 + 1 + 1 )</span></span>+ZSTD_blockHeaderSize+1) {</td></tr>
<tr class="codeline" data-linenumber="2250"><td class="num" id="LN2250">2250</td><td class="line">        ZSTD_ldm_skipSequences(&amp;zc-&gt;externSeqStore, srcSize, zc-&gt;appliedParams.cParams.minMatch);</td></tr>
<tr class="codeline" data-linenumber="2251"><td class="num" id="LN2251">2251</td><td class="line">        <span class='keyword'>return</span> ZSTDbss_noCompress; <span class='comment'>/* don't even attempt compression below a certain srcSize */</span></td></tr>
<tr class="codeline" data-linenumber="2252"><td class="num" id="LN2252">2252</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2253"><td class="num" id="LN2253">2253</td><td class="line">    ZSTD_resetSeqStore(&amp;(zc-&gt;seqStore));</td></tr>
<tr class="codeline" data-linenumber="2254"><td class="num" id="LN2254">2254</td><td class="line">    <span class='comment'>/* required for optimal parser to read stats from dictionary */</span></td></tr>
<tr class="codeline" data-linenumber="2255"><td class="num" id="LN2255">2255</td><td class="line">    ms-&gt;opt.symbolCosts = &amp;zc-&gt;blockState.prevCBlock-&gt;entropy;</td></tr>
<tr class="codeline" data-linenumber="2256"><td class="num" id="LN2256">2256</td><td class="line">    <span class='comment'>/* tell the optimal parser how we expect to compress literals */</span></td></tr>
<tr class="codeline" data-linenumber="2257"><td class="num" id="LN2257">2257</td><td class="line">    ms-&gt;opt.literalCompressionMode = zc-&gt;appliedParams.literalCompressionMode;</td></tr>
<tr class="codeline" data-linenumber="2258"><td class="num" id="LN2258">2258</td><td class="line">    <span class='comment'>/* a gap between an attached dict and the current window is not safe,</span></td></tr>
<tr class="codeline" data-linenumber="2259"><td class="num" id="LN2259">2259</td><td class="line">     <span class='comment'>* they must remain adjacent,</span></td></tr>
<tr class="codeline" data-linenumber="2260"><td class="num" id="LN2260">2260</td><td class="line">     <span class='comment'>* and when that stops being the case, the dict must be unset */</span></td></tr>
<tr class="codeline" data-linenumber="2261"><td class="num" id="LN2261">2261</td><td class="line">    <span class='macro'>assert(ms-&gt;dictMatchState == NULL || ms-&gt;loadedDictEnd == ms-&gt;window.dictLimit)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2262"><td class="num" id="LN2262">2262</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2263"><td class="num" id="LN2263">2263</td><td class="line">    <span class='comment'>/* limited update after a very long match */</span></td></tr>
<tr class="codeline" data-linenumber="2264"><td class="num" id="LN2264">2264</td><td class="line">    {   <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> base = ms-&gt;window.base;</td></tr>
<tr class="codeline" data-linenumber="2265"><td class="num" id="LN2265">2265</td><td class="line">        <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> istart = (<span class='keyword'>const</span> BYTE*)src;</td></tr>
<tr class="codeline" data-linenumber="2266"><td class="num" id="LN2266">2266</td><td class="line">        <span class='keyword'>const</span> U32 current = (U32)(istart-base);</td></tr>
<tr class="codeline" data-linenumber="2267"><td class="num" id="LN2267">2267</td><td class="line">        <span class='keyword'>if</span> (<span class='keyword'>sizeof</span>(ptrdiff_t)==8) <span class='macro'>assert(istart - base &lt; (ptrdiff_t)(U32)(-1))<span class='macro_popup'>((void)0)</span></span>;   <span class='comment'>/* ensure no overflow */</span></td></tr>
<tr class="codeline" data-linenumber="2268"><td class="num" id="LN2268">2268</td><td class="line">        <span class='keyword'>if</span> (current &gt; ms-&gt;nextToUpdate + 384)</td></tr>
<tr class="codeline" data-linenumber="2269"><td class="num" id="LN2269">2269</td><td class="line">            ms-&gt;nextToUpdate = current - <span class='macro'>MIN(192, (U32)(current - ms-&gt;nextToUpdate - 384))<span class='macro_popup'>((192)&lt;((U32)(current - ms-&gt;nextToUpdate - 384)) ? (192<br>) : ((U32)(current - ms-&gt;nextToUpdate - 384)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2270"><td class="num" id="LN2270">2270</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2271"><td class="num" id="LN2271">2271</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2272"><td class="num" id="LN2272">2272</td><td class="line">    <span class='comment'>/* select and store sequences */</span></td></tr>
<tr class="codeline" data-linenumber="2273"><td class="num" id="LN2273">2273</td><td class="line">    {   ZSTD_dictMode_e <span class='keyword'>const</span> dictMode = ZSTD_matchState_dictMode(ms);</td></tr>
<tr class="codeline" data-linenumber="2274"><td class="num" id="LN2274">2274</td><td class="line">        size_t lastLLSize;</td></tr>
<tr class="codeline" data-linenumber="2275"><td class="num" id="LN2275">2275</td><td class="line">        {   <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2276"><td class="num" id="LN2276">2276</td><td class="line">            <span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>ZSTD_REP_NUM<span class='macro_popup'>3</span></span>; ++i)</td></tr>
<tr class="codeline" data-linenumber="2277"><td class="num" id="LN2277">2277</td><td class="line">                zc-&gt;blockState.nextCBlock-&gt;rep[i] = zc-&gt;blockState.prevCBlock-&gt;rep[i];</td></tr>
<tr class="codeline" data-linenumber="2278"><td class="num" id="LN2278">2278</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2279"><td class="num" id="LN2279">2279</td><td class="line">        <span class='keyword'>if</span> (zc-&gt;externSeqStore.pos &lt; zc-&gt;externSeqStore.size) {</td></tr>
<tr class="codeline" data-linenumber="2280"><td class="num" id="LN2280">2280</td><td class="line">            <span class='macro'>assert(!zc-&gt;appliedParams.ldmParams.enableLdm)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2281"><td class="num" id="LN2281">2281</td><td class="line">            <span class='comment'>/* Updates ldmSeqStore.pos */</span></td></tr>
<tr class="codeline" data-linenumber="2282"><td class="num" id="LN2282">2282</td><td class="line">            lastLLSize =</td></tr>
<tr class="codeline" data-linenumber="2283"><td class="num" id="LN2283">2283</td><td class="line">                ZSTD_ldm_blockCompress(&amp;zc-&gt;externSeqStore,</td></tr>
<tr class="codeline" data-linenumber="2284"><td class="num" id="LN2284">2284</td><td class="line">                                       ms, &amp;zc-&gt;seqStore,</td></tr>
<tr class="codeline" data-linenumber="2285"><td class="num" id="LN2285">2285</td><td class="line">                                       zc-&gt;blockState.nextCBlock-&gt;rep,</td></tr>
<tr class="codeline" data-linenumber="2286"><td class="num" id="LN2286">2286</td><td class="line">                                       src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2287"><td class="num" id="LN2287">2287</td><td class="line">            <span class='macro'>assert(zc-&gt;externSeqStore.pos &lt;= zc-&gt;externSeqStore.size)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2288"><td class="num" id="LN2288">2288</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (zc-&gt;appliedParams.ldmParams.enableLdm) {</td></tr>
<tr class="codeline" data-linenumber="2289"><td class="num" id="LN2289">2289</td><td class="line">            rawSeqStore_t ldmSeqStore = {<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, 0, 0};</td></tr>
<tr class="codeline" data-linenumber="2290"><td class="num" id="LN2290">2290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2291"><td class="num" id="LN2291">2291</td><td class="line">            ldmSeqStore.seq = zc-&gt;ldmSequences;</td></tr>
<tr class="codeline" data-linenumber="2292"><td class="num" id="LN2292">2292</td><td class="line">            ldmSeqStore.capacity = zc-&gt;maxNbLdmSequences;</td></tr>
<tr class="codeline" data-linenumber="2293"><td class="num" id="LN2293">2293</td><td class="line">            <span class='comment'>/* Updates ldmSeqStore.size */</span></td></tr>
<tr class="codeline" data-linenumber="2294"><td class="num" id="LN2294">2294</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR(ZSTD_ldm_generateSequences(&amp;zc-&gt;ldmState, &amp;ldmSeqStore,<span class='macro_popup'>do { size_t const err_code = (ZSTD_ldm_generateSequences(&amp;<br>zc-&gt;ldmState, &amp;ldmSeqStore, &amp;zc-&gt;appliedParams.<br>ldmParams, src, srcSize)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="2295"><td class="num" id="LN2295">2295</td><td class="line">                                               <span class='macro'>&amp;zc-&gt;appliedParams.ldmParams,<span class='macro_popup'>do { size_t const err_code = (ZSTD_ldm_generateSequences(&amp;<br>zc-&gt;ldmState, &amp;ldmSeqStore, &amp;zc-&gt;appliedParams.<br>ldmParams, src, srcSize)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="2296"><td class="num" id="LN2296">2296</td><td class="line">                                               <span class='macro'>src, srcSize), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_ldm_generateSequences(&amp;<br>zc-&gt;ldmState, &amp;ldmSeqStore, &amp;zc-&gt;appliedParams.<br>ldmParams, src, srcSize)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2297"><td class="num" id="LN2297">2297</td><td class="line">            <span class='comment'>/* Updates ldmSeqStore.pos */</span></td></tr>
<tr class="codeline" data-linenumber="2298"><td class="num" id="LN2298">2298</td><td class="line">            lastLLSize =</td></tr>
<tr class="codeline" data-linenumber="2299"><td class="num" id="LN2299">2299</td><td class="line">                ZSTD_ldm_blockCompress(&amp;ldmSeqStore,</td></tr>
<tr class="codeline" data-linenumber="2300"><td class="num" id="LN2300">2300</td><td class="line">                                       ms, &amp;zc-&gt;seqStore,</td></tr>
<tr class="codeline" data-linenumber="2301"><td class="num" id="LN2301">2301</td><td class="line">                                       zc-&gt;blockState.nextCBlock-&gt;rep,</td></tr>
<tr class="codeline" data-linenumber="2302"><td class="num" id="LN2302">2302</td><td class="line">                                       src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2303"><td class="num" id="LN2303">2303</td><td class="line">            <span class='macro'>assert(ldmSeqStore.pos == ldmSeqStore.size)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2304"><td class="num" id="LN2304">2304</td><td class="line">        } <span class='keyword'>else</span> {   <span class='comment'>/* not long range mode */</span></td></tr>
<tr class="codeline" data-linenumber="2305"><td class="num" id="LN2305">2305</td><td class="line">            ZSTD_blockCompressor <span class='keyword'>const</span> blockCompressor = ZSTD_selectBlockCompressor(zc-&gt;appliedParams.cParams.strategy, dictMode);</td></tr>
<tr class="codeline" data-linenumber="2306"><td class="num" id="LN2306">2306</td><td class="line">            lastLLSize = blockCompressor(ms, &amp;zc-&gt;seqStore, zc-&gt;blockState.nextCBlock-&gt;rep, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2307"><td class="num" id="LN2307">2307</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2308"><td class="num" id="LN2308">2308</td><td class="line">        {   <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> lastLiterals = (<span class='keyword'>const</span> BYTE*)src + srcSize - lastLLSize;</td></tr>
<tr class="codeline" data-linenumber="2309"><td class="num" id="LN2309">2309</td><td class="line">            ZSTD_storeLastLiterals(&amp;zc-&gt;seqStore, lastLiterals, lastLLSize);</td></tr>
<tr class="codeline" data-linenumber="2310"><td class="num" id="LN2310">2310</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="2311"><td class="num" id="LN2311">2311</td><td class="line">    <span class='keyword'>return</span> ZSTDbss_compress;</td></tr>
<tr class="codeline" data-linenumber="2312"><td class="num" id="LN2312">2312</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2313"><td class="num" id="LN2313">2313</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2314"><td class="num" id="LN2314">2314</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_copyBlockSequences(ZSTD_CCtx* zc)</td></tr>
<tr class="codeline" data-linenumber="2315"><td class="num" id="LN2315">2315</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2316"><td class="num" id="LN2316">2316</td><td class="line">    <span class='keyword'>const</span> seqStore_t* seqStore = ZSTD_getSeqStore(zc);</td></tr>
<tr class="codeline" data-linenumber="2317"><td class="num" id="LN2317">2317</td><td class="line">    <span class='keyword'>const</span> seqDef* seqs = seqStore-&gt;sequencesStart;</td></tr>
<tr class="codeline" data-linenumber="2318"><td class="num" id="LN2318">2318</td><td class="line">    size_t seqsSize = seqStore-&gt;sequences - seqs;</td></tr>
<tr class="codeline" data-linenumber="2319"><td class="num" id="LN2319">2319</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2320"><td class="num" id="LN2320">2320</td><td class="line">    ZSTD_Sequence* outSeqs = &amp;zc-&gt;seqCollector.seqStart[zc-&gt;seqCollector.seqIndex];</td></tr>
<tr class="codeline" data-linenumber="2321"><td class="num" id="LN2321">2321</td><td class="line">    size_t i; size_t position; <span class='keyword'>int</span> repIdx;</td></tr>
<tr class="codeline" data-linenumber="2322"><td class="num" id="LN2322">2322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2323"><td class="num" id="LN2323">2323</td><td class="line">    <span class='macro'>assert(zc-&gt;seqCollector.seqIndex + 1 &lt; zc-&gt;seqCollector.maxSequences)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2324"><td class="num" id="LN2324">2324</td><td class="line">    <span class='keyword'>for</span> (i = 0, position = 0; i &lt; seqsSize; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2325"><td class="num" id="LN2325">2325</td><td class="line">        outSeqs[i].offset = seqs[i].offset;</td></tr>
<tr class="codeline" data-linenumber="2326"><td class="num" id="LN2326">2326</td><td class="line">        outSeqs[i].litLength = seqs[i].litLength;</td></tr>
<tr class="codeline" data-linenumber="2327"><td class="num" id="LN2327">2327</td><td class="line">        outSeqs[i].matchLength = seqs[i].matchLength + <span class='macro'>MINMATCH<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2328"><td class="num" id="LN2328">2328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2329"><td class="num" id="LN2329">2329</td><td class="line">        <span class='keyword'>if</span> (i == seqStore-&gt;longLengthPos) {</td></tr>
<tr class="codeline" data-linenumber="2330"><td class="num" id="LN2330">2330</td><td class="line">            <span class='keyword'>if</span> (seqStore-&gt;longLengthID == 1) {</td></tr>
<tr class="codeline" data-linenumber="2331"><td class="num" id="LN2331">2331</td><td class="line">                outSeqs[i].litLength += 0x10000;</td></tr>
<tr class="codeline" data-linenumber="2332"><td class="num" id="LN2332">2332</td><td class="line">            } <span class='keyword'>else</span> <span class='keyword'>if</span> (seqStore-&gt;longLengthID == 2) {</td></tr>
<tr class="codeline" data-linenumber="2333"><td class="num" id="LN2333">2333</td><td class="line">                outSeqs[i].matchLength += 0x10000;</td></tr>
<tr class="codeline" data-linenumber="2334"><td class="num" id="LN2334">2334</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2335"><td class="num" id="LN2335">2335</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2336"><td class="num" id="LN2336">2336</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2337"><td class="num" id="LN2337">2337</td><td class="line">        <span class='keyword'>if</span> (outSeqs[i].offset &lt;= <span class='macro'>ZSTD_REP_NUM<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2338"><td class="num" id="LN2338">2338</td><td class="line">            outSeqs[i].rep = outSeqs[i].offset;</td></tr>
<tr class="codeline" data-linenumber="2339"><td class="num" id="LN2339">2339</td><td class="line">            repIdx = (<span class='keyword'>unsigned</span> <span class='keyword'>int</span>)i - outSeqs[i].offset;</td></tr>
<tr class="codeline" data-linenumber="2340"><td class="num" id="LN2340">2340</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2341"><td class="num" id="LN2341">2341</td><td class="line">            <span class='keyword'>if</span> (outSeqs[i].litLength == 0) {</td></tr>
<tr class="codeline" data-linenumber="2342"><td class="num" id="LN2342">2342</td><td class="line">                <span class='keyword'>if</span> (outSeqs[i].offset &lt; 3) {</td></tr>
<tr class="codeline" data-linenumber="2343"><td class="num" id="LN2343">2343</td><td class="line">                    --repIdx;</td></tr>
<tr class="codeline" data-linenumber="2344"><td class="num" id="LN2344">2344</td><td class="line">                } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2345"><td class="num" id="LN2345">2345</td><td class="line">                    repIdx = (<span class='keyword'>unsigned</span> <span class='keyword'>int</span>)i - 1;</td></tr>
<tr class="codeline" data-linenumber="2346"><td class="num" id="LN2346">2346</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2347"><td class="num" id="LN2347">2347</td><td class="line">                ++outSeqs[i].rep;</td></tr>
<tr class="codeline" data-linenumber="2348"><td class="num" id="LN2348">2348</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2349"><td class="num" id="LN2349">2349</td><td class="line">            <span class='macro'>assert(repIdx &gt;= -3)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2350"><td class="num" id="LN2350">2350</td><td class="line">            outSeqs[i].offset = repIdx &gt;= 0 ? outSeqs[repIdx].offset : repStartValue[-repIdx - 1];</td></tr>
<tr class="codeline" data-linenumber="2351"><td class="num" id="LN2351">2351</td><td class="line">            <span class='keyword'>if</span> (outSeqs[i].rep == 4) {</td></tr>
<tr class="codeline" data-linenumber="2352"><td class="num" id="LN2352">2352</td><td class="line">                --outSeqs[i].offset;</td></tr>
<tr class="codeline" data-linenumber="2353"><td class="num" id="LN2353">2353</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2354"><td class="num" id="LN2354">2354</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2355"><td class="num" id="LN2355">2355</td><td class="line">            outSeqs[i].offset -= <span class='macro'>ZSTD_REP_NUM<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2356"><td class="num" id="LN2356">2356</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2357"><td class="num" id="LN2357">2357</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2358"><td class="num" id="LN2358">2358</td><td class="line">        position += outSeqs[i].litLength;</td></tr>
<tr class="codeline" data-linenumber="2359"><td class="num" id="LN2359">2359</td><td class="line">        outSeqs[i].matchPos = (<span class='keyword'>unsigned</span> <span class='keyword'>int</span>)position;</td></tr>
<tr class="codeline" data-linenumber="2360"><td class="num" id="LN2360">2360</td><td class="line">        position += outSeqs[i].matchLength;</td></tr>
<tr class="codeline" data-linenumber="2361"><td class="num" id="LN2361">2361</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2362"><td class="num" id="LN2362">2362</td><td class="line">    zc-&gt;seqCollector.seqIndex += seqsSize;</td></tr>
<tr class="codeline" data-linenumber="2363"><td class="num" id="LN2363">2363</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2364"><td class="num" id="LN2364">2364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2365"><td class="num" id="LN2365">2365</td><td class="line">size_t ZSTD_getSequences(ZSTD_CCtx* zc, ZSTD_Sequence* outSeqs,</td></tr>
<tr class="codeline" data-linenumber="2366"><td class="num" id="LN2366">2366</td><td class="line">    size_t outSeqsSize, <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize)</td></tr>
<tr class="codeline" data-linenumber="2367"><td class="num" id="LN2367">2367</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2368"><td class="num" id="LN2368">2368</td><td class="line">    <span class='keyword'>const</span> size_t dstCapacity = ZSTD_compressBound(srcSize);</td></tr>
<tr class="codeline" data-linenumber="2369"><td class="num" id="LN2369">2369</td><td class="line">    <span class='keyword'>void</span>* dst = ZSTD_malloc(dstCapacity, ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="2370"><td class="num" id="LN2370">2370</td><td class="line">    SeqCollector seqCollector;</td></tr>
<tr class="codeline" data-linenumber="2371"><td class="num" id="LN2371">2371</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2372"><td class="num" id="LN2372">2372</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(dst == NULL, memory_allocation, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (dst == ((void*)0)) { {}; if (0) { _force_has_format_string<br>("NULL pointer!"); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2373"><td class="num" id="LN2373">2373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2374"><td class="num" id="LN2374">2374</td><td class="line">    seqCollector.collectSequences = 1;</td></tr>
<tr class="codeline" data-linenumber="2375"><td class="num" id="LN2375">2375</td><td class="line">    seqCollector.seqStart = outSeqs;</td></tr>
<tr class="codeline" data-linenumber="2376"><td class="num" id="LN2376">2376</td><td class="line">    seqCollector.seqIndex = 0;</td></tr>
<tr class="codeline" data-linenumber="2377"><td class="num" id="LN2377">2377</td><td class="line">    seqCollector.maxSequences = outSeqsSize;</td></tr>
<tr class="codeline" data-linenumber="2378"><td class="num" id="LN2378">2378</td><td class="line">    zc-&gt;seqCollector = seqCollector;</td></tr>
<tr class="codeline" data-linenumber="2379"><td class="num" id="LN2379">2379</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2380"><td class="num" id="LN2380">2380</td><td class="line">    ZSTD_compress2(zc, dst, dstCapacity, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2381"><td class="num" id="LN2381">2381</td><td class="line">    ZSTD_free(dst, ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="2382"><td class="num" id="LN2382">2382</td><td class="line">    <span class='keyword'>return</span> zc-&gt;seqCollector.seqIndex;</td></tr>
<tr class="codeline" data-linenumber="2383"><td class="num" id="LN2383">2383</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2384"><td class="num" id="LN2384">2384</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2385"><td class="num" id="LN2385">2385</td><td class="line"><span class='comment'>/* Returns true if the given block is a RLE block */</span></td></tr>
<tr class="codeline" data-linenumber="2386"><td class="num" id="LN2386">2386</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ZSTD_isRLE(<span class='keyword'>const</span> BYTE *ip, size_t length) {</td></tr>
<tr class="codeline" data-linenumber="2387"><td class="num" id="LN2387">2387</td><td class="line">    size_t i;</td></tr>
<tr class="codeline" data-linenumber="2388"><td class="num" id="LN2388">2388</td><td class="line">    <span class='keyword'>if</span> (length &lt; 2) <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2389"><td class="num" id="LN2389">2389</td><td class="line">    <span class='keyword'>for</span> (i = 1; i &lt; length; ++i) {</td></tr>
<tr class="codeline" data-linenumber="2390"><td class="num" id="LN2390">2390</td><td class="line">        <span class='keyword'>if</span> (ip[0] != ip[i]) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2391"><td class="num" id="LN2391">2391</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2392"><td class="num" id="LN2392">2392</td><td class="line">    <span class='keyword'>return</span> 1;</td></tr>
<tr class="codeline" data-linenumber="2393"><td class="num" id="LN2393">2393</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2394"><td class="num" id="LN2394">2394</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2395"><td class="num" id="LN2395">2395</td><td class="line"><span class='comment'>/* Returns true if the given block may be RLE.</span></td></tr>
<tr class="codeline" data-linenumber="2396"><td class="num" id="LN2396">2396</td><td class="line"> <span class='comment'>* This is just a heuristic based on the compressibility.</span></td></tr>
<tr class="codeline" data-linenumber="2397"><td class="num" id="LN2397">2397</td><td class="line"> <span class='comment'>* It may return both false positives and false negatives.</span></td></tr>
<tr class="codeline" data-linenumber="2398"><td class="num" id="LN2398">2398</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2399"><td class="num" id="LN2399">2399</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> ZSTD_maybeRLE(seqStore_t <span class='keyword'>const</span>* seqStore)</td></tr>
<tr class="codeline" data-linenumber="2400"><td class="num" id="LN2400">2400</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2401"><td class="num" id="LN2401">2401</td><td class="line">    size_t <span class='keyword'>const</span> nbSeqs = (size_t)(seqStore-&gt;sequences - seqStore-&gt;sequencesStart);</td></tr>
<tr class="codeline" data-linenumber="2402"><td class="num" id="LN2402">2402</td><td class="line">    size_t <span class='keyword'>const</span> nbLits = (size_t)(seqStore-&gt;lit - seqStore-&gt;litStart);</td></tr>
<tr class="codeline" data-linenumber="2403"><td class="num" id="LN2403">2403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2404"><td class="num" id="LN2404">2404</td><td class="line">    <span class='keyword'>return</span> nbSeqs &lt; 4 &amp;&amp; nbLits &lt; 10;</td></tr>
<tr class="codeline" data-linenumber="2405"><td class="num" id="LN2405">2405</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2406"><td class="num" id="LN2406">2406</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2407"><td class="num" id="LN2407">2407</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_confirmRepcodesAndEntropyTables(ZSTD_CCtx* zc)</td></tr>
<tr class="codeline" data-linenumber="2408"><td class="num" id="LN2408">2408</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2409"><td class="num" id="LN2409">2409</td><td class="line">    ZSTD_compressedBlockState_t* <span class='keyword'>const</span> tmp = zc-&gt;blockState.prevCBlock;</td></tr>
<tr class="codeline" data-linenumber="2410"><td class="num" id="LN2410">2410</td><td class="line">    zc-&gt;blockState.prevCBlock = zc-&gt;blockState.nextCBlock;</td></tr>
<tr class="codeline" data-linenumber="2411"><td class="num" id="LN2411">2411</td><td class="line">    zc-&gt;blockState.nextCBlock = tmp;</td></tr>
<tr class="codeline" data-linenumber="2412"><td class="num" id="LN2412">2412</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2413"><td class="num" id="LN2413">2413</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2414"><td class="num" id="LN2414">2414</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compressBlock_internal(ZSTD_CCtx* zc,</td></tr>
<tr class="codeline" data-linenumber="2415"><td class="num" id="LN2415">2415</td><td class="line">                                        <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2416"><td class="num" id="LN2416">2416</td><td class="line">                                        <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize, U32 frame)</td></tr>
<tr class="codeline" data-linenumber="2417"><td class="num" id="LN2417">2417</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2418"><td class="num" id="LN2418">2418</td><td class="line">    <span class='comment'>/* This the upper bound for the length of an rle block.</span></td></tr>
<tr class="codeline" data-linenumber="2419"><td class="num" id="LN2419">2419</td><td class="line">     <span class='comment'>* This isn't the actual upper bound. Finding the real threshold</span></td></tr>
<tr class="codeline" data-linenumber="2420"><td class="num" id="LN2420">2420</td><td class="line">     <span class='comment'>* needs further investigation.</span></td></tr>
<tr class="codeline" data-linenumber="2421"><td class="num" id="LN2421">2421</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2422"><td class="num" id="LN2422">2422</td><td class="line">    <span class='keyword'>const</span> U32 rleMaxLength = 25;</td></tr>
<tr class="codeline" data-linenumber="2423"><td class="num" id="LN2423">2423</td><td class="line">    size_t cSize;</td></tr>
<tr class="codeline" data-linenumber="2424"><td class="num" id="LN2424">2424</td><td class="line">    <span class='keyword'>const</span> BYTE* ip = (<span class='keyword'>const</span> BYTE*)src;</td></tr>
<tr class="codeline" data-linenumber="2425"><td class="num" id="LN2425">2425</td><td class="line">    BYTE* op = (BYTE*)dst;</td></tr>
<tr class="codeline" data-linenumber="2426"><td class="num" id="LN2426">2426</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressBlock_internal (dstCapacity=%u, dictLimit=%u, nextToUpdate=%u)"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="2427"><td class="num" id="LN2427">2427</td><td class="line">                <span class='macro'>(<span class='keyword'>unsigned</span>)dstCapacity, (<span class='keyword'>unsigned</span>)zc-&gt;blockState.matchState.window.dictLimit,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="2428"><td class="num" id="LN2428">2428</td><td class="line">                <span class='macro'>(<span class='keyword'>unsigned</span>)zc-&gt;blockState.matchState.nextToUpdate)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2429"><td class="num" id="LN2429">2429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2430"><td class="num" id="LN2430">2430</td><td class="line">    {   <span class='keyword'>const</span> size_t bss = ZSTD_buildSeqStore(zc, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2431"><td class="num" id="LN2431">2431</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(bss, <span class='string_literal'>"ZSTD_buildSeqStore failed"</span>)<span class='macro_popup'>do { size_t const err_code = (bss); if (ERR_isError(err_code)<br>) { {}; if (0) { _force_has_format_string("ZSTD_buildSeqStore failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2432"><td class="num" id="LN2432">2432</td><td class="line">        <span class='keyword'>if</span> (bss == ZSTDbss_noCompress) { cSize = 0; <span class='keyword'>goto</span> out; }</td></tr>
<tr class="codeline" data-linenumber="2433"><td class="num" id="LN2433">2433</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2434"><td class="num" id="LN2434">2434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2435"><td class="num" id="LN2435">2435</td><td class="line">    <span class='keyword'>if</span> (zc-&gt;seqCollector.collectSequences) {</td></tr>
<tr class="codeline" data-linenumber="2436"><td class="num" id="LN2436">2436</td><td class="line">        ZSTD_copyBlockSequences(zc);</td></tr>
<tr class="codeline" data-linenumber="2437"><td class="num" id="LN2437">2437</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2438"><td class="num" id="LN2438">2438</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2439"><td class="num" id="LN2439">2439</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2440"><td class="num" id="LN2440">2440</td><td class="line">    <span class='comment'>/* encode sequences and literals */</span></td></tr>
<tr class="codeline" data-linenumber="2441"><td class="num" id="LN2441">2441</td><td class="line">    cSize = ZSTD_compressSequences(&amp;zc-&gt;seqStore,</td></tr>
<tr class="codeline" data-linenumber="2442"><td class="num" id="LN2442">2442</td><td class="line">            &amp;zc-&gt;blockState.prevCBlock-&gt;entropy, &amp;zc-&gt;blockState.nextCBlock-&gt;entropy,</td></tr>
<tr class="codeline" data-linenumber="2443"><td class="num" id="LN2443">2443</td><td class="line">            &amp;zc-&gt;appliedParams,</td></tr>
<tr class="codeline" data-linenumber="2444"><td class="num" id="LN2444">2444</td><td class="line">            dst, dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2445"><td class="num" id="LN2445">2445</td><td class="line">            srcSize,</td></tr>
<tr class="codeline" data-linenumber="2446"><td class="num" id="LN2446">2446</td><td class="line">            zc-&gt;entropyWorkspace, <span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span> <span class='comment'>/* statically allocated in resetCCtx */</span>,</td></tr>
<tr class="codeline" data-linenumber="2447"><td class="num" id="LN2447">2447</td><td class="line">            zc-&gt;bmi2);</td></tr>
<tr class="codeline" data-linenumber="2448"><td class="num" id="LN2448">2448</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2449"><td class="num" id="LN2449">2449</td><td class="line">    <span class='keyword'>if</span> (frame &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2450"><td class="num" id="LN2450">2450</td><td class="line">        <span class='comment'>/* We don't want to emit our first block as a RLE even if it qualifies because</span></td></tr>
<tr class="codeline" data-linenumber="2451"><td class="num" id="LN2451">2451</td><td class="line">         <span class='comment'>* doing so will cause the decoder (cli only) to throw a "should consume all input error."</span></td></tr>
<tr class="codeline" data-linenumber="2452"><td class="num" id="LN2452">2452</td><td class="line">         <span class='comment'>* This is only an issue for zstd &lt;= v1.4.3</span></td></tr>
<tr class="codeline" data-linenumber="2453"><td class="num" id="LN2453">2453</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2454"><td class="num" id="LN2454">2454</td><td class="line">        !zc-&gt;isFirstBlock &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2455"><td class="num" id="LN2455">2455</td><td class="line">        cSize &lt; rleMaxLength &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2456"><td class="num" id="LN2456">2456</td><td class="line">        ZSTD_isRLE(ip, srcSize))</td></tr>
<tr class="codeline" data-linenumber="2457"><td class="num" id="LN2457">2457</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2458"><td class="num" id="LN2458">2458</td><td class="line">        cSize = 1;</td></tr>
<tr class="codeline" data-linenumber="2459"><td class="num" id="LN2459">2459</td><td class="line">        op[0] = ip[0];</td></tr>
<tr class="codeline" data-linenumber="2460"><td class="num" id="LN2460">2460</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2461"><td class="num" id="LN2461">2461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2462"><td class="num" id="LN2462">2462</td><td class="line">out:</td></tr>
<tr class="codeline" data-linenumber="2463"><td class="num" id="LN2463">2463</td><td class="line">    <span class='keyword'>if</span> (!<span class='macro'>ZSTD_isError<span class='macro_popup'>ERR_isError</span></span>(cSize) &amp;&amp; cSize &gt; 1) {</td></tr>
<tr class="codeline" data-linenumber="2464"><td class="num" id="LN2464">2464</td><td class="line">        ZSTD_confirmRepcodesAndEntropyTables(zc);</td></tr>
<tr class="codeline" data-linenumber="2465"><td class="num" id="LN2465">2465</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2466"><td class="num" id="LN2466">2466</td><td class="line">    <span class='comment'>/* We check that dictionaries have offset codes available for the first</span></td></tr>
<tr class="codeline" data-linenumber="2467"><td class="num" id="LN2467">2467</td><td class="line">     <span class='comment'>* block. After the first block, the offcode table might not have large</span></td></tr>
<tr class="codeline" data-linenumber="2468"><td class="num" id="LN2468">2468</td><td class="line">     <span class='comment'>* enough codes to represent the offsets in the data.</span></td></tr>
<tr class="codeline" data-linenumber="2469"><td class="num" id="LN2469">2469</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2470"><td class="num" id="LN2470">2470</td><td class="line">    <span class='keyword'>if</span> (zc-&gt;blockState.prevCBlock-&gt;entropy.fse.offcode_repeatMode == FSE_repeat_valid)</td></tr>
<tr class="codeline" data-linenumber="2471"><td class="num" id="LN2471">2471</td><td class="line">        zc-&gt;blockState.prevCBlock-&gt;entropy.fse.offcode_repeatMode = FSE_repeat_check;</td></tr>
<tr class="codeline" data-linenumber="2472"><td class="num" id="LN2472">2472</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2473"><td class="num" id="LN2473">2473</td><td class="line">    <span class='keyword'>return</span> cSize;</td></tr>
<tr class="codeline" data-linenumber="2474"><td class="num" id="LN2474">2474</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2475"><td class="num" id="LN2475">2475</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2476"><td class="num" id="LN2476">2476</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compressBlock_targetCBlockSize_body(ZSTD_CCtx* zc,</td></tr>
<tr class="codeline" data-linenumber="2477"><td class="num" id="LN2477">2477</td><td class="line">                               <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2478"><td class="num" id="LN2478">2478</td><td class="line">                               <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="2479"><td class="num" id="LN2479">2479</td><td class="line">                               <span class='keyword'>const</span> size_t bss, U32 lastBlock)</td></tr>
<tr class="codeline" data-linenumber="2480"><td class="num" id="LN2480">2480</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2481"><td class="num" id="LN2481">2481</td><td class="line">    <span class='macro'>DEBUGLOG(6, <span class='string_literal'>"Attempting ZSTD_compressSuperBlock()"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2482"><td class="num" id="LN2482">2482</td><td class="line">    <span class='keyword'>if</span> (bss == ZSTDbss_compress) {</td></tr>
<tr class="codeline" data-linenumber="2483"><td class="num" id="LN2483">2483</td><td class="line">        <span class='keyword'>if</span> (<span class='comment'>/* We don't want to emit our first block as a RLE even if it qualifies because</span></td></tr>
<tr class="codeline" data-linenumber="2484"><td class="num" id="LN2484">2484</td><td class="line">            <span class='comment'>* doing so will cause the decoder (cli only) to throw a "should consume all input error."</span></td></tr>
<tr class="codeline" data-linenumber="2485"><td class="num" id="LN2485">2485</td><td class="line">            <span class='comment'>* This is only an issue for zstd &lt;= v1.4.3</span></td></tr>
<tr class="codeline" data-linenumber="2486"><td class="num" id="LN2486">2486</td><td class="line">            <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2487"><td class="num" id="LN2487">2487</td><td class="line">            !zc-&gt;isFirstBlock &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2488"><td class="num" id="LN2488">2488</td><td class="line">            ZSTD_maybeRLE(&amp;zc-&gt;seqStore) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2489"><td class="num" id="LN2489">2489</td><td class="line">            ZSTD_isRLE((BYTE <span class='keyword'>const</span>*)src, srcSize))</td></tr>
<tr class="codeline" data-linenumber="2490"><td class="num" id="LN2490">2490</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2491"><td class="num" id="LN2491">2491</td><td class="line">            <span class='keyword'>return</span> ZSTD_rleCompressBlock(dst, dstCapacity, *(BYTE <span class='keyword'>const</span>*)src, srcSize, lastBlock);</td></tr>
<tr class="codeline" data-linenumber="2492"><td class="num" id="LN2492">2492</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2493"><td class="num" id="LN2493">2493</td><td class="line">        <span class='comment'>/* Attempt superblock compression.</span></td></tr>
<tr class="codeline" data-linenumber="2494"><td class="num" id="LN2494">2494</td><td class="line">         <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="2495"><td class="num" id="LN2495">2495</td><td class="line">         <span class='comment'>* Note that compressed size of ZSTD_compressSuperBlock() is not bound by the</span></td></tr>
<tr class="codeline" data-linenumber="2496"><td class="num" id="LN2496">2496</td><td class="line">         <span class='comment'>* standard ZSTD_compressBound(). This is a problem, because even if we have</span></td></tr>
<tr class="codeline" data-linenumber="2497"><td class="num" id="LN2497">2497</td><td class="line">         <span class='comment'>* space now, taking an extra byte now could cause us to run out of space later</span></td></tr>
<tr class="codeline" data-linenumber="2498"><td class="num" id="LN2498">2498</td><td class="line">         <span class='comment'>* and violate ZSTD_compressBound().</span></td></tr>
<tr class="codeline" data-linenumber="2499"><td class="num" id="LN2499">2499</td><td class="line">         <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="2500"><td class="num" id="LN2500">2500</td><td class="line">         <span class='comment'>* Define blockBound(blockSize) = blockSize + ZSTD_blockHeaderSize.</span></td></tr>
<tr class="codeline" data-linenumber="2501"><td class="num" id="LN2501">2501</td><td class="line">         <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="2502"><td class="num" id="LN2502">2502</td><td class="line">         <span class='comment'>* In order to respect ZSTD_compressBound() we must attempt to emit a raw</span></td></tr>
<tr class="codeline" data-linenumber="2503"><td class="num" id="LN2503">2503</td><td class="line">         <span class='comment'>* uncompressed block in these cases:</span></td></tr>
<tr class="codeline" data-linenumber="2504"><td class="num" id="LN2504">2504</td><td class="line">         <span class='comment'>*   * cSize == 0: Return code for an uncompressed block.</span></td></tr>
<tr class="codeline" data-linenumber="2505"><td class="num" id="LN2505">2505</td><td class="line">         <span class='comment'>*   * cSize == dstSize_tooSmall: We may have expanded beyond blockBound(srcSize).</span></td></tr>
<tr class="codeline" data-linenumber="2506"><td class="num" id="LN2506">2506</td><td class="line">         <span class='comment'>*     ZSTD_noCompressBlock() will return dstSize_tooSmall if we are really out of</span></td></tr>
<tr class="codeline" data-linenumber="2507"><td class="num" id="LN2507">2507</td><td class="line">         <span class='comment'>*     output space.</span></td></tr>
<tr class="codeline" data-linenumber="2508"><td class="num" id="LN2508">2508</td><td class="line">         <span class='comment'>*   * cSize &gt;= blockBound(srcSize): We have expanded the block too much so</span></td></tr>
<tr class="codeline" data-linenumber="2509"><td class="num" id="LN2509">2509</td><td class="line">         <span class='comment'>*     emit an uncompressed block.</span></td></tr>
<tr class="codeline" data-linenumber="2510"><td class="num" id="LN2510">2510</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2511"><td class="num" id="LN2511">2511</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2512"><td class="num" id="LN2512">2512</td><td class="line">            size_t <span class='keyword'>const</span> cSize = ZSTD_compressSuperBlock(zc, dst, dstCapacity, src, srcSize, lastBlock);</td></tr>
<tr class="codeline" data-linenumber="2513"><td class="num" id="LN2513">2513</td><td class="line">            <span class='keyword'>if</span> (cSize != <span class='macro'>ERROR(dstSize_tooSmall)<span class='macro_popup'>((size_t)-ZSTD_error_dstSize_tooSmall)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2514"><td class="num" id="LN2514">2514</td><td class="line">                size_t <span class='keyword'>const</span> maxCSize = srcSize - ZSTD_minGain(srcSize, zc-&gt;appliedParams.cParams.strategy);</td></tr>
<tr class="codeline" data-linenumber="2515"><td class="num" id="LN2515">2515</td><td class="line">                <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressSuperBlock failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressSuperBlock failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2516"><td class="num" id="LN2516">2516</td><td class="line">                <span class='keyword'>if</span> (cSize != 0 &amp;&amp; cSize &lt; maxCSize + ZSTD_blockHeaderSize) {</td></tr>
<tr class="codeline" data-linenumber="2517"><td class="num" id="LN2517">2517</td><td class="line">                    ZSTD_confirmRepcodesAndEntropyTables(zc);</td></tr>
<tr class="codeline" data-linenumber="2518"><td class="num" id="LN2518">2518</td><td class="line">                    <span class='keyword'>return</span> cSize;</td></tr>
<tr class="codeline" data-linenumber="2519"><td class="num" id="LN2519">2519</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2520"><td class="num" id="LN2520">2520</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2521"><td class="num" id="LN2521">2521</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2522"><td class="num" id="LN2522">2522</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2523"><td class="num" id="LN2523">2523</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2524"><td class="num" id="LN2524">2524</td><td class="line">    <span class='macro'>DEBUGLOG(6, <span class='string_literal'>"Resorting to ZSTD_noCompressBlock()"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2525"><td class="num" id="LN2525">2525</td><td class="line">    <span class='comment'>/* Superblock compression failed, attempt to emit a single no compress block.</span></td></tr>
<tr class="codeline" data-linenumber="2526"><td class="num" id="LN2526">2526</td><td class="line">     <span class='comment'>* The decoder will be able to stream this block since it is uncompressed.</span></td></tr>
<tr class="codeline" data-linenumber="2527"><td class="num" id="LN2527">2527</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2528"><td class="num" id="LN2528">2528</td><td class="line">    <span class='keyword'>return</span> ZSTD_noCompressBlock(dst, dstCapacity, src, srcSize, lastBlock);</td></tr>
<tr class="codeline" data-linenumber="2529"><td class="num" id="LN2529">2529</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2530"><td class="num" id="LN2530">2530</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2531"><td class="num" id="LN2531">2531</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compressBlock_targetCBlockSize(ZSTD_CCtx* zc,</td></tr>
<tr class="codeline" data-linenumber="2532"><td class="num" id="LN2532">2532</td><td class="line">                               <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2533"><td class="num" id="LN2533">2533</td><td class="line">                               <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="2534"><td class="num" id="LN2534">2534</td><td class="line">                               U32 lastBlock)</td></tr>
<tr class="codeline" data-linenumber="2535"><td class="num" id="LN2535">2535</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2536"><td class="num" id="LN2536">2536</td><td class="line">    size_t cSize = 0;</td></tr>
<tr class="codeline" data-linenumber="2537"><td class="num" id="LN2537">2537</td><td class="line">    <span class='keyword'>const</span> size_t bss = ZSTD_buildSeqStore(zc, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2538"><td class="num" id="LN2538">2538</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressBlock_targetCBlockSize (dstCapacity=%u, dictLimit=%u, nextToUpdate=%u, srcSize=%zu)"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="2539"><td class="num" id="LN2539">2539</td><td class="line">                <span class='macro'>(<span class='keyword'>unsigned</span>)dstCapacity, (<span class='keyword'>unsigned</span>)zc-&gt;blockState.matchState.window.dictLimit, (<span class='keyword'>unsigned</span>)zc-&gt;blockState.matchState.nextToUpdate, srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2540"><td class="num" id="LN2540">2540</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(bss, <span class='string_literal'>"ZSTD_buildSeqStore failed"</span>)<span class='macro_popup'>do { size_t const err_code = (bss); if (ERR_isError(err_code)<br>) { {}; if (0) { _force_has_format_string("ZSTD_buildSeqStore failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2541"><td class="num" id="LN2541">2541</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2542"><td class="num" id="LN2542">2542</td><td class="line">    cSize = ZSTD_compressBlock_targetCBlockSize_body(zc, dst, dstCapacity, src, srcSize, bss, lastBlock);</td></tr>
<tr class="codeline" data-linenumber="2543"><td class="num" id="LN2543">2543</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressBlock_targetCBlockSize_body failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressBlock_targetCBlockSize_body failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2544"><td class="num" id="LN2544">2544</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2545"><td class="num" id="LN2545">2545</td><td class="line">    <span class='keyword'>if</span> (zc-&gt;blockState.prevCBlock-&gt;entropy.fse.offcode_repeatMode == FSE_repeat_valid)</td></tr>
<tr class="codeline" data-linenumber="2546"><td class="num" id="LN2546">2546</td><td class="line">        zc-&gt;blockState.prevCBlock-&gt;entropy.fse.offcode_repeatMode = FSE_repeat_check;</td></tr>
<tr class="codeline" data-linenumber="2547"><td class="num" id="LN2547">2547</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2548"><td class="num" id="LN2548">2548</td><td class="line">    <span class='keyword'>return</span> cSize;</td></tr>
<tr class="codeline" data-linenumber="2549"><td class="num" id="LN2549">2549</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2550"><td class="num" id="LN2550">2550</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2551"><td class="num" id="LN2551">2551</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ZSTD_overflowCorrectIfNeeded(ZSTD_matchState_t* ms,</td></tr>
<tr class="codeline" data-linenumber="2552"><td class="num" id="LN2552">2552</td><td class="line">                                         ZSTD_cwksp* ws,</td></tr>
<tr class="codeline" data-linenumber="2553"><td class="num" id="LN2553">2553</td><td class="line">                                         ZSTD_CCtx_params <span class='keyword'>const</span>* params,</td></tr>
<tr class="codeline" data-linenumber="2554"><td class="num" id="LN2554">2554</td><td class="line">                                         <span class='keyword'>void</span> <span class='keyword'>const</span>* ip,</td></tr>
<tr class="codeline" data-linenumber="2555"><td class="num" id="LN2555">2555</td><td class="line">                                         <span class='keyword'>void</span> <span class='keyword'>const</span>* iend)</td></tr>
<tr class="codeline" data-linenumber="2556"><td class="num" id="LN2556">2556</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2557"><td class="num" id="LN2557">2557</td><td class="line">    <span class='keyword'>if</span> (ZSTD_window_needOverflowCorrection(ms-&gt;window, iend)) {</td></tr>
<tr class="codeline" data-linenumber="2558"><td class="num" id="LN2558">2558</td><td class="line">        U32 <span class='keyword'>const</span> maxDist = (U32)1 &lt;&lt; params-&gt;cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="2559"><td class="num" id="LN2559">2559</td><td class="line">        U32 <span class='keyword'>const</span> cycleLog = ZSTD_cycleLog(params-&gt;cParams.chainLog, params-&gt;cParams.strategy);</td></tr>
<tr class="codeline" data-linenumber="2560"><td class="num" id="LN2560">2560</td><td class="line">        U32 <span class='keyword'>const</span> correction = ZSTD_window_correctOverflow(&amp;ms-&gt;window, cycleLog, maxDist, ip);</td></tr>
<tr class="codeline" data-linenumber="2561"><td class="num" id="LN2561">2561</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_CHAINLOG_MAX &lt;= 30)<span class='macro_popup'>(void)sizeof(char[(((int)(sizeof(size_t) == 4 ? 29 : 30)) &lt;=<br> 30) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2562"><td class="num" id="LN2562">2562</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_WINDOWLOG_MAX_32 &lt;= 30)<span class='macro_popup'>(void)sizeof(char[(30 &lt;= 30) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2563"><td class="num" id="LN2563">2563</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_WINDOWLOG_MAX &lt;= 31)<span class='macro_popup'>(void)sizeof(char[(((int)(sizeof(size_t) == 4 ? 30 : 31)) &lt;=<br> 31) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2564"><td class="num" id="LN2564">2564</td><td class="line">        ZSTD_cwksp_mark_tables_dirty(ws);</td></tr>
<tr class="codeline" data-linenumber="2565"><td class="num" id="LN2565">2565</td><td class="line">        ZSTD_reduceIndex(ms, params, correction);</td></tr>
<tr class="codeline" data-linenumber="2566"><td class="num" id="LN2566">2566</td><td class="line">        ZSTD_cwksp_mark_tables_clean(ws);</td></tr>
<tr class="codeline" data-linenumber="2567"><td class="num" id="LN2567">2567</td><td class="line">        <span class='keyword'>if</span> (ms-&gt;nextToUpdate &lt; correction) ms-&gt;nextToUpdate = 0;</td></tr>
<tr class="codeline" data-linenumber="2568"><td class="num" id="LN2568">2568</td><td class="line">        <span class='keyword'>else</span> ms-&gt;nextToUpdate -= correction;</td></tr>
<tr class="codeline" data-linenumber="2569"><td class="num" id="LN2569">2569</td><td class="line">        <span class='comment'>/* invalidate dictionaries on overflow correction */</span></td></tr>
<tr class="codeline" data-linenumber="2570"><td class="num" id="LN2570">2570</td><td class="line">        ms-&gt;loadedDictEnd = 0;</td></tr>
<tr class="codeline" data-linenumber="2571"><td class="num" id="LN2571">2571</td><td class="line">        ms-&gt;dictMatchState = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2572"><td class="num" id="LN2572">2572</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2573"><td class="num" id="LN2573">2573</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2574"><td class="num" id="LN2574">2574</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2575"><td class="num" id="LN2575">2575</td><td class="line"><span class='comment'>/*! ZSTD_compress_frameChunk() :</span></td></tr>
<tr class="codeline" data-linenumber="2576"><td class="num" id="LN2576">2576</td><td class="line"><span class='comment'>*   Compress a chunk of data into one or multiple blocks.</span></td></tr>
<tr class="codeline" data-linenumber="2577"><td class="num" id="LN2577">2577</td><td class="line"><span class='comment'>*   All blocks will be terminated, all input will be consumed.</span></td></tr>
<tr class="codeline" data-linenumber="2578"><td class="num" id="LN2578">2578</td><td class="line"><span class='comment'>*   Function will issue an error if there is not enough `dstCapacity` to hold the compressed content.</span></td></tr>
<tr class="codeline" data-linenumber="2579"><td class="num" id="LN2579">2579</td><td class="line"><span class='comment'>*   Frame is supposed already started (header already produced)</span></td></tr>
<tr class="codeline" data-linenumber="2580"><td class="num" id="LN2580">2580</td><td class="line"><span class='comment'>*   @return : compressed size, or an error code</span></td></tr>
<tr class="codeline" data-linenumber="2581"><td class="num" id="LN2581">2581</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2582"><td class="num" id="LN2582">2582</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compress_frameChunk (ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="2583"><td class="num" id="LN2583">2583</td><td class="line">                                     <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2584"><td class="num" id="LN2584">2584</td><td class="line">                               <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="2585"><td class="num" id="LN2585">2585</td><td class="line">                                     U32 lastFrameChunk)</td></tr>
<tr class="codeline" data-linenumber="2586"><td class="num" id="LN2586">2586</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2587"><td class="num" id="LN2587">2587</td><td class="line">    size_t blockSize = cctx-&gt;blockSize;</td></tr>
<tr class="codeline" data-linenumber="2588"><td class="num" id="LN2588">2588</td><td class="line">    size_t remaining = srcSize;</td></tr>
<tr class="codeline" data-linenumber="2589"><td class="num" id="LN2589">2589</td><td class="line">    <span class='keyword'>const</span> BYTE* ip = (<span class='keyword'>const</span> BYTE*)src;</td></tr>
<tr class="codeline" data-linenumber="2590"><td class="num" id="LN2590">2590</td><td class="line">    BYTE* <span class='keyword'>const</span> ostart = (BYTE*)dst;</td></tr>
<tr class="codeline" data-linenumber="2591"><td class="num" id="LN2591">2591</td><td class="line">    BYTE* op = ostart;</td></tr>
<tr class="codeline" data-linenumber="2592"><td class="num" id="LN2592">2592</td><td class="line">    U32 <span class='keyword'>const</span> maxDist = (U32)1 &lt;&lt; cctx-&gt;appliedParams.cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="2593"><td class="num" id="LN2593">2593</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2594"><td class="num" id="LN2594">2594</td><td class="line">    <span class='macro'>assert(cctx-&gt;appliedParams.cParams.windowLog &lt;= ZSTD_WINDOWLOG_MAX)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2595"><td class="num" id="LN2595">2595</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2596"><td class="num" id="LN2596">2596</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compress_frameChunk (blockSize=%u)"</span>, (<span class='keyword'>unsigned</span>)blockSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2597"><td class="num" id="LN2597">2597</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.fParams.checksumFlag &amp;&amp; srcSize)</td></tr>
<tr class="codeline" data-linenumber="2598"><td class="num" id="LN2598">2598</td><td class="line">        <span class='macro'>XXH64_update<span class='macro_popup'>ZSTD_XXH64_update</span></span>(&amp;cctx-&gt;xxhState, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2599"><td class="num" id="LN2599">2599</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2600"><td class="num" id="LN2600">2600</td><td class="line">    <span class='keyword'>while</span> (remaining) {</td></tr>
<tr class="codeline" data-linenumber="2601"><td class="num" id="LN2601">2601</td><td class="line">        ZSTD_matchState_t* <span class='keyword'>const</span> ms = &amp;cctx-&gt;blockState.matchState;</td></tr>
<tr class="codeline" data-linenumber="2602"><td class="num" id="LN2602">2602</td><td class="line">        U32 <span class='keyword'>const</span> lastBlock = lastFrameChunk &amp; (blockSize &gt;= remaining);</td></tr>
<tr class="codeline" data-linenumber="2603"><td class="num" id="LN2603">2603</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2604"><td class="num" id="LN2604">2604</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(dstCapacity &lt; ZSTD_blockHeaderSize + MIN_CBLOCK_SIZE,<span class='macro_popup'>if (dstCapacity &lt; ZSTD_blockHeaderSize + (1 + 1 + 1 )) { {<br>}; if (0) { _force_has_format_string("not enough space to store compressed block"<br>); }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2605"><td class="num" id="LN2605">2605</td><td class="line">                        <span class='macro'>dstSize_tooSmall,<span class='macro_popup'>if (dstCapacity &lt; ZSTD_blockHeaderSize + (1 + 1 + 1 )) { {<br>}; if (0) { _force_has_format_string("not enough space to store compressed block"<br>); }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2606"><td class="num" id="LN2606">2606</td><td class="line">                        <span class='string_literal'><span class='macro'>"not enough space to store compressed block"</span>)<span class='macro_popup'>if (dstCapacity &lt; ZSTD_blockHeaderSize + (1 + 1 + 1 )) { {<br>}; if (0) { _force_has_format_string("not enough space to store compressed block"<br>); }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2607"><td class="num" id="LN2607">2607</td><td class="line">        <span class='keyword'>if</span> (remaining &lt; blockSize) blockSize = remaining;</td></tr>
<tr class="codeline" data-linenumber="2608"><td class="num" id="LN2608">2608</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2609"><td class="num" id="LN2609">2609</td><td class="line">        ZSTD_overflowCorrectIfNeeded(</td></tr>
<tr class="codeline" data-linenumber="2610"><td class="num" id="LN2610">2610</td><td class="line">            ms, &amp;cctx-&gt;workspace, &amp;cctx-&gt;appliedParams, ip, ip + blockSize);</td></tr>
<tr class="codeline" data-linenumber="2611"><td class="num" id="LN2611">2611</td><td class="line">        ZSTD_checkDictValidity(&amp;ms-&gt;window, ip + blockSize, maxDist, &amp;ms-&gt;loadedDictEnd, &amp;ms-&gt;dictMatchState);</td></tr>
<tr class="codeline" data-linenumber="2612"><td class="num" id="LN2612">2612</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2613"><td class="num" id="LN2613">2613</td><td class="line">        <span class='comment'>/* Ensure hash/chain table insertion resumes no sooner than lowlimit */</span></td></tr>
<tr class="codeline" data-linenumber="2614"><td class="num" id="LN2614">2614</td><td class="line">        <span class='keyword'>if</span> (ms-&gt;nextToUpdate &lt; ms-&gt;window.lowLimit) ms-&gt;nextToUpdate = ms-&gt;window.lowLimit;</td></tr>
<tr class="codeline" data-linenumber="2615"><td class="num" id="LN2615">2615</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2616"><td class="num" id="LN2616">2616</td><td class="line">        {   size_t cSize;</td></tr>
<tr class="codeline" data-linenumber="2617"><td class="num" id="LN2617">2617</td><td class="line">            <span class='keyword'>if</span> (ZSTD_useTargetCBlockSize(&amp;cctx-&gt;appliedParams)) {</td></tr>
<tr class="codeline" data-linenumber="2618"><td class="num" id="LN2618">2618</td><td class="line">                cSize = ZSTD_compressBlock_targetCBlockSize(cctx, op, dstCapacity, ip, blockSize, lastBlock);</td></tr>
<tr class="codeline" data-linenumber="2619"><td class="num" id="LN2619">2619</td><td class="line">                <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressBlock_targetCBlockSize failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressBlock_targetCBlockSize failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2620"><td class="num" id="LN2620">2620</td><td class="line">                <span class='macro'>assert(cSize &gt; 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2621"><td class="num" id="LN2621">2621</td><td class="line">                <span class='macro'>assert(cSize &lt;= blockSize + ZSTD_blockHeaderSize)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2622"><td class="num" id="LN2622">2622</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2623"><td class="num" id="LN2623">2623</td><td class="line">                cSize = ZSTD_compressBlock_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="2624"><td class="num" id="LN2624">2624</td><td class="line">                                        op+ZSTD_blockHeaderSize, dstCapacity-ZSTD_blockHeaderSize,</td></tr>
<tr class="codeline" data-linenumber="2625"><td class="num" id="LN2625">2625</td><td class="line">                                        ip, blockSize, 1 <span class='comment'>/* frame */</span>);</td></tr>
<tr class="codeline" data-linenumber="2626"><td class="num" id="LN2626">2626</td><td class="line">                <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressBlock_internal failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressBlock_internal failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2627"><td class="num" id="LN2627">2627</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2628"><td class="num" id="LN2628">2628</td><td class="line">                <span class='keyword'>if</span> (cSize == 0) {  <span class='comment'>/* block is not compressible */</span></td></tr>
<tr class="codeline" data-linenumber="2629"><td class="num" id="LN2629">2629</td><td class="line">                    cSize = ZSTD_noCompressBlock(op, dstCapacity, ip, blockSize, lastBlock);</td></tr>
<tr class="codeline" data-linenumber="2630"><td class="num" id="LN2630">2630</td><td class="line">                    <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_noCompressBlock failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_noCompressBlock failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2631"><td class="num" id="LN2631">2631</td><td class="line">                } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="2632"><td class="num" id="LN2632">2632</td><td class="line">                    U32 <span class='keyword'>const</span> cBlockHeader = cSize == 1 ?</td></tr>
<tr class="codeline" data-linenumber="2633"><td class="num" id="LN2633">2633</td><td class="line">                        lastBlock + (((U32)bt_rle)&lt;&lt;1) + (U32)(blockSize &lt;&lt; 3) :</td></tr>
<tr class="codeline" data-linenumber="2634"><td class="num" id="LN2634">2634</td><td class="line">                        lastBlock + (((U32)bt_compressed)&lt;&lt;1) + (U32)(cSize &lt;&lt; 3);</td></tr>
<tr class="codeline" data-linenumber="2635"><td class="num" id="LN2635">2635</td><td class="line">                    MEM_writeLE24(op, cBlockHeader);</td></tr>
<tr class="codeline" data-linenumber="2636"><td class="num" id="LN2636">2636</td><td class="line">                    cSize += ZSTD_blockHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="2637"><td class="num" id="LN2637">2637</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2638"><td class="num" id="LN2638">2638</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2639"><td class="num" id="LN2639">2639</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2640"><td class="num" id="LN2640">2640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2641"><td class="num" id="LN2641">2641</td><td class="line">            ip += blockSize;</td></tr>
<tr class="codeline" data-linenumber="2642"><td class="num" id="LN2642">2642</td><td class="line">            <span class='macro'>assert(remaining &gt;= blockSize)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2643"><td class="num" id="LN2643">2643</td><td class="line">            remaining -= blockSize;</td></tr>
<tr class="codeline" data-linenumber="2644"><td class="num" id="LN2644">2644</td><td class="line">            op += cSize;</td></tr>
<tr class="codeline" data-linenumber="2645"><td class="num" id="LN2645">2645</td><td class="line">            <span class='macro'>assert(dstCapacity &gt;= cSize)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2646"><td class="num" id="LN2646">2646</td><td class="line">            dstCapacity -= cSize;</td></tr>
<tr class="codeline" data-linenumber="2647"><td class="num" id="LN2647">2647</td><td class="line">            cctx-&gt;isFirstBlock = 0;</td></tr>
<tr class="codeline" data-linenumber="2648"><td class="num" id="LN2648">2648</td><td class="line">            <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compress_frameChunk: adding a block of size %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="2649"><td class="num" id="LN2649">2649</td><td class="line">                        <span class='macro'>(<span class='keyword'>unsigned</span>)cSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2650"><td class="num" id="LN2650">2650</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="2651"><td class="num" id="LN2651">2651</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2652"><td class="num" id="LN2652">2652</td><td class="line">    <span class='keyword'>if</span> (lastFrameChunk &amp;&amp; (op&gt;ostart)) cctx-&gt;stage = ZSTDcs_ending;</td></tr>
<tr class="codeline" data-linenumber="2653"><td class="num" id="LN2653">2653</td><td class="line">    <span class='keyword'>return</span> (size_t)(op-ostart);</td></tr>
<tr class="codeline" data-linenumber="2654"><td class="num" id="LN2654">2654</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2655"><td class="num" id="LN2655">2655</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2656"><td class="num" id="LN2656">2656</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2657"><td class="num" id="LN2657">2657</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_writeFrameHeader(<span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2658"><td class="num" id="LN2658">2658</td><td class="line">                                    <span class='keyword'>const</span> ZSTD_CCtx_params* params, U64 pledgedSrcSize, U32 dictID)</td></tr>
<tr class="codeline" data-linenumber="2659"><td class="num" id="LN2659">2659</td><td class="line">{   BYTE* <span class='keyword'>const</span> op = (BYTE*)dst;</td></tr>
<tr class="codeline" data-linenumber="2660"><td class="num" id="LN2660">2660</td><td class="line">    U32   <span class='keyword'>const</span> dictIDSizeCodeLength = (dictID&gt;0) + (dictID&gt;=256) + (dictID&gt;=65536);   <span class='comment'>/* 0-3 */</span></td></tr>
<tr class="codeline" data-linenumber="2661"><td class="num" id="LN2661">2661</td><td class="line">    U32   <span class='keyword'>const</span> dictIDSizeCode = params-&gt;fParams.noDictIDFlag ? 0 : dictIDSizeCodeLength;   <span class='comment'>/* 0-3 */</span></td></tr>
<tr class="codeline" data-linenumber="2662"><td class="num" id="LN2662">2662</td><td class="line">    U32   <span class='keyword'>const</span> checksumFlag = params-&gt;fParams.checksumFlag&gt;0;</td></tr>
<tr class="codeline" data-linenumber="2663"><td class="num" id="LN2663">2663</td><td class="line">    U32   <span class='keyword'>const</span> windowSize = (U32)1 &lt;&lt; params-&gt;cParams.windowLog;</td></tr>
<tr class="codeline" data-linenumber="2664"><td class="num" id="LN2664">2664</td><td class="line">    U32   <span class='keyword'>const</span> singleSegment = params-&gt;fParams.contentSizeFlag &amp;&amp; (windowSize &gt;= pledgedSrcSize);</td></tr>
<tr class="codeline" data-linenumber="2665"><td class="num" id="LN2665">2665</td><td class="line">    BYTE  <span class='keyword'>const</span> windowLogByte = (BYTE)((params-&gt;cParams.windowLog - <span class='macro'>ZSTD_WINDOWLOG_ABSOLUTEMIN<span class='macro_popup'>10</span></span>) &lt;&lt; 3);</td></tr>
<tr class="codeline" data-linenumber="2666"><td class="num" id="LN2666">2666</td><td class="line">    U32   <span class='keyword'>const</span> fcsCode = params-&gt;fParams.contentSizeFlag ?</td></tr>
<tr class="codeline" data-linenumber="2667"><td class="num" id="LN2667">2667</td><td class="line">                     (pledgedSrcSize&gt;=256) + (pledgedSrcSize&gt;=65536+256) + (pledgedSrcSize&gt;=0xFFFFFFFFU) : 0;  <span class='comment'>/* 0-3 */</span></td></tr>
<tr class="codeline" data-linenumber="2668"><td class="num" id="LN2668">2668</td><td class="line">    BYTE  <span class='keyword'>const</span> frameHeaderDescriptionByte = (BYTE)(dictIDSizeCode + (checksumFlag&lt;&lt;2) + (singleSegment&lt;&lt;5) + (fcsCode&lt;&lt;6) );</td></tr>
<tr class="codeline" data-linenumber="2669"><td class="num" id="LN2669">2669</td><td class="line">    size_t pos=0;</td></tr>
<tr class="codeline" data-linenumber="2670"><td class="num" id="LN2670">2670</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2671"><td class="num" id="LN2671">2671</td><td class="line">    <span class='macro'>assert(!(params-&gt;fParams.contentSizeFlag &amp;&amp; pledgedSrcSize == ZSTD_CONTENTSIZE_UNKNOWN))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2672"><td class="num" id="LN2672">2672</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(dstCapacity &lt; ZSTD_FRAMEHEADERSIZE_MAX, dstSize_tooSmall,<span class='macro_popup'>if (dstCapacity &lt; 18) { {}; if (0) { _force_has_format_string<br>("dst buf is too small to fit worst-case frame header size.")<br>; }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2673"><td class="num" id="LN2673">2673</td><td class="line">                    <span class='string_literal'><span class='macro'>"dst buf is too small to fit worst-case frame header size."</span>)<span class='macro_popup'>if (dstCapacity &lt; 18) { {}; if (0) { _force_has_format_string<br>("dst buf is too small to fit worst-case frame header size.")<br>; }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2674"><td class="num" id="LN2674">2674</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_writeFrameHeader : dictIDFlag : %u ; dictID : %u ; dictIDSizeCode : %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="2675"><td class="num" id="LN2675">2675</td><td class="line">                <span class='macro'>!params-&gt;fParams.noDictIDFlag, (<span class='keyword'>unsigned</span>)dictID, (<span class='keyword'>unsigned</span>)dictIDSizeCode)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2676"><td class="num" id="LN2676">2676</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2677"><td class="num" id="LN2677">2677</td><td class="line">    <span class='keyword'>if</span> (params-&gt;format == ZSTD_f_zstd1) {</td></tr>
<tr class="codeline" data-linenumber="2678"><td class="num" id="LN2678">2678</td><td class="line">        MEM_writeLE32(dst, <span class='macro'>ZSTD_MAGICNUMBER<span class='macro_popup'>0xFD2FB528</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2679"><td class="num" id="LN2679">2679</td><td class="line">        pos = 4;</td></tr>
<tr class="codeline" data-linenumber="2680"><td class="num" id="LN2680">2680</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2681"><td class="num" id="LN2681">2681</td><td class="line">    op[pos++] = frameHeaderDescriptionByte;</td></tr>
<tr class="codeline" data-linenumber="2682"><td class="num" id="LN2682">2682</td><td class="line">    <span class='keyword'>if</span> (!singleSegment) op[pos++] = windowLogByte;</td></tr>
<tr class="codeline" data-linenumber="2683"><td class="num" id="LN2683">2683</td><td class="line">    <span class='keyword'>switch</span>(dictIDSizeCode)</td></tr>
<tr class="codeline" data-linenumber="2684"><td class="num" id="LN2684">2684</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2685"><td class="num" id="LN2685">2685</td><td class="line">        <span class='keyword'>default</span>:  <span class='macro'>assert(0)<span class='macro_popup'>((void)0)</span></span>; <span class='comment'>/* impossible */</span></td></tr>
<tr class="codeline" data-linenumber="2686"><td class="num" id="LN2686">2686</td><td class="line">        <span class='keyword'>case</span> 0 : <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2687"><td class="num" id="LN2687">2687</td><td class="line">        <span class='keyword'>case</span> 1 : op[pos] = (BYTE)(dictID); pos++; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2688"><td class="num" id="LN2688">2688</td><td class="line">        <span class='keyword'>case</span> 2 : MEM_writeLE16(op+pos, (U16)dictID); pos+=2; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2689"><td class="num" id="LN2689">2689</td><td class="line">        <span class='keyword'>case</span> 3 : MEM_writeLE32(op+pos, dictID); pos+=4; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2690"><td class="num" id="LN2690">2690</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2691"><td class="num" id="LN2691">2691</td><td class="line">    <span class='keyword'>switch</span>(fcsCode)</td></tr>
<tr class="codeline" data-linenumber="2692"><td class="num" id="LN2692">2692</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2693"><td class="num" id="LN2693">2693</td><td class="line">        <span class='keyword'>default</span>:  <span class='macro'>assert(0)<span class='macro_popup'>((void)0)</span></span>; <span class='comment'>/* impossible */</span></td></tr>
<tr class="codeline" data-linenumber="2694"><td class="num" id="LN2694">2694</td><td class="line">        <span class='keyword'>case</span> 0 : <span class='keyword'>if</span> (singleSegment) op[pos++] = (BYTE)(pledgedSrcSize); <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2695"><td class="num" id="LN2695">2695</td><td class="line">        <span class='keyword'>case</span> 1 : MEM_writeLE16(op+pos, (U16)(pledgedSrcSize-256)); pos+=2; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2696"><td class="num" id="LN2696">2696</td><td class="line">        <span class='keyword'>case</span> 2 : MEM_writeLE32(op+pos, (U32)(pledgedSrcSize)); pos+=4; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2697"><td class="num" id="LN2697">2697</td><td class="line">        <span class='keyword'>case</span> 3 : MEM_writeLE64(op+pos, (U64)(pledgedSrcSize)); pos+=8; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2698"><td class="num" id="LN2698">2698</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2699"><td class="num" id="LN2699">2699</td><td class="line">    <span class='keyword'>return</span> pos;</td></tr>
<tr class="codeline" data-linenumber="2700"><td class="num" id="LN2700">2700</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2701"><td class="num" id="LN2701">2701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2702"><td class="num" id="LN2702">2702</td><td class="line"><span class='comment'>/* ZSTD_writeLastEmptyBlock() :</span></td></tr>
<tr class="codeline" data-linenumber="2703"><td class="num" id="LN2703">2703</td><td class="line"> <span class='comment'>* output an empty Block with end-of-frame mark to complete a frame</span></td></tr>
<tr class="codeline" data-linenumber="2704"><td class="num" id="LN2704">2704</td><td class="line"> <span class='comment'>* @return : size of data written into `dst` (== ZSTD_blockHeaderSize (defined in zstd_internal.h))</span></td></tr>
<tr class="codeline" data-linenumber="2705"><td class="num" id="LN2705">2705</td><td class="line"> <span class='comment'>*           or an error code if `dstCapacity` is too small (&lt;ZSTD_blockHeaderSize)</span></td></tr>
<tr class="codeline" data-linenumber="2706"><td class="num" id="LN2706">2706</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2707"><td class="num" id="LN2707">2707</td><td class="line">size_t ZSTD_writeLastEmptyBlock(<span class='keyword'>void</span>* dst, size_t dstCapacity)</td></tr>
<tr class="codeline" data-linenumber="2708"><td class="num" id="LN2708">2708</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2709"><td class="num" id="LN2709">2709</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(dstCapacity &lt; ZSTD_blockHeaderSize, dstSize_tooSmall,<span class='macro_popup'>if (dstCapacity &lt; ZSTD_blockHeaderSize) { {}; if (0) { _force_has_format_string<br>("dst buf is too small to write frame trailer empty block.");<br> }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2710"><td class="num" id="LN2710">2710</td><td class="line">                    <span class='string_literal'><span class='macro'>"dst buf is too small to write frame trailer empty block."</span>)<span class='macro_popup'>if (dstCapacity &lt; ZSTD_blockHeaderSize) { {}; if (0) { _force_has_format_string<br>("dst buf is too small to write frame trailer empty block.");<br> }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2711"><td class="num" id="LN2711">2711</td><td class="line">    {   U32 <span class='keyword'>const</span> cBlockHeader24 = 1 <span class='comment'>/*lastBlock*/</span> + (((U32)bt_raw)&lt;&lt;1);  <span class='comment'>/* 0 size */</span></td></tr>
<tr class="codeline" data-linenumber="2712"><td class="num" id="LN2712">2712</td><td class="line">        MEM_writeLE24(dst, cBlockHeader24);</td></tr>
<tr class="codeline" data-linenumber="2713"><td class="num" id="LN2713">2713</td><td class="line">        <span class='keyword'>return</span> ZSTD_blockHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="2714"><td class="num" id="LN2714">2714</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2715"><td class="num" id="LN2715">2715</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2716"><td class="num" id="LN2716">2716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2717"><td class="num" id="LN2717">2717</td><td class="line">size_t ZSTD_referenceExternalSequences(ZSTD_CCtx* cctx, rawSeq* seq, size_t nbSeq)</td></tr>
<tr class="codeline" data-linenumber="2718"><td class="num" id="LN2718">2718</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2719"><td class="num" id="LN2719">2719</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;stage != ZSTDcs_init, stage_wrong,<span class='macro_popup'>if (cctx-&gt;stage != ZSTDcs_init) { {}; if (0) { _force_has_format_string<br>("wrong cctx stage"); }; {}; {}; return ((size_t)-ZSTD_error_stage_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2720"><td class="num" id="LN2720">2720</td><td class="line">                    <span class='string_literal'><span class='macro'>"wrong cctx stage"</span>)<span class='macro_popup'>if (cctx-&gt;stage != ZSTDcs_init) { {}; if (0) { _force_has_format_string<br>("wrong cctx stage"); }; {}; {}; return ((size_t)-ZSTD_error_stage_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2721"><td class="num" id="LN2721">2721</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;appliedParams.ldmParams.enableLdm,<span class='macro_popup'>if (cctx-&gt;appliedParams.ldmParams.enableLdm) { {}; if (0) {<br> _force_has_format_string("incompatible with ldm"); }; {}; {}<br>; return ((size_t)-ZSTD_error_parameter_unsupported); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2722"><td class="num" id="LN2722">2722</td><td class="line">                    <span class='macro'>parameter_unsupported,<span class='macro_popup'>if (cctx-&gt;appliedParams.ldmParams.enableLdm) { {}; if (0) {<br> _force_has_format_string("incompatible with ldm"); }; {}; {}<br>; return ((size_t)-ZSTD_error_parameter_unsupported); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2723"><td class="num" id="LN2723">2723</td><td class="line">                    <span class='string_literal'><span class='macro'>"incompatible with ldm"</span>)<span class='macro_popup'>if (cctx-&gt;appliedParams.ldmParams.enableLdm) { {}; if (0) {<br> _force_has_format_string("incompatible with ldm"); }; {}; {}<br>; return ((size_t)-ZSTD_error_parameter_unsupported); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2724"><td class="num" id="LN2724">2724</td><td class="line">    cctx-&gt;externSeqStore.seq = seq;</td></tr>
<tr class="codeline" data-linenumber="2725"><td class="num" id="LN2725">2725</td><td class="line">    cctx-&gt;externSeqStore.size = nbSeq;</td></tr>
<tr class="codeline" data-linenumber="2726"><td class="num" id="LN2726">2726</td><td class="line">    cctx-&gt;externSeqStore.capacity = nbSeq;</td></tr>
<tr class="codeline" data-linenumber="2727"><td class="num" id="LN2727">2727</td><td class="line">    cctx-&gt;externSeqStore.pos = 0;</td></tr>
<tr class="codeline" data-linenumber="2728"><td class="num" id="LN2728">2728</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2729"><td class="num" id="LN2729">2729</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2730"><td class="num" id="LN2730">2730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2731"><td class="num" id="LN2731">2731</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2732"><td class="num" id="LN2732">2732</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compressContinue_internal (ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="2733"><td class="num" id="LN2733">2733</td><td class="line">                              <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2734"><td class="num" id="LN2734">2734</td><td class="line">                        <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="2735"><td class="num" id="LN2735">2735</td><td class="line">                               U32 frame, U32 lastFrameChunk)</td></tr>
<tr class="codeline" data-linenumber="2736"><td class="num" id="LN2736">2736</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2737"><td class="num" id="LN2737">2737</td><td class="line">    ZSTD_matchState_t* <span class='keyword'>const</span> ms = &amp;cctx-&gt;blockState.matchState;</td></tr>
<tr class="codeline" data-linenumber="2738"><td class="num" id="LN2738">2738</td><td class="line">    size_t fhSize = 0;</td></tr>
<tr class="codeline" data-linenumber="2739"><td class="num" id="LN2739">2739</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2740"><td class="num" id="LN2740">2740</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressContinue_internal, stage: %u, srcSize: %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="2741"><td class="num" id="LN2741">2741</td><td class="line">                <span class='macro'>cctx-&gt;stage, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2742"><td class="num" id="LN2742">2742</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;stage==ZSTDcs_created, stage_wrong,<span class='macro_popup'>if (cctx-&gt;stage==ZSTDcs_created) { {}; if (0) { _force_has_format_string<br>("missing init (ZSTD_compressBegin)"); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2743"><td class="num" id="LN2743">2743</td><td class="line">                    <span class='string_literal'><span class='macro'>"missing init (ZSTD_compressBegin)"</span>)<span class='macro_popup'>if (cctx-&gt;stage==ZSTDcs_created) { {}; if (0) { _force_has_format_string<br>("missing init (ZSTD_compressBegin)"); }; {}; {}; return ((size_t<br>)-ZSTD_error_stage_wrong); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2744"><td class="num" id="LN2744">2744</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2745"><td class="num" id="LN2745">2745</td><td class="line">    <span class='keyword'>if</span> (frame &amp;&amp; (cctx-&gt;stage==ZSTDcs_init)) {</td></tr>
<tr class="codeline" data-linenumber="2746"><td class="num" id="LN2746">2746</td><td class="line">        fhSize = ZSTD_writeFrameHeader(dst, dstCapacity, &amp;cctx-&gt;appliedParams,</td></tr>
<tr class="codeline" data-linenumber="2747"><td class="num" id="LN2747">2747</td><td class="line">                                       cctx-&gt;pledgedSrcSizePlusOne-1, cctx-&gt;dictID);</td></tr>
<tr class="codeline" data-linenumber="2748"><td class="num" id="LN2748">2748</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(fhSize, <span class='string_literal'>"ZSTD_writeFrameHeader failed"</span>)<span class='macro_popup'>do { size_t const err_code = (fhSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_writeFrameHeader failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2749"><td class="num" id="LN2749">2749</td><td class="line">        <span class='macro'>assert(fhSize &lt;= dstCapacity)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2750"><td class="num" id="LN2750">2750</td><td class="line">        dstCapacity -= fhSize;</td></tr>
<tr class="codeline" data-linenumber="2751"><td class="num" id="LN2751">2751</td><td class="line">        dst = (<span class='keyword'>char</span>*)dst + fhSize;</td></tr>
<tr class="codeline" data-linenumber="2752"><td class="num" id="LN2752">2752</td><td class="line">        cctx-&gt;stage = ZSTDcs_ongoing;</td></tr>
<tr class="codeline" data-linenumber="2753"><td class="num" id="LN2753">2753</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2754"><td class="num" id="LN2754">2754</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2755"><td class="num" id="LN2755">2755</td><td class="line">    <span class='keyword'>if</span> (!srcSize) <span class='keyword'>return</span> fhSize;  <span class='comment'>/* do not generate an empty block if no input */</span></td></tr>
<tr class="codeline" data-linenumber="2756"><td class="num" id="LN2756">2756</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2757"><td class="num" id="LN2757">2757</td><td class="line">    <span class='keyword'>if</span> (!ZSTD_window_update(&amp;ms-&gt;window, src, srcSize)) {</td></tr>
<tr class="codeline" data-linenumber="2758"><td class="num" id="LN2758">2758</td><td class="line">        ms-&gt;nextToUpdate = ms-&gt;window.dictLimit;</td></tr>
<tr class="codeline" data-linenumber="2759"><td class="num" id="LN2759">2759</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2760"><td class="num" id="LN2760">2760</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.ldmParams.enableLdm) {</td></tr>
<tr class="codeline" data-linenumber="2761"><td class="num" id="LN2761">2761</td><td class="line">        ZSTD_window_update(&amp;cctx-&gt;ldmState.window, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2762"><td class="num" id="LN2762">2762</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2763"><td class="num" id="LN2763">2763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2764"><td class="num" id="LN2764">2764</td><td class="line">    <span class='keyword'>if</span> (!frame) {</td></tr>
<tr class="codeline" data-linenumber="2765"><td class="num" id="LN2765">2765</td><td class="line">        <span class='comment'>/* overflow check and correction for block mode */</span></td></tr>
<tr class="codeline" data-linenumber="2766"><td class="num" id="LN2766">2766</td><td class="line">        ZSTD_overflowCorrectIfNeeded(</td></tr>
<tr class="codeline" data-linenumber="2767"><td class="num" id="LN2767">2767</td><td class="line">            ms, &amp;cctx-&gt;workspace, &amp;cctx-&gt;appliedParams,</td></tr>
<tr class="codeline" data-linenumber="2768"><td class="num" id="LN2768">2768</td><td class="line">            src, (BYTE <span class='keyword'>const</span>*)src + srcSize);</td></tr>
<tr class="codeline" data-linenumber="2769"><td class="num" id="LN2769">2769</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2770"><td class="num" id="LN2770">2770</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2771"><td class="num" id="LN2771">2771</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressContinue_internal (blockSize=%u)"</span>, (<span class='keyword'>unsigned</span>)cctx-&gt;blockSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2772"><td class="num" id="LN2772">2772</td><td class="line">    {   size_t <span class='keyword'>const</span> cSize = frame ?</td></tr>
<tr class="codeline" data-linenumber="2773"><td class="num" id="LN2773">2773</td><td class="line">                             ZSTD_compress_frameChunk (cctx, dst, dstCapacity, src, srcSize, lastFrameChunk) :</td></tr>
<tr class="codeline" data-linenumber="2774"><td class="num" id="LN2774">2774</td><td class="line">                             ZSTD_compressBlock_internal (cctx, dst, dstCapacity, src, srcSize, 0 <span class='comment'>/* frame */</span>);</td></tr>
<tr class="codeline" data-linenumber="2775"><td class="num" id="LN2775">2775</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"%s"</span>, frame ? <span class='string_literal'>"ZSTD_compress_frameChunk failed"</span> : <span class='string_literal'>"ZSTD_compressBlock_internal failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("%s", frame ? "ZSTD_compress_frameChunk failed"<br> : "ZSTD_compressBlock_internal failed"); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2776"><td class="num" id="LN2776">2776</td><td class="line">        cctx-&gt;consumedSrcSize += srcSize;</td></tr>
<tr class="codeline" data-linenumber="2777"><td class="num" id="LN2777">2777</td><td class="line">        cctx-&gt;producedCSize += (cSize + fhSize);</td></tr>
<tr class="codeline" data-linenumber="2778"><td class="num" id="LN2778">2778</td><td class="line">        <span class='macro'>assert(!(cctx-&gt;appliedParams.fParams.contentSizeFlag &amp;&amp; cctx-&gt;pledgedSrcSizePlusOne == 0))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2779"><td class="num" id="LN2779">2779</td><td class="line">        <span class='keyword'>if</span> (cctx-&gt;pledgedSrcSizePlusOne != 0) {  <span class='comment'>/* control src size */</span></td></tr>
<tr class="codeline" data-linenumber="2780"><td class="num" id="LN2780">2780</td><td class="line">            <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_CONTENTSIZE_UNKNOWN == (<span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span>)-1)<span class='macro_popup'>(void)sizeof(char[((0ULL - 1) == (unsigned long long)-1) ? 1 :<br> -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2781"><td class="num" id="LN2781">2781</td><td class="line">            <span class='macro'>RETURN_ERROR_IF(<span class='macro_popup'>if (cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne<br>) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2782"><td class="num" id="LN2782">2782</td><td class="line">                <span class='macro'>cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne,<span class='macro_popup'>if (cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne<br>) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2783"><td class="num" id="LN2783">2783</td><td class="line">                <span class='macro'>srcSize_wrong,<span class='macro_popup'>if (cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne<br>) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2784"><td class="num" id="LN2784">2784</td><td class="line">                <span class='string_literal'><span class='macro'>"error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"</span>,<span class='macro_popup'>if (cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne<br>) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2785"><td class="num" id="LN2785">2785</td><td class="line">                <span class='macro'>(<span class='keyword'>unsigned</span>)cctx-&gt;pledgedSrcSizePlusOne-1,<span class='macro_popup'>if (cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne<br>) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2786"><td class="num" id="LN2786">2786</td><td class="line">                <span class='macro'>(<span class='keyword'>unsigned</span>)cctx-&gt;consumedSrcSize)<span class='macro_popup'>if (cctx-&gt;consumedSrcSize+1 &gt; cctx-&gt;pledgedSrcSizePlusOne<br>) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize &gt;= %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2787"><td class="num" id="LN2787">2787</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2788"><td class="num" id="LN2788">2788</td><td class="line">        <span class='keyword'>return</span> cSize + fhSize;</td></tr>
<tr class="codeline" data-linenumber="2789"><td class="num" id="LN2789">2789</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2790"><td class="num" id="LN2790">2790</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2791"><td class="num" id="LN2791">2791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2792"><td class="num" id="LN2792">2792</td><td class="line">size_t ZSTD_compressContinue (ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="2793"><td class="num" id="LN2793">2793</td><td class="line">                              <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="2794"><td class="num" id="LN2794">2794</td><td class="line">                        <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize)</td></tr>
<tr class="codeline" data-linenumber="2795"><td class="num" id="LN2795">2795</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2796"><td class="num" id="LN2796">2796</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressContinue (srcSize=%u)"</span>, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2797"><td class="num" id="LN2797">2797</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressContinue_internal(cctx, dst, dstCapacity, src, srcSize, 1 <span class='comment'>/* frame mode */</span>, 0 <span class='comment'>/* last chunk */</span>);</td></tr>
<tr class="codeline" data-linenumber="2798"><td class="num" id="LN2798">2798</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2799"><td class="num" id="LN2799">2799</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2800"><td class="num" id="LN2800">2800</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2801"><td class="num" id="LN2801">2801</td><td class="line">size_t ZSTD_getBlockSize(<span class='keyword'>const</span> ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="2802"><td class="num" id="LN2802">2802</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2803"><td class="num" id="LN2803">2803</td><td class="line">    ZSTD_compressionParameters <span class='keyword'>const</span> cParams = cctx-&gt;appliedParams.cParams;</td></tr>
<tr class="codeline" data-linenumber="2804"><td class="num" id="LN2804">2804</td><td class="line">    <span class='macro'>assert(!ZSTD_checkCParams(cParams))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2805"><td class="num" id="LN2805">2805</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MIN (ZSTD_BLOCKSIZE_MAX, (U32)1 &lt;&lt; cParams.windowLog)<span class='macro_popup'>(((1&lt;&lt;17))&lt;((U32)1 &lt;&lt; cParams.windowLog) ? ((1<br>&lt;&lt;17)) : ((U32)1 &lt;&lt; cParams.windowLog))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2806"><td class="num" id="LN2806">2806</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2807"><td class="num" id="LN2807">2807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2808"><td class="num" id="LN2808">2808</td><td class="line">size_t ZSTD_compressBlock(ZSTD_CCtx* cctx, <span class='keyword'>void</span>* dst, size_t dstCapacity, <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize)</td></tr>
<tr class="codeline" data-linenumber="2809"><td class="num" id="LN2809">2809</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2810"><td class="num" id="LN2810">2810</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressBlock: srcSize = %u"</span>, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2811"><td class="num" id="LN2811">2811</td><td class="line">    { size_t <span class='keyword'>const</span> blockSizeMax = ZSTD_getBlockSize(cctx);</td></tr>
<tr class="codeline" data-linenumber="2812"><td class="num" id="LN2812">2812</td><td class="line">      <span class='macro'>RETURN_ERROR_IF(srcSize &gt; blockSizeMax, srcSize_wrong, <span class='string_literal'>"input is larger than a block"</span>)<span class='macro_popup'>if (srcSize &gt; blockSizeMax) { {}; if (0) { _force_has_format_string<br>("input is larger than a block"); }; {}; {}; return ((size_t)<br>-ZSTD_error_srcSize_wrong); }</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2813"><td class="num" id="LN2813">2813</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2814"><td class="num" id="LN2814">2814</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressContinue_internal(cctx, dst, dstCapacity, src, srcSize, 0 <span class='comment'>/* frame mode */</span>, 0 <span class='comment'>/* last chunk */</span>);</td></tr>
<tr class="codeline" data-linenumber="2815"><td class="num" id="LN2815">2815</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2816"><td class="num" id="LN2816">2816</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2817"><td class="num" id="LN2817">2817</td><td class="line"><span class='comment'>/*! ZSTD_loadDictionaryContent() :</span></td></tr>
<tr class="codeline" data-linenumber="2818"><td class="num" id="LN2818">2818</td><td class="line"> <span class='comment'>*  @return : 0, or an error code</span></td></tr>
<tr class="codeline" data-linenumber="2819"><td class="num" id="LN2819">2819</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2820"><td class="num" id="LN2820">2820</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_loadDictionaryContent(ZSTD_matchState_t* ms,</td></tr>
<tr class="codeline" data-linenumber="2821"><td class="num" id="LN2821">2821</td><td class="line">                                         ldmState_t* ls,</td></tr>
<tr class="codeline" data-linenumber="2822"><td class="num" id="LN2822">2822</td><td class="line">                                         ZSTD_cwksp* ws,</td></tr>
<tr class="codeline" data-linenumber="2823"><td class="num" id="LN2823">2823</td><td class="line">                                         ZSTD_CCtx_params <span class='keyword'>const</span>* params,</td></tr>
<tr class="codeline" data-linenumber="2824"><td class="num" id="LN2824">2824</td><td class="line">                                         <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="2825"><td class="num" id="LN2825">2825</td><td class="line">                                         ZSTD_dictTableLoadMethod_e dtlm)</td></tr>
<tr class="codeline" data-linenumber="2826"><td class="num" id="LN2826">2826</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2827"><td class="num" id="LN2827">2827</td><td class="line">    <span class='keyword'>const</span> BYTE* ip = (<span class='keyword'>const</span> BYTE*) src;</td></tr>
<tr class="codeline" data-linenumber="2828"><td class="num" id="LN2828">2828</td><td class="line">    <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> iend = ip + srcSize;</td></tr>
<tr class="codeline" data-linenumber="2829"><td class="num" id="LN2829">2829</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2830"><td class="num" id="LN2830">2830</td><td class="line">    ZSTD_window_update(&amp;ms-&gt;window, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2831"><td class="num" id="LN2831">2831</td><td class="line">    ms-&gt;loadedDictEnd = params-&gt;forceWindow ? 0 : (U32)(iend - ms-&gt;window.base);</td></tr>
<tr class="codeline" data-linenumber="2832"><td class="num" id="LN2832">2832</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2833"><td class="num" id="LN2833">2833</td><td class="line">    <span class='keyword'>if</span> (params-&gt;ldmParams.enableLdm &amp;&amp; ls != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2834"><td class="num" id="LN2834">2834</td><td class="line">        ZSTD_window_update(&amp;ls-&gt;window, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="2835"><td class="num" id="LN2835">2835</td><td class="line">        ls-&gt;loadedDictEnd = params-&gt;forceWindow ? 0 : (U32)(iend - ls-&gt;window.base);</td></tr>
<tr class="codeline" data-linenumber="2836"><td class="num" id="LN2836">2836</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2837"><td class="num" id="LN2837">2837</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2838"><td class="num" id="LN2838">2838</td><td class="line">    <span class='comment'>/* Assert that we the ms params match the params we're being given */</span></td></tr>
<tr class="codeline" data-linenumber="2839"><td class="num" id="LN2839">2839</td><td class="line">    ZSTD_assertEqualCParams(params-&gt;cParams, ms-&gt;cParams);</td></tr>
<tr class="codeline" data-linenumber="2840"><td class="num" id="LN2840">2840</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2841"><td class="num" id="LN2841">2841</td><td class="line">    <span class='keyword'>if</span> (srcSize &lt;= <span class='macro'>HASH_READ_SIZE<span class='macro_popup'>8</span></span>) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2842"><td class="num" id="LN2842">2842</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2843"><td class="num" id="LN2843">2843</td><td class="line">    <span class='keyword'>while</span> (iend - ip &gt; <span class='macro'>HASH_READ_SIZE<span class='macro_popup'>8</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="2844"><td class="num" id="LN2844">2844</td><td class="line">        size_t <span class='keyword'>const</span> remaining = (size_t)(iend - ip);</td></tr>
<tr class="codeline" data-linenumber="2845"><td class="num" id="LN2845">2845</td><td class="line">        size_t <span class='keyword'>const</span> chunk = <span class='macro'>MIN(remaining, ZSTD_CHUNKSIZE_MAX)<span class='macro_popup'>((remaining)&lt;(( ((U32)-1) - ((3U &lt;&lt; 29) + (1U &lt;&lt;<br> ((int)(sizeof(size_t) == 4 ? 30 : 31)))))) ? (remaining) : (<br>( ((U32)-1) - ((3U &lt;&lt; 29) + (1U &lt;&lt; ((int)(sizeof(<br>size_t) == 4 ? 30 : 31)))))))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2846"><td class="num" id="LN2846">2846</td><td class="line">        <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> ichunk = ip + chunk;</td></tr>
<tr class="codeline" data-linenumber="2847"><td class="num" id="LN2847">2847</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2848"><td class="num" id="LN2848">2848</td><td class="line">        ZSTD_overflowCorrectIfNeeded(ms, ws, params, ip, ichunk);</td></tr>
<tr class="codeline" data-linenumber="2849"><td class="num" id="LN2849">2849</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2850"><td class="num" id="LN2850">2850</td><td class="line">        <span class='keyword'>if</span> (params-&gt;ldmParams.enableLdm &amp;&amp; ls != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2851"><td class="num" id="LN2851">2851</td><td class="line">            ZSTD_ldm_fillHashTable(ls, (<span class='keyword'>const</span> BYTE*)src, (<span class='keyword'>const</span> BYTE*)src + srcSize, &amp;params-&gt;ldmParams);</td></tr>
<tr class="codeline" data-linenumber="2852"><td class="num" id="LN2852">2852</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2853"><td class="num" id="LN2853">2853</td><td class="line">        <span class='keyword'>switch</span>(params-&gt;cParams.strategy)</td></tr>
<tr class="codeline" data-linenumber="2854"><td class="num" id="LN2854">2854</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2855"><td class="num" id="LN2855">2855</td><td class="line">        <span class='keyword'>case</span> ZSTD_fast:</td></tr>
<tr class="codeline" data-linenumber="2856"><td class="num" id="LN2856">2856</td><td class="line">            ZSTD_fillHashTable(ms, ichunk, dtlm);</td></tr>
<tr class="codeline" data-linenumber="2857"><td class="num" id="LN2857">2857</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2858"><td class="num" id="LN2858">2858</td><td class="line">        <span class='keyword'>case</span> ZSTD_dfast:</td></tr>
<tr class="codeline" data-linenumber="2859"><td class="num" id="LN2859">2859</td><td class="line">            ZSTD_fillDoubleHashTable(ms, ichunk, dtlm);</td></tr>
<tr class="codeline" data-linenumber="2860"><td class="num" id="LN2860">2860</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2861"><td class="num" id="LN2861">2861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2862"><td class="num" id="LN2862">2862</td><td class="line">        <span class='keyword'>case</span> ZSTD_greedy:</td></tr>
<tr class="codeline" data-linenumber="2863"><td class="num" id="LN2863">2863</td><td class="line">        <span class='keyword'>case</span> ZSTD_lazy:</td></tr>
<tr class="codeline" data-linenumber="2864"><td class="num" id="LN2864">2864</td><td class="line">        <span class='keyword'>case</span> ZSTD_lazy2:</td></tr>
<tr class="codeline" data-linenumber="2865"><td class="num" id="LN2865">2865</td><td class="line">            <span class='keyword'>if</span> (chunk &gt;= <span class='macro'>HASH_READ_SIZE<span class='macro_popup'>8</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2866"><td class="num" id="LN2866">2866</td><td class="line">                ZSTD_insertAndFindFirstIndex(ms, ichunk-<span class='macro'>HASH_READ_SIZE<span class='macro_popup'>8</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2867"><td class="num" id="LN2867">2867</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2868"><td class="num" id="LN2868">2868</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2869"><td class="num" id="LN2869">2869</td><td class="line">        <span class='keyword'>case</span> ZSTD_btlazy2:   <span class='comment'>/* we want the dictionary table fully sorted */</span></td></tr>
<tr class="codeline" data-linenumber="2870"><td class="num" id="LN2870">2870</td><td class="line">        <span class='keyword'>case</span> ZSTD_btopt:</td></tr>
<tr class="codeline" data-linenumber="2871"><td class="num" id="LN2871">2871</td><td class="line">        <span class='keyword'>case</span> ZSTD_btultra:</td></tr>
<tr class="codeline" data-linenumber="2872"><td class="num" id="LN2872">2872</td><td class="line">        <span class='keyword'>case</span> ZSTD_btultra2:</td></tr>
<tr class="codeline" data-linenumber="2873"><td class="num" id="LN2873">2873</td><td class="line">            <span class='keyword'>if</span> (chunk &gt;= <span class='macro'>HASH_READ_SIZE<span class='macro_popup'>8</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2874"><td class="num" id="LN2874">2874</td><td class="line">                ZSTD_updateTree(ms, ichunk-<span class='macro'>HASH_READ_SIZE<span class='macro_popup'>8</span></span>, ichunk);</td></tr>
<tr class="codeline" data-linenumber="2875"><td class="num" id="LN2875">2875</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2876"><td class="num" id="LN2876">2876</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2877"><td class="num" id="LN2877">2877</td><td class="line">        <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="2878"><td class="num" id="LN2878">2878</td><td class="line">            <span class='macro'>assert(0)<span class='macro_popup'>((void)0)</span></span>;  <span class='comment'>/* not possible : not a valid strategy id */</span></td></tr>
<tr class="codeline" data-linenumber="2879"><td class="num" id="LN2879">2879</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2880"><td class="num" id="LN2880">2880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2881"><td class="num" id="LN2881">2881</td><td class="line">        ip = ichunk;</td></tr>
<tr class="codeline" data-linenumber="2882"><td class="num" id="LN2882">2882</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2883"><td class="num" id="LN2883">2883</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2884"><td class="num" id="LN2884">2884</td><td class="line">    ms-&gt;nextToUpdate = (U32)(iend - ms-&gt;window.base);</td></tr>
<tr class="codeline" data-linenumber="2885"><td class="num" id="LN2885">2885</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2886"><td class="num" id="LN2886">2886</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2887"><td class="num" id="LN2887">2887</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2888"><td class="num" id="LN2888">2888</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2889"><td class="num" id="LN2889">2889</td><td class="line"><span class='comment'>/* Dictionaries that assign zero probability to symbols that show up causes problems</span></td></tr>
<tr class="codeline" data-linenumber="2890"><td class="num" id="LN2890">2890</td><td class="line">   <span class='comment'>when FSE encoding.  Refuse dictionaries that assign zero probability to symbols</span></td></tr>
<tr class="codeline" data-linenumber="2891"><td class="num" id="LN2891">2891</td><td class="line">   <span class='comment'>that we may encounter during compression.</span></td></tr>
<tr class="codeline" data-linenumber="2892"><td class="num" id="LN2892">2892</td><td class="line">   <span class='comment'>NOTE: This behavior is not standard and could be improved in the future. */</span></td></tr>
<tr class="codeline" data-linenumber="2893"><td class="num" id="LN2893">2893</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_checkDictNCount(<span class='keyword'>short</span>* normalizedCounter, <span class='keyword'>unsigned</span> dictMaxSymbolValue, <span class='keyword'>unsigned</span> maxSymbolValue) {</td></tr>
<tr class="codeline" data-linenumber="2894"><td class="num" id="LN2894">2894</td><td class="line">    U32 s;</td></tr>
<tr class="codeline" data-linenumber="2895"><td class="num" id="LN2895">2895</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(dictMaxSymbolValue &lt; maxSymbolValue, dictionary_corrupted, <span class='string_literal'>"dict fse tables don't have all symbols"</span>)<span class='macro_popup'>if (dictMaxSymbolValue &lt; maxSymbolValue) { {}; if (0) { _force_has_format_string<br>("dict fse tables don't have all symbols"); }; {}; {}; return<br> ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2896"><td class="num" id="LN2896">2896</td><td class="line">    <span class='keyword'>for</span> (s = 0; s &lt;= maxSymbolValue; ++s) {</td></tr>
<tr class="codeline" data-linenumber="2897"><td class="num" id="LN2897">2897</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(normalizedCounter[s] == 0, dictionary_corrupted, <span class='string_literal'>"dict fse tables don't have all symbols"</span>)<span class='macro_popup'>if (normalizedCounter[s] == 0) { {}; if (0) { _force_has_format_string<br>("dict fse tables don't have all symbols"); }; {}; {}; return<br> ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2898"><td class="num" id="LN2898">2898</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2899"><td class="num" id="LN2899">2899</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2900"><td class="num" id="LN2900">2900</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2901"><td class="num" id="LN2901">2901</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2902"><td class="num" id="LN2902">2902</td><td class="line">size_t ZSTD_loadCEntropy(ZSTD_compressedBlockState_t* bs, <span class='keyword'>void</span>* workspace,</td></tr>
<tr class="codeline" data-linenumber="2903"><td class="num" id="LN2903">2903</td><td class="line">                         <span class='keyword'>short</span>* offcodeNCount, <span class='keyword'>unsigned</span>* offcodeMaxValue,</td></tr>
<tr class="codeline" data-linenumber="2904"><td class="num" id="LN2904">2904</td><td class="line">                         <span class='keyword'>const</span> <span class='keyword'>void</span>* <span class='keyword'>const</span> dict, size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="2905"><td class="num" id="LN2905">2905</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2906"><td class="num" id="LN2906">2906</td><td class="line">    <span class='keyword'>const</span> BYTE* dictPtr = (<span class='keyword'>const</span> BYTE*)dict;    <span class='comment'>/* skip magic num and dict ID */</span></td></tr>
<tr class="codeline" data-linenumber="2907"><td class="num" id="LN2907">2907</td><td class="line">    <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> dictEnd = dictPtr + dictSize;</td></tr>
<tr class="codeline" data-linenumber="2908"><td class="num" id="LN2908">2908</td><td class="line">    dictPtr += 8;</td></tr>
<tr class="codeline" data-linenumber="2909"><td class="num" id="LN2909">2909</td><td class="line">    bs-&gt;entropy.huf.repeatMode = HUF_repeat_check;</td></tr>
<tr class="codeline" data-linenumber="2910"><td class="num" id="LN2910">2910</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2911"><td class="num" id="LN2911">2911</td><td class="line">    {   <span class='keyword'>unsigned</span> maxSymbolValue = 255;</td></tr>
<tr class="codeline" data-linenumber="2912"><td class="num" id="LN2912">2912</td><td class="line">        <span class='keyword'>unsigned</span> hasZeroWeights = 1;</td></tr>
<tr class="codeline" data-linenumber="2913"><td class="num" id="LN2913">2913</td><td class="line">        size_t <span class='keyword'>const</span> hufHeaderSize = HUF_readCTable((HUF_CElt*)bs-&gt;entropy.huf.CTable, &amp;maxSymbolValue, dictPtr,</td></tr>
<tr class="codeline" data-linenumber="2914"><td class="num" id="LN2914">2914</td><td class="line">            dictEnd-dictPtr, &amp;hasZeroWeights);</td></tr>
<tr class="codeline" data-linenumber="2915"><td class="num" id="LN2915">2915</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2916"><td class="num" id="LN2916">2916</td><td class="line">        <span class='comment'>/* We only set the loaded table as valid if it contains all non-zero</span></td></tr>
<tr class="codeline" data-linenumber="2917"><td class="num" id="LN2917">2917</td><td class="line">         <span class='comment'>* weights. Otherwise, we set it to check */</span></td></tr>
<tr class="codeline" data-linenumber="2918"><td class="num" id="LN2918">2918</td><td class="line">        <span class='keyword'>if</span> (!hasZeroWeights)</td></tr>
<tr class="codeline" data-linenumber="2919"><td class="num" id="LN2919">2919</td><td class="line">            bs-&gt;entropy.huf.repeatMode = HUF_repeat_valid;</td></tr>
<tr class="codeline" data-linenumber="2920"><td class="num" id="LN2920">2920</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2921"><td class="num" id="LN2921">2921</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(HUF_isError(hufHeaderSize), dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(hufHeaderSize)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2922"><td class="num" id="LN2922">2922</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(maxSymbolValue &lt; 255, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (maxSymbolValue &lt; 255) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2923"><td class="num" id="LN2923">2923</td><td class="line">        dictPtr += hufHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="2924"><td class="num" id="LN2924">2924</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2925"><td class="num" id="LN2925">2925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2926"><td class="num" id="LN2926">2926</td><td class="line">    {   <span class='keyword'>unsigned</span> offcodeLog;</td></tr>
<tr class="codeline" data-linenumber="2927"><td class="num" id="LN2927">2927</td><td class="line">        size_t <span class='keyword'>const</span> offcodeHeaderSize = FSE_readNCount(offcodeNCount, offcodeMaxValue, &amp;offcodeLog, dictPtr, dictEnd-dictPtr);</td></tr>
<tr class="codeline" data-linenumber="2928"><td class="num" id="LN2928">2928</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(FSE_isError(offcodeHeaderSize), dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(offcodeHeaderSize)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2929"><td class="num" id="LN2929">2929</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(offcodeLog &gt; OffFSELog, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (offcodeLog &gt; 8) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2930"><td class="num" id="LN2930">2930</td><td class="line">        <span class='comment'>/* Defer checking offcodeMaxValue because we need to know the size of the dictionary content */</span></td></tr>
<tr class="codeline" data-linenumber="2931"><td class="num" id="LN2931">2931</td><td class="line">        <span class='comment'>/* fill all offset symbols to avoid garbage at end of table */</span></td></tr>
<tr class="codeline" data-linenumber="2932"><td class="num" id="LN2932">2932</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(FSE_isError(FSE_buildCTable_wksp(<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.offcodeCTable<br>, offcodeNCount, 31, offcodeLog, workspace, ((6 &lt;&lt; 10) +<br> 256)))) { {}; if (0) { _force_has_format_string(""); }; {}; {<br>}; return ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2933"><td class="num" id="LN2933">2933</td><td class="line">                <span class='macro'>bs-&gt;entropy.fse.offcodeCTable,<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.offcodeCTable<br>, offcodeNCount, 31, offcodeLog, workspace, ((6 &lt;&lt; 10) +<br> 256)))) { {}; if (0) { _force_has_format_string(""); }; {}; {<br>}; return ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2934"><td class="num" id="LN2934">2934</td><td class="line">                <span class='macro'>offcodeNCount, MaxOff, offcodeLog,<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.offcodeCTable<br>, offcodeNCount, 31, offcodeLog, workspace, ((6 &lt;&lt; 10) +<br> 256)))) { {}; if (0) { _force_has_format_string(""); }; {}; {<br>}; return ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2935"><td class="num" id="LN2935">2935</td><td class="line">                <span class='macro'>workspace, HUF_WORKSPACE_SIZE)),<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.offcodeCTable<br>, offcodeNCount, 31, offcodeLog, workspace, ((6 &lt;&lt; 10) +<br> 256)))) { {}; if (0) { _force_has_format_string(""); }; {}; {<br>}; return ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2936"><td class="num" id="LN2936">2936</td><td class="line">            <span class='macro'>dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.offcodeCTable<br>, offcodeNCount, 31, offcodeLog, workspace, ((6 &lt;&lt; 10) +<br> 256)))) { {}; if (0) { _force_has_format_string(""); }; {}; {<br>}; return ((size_t)-ZSTD_error_dictionary_corrupted); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2937"><td class="num" id="LN2937">2937</td><td class="line">        dictPtr += offcodeHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="2938"><td class="num" id="LN2938">2938</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2939"><td class="num" id="LN2939">2939</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2940"><td class="num" id="LN2940">2940</td><td class="line">    {   <span class='keyword'>short</span> matchlengthNCount[<span class='macro'>MaxML<span class='macro_popup'>52</span></span>+1];</td></tr>
<tr class="codeline" data-linenumber="2941"><td class="num" id="LN2941">2941</td><td class="line">        <span class='keyword'>unsigned</span> matchlengthMaxValue = <span class='macro'>MaxML<span class='macro_popup'>52</span></span>, matchlengthLog;</td></tr>
<tr class="codeline" data-linenumber="2942"><td class="num" id="LN2942">2942</td><td class="line">        size_t <span class='keyword'>const</span> matchlengthHeaderSize = FSE_readNCount(matchlengthNCount, &amp;matchlengthMaxValue, &amp;matchlengthLog, dictPtr, dictEnd-dictPtr);</td></tr>
<tr class="codeline" data-linenumber="2943"><td class="num" id="LN2943">2943</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(FSE_isError(matchlengthHeaderSize), dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(matchlengthHeaderSize)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2944"><td class="num" id="LN2944">2944</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(matchlengthLog &gt; MLFSELog, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (matchlengthLog &gt; 9) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2945"><td class="num" id="LN2945">2945</td><td class="line">        <span class='comment'>/* Every match length code must have non-zero probability */</span></td></tr>
<tr class="codeline" data-linenumber="2946"><td class="num" id="LN2946">2946</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR( ZSTD_checkDictNCount(matchlengthNCount, matchlengthMaxValue, MaxML), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkDictNCount(matchlengthNCount<br>, matchlengthMaxValue, 52)); if (ERR_isError(err_code)) { {};<br> if (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2947"><td class="num" id="LN2947">2947</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(FSE_isError(FSE_buildCTable_wksp(<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.matchlengthCTable<br>, matchlengthNCount, matchlengthMaxValue, matchlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2948"><td class="num" id="LN2948">2948</td><td class="line">                <span class='macro'>bs-&gt;entropy.fse.matchlengthCTable,<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.matchlengthCTable<br>, matchlengthNCount, matchlengthMaxValue, matchlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2949"><td class="num" id="LN2949">2949</td><td class="line">                <span class='macro'>matchlengthNCount, matchlengthMaxValue, matchlengthLog,<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.matchlengthCTable<br>, matchlengthNCount, matchlengthMaxValue, matchlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2950"><td class="num" id="LN2950">2950</td><td class="line">                <span class='macro'>workspace, HUF_WORKSPACE_SIZE)),<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.matchlengthCTable<br>, matchlengthNCount, matchlengthMaxValue, matchlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2951"><td class="num" id="LN2951">2951</td><td class="line">            <span class='macro'>dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.matchlengthCTable<br>, matchlengthNCount, matchlengthMaxValue, matchlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2952"><td class="num" id="LN2952">2952</td><td class="line">        dictPtr += matchlengthHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="2953"><td class="num" id="LN2953">2953</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2954"><td class="num" id="LN2954">2954</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2955"><td class="num" id="LN2955">2955</td><td class="line">    {   <span class='keyword'>short</span> litlengthNCount[<span class='macro'>MaxLL<span class='macro_popup'>35</span></span>+1];</td></tr>
<tr class="codeline" data-linenumber="2956"><td class="num" id="LN2956">2956</td><td class="line">        <span class='keyword'>unsigned</span> litlengthMaxValue = <span class='macro'>MaxLL<span class='macro_popup'>35</span></span>, litlengthLog;</td></tr>
<tr class="codeline" data-linenumber="2957"><td class="num" id="LN2957">2957</td><td class="line">        size_t <span class='keyword'>const</span> litlengthHeaderSize = FSE_readNCount(litlengthNCount, &amp;litlengthMaxValue, &amp;litlengthLog, dictPtr, dictEnd-dictPtr);</td></tr>
<tr class="codeline" data-linenumber="2958"><td class="num" id="LN2958">2958</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(FSE_isError(litlengthHeaderSize), dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(litlengthHeaderSize)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2959"><td class="num" id="LN2959">2959</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(litlengthLog &gt; LLFSELog, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (litlengthLog &gt; 9) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2960"><td class="num" id="LN2960">2960</td><td class="line">        <span class='comment'>/* Every literal length code must have non-zero probability */</span></td></tr>
<tr class="codeline" data-linenumber="2961"><td class="num" id="LN2961">2961</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR( ZSTD_checkDictNCount(litlengthNCount, litlengthMaxValue, MaxLL), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkDictNCount(litlengthNCount<br>, litlengthMaxValue, 35)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2962"><td class="num" id="LN2962">2962</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(FSE_isError(FSE_buildCTable_wksp(<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.litlengthCTable<br>, litlengthNCount, litlengthMaxValue, litlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2963"><td class="num" id="LN2963">2963</td><td class="line">                <span class='macro'>bs-&gt;entropy.fse.litlengthCTable,<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.litlengthCTable<br>, litlengthNCount, litlengthMaxValue, litlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2964"><td class="num" id="LN2964">2964</td><td class="line">                <span class='macro'>litlengthNCount, litlengthMaxValue, litlengthLog,<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.litlengthCTable<br>, litlengthNCount, litlengthMaxValue, litlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2965"><td class="num" id="LN2965">2965</td><td class="line">                <span class='macro'>workspace, HUF_WORKSPACE_SIZE)),<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.litlengthCTable<br>, litlengthNCount, litlengthMaxValue, litlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2966"><td class="num" id="LN2966">2966</td><td class="line">            <span class='macro'>dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (ERR_isError(FSE_buildCTable_wksp( bs-&gt;entropy.fse.litlengthCTable<br>, litlengthNCount, litlengthMaxValue, litlengthLog, workspace<br>, ((6 &lt;&lt; 10) + 256)))) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2967"><td class="num" id="LN2967">2967</td><td class="line">        dictPtr += litlengthHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="2968"><td class="num" id="LN2968">2968</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2969"><td class="num" id="LN2969">2969</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2970"><td class="num" id="LN2970">2970</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(dictPtr+12 &gt; dictEnd, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (dictPtr+12 &gt; dictEnd) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2971"><td class="num" id="LN2971">2971</td><td class="line">    bs-&gt;rep[0] = MEM_readLE32(dictPtr+0);</td></tr>
<tr class="codeline" data-linenumber="2972"><td class="num" id="LN2972">2972</td><td class="line">    bs-&gt;rep[1] = MEM_readLE32(dictPtr+4);</td></tr>
<tr class="codeline" data-linenumber="2973"><td class="num" id="LN2973">2973</td><td class="line">    bs-&gt;rep[2] = MEM_readLE32(dictPtr+8);</td></tr>
<tr class="codeline" data-linenumber="2974"><td class="num" id="LN2974">2974</td><td class="line">    dictPtr += 12;</td></tr>
<tr class="codeline" data-linenumber="2975"><td class="num" id="LN2975">2975</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2976"><td class="num" id="LN2976">2976</td><td class="line">    <span class='keyword'>return</span> dictPtr - (<span class='keyword'>const</span> BYTE*)dict;</td></tr>
<tr class="codeline" data-linenumber="2977"><td class="num" id="LN2977">2977</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2978"><td class="num" id="LN2978">2978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2979"><td class="num" id="LN2979">2979</td><td class="line"><span class='comment'>/* Dictionary format :</span></td></tr>
<tr class="codeline" data-linenumber="2980"><td class="num" id="LN2980">2980</td><td class="line"> <span class='comment'>* See :</span></td></tr>
<tr class="codeline" data-linenumber="2981"><td class="num" id="LN2981">2981</td><td class="line"> <span class='comment'>* https://github.com/facebook/zstd/blob/master/doc/zstd_compression_format.md#dictionary-format</span></td></tr>
<tr class="codeline" data-linenumber="2982"><td class="num" id="LN2982">2982</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2983"><td class="num" id="LN2983">2983</td><td class="line"><span class='comment'>/*! ZSTD_loadZstdDictionary() :</span></td></tr>
<tr class="codeline" data-linenumber="2984"><td class="num" id="LN2984">2984</td><td class="line"> <span class='comment'>* @return : dictID, or an error code</span></td></tr>
<tr class="codeline" data-linenumber="2985"><td class="num" id="LN2985">2985</td><td class="line"> <span class='comment'>*  assumptions : magic number supposed already checked</span></td></tr>
<tr class="codeline" data-linenumber="2986"><td class="num" id="LN2986">2986</td><td class="line"> <span class='comment'>*                dictSize supposed &gt;= 8</span></td></tr>
<tr class="codeline" data-linenumber="2987"><td class="num" id="LN2987">2987</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="2988"><td class="num" id="LN2988">2988</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_loadZstdDictionary(ZSTD_compressedBlockState_t* bs,</td></tr>
<tr class="codeline" data-linenumber="2989"><td class="num" id="LN2989">2989</td><td class="line">                                      ZSTD_matchState_t* ms,</td></tr>
<tr class="codeline" data-linenumber="2990"><td class="num" id="LN2990">2990</td><td class="line">                                      ZSTD_cwksp* ws,</td></tr>
<tr class="codeline" data-linenumber="2991"><td class="num" id="LN2991">2991</td><td class="line">                                      ZSTD_CCtx_params <span class='keyword'>const</span>* params,</td></tr>
<tr class="codeline" data-linenumber="2992"><td class="num" id="LN2992">2992</td><td class="line">                                      <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="2993"><td class="num" id="LN2993">2993</td><td class="line">                                      ZSTD_dictTableLoadMethod_e dtlm,</td></tr>
<tr class="codeline" data-linenumber="2994"><td class="num" id="LN2994">2994</td><td class="line">                                      <span class='keyword'>void</span>* workspace)</td></tr>
<tr class="codeline" data-linenumber="2995"><td class="num" id="LN2995">2995</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2996"><td class="num" id="LN2996">2996</td><td class="line">    <span class='keyword'>const</span> BYTE* dictPtr = (<span class='keyword'>const</span> BYTE*)dict;</td></tr>
<tr class="codeline" data-linenumber="2997"><td class="num" id="LN2997">2997</td><td class="line">    <span class='keyword'>const</span> BYTE* <span class='keyword'>const</span> dictEnd = dictPtr + dictSize;</td></tr>
<tr class="codeline" data-linenumber="2998"><td class="num" id="LN2998">2998</td><td class="line">    <span class='keyword'>short</span> offcodeNCount[<span class='macro'>MaxOff<span class='macro_popup'>31</span></span>+1];</td></tr>
<tr class="codeline" data-linenumber="2999"><td class="num" id="LN2999">2999</td><td class="line">    <span class='keyword'>unsigned</span> offcodeMaxValue = <span class='macro'>MaxOff<span class='macro_popup'>31</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3000"><td class="num" id="LN3000">3000</td><td class="line">    size_t dictID;</td></tr>
<tr class="codeline" data-linenumber="3001"><td class="num" id="LN3001">3001</td><td class="line">    size_t eSize;</td></tr>
<tr class="codeline" data-linenumber="3002"><td class="num" id="LN3002">3002</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3003"><td class="num" id="LN3003">3003</td><td class="line">    <span class='macro'>ZSTD_STATIC_ASSERT(HUF_WORKSPACE_SIZE &gt;= (1&lt;&lt;MAX(MLFSELog,LLFSELog)))<span class='macro_popup'>(void)sizeof(char[(((6 &lt;&lt; 10) + 256) &gt;= (1&lt;&lt;((<br>9)&gt;(9) ? (9) : (9)))) ? 1 : -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3004"><td class="num" id="LN3004">3004</td><td class="line">    <span class='macro'>assert(dictSize &gt;= 8)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3005"><td class="num" id="LN3005">3005</td><td class="line">    <span class='macro'>assert(MEM_readLE32(dictPtr) == ZSTD_MAGIC_DICTIONARY)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3006"><td class="num" id="LN3006">3006</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3007"><td class="num" id="LN3007">3007</td><td class="line">    dictID = params-&gt;fParams.noDictIDFlag ? 0 :  MEM_readLE32(dictPtr + 4 <span class='comment'>/* skip magic number */</span> );</td></tr>
<tr class="codeline" data-linenumber="3008"><td class="num" id="LN3008">3008</td><td class="line">    eSize = ZSTD_loadCEntropy(bs, workspace, offcodeNCount, &amp;offcodeMaxValue, dict, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3009"><td class="num" id="LN3009">3009</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(eSize, <span class='string_literal'>"ZSTD_loadCEntropy failed"</span>)<span class='macro_popup'>do { size_t const err_code = (eSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_loadCEntropy failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3010"><td class="num" id="LN3010">3010</td><td class="line">    dictPtr += eSize;</td></tr>
<tr class="codeline" data-linenumber="3011"><td class="num" id="LN3011">3011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3012"><td class="num" id="LN3012">3012</td><td class="line">    {   size_t <span class='keyword'>const</span> dictContentSize = (size_t)(dictEnd - dictPtr);</td></tr>
<tr class="codeline" data-linenumber="3013"><td class="num" id="LN3013">3013</td><td class="line">        U32 offcodeMax = <span class='macro'>MaxOff<span class='macro_popup'>31</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3014"><td class="num" id="LN3014">3014</td><td class="line">        <span class='keyword'>if</span> (dictContentSize &lt;= ((U32)-1) - 128 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3015"><td class="num" id="LN3015">3015</td><td class="line">            U32 <span class='keyword'>const</span> maxOffset = (U32)dictContentSize + 128 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>; <span class='comment'>/* The maximum offset that must be supported */</span></td></tr>
<tr class="codeline" data-linenumber="3016"><td class="num" id="LN3016">3016</td><td class="line">            offcodeMax = ZSTD_highbit32(maxOffset); <span class='comment'>/* Calculate minimum offset code required to represent maxOffset */</span></td></tr>
<tr class="codeline" data-linenumber="3017"><td class="num" id="LN3017">3017</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3018"><td class="num" id="LN3018">3018</td><td class="line">        <span class='comment'>/* All offset values &lt;= dictContentSize + 128 KB must be representable */</span></td></tr>
<tr class="codeline" data-linenumber="3019"><td class="num" id="LN3019">3019</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_checkDictNCount(offcodeNCount, offcodeMaxValue, MIN(offcodeMax, MaxOff)), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkDictNCount(offcodeNCount<br>, offcodeMaxValue, ((offcodeMax)&lt;(31) ? (offcodeMax) : (31<br>)))); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3020"><td class="num" id="LN3020">3020</td><td class="line">        <span class='comment'>/* All repCodes must be &lt;= dictContentSize and != 0*/</span></td></tr>
<tr class="codeline" data-linenumber="3021"><td class="num" id="LN3021">3021</td><td class="line">        {   U32 u;</td></tr>
<tr class="codeline" data-linenumber="3022"><td class="num" id="LN3022">3022</td><td class="line">            <span class='keyword'>for</span> (u=0; u&lt;3; u++) {</td></tr>
<tr class="codeline" data-linenumber="3023"><td class="num" id="LN3023">3023</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(bs-&gt;rep[u] == 0, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (bs-&gt;rep[u] == 0) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3024"><td class="num" id="LN3024">3024</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(bs-&gt;rep[u] &gt; dictContentSize, dictionary_corrupted, <span class='string_literal'>""</span>)<span class='macro_popup'>if (bs-&gt;rep[u] &gt; dictContentSize) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_corrupted<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3025"><td class="num" id="LN3025">3025</td><td class="line">        }   }</td></tr>
<tr class="codeline" data-linenumber="3026"><td class="num" id="LN3026">3026</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3027"><td class="num" id="LN3027">3027</td><td class="line">        bs-&gt;entropy.fse.offcode_repeatMode = FSE_repeat_valid;</td></tr>
<tr class="codeline" data-linenumber="3028"><td class="num" id="LN3028">3028</td><td class="line">        bs-&gt;entropy.fse.matchlength_repeatMode = FSE_repeat_valid;</td></tr>
<tr class="codeline" data-linenumber="3029"><td class="num" id="LN3029">3029</td><td class="line">        bs-&gt;entropy.fse.litlength_repeatMode = FSE_repeat_valid;</td></tr>
<tr class="codeline" data-linenumber="3030"><td class="num" id="LN3030">3030</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(ZSTD_loadDictionaryContent(<span class='macro_popup'>do { size_t const err_code = (ZSTD_loadDictionaryContent( ms,<br> ((void*)0), ws, params, dictPtr, dictContentSize, dtlm)); if<br> (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3031"><td class="num" id="LN3031">3031</td><td class="line">            <span class='macro'>ms, NULL, ws, params, dictPtr, dictContentSize, dtlm), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_loadDictionaryContent( ms,<br> ((void*)0), ws, params, dictPtr, dictContentSize, dtlm)); if<br> (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3032"><td class="num" id="LN3032">3032</td><td class="line">        <span class='keyword'>return</span> dictID;</td></tr>
<tr class="codeline" data-linenumber="3033"><td class="num" id="LN3033">3033</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3034"><td class="num" id="LN3034">3034</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3035"><td class="num" id="LN3035">3035</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3036"><td class="num" id="LN3036">3036</td><td class="line"><span class='comment'>/** ZSTD_compress_insertDictionary() :</span></td></tr>
<tr class="codeline" data-linenumber="3037"><td class="num" id="LN3037">3037</td><td class="line"><span class='comment'>*   @return : dictID, or an error code */</span></td></tr>
<tr class="codeline" data-linenumber="3038"><td class="num" id="LN3038">3038</td><td class="line"><span class='keyword'>static</span> size_t</td></tr>
<tr class="codeline" data-linenumber="3039"><td class="num" id="LN3039">3039</td><td class="line">ZSTD_compress_insertDictionary(ZSTD_compressedBlockState_t* bs,</td></tr>
<tr class="codeline" data-linenumber="3040"><td class="num" id="LN3040">3040</td><td class="line">                               ZSTD_matchState_t* ms,</td></tr>
<tr class="codeline" data-linenumber="3041"><td class="num" id="LN3041">3041</td><td class="line">                               ldmState_t* ls,</td></tr>
<tr class="codeline" data-linenumber="3042"><td class="num" id="LN3042">3042</td><td class="line">                               ZSTD_cwksp* ws,</td></tr>
<tr class="codeline" data-linenumber="3043"><td class="num" id="LN3043">3043</td><td class="line">                         <span class='keyword'>const</span> ZSTD_CCtx_params* params,</td></tr>
<tr class="codeline" data-linenumber="3044"><td class="num" id="LN3044">3044</td><td class="line">                         <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3045"><td class="num" id="LN3045">3045</td><td class="line">                               ZSTD_dictContentType_e dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3046"><td class="num" id="LN3046">3046</td><td class="line">                               ZSTD_dictTableLoadMethod_e dtlm,</td></tr>
<tr class="codeline" data-linenumber="3047"><td class="num" id="LN3047">3047</td><td class="line">                               <span class='keyword'>void</span>* workspace)</td></tr>
<tr class="codeline" data-linenumber="3048"><td class="num" id="LN3048">3048</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3049"><td class="num" id="LN3049">3049</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compress_insertDictionary (dictSize=%u)"</span>, (U32)dictSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3050"><td class="num" id="LN3050">3050</td><td class="line">    <span class='keyword'>if</span> ((dict==<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) || (dictSize&lt;8)) {</td></tr>
<tr class="codeline" data-linenumber="3051"><td class="num" id="LN3051">3051</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(dictContentType == ZSTD_dct_fullDict, dictionary_wrong, <span class='string_literal'>""</span>)<span class='macro_popup'>if (dictContentType == ZSTD_dct_fullDict) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3052"><td class="num" id="LN3052">3052</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3053"><td class="num" id="LN3053">3053</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3054"><td class="num" id="LN3054">3054</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3055"><td class="num" id="LN3055">3055</td><td class="line">    ZSTD_reset_compressedBlockState(bs);</td></tr>
<tr class="codeline" data-linenumber="3056"><td class="num" id="LN3056">3056</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3057"><td class="num" id="LN3057">3057</td><td class="line">    <span class='comment'>/* dict restricted modes */</span></td></tr>
<tr class="codeline" data-linenumber="3058"><td class="num" id="LN3058">3058</td><td class="line">    <span class='keyword'>if</span> (dictContentType == ZSTD_dct_rawContent)</td></tr>
<tr class="codeline" data-linenumber="3059"><td class="num" id="LN3059">3059</td><td class="line">        <span class='keyword'>return</span> ZSTD_loadDictionaryContent(ms, ls, ws, params, dict, dictSize, dtlm);</td></tr>
<tr class="codeline" data-linenumber="3060"><td class="num" id="LN3060">3060</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3061"><td class="num" id="LN3061">3061</td><td class="line">    <span class='keyword'>if</span> (MEM_readLE32(dict) != <span class='macro'>ZSTD_MAGIC_DICTIONARY<span class='macro_popup'>0xEC30A437</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3062"><td class="num" id="LN3062">3062</td><td class="line">        <span class='keyword'>if</span> (dictContentType == ZSTD_dct_auto) {</td></tr>
<tr class="codeline" data-linenumber="3063"><td class="num" id="LN3063">3063</td><td class="line">            <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"raw content dictionary detected"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3064"><td class="num" id="LN3064">3064</td><td class="line">            <span class='keyword'>return</span> ZSTD_loadDictionaryContent(</td></tr>
<tr class="codeline" data-linenumber="3065"><td class="num" id="LN3065">3065</td><td class="line">                ms, ls, ws, params, dict, dictSize, dtlm);</td></tr>
<tr class="codeline" data-linenumber="3066"><td class="num" id="LN3066">3066</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3067"><td class="num" id="LN3067">3067</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(dictContentType == ZSTD_dct_fullDict, dictionary_wrong, <span class='string_literal'>""</span>)<span class='macro_popup'>if (dictContentType == ZSTD_dct_fullDict) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3068"><td class="num" id="LN3068">3068</td><td class="line">        <span class='macro'>assert(0)<span class='macro_popup'>((void)0)</span></span>;   <span class='comment'>/* impossible */</span></td></tr>
<tr class="codeline" data-linenumber="3069"><td class="num" id="LN3069">3069</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3070"><td class="num" id="LN3070">3070</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3071"><td class="num" id="LN3071">3071</td><td class="line">    <span class='comment'>/* dict as full zstd dictionary */</span></td></tr>
<tr class="codeline" data-linenumber="3072"><td class="num" id="LN3072">3072</td><td class="line">    <span class='keyword'>return</span> ZSTD_loadZstdDictionary(</td></tr>
<tr class="codeline" data-linenumber="3073"><td class="num" id="LN3073">3073</td><td class="line">        bs, ms, ws, params, dict, dictSize, dtlm, workspace);</td></tr>
<tr class="codeline" data-linenumber="3074"><td class="num" id="LN3074">3074</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3075"><td class="num" id="LN3075">3075</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3076"><td class="num" id="LN3076">3076</td><td class="line"><span class='directive'>#define <span class='macro'>ZSTD_USE_CDICT_PARAMS_SRCSIZE_CUTOFF<span class='macro_popup'>(128 *(1 &lt;&lt;10))</span></span> (128 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="3077"><td class="num" id="LN3077">3077</td><td class="line"><span class='directive'>#define <span class='macro'>ZSTD_USE_CDICT_PARAMS_DICTSIZE_MULTIPLIER<span class='macro_popup'>(6)</span></span> (6)</span></td></tr>
<tr class="codeline" data-linenumber="3078"><td class="num" id="LN3078">3078</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3079"><td class="num" id="LN3079">3079</td><td class="line"><span class='comment'>/*! ZSTD_compressBegin_internal() :</span></td></tr>
<tr class="codeline" data-linenumber="3080"><td class="num" id="LN3080">3080</td><td class="line"> <span class='comment'>* @return : 0, or an error code */</span></td></tr>
<tr class="codeline" data-linenumber="3081"><td class="num" id="LN3081">3081</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compressBegin_internal(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3082"><td class="num" id="LN3082">3082</td><td class="line">                                    <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3083"><td class="num" id="LN3083">3083</td><td class="line">                                    ZSTD_dictContentType_e dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3084"><td class="num" id="LN3084">3084</td><td class="line">                                    ZSTD_dictTableLoadMethod_e dtlm,</td></tr>
<tr class="codeline" data-linenumber="3085"><td class="num" id="LN3085">3085</td><td class="line">                                    <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="3086"><td class="num" id="LN3086">3086</td><td class="line">                                    <span class='keyword'>const</span> ZSTD_CCtx_params* params, U64 pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="3087"><td class="num" id="LN3087">3087</td><td class="line">                                    ZSTD_buffered_policy_e zbuff)</td></tr>
<tr class="codeline" data-linenumber="3088"><td class="num" id="LN3088">3088</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3089"><td class="num" id="LN3089">3089</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressBegin_internal: wlog=%u"</span>, params-&gt;cParams.windowLog)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3090"><td class="num" id="LN3090">3090</td><td class="line">    <span class='comment'>/* params are supposed to be fully validated at this point */</span></td></tr>
<tr class="codeline" data-linenumber="3091"><td class="num" id="LN3091">3091</td><td class="line">    <span class='macro'>assert(!ZSTD_isError(ZSTD_checkCParams(params-&gt;cParams)))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3092"><td class="num" id="LN3092">3092</td><td class="line">    <span class='macro'>assert(!((dict) &amp;&amp; (cdict)))<span class='macro_popup'>((void)0)</span></span>;  <span class='comment'>/* either dict or cdict, not both */</span></td></tr>
<tr class="codeline" data-linenumber="3093"><td class="num" id="LN3093">3093</td><td class="line">    <span class='keyword'>if</span> ( (cdict)</td></tr>
<tr class="codeline" data-linenumber="3094"><td class="num" id="LN3094">3094</td><td class="line">      &amp;&amp; (cdict-&gt;dictContentSize &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3095"><td class="num" id="LN3095">3095</td><td class="line">      &amp;&amp; ( pledgedSrcSize &lt; <span class='macro'>ZSTD_USE_CDICT_PARAMS_SRCSIZE_CUTOFF<span class='macro_popup'>(128 *(1 &lt;&lt;10))</span></span></td></tr>
<tr class="codeline" data-linenumber="3096"><td class="num" id="LN3096">3096</td><td class="line">        || pledgedSrcSize &lt; cdict-&gt;dictContentSize * <span class='macro'>ZSTD_USE_CDICT_PARAMS_DICTSIZE_MULTIPLIER<span class='macro_popup'>(6)</span></span></td></tr>
<tr class="codeline" data-linenumber="3097"><td class="num" id="LN3097">3097</td><td class="line">        || pledgedSrcSize == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span></td></tr>
<tr class="codeline" data-linenumber="3098"><td class="num" id="LN3098">3098</td><td class="line">        || cdict-&gt;compressionLevel == 0)</td></tr>
<tr class="codeline" data-linenumber="3099"><td class="num" id="LN3099">3099</td><td class="line">      &amp;&amp; (params-&gt;attachDictPref != ZSTD_dictForceLoad) ) {</td></tr>
<tr class="codeline" data-linenumber="3100"><td class="num" id="LN3100">3100</td><td class="line">        <span class='keyword'>return</span> ZSTD_resetCCtx_usingCDict(cctx, cdict, params, pledgedSrcSize, zbuff);</td></tr>
<tr class="codeline" data-linenumber="3101"><td class="num" id="LN3101">3101</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3102"><td class="num" id="LN3102">3102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3103"><td class="num" id="LN3103">3103</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_resetCCtx_internal(cctx, *params, pledgedSrcSize,<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCCtx_internal(cctx, *<br>params, pledgedSrcSize, ZSTDcrp_makeClean, zbuff)); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string(""); }; {<br>}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3104"><td class="num" id="LN3104">3104</td><td class="line">                                     <span class='macro'>ZSTDcrp_makeClean, zbuff) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCCtx_internal(cctx, *<br>params, pledgedSrcSize, ZSTDcrp_makeClean, zbuff)); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string(""); }; {<br>}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3105"><td class="num" id="LN3105">3105</td><td class="line">    {   size_t <span class='keyword'>const</span> dictID = cdict ?</td></tr>
<tr class="codeline" data-linenumber="3106"><td class="num" id="LN3106">3106</td><td class="line">                ZSTD_compress_insertDictionary(</td></tr>
<tr class="codeline" data-linenumber="3107"><td class="num" id="LN3107">3107</td><td class="line">                        cctx-&gt;blockState.prevCBlock, &amp;cctx-&gt;blockState.matchState,</td></tr>
<tr class="codeline" data-linenumber="3108"><td class="num" id="LN3108">3108</td><td class="line">                        &amp;cctx-&gt;ldmState, &amp;cctx-&gt;workspace, &amp;cctx-&gt;appliedParams, cdict-&gt;dictContent,</td></tr>
<tr class="codeline" data-linenumber="3109"><td class="num" id="LN3109">3109</td><td class="line">                        cdict-&gt;dictContentSize, dictContentType, dtlm,</td></tr>
<tr class="codeline" data-linenumber="3110"><td class="num" id="LN3110">3110</td><td class="line">                        cctx-&gt;entropyWorkspace)</td></tr>
<tr class="codeline" data-linenumber="3111"><td class="num" id="LN3111">3111</td><td class="line">              : ZSTD_compress_insertDictionary(</td></tr>
<tr class="codeline" data-linenumber="3112"><td class="num" id="LN3112">3112</td><td class="line">                        cctx-&gt;blockState.prevCBlock, &amp;cctx-&gt;blockState.matchState,</td></tr>
<tr class="codeline" data-linenumber="3113"><td class="num" id="LN3113">3113</td><td class="line">                        &amp;cctx-&gt;ldmState, &amp;cctx-&gt;workspace, &amp;cctx-&gt;appliedParams, dict, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3114"><td class="num" id="LN3114">3114</td><td class="line">                        dictContentType, dtlm, cctx-&gt;entropyWorkspace);</td></tr>
<tr class="codeline" data-linenumber="3115"><td class="num" id="LN3115">3115</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(dictID, <span class='string_literal'>"ZSTD_compress_insertDictionary failed"</span>)<span class='macro_popup'>do { size_t const err_code = (dictID); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compress_insertDictionary failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3116"><td class="num" id="LN3116">3116</td><td class="line">        <span class='macro'>assert(dictID &lt;= UINT_MAX)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3117"><td class="num" id="LN3117">3117</td><td class="line">        cctx-&gt;dictID = (U32)dictID;</td></tr>
<tr class="codeline" data-linenumber="3118"><td class="num" id="LN3118">3118</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3119"><td class="num" id="LN3119">3119</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3120"><td class="num" id="LN3120">3120</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3121"><td class="num" id="LN3121">3121</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3122"><td class="num" id="LN3122">3122</td><td class="line">size_t ZSTD_compressBegin_advanced_internal(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3123"><td class="num" id="LN3123">3123</td><td class="line">                                    <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3124"><td class="num" id="LN3124">3124</td><td class="line">                                    ZSTD_dictContentType_e dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3125"><td class="num" id="LN3125">3125</td><td class="line">                                    ZSTD_dictTableLoadMethod_e dtlm,</td></tr>
<tr class="codeline" data-linenumber="3126"><td class="num" id="LN3126">3126</td><td class="line">                                    <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="3127"><td class="num" id="LN3127">3127</td><td class="line">                                    <span class='keyword'>const</span> ZSTD_CCtx_params* params,</td></tr>
<tr class="codeline" data-linenumber="3128"><td class="num" id="LN3128">3128</td><td class="line">                                    <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="3129"><td class="num" id="LN3129">3129</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3130"><td class="num" id="LN3130">3130</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressBegin_advanced_internal: wlog=%u"</span>, params-&gt;cParams.windowLog)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3131"><td class="num" id="LN3131">3131</td><td class="line">    <span class='comment'>/* compression parameters verification and optimization */</span></td></tr>
<tr class="codeline" data-linenumber="3132"><td class="num" id="LN3132">3132</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_checkCParams(params-&gt;cParams) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkCParams(params-&gt;cParams<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3133"><td class="num" id="LN3133">3133</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressBegin_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="3134"><td class="num" id="LN3134">3134</td><td class="line">                                       dict, dictSize, dictContentType, dtlm,</td></tr>
<tr class="codeline" data-linenumber="3135"><td class="num" id="LN3135">3135</td><td class="line">                                       cdict,</td></tr>
<tr class="codeline" data-linenumber="3136"><td class="num" id="LN3136">3136</td><td class="line">                                       params, pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="3137"><td class="num" id="LN3137">3137</td><td class="line">                                       ZSTDb_not_buffered);</td></tr>
<tr class="codeline" data-linenumber="3138"><td class="num" id="LN3138">3138</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3139"><td class="num" id="LN3139">3139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3140"><td class="num" id="LN3140">3140</td><td class="line"><span class='comment'>/*! ZSTD_compressBegin_advanced() :</span></td></tr>
<tr class="codeline" data-linenumber="3141"><td class="num" id="LN3141">3141</td><td class="line"><span class='comment'>*   @return : 0, or an error code */</span></td></tr>
<tr class="codeline" data-linenumber="3142"><td class="num" id="LN3142">3142</td><td class="line">size_t ZSTD_compressBegin_advanced(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3143"><td class="num" id="LN3143">3143</td><td class="line">                             <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3144"><td class="num" id="LN3144">3144</td><td class="line">                                   ZSTD_parameters params, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="3145"><td class="num" id="LN3145">3145</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3146"><td class="num" id="LN3146">3146</td><td class="line">    ZSTD_CCtx_params <span class='keyword'>const</span> cctxParams =</td></tr>
<tr class="codeline" data-linenumber="3147"><td class="num" id="LN3147">3147</td><td class="line">            ZSTD_assignParamsToCCtxParams(&amp;cctx-&gt;requestedParams, &amp;params);</td></tr>
<tr class="codeline" data-linenumber="3148"><td class="num" id="LN3148">3148</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressBegin_advanced_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="3149"><td class="num" id="LN3149">3149</td><td class="line">                                            dict, dictSize, ZSTD_dct_auto, ZSTD_dtlm_fast,</td></tr>
<tr class="codeline" data-linenumber="3150"><td class="num" id="LN3150">3150</td><td class="line">                                            <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> <span class='comment'>/*cdict*/</span>,</td></tr>
<tr class="codeline" data-linenumber="3151"><td class="num" id="LN3151">3151</td><td class="line">                                            &amp;cctxParams, pledgedSrcSize);</td></tr>
<tr class="codeline" data-linenumber="3152"><td class="num" id="LN3152">3152</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3153"><td class="num" id="LN3153">3153</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3154"><td class="num" id="LN3154">3154</td><td class="line">size_t ZSTD_compressBegin_usingDict(ZSTD_CCtx* cctx, <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3155"><td class="num" id="LN3155">3155</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3156"><td class="num" id="LN3156">3156</td><td class="line">    ZSTD_parameters <span class='keyword'>const</span> params = ZSTD_getParams_internal(compressionLevel, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3157"><td class="num" id="LN3157">3157</td><td class="line">    ZSTD_CCtx_params <span class='keyword'>const</span> cctxParams =</td></tr>
<tr class="codeline" data-linenumber="3158"><td class="num" id="LN3158">3158</td><td class="line">            ZSTD_assignParamsToCCtxParams(&amp;cctx-&gt;requestedParams, &amp;params);</td></tr>
<tr class="codeline" data-linenumber="3159"><td class="num" id="LN3159">3159</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressBegin_usingDict (dictSize=%u)"</span>, (<span class='keyword'>unsigned</span>)dictSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3160"><td class="num" id="LN3160">3160</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressBegin_internal(cctx, dict, dictSize, ZSTD_dct_auto, ZSTD_dtlm_fast, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>,</td></tr>
<tr class="codeline" data-linenumber="3161"><td class="num" id="LN3161">3161</td><td class="line">                                       &amp;cctxParams, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, ZSTDb_not_buffered);</td></tr>
<tr class="codeline" data-linenumber="3162"><td class="num" id="LN3162">3162</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3163"><td class="num" id="LN3163">3163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3164"><td class="num" id="LN3164">3164</td><td class="line">size_t ZSTD_compressBegin(ZSTD_CCtx* cctx, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3165"><td class="num" id="LN3165">3165</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3166"><td class="num" id="LN3166">3166</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressBegin_usingDict(cctx, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, compressionLevel);</td></tr>
<tr class="codeline" data-linenumber="3167"><td class="num" id="LN3167">3167</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3168"><td class="num" id="LN3168">3168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3169"><td class="num" id="LN3169">3169</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3170"><td class="num" id="LN3170">3170</td><td class="line"><span class='comment'>/*! ZSTD_writeEpilogue() :</span></td></tr>
<tr class="codeline" data-linenumber="3171"><td class="num" id="LN3171">3171</td><td class="line"><span class='comment'>*   Ends a frame.</span></td></tr>
<tr class="codeline" data-linenumber="3172"><td class="num" id="LN3172">3172</td><td class="line"><span class='comment'>*   @return : nb of bytes written into dst (or an error code) */</span></td></tr>
<tr class="codeline" data-linenumber="3173"><td class="num" id="LN3173">3173</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_writeEpilogue(ZSTD_CCtx* cctx, <span class='keyword'>void</span>* dst, size_t dstCapacity)</td></tr>
<tr class="codeline" data-linenumber="3174"><td class="num" id="LN3174">3174</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3175"><td class="num" id="LN3175">3175</td><td class="line">    BYTE* <span class='keyword'>const</span> ostart = (BYTE*)dst;</td></tr>
<tr class="codeline" data-linenumber="3176"><td class="num" id="LN3176">3176</td><td class="line">    BYTE* op = ostart;</td></tr>
<tr class="codeline" data-linenumber="3177"><td class="num" id="LN3177">3177</td><td class="line">    size_t fhSize = 0;</td></tr>
<tr class="codeline" data-linenumber="3178"><td class="num" id="LN3178">3178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3179"><td class="num" id="LN3179">3179</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_writeEpilogue"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3180"><td class="num" id="LN3180">3180</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cctx-&gt;stage == ZSTDcs_created, stage_wrong, <span class='string_literal'>"init missing"</span>)<span class='macro_popup'>if (cctx-&gt;stage == ZSTDcs_created) { {}; if (0) { _force_has_format_string<br>("init missing"); }; {}; {}; return ((size_t)-ZSTD_error_stage_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3181"><td class="num" id="LN3181">3181</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3182"><td class="num" id="LN3182">3182</td><td class="line">    <span class='comment'>/* special case : empty frame */</span></td></tr>
<tr class="codeline" data-linenumber="3183"><td class="num" id="LN3183">3183</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;stage == ZSTDcs_init) {</td></tr>
<tr class="codeline" data-linenumber="3184"><td class="num" id="LN3184">3184</td><td class="line">        fhSize = ZSTD_writeFrameHeader(dst, dstCapacity, &amp;cctx-&gt;appliedParams, 0, 0);</td></tr>
<tr class="codeline" data-linenumber="3185"><td class="num" id="LN3185">3185</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(fhSize, <span class='string_literal'>"ZSTD_writeFrameHeader failed"</span>)<span class='macro_popup'>do { size_t const err_code = (fhSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_writeFrameHeader failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3186"><td class="num" id="LN3186">3186</td><td class="line">        dstCapacity -= fhSize;</td></tr>
<tr class="codeline" data-linenumber="3187"><td class="num" id="LN3187">3187</td><td class="line">        op += fhSize;</td></tr>
<tr class="codeline" data-linenumber="3188"><td class="num" id="LN3188">3188</td><td class="line">        cctx-&gt;stage = ZSTDcs_ongoing;</td></tr>
<tr class="codeline" data-linenumber="3189"><td class="num" id="LN3189">3189</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3190"><td class="num" id="LN3190">3190</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3191"><td class="num" id="LN3191">3191</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;stage != ZSTDcs_ending) {</td></tr>
<tr class="codeline" data-linenumber="3192"><td class="num" id="LN3192">3192</td><td class="line">        <span class='comment'>/* write one last empty block, make it the "last" block */</span></td></tr>
<tr class="codeline" data-linenumber="3193"><td class="num" id="LN3193">3193</td><td class="line">        U32 <span class='keyword'>const</span> cBlockHeader24 = 1 <span class='comment'>/* last block */</span> + (((U32)bt_raw)&lt;&lt;1) + 0;</td></tr>
<tr class="codeline" data-linenumber="3194"><td class="num" id="LN3194">3194</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(dstCapacity&lt;4, dstSize_tooSmall, <span class='string_literal'>"no room for epilogue"</span>)<span class='macro_popup'>if (dstCapacity&lt;4) { {}; if (0) { _force_has_format_string<br>("no room for epilogue"); }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3195"><td class="num" id="LN3195">3195</td><td class="line">        MEM_writeLE32(op, cBlockHeader24);</td></tr>
<tr class="codeline" data-linenumber="3196"><td class="num" id="LN3196">3196</td><td class="line">        op += ZSTD_blockHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="3197"><td class="num" id="LN3197">3197</td><td class="line">        dstCapacity -= ZSTD_blockHeaderSize;</td></tr>
<tr class="codeline" data-linenumber="3198"><td class="num" id="LN3198">3198</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3199"><td class="num" id="LN3199">3199</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3200"><td class="num" id="LN3200">3200</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.fParams.checksumFlag) {</td></tr>
<tr class="codeline" data-linenumber="3201"><td class="num" id="LN3201">3201</td><td class="line">        U32 <span class='keyword'>const</span> checksum = (U32) <span class='macro'>XXH64_digest<span class='macro_popup'>ZSTD_XXH64_digest</span></span>(&amp;cctx-&gt;xxhState);</td></tr>
<tr class="codeline" data-linenumber="3202"><td class="num" id="LN3202">3202</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(dstCapacity&lt;4, dstSize_tooSmall, <span class='string_literal'>"no room for checksum"</span>)<span class='macro_popup'>if (dstCapacity&lt;4) { {}; if (0) { _force_has_format_string<br>("no room for checksum"); }; {}; {}; return ((size_t)-ZSTD_error_dstSize_tooSmall<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3203"><td class="num" id="LN3203">3203</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_writeEpilogue: write checksum : %08X"</span>, (<span class='keyword'>unsigned</span>)checksum)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3204"><td class="num" id="LN3204">3204</td><td class="line">        MEM_writeLE32(op, checksum);</td></tr>
<tr class="codeline" data-linenumber="3205"><td class="num" id="LN3205">3205</td><td class="line">        op += 4;</td></tr>
<tr class="codeline" data-linenumber="3206"><td class="num" id="LN3206">3206</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3207"><td class="num" id="LN3207">3207</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3208"><td class="num" id="LN3208">3208</td><td class="line">    cctx-&gt;stage = ZSTDcs_created;  <span class='comment'>/* return to "created but no init" status */</span></td></tr>
<tr class="codeline" data-linenumber="3209"><td class="num" id="LN3209">3209</td><td class="line">    <span class='keyword'>return</span> op-ostart;</td></tr>
<tr class="codeline" data-linenumber="3210"><td class="num" id="LN3210">3210</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3211"><td class="num" id="LN3211">3211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3212"><td class="num" id="LN3212">3212</td><td class="line">size_t ZSTD_compressEnd (ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3213"><td class="num" id="LN3213">3213</td><td class="line">                         <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3214"><td class="num" id="LN3214">3214</td><td class="line">                   <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize)</td></tr>
<tr class="codeline" data-linenumber="3215"><td class="num" id="LN3215">3215</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3216"><td class="num" id="LN3216">3216</td><td class="line">    size_t endResult;</td></tr>
<tr class="codeline" data-linenumber="3217"><td class="num" id="LN3217">3217</td><td class="line">    size_t <span class='keyword'>const</span> cSize = ZSTD_compressContinue_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="3218"><td class="num" id="LN3218">3218</td><td class="line">                                dst, dstCapacity, src, srcSize,</td></tr>
<tr class="codeline" data-linenumber="3219"><td class="num" id="LN3219">3219</td><td class="line">                                1 <span class='comment'>/* frame mode */</span>, 1 <span class='comment'>/* last chunk */</span>);</td></tr>
<tr class="codeline" data-linenumber="3220"><td class="num" id="LN3220">3220</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressContinue_internal failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressContinue_internal failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3221"><td class="num" id="LN3221">3221</td><td class="line">    endResult = ZSTD_writeEpilogue(cctx, (<span class='keyword'>char</span>*)dst + cSize, dstCapacity-cSize);</td></tr>
<tr class="codeline" data-linenumber="3222"><td class="num" id="LN3222">3222</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(endResult, <span class='string_literal'>"ZSTD_writeEpilogue failed"</span>)<span class='macro_popup'>do { size_t const err_code = (endResult); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_writeEpilogue failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3223"><td class="num" id="LN3223">3223</td><td class="line">    <span class='macro'>assert(!(cctx-&gt;appliedParams.fParams.contentSizeFlag &amp;&amp; cctx-&gt;pledgedSrcSizePlusOne == 0))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3224"><td class="num" id="LN3224">3224</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;pledgedSrcSizePlusOne != 0) {  <span class='comment'>/* control src size */</span></td></tr>
<tr class="codeline" data-linenumber="3225"><td class="num" id="LN3225">3225</td><td class="line">        <span class='macro'>ZSTD_STATIC_ASSERT(ZSTD_CONTENTSIZE_UNKNOWN == (<span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span>)-1)<span class='macro_popup'>(void)sizeof(char[((0ULL - 1) == (unsigned long long)-1) ? 1 :<br> -1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3226"><td class="num" id="LN3226">3226</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"end of frame : controlling src size"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3227"><td class="num" id="LN3227">3227</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(<span class='macro_popup'>if (cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize<br>+1) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize = %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="3228"><td class="num" id="LN3228">3228</td><td class="line">            <span class='macro'>cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize+1,<span class='macro_popup'>if (cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize<br>+1) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize = %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="3229"><td class="num" id="LN3229">3229</td><td class="line">            <span class='macro'>srcSize_wrong,<span class='macro_popup'>if (cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize<br>+1) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize = %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="3230"><td class="num" id="LN3230">3230</td><td class="line">             <span class='string_literal'><span class='macro'>"error : pledgedSrcSize = %u, while realSrcSize = %u"</span>,<span class='macro_popup'>if (cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize<br>+1) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize = %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="3231"><td class="num" id="LN3231">3231</td><td class="line">            <span class='macro'>(<span class='keyword'>unsigned</span>)cctx-&gt;pledgedSrcSizePlusOne-1,<span class='macro_popup'>if (cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize<br>+1) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize = %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span></td></tr>
<tr class="codeline" data-linenumber="3232"><td class="num" id="LN3232">3232</td><td class="line">            <span class='macro'>(<span class='keyword'>unsigned</span>)cctx-&gt;consumedSrcSize)<span class='macro_popup'>if (cctx-&gt;pledgedSrcSizePlusOne != cctx-&gt;consumedSrcSize<br>+1) { {}; if (0) { _force_has_format_string("error : pledgedSrcSize = %u, while realSrcSize = %u"<br>, (unsigned)cctx-&gt;pledgedSrcSizePlusOne-1, (unsigned)cctx-&gt;<br>consumedSrcSize); }; {}; {}; return ((size_t)-ZSTD_error_srcSize_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3233"><td class="num" id="LN3233">3233</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3234"><td class="num" id="LN3234">3234</td><td class="line">    <span class='keyword'>return</span> cSize + endResult;</td></tr>
<tr class="codeline" data-linenumber="3235"><td class="num" id="LN3235">3235</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3236"><td class="num" id="LN3236">3236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3237"><td class="num" id="LN3237">3237</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3238"><td class="num" id="LN3238">3238</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compress_internal (ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3239"><td class="num" id="LN3239">3239</td><td class="line">                                      <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3240"><td class="num" id="LN3240">3240</td><td class="line">                                <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3241"><td class="num" id="LN3241">3241</td><td class="line">                                <span class='keyword'>const</span> <span class='keyword'>void</span>* dict,size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3242"><td class="num" id="LN3242">3242</td><td class="line">                                <span class='keyword'>const</span> ZSTD_parameters* params)</td></tr>
<tr class="codeline" data-linenumber="3243"><td class="num" id="LN3243">3243</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3244"><td class="num" id="LN3244">3244</td><td class="line">    ZSTD_CCtx_params <span class='keyword'>const</span> cctxParams =</td></tr>
<tr class="codeline" data-linenumber="3245"><td class="num" id="LN3245">3245</td><td class="line">            ZSTD_assignParamsToCCtxParams(&amp;cctx-&gt;requestedParams, params);</td></tr>
<tr class="codeline" data-linenumber="3246"><td class="num" id="LN3246">3246</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compress_internal"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3247"><td class="num" id="LN3247">3247</td><td class="line">    <span class='keyword'>return</span> ZSTD_compress_advanced_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="3248"><td class="num" id="LN3248">3248</td><td class="line">                                           dst, dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3249"><td class="num" id="LN3249">3249</td><td class="line">                                           src, srcSize,</td></tr>
<tr class="codeline" data-linenumber="3250"><td class="num" id="LN3250">3250</td><td class="line">                                           dict, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3251"><td class="num" id="LN3251">3251</td><td class="line">                                           &amp;cctxParams);</td></tr>
<tr class="codeline" data-linenumber="3252"><td class="num" id="LN3252">3252</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3253"><td class="num" id="LN3253">3253</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3254"><td class="num" id="LN3254">3254</td><td class="line">size_t ZSTD_compress_advanced (ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3255"><td class="num" id="LN3255">3255</td><td class="line">                               <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3256"><td class="num" id="LN3256">3256</td><td class="line">                         <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3257"><td class="num" id="LN3257">3257</td><td class="line">                         <span class='keyword'>const</span> <span class='keyword'>void</span>* dict,size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3258"><td class="num" id="LN3258">3258</td><td class="line">                               ZSTD_parameters params)</td></tr>
<tr class="codeline" data-linenumber="3259"><td class="num" id="LN3259">3259</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3260"><td class="num" id="LN3260">3260</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compress_advanced"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3261"><td class="num" id="LN3261">3261</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(ZSTD_checkCParams(params.cParams), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkCParams(params.cParams<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3262"><td class="num" id="LN3262">3262</td><td class="line">    <span class='keyword'>return</span> ZSTD_compress_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="3263"><td class="num" id="LN3263">3263</td><td class="line">                                  dst, dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3264"><td class="num" id="LN3264">3264</td><td class="line">                                  src, srcSize,</td></tr>
<tr class="codeline" data-linenumber="3265"><td class="num" id="LN3265">3265</td><td class="line">                                  dict, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3266"><td class="num" id="LN3266">3266</td><td class="line">                                  &amp;params);</td></tr>
<tr class="codeline" data-linenumber="3267"><td class="num" id="LN3267">3267</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3268"><td class="num" id="LN3268">3268</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3269"><td class="num" id="LN3269">3269</td><td class="line"><span class='comment'>/* Internal */</span></td></tr>
<tr class="codeline" data-linenumber="3270"><td class="num" id="LN3270">3270</td><td class="line">size_t ZSTD_compress_advanced_internal(</td></tr>
<tr class="codeline" data-linenumber="3271"><td class="num" id="LN3271">3271</td><td class="line">        ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3272"><td class="num" id="LN3272">3272</td><td class="line">        <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3273"><td class="num" id="LN3273">3273</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3274"><td class="num" id="LN3274">3274</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>void</span>* dict,size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3275"><td class="num" id="LN3275">3275</td><td class="line">        <span class='keyword'>const</span> ZSTD_CCtx_params* params)</td></tr>
<tr class="codeline" data-linenumber="3276"><td class="num" id="LN3276">3276</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3277"><td class="num" id="LN3277">3277</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compress_advanced_internal (srcSize:%u)"</span>, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3278"><td class="num" id="LN3278">3278</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_compressBegin_internal(cctx,<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, ZSTD_dct_auto, ZSTD_dtlm_fast, ((void*)0), params<br>, srcSize, ZSTDb_not_buffered)); if (ERR_isError(err_code)) {<br> {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3279"><td class="num" id="LN3279">3279</td><td class="line">                         <span class='macro'>dict, dictSize, ZSTD_dct_auto, ZSTD_dtlm_fast, NULL,<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, ZSTD_dct_auto, ZSTD_dtlm_fast, ((void*)0), params<br>, srcSize, ZSTDb_not_buffered)); if (ERR_isError(err_code)) {<br> {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3280"><td class="num" id="LN3280">3280</td><td class="line">                         <span class='macro'>params, srcSize, ZSTDb_not_buffered) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, ZSTD_dct_auto, ZSTD_dtlm_fast, ((void*)0), params<br>, srcSize, ZSTDb_not_buffered)); if (ERR_isError(err_code)) {<br> {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3281"><td class="num" id="LN3281">3281</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressEnd(cctx, dst, dstCapacity, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="3282"><td class="num" id="LN3282">3282</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3283"><td class="num" id="LN3283">3283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3284"><td class="num" id="LN3284">3284</td><td class="line">size_t ZSTD_compress_usingDict(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3285"><td class="num" id="LN3285">3285</td><td class="line">                               <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3286"><td class="num" id="LN3286">3286</td><td class="line">                         <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3287"><td class="num" id="LN3287">3287</td><td class="line">                         <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3288"><td class="num" id="LN3288">3288</td><td class="line">                               <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3289"><td class="num" id="LN3289">3289</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3290"><td class="num" id="LN3290">3290</td><td class="line">    ZSTD_parameters <span class='keyword'>const</span> params = ZSTD_getParams_internal(compressionLevel, srcSize, dict ? dictSize : 0);</td></tr>
<tr class="codeline" data-linenumber="3291"><td class="num" id="LN3291">3291</td><td class="line">    ZSTD_CCtx_params cctxParams = ZSTD_assignParamsToCCtxParams(&amp;cctx-&gt;requestedParams, &amp;params);</td></tr>
<tr class="codeline" data-linenumber="3292"><td class="num" id="LN3292">3292</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compress_usingDict (srcSize=%u)"</span>, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3293"><td class="num" id="LN3293">3293</td><td class="line">    <span class='macro'>assert(params.fParams.contentSizeFlag == 1)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3294"><td class="num" id="LN3294">3294</td><td class="line">    <span class='keyword'>return</span> ZSTD_compress_advanced_internal(cctx, dst, dstCapacity, src, srcSize, dict, dictSize, &amp;cctxParams);</td></tr>
<tr class="codeline" data-linenumber="3295"><td class="num" id="LN3295">3295</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3296"><td class="num" id="LN3296">3296</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3297"><td class="num" id="LN3297">3297</td><td class="line">size_t ZSTD_compressCCtx(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3298"><td class="num" id="LN3298">3298</td><td class="line">                         <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3299"><td class="num" id="LN3299">3299</td><td class="line">                   <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3300"><td class="num" id="LN3300">3300</td><td class="line">                         <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3301"><td class="num" id="LN3301">3301</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3302"><td class="num" id="LN3302">3302</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressCCtx (srcSize=%u)"</span>, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3303"><td class="num" id="LN3303">3303</td><td class="line">    <span class='macro'>assert(cctx != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3304"><td class="num" id="LN3304">3304</td><td class="line">    <span class='keyword'>return</span> ZSTD_compress_usingDict(cctx, dst, dstCapacity, src, srcSize, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, compressionLevel);</td></tr>
<tr class="codeline" data-linenumber="3305"><td class="num" id="LN3305">3305</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3306"><td class="num" id="LN3306">3306</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3307"><td class="num" id="LN3307">3307</td><td class="line">size_t ZSTD_compress(<span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3308"><td class="num" id="LN3308">3308</td><td class="line">               <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3309"><td class="num" id="LN3309">3309</td><td class="line">                     <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3310"><td class="num" id="LN3310">3310</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3311"><td class="num" id="LN3311">3311</td><td class="line">    size_t result;</td></tr>
<tr class="codeline" data-linenumber="3312"><td class="num" id="LN3312">3312</td><td class="line">    ZSTD_CCtx ctxBody;</td></tr>
<tr class="codeline" data-linenumber="3313"><td class="num" id="LN3313">3313</td><td class="line">    ZSTD_initCCtx(&amp;ctxBody, ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="3314"><td class="num" id="LN3314">3314</td><td class="line">    result = ZSTD_compressCCtx(&amp;ctxBody, dst, dstCapacity, src, srcSize, compressionLevel);</td></tr>
<tr class="codeline" data-linenumber="3315"><td class="num" id="LN3315">3315</td><td class="line">    ZSTD_freeCCtxContent(&amp;ctxBody);   <span class='comment'>/* can't free ctxBody itself, as it's on stack; free only heap content */</span></td></tr>
<tr class="codeline" data-linenumber="3316"><td class="num" id="LN3316">3316</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="3317"><td class="num" id="LN3317">3317</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3318"><td class="num" id="LN3318">3318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3319"><td class="num" id="LN3319">3319</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3320"><td class="num" id="LN3320">3320</td><td class="line"><span class='comment'>/* =====  Dictionary API  ===== */</span></td></tr>
<tr class="codeline" data-linenumber="3321"><td class="num" id="LN3321">3321</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3322"><td class="num" id="LN3322">3322</td><td class="line"><span class='comment'>/*! ZSTD_estimateCDictSize_advanced() :</span></td></tr>
<tr class="codeline" data-linenumber="3323"><td class="num" id="LN3323">3323</td><td class="line"> <span class='comment'>*  Estimate amount of memory that will be needed to create a dictionary with following arguments */</span></td></tr>
<tr class="codeline" data-linenumber="3324"><td class="num" id="LN3324">3324</td><td class="line">size_t ZSTD_estimateCDictSize_advanced(</td></tr>
<tr class="codeline" data-linenumber="3325"><td class="num" id="LN3325">3325</td><td class="line">        size_t dictSize, ZSTD_compressionParameters cParams,</td></tr>
<tr class="codeline" data-linenumber="3326"><td class="num" id="LN3326">3326</td><td class="line">        ZSTD_dictLoadMethod_e dictLoadMethod)</td></tr>
<tr class="codeline" data-linenumber="3327"><td class="num" id="LN3327">3327</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3328"><td class="num" id="LN3328">3328</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"sizeof(ZSTD_CDict) : %u"</span>, (<span class='keyword'>unsigned</span>)<span class='keyword'>sizeof</span>(ZSTD_CDict))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3329"><td class="num" id="LN3329">3329</td><td class="line">    <span class='keyword'>return</span> ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_CDict))</td></tr>
<tr class="codeline" data-linenumber="3330"><td class="num" id="LN3330">3330</td><td class="line">         + ZSTD_cwksp_alloc_size(<span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3331"><td class="num" id="LN3331">3331</td><td class="line">         + ZSTD_sizeof_matchState(&amp;cParams, <span class='comment'>/* forCCtx */</span> 0)</td></tr>
<tr class="codeline" data-linenumber="3332"><td class="num" id="LN3332">3332</td><td class="line">         + (dictLoadMethod == ZSTD_dlm_byRef ? 0</td></tr>
<tr class="codeline" data-linenumber="3333"><td class="num" id="LN3333">3333</td><td class="line">            : ZSTD_cwksp_alloc_size(ZSTD_cwksp_align(dictSize, <span class='keyword'>sizeof</span>(<span class='keyword'>void</span> *))));</td></tr>
<tr class="codeline" data-linenumber="3334"><td class="num" id="LN3334">3334</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3335"><td class="num" id="LN3335">3335</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3336"><td class="num" id="LN3336">3336</td><td class="line">size_t ZSTD_estimateCDictSize(size_t dictSize, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3337"><td class="num" id="LN3337">3337</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3338"><td class="num" id="LN3338">3338</td><td class="line">    ZSTD_compressionParameters <span class='keyword'>const</span> cParams = ZSTD_getCParams_internal(compressionLevel, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3339"><td class="num" id="LN3339">3339</td><td class="line">    <span class='keyword'>return</span> ZSTD_estimateCDictSize_advanced(dictSize, cParams, ZSTD_dlm_byCopy);</td></tr>
<tr class="codeline" data-linenumber="3340"><td class="num" id="LN3340">3340</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3341"><td class="num" id="LN3341">3341</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3342"><td class="num" id="LN3342">3342</td><td class="line">size_t ZSTD_sizeof_CDict(<span class='keyword'>const</span> ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="3343"><td class="num" id="LN3343">3343</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3344"><td class="num" id="LN3344">3344</td><td class="line">    <span class='keyword'>if</span> (cdict==<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0;   <span class='comment'>/* support sizeof on NULL */</span></td></tr>
<tr class="codeline" data-linenumber="3345"><td class="num" id="LN3345">3345</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"sizeof(*cdict) : %u"</span>, (<span class='keyword'>unsigned</span>)<span class='keyword'>sizeof</span>(*cdict))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3346"><td class="num" id="LN3346">3346</td><td class="line">    <span class='comment'>/* cdict may be in the workspace */</span></td></tr>
<tr class="codeline" data-linenumber="3347"><td class="num" id="LN3347">3347</td><td class="line">    <span class='keyword'>return</span> (cdict-&gt;workspace.workspace == cdict ? 0 : <span class='keyword'>sizeof</span>(*cdict))</td></tr>
<tr class="codeline" data-linenumber="3348"><td class="num" id="LN3348">3348</td><td class="line">        + ZSTD_cwksp_sizeof(&amp;cdict-&gt;workspace);</td></tr>
<tr class="codeline" data-linenumber="3349"><td class="num" id="LN3349">3349</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3350"><td class="num" id="LN3350">3350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3351"><td class="num" id="LN3351">3351</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_initCDict_internal(</td></tr>
<tr class="codeline" data-linenumber="3352"><td class="num" id="LN3352">3352</td><td class="line">                    ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="3353"><td class="num" id="LN3353">3353</td><td class="line">              <span class='keyword'>const</span> <span class='keyword'>void</span>* dictBuffer, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3354"><td class="num" id="LN3354">3354</td><td class="line">                    ZSTD_dictLoadMethod_e dictLoadMethod,</td></tr>
<tr class="codeline" data-linenumber="3355"><td class="num" id="LN3355">3355</td><td class="line">                    ZSTD_dictContentType_e dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3356"><td class="num" id="LN3356">3356</td><td class="line">                    ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="3357"><td class="num" id="LN3357">3357</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3358"><td class="num" id="LN3358">3358</td><td class="line">    <span class='macro'>DEBUGLOG(3, <span class='string_literal'>"ZSTD_initCDict_internal (dictContentType:%u)"</span>, (<span class='keyword'>unsigned</span>)dictContentType)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3359"><td class="num" id="LN3359">3359</td><td class="line">    <span class='macro'>assert(!ZSTD_checkCParams(cParams))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3360"><td class="num" id="LN3360">3360</td><td class="line">    cdict-&gt;matchState.cParams = cParams;</td></tr>
<tr class="codeline" data-linenumber="3361"><td class="num" id="LN3361">3361</td><td class="line">    <span class='keyword'>if</span> ((dictLoadMethod == ZSTD_dlm_byRef) || (!dictBuffer) || (!dictSize)) {</td></tr>
<tr class="codeline" data-linenumber="3362"><td class="num" id="LN3362">3362</td><td class="line">        cdict-&gt;dictContent = dictBuffer;</td></tr>
<tr class="codeline" data-linenumber="3363"><td class="num" id="LN3363">3363</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3364"><td class="num" id="LN3364">3364</td><td class="line">         <span class='keyword'>void</span> *internalBuffer = ZSTD_cwksp_reserve_object(&amp;cdict-&gt;workspace, ZSTD_cwksp_align(dictSize, <span class='keyword'>sizeof</span>(<span class='keyword'>void</span>*)));</td></tr>
<tr class="codeline" data-linenumber="3365"><td class="num" id="LN3365">3365</td><td class="line">        <span class='macro'>RETURN_ERROR_IF(!internalBuffer, memory_allocation, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (!internalBuffer) { {}; if (0) { _force_has_format_string(<br>"NULL pointer!"); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3366"><td class="num" id="LN3366">3366</td><td class="line">        cdict-&gt;dictContent = internalBuffer;</td></tr>
<tr class="codeline" data-linenumber="3367"><td class="num" id="LN3367">3367</td><td class="line">        memcpy(internalBuffer, dictBuffer, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3368"><td class="num" id="LN3368">3368</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3369"><td class="num" id="LN3369">3369</td><td class="line">    cdict-&gt;dictContentSize = dictSize;</td></tr>
<tr class="codeline" data-linenumber="3370"><td class="num" id="LN3370">3370</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3371"><td class="num" id="LN3371">3371</td><td class="line">    cdict-&gt;entropyWorkspace = (U32*)ZSTD_cwksp_reserve_object(&amp;cdict-&gt;workspace, <span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3372"><td class="num" id="LN3372">3372</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3373"><td class="num" id="LN3373">3373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3374"><td class="num" id="LN3374">3374</td><td class="line">    <span class='comment'>/* Reset the state to no dictionary */</span></td></tr>
<tr class="codeline" data-linenumber="3375"><td class="num" id="LN3375">3375</td><td class="line">    ZSTD_reset_compressedBlockState(&amp;cdict-&gt;cBlockState);</td></tr>
<tr class="codeline" data-linenumber="3376"><td class="num" id="LN3376">3376</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(ZSTD_reset_matchState(<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3377"><td class="num" id="LN3377">3377</td><td class="line">        <span class='macro'>&amp;cdict-&gt;matchState,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3378"><td class="num" id="LN3378">3378</td><td class="line">        <span class='macro'>&amp;cdict-&gt;workspace,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3379"><td class="num" id="LN3379">3379</td><td class="line">        <span class='macro'>&amp;cParams,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3380"><td class="num" id="LN3380">3380</td><td class="line">        <span class='macro'>ZSTDcrp_makeClean,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3381"><td class="num" id="LN3381">3381</td><td class="line">        <span class='macro'>ZSTDirp_reset,<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3382"><td class="num" id="LN3382">3382</td><td class="line">        <span class='macro'>ZSTD_resetTarget_CDict), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_reset_matchState( &amp;cdict<br>-&gt;matchState, &amp;cdict-&gt;workspace, &amp;cParams, ZSTDcrp_makeClean<br>, ZSTDirp_reset, ZSTD_resetTarget_CDict)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3383"><td class="num" id="LN3383">3383</td><td class="line">    <span class='comment'>/* (Maybe) load the dictionary</span></td></tr>
<tr class="codeline" data-linenumber="3384"><td class="num" id="LN3384">3384</td><td class="line">     <span class='comment'>* Skips loading the dictionary if it is &lt; 8 bytes.</span></td></tr>
<tr class="codeline" data-linenumber="3385"><td class="num" id="LN3385">3385</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3386"><td class="num" id="LN3386">3386</td><td class="line">    {   ZSTD_CCtx_params params;</td></tr>
<tr class="codeline" data-linenumber="3387"><td class="num" id="LN3387">3387</td><td class="line">        memset(&amp;params, 0, <span class='keyword'>sizeof</span>(params));</td></tr>
<tr class="codeline" data-linenumber="3388"><td class="num" id="LN3388">3388</td><td class="line">        params.compressionLevel = <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3389"><td class="num" id="LN3389">3389</td><td class="line">        params.fParams.contentSizeFlag = 1;</td></tr>
<tr class="codeline" data-linenumber="3390"><td class="num" id="LN3390">3390</td><td class="line">        params.cParams = cParams;</td></tr>
<tr class="codeline" data-linenumber="3391"><td class="num" id="LN3391">3391</td><td class="line">        {   size_t <span class='keyword'>const</span> dictID = ZSTD_compress_insertDictionary(</td></tr>
<tr class="codeline" data-linenumber="3392"><td class="num" id="LN3392">3392</td><td class="line">                    &amp;cdict-&gt;cBlockState, &amp;cdict-&gt;matchState, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;cdict-&gt;workspace,</td></tr>
<tr class="codeline" data-linenumber="3393"><td class="num" id="LN3393">3393</td><td class="line">                    &amp;params, cdict-&gt;dictContent, cdict-&gt;dictContentSize,</td></tr>
<tr class="codeline" data-linenumber="3394"><td class="num" id="LN3394">3394</td><td class="line">                    dictContentType, ZSTD_dtlm_full, cdict-&gt;entropyWorkspace);</td></tr>
<tr class="codeline" data-linenumber="3395"><td class="num" id="LN3395">3395</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR(dictID, <span class='string_literal'>"ZSTD_compress_insertDictionary failed"</span>)<span class='macro_popup'>do { size_t const err_code = (dictID); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compress_insertDictionary failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3396"><td class="num" id="LN3396">3396</td><td class="line">            <span class='macro'>assert(dictID &lt;= (size_t)(U32)-1)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3397"><td class="num" id="LN3397">3397</td><td class="line">            cdict-&gt;dictID = (U32)dictID;</td></tr>
<tr class="codeline" data-linenumber="3398"><td class="num" id="LN3398">3398</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3399"><td class="num" id="LN3399">3399</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3400"><td class="num" id="LN3400">3400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3401"><td class="num" id="LN3401">3401</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3402"><td class="num" id="LN3402">3402</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3403"><td class="num" id="LN3403">3403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3404"><td class="num" id="LN3404">3404</td><td class="line">ZSTD_CDict* ZSTD_createCDict_advanced(<span class='keyword'>const</span> <span class='keyword'>void</span>* dictBuffer, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3405"><td class="num" id="LN3405">3405</td><td class="line">                                      ZSTD_dictLoadMethod_e dictLoadMethod,</td></tr>
<tr class="codeline" data-linenumber="3406"><td class="num" id="LN3406">3406</td><td class="line">                                      ZSTD_dictContentType_e dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3407"><td class="num" id="LN3407">3407</td><td class="line">                                      ZSTD_compressionParameters cParams, ZSTD_customMem customMem)</td></tr>
<tr class="codeline" data-linenumber="3408"><td class="num" id="LN3408">3408</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3409"><td class="num" id="LN3409">3409</td><td class="line">    <span class='macro'>DEBUGLOG(3, <span class='string_literal'>"ZSTD_createCDict_advanced, mode %u"</span>, (<span class='keyword'>unsigned</span>)dictContentType)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3410"><td class="num" id="LN3410">3410</td><td class="line">    <span class='keyword'>if</span> (!customMem.customAlloc ^ !customMem.customFree) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3411"><td class="num" id="LN3411">3411</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3412"><td class="num" id="LN3412">3412</td><td class="line">    {   size_t <span class='keyword'>const</span> workspaceSize =</td></tr>
<tr class="codeline" data-linenumber="3413"><td class="num" id="LN3413">3413</td><td class="line">            ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_CDict)) +</td></tr>
<tr class="codeline" data-linenumber="3414"><td class="num" id="LN3414">3414</td><td class="line">            ZSTD_cwksp_alloc_size(<span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>) +</td></tr>
<tr class="codeline" data-linenumber="3415"><td class="num" id="LN3415">3415</td><td class="line">            ZSTD_sizeof_matchState(&amp;cParams, <span class='comment'>/* forCCtx */</span> 0) +</td></tr>
<tr class="codeline" data-linenumber="3416"><td class="num" id="LN3416">3416</td><td class="line">            (dictLoadMethod == ZSTD_dlm_byRef ? 0</td></tr>
<tr class="codeline" data-linenumber="3417"><td class="num" id="LN3417">3417</td><td class="line">             : ZSTD_cwksp_alloc_size(ZSTD_cwksp_align(dictSize, <span class='keyword'>sizeof</span>(<span class='keyword'>void</span>*))));</td></tr>
<tr class="codeline" data-linenumber="3418"><td class="num" id="LN3418">3418</td><td class="line">        <span class='keyword'>void</span>* <span class='keyword'>const</span> workspace = ZSTD_malloc(workspaceSize, customMem);</td></tr>
<tr class="codeline" data-linenumber="3419"><td class="num" id="LN3419">3419</td><td class="line">        ZSTD_cwksp ws;</td></tr>
<tr class="codeline" data-linenumber="3420"><td class="num" id="LN3420">3420</td><td class="line">        ZSTD_CDict* cdict;</td></tr>
<tr class="codeline" data-linenumber="3421"><td class="num" id="LN3421">3421</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3422"><td class="num" id="LN3422">3422</td><td class="line">        <span class='keyword'>if</span> (!workspace) {</td></tr>
<tr class="codeline" data-linenumber="3423"><td class="num" id="LN3423">3423</td><td class="line">            ZSTD_free(workspace, customMem);</td></tr>
<tr class="codeline" data-linenumber="3424"><td class="num" id="LN3424">3424</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3425"><td class="num" id="LN3425">3425</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3426"><td class="num" id="LN3426">3426</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3427"><td class="num" id="LN3427">3427</td><td class="line">        ZSTD_cwksp_init(&amp;ws, workspace, workspaceSize);</td></tr>
<tr class="codeline" data-linenumber="3428"><td class="num" id="LN3428">3428</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3429"><td class="num" id="LN3429">3429</td><td class="line">        cdict = (ZSTD_CDict*)ZSTD_cwksp_reserve_object(&amp;ws, <span class='keyword'>sizeof</span>(ZSTD_CDict));</td></tr>
<tr class="codeline" data-linenumber="3430"><td class="num" id="LN3430">3430</td><td class="line">        <span class='macro'>assert(cdict != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3431"><td class="num" id="LN3431">3431</td><td class="line">        ZSTD_cwksp_move(&amp;cdict-&gt;workspace, &amp;ws);</td></tr>
<tr class="codeline" data-linenumber="3432"><td class="num" id="LN3432">3432</td><td class="line">        cdict-&gt;customMem = customMem;</td></tr>
<tr class="codeline" data-linenumber="3433"><td class="num" id="LN3433">3433</td><td class="line">        cdict-&gt;compressionLevel = 0; <span class='comment'>/* signals advanced API usage */</span></td></tr>
<tr class="codeline" data-linenumber="3434"><td class="num" id="LN3434">3434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3435"><td class="num" id="LN3435">3435</td><td class="line">        <span class='keyword'>if</span> (<span class='macro'>ZSTD_isError<span class='macro_popup'>ERR_isError</span></span>( ZSTD_initCDict_internal(cdict,</td></tr>
<tr class="codeline" data-linenumber="3436"><td class="num" id="LN3436">3436</td><td class="line">                                        dictBuffer, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3437"><td class="num" id="LN3437">3437</td><td class="line">                                        dictLoadMethod, dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3438"><td class="num" id="LN3438">3438</td><td class="line">                                        cParams) )) {</td></tr>
<tr class="codeline" data-linenumber="3439"><td class="num" id="LN3439">3439</td><td class="line">            ZSTD_freeCDict(cdict);</td></tr>
<tr class="codeline" data-linenumber="3440"><td class="num" id="LN3440">3440</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3441"><td class="num" id="LN3441">3441</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3442"><td class="num" id="LN3442">3442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3443"><td class="num" id="LN3443">3443</td><td class="line">        <span class='keyword'>return</span> cdict;</td></tr>
<tr class="codeline" data-linenumber="3444"><td class="num" id="LN3444">3444</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3445"><td class="num" id="LN3445">3445</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3446"><td class="num" id="LN3446">3446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3447"><td class="num" id="LN3447">3447</td><td class="line">ZSTD_CDict* ZSTD_createCDict(<span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3448"><td class="num" id="LN3448">3448</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3449"><td class="num" id="LN3449">3449</td><td class="line">    ZSTD_compressionParameters cParams = ZSTD_getCParams_internal(compressionLevel, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3450"><td class="num" id="LN3450">3450</td><td class="line">    ZSTD_CDict* cdict = ZSTD_createCDict_advanced(dict, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3451"><td class="num" id="LN3451">3451</td><td class="line">                                                  ZSTD_dlm_byCopy, ZSTD_dct_auto,</td></tr>
<tr class="codeline" data-linenumber="3452"><td class="num" id="LN3452">3452</td><td class="line">                                                  cParams, ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="3453"><td class="num" id="LN3453">3453</td><td class="line">    <span class='keyword'>if</span> (cdict)</td></tr>
<tr class="codeline" data-linenumber="3454"><td class="num" id="LN3454">3454</td><td class="line">        cdict-&gt;compressionLevel = compressionLevel == 0 ? <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span> : compressionLevel;</td></tr>
<tr class="codeline" data-linenumber="3455"><td class="num" id="LN3455">3455</td><td class="line">    <span class='keyword'>return</span> cdict;</td></tr>
<tr class="codeline" data-linenumber="3456"><td class="num" id="LN3456">3456</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3457"><td class="num" id="LN3457">3457</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3458"><td class="num" id="LN3458">3458</td><td class="line">ZSTD_CDict* ZSTD_createCDict_byReference(<span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3459"><td class="num" id="LN3459">3459</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3460"><td class="num" id="LN3460">3460</td><td class="line">    ZSTD_compressionParameters cParams = ZSTD_getCParams_internal(compressionLevel, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3461"><td class="num" id="LN3461">3461</td><td class="line">    <span class='keyword'>return</span> ZSTD_createCDict_advanced(dict, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3462"><td class="num" id="LN3462">3462</td><td class="line">                                     ZSTD_dlm_byRef, ZSTD_dct_auto,</td></tr>
<tr class="codeline" data-linenumber="3463"><td class="num" id="LN3463">3463</td><td class="line">                                     cParams, ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="3464"><td class="num" id="LN3464">3464</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3465"><td class="num" id="LN3465">3465</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3466"><td class="num" id="LN3466">3466</td><td class="line">size_t ZSTD_freeCDict(ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="3467"><td class="num" id="LN3467">3467</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3468"><td class="num" id="LN3468">3468</td><td class="line">    <span class='keyword'>if</span> (cdict==<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> 0;   <span class='comment'>/* support free on NULL */</span></td></tr>
<tr class="codeline" data-linenumber="3469"><td class="num" id="LN3469">3469</td><td class="line">    {   ZSTD_customMem <span class='keyword'>const</span> cMem = cdict-&gt;customMem;</td></tr>
<tr class="codeline" data-linenumber="3470"><td class="num" id="LN3470">3470</td><td class="line">        <span class='keyword'>int</span> cdictInWorkspace = ZSTD_cwksp_owns_buffer(&amp;cdict-&gt;workspace, cdict);</td></tr>
<tr class="codeline" data-linenumber="3471"><td class="num" id="LN3471">3471</td><td class="line">        ZSTD_cwksp_free(&amp;cdict-&gt;workspace, cMem);</td></tr>
<tr class="codeline" data-linenumber="3472"><td class="num" id="LN3472">3472</td><td class="line">        <span class='keyword'>if</span> (!cdictInWorkspace) {</td></tr>
<tr class="codeline" data-linenumber="3473"><td class="num" id="LN3473">3473</td><td class="line">            ZSTD_free(cdict, cMem);</td></tr>
<tr class="codeline" data-linenumber="3474"><td class="num" id="LN3474">3474</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3475"><td class="num" id="LN3475">3475</td><td class="line">        <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3476"><td class="num" id="LN3476">3476</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3477"><td class="num" id="LN3477">3477</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3478"><td class="num" id="LN3478">3478</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3479"><td class="num" id="LN3479">3479</td><td class="line"><span class='comment'>/*! ZSTD_initStaticCDict_advanced() :</span></td></tr>
<tr class="codeline" data-linenumber="3480"><td class="num" id="LN3480">3480</td><td class="line"> <span class='comment'>*  Generate a digested dictionary in provided memory area.</span></td></tr>
<tr class="codeline" data-linenumber="3481"><td class="num" id="LN3481">3481</td><td class="line"> <span class='comment'>*  workspace: The memory area to emplace the dictionary into.</span></td></tr>
<tr class="codeline" data-linenumber="3482"><td class="num" id="LN3482">3482</td><td class="line"> <span class='comment'>*             Provided pointer must 8-bytes aligned.</span></td></tr>
<tr class="codeline" data-linenumber="3483"><td class="num" id="LN3483">3483</td><td class="line"> <span class='comment'>*             It must outlive dictionary usage.</span></td></tr>
<tr class="codeline" data-linenumber="3484"><td class="num" id="LN3484">3484</td><td class="line"> <span class='comment'>*  workspaceSize: Use ZSTD_estimateCDictSize()</span></td></tr>
<tr class="codeline" data-linenumber="3485"><td class="num" id="LN3485">3485</td><td class="line"> <span class='comment'>*                 to determine how large workspace must be.</span></td></tr>
<tr class="codeline" data-linenumber="3486"><td class="num" id="LN3486">3486</td><td class="line"> <span class='comment'>*  cParams : use ZSTD_getCParams() to transform a compression level</span></td></tr>
<tr class="codeline" data-linenumber="3487"><td class="num" id="LN3487">3487</td><td class="line"> <span class='comment'>*            into its relevants cParams.</span></td></tr>
<tr class="codeline" data-linenumber="3488"><td class="num" id="LN3488">3488</td><td class="line"> <span class='comment'>* @return : pointer to ZSTD_CDict*, or NULL if error (size too small)</span></td></tr>
<tr class="codeline" data-linenumber="3489"><td class="num" id="LN3489">3489</td><td class="line"> <span class='comment'>*  Note : there is no corresponding "free" function.</span></td></tr>
<tr class="codeline" data-linenumber="3490"><td class="num" id="LN3490">3490</td><td class="line"> <span class='comment'>*         Since workspace was allocated externally, it must be freed externally.</span></td></tr>
<tr class="codeline" data-linenumber="3491"><td class="num" id="LN3491">3491</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3492"><td class="num" id="LN3492">3492</td><td class="line"><span class='keyword'>const</span> ZSTD_CDict* ZSTD_initStaticCDict(</td></tr>
<tr class="codeline" data-linenumber="3493"><td class="num" id="LN3493">3493</td><td class="line">                                 <span class='keyword'>void</span>* workspace, size_t workspaceSize,</td></tr>
<tr class="codeline" data-linenumber="3494"><td class="num" id="LN3494">3494</td><td class="line">                           <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3495"><td class="num" id="LN3495">3495</td><td class="line">                                 ZSTD_dictLoadMethod_e dictLoadMethod,</td></tr>
<tr class="codeline" data-linenumber="3496"><td class="num" id="LN3496">3496</td><td class="line">                                 ZSTD_dictContentType_e dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3497"><td class="num" id="LN3497">3497</td><td class="line">                                 ZSTD_compressionParameters cParams)</td></tr>
<tr class="codeline" data-linenumber="3498"><td class="num" id="LN3498">3498</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3499"><td class="num" id="LN3499">3499</td><td class="line">    size_t <span class='keyword'>const</span> matchStateSize = ZSTD_sizeof_matchState(&amp;cParams, <span class='comment'>/* forCCtx */</span> 0);</td></tr>
<tr class="codeline" data-linenumber="3500"><td class="num" id="LN3500">3500</td><td class="line">    size_t <span class='keyword'>const</span> neededSize = ZSTD_cwksp_alloc_size(<span class='keyword'>sizeof</span>(ZSTD_CDict))</td></tr>
<tr class="codeline" data-linenumber="3501"><td class="num" id="LN3501">3501</td><td class="line">                            + (dictLoadMethod == ZSTD_dlm_byRef ? 0</td></tr>
<tr class="codeline" data-linenumber="3502"><td class="num" id="LN3502">3502</td><td class="line">                               : ZSTD_cwksp_alloc_size(ZSTD_cwksp_align(dictSize, <span class='keyword'>sizeof</span>(<span class='keyword'>void</span>*))))</td></tr>
<tr class="codeline" data-linenumber="3503"><td class="num" id="LN3503">3503</td><td class="line">                            + ZSTD_cwksp_alloc_size(<span class='macro'>HUF_WORKSPACE_SIZE<span class='macro_popup'>((6 &lt;&lt; 10) + 256)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3504"><td class="num" id="LN3504">3504</td><td class="line">                            + matchStateSize;</td></tr>
<tr class="codeline" data-linenumber="3505"><td class="num" id="LN3505">3505</td><td class="line">    ZSTD_CDict* cdict;</td></tr>
<tr class="codeline" data-linenumber="3506"><td class="num" id="LN3506">3506</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3507"><td class="num" id="LN3507">3507</td><td class="line">    <span class='keyword'>if</span> ((size_t)workspace &amp; 7) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;  <span class='comment'>/* 8-aligned */</span></td></tr>
<tr class="codeline" data-linenumber="3508"><td class="num" id="LN3508">3508</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3509"><td class="num" id="LN3509">3509</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3510"><td class="num" id="LN3510">3510</td><td class="line">        ZSTD_cwksp ws;</td></tr>
<tr class="codeline" data-linenumber="3511"><td class="num" id="LN3511">3511</td><td class="line">        ZSTD_cwksp_init(&amp;ws, workspace, workspaceSize);</td></tr>
<tr class="codeline" data-linenumber="3512"><td class="num" id="LN3512">3512</td><td class="line">        cdict = (ZSTD_CDict*)ZSTD_cwksp_reserve_object(&amp;ws, <span class='keyword'>sizeof</span>(ZSTD_CDict));</td></tr>
<tr class="codeline" data-linenumber="3513"><td class="num" id="LN3513">3513</td><td class="line">        <span class='keyword'>if</span> (cdict == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3514"><td class="num" id="LN3514">3514</td><td class="line">        ZSTD_cwksp_move(&amp;cdict-&gt;workspace, &amp;ws);</td></tr>
<tr class="codeline" data-linenumber="3515"><td class="num" id="LN3515">3515</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3516"><td class="num" id="LN3516">3516</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3517"><td class="num" id="LN3517">3517</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"(workspaceSize &lt; neededSize) : (%u &lt; %u) =&gt; %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="3518"><td class="num" id="LN3518">3518</td><td class="line">        <span class='macro'>(<span class='keyword'>unsigned</span>)workspaceSize, (<span class='keyword'>unsigned</span>)neededSize, (<span class='keyword'>unsigned</span>)(workspaceSize &lt; neededSize))<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3519"><td class="num" id="LN3519">3519</td><td class="line">    <span class='keyword'>if</span> (workspaceSize &lt; neededSize) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3520"><td class="num" id="LN3520">3520</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3521"><td class="num" id="LN3521">3521</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>ZSTD_isError<span class='macro_popup'>ERR_isError</span></span>( ZSTD_initCDict_internal(cdict,</td></tr>
<tr class="codeline" data-linenumber="3522"><td class="num" id="LN3522">3522</td><td class="line">                                              dict, dictSize,</td></tr>
<tr class="codeline" data-linenumber="3523"><td class="num" id="LN3523">3523</td><td class="line">                                              dictLoadMethod, dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3524"><td class="num" id="LN3524">3524</td><td class="line">                                              cParams) ))</td></tr>
<tr class="codeline" data-linenumber="3525"><td class="num" id="LN3525">3525</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3526"><td class="num" id="LN3526">3526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3527"><td class="num" id="LN3527">3527</td><td class="line">    <span class='keyword'>return</span> cdict;</td></tr>
<tr class="codeline" data-linenumber="3528"><td class="num" id="LN3528">3528</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3529"><td class="num" id="LN3529">3529</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3530"><td class="num" id="LN3530">3530</td><td class="line">ZSTD_compressionParameters ZSTD_getCParamsFromCDict(<span class='keyword'>const</span> ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="3531"><td class="num" id="LN3531">3531</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3532"><td class="num" id="LN3532">3532</td><td class="line">    <span class='macro'>assert(cdict != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3533"><td class="num" id="LN3533">3533</td><td class="line">    <span class='keyword'>return</span> cdict-&gt;matchState.cParams;</td></tr>
<tr class="codeline" data-linenumber="3534"><td class="num" id="LN3534">3534</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3535"><td class="num" id="LN3535">3535</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3536"><td class="num" id="LN3536">3536</td><td class="line"><span class='comment'>/* ZSTD_compressBegin_usingCDict_advanced() :</span></td></tr>
<tr class="codeline" data-linenumber="3537"><td class="num" id="LN3537">3537</td><td class="line"> <span class='comment'>* cdict must be != NULL */</span></td></tr>
<tr class="codeline" data-linenumber="3538"><td class="num" id="LN3538">3538</td><td class="line">size_t ZSTD_compressBegin_usingCDict_advanced(</td></tr>
<tr class="codeline" data-linenumber="3539"><td class="num" id="LN3539">3539</td><td class="line">    ZSTD_CCtx* <span class='keyword'>const</span> cctx, <span class='keyword'>const</span> ZSTD_CDict* <span class='keyword'>const</span> cdict,</td></tr>
<tr class="codeline" data-linenumber="3540"><td class="num" id="LN3540">3540</td><td class="line">    ZSTD_frameParameters <span class='keyword'>const</span> fParams, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> <span class='keyword'>const</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="3541"><td class="num" id="LN3541">3541</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3542"><td class="num" id="LN3542">3542</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressBegin_usingCDict_advanced"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3543"><td class="num" id="LN3543">3543</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(cdict==NULL, dictionary_wrong, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (cdict==((void*)0)) { {}; if (0) { _force_has_format_string<br>("NULL pointer!"); }; {}; {}; return ((size_t)-ZSTD_error_dictionary_wrong<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3544"><td class="num" id="LN3544">3544</td><td class="line">    {   ZSTD_CCtx_params params = cctx-&gt;requestedParams;</td></tr>
<tr class="codeline" data-linenumber="3545"><td class="num" id="LN3545">3545</td><td class="line">        params.cParams = ( pledgedSrcSize &lt; <span class='macro'>ZSTD_USE_CDICT_PARAMS_SRCSIZE_CUTOFF<span class='macro_popup'>(128 *(1 &lt;&lt;10))</span></span></td></tr>
<tr class="codeline" data-linenumber="3546"><td class="num" id="LN3546">3546</td><td class="line">                        || pledgedSrcSize &lt; cdict-&gt;dictContentSize * <span class='macro'>ZSTD_USE_CDICT_PARAMS_DICTSIZE_MULTIPLIER<span class='macro_popup'>(6)</span></span></td></tr>
<tr class="codeline" data-linenumber="3547"><td class="num" id="LN3547">3547</td><td class="line">                        || pledgedSrcSize == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span></td></tr>
<tr class="codeline" data-linenumber="3548"><td class="num" id="LN3548">3548</td><td class="line">                        || cdict-&gt;compressionLevel == 0 )</td></tr>
<tr class="codeline" data-linenumber="3549"><td class="num" id="LN3549">3549</td><td class="line">                      &amp;&amp; (params.attachDictPref != ZSTD_dictForceLoad) ?</td></tr>
<tr class="codeline" data-linenumber="3550"><td class="num" id="LN3550">3550</td><td class="line">                ZSTD_getCParamsFromCDict(cdict)</td></tr>
<tr class="codeline" data-linenumber="3551"><td class="num" id="LN3551">3551</td><td class="line">              : ZSTD_getCParams(cdict-&gt;compressionLevel,</td></tr>
<tr class="codeline" data-linenumber="3552"><td class="num" id="LN3552">3552</td><td class="line">                                pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="3553"><td class="num" id="LN3553">3553</td><td class="line">                                cdict-&gt;dictContentSize);</td></tr>
<tr class="codeline" data-linenumber="3554"><td class="num" id="LN3554">3554</td><td class="line">        <span class='comment'>/* Increase window log to fit the entire dictionary and source if the</span></td></tr>
<tr class="codeline" data-linenumber="3555"><td class="num" id="LN3555">3555</td><td class="line">         <span class='comment'>* source size is known. Limit the increase to 19, which is the</span></td></tr>
<tr class="codeline" data-linenumber="3556"><td class="num" id="LN3556">3556</td><td class="line">         <span class='comment'>* window log for compression level 1 with the largest source size.</span></td></tr>
<tr class="codeline" data-linenumber="3557"><td class="num" id="LN3557">3557</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3558"><td class="num" id="LN3558">3558</td><td class="line">        <span class='keyword'>if</span> (pledgedSrcSize != <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3559"><td class="num" id="LN3559">3559</td><td class="line">            U32 <span class='keyword'>const</span> limitedSrcSize = (U32)<span class='macro'>MIN(pledgedSrcSize, 1U &lt;&lt; 19)<span class='macro_popup'>((pledgedSrcSize)&lt;(1U &lt;&lt; 19) ? (pledgedSrcSize) : (1U<br> &lt;&lt; 19))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3560"><td class="num" id="LN3560">3560</td><td class="line">            U32 <span class='keyword'>const</span> limitedSrcLog = limitedSrcSize &gt; 1 ? ZSTD_highbit32(limitedSrcSize - 1) + 1 : 1;</td></tr>
<tr class="codeline" data-linenumber="3561"><td class="num" id="LN3561">3561</td><td class="line">            params.cParams.windowLog = <span class='macro'>MAX(params.cParams.windowLog, limitedSrcLog)<span class='macro_popup'>((params.cParams.windowLog)&gt;(limitedSrcLog) ? (params.cParams<br>.windowLog) : (limitedSrcLog))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3562"><td class="num" id="LN3562">3562</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3563"><td class="num" id="LN3563">3563</td><td class="line">        params.fParams = fParams;</td></tr>
<tr class="codeline" data-linenumber="3564"><td class="num" id="LN3564">3564</td><td class="line">        <span class='keyword'>return</span> ZSTD_compressBegin_internal(cctx,</td></tr>
<tr class="codeline" data-linenumber="3565"><td class="num" id="LN3565">3565</td><td class="line">                                           <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, ZSTD_dct_auto, ZSTD_dtlm_fast,</td></tr>
<tr class="codeline" data-linenumber="3566"><td class="num" id="LN3566">3566</td><td class="line">                                           cdict,</td></tr>
<tr class="codeline" data-linenumber="3567"><td class="num" id="LN3567">3567</td><td class="line">                                           &amp;params, pledgedSrcSize,</td></tr>
<tr class="codeline" data-linenumber="3568"><td class="num" id="LN3568">3568</td><td class="line">                                           ZSTDb_not_buffered);</td></tr>
<tr class="codeline" data-linenumber="3569"><td class="num" id="LN3569">3569</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3570"><td class="num" id="LN3570">3570</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3571"><td class="num" id="LN3571">3571</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3572"><td class="num" id="LN3572">3572</td><td class="line"><span class='comment'>/* ZSTD_compressBegin_usingCDict() :</span></td></tr>
<tr class="codeline" data-linenumber="3573"><td class="num" id="LN3573">3573</td><td class="line"> <span class='comment'>* pledgedSrcSize=0 means "unknown"</span></td></tr>
<tr class="codeline" data-linenumber="3574"><td class="num" id="LN3574">3574</td><td class="line"> <span class='comment'>* if pledgedSrcSize&gt;0, it will enable contentSizeFlag */</span></td></tr>
<tr class="codeline" data-linenumber="3575"><td class="num" id="LN3575">3575</td><td class="line">size_t ZSTD_compressBegin_usingCDict(ZSTD_CCtx* cctx, <span class='keyword'>const</span> ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="3576"><td class="num" id="LN3576">3576</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3577"><td class="num" id="LN3577">3577</td><td class="line">    ZSTD_frameParameters <span class='keyword'>const</span> fParams = { 0 <span class='comment'>/*content*/</span>, 0 <span class='comment'>/*checksum*/</span>, 0 <span class='comment'>/*noDictID*/</span> };</td></tr>
<tr class="codeline" data-linenumber="3578"><td class="num" id="LN3578">3578</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressBegin_usingCDict : dictIDFlag == %u"</span>, !fParams.noDictIDFlag)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3579"><td class="num" id="LN3579">3579</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressBegin_usingCDict_advanced(cctx, cdict, fParams, <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3580"><td class="num" id="LN3580">3580</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3581"><td class="num" id="LN3581">3581</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3582"><td class="num" id="LN3582">3582</td><td class="line">size_t ZSTD_compress_usingCDict_advanced(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3583"><td class="num" id="LN3583">3583</td><td class="line">                                <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3584"><td class="num" id="LN3584">3584</td><td class="line">                                <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3585"><td class="num" id="LN3585">3585</td><td class="line">                                <span class='keyword'>const</span> ZSTD_CDict* cdict, ZSTD_frameParameters fParams)</td></tr>
<tr class="codeline" data-linenumber="3586"><td class="num" id="LN3586">3586</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3587"><td class="num" id="LN3587">3587</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR(ZSTD_compressBegin_usingCDict_advanced(cctx, cdict, fParams, srcSize), <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_usingCDict_advanced<br>(cctx, cdict, fParams, srcSize)); if (ERR_isError(err_code)) {<br> {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span>;   <span class='comment'>/* will check if cdict != NULL */</span></td></tr>
<tr class="codeline" data-linenumber="3588"><td class="num" id="LN3588">3588</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressEnd(cctx, dst, dstCapacity, src, srcSize);</td></tr>
<tr class="codeline" data-linenumber="3589"><td class="num" id="LN3589">3589</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3590"><td class="num" id="LN3590">3590</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3591"><td class="num" id="LN3591">3591</td><td class="line"><span class='comment'>/*! ZSTD_compress_usingCDict() :</span></td></tr>
<tr class="codeline" data-linenumber="3592"><td class="num" id="LN3592">3592</td><td class="line"> <span class='comment'>*  Compression using a digested Dictionary.</span></td></tr>
<tr class="codeline" data-linenumber="3593"><td class="num" id="LN3593">3593</td><td class="line"> <span class='comment'>*  Faster startup than ZSTD_compress_usingDict(), recommended when same dictionary is used multiple times.</span></td></tr>
<tr class="codeline" data-linenumber="3594"><td class="num" id="LN3594">3594</td><td class="line"> <span class='comment'>*  Note that compression parameters are decided at CDict creation time</span></td></tr>
<tr class="codeline" data-linenumber="3595"><td class="num" id="LN3595">3595</td><td class="line"> <span class='comment'>*  while frame parameters are hardcoded */</span></td></tr>
<tr class="codeline" data-linenumber="3596"><td class="num" id="LN3596">3596</td><td class="line">size_t ZSTD_compress_usingCDict(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3597"><td class="num" id="LN3597">3597</td><td class="line">                                <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="3598"><td class="num" id="LN3598">3598</td><td class="line">                                <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize,</td></tr>
<tr class="codeline" data-linenumber="3599"><td class="num" id="LN3599">3599</td><td class="line">                                <span class='keyword'>const</span> ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="3600"><td class="num" id="LN3600">3600</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3601"><td class="num" id="LN3601">3601</td><td class="line">    ZSTD_frameParameters <span class='keyword'>const</span> fParams = { 1 <span class='comment'>/*content*/</span>, 0 <span class='comment'>/*checksum*/</span>, 0 <span class='comment'>/*noDictID*/</span> };</td></tr>
<tr class="codeline" data-linenumber="3602"><td class="num" id="LN3602">3602</td><td class="line">    <span class='keyword'>return</span> ZSTD_compress_usingCDict_advanced(cctx, dst, dstCapacity, src, srcSize, cdict, fParams);</td></tr>
<tr class="codeline" data-linenumber="3603"><td class="num" id="LN3603">3603</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3604"><td class="num" id="LN3604">3604</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3605"><td class="num" id="LN3605">3605</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3606"><td class="num" id="LN3606">3606</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3607"><td class="num" id="LN3607">3607</td><td class="line"><span class='comment'>/* ******************************************************************</span></td></tr>
<tr class="codeline" data-linenumber="3608"><td class="num" id="LN3608">3608</td><td class="line"><span class='comment'>*  Streaming</span></td></tr>
<tr class="codeline" data-linenumber="3609"><td class="num" id="LN3609">3609</td><td class="line"><span class='comment'>********************************************************************/</span></td></tr>
<tr class="codeline" data-linenumber="3610"><td class="num" id="LN3610">3610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3611"><td class="num" id="LN3611">3611</td><td class="line">ZSTD_CStream* ZSTD_createCStream(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="3612"><td class="num" id="LN3612">3612</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3613"><td class="num" id="LN3613">3613</td><td class="line">    <span class='macro'>DEBUGLOG(3, <span class='string_literal'>"ZSTD_createCStream"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3614"><td class="num" id="LN3614">3614</td><td class="line">    <span class='keyword'>return</span> ZSTD_createCStream_advanced(ZSTD_defaultCMem);</td></tr>
<tr class="codeline" data-linenumber="3615"><td class="num" id="LN3615">3615</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3616"><td class="num" id="LN3616">3616</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3617"><td class="num" id="LN3617">3617</td><td class="line">ZSTD_CStream* ZSTD_initStaticCStream(<span class='keyword'>void</span> *workspace, size_t workspaceSize)</td></tr>
<tr class="codeline" data-linenumber="3618"><td class="num" id="LN3618">3618</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3619"><td class="num" id="LN3619">3619</td><td class="line">    <span class='keyword'>return</span> ZSTD_initStaticCCtx(workspace, workspaceSize);</td></tr>
<tr class="codeline" data-linenumber="3620"><td class="num" id="LN3620">3620</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3621"><td class="num" id="LN3621">3621</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3622"><td class="num" id="LN3622">3622</td><td class="line">ZSTD_CStream* ZSTD_createCStream_advanced(ZSTD_customMem customMem)</td></tr>
<tr class="codeline" data-linenumber="3623"><td class="num" id="LN3623">3623</td><td class="line">{   <span class='comment'>/* CStream and CCtx are now same object */</span></td></tr>
<tr class="codeline" data-linenumber="3624"><td class="num" id="LN3624">3624</td><td class="line">    <span class='keyword'>return</span> ZSTD_createCCtx_advanced(customMem);</td></tr>
<tr class="codeline" data-linenumber="3625"><td class="num" id="LN3625">3625</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3626"><td class="num" id="LN3626">3626</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3627"><td class="num" id="LN3627">3627</td><td class="line">size_t ZSTD_freeCStream(ZSTD_CStream* zcs)</td></tr>
<tr class="codeline" data-linenumber="3628"><td class="num" id="LN3628">3628</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3629"><td class="num" id="LN3629">3629</td><td class="line">    <span class='keyword'>return</span> ZSTD_freeCCtx(zcs);   <span class='comment'>/* same object */</span></td></tr>
<tr class="codeline" data-linenumber="3630"><td class="num" id="LN3630">3630</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3631"><td class="num" id="LN3631">3631</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3632"><td class="num" id="LN3632">3632</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3633"><td class="num" id="LN3633">3633</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3634"><td class="num" id="LN3634">3634</td><td class="line"><span class='comment'>/*======   Initialization   ======*/</span></td></tr>
<tr class="codeline" data-linenumber="3635"><td class="num" id="LN3635">3635</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3636"><td class="num" id="LN3636">3636</td><td class="line">size_t ZSTD_CStreamInSize(<span class='keyword'>void</span>)  { <span class='keyword'>return</span> <span class='macro'>ZSTD_BLOCKSIZE_MAX<span class='macro_popup'>(1&lt;&lt;17)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="3637"><td class="num" id="LN3637">3637</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3638"><td class="num" id="LN3638">3638</td><td class="line">size_t ZSTD_CStreamOutSize(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="3639"><td class="num" id="LN3639">3639</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3640"><td class="num" id="LN3640">3640</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressBound(<span class='macro'>ZSTD_BLOCKSIZE_MAX<span class='macro_popup'>(1&lt;&lt;17)</span></span>) + ZSTD_blockHeaderSize + 4 <span class='comment'>/* 32-bits hash */</span> ;</td></tr>
<tr class="codeline" data-linenumber="3641"><td class="num" id="LN3641">3641</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3642"><td class="num" id="LN3642">3642</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3643"><td class="num" id="LN3643">3643</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_resetCStream_internal(ZSTD_CStream* cctx,</td></tr>
<tr class="codeline" data-linenumber="3644"><td class="num" id="LN3644">3644</td><td class="line">                    <span class='keyword'>const</span> <span class='keyword'>void</span>* <span class='keyword'>const</span> dict, size_t <span class='keyword'>const</span> dictSize, ZSTD_dictContentType_e <span class='keyword'>const</span> dictContentType,</td></tr>
<tr class="codeline" data-linenumber="3645"><td class="num" id="LN3645">3645</td><td class="line">                    <span class='keyword'>const</span> ZSTD_CDict* <span class='keyword'>const</span> cdict,</td></tr>
<tr class="codeline" data-linenumber="3646"><td class="num" id="LN3646">3646</td><td class="line">                    ZSTD_CCtx_params params, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> <span class='keyword'>const</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="3647"><td class="num" id="LN3647">3647</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3648"><td class="num" id="LN3648">3648</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_resetCStream_internal"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3649"><td class="num" id="LN3649">3649</td><td class="line">    <span class='comment'>/* Finalize the compression parameters */</span></td></tr>
<tr class="codeline" data-linenumber="3650"><td class="num" id="LN3650">3650</td><td class="line">    params.cParams = ZSTD_getCParamsFromCCtxParams(&amp;params, pledgedSrcSize, dictSize);</td></tr>
<tr class="codeline" data-linenumber="3651"><td class="num" id="LN3651">3651</td><td class="line">    <span class='comment'>/* params are supposed to be fully validated at this point */</span></td></tr>
<tr class="codeline" data-linenumber="3652"><td class="num" id="LN3652">3652</td><td class="line">    <span class='macro'>assert(!ZSTD_isError(ZSTD_checkCParams(params.cParams)))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3653"><td class="num" id="LN3653">3653</td><td class="line">    <span class='macro'>assert(!((dict) &amp;&amp; (cdict)))<span class='macro_popup'>((void)0)</span></span>;  <span class='comment'>/* either dict or cdict, not both */</span></td></tr>
<tr class="codeline" data-linenumber="3654"><td class="num" id="LN3654">3654</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3655"><td class="num" id="LN3655">3655</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_compressBegin_internal(cctx,<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, dictContentType, ZSTD_dtlm_fast, cdict, &amp;<br>params, pledgedSrcSize, ZSTDb_buffered)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3656"><td class="num" id="LN3656">3656</td><td class="line">                                         <span class='macro'>dict, dictSize, dictContentType, ZSTD_dtlm_fast,<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, dictContentType, ZSTD_dtlm_fast, cdict, &amp;<br>params, pledgedSrcSize, ZSTDb_buffered)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3657"><td class="num" id="LN3657">3657</td><td class="line">                                         <span class='macro'>cdict,<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, dictContentType, ZSTD_dtlm_fast, cdict, &amp;<br>params, pledgedSrcSize, ZSTDb_buffered)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3658"><td class="num" id="LN3658">3658</td><td class="line">                                         <span class='macro'>&amp;params, pledgedSrcSize,<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, dictContentType, ZSTD_dtlm_fast, cdict, &amp;<br>params, pledgedSrcSize, ZSTDb_buffered)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="3659"><td class="num" id="LN3659">3659</td><td class="line">                                         <span class='macro'>ZSTDb_buffered) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressBegin_internal(cctx<br>, dict, dictSize, dictContentType, ZSTD_dtlm_fast, cdict, &amp;<br>params, pledgedSrcSize, ZSTDb_buffered)); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3660"><td class="num" id="LN3660">3660</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3661"><td class="num" id="LN3661">3661</td><td class="line">    cctx-&gt;inToCompress = 0;</td></tr>
<tr class="codeline" data-linenumber="3662"><td class="num" id="LN3662">3662</td><td class="line">    cctx-&gt;inBuffPos = 0;</td></tr>
<tr class="codeline" data-linenumber="3663"><td class="num" id="LN3663">3663</td><td class="line">    cctx-&gt;inBuffTarget = cctx-&gt;blockSize</td></tr>
<tr class="codeline" data-linenumber="3664"><td class="num" id="LN3664">3664</td><td class="line">                      + (cctx-&gt;blockSize == pledgedSrcSize);   <span class='comment'>/* for small input: avoid automatic flush on reaching end of block, since it would require to add a 3-bytes null block to end frame */</span></td></tr>
<tr class="codeline" data-linenumber="3665"><td class="num" id="LN3665">3665</td><td class="line">    cctx-&gt;outBuffContentSize = cctx-&gt;outBuffFlushedSize = 0;</td></tr>
<tr class="codeline" data-linenumber="3666"><td class="num" id="LN3666">3666</td><td class="line">    cctx-&gt;streamStage = zcss_load;</td></tr>
<tr class="codeline" data-linenumber="3667"><td class="num" id="LN3667">3667</td><td class="line">    cctx-&gt;frameEnded = 0;</td></tr>
<tr class="codeline" data-linenumber="3668"><td class="num" id="LN3668">3668</td><td class="line">    <span class='keyword'>return</span> 0;   <span class='comment'>/* ready to go */</span></td></tr>
<tr class="codeline" data-linenumber="3669"><td class="num" id="LN3669">3669</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3670"><td class="num" id="LN3670">3670</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3671"><td class="num" id="LN3671">3671</td><td class="line"><span class='comment'>/* ZSTD_resetCStream():</span></td></tr>
<tr class="codeline" data-linenumber="3672"><td class="num" id="LN3672">3672</td><td class="line"> <span class='comment'>* pledgedSrcSize == 0 means "unknown" */</span></td></tr>
<tr class="codeline" data-linenumber="3673"><td class="num" id="LN3673">3673</td><td class="line">size_t ZSTD_resetCStream(ZSTD_CStream* zcs, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pss)</td></tr>
<tr class="codeline" data-linenumber="3674"><td class="num" id="LN3674">3674</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3675"><td class="num" id="LN3675">3675</td><td class="line">    <span class='comment'>/* temporary : 0 interpreted as "unknown" during transition period.</span></td></tr>
<tr class="codeline" data-linenumber="3676"><td class="num" id="LN3676">3676</td><td class="line">     <span class='comment'>* Users willing to specify "unknown" **must** use ZSTD_CONTENTSIZE_UNKNOWN.</span></td></tr>
<tr class="codeline" data-linenumber="3677"><td class="num" id="LN3677">3677</td><td class="line">     <span class='comment'>* 0 will be interpreted as "empty" in the future.</span></td></tr>
<tr class="codeline" data-linenumber="3678"><td class="num" id="LN3678">3678</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3679"><td class="num" id="LN3679">3679</td><td class="line">    U64 <span class='keyword'>const</span> pledgedSrcSize = (pss==0) ? <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span> : pss;</td></tr>
<tr class="codeline" data-linenumber="3680"><td class="num" id="LN3680">3680</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_resetCStream: pledgedSrcSize = %u"</span>, (<span class='keyword'>unsigned</span>)pledgedSrcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3681"><td class="num" id="LN3681">3681</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3682"><td class="num" id="LN3682">3682</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setPledgedSrcSize(zcs, pledgedSrcSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setPledgedSrcSize(zcs<br>, pledgedSrcSize)); if (ERR_isError(err_code)) { {}; if (0) {<br> _force_has_format_string(""); }; {}; {}; return err_code; } }<br> while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3683"><td class="num" id="LN3683">3683</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3684"><td class="num" id="LN3684">3684</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3685"><td class="num" id="LN3685">3685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3686"><td class="num" id="LN3686">3686</td><td class="line"><span class='comment'>/*! ZSTD_initCStream_internal() :</span></td></tr>
<tr class="codeline" data-linenumber="3687"><td class="num" id="LN3687">3687</td><td class="line"> <span class='comment'>*  Note : for lib/compress only. Used by zstdmt_compress.c.</span></td></tr>
<tr class="codeline" data-linenumber="3688"><td class="num" id="LN3688">3688</td><td class="line"> <span class='comment'>*  Assumption 1 : params are valid</span></td></tr>
<tr class="codeline" data-linenumber="3689"><td class="num" id="LN3689">3689</td><td class="line"> <span class='comment'>*  Assumption 2 : either dict, or cdict, is defined, not both */</span></td></tr>
<tr class="codeline" data-linenumber="3690"><td class="num" id="LN3690">3690</td><td class="line">size_t ZSTD_initCStream_internal(ZSTD_CStream* zcs,</td></tr>
<tr class="codeline" data-linenumber="3691"><td class="num" id="LN3691">3691</td><td class="line">                    <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize, <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="3692"><td class="num" id="LN3692">3692</td><td class="line">                    <span class='keyword'>const</span> ZSTD_CCtx_params* params,</td></tr>
<tr class="codeline" data-linenumber="3693"><td class="num" id="LN3693">3693</td><td class="line">                    <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="3694"><td class="num" id="LN3694">3694</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3695"><td class="num" id="LN3695">3695</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream_internal"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3696"><td class="num" id="LN3696">3696</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3697"><td class="num" id="LN3697">3697</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setPledgedSrcSize(zcs, pledgedSrcSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setPledgedSrcSize(zcs<br>, pledgedSrcSize)); if (ERR_isError(err_code)) { {}; if (0) {<br> _force_has_format_string(""); }; {}; {}; return err_code; } }<br> while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3698"><td class="num" id="LN3698">3698</td><td class="line">    <span class='macro'>assert(!ZSTD_isError(ZSTD_checkCParams(params-&gt;cParams)))<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3699"><td class="num" id="LN3699">3699</td><td class="line">    zcs-&gt;requestedParams = *params;</td></tr>
<tr class="codeline" data-linenumber="3700"><td class="num" id="LN3700">3700</td><td class="line">    <span class='macro'>assert(!((dict) &amp;&amp; (cdict)))<span class='macro_popup'>((void)0)</span></span>;  <span class='comment'>/* either dict or cdict, not both */</span></td></tr>
<tr class="codeline" data-linenumber="3701"><td class="num" id="LN3701">3701</td><td class="line">    <span class='keyword'>if</span> (dict) {</td></tr>
<tr class="codeline" data-linenumber="3702"><td class="num" id="LN3702">3702</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_loadDictionary(zcs, dict, dictSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_loadDictionary(zcs, dict<br>, dictSize)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3703"><td class="num" id="LN3703">3703</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="3704"><td class="num" id="LN3704">3704</td><td class="line">        <span class='comment'>/* Dictionary is cleared if !cdict */</span></td></tr>
<tr class="codeline" data-linenumber="3705"><td class="num" id="LN3705">3705</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_refCDict(zcs, cdict) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_refCDict(zcs, cdict))<br>; if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3706"><td class="num" id="LN3706">3706</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3707"><td class="num" id="LN3707">3707</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3708"><td class="num" id="LN3708">3708</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3709"><td class="num" id="LN3709">3709</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3710"><td class="num" id="LN3710">3710</td><td class="line"><span class='comment'>/* ZSTD_initCStream_usingCDict_advanced() :</span></td></tr>
<tr class="codeline" data-linenumber="3711"><td class="num" id="LN3711">3711</td><td class="line"> <span class='comment'>* same as ZSTD_initCStream_usingCDict(), with control over frame parameters */</span></td></tr>
<tr class="codeline" data-linenumber="3712"><td class="num" id="LN3712">3712</td><td class="line">size_t ZSTD_initCStream_usingCDict_advanced(ZSTD_CStream* zcs,</td></tr>
<tr class="codeline" data-linenumber="3713"><td class="num" id="LN3713">3713</td><td class="line">                                            <span class='keyword'>const</span> ZSTD_CDict* cdict,</td></tr>
<tr class="codeline" data-linenumber="3714"><td class="num" id="LN3714">3714</td><td class="line">                                            ZSTD_frameParameters fParams,</td></tr>
<tr class="codeline" data-linenumber="3715"><td class="num" id="LN3715">3715</td><td class="line">                                            <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pledgedSrcSize)</td></tr>
<tr class="codeline" data-linenumber="3716"><td class="num" id="LN3716">3716</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3717"><td class="num" id="LN3717">3717</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream_usingCDict_advanced"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3718"><td class="num" id="LN3718">3718</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3719"><td class="num" id="LN3719">3719</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setPledgedSrcSize(zcs, pledgedSrcSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setPledgedSrcSize(zcs<br>, pledgedSrcSize)); if (ERR_isError(err_code)) { {}; if (0) {<br> _force_has_format_string(""); }; {}; {}; return err_code; } }<br> while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3720"><td class="num" id="LN3720">3720</td><td class="line">    zcs-&gt;requestedParams.fParams = fParams;</td></tr>
<tr class="codeline" data-linenumber="3721"><td class="num" id="LN3721">3721</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_refCDict(zcs, cdict) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_refCDict(zcs, cdict))<br>; if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3722"><td class="num" id="LN3722">3722</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3723"><td class="num" id="LN3723">3723</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3724"><td class="num" id="LN3724">3724</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3725"><td class="num" id="LN3725">3725</td><td class="line"><span class='comment'>/* note : cdict must outlive compression session */</span></td></tr>
<tr class="codeline" data-linenumber="3726"><td class="num" id="LN3726">3726</td><td class="line">size_t ZSTD_initCStream_usingCDict(ZSTD_CStream* zcs, <span class='keyword'>const</span> ZSTD_CDict* cdict)</td></tr>
<tr class="codeline" data-linenumber="3727"><td class="num" id="LN3727">3727</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3728"><td class="num" id="LN3728">3728</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream_usingCDict"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3729"><td class="num" id="LN3729">3729</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3730"><td class="num" id="LN3730">3730</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_refCDict(zcs, cdict) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_refCDict(zcs, cdict))<br>; if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3731"><td class="num" id="LN3731">3731</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3732"><td class="num" id="LN3732">3732</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3733"><td class="num" id="LN3733">3733</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3734"><td class="num" id="LN3734">3734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3735"><td class="num" id="LN3735">3735</td><td class="line"><span class='comment'>/* ZSTD_initCStream_advanced() :</span></td></tr>
<tr class="codeline" data-linenumber="3736"><td class="num" id="LN3736">3736</td><td class="line"> <span class='comment'>* pledgedSrcSize must be exact.</span></td></tr>
<tr class="codeline" data-linenumber="3737"><td class="num" id="LN3737">3737</td><td class="line"> <span class='comment'>* if srcSize is not known at init time, use value ZSTD_CONTENTSIZE_UNKNOWN.</span></td></tr>
<tr class="codeline" data-linenumber="3738"><td class="num" id="LN3738">3738</td><td class="line"> <span class='comment'>* dict is loaded with default parameters ZSTD_dct_auto and ZSTD_dlm_byCopy. */</span></td></tr>
<tr class="codeline" data-linenumber="3739"><td class="num" id="LN3739">3739</td><td class="line">size_t ZSTD_initCStream_advanced(ZSTD_CStream* zcs,</td></tr>
<tr class="codeline" data-linenumber="3740"><td class="num" id="LN3740">3740</td><td class="line">                                 <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize,</td></tr>
<tr class="codeline" data-linenumber="3741"><td class="num" id="LN3741">3741</td><td class="line">                                 ZSTD_parameters params, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pss)</td></tr>
<tr class="codeline" data-linenumber="3742"><td class="num" id="LN3742">3742</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3743"><td class="num" id="LN3743">3743</td><td class="line">    <span class='comment'>/* for compatibility with older programs relying on this behavior.</span></td></tr>
<tr class="codeline" data-linenumber="3744"><td class="num" id="LN3744">3744</td><td class="line">     <span class='comment'>* Users should now specify ZSTD_CONTENTSIZE_UNKNOWN.</span></td></tr>
<tr class="codeline" data-linenumber="3745"><td class="num" id="LN3745">3745</td><td class="line">     <span class='comment'>* This line will be removed in the future.</span></td></tr>
<tr class="codeline" data-linenumber="3746"><td class="num" id="LN3746">3746</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3747"><td class="num" id="LN3747">3747</td><td class="line">    U64 <span class='keyword'>const</span> pledgedSrcSize = (pss==0 &amp;&amp; params.fParams.contentSizeFlag==0) ? <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span> : pss;</td></tr>
<tr class="codeline" data-linenumber="3748"><td class="num" id="LN3748">3748</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream_advanced"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3749"><td class="num" id="LN3749">3749</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3750"><td class="num" id="LN3750">3750</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setPledgedSrcSize(zcs, pledgedSrcSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setPledgedSrcSize(zcs<br>, pledgedSrcSize)); if (ERR_isError(err_code)) { {}; if (0) {<br> _force_has_format_string(""); }; {}; {}; return err_code; } }<br> while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3751"><td class="num" id="LN3751">3751</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_checkCParams(params.cParams) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_checkCParams(params.cParams<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3752"><td class="num" id="LN3752">3752</td><td class="line">    zcs-&gt;requestedParams = ZSTD_assignParamsToCCtxParams(&amp;zcs-&gt;requestedParams, &amp;params);</td></tr>
<tr class="codeline" data-linenumber="3753"><td class="num" id="LN3753">3753</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_loadDictionary(zcs, dict, dictSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_loadDictionary(zcs, dict<br>, dictSize)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3754"><td class="num" id="LN3754">3754</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3755"><td class="num" id="LN3755">3755</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3756"><td class="num" id="LN3756">3756</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3757"><td class="num" id="LN3757">3757</td><td class="line">size_t ZSTD_initCStream_usingDict(ZSTD_CStream* zcs, <span class='keyword'>const</span> <span class='keyword'>void</span>* dict, size_t dictSize, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3758"><td class="num" id="LN3758">3758</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3759"><td class="num" id="LN3759">3759</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream_usingDict"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3760"><td class="num" id="LN3760">3760</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3761"><td class="num" id="LN3761">3761</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setParameter(zcs, ZSTD_c_compressionLevel, compressionLevel) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setParameter(zcs, ZSTD_c_compressionLevel<br>, compressionLevel)); if (ERR_isError(err_code)) { {}; if (0)<br> { _force_has_format_string(""); }; {}; {}; return err_code; }<br> } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3762"><td class="num" id="LN3762">3762</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_loadDictionary(zcs, dict, dictSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_loadDictionary(zcs, dict<br>, dictSize)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3763"><td class="num" id="LN3763">3763</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3764"><td class="num" id="LN3764">3764</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3765"><td class="num" id="LN3765">3765</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3766"><td class="num" id="LN3766">3766</td><td class="line">size_t ZSTD_initCStream_srcSize(ZSTD_CStream* zcs, <span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> pss)</td></tr>
<tr class="codeline" data-linenumber="3767"><td class="num" id="LN3767">3767</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3768"><td class="num" id="LN3768">3768</td><td class="line">    <span class='comment'>/* temporary : 0 interpreted as "unknown" during transition period.</span></td></tr>
<tr class="codeline" data-linenumber="3769"><td class="num" id="LN3769">3769</td><td class="line">     <span class='comment'>* Users willing to specify "unknown" **must** use ZSTD_CONTENTSIZE_UNKNOWN.</span></td></tr>
<tr class="codeline" data-linenumber="3770"><td class="num" id="LN3770">3770</td><td class="line">     <span class='comment'>* 0 will be interpreted as "empty" in the future.</span></td></tr>
<tr class="codeline" data-linenumber="3771"><td class="num" id="LN3771">3771</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="3772"><td class="num" id="LN3772">3772</td><td class="line">    U64 <span class='keyword'>const</span> pledgedSrcSize = (pss==0) ? <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span> : pss;</td></tr>
<tr class="codeline" data-linenumber="3773"><td class="num" id="LN3773">3773</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream_srcSize"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3774"><td class="num" id="LN3774">3774</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3775"><td class="num" id="LN3775">3775</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_refCDict(zcs, NULL) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_refCDict(zcs, ((void*<br>)0))); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3776"><td class="num" id="LN3776">3776</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setParameter(zcs, ZSTD_c_compressionLevel, compressionLevel) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setParameter(zcs, ZSTD_c_compressionLevel<br>, compressionLevel)); if (ERR_isError(err_code)) { {}; if (0)<br> { _force_has_format_string(""); }; {}; {}; return err_code; }<br> } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3777"><td class="num" id="LN3777">3777</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setPledgedSrcSize(zcs, pledgedSrcSize) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setPledgedSrcSize(zcs<br>, pledgedSrcSize)); if (ERR_isError(err_code)) { {}; if (0) {<br> _force_has_format_string(""); }; {}; {}; return err_code; } }<br> while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3778"><td class="num" id="LN3778">3778</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3779"><td class="num" id="LN3779">3779</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3780"><td class="num" id="LN3780">3780</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3781"><td class="num" id="LN3781">3781</td><td class="line">size_t ZSTD_initCStream(ZSTD_CStream* zcs, <span class='keyword'>int</span> compressionLevel)</td></tr>
<tr class="codeline" data-linenumber="3782"><td class="num" id="LN3782">3782</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3783"><td class="num" id="LN3783">3783</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_initCStream"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3784"><td class="num" id="LN3784">3784</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only<br>)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3785"><td class="num" id="LN3785">3785</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_refCDict(zcs, NULL) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_refCDict(zcs, ((void*<br>)0))); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3786"><td class="num" id="LN3786">3786</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_CCtx_setParameter(zcs, ZSTD_c_compressionLevel, compressionLevel) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_CCtx_setParameter(zcs, ZSTD_c_compressionLevel<br>, compressionLevel)); if (ERR_isError(err_code)) { {}; if (0)<br> { _force_has_format_string(""); }; {}; {}; return err_code; }<br> } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3787"><td class="num" id="LN3787">3787</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3788"><td class="num" id="LN3788">3788</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3789"><td class="num" id="LN3789">3789</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3790"><td class="num" id="LN3790">3790</td><td class="line"><span class='comment'>/*======   Compression   ======*/</span></td></tr>
<tr class="codeline" data-linenumber="3791"><td class="num" id="LN3791">3791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3792"><td class="num" id="LN3792">3792</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_nextInputSizeHint(<span class='keyword'>const</span> ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="3793"><td class="num" id="LN3793">3793</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3794"><td class="num" id="LN3794">3794</td><td class="line">    size_t hintInSize = cctx-&gt;inBuffTarget - cctx-&gt;inBuffPos;</td></tr>
<tr class="codeline" data-linenumber="3795"><td class="num" id="LN3795">3795</td><td class="line">    <span class='keyword'>if</span> (hintInSize==0) hintInSize = cctx-&gt;blockSize;</td></tr>
<tr class="codeline" data-linenumber="3796"><td class="num" id="LN3796">3796</td><td class="line">    <span class='keyword'>return</span> hintInSize;</td></tr>
<tr class="codeline" data-linenumber="3797"><td class="num" id="LN3797">3797</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3798"><td class="num" id="LN3798">3798</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3799"><td class="num" id="LN3799">3799</td><td class="line"><span class='comment'>/** ZSTD_compressStream_generic():</span></td></tr>
<tr class="codeline" data-linenumber="3800"><td class="num" id="LN3800">3800</td><td class="line"> <span class='comment'>*  internal function for all *compressStream*() variants</span></td></tr>
<tr class="codeline" data-linenumber="3801"><td class="num" id="LN3801">3801</td><td class="line"> <span class='comment'>*  non-static, because can be called from zstdmt_compress.c</span></td></tr>
<tr class="codeline" data-linenumber="3802"><td class="num" id="LN3802">3802</td><td class="line"> <span class='comment'>* @return : hint size for next input */</span></td></tr>
<tr class="codeline" data-linenumber="3803"><td class="num" id="LN3803">3803</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_compressStream_generic(ZSTD_CStream* zcs,</td></tr>
<tr class="codeline" data-linenumber="3804"><td class="num" id="LN3804">3804</td><td class="line">                                          ZSTD_outBuffer* output,</td></tr>
<tr class="codeline" data-linenumber="3805"><td class="num" id="LN3805">3805</td><td class="line">                                          ZSTD_inBuffer* input,</td></tr>
<tr class="codeline" data-linenumber="3806"><td class="num" id="LN3806">3806</td><td class="line">                                          ZSTD_EndDirective <span class='keyword'>const</span> flushMode)</td></tr>
<tr class="codeline" data-linenumber="3807"><td class="num" id="LN3807">3807</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3808"><td class="num" id="LN3808">3808</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span>* <span class='keyword'>const</span> istart = (<span class='keyword'>const</span> <span class='keyword'>char</span>*)input-&gt;src;</td></tr>
<tr class="codeline" data-linenumber="3809"><td class="num" id="LN3809">3809</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span>* <span class='keyword'>const</span> iend = input-&gt;size != 0 ? istart + input-&gt;size : istart;</td></tr>
<tr class="codeline" data-linenumber="3810"><td class="num" id="LN3810">3810</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span>* ip = input-&gt;pos != 0 ? istart + input-&gt;pos : istart;</td></tr>
<tr class="codeline" data-linenumber="3811"><td class="num" id="LN3811">3811</td><td class="line">    <span class='keyword'>char</span>* <span class='keyword'>const</span> ostart = (<span class='keyword'>char</span>*)output-&gt;dst;</td></tr>
<tr class="codeline" data-linenumber="3812"><td class="num" id="LN3812">3812</td><td class="line">    <span class='keyword'>char</span>* <span class='keyword'>const</span> oend = output-&gt;size != 0 ? ostart + output-&gt;size : ostart;</td></tr>
<tr class="codeline" data-linenumber="3813"><td class="num" id="LN3813">3813</td><td class="line">    <span class='keyword'>char</span>* op = output-&gt;pos != 0 ? ostart + output-&gt;pos : ostart;</td></tr>
<tr class="codeline" data-linenumber="3814"><td class="num" id="LN3814">3814</td><td class="line">    U32 someMoreWork = 1;</td></tr>
<tr class="codeline" data-linenumber="3815"><td class="num" id="LN3815">3815</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3816"><td class="num" id="LN3816">3816</td><td class="line">    <span class='comment'>/* check expectations */</span></td></tr>
<tr class="codeline" data-linenumber="3817"><td class="num" id="LN3817">3817</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressStream_generic, flush=%u"</span>, (<span class='keyword'>unsigned</span>)flushMode)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3818"><td class="num" id="LN3818">3818</td><td class="line">    <span class='macro'>assert(zcs-&gt;inBuff != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3819"><td class="num" id="LN3819">3819</td><td class="line">    <span class='macro'>assert(zcs-&gt;inBuffSize &gt; 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3820"><td class="num" id="LN3820">3820</td><td class="line">    <span class='macro'>assert(zcs-&gt;outBuff !=  NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3821"><td class="num" id="LN3821">3821</td><td class="line">    <span class='macro'>assert(zcs-&gt;outBuffSize &gt; 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3822"><td class="num" id="LN3822">3822</td><td class="line">    <span class='macro'>assert(output-&gt;pos &lt;= output-&gt;size)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3823"><td class="num" id="LN3823">3823</td><td class="line">    <span class='macro'>assert(input-&gt;pos &lt;= input-&gt;size)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3824"><td class="num" id="LN3824">3824</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3825"><td class="num" id="LN3825">3825</td><td class="line">    <span class='keyword'>while</span> (someMoreWork) {</td></tr>
<tr class="codeline" data-linenumber="3826"><td class="num" id="LN3826">3826</td><td class="line">        <span class='keyword'>switch</span>(zcs-&gt;streamStage)</td></tr>
<tr class="codeline" data-linenumber="3827"><td class="num" id="LN3827">3827</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3828"><td class="num" id="LN3828">3828</td><td class="line">        <span class='keyword'>case</span> zcss_init:</td></tr>
<tr class="codeline" data-linenumber="3829"><td class="num" id="LN3829">3829</td><td class="line">            <span class='macro'>RETURN_ERROR(init_missing, <span class='string_literal'>"call ZSTD_initCStream() first!"</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string("call ZSTD_initCStream() first!"<br>); }; {}; {}; return ((size_t)-ZSTD_error_init_missing); } while<br>(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3830"><td class="num" id="LN3830">3830</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3831"><td class="num" id="LN3831">3831</td><td class="line">        <span class='keyword'>case</span> zcss_load:</td></tr>
<tr class="codeline" data-linenumber="3832"><td class="num" id="LN3832">3832</td><td class="line">            <span class='keyword'>if</span> ( (flushMode == ZSTD_e_end)</td></tr>
<tr class="codeline" data-linenumber="3833"><td class="num" id="LN3833">3833</td><td class="line">              &amp;&amp; ((size_t)(oend-op) &gt;= ZSTD_compressBound(iend-ip))  <span class='comment'>/* enough dstCapacity */</span></td></tr>
<tr class="codeline" data-linenumber="3834"><td class="num" id="LN3834">3834</td><td class="line">              &amp;&amp; (zcs-&gt;inBuffPos == 0) ) {</td></tr>
<tr class="codeline" data-linenumber="3835"><td class="num" id="LN3835">3835</td><td class="line">                <span class='comment'>/* shortcut to compression pass directly into output buffer */</span></td></tr>
<tr class="codeline" data-linenumber="3836"><td class="num" id="LN3836">3836</td><td class="line">                size_t <span class='keyword'>const</span> cSize = ZSTD_compressEnd(zcs,</td></tr>
<tr class="codeline" data-linenumber="3837"><td class="num" id="LN3837">3837</td><td class="line">                                                op, oend-op, ip, iend-ip);</td></tr>
<tr class="codeline" data-linenumber="3838"><td class="num" id="LN3838">3838</td><td class="line">                <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressEnd : cSize=%u"</span>, (<span class='keyword'>unsigned</span>)cSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3839"><td class="num" id="LN3839">3839</td><td class="line">                <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"ZSTD_compressEnd failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressEnd failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3840"><td class="num" id="LN3840">3840</td><td class="line">                ip = iend;</td></tr>
<tr class="codeline" data-linenumber="3841"><td class="num" id="LN3841">3841</td><td class="line">                op += cSize;</td></tr>
<tr class="codeline" data-linenumber="3842"><td class="num" id="LN3842">3842</td><td class="line">                zcs-&gt;frameEnded = 1;</td></tr>
<tr class="codeline" data-linenumber="3843"><td class="num" id="LN3843">3843</td><td class="line">                ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only);</td></tr>
<tr class="codeline" data-linenumber="3844"><td class="num" id="LN3844">3844</td><td class="line">                someMoreWork = 0; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3845"><td class="num" id="LN3845">3845</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3846"><td class="num" id="LN3846">3846</td><td class="line">            <span class='comment'>/* complete loading into inBuffer */</span></td></tr>
<tr class="codeline" data-linenumber="3847"><td class="num" id="LN3847">3847</td><td class="line">            {   size_t <span class='keyword'>const</span> toLoad = zcs-&gt;inBuffTarget - zcs-&gt;inBuffPos;</td></tr>
<tr class="codeline" data-linenumber="3848"><td class="num" id="LN3848">3848</td><td class="line">                size_t <span class='keyword'>const</span> loaded = ZSTD_limitCopy(</td></tr>
<tr class="codeline" data-linenumber="3849"><td class="num" id="LN3849">3849</td><td class="line">                                        zcs-&gt;inBuff + zcs-&gt;inBuffPos, toLoad,</td></tr>
<tr class="codeline" data-linenumber="3850"><td class="num" id="LN3850">3850</td><td class="line">                                        ip, iend-ip);</td></tr>
<tr class="codeline" data-linenumber="3851"><td class="num" id="LN3851">3851</td><td class="line">                zcs-&gt;inBuffPos += loaded;</td></tr>
<tr class="codeline" data-linenumber="3852"><td class="num" id="LN3852">3852</td><td class="line">                <span class='keyword'>if</span> (loaded != 0)</td></tr>
<tr class="codeline" data-linenumber="3853"><td class="num" id="LN3853">3853</td><td class="line">                    ip += loaded;</td></tr>
<tr class="codeline" data-linenumber="3854"><td class="num" id="LN3854">3854</td><td class="line">                <span class='keyword'>if</span> ( (flushMode == ZSTD_e_continue)</td></tr>
<tr class="codeline" data-linenumber="3855"><td class="num" id="LN3855">3855</td><td class="line">                  &amp;&amp; (zcs-&gt;inBuffPos &lt; zcs-&gt;inBuffTarget) ) {</td></tr>
<tr class="codeline" data-linenumber="3856"><td class="num" id="LN3856">3856</td><td class="line">                    <span class='comment'>/* not enough input to fill full block : stop here */</span></td></tr>
<tr class="codeline" data-linenumber="3857"><td class="num" id="LN3857">3857</td><td class="line">                    someMoreWork = 0; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3858"><td class="num" id="LN3858">3858</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="3859"><td class="num" id="LN3859">3859</td><td class="line">                <span class='keyword'>if</span> ( (flushMode == ZSTD_e_flush)</td></tr>
<tr class="codeline" data-linenumber="3860"><td class="num" id="LN3860">3860</td><td class="line">                  &amp;&amp; (zcs-&gt;inBuffPos == zcs-&gt;inToCompress) ) {</td></tr>
<tr class="codeline" data-linenumber="3861"><td class="num" id="LN3861">3861</td><td class="line">                    <span class='comment'>/* empty */</span></td></tr>
<tr class="codeline" data-linenumber="3862"><td class="num" id="LN3862">3862</td><td class="line">                    someMoreWork = 0; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3863"><td class="num" id="LN3863">3863</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="3864"><td class="num" id="LN3864">3864</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3865"><td class="num" id="LN3865">3865</td><td class="line">            <span class='comment'>/* compress current block (note : this stage cannot be stopped in the middle) */</span></td></tr>
<tr class="codeline" data-linenumber="3866"><td class="num" id="LN3866">3866</td><td class="line">            <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"stream compression stage (flushMode==%u)"</span>, flushMode)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3867"><td class="num" id="LN3867">3867</td><td class="line">            {   <span class='keyword'>void</span>* cDst;</td></tr>
<tr class="codeline" data-linenumber="3868"><td class="num" id="LN3868">3868</td><td class="line">                size_t cSize;</td></tr>
<tr class="codeline" data-linenumber="3869"><td class="num" id="LN3869">3869</td><td class="line">                size_t <span class='keyword'>const</span> iSize = zcs-&gt;inBuffPos - zcs-&gt;inToCompress;</td></tr>
<tr class="codeline" data-linenumber="3870"><td class="num" id="LN3870">3870</td><td class="line">                size_t oSize = oend-op;</td></tr>
<tr class="codeline" data-linenumber="3871"><td class="num" id="LN3871">3871</td><td class="line">                <span class='keyword'>unsigned</span> <span class='keyword'>const</span> lastBlock = (flushMode == ZSTD_e_end) &amp;&amp; (ip==iend);</td></tr>
<tr class="codeline" data-linenumber="3872"><td class="num" id="LN3872">3872</td><td class="line">                <span class='keyword'>if</span> (oSize &gt;= ZSTD_compressBound(iSize))</td></tr>
<tr class="codeline" data-linenumber="3873"><td class="num" id="LN3873">3873</td><td class="line">                    cDst = op;   <span class='comment'>/* compress into output buffer, to skip flush stage */</span></td></tr>
<tr class="codeline" data-linenumber="3874"><td class="num" id="LN3874">3874</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3875"><td class="num" id="LN3875">3875</td><td class="line">                    cDst = zcs-&gt;outBuff, oSize = zcs-&gt;outBuffSize;</td></tr>
<tr class="codeline" data-linenumber="3876"><td class="num" id="LN3876">3876</td><td class="line">                cSize = lastBlock ?</td></tr>
<tr class="codeline" data-linenumber="3877"><td class="num" id="LN3877">3877</td><td class="line">                        ZSTD_compressEnd(zcs, cDst, oSize,</td></tr>
<tr class="codeline" data-linenumber="3878"><td class="num" id="LN3878">3878</td><td class="line">                                    zcs-&gt;inBuff + zcs-&gt;inToCompress, iSize) :</td></tr>
<tr class="codeline" data-linenumber="3879"><td class="num" id="LN3879">3879</td><td class="line">                        ZSTD_compressContinue(zcs, cDst, oSize,</td></tr>
<tr class="codeline" data-linenumber="3880"><td class="num" id="LN3880">3880</td><td class="line">                                    zcs-&gt;inBuff + zcs-&gt;inToCompress, iSize);</td></tr>
<tr class="codeline" data-linenumber="3881"><td class="num" id="LN3881">3881</td><td class="line">                <span class='macro'>FORWARD_IF_ERROR(cSize, <span class='string_literal'>"%s"</span>, lastBlock ? <span class='string_literal'>"ZSTD_compressEnd failed"</span> : <span class='string_literal'>"ZSTD_compressContinue failed"</span>)<span class='macro_popup'>do { size_t const err_code = (cSize); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("%s", lastBlock ? "ZSTD_compressEnd failed"<br> : "ZSTD_compressContinue failed"); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3882"><td class="num" id="LN3882">3882</td><td class="line">                zcs-&gt;frameEnded = lastBlock;</td></tr>
<tr class="codeline" data-linenumber="3883"><td class="num" id="LN3883">3883</td><td class="line">                <span class='comment'>/* prepare next block */</span></td></tr>
<tr class="codeline" data-linenumber="3884"><td class="num" id="LN3884">3884</td><td class="line">                zcs-&gt;inBuffTarget = zcs-&gt;inBuffPos + zcs-&gt;blockSize;</td></tr>
<tr class="codeline" data-linenumber="3885"><td class="num" id="LN3885">3885</td><td class="line">                <span class='keyword'>if</span> (zcs-&gt;inBuffTarget &gt; zcs-&gt;inBuffSize)</td></tr>
<tr class="codeline" data-linenumber="3886"><td class="num" id="LN3886">3886</td><td class="line">                    zcs-&gt;inBuffPos = 0, zcs-&gt;inBuffTarget = zcs-&gt;blockSize;</td></tr>
<tr class="codeline" data-linenumber="3887"><td class="num" id="LN3887">3887</td><td class="line">                <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"inBuffTarget:%u / inBuffSize:%u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="3888"><td class="num" id="LN3888">3888</td><td class="line">                         <span class='macro'>(<span class='keyword'>unsigned</span>)zcs-&gt;inBuffTarget, (<span class='keyword'>unsigned</span>)zcs-&gt;inBuffSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3889"><td class="num" id="LN3889">3889</td><td class="line">                <span class='keyword'>if</span> (!lastBlock)</td></tr>
<tr class="codeline" data-linenumber="3890"><td class="num" id="LN3890">3890</td><td class="line">                    <span class='macro'>assert(zcs-&gt;inBuffTarget &lt;= zcs-&gt;inBuffSize)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3891"><td class="num" id="LN3891">3891</td><td class="line">                zcs-&gt;inToCompress = zcs-&gt;inBuffPos;</td></tr>
<tr class="codeline" data-linenumber="3892"><td class="num" id="LN3892">3892</td><td class="line">                <span class='keyword'>if</span> (cDst == op) {  <span class='comment'>/* no need to flush */</span></td></tr>
<tr class="codeline" data-linenumber="3893"><td class="num" id="LN3893">3893</td><td class="line">                    op += cSize;</td></tr>
<tr class="codeline" data-linenumber="3894"><td class="num" id="LN3894">3894</td><td class="line">                    <span class='keyword'>if</span> (zcs-&gt;frameEnded) {</td></tr>
<tr class="codeline" data-linenumber="3895"><td class="num" id="LN3895">3895</td><td class="line">                        <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"Frame completed directly in outBuffer"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3896"><td class="num" id="LN3896">3896</td><td class="line">                        someMoreWork = 0;</td></tr>
<tr class="codeline" data-linenumber="3897"><td class="num" id="LN3897">3897</td><td class="line">                        ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only);</td></tr>
<tr class="codeline" data-linenumber="3898"><td class="num" id="LN3898">3898</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="3899"><td class="num" id="LN3899">3899</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3900"><td class="num" id="LN3900">3900</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="3901"><td class="num" id="LN3901">3901</td><td class="line">                zcs-&gt;outBuffContentSize = cSize;</td></tr>
<tr class="codeline" data-linenumber="3902"><td class="num" id="LN3902">3902</td><td class="line">                zcs-&gt;outBuffFlushedSize = 0;</td></tr>
<tr class="codeline" data-linenumber="3903"><td class="num" id="LN3903">3903</td><td class="line">                zcs-&gt;streamStage = zcss_flush; <span class='comment'>/* pass-through to flush stage */</span></td></tr>
<tr class="codeline" data-linenumber="3904"><td class="num" id="LN3904">3904</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3905"><td class="num" id="LN3905">3905</td><td class="line">	    <span class='comment'>/* fall-through */</span></td></tr>
<tr class="codeline" data-linenumber="3906"><td class="num" id="LN3906">3906</td><td class="line">        <span class='keyword'>case</span> zcss_flush:</td></tr>
<tr class="codeline" data-linenumber="3907"><td class="num" id="LN3907">3907</td><td class="line">            <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"flush stage"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3908"><td class="num" id="LN3908">3908</td><td class="line">            {   size_t <span class='keyword'>const</span> toFlush = zcs-&gt;outBuffContentSize - zcs-&gt;outBuffFlushedSize;</td></tr>
<tr class="codeline" data-linenumber="3909"><td class="num" id="LN3909">3909</td><td class="line">                size_t <span class='keyword'>const</span> flushed = ZSTD_limitCopy(op, (size_t)(oend-op),</td></tr>
<tr class="codeline" data-linenumber="3910"><td class="num" id="LN3910">3910</td><td class="line">                            zcs-&gt;outBuff + zcs-&gt;outBuffFlushedSize, toFlush);</td></tr>
<tr class="codeline" data-linenumber="3911"><td class="num" id="LN3911">3911</td><td class="line">                <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"toFlush: %u into %u ==&gt; flushed: %u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="3912"><td class="num" id="LN3912">3912</td><td class="line">                            <span class='macro'>(<span class='keyword'>unsigned</span>)toFlush, (<span class='keyword'>unsigned</span>)(oend-op), (<span class='keyword'>unsigned</span>)flushed)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3913"><td class="num" id="LN3913">3913</td><td class="line">                <span class='keyword'>if</span> (flushed)</td></tr>
<tr class="codeline" data-linenumber="3914"><td class="num" id="LN3914">3914</td><td class="line">                    op += flushed;</td></tr>
<tr class="codeline" data-linenumber="3915"><td class="num" id="LN3915">3915</td><td class="line">                zcs-&gt;outBuffFlushedSize += flushed;</td></tr>
<tr class="codeline" data-linenumber="3916"><td class="num" id="LN3916">3916</td><td class="line">                <span class='keyword'>if</span> (toFlush!=flushed) {</td></tr>
<tr class="codeline" data-linenumber="3917"><td class="num" id="LN3917">3917</td><td class="line">                    <span class='comment'>/* flush not fully completed, presumably because dst is too small */</span></td></tr>
<tr class="codeline" data-linenumber="3918"><td class="num" id="LN3918">3918</td><td class="line">                    <span class='macro'>assert(op==oend)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3919"><td class="num" id="LN3919">3919</td><td class="line">                    someMoreWork = 0;</td></tr>
<tr class="codeline" data-linenumber="3920"><td class="num" id="LN3920">3920</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3921"><td class="num" id="LN3921">3921</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="3922"><td class="num" id="LN3922">3922</td><td class="line">                zcs-&gt;outBuffContentSize = zcs-&gt;outBuffFlushedSize = 0;</td></tr>
<tr class="codeline" data-linenumber="3923"><td class="num" id="LN3923">3923</td><td class="line">                <span class='keyword'>if</span> (zcs-&gt;frameEnded) {</td></tr>
<tr class="codeline" data-linenumber="3924"><td class="num" id="LN3924">3924</td><td class="line">                    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"Frame completed on flush"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3925"><td class="num" id="LN3925">3925</td><td class="line">                    someMoreWork = 0;</td></tr>
<tr class="codeline" data-linenumber="3926"><td class="num" id="LN3926">3926</td><td class="line">                    ZSTD_CCtx_reset(zcs, ZSTD_reset_session_only);</td></tr>
<tr class="codeline" data-linenumber="3927"><td class="num" id="LN3927">3927</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3928"><td class="num" id="LN3928">3928</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="3929"><td class="num" id="LN3929">3929</td><td class="line">                zcs-&gt;streamStage = zcss_load;</td></tr>
<tr class="codeline" data-linenumber="3930"><td class="num" id="LN3930">3930</td><td class="line">                <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3931"><td class="num" id="LN3931">3931</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3932"><td class="num" id="LN3932">3932</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3933"><td class="num" id="LN3933">3933</td><td class="line">        <span class='keyword'>default</span>: <span class='comment'>/* impossible */</span></td></tr>
<tr class="codeline" data-linenumber="3934"><td class="num" id="LN3934">3934</td><td class="line">            <span class='macro'>assert(0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3935"><td class="num" id="LN3935">3935</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3936"><td class="num" id="LN3936">3936</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3937"><td class="num" id="LN3937">3937</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3938"><td class="num" id="LN3938">3938</td><td class="line">    input-&gt;pos = ip - istart;</td></tr>
<tr class="codeline" data-linenumber="3939"><td class="num" id="LN3939">3939</td><td class="line">    output-&gt;pos = op - ostart;</td></tr>
<tr class="codeline" data-linenumber="3940"><td class="num" id="LN3940">3940</td><td class="line">    <span class='keyword'>if</span> (zcs-&gt;frameEnded) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3941"><td class="num" id="LN3941">3941</td><td class="line">    <span class='keyword'>return</span> ZSTD_nextInputSizeHint(zcs);</td></tr>
<tr class="codeline" data-linenumber="3942"><td class="num" id="LN3942">3942</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3943"><td class="num" id="LN3943">3943</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3944"><td class="num" id="LN3944">3944</td><td class="line"><span class='keyword'>static</span> size_t ZSTD_nextInputSizeHint_MTorST(<span class='keyword'>const</span> ZSTD_CCtx* cctx)</td></tr>
<tr class="codeline" data-linenumber="3945"><td class="num" id="LN3945">3945</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3946"><td class="num" id="LN3946">3946</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="3947"><td class="num" id="LN3947">3947</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.nbWorkers &gt;= 1) {</td></tr>
<tr class="codeline" data-linenumber="3948"><td class="num" id="LN3948">3948</td><td class="line">        <span class='macro'>assert(cctx-&gt;mtctx != NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3949"><td class="num" id="LN3949">3949</td><td class="line">        <span class='keyword'>return</span> ZSTDMT_nextInputSizeHint(cctx-&gt;mtctx);</td></tr>
<tr class="codeline" data-linenumber="3950"><td class="num" id="LN3950">3950</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3951"><td class="num" id="LN3951">3951</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3952"><td class="num" id="LN3952">3952</td><td class="line">    <span class='keyword'>return</span> ZSTD_nextInputSizeHint(cctx);</td></tr>
<tr class="codeline" data-linenumber="3953"><td class="num" id="LN3953">3953</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3954"><td class="num" id="LN3954">3954</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3955"><td class="num" id="LN3955">3955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3956"><td class="num" id="LN3956">3956</td><td class="line">size_t ZSTD_compressStream(ZSTD_CStream* zcs, ZSTD_outBuffer* output, ZSTD_inBuffer* input)</td></tr>
<tr class="codeline" data-linenumber="3957"><td class="num" id="LN3957">3957</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3958"><td class="num" id="LN3958">3958</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_compressStream2(zcs, output, input, ZSTD_e_continue) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressStream2(zcs, output<br>, input, ZSTD_e_continue)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3959"><td class="num" id="LN3959">3959</td><td class="line">    <span class='keyword'>return</span> ZSTD_nextInputSizeHint_MTorST(zcs);</td></tr>
<tr class="codeline" data-linenumber="3960"><td class="num" id="LN3960">3960</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3961"><td class="num" id="LN3961">3961</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3962"><td class="num" id="LN3962">3962</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3963"><td class="num" id="LN3963">3963</td><td class="line">size_t ZSTD_compressStream2( ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="3964"><td class="num" id="LN3964">3964</td><td class="line">                             ZSTD_outBuffer* output,</td></tr>
<tr class="codeline" data-linenumber="3965"><td class="num" id="LN3965">3965</td><td class="line">                             ZSTD_inBuffer* input,</td></tr>
<tr class="codeline" data-linenumber="3966"><td class="num" id="LN3966">3966</td><td class="line">                             ZSTD_EndDirective endOp)</td></tr>
<tr class="codeline" data-linenumber="3967"><td class="num" id="LN3967">3967</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3968"><td class="num" id="LN3968">3968</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_compressStream2, endOp=%u "</span>, (<span class='keyword'>unsigned</span>)endOp)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3969"><td class="num" id="LN3969">3969</td><td class="line">    <span class='comment'>/* check conditions */</span></td></tr>
<tr class="codeline" data-linenumber="3970"><td class="num" id="LN3970">3970</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(output-&gt;pos &gt; output-&gt;size, GENERIC, <span class='string_literal'>"invalid buffer"</span>)<span class='macro_popup'>if (output-&gt;pos &gt; output-&gt;size) { {}; if (0) { _force_has_format_string<br>("invalid buffer"); }; {}; {}; return ((size_t)-ZSTD_error_GENERIC<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3971"><td class="num" id="LN3971">3971</td><td class="line">    <span class='macro'>RETURN_ERROR_IF(input-&gt;pos  &gt; input-&gt;size, GENERIC, <span class='string_literal'>"invalid buffer"</span>)<span class='macro_popup'>if (input-&gt;pos &gt; input-&gt;size) { {}; if (0) { _force_has_format_string<br>("invalid buffer"); }; {}; {}; return ((size_t)-ZSTD_error_GENERIC<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3972"><td class="num" id="LN3972">3972</td><td class="line">    <span class='macro'>assert(cctx!=NULL)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3973"><td class="num" id="LN3973">3973</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3974"><td class="num" id="LN3974">3974</td><td class="line">    <span class='comment'>/* transparent initialization stage */</span></td></tr>
<tr class="codeline" data-linenumber="3975"><td class="num" id="LN3975">3975</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;streamStage == zcss_init) {</td></tr>
<tr class="codeline" data-linenumber="3976"><td class="num" id="LN3976">3976</td><td class="line">        ZSTD_CCtx_params params = cctx-&gt;requestedParams;</td></tr>
<tr class="codeline" data-linenumber="3977"><td class="num" id="LN3977">3977</td><td class="line">        ZSTD_prefixDict <span class='keyword'>const</span> prefixDict = cctx-&gt;prefixDict;</td></tr>
<tr class="codeline" data-linenumber="3978"><td class="num" id="LN3978">3978</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR( ZSTD_initLocalDict(cctx) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_initLocalDict(cctx)); if (<br>ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>; <span class='comment'>/* Init the local dict if present. */</span></td></tr>
<tr class="codeline" data-linenumber="3979"><td class="num" id="LN3979">3979</td><td class="line">        memset(&amp;cctx-&gt;prefixDict, 0, <span class='keyword'>sizeof</span>(cctx-&gt;prefixDict));   <span class='comment'>/* single usage */</span></td></tr>
<tr class="codeline" data-linenumber="3980"><td class="num" id="LN3980">3980</td><td class="line">        <span class='macro'>assert(prefixDict.dict==NULL || cctx-&gt;cdict==NULL)<span class='macro_popup'>((void)0)</span></span>;    <span class='comment'>/* only one can be set */</span></td></tr>
<tr class="codeline" data-linenumber="3981"><td class="num" id="LN3981">3981</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressStream2 : transparent init stage"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3982"><td class="num" id="LN3982">3982</td><td class="line">        <span class='keyword'>if</span> (endOp == ZSTD_e_end) cctx-&gt;pledgedSrcSizePlusOne = input-&gt;size + 1;  <span class='comment'>/* auto-fix pledgedSrcSize */</span></td></tr>
<tr class="codeline" data-linenumber="3983"><td class="num" id="LN3983">3983</td><td class="line">        params.cParams = ZSTD_getCParamsFromCCtxParams(</td></tr>
<tr class="codeline" data-linenumber="3984"><td class="num" id="LN3984">3984</td><td class="line">                &amp;cctx-&gt;requestedParams, cctx-&gt;pledgedSrcSizePlusOne-1, 0 <span class='comment'>/*dictSize*/</span>);</td></tr>
<tr class="codeline" data-linenumber="3985"><td class="num" id="LN3985">3985</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3986"><td class="num" id="LN3986">3986</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3987"><td class="num" id="LN3987">3987</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="3988"><td class="num" id="LN3988">3988</td><td class="line">        <span class='keyword'>if</span> ((cctx-&gt;pledgedSrcSizePlusOne-1) &lt;= <span class='macro'>ZSTDMT_JOBSIZE_MIN<span class='macro_popup'>(1 *(1 &lt;&lt;20))</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3989"><td class="num" id="LN3989">3989</td><td class="line">            params.nbWorkers = 0; <span class='comment'>/* do not invoke multi-threading when src size is too small */</span></td></tr>
<tr class="codeline" data-linenumber="3990"><td class="num" id="LN3990">3990</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3991"><td class="num" id="LN3991">3991</td><td class="line">        <span class='keyword'>if</span> (params.nbWorkers &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="3992"><td class="num" id="LN3992">3992</td><td class="line">            <span class='comment'>/* mt context creation */</span></td></tr>
<tr class="codeline" data-linenumber="3993"><td class="num" id="LN3993">3993</td><td class="line">            <span class='keyword'>if</span> (cctx-&gt;mtctx == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="3994"><td class="num" id="LN3994">3994</td><td class="line">                <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compressStream2: creating new mtctx for nbWorkers=%u"</span>,<span class='macro_popup'>{}</span></span></td></tr>
<tr class="codeline" data-linenumber="3995"><td class="num" id="LN3995">3995</td><td class="line">                            <span class='macro'>params.nbWorkers)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3996"><td class="num" id="LN3996">3996</td><td class="line">                cctx-&gt;mtctx = ZSTDMT_createCCtx_advanced((U32)params.nbWorkers, cctx-&gt;customMem);</td></tr>
<tr class="codeline" data-linenumber="3997"><td class="num" id="LN3997">3997</td><td class="line">                <span class='macro'>RETURN_ERROR_IF(cctx-&gt;mtctx == NULL, memory_allocation, <span class='string_literal'>"NULL pointer!"</span>)<span class='macro_popup'>if (cctx-&gt;mtctx == ((void*)0)) { {}; if (0) { _force_has_format_string<br>("NULL pointer!"); }; {}; {}; return ((size_t)-ZSTD_error_memory_allocation<br>); }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3998"><td class="num" id="LN3998">3998</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3999"><td class="num" id="LN3999">3999</td><td class="line">            <span class='comment'>/* mt compression */</span></td></tr>
<tr class="codeline" data-linenumber="4000"><td class="num" id="LN4000">4000</td><td class="line">            <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"call ZSTDMT_initCStream_internal as nbWorkers=%u"</span>, params.nbWorkers)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4001"><td class="num" id="LN4001">4001</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR( ZSTDMT_initCStream_internal(<span class='macro_popup'>do { size_t const err_code = (ZSTDMT_initCStream_internal( cctx<br>-&gt;mtctx, prefixDict.dict, prefixDict.dictSize, prefixDict.<br>dictContentType, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne<br>-1)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="4002"><td class="num" id="LN4002">4002</td><td class="line">                        <span class='macro'>cctx-&gt;mtctx,<span class='macro_popup'>do { size_t const err_code = (ZSTDMT_initCStream_internal( cctx<br>-&gt;mtctx, prefixDict.dict, prefixDict.dictSize, prefixDict.<br>dictContentType, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne<br>-1)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="4003"><td class="num" id="LN4003">4003</td><td class="line">                        <span class='macro'>prefixDict.dict, prefixDict.dictSize, prefixDict.dictContentType,<span class='macro_popup'>do { size_t const err_code = (ZSTDMT_initCStream_internal( cctx<br>-&gt;mtctx, prefixDict.dict, prefixDict.dictSize, prefixDict.<br>dictContentType, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne<br>-1)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="4004"><td class="num" id="LN4004">4004</td><td class="line">                        <span class='macro'>cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne-1) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTDMT_initCStream_internal( cctx<br>-&gt;mtctx, prefixDict.dict, prefixDict.dictSize, prefixDict.<br>dictContentType, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne<br>-1)); if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4005"><td class="num" id="LN4005">4005</td><td class="line">            cctx-&gt;streamStage = zcss_load;</td></tr>
<tr class="codeline" data-linenumber="4006"><td class="num" id="LN4006">4006</td><td class="line">            cctx-&gt;appliedParams.nbWorkers = params.nbWorkers;</td></tr>
<tr class="codeline" data-linenumber="4007"><td class="num" id="LN4007">4007</td><td class="line">        } <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4008"><td class="num" id="LN4008">4008</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4009"><td class="num" id="LN4009">4009</td><td class="line">        {   <span class='macro'>FORWARD_IF_ERROR( ZSTD_resetCStream_internal(cctx,<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCStream_internal(cctx<br>, prefixDict.dict, prefixDict.dictSize, prefixDict.dictContentType<br>, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne-1));<br> if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="4010"><td class="num" id="LN4010">4010</td><td class="line">                            <span class='macro'>prefixDict.dict, prefixDict.dictSize, prefixDict.dictContentType,<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCStream_internal(cctx<br>, prefixDict.dict, prefixDict.dictSize, prefixDict.dictContentType<br>, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne-1));<br> if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="4011"><td class="num" id="LN4011">4011</td><td class="line">                            <span class='macro'>cctx-&gt;cdict,<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCStream_internal(cctx<br>, prefixDict.dict, prefixDict.dictSize, prefixDict.dictContentType<br>, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne-1));<br> if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span></td></tr>
<tr class="codeline" data-linenumber="4012"><td class="num" id="LN4012">4012</td><td class="line">                            <span class='macro'>params, cctx-&gt;pledgedSrcSizePlusOne-1) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_resetCStream_internal(cctx<br>, prefixDict.dict, prefixDict.dictSize, prefixDict.dictContentType<br>, cctx-&gt;cdict, params, cctx-&gt;pledgedSrcSizePlusOne-1));<br> if (ERR_isError(err_code)) { {}; if (0) { _force_has_format_string<br>(""); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4013"><td class="num" id="LN4013">4013</td><td class="line">            <span class='macro'>assert(cctx-&gt;streamStage == zcss_load)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4014"><td class="num" id="LN4014">4014</td><td class="line">            <span class='macro'>assert(cctx-&gt;appliedParams.nbWorkers == 0)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4015"><td class="num" id="LN4015">4015</td><td class="line">    }   }</td></tr>
<tr class="codeline" data-linenumber="4016"><td class="num" id="LN4016">4016</td><td class="line">    <span class='comment'>/* end of transparent initialization stage */</span></td></tr>
<tr class="codeline" data-linenumber="4017"><td class="num" id="LN4017">4017</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4018"><td class="num" id="LN4018">4018</td><td class="line">    <span class='comment'>/* compression stage */</span></td></tr>
<tr class="codeline" data-linenumber="4019"><td class="num" id="LN4019">4019</td><td class="line"><span class='directive'>#ifdef <span class='macro'>ZSTD_MULTITHREAD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="4020"><td class="num" id="LN4020">4020</td><td class="line">    <span class='keyword'>if</span> (cctx-&gt;appliedParams.nbWorkers &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="4021"><td class="num" id="LN4021">4021</td><td class="line">        <span class='keyword'>int</span> <span class='keyword'>const</span> forceMaxProgress = (endOp == ZSTD_e_flush || endOp == ZSTD_e_end);</td></tr>
<tr class="codeline" data-linenumber="4022"><td class="num" id="LN4022">4022</td><td class="line">        size_t flushMin;</td></tr>
<tr class="codeline" data-linenumber="4023"><td class="num" id="LN4023">4023</td><td class="line">        <span class='macro'>assert(forceMaxProgress || endOp == ZSTD_e_continue <span class='comment'>/* Protection for a new flush type */</span>)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4024"><td class="num" id="LN4024">4024</td><td class="line">        <span class='keyword'>if</span> (cctx-&gt;cParamsChanged) {</td></tr>
<tr class="codeline" data-linenumber="4025"><td class="num" id="LN4025">4025</td><td class="line">            ZSTDMT_updateCParams_whileCompressing(cctx-&gt;mtctx, &amp;cctx-&gt;requestedParams);</td></tr>
<tr class="codeline" data-linenumber="4026"><td class="num" id="LN4026">4026</td><td class="line">            cctx-&gt;cParamsChanged = 0;</td></tr>
<tr class="codeline" data-linenumber="4027"><td class="num" id="LN4027">4027</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="4028"><td class="num" id="LN4028">4028</td><td class="line">        <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="4029"><td class="num" id="LN4029">4029</td><td class="line">            flushMin = ZSTDMT_compressStream_generic(cctx-&gt;mtctx, output, input, endOp);</td></tr>
<tr class="codeline" data-linenumber="4030"><td class="num" id="LN4030">4030</td><td class="line">            <span class='keyword'>if</span> ( <span class='macro'>ZSTD_isError<span class='macro_popup'>ERR_isError</span></span>(flushMin)</td></tr>
<tr class="codeline" data-linenumber="4031"><td class="num" id="LN4031">4031</td><td class="line">              || (endOp == ZSTD_e_end &amp;&amp; flushMin == 0) ) { <span class='comment'>/* compression completed */</span></td></tr>
<tr class="codeline" data-linenumber="4032"><td class="num" id="LN4032">4032</td><td class="line">                ZSTD_CCtx_reset(cctx, ZSTD_reset_session_only);</td></tr>
<tr class="codeline" data-linenumber="4033"><td class="num" id="LN4033">4033</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="4034"><td class="num" id="LN4034">4034</td><td class="line">            <span class='macro'>FORWARD_IF_ERROR(flushMin, <span class='string_literal'>"ZSTDMT_compressStream_generic failed"</span>)<span class='macro_popup'>do { size_t const err_code = (flushMin); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTDMT_compressStream_generic failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4035"><td class="num" id="LN4035">4035</td><td class="line">        } <span class='keyword'>while</span> (forceMaxProgress &amp;&amp; flushMin != 0 &amp;&amp; output-&gt;pos &lt; output-&gt;size);</td></tr>
<tr class="codeline" data-linenumber="4036"><td class="num" id="LN4036">4036</td><td class="line">        <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"completed ZSTD_compressStream2 delegating to ZSTDMT_compressStream_generic"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4037"><td class="num" id="LN4037">4037</td><td class="line">        <span class='comment'>/* Either we don't require maximum forward progress, we've finished the</span></td></tr>
<tr class="codeline" data-linenumber="4038"><td class="num" id="LN4038">4038</td><td class="line">         <span class='comment'>* flush, or we are out of output space.</span></td></tr>
<tr class="codeline" data-linenumber="4039"><td class="num" id="LN4039">4039</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="4040"><td class="num" id="LN4040">4040</td><td class="line">        <span class='macro'>assert(!forceMaxProgress || flushMin == 0 || output-&gt;pos == output-&gt;size)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4041"><td class="num" id="LN4041">4041</td><td class="line">        <span class='keyword'>return</span> flushMin;</td></tr>
<tr class="codeline" data-linenumber="4042"><td class="num" id="LN4042">4042</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4043"><td class="num" id="LN4043">4043</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4044"><td class="num" id="LN4044">4044</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( ZSTD_compressStream_generic(cctx, output, input, endOp) , <span class='string_literal'>""</span>)<span class='macro_popup'>do { size_t const err_code = (ZSTD_compressStream_generic(cctx<br>, output, input, endOp)); if (ERR_isError(err_code)) { {}; if<br> (0) { _force_has_format_string(""); }; {}; {}; return err_code<br>; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4045"><td class="num" id="LN4045">4045</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"completed ZSTD_compressStream2"</span>)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4046"><td class="num" id="LN4046">4046</td><td class="line">    <span class='keyword'>return</span> cctx-&gt;outBuffContentSize - cctx-&gt;outBuffFlushedSize; <span class='comment'>/* remaining to flush */</span></td></tr>
<tr class="codeline" data-linenumber="4047"><td class="num" id="LN4047">4047</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4048"><td class="num" id="LN4048">4048</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4049"><td class="num" id="LN4049">4049</td><td class="line">size_t ZSTD_compressStream2_simpleArgs (</td></tr>
<tr class="codeline" data-linenumber="4050"><td class="num" id="LN4050">4050</td><td class="line">                            ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="4051"><td class="num" id="LN4051">4051</td><td class="line">                            <span class='keyword'>void</span>* dst, size_t dstCapacity, size_t* dstPos,</td></tr>
<tr class="codeline" data-linenumber="4052"><td class="num" id="LN4052">4052</td><td class="line">                      <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize, size_t* srcPos,</td></tr>
<tr class="codeline" data-linenumber="4053"><td class="num" id="LN4053">4053</td><td class="line">                            ZSTD_EndDirective endOp)</td></tr>
<tr class="codeline" data-linenumber="4054"><td class="num" id="LN4054">4054</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4055"><td class="num" id="LN4055">4055</td><td class="line">    ZSTD_outBuffer output = { dst, dstCapacity, *dstPos };</td></tr>
<tr class="codeline" data-linenumber="4056"><td class="num" id="LN4056">4056</td><td class="line">    ZSTD_inBuffer  input  = { src, srcSize, *srcPos };</td></tr>
<tr class="codeline" data-linenumber="4057"><td class="num" id="LN4057">4057</td><td class="line">    <span class='comment'>/* ZSTD_compressStream2() will check validity of dstPos and srcPos */</span></td></tr>
<tr class="codeline" data-linenumber="4058"><td class="num" id="LN4058">4058</td><td class="line">    size_t <span class='keyword'>const</span> cErr = ZSTD_compressStream2(cctx, &amp;output, &amp;input, endOp);</td></tr>
<tr class="codeline" data-linenumber="4059"><td class="num" id="LN4059">4059</td><td class="line">    *dstPos = output.pos;</td></tr>
<tr class="codeline" data-linenumber="4060"><td class="num" id="LN4060">4060</td><td class="line">    *srcPos = input.pos;</td></tr>
<tr class="codeline" data-linenumber="4061"><td class="num" id="LN4061">4061</td><td class="line">    <span class='keyword'>return</span> cErr;</td></tr>
<tr class="codeline" data-linenumber="4062"><td class="num" id="LN4062">4062</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4063"><td class="num" id="LN4063">4063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4064"><td class="num" id="LN4064">4064</td><td class="line">size_t ZSTD_compress2(ZSTD_CCtx* cctx,</td></tr>
<tr class="codeline" data-linenumber="4065"><td class="num" id="LN4065">4065</td><td class="line">                      <span class='keyword'>void</span>* dst, size_t dstCapacity,</td></tr>
<tr class="codeline" data-linenumber="4066"><td class="num" id="LN4066">4066</td><td class="line">                      <span class='keyword'>const</span> <span class='keyword'>void</span>* src, size_t srcSize)</td></tr>
<tr class="codeline" data-linenumber="4067"><td class="num" id="LN4067">4067</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4068"><td class="num" id="LN4068">4068</td><td class="line">    <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_compress2 (srcSize=%u)"</span>, (<span class='keyword'>unsigned</span>)srcSize)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4069"><td class="num" id="LN4069">4069</td><td class="line">    ZSTD_CCtx_reset(cctx, ZSTD_reset_session_only);</td></tr>
<tr class="codeline" data-linenumber="4070"><td class="num" id="LN4070">4070</td><td class="line">    {   size_t oPos = 0;</td></tr>
<tr class="codeline" data-linenumber="4071"><td class="num" id="LN4071">4071</td><td class="line">        size_t iPos = 0;</td></tr>
<tr class="codeline" data-linenumber="4072"><td class="num" id="LN4072">4072</td><td class="line">        size_t <span class='keyword'>const</span> result = ZSTD_compressStream2_simpleArgs(cctx,</td></tr>
<tr class="codeline" data-linenumber="4073"><td class="num" id="LN4073">4073</td><td class="line">                                        dst, dstCapacity, &amp;oPos,</td></tr>
<tr class="codeline" data-linenumber="4074"><td class="num" id="LN4074">4074</td><td class="line">                                        src, srcSize, &amp;iPos,</td></tr>
<tr class="codeline" data-linenumber="4075"><td class="num" id="LN4075">4075</td><td class="line">                                        ZSTD_e_end);</td></tr>
<tr class="codeline" data-linenumber="4076"><td class="num" id="LN4076">4076</td><td class="line">        <span class='macro'>FORWARD_IF_ERROR(result, <span class='string_literal'>"ZSTD_compressStream2_simpleArgs failed"</span>)<span class='macro_popup'>do { size_t const err_code = (result); if (ERR_isError(err_code<br>)) { {}; if (0) { _force_has_format_string("ZSTD_compressStream2_simpleArgs failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4077"><td class="num" id="LN4077">4077</td><td class="line">        <span class='keyword'>if</span> (result != 0) {  <span class='comment'>/* compression not completed, due to lack of output space */</span></td></tr>
<tr class="codeline" data-linenumber="4078"><td class="num" id="LN4078">4078</td><td class="line">            <span class='macro'>assert(oPos == dstCapacity)<span class='macro_popup'>((void)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4079"><td class="num" id="LN4079">4079</td><td class="line">            <span class='macro'>RETURN_ERROR(dstSize_tooSmall, <span class='string_literal'>""</span>)<span class='macro_popup'>do { {}; if (0) { _force_has_format_string(""); }; {}; {}; return<br> ((size_t)-ZSTD_error_dstSize_tooSmall); } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4080"><td class="num" id="LN4080">4080</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="4081"><td class="num" id="LN4081">4081</td><td class="line">        <span class='macro'>assert(iPos == srcSize)<span class='macro_popup'>((void)0)</span></span>;   <span class='comment'>/* all input is expected consumed */</span></td></tr>
<tr class="codeline" data-linenumber="4082"><td class="num" id="LN4082">4082</td><td class="line">        <span class='keyword'>return</span> oPos;</td></tr>
<tr class="codeline" data-linenumber="4083"><td class="num" id="LN4083">4083</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4084"><td class="num" id="LN4084">4084</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4085"><td class="num" id="LN4085">4085</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4086"><td class="num" id="LN4086">4086</td><td class="line"><span class='comment'>/*======   Finalize   ======*/</span></td></tr>
<tr class="codeline" data-linenumber="4087"><td class="num" id="LN4087">4087</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4088"><td class="num" id="LN4088">4088</td><td class="line"><span class='comment'>/*! ZSTD_flushStream() :</span></td></tr>
<tr class="codeline" data-linenumber="4089"><td class="num" id="LN4089">4089</td><td class="line"> <span class='comment'>* @return : amount of data remaining to flush */</span></td></tr>
<tr class="codeline" data-linenumber="4090"><td class="num" id="LN4090">4090</td><td class="line">size_t ZSTD_flushStream(ZSTD_CStream* zcs, ZSTD_outBuffer* output)</td></tr>
<tr class="codeline" data-linenumber="4091"><td class="num" id="LN4091">4091</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4092"><td class="num" id="LN4092">4092</td><td class="line">    ZSTD_inBuffer input = { <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, 0 };</td></tr>
<tr class="codeline" data-linenumber="4093"><td class="num" id="LN4093">4093</td><td class="line">    <span class='keyword'>return</span> ZSTD_compressStream2(zcs, output, &amp;input, ZSTD_e_flush);</td></tr>
<tr class="codeline" data-linenumber="4094"><td class="num" id="LN4094">4094</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4095"><td class="num" id="LN4095">4095</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4096"><td class="num" id="LN4096">4096</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4097"><td class="num" id="LN4097">4097</td><td class="line">size_t ZSTD_endStream(ZSTD_CStream* zcs, ZSTD_outBuffer* output)</td></tr>
<tr class="codeline" data-linenumber="4098"><td class="num" id="LN4098">4098</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4099"><td class="num" id="LN4099">4099</td><td class="line">    ZSTD_inBuffer input = { <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, 0 };</td></tr>
<tr class="codeline" data-linenumber="4100"><td class="num" id="LN4100">4100</td><td class="line">    size_t <span class='keyword'>const</span> remainingToFlush = ZSTD_compressStream2(zcs, output, &amp;input, ZSTD_e_end);</td></tr>
<tr class="codeline" data-linenumber="4101"><td class="num" id="LN4101">4101</td><td class="line">    <span class='macro'>FORWARD_IF_ERROR( remainingToFlush , <span class='string_literal'>"ZSTD_compressStream2 failed"</span>)<span class='macro_popup'>do { size_t const err_code = (remainingToFlush); if (ERR_isError<br>(err_code)) { {}; if (0) { _force_has_format_string("ZSTD_compressStream2 failed"<br>); }; {}; {}; return err_code; } } while(0);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4102"><td class="num" id="LN4102">4102</td><td class="line">    <span class='keyword'>if</span> (zcs-&gt;appliedParams.nbWorkers &gt; 0) <span class='keyword'>return</span> remainingToFlush;   <span class='comment'>/* minimal estimation */</span></td></tr>
<tr class="codeline" data-linenumber="4103"><td class="num" id="LN4103">4103</td><td class="line">    <span class='comment'>/* single thread mode : attempt to calculate remaining to flush more precisely */</span></td></tr>
<tr class="codeline" data-linenumber="4104"><td class="num" id="LN4104">4104</td><td class="line">    {   size_t <span class='keyword'>const</span> lastBlockSize = zcs-&gt;frameEnded ? 0 : <span class='macro'>ZSTD_BLOCKHEADERSIZE<span class='macro_popup'>3</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4105"><td class="num" id="LN4105">4105</td><td class="line">        size_t <span class='keyword'>const</span> checksumSize = (size_t)(zcs-&gt;frameEnded ? 0 : zcs-&gt;appliedParams.fParams.checksumFlag * 4);</td></tr>
<tr class="codeline" data-linenumber="4106"><td class="num" id="LN4106">4106</td><td class="line">        size_t <span class='keyword'>const</span> toFlush = remainingToFlush + lastBlockSize + checksumSize;</td></tr>
<tr class="codeline" data-linenumber="4107"><td class="num" id="LN4107">4107</td><td class="line">        <span class='macro'>DEBUGLOG(4, <span class='string_literal'>"ZSTD_endStream : remaining to flush : %u"</span>, (<span class='keyword'>unsigned</span>)toFlush)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4108"><td class="num" id="LN4108">4108</td><td class="line">        <span class='keyword'>return</span> toFlush;</td></tr>
<tr class="codeline" data-linenumber="4109"><td class="num" id="LN4109">4109</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4110"><td class="num" id="LN4110">4110</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4111"><td class="num" id="LN4111">4111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4112"><td class="num" id="LN4112">4112</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4113"><td class="num" id="LN4113">4113</td><td class="line"><span class='comment'>/*-=====  Pre-defined compression levels  =====-*/</span></td></tr>
<tr class="codeline" data-linenumber="4114"><td class="num" id="LN4114">4114</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4115"><td class="num" id="LN4115">4115</td><td class="line"><span class='directive'>#define <span class='macro'>ZSTD_MAX_CLEVEL<span class='macro_popup'>22</span></span>     22</span></td></tr>
<tr class="codeline" data-linenumber="4116"><td class="num" id="LN4116">4116</td><td class="line"><span class='keyword'>int</span> ZSTD_maxCLevel(<span class='keyword'>void</span>) { <span class='keyword'>return</span> <span class='macro'>ZSTD_MAX_CLEVEL<span class='macro_popup'>22</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="4117"><td class="num" id="LN4117">4117</td><td class="line"><span class='keyword'>int</span> ZSTD_minCLevel(<span class='keyword'>void</span>) { <span class='keyword'>return</span> (<span class='keyword'>int</span>)-<span class='macro'>ZSTD_TARGETLENGTH_MAX<span class='macro_popup'>(1&lt;&lt;17)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="4118"><td class="num" id="LN4118">4118</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4119"><td class="num" id="LN4119">4119</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> ZSTD_compressionParameters ZSTD_defaultCParameters[4][<span class='macro'>ZSTD_MAX_CLEVEL<span class='macro_popup'>22</span></span>+1] = {</td></tr>
<tr class="codeline" data-linenumber="4120"><td class="num" id="LN4120">4120</td><td class="line">{   <span class='comment'>/* "default" - for any srcSize &gt; 256 KB */</span></td></tr>
<tr class="codeline" data-linenumber="4121"><td class="num" id="LN4121">4121</td><td class="line">    <span class='comment'>/* W,  C,  H,  S,  L, TL, strat */</span></td></tr>
<tr class="codeline" data-linenumber="4122"><td class="num" id="LN4122">4122</td><td class="line">    { 19, 12, 13,  1,  6,  1, ZSTD_fast    },  <span class='comment'>/* base for negative levels */</span></td></tr>
<tr class="codeline" data-linenumber="4123"><td class="num" id="LN4123">4123</td><td class="line">    { 19, 13, 14,  1,  7,  0, ZSTD_fast    },  <span class='comment'>/* level  1 */</span></td></tr>
<tr class="codeline" data-linenumber="4124"><td class="num" id="LN4124">4124</td><td class="line">    { 20, 15, 16,  1,  6,  0, ZSTD_fast    },  <span class='comment'>/* level  2 */</span></td></tr>
<tr class="codeline" data-linenumber="4125"><td class="num" id="LN4125">4125</td><td class="line">    { 21, 16, 17,  1,  5,  0, ZSTD_dfast   },  <span class='comment'>/* level  3 */</span></td></tr>
<tr class="codeline" data-linenumber="4126"><td class="num" id="LN4126">4126</td><td class="line">    { 21, 18, 18,  1,  5,  0, ZSTD_dfast   },  <span class='comment'>/* level  4 */</span></td></tr>
<tr class="codeline" data-linenumber="4127"><td class="num" id="LN4127">4127</td><td class="line">    { 21, 18, 19,  2,  5,  2, ZSTD_greedy  },  <span class='comment'>/* level  5 */</span></td></tr>
<tr class="codeline" data-linenumber="4128"><td class="num" id="LN4128">4128</td><td class="line">    { 21, 19, 19,  3,  5,  4, ZSTD_greedy  },  <span class='comment'>/* level  6 */</span></td></tr>
<tr class="codeline" data-linenumber="4129"><td class="num" id="LN4129">4129</td><td class="line">    { 21, 19, 19,  3,  5,  8, ZSTD_lazy    },  <span class='comment'>/* level  7 */</span></td></tr>
<tr class="codeline" data-linenumber="4130"><td class="num" id="LN4130">4130</td><td class="line">    { 21, 19, 19,  3,  5, 16, ZSTD_lazy2   },  <span class='comment'>/* level  8 */</span></td></tr>
<tr class="codeline" data-linenumber="4131"><td class="num" id="LN4131">4131</td><td class="line">    { 21, 19, 20,  4,  5, 16, ZSTD_lazy2   },  <span class='comment'>/* level  9 */</span></td></tr>
<tr class="codeline" data-linenumber="4132"><td class="num" id="LN4132">4132</td><td class="line">    { 22, 20, 21,  4,  5, 16, ZSTD_lazy2   },  <span class='comment'>/* level 10 */</span></td></tr>
<tr class="codeline" data-linenumber="4133"><td class="num" id="LN4133">4133</td><td class="line">    { 22, 21, 22,  4,  5, 16, ZSTD_lazy2   },  <span class='comment'>/* level 11 */</span></td></tr>
<tr class="codeline" data-linenumber="4134"><td class="num" id="LN4134">4134</td><td class="line">    { 22, 21, 22,  5,  5, 16, ZSTD_lazy2   },  <span class='comment'>/* level 12 */</span></td></tr>
<tr class="codeline" data-linenumber="4135"><td class="num" id="LN4135">4135</td><td class="line">    { 22, 21, 22,  5,  5, 32, ZSTD_btlazy2 },  <span class='comment'>/* level 13 */</span></td></tr>
<tr class="codeline" data-linenumber="4136"><td class="num" id="LN4136">4136</td><td class="line">    { 22, 22, 23,  5,  5, 32, ZSTD_btlazy2 },  <span class='comment'>/* level 14 */</span></td></tr>
<tr class="codeline" data-linenumber="4137"><td class="num" id="LN4137">4137</td><td class="line">    { 22, 23, 23,  6,  5, 32, ZSTD_btlazy2 },  <span class='comment'>/* level 15 */</span></td></tr>
<tr class="codeline" data-linenumber="4138"><td class="num" id="LN4138">4138</td><td class="line">    { 22, 22, 22,  5,  5, 48, ZSTD_btopt   },  <span class='comment'>/* level 16 */</span></td></tr>
<tr class="codeline" data-linenumber="4139"><td class="num" id="LN4139">4139</td><td class="line">    { 23, 23, 22,  5,  4, 64, ZSTD_btopt   },  <span class='comment'>/* level 17 */</span></td></tr>
<tr class="codeline" data-linenumber="4140"><td class="num" id="LN4140">4140</td><td class="line">    { 23, 23, 22,  6,  3, 64, ZSTD_btultra },  <span class='comment'>/* level 18 */</span></td></tr>
<tr class="codeline" data-linenumber="4141"><td class="num" id="LN4141">4141</td><td class="line">    { 23, 24, 22,  7,  3,256, ZSTD_btultra2},  <span class='comment'>/* level 19 */</span></td></tr>
<tr class="codeline" data-linenumber="4142"><td class="num" id="LN4142">4142</td><td class="line">    { 25, 25, 23,  7,  3,256, ZSTD_btultra2},  <span class='comment'>/* level 20 */</span></td></tr>
<tr class="codeline" data-linenumber="4143"><td class="num" id="LN4143">4143</td><td class="line">    { 26, 26, 24,  7,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 21 */</span></td></tr>
<tr class="codeline" data-linenumber="4144"><td class="num" id="LN4144">4144</td><td class="line">    { 27, 27, 25,  9,  3,999, ZSTD_btultra2},  <span class='comment'>/* level 22 */</span></td></tr>
<tr class="codeline" data-linenumber="4145"><td class="num" id="LN4145">4145</td><td class="line">},</td></tr>
<tr class="codeline" data-linenumber="4146"><td class="num" id="LN4146">4146</td><td class="line">{   <span class='comment'>/* for srcSize &lt;= 256 KB */</span></td></tr>
<tr class="codeline" data-linenumber="4147"><td class="num" id="LN4147">4147</td><td class="line">    <span class='comment'>/* W,  C,  H,  S,  L,  T, strat */</span></td></tr>
<tr class="codeline" data-linenumber="4148"><td class="num" id="LN4148">4148</td><td class="line">    { 18, 12, 13,  1,  5,  1, ZSTD_fast    },  <span class='comment'>/* base for negative levels */</span></td></tr>
<tr class="codeline" data-linenumber="4149"><td class="num" id="LN4149">4149</td><td class="line">    { 18, 13, 14,  1,  6,  0, ZSTD_fast    },  <span class='comment'>/* level  1 */</span></td></tr>
<tr class="codeline" data-linenumber="4150"><td class="num" id="LN4150">4150</td><td class="line">    { 18, 14, 14,  1,  5,  0, ZSTD_dfast   },  <span class='comment'>/* level  2 */</span></td></tr>
<tr class="codeline" data-linenumber="4151"><td class="num" id="LN4151">4151</td><td class="line">    { 18, 16, 16,  1,  4,  0, ZSTD_dfast   },  <span class='comment'>/* level  3 */</span></td></tr>
<tr class="codeline" data-linenumber="4152"><td class="num" id="LN4152">4152</td><td class="line">    { 18, 16, 17,  2,  5,  2, ZSTD_greedy  },  <span class='comment'>/* level  4.*/</span></td></tr>
<tr class="codeline" data-linenumber="4153"><td class="num" id="LN4153">4153</td><td class="line">    { 18, 18, 18,  3,  5,  2, ZSTD_greedy  },  <span class='comment'>/* level  5.*/</span></td></tr>
<tr class="codeline" data-linenumber="4154"><td class="num" id="LN4154">4154</td><td class="line">    { 18, 18, 19,  3,  5,  4, ZSTD_lazy    },  <span class='comment'>/* level  6.*/</span></td></tr>
<tr class="codeline" data-linenumber="4155"><td class="num" id="LN4155">4155</td><td class="line">    { 18, 18, 19,  4,  4,  4, ZSTD_lazy    },  <span class='comment'>/* level  7 */</span></td></tr>
<tr class="codeline" data-linenumber="4156"><td class="num" id="LN4156">4156</td><td class="line">    { 18, 18, 19,  4,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  8 */</span></td></tr>
<tr class="codeline" data-linenumber="4157"><td class="num" id="LN4157">4157</td><td class="line">    { 18, 18, 19,  5,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  9 */</span></td></tr>
<tr class="codeline" data-linenumber="4158"><td class="num" id="LN4158">4158</td><td class="line">    { 18, 18, 19,  6,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level 10 */</span></td></tr>
<tr class="codeline" data-linenumber="4159"><td class="num" id="LN4159">4159</td><td class="line">    { 18, 18, 19,  5,  4, 12, ZSTD_btlazy2 },  <span class='comment'>/* level 11.*/</span></td></tr>
<tr class="codeline" data-linenumber="4160"><td class="num" id="LN4160">4160</td><td class="line">    { 18, 19, 19,  7,  4, 12, ZSTD_btlazy2 },  <span class='comment'>/* level 12.*/</span></td></tr>
<tr class="codeline" data-linenumber="4161"><td class="num" id="LN4161">4161</td><td class="line">    { 18, 18, 19,  4,  4, 16, ZSTD_btopt   },  <span class='comment'>/* level 13 */</span></td></tr>
<tr class="codeline" data-linenumber="4162"><td class="num" id="LN4162">4162</td><td class="line">    { 18, 18, 19,  4,  3, 32, ZSTD_btopt   },  <span class='comment'>/* level 14.*/</span></td></tr>
<tr class="codeline" data-linenumber="4163"><td class="num" id="LN4163">4163</td><td class="line">    { 18, 18, 19,  6,  3,128, ZSTD_btopt   },  <span class='comment'>/* level 15.*/</span></td></tr>
<tr class="codeline" data-linenumber="4164"><td class="num" id="LN4164">4164</td><td class="line">    { 18, 19, 19,  6,  3,128, ZSTD_btultra },  <span class='comment'>/* level 16.*/</span></td></tr>
<tr class="codeline" data-linenumber="4165"><td class="num" id="LN4165">4165</td><td class="line">    { 18, 19, 19,  8,  3,256, ZSTD_btultra },  <span class='comment'>/* level 17.*/</span></td></tr>
<tr class="codeline" data-linenumber="4166"><td class="num" id="LN4166">4166</td><td class="line">    { 18, 19, 19,  6,  3,128, ZSTD_btultra2},  <span class='comment'>/* level 18.*/</span></td></tr>
<tr class="codeline" data-linenumber="4167"><td class="num" id="LN4167">4167</td><td class="line">    { 18, 19, 19,  8,  3,256, ZSTD_btultra2},  <span class='comment'>/* level 19.*/</span></td></tr>
<tr class="codeline" data-linenumber="4168"><td class="num" id="LN4168">4168</td><td class="line">    { 18, 19, 19, 10,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 20.*/</span></td></tr>
<tr class="codeline" data-linenumber="4169"><td class="num" id="LN4169">4169</td><td class="line">    { 18, 19, 19, 12,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 21.*/</span></td></tr>
<tr class="codeline" data-linenumber="4170"><td class="num" id="LN4170">4170</td><td class="line">    { 18, 19, 19, 13,  3,999, ZSTD_btultra2},  <span class='comment'>/* level 22.*/</span></td></tr>
<tr class="codeline" data-linenumber="4171"><td class="num" id="LN4171">4171</td><td class="line">},</td></tr>
<tr class="codeline" data-linenumber="4172"><td class="num" id="LN4172">4172</td><td class="line">{   <span class='comment'>/* for srcSize &lt;= 128 KB */</span></td></tr>
<tr class="codeline" data-linenumber="4173"><td class="num" id="LN4173">4173</td><td class="line">    <span class='comment'>/* W,  C,  H,  S,  L,  T, strat */</span></td></tr>
<tr class="codeline" data-linenumber="4174"><td class="num" id="LN4174">4174</td><td class="line">    { 17, 12, 12,  1,  5,  1, ZSTD_fast    },  <span class='comment'>/* base for negative levels */</span></td></tr>
<tr class="codeline" data-linenumber="4175"><td class="num" id="LN4175">4175</td><td class="line">    { 17, 12, 13,  1,  6,  0, ZSTD_fast    },  <span class='comment'>/* level  1 */</span></td></tr>
<tr class="codeline" data-linenumber="4176"><td class="num" id="LN4176">4176</td><td class="line">    { 17, 13, 15,  1,  5,  0, ZSTD_fast    },  <span class='comment'>/* level  2 */</span></td></tr>
<tr class="codeline" data-linenumber="4177"><td class="num" id="LN4177">4177</td><td class="line">    { 17, 15, 16,  2,  5,  0, ZSTD_dfast   },  <span class='comment'>/* level  3 */</span></td></tr>
<tr class="codeline" data-linenumber="4178"><td class="num" id="LN4178">4178</td><td class="line">    { 17, 17, 17,  2,  4,  0, ZSTD_dfast   },  <span class='comment'>/* level  4 */</span></td></tr>
<tr class="codeline" data-linenumber="4179"><td class="num" id="LN4179">4179</td><td class="line">    { 17, 16, 17,  3,  4,  2, ZSTD_greedy  },  <span class='comment'>/* level  5 */</span></td></tr>
<tr class="codeline" data-linenumber="4180"><td class="num" id="LN4180">4180</td><td class="line">    { 17, 17, 17,  3,  4,  4, ZSTD_lazy    },  <span class='comment'>/* level  6 */</span></td></tr>
<tr class="codeline" data-linenumber="4181"><td class="num" id="LN4181">4181</td><td class="line">    { 17, 17, 17,  3,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  7 */</span></td></tr>
<tr class="codeline" data-linenumber="4182"><td class="num" id="LN4182">4182</td><td class="line">    { 17, 17, 17,  4,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  8 */</span></td></tr>
<tr class="codeline" data-linenumber="4183"><td class="num" id="LN4183">4183</td><td class="line">    { 17, 17, 17,  5,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  9 */</span></td></tr>
<tr class="codeline" data-linenumber="4184"><td class="num" id="LN4184">4184</td><td class="line">    { 17, 17, 17,  6,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level 10 */</span></td></tr>
<tr class="codeline" data-linenumber="4185"><td class="num" id="LN4185">4185</td><td class="line">    { 17, 17, 17,  5,  4,  8, ZSTD_btlazy2 },  <span class='comment'>/* level 11 */</span></td></tr>
<tr class="codeline" data-linenumber="4186"><td class="num" id="LN4186">4186</td><td class="line">    { 17, 18, 17,  7,  4, 12, ZSTD_btlazy2 },  <span class='comment'>/* level 12 */</span></td></tr>
<tr class="codeline" data-linenumber="4187"><td class="num" id="LN4187">4187</td><td class="line">    { 17, 18, 17,  3,  4, 12, ZSTD_btopt   },  <span class='comment'>/* level 13.*/</span></td></tr>
<tr class="codeline" data-linenumber="4188"><td class="num" id="LN4188">4188</td><td class="line">    { 17, 18, 17,  4,  3, 32, ZSTD_btopt   },  <span class='comment'>/* level 14.*/</span></td></tr>
<tr class="codeline" data-linenumber="4189"><td class="num" id="LN4189">4189</td><td class="line">    { 17, 18, 17,  6,  3,256, ZSTD_btopt   },  <span class='comment'>/* level 15.*/</span></td></tr>
<tr class="codeline" data-linenumber="4190"><td class="num" id="LN4190">4190</td><td class="line">    { 17, 18, 17,  6,  3,128, ZSTD_btultra },  <span class='comment'>/* level 16.*/</span></td></tr>
<tr class="codeline" data-linenumber="4191"><td class="num" id="LN4191">4191</td><td class="line">    { 17, 18, 17,  8,  3,256, ZSTD_btultra },  <span class='comment'>/* level 17.*/</span></td></tr>
<tr class="codeline" data-linenumber="4192"><td class="num" id="LN4192">4192</td><td class="line">    { 17, 18, 17, 10,  3,512, ZSTD_btultra },  <span class='comment'>/* level 18.*/</span></td></tr>
<tr class="codeline" data-linenumber="4193"><td class="num" id="LN4193">4193</td><td class="line">    { 17, 18, 17,  5,  3,256, ZSTD_btultra2},  <span class='comment'>/* level 19.*/</span></td></tr>
<tr class="codeline" data-linenumber="4194"><td class="num" id="LN4194">4194</td><td class="line">    { 17, 18, 17,  7,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 20.*/</span></td></tr>
<tr class="codeline" data-linenumber="4195"><td class="num" id="LN4195">4195</td><td class="line">    { 17, 18, 17,  9,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 21.*/</span></td></tr>
<tr class="codeline" data-linenumber="4196"><td class="num" id="LN4196">4196</td><td class="line">    { 17, 18, 17, 11,  3,999, ZSTD_btultra2},  <span class='comment'>/* level 22.*/</span></td></tr>
<tr class="codeline" data-linenumber="4197"><td class="num" id="LN4197">4197</td><td class="line">},</td></tr>
<tr class="codeline" data-linenumber="4198"><td class="num" id="LN4198">4198</td><td class="line">{   <span class='comment'>/* for srcSize &lt;= 16 KB */</span></td></tr>
<tr class="codeline" data-linenumber="4199"><td class="num" id="LN4199">4199</td><td class="line">    <span class='comment'>/* W,  C,  H,  S,  L,  T, strat */</span></td></tr>
<tr class="codeline" data-linenumber="4200"><td class="num" id="LN4200">4200</td><td class="line">    { 14, 12, 13,  1,  5,  1, ZSTD_fast    },  <span class='comment'>/* base for negative levels */</span></td></tr>
<tr class="codeline" data-linenumber="4201"><td class="num" id="LN4201">4201</td><td class="line">    { 14, 14, 15,  1,  5,  0, ZSTD_fast    },  <span class='comment'>/* level  1 */</span></td></tr>
<tr class="codeline" data-linenumber="4202"><td class="num" id="LN4202">4202</td><td class="line">    { 14, 14, 15,  1,  4,  0, ZSTD_fast    },  <span class='comment'>/* level  2 */</span></td></tr>
<tr class="codeline" data-linenumber="4203"><td class="num" id="LN4203">4203</td><td class="line">    { 14, 14, 15,  2,  4,  0, ZSTD_dfast   },  <span class='comment'>/* level  3 */</span></td></tr>
<tr class="codeline" data-linenumber="4204"><td class="num" id="LN4204">4204</td><td class="line">    { 14, 14, 14,  4,  4,  2, ZSTD_greedy  },  <span class='comment'>/* level  4 */</span></td></tr>
<tr class="codeline" data-linenumber="4205"><td class="num" id="LN4205">4205</td><td class="line">    { 14, 14, 14,  3,  4,  4, ZSTD_lazy    },  <span class='comment'>/* level  5.*/</span></td></tr>
<tr class="codeline" data-linenumber="4206"><td class="num" id="LN4206">4206</td><td class="line">    { 14, 14, 14,  4,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  6 */</span></td></tr>
<tr class="codeline" data-linenumber="4207"><td class="num" id="LN4207">4207</td><td class="line">    { 14, 14, 14,  6,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  7 */</span></td></tr>
<tr class="codeline" data-linenumber="4208"><td class="num" id="LN4208">4208</td><td class="line">    { 14, 14, 14,  8,  4,  8, ZSTD_lazy2   },  <span class='comment'>/* level  8.*/</span></td></tr>
<tr class="codeline" data-linenumber="4209"><td class="num" id="LN4209">4209</td><td class="line">    { 14, 15, 14,  5,  4,  8, ZSTD_btlazy2 },  <span class='comment'>/* level  9.*/</span></td></tr>
<tr class="codeline" data-linenumber="4210"><td class="num" id="LN4210">4210</td><td class="line">    { 14, 15, 14,  9,  4,  8, ZSTD_btlazy2 },  <span class='comment'>/* level 10.*/</span></td></tr>
<tr class="codeline" data-linenumber="4211"><td class="num" id="LN4211">4211</td><td class="line">    { 14, 15, 14,  3,  4, 12, ZSTD_btopt   },  <span class='comment'>/* level 11.*/</span></td></tr>
<tr class="codeline" data-linenumber="4212"><td class="num" id="LN4212">4212</td><td class="line">    { 14, 15, 14,  4,  3, 24, ZSTD_btopt   },  <span class='comment'>/* level 12.*/</span></td></tr>
<tr class="codeline" data-linenumber="4213"><td class="num" id="LN4213">4213</td><td class="line">    { 14, 15, 14,  5,  3, 32, ZSTD_btultra },  <span class='comment'>/* level 13.*/</span></td></tr>
<tr class="codeline" data-linenumber="4214"><td class="num" id="LN4214">4214</td><td class="line">    { 14, 15, 15,  6,  3, 64, ZSTD_btultra },  <span class='comment'>/* level 14.*/</span></td></tr>
<tr class="codeline" data-linenumber="4215"><td class="num" id="LN4215">4215</td><td class="line">    { 14, 15, 15,  7,  3,256, ZSTD_btultra },  <span class='comment'>/* level 15.*/</span></td></tr>
<tr class="codeline" data-linenumber="4216"><td class="num" id="LN4216">4216</td><td class="line">    { 14, 15, 15,  5,  3, 48, ZSTD_btultra2},  <span class='comment'>/* level 16.*/</span></td></tr>
<tr class="codeline" data-linenumber="4217"><td class="num" id="LN4217">4217</td><td class="line">    { 14, 15, 15,  6,  3,128, ZSTD_btultra2},  <span class='comment'>/* level 17.*/</span></td></tr>
<tr class="codeline" data-linenumber="4218"><td class="num" id="LN4218">4218</td><td class="line">    { 14, 15, 15,  7,  3,256, ZSTD_btultra2},  <span class='comment'>/* level 18.*/</span></td></tr>
<tr class="codeline" data-linenumber="4219"><td class="num" id="LN4219">4219</td><td class="line">    { 14, 15, 15,  8,  3,256, ZSTD_btultra2},  <span class='comment'>/* level 19.*/</span></td></tr>
<tr class="codeline" data-linenumber="4220"><td class="num" id="LN4220">4220</td><td class="line">    { 14, 15, 15,  8,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 20.*/</span></td></tr>
<tr class="codeline" data-linenumber="4221"><td class="num" id="LN4221">4221</td><td class="line">    { 14, 15, 15,  9,  3,512, ZSTD_btultra2},  <span class='comment'>/* level 21.*/</span></td></tr>
<tr class="codeline" data-linenumber="4222"><td class="num" id="LN4222">4222</td><td class="line">    { 14, 15, 15, 10,  3,999, ZSTD_btultra2},  <span class='comment'>/* level 22.*/</span></td></tr>
<tr class="codeline" data-linenumber="4223"><td class="num" id="LN4223">4223</td><td class="line">},</td></tr>
<tr class="codeline" data-linenumber="4224"><td class="num" id="LN4224">4224</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="4225"><td class="num" id="LN4225">4225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4226"><td class="num" id="LN4226">4226</td><td class="line"><span class='comment'>/*! ZSTD_getCParams_internal() :</span></td></tr>
<tr class="codeline" data-linenumber="4227"><td class="num" id="LN4227">4227</td><td class="line"> <span class='comment'>* @return ZSTD_compressionParameters structure for a selected compression level, srcSize and dictSize.</span></td></tr>
<tr class="codeline" data-linenumber="4228"><td class="num" id="LN4228">4228</td><td class="line"> <span class='comment'>*  Note: srcSizeHint 0 means 0, use ZSTD_CONTENTSIZE_UNKNOWN for unknown.</span></td></tr>
<tr class="codeline" data-linenumber="4229"><td class="num" id="LN4229">4229</td><td class="line"> <span class='comment'>*        Use dictSize == 0 for unknown or unused. */</span></td></tr>
<tr class="codeline" data-linenumber="4230"><td class="num" id="LN4230">4230</td><td class="line"><span class='keyword'>static</span> ZSTD_compressionParameters ZSTD_getCParams_internal(<span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSizeHint, size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="4231"><td class="num" id="LN4231">4231</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4232"><td class="num" id="LN4232">4232</td><td class="line">    <span class='keyword'>int</span> <span class='keyword'>const</span> unknown = srcSizeHint == <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4233"><td class="num" id="LN4233">4233</td><td class="line">    size_t <span class='keyword'>const</span> addedSize = unknown &amp;&amp; dictSize &gt; 0 ? 500 : 0;</td></tr>
<tr class="codeline" data-linenumber="4234"><td class="num" id="LN4234">4234</td><td class="line">    U64 <span class='keyword'>const</span> rSize = unknown &amp;&amp; dictSize == 0 ? <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span> : srcSizeHint+dictSize+addedSize;</td></tr>
<tr class="codeline" data-linenumber="4235"><td class="num" id="LN4235">4235</td><td class="line">    U32 <span class='keyword'>const</span> tableID = (rSize &lt;= 256 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>) + (rSize &lt;= 128 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>) + (rSize &lt;= 16 <span class='macro'>KB<span class='macro_popup'>*(1 &lt;&lt;10)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4236"><td class="num" id="LN4236">4236</td><td class="line">    <span class='keyword'>int</span> row = compressionLevel;</td></tr>
<tr class="codeline" data-linenumber="4237"><td class="num" id="LN4237">4237</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_getCParams_internal (cLevel=%i)"</span>, compressionLevel)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4238"><td class="num" id="LN4238">4238</td><td class="line">    <span class='keyword'>if</span> (compressionLevel == 0) row = <span class='macro'>ZSTD_CLEVEL_DEFAULT<span class='macro_popup'>3</span></span>;   <span class='comment'>/* 0 == default */</span></td></tr>
<tr class="codeline" data-linenumber="4239"><td class="num" id="LN4239">4239</td><td class="line">    <span class='keyword'>if</span> (compressionLevel &lt; 0) row = 0;   <span class='comment'>/* entry 0 is baseline for fast mode */</span></td></tr>
<tr class="codeline" data-linenumber="4240"><td class="num" id="LN4240">4240</td><td class="line">    <span class='keyword'>if</span> (compressionLevel &gt; <span class='macro'>ZSTD_MAX_CLEVEL<span class='macro_popup'>22</span></span>) row = <span class='macro'>ZSTD_MAX_CLEVEL<span class='macro_popup'>22</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4241"><td class="num" id="LN4241">4241</td><td class="line">    {   ZSTD_compressionParameters cp = ZSTD_defaultCParameters[tableID][row];</td></tr>
<tr class="codeline" data-linenumber="4242"><td class="num" id="LN4242">4242</td><td class="line">        <span class='keyword'>if</span> (compressionLevel &lt; 0) cp.targetLength = (<span class='keyword'>unsigned</span>)(-compressionLevel);   <span class='comment'>/* acceleration factor */</span></td></tr>
<tr class="codeline" data-linenumber="4243"><td class="num" id="LN4243">4243</td><td class="line">        <span class='comment'>/* refine parameters based on srcSize &amp; dictSize */</span></td></tr>
<tr class="codeline" data-linenumber="4244"><td class="num" id="LN4244">4244</td><td class="line">        <span class='keyword'>return</span> ZSTD_adjustCParams_internal(cp, srcSizeHint, dictSize);</td></tr>
<tr class="codeline" data-linenumber="4245"><td class="num" id="LN4245">4245</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4246"><td class="num" id="LN4246">4246</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4247"><td class="num" id="LN4247">4247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4248"><td class="num" id="LN4248">4248</td><td class="line"><span class='comment'>/*! ZSTD_getCParams() :</span></td></tr>
<tr class="codeline" data-linenumber="4249"><td class="num" id="LN4249">4249</td><td class="line"> <span class='comment'>* @return ZSTD_compressionParameters structure for a selected compression level, srcSize and dictSize.</span></td></tr>
<tr class="codeline" data-linenumber="4250"><td class="num" id="LN4250">4250</td><td class="line"> <span class='comment'>*  Size values are optional, provide 0 if not known or unused */</span></td></tr>
<tr class="codeline" data-linenumber="4251"><td class="num" id="LN4251">4251</td><td class="line">ZSTD_compressionParameters ZSTD_getCParams(<span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSizeHint, size_t dictSize)</td></tr>
<tr class="codeline" data-linenumber="4252"><td class="num" id="LN4252">4252</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4253"><td class="num" id="LN4253">4253</td><td class="line">    <span class='keyword'>if</span> (srcSizeHint == 0) srcSizeHint = <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4254"><td class="num" id="LN4254">4254</td><td class="line">    <span class='keyword'>return</span> ZSTD_getCParams_internal(compressionLevel, srcSizeHint, dictSize);</td></tr>
<tr class="codeline" data-linenumber="4255"><td class="num" id="LN4255">4255</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4256"><td class="num" id="LN4256">4256</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4257"><td class="num" id="LN4257">4257</td><td class="line"><span class='comment'>/*! ZSTD_getParams() :</span></td></tr>
<tr class="codeline" data-linenumber="4258"><td class="num" id="LN4258">4258</td><td class="line"> <span class='comment'>*  same idea as ZSTD_getCParams()</span></td></tr>
<tr class="codeline" data-linenumber="4259"><td class="num" id="LN4259">4259</td><td class="line"> <span class='comment'>* @return a `ZSTD_parameters` structure (instead of `ZSTD_compressionParameters`).</span></td></tr>
<tr class="codeline" data-linenumber="4260"><td class="num" id="LN4260">4260</td><td class="line"> <span class='comment'>*  Fields of `ZSTD_frameParameters` are set to default values */</span></td></tr>
<tr class="codeline" data-linenumber="4261"><td class="num" id="LN4261">4261</td><td class="line"><span class='keyword'>static</span> ZSTD_parameters ZSTD_getParams_internal(<span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSizeHint, size_t dictSize) {</td></tr>
<tr class="codeline" data-linenumber="4262"><td class="num" id="LN4262">4262</td><td class="line">    ZSTD_parameters params;</td></tr>
<tr class="codeline" data-linenumber="4263"><td class="num" id="LN4263">4263</td><td class="line">    ZSTD_compressionParameters <span class='keyword'>const</span> cParams = ZSTD_getCParams_internal(compressionLevel, srcSizeHint, dictSize);</td></tr>
<tr class="codeline" data-linenumber="4264"><td class="num" id="LN4264">4264</td><td class="line">    <span class='macro'>DEBUGLOG(5, <span class='string_literal'>"ZSTD_getParams (cLevel=%i)"</span>, compressionLevel)<span class='macro_popup'>{}</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4265"><td class="num" id="LN4265">4265</td><td class="line">    memset(&amp;params, 0, <span class='keyword'>sizeof</span>(params));</td></tr>
<tr class="codeline" data-linenumber="4266"><td class="num" id="LN4266">4266</td><td class="line">    params.cParams = cParams;</td></tr>
<tr class="codeline" data-linenumber="4267"><td class="num" id="LN4267">4267</td><td class="line">    params.fParams.contentSizeFlag = 1;</td></tr>
<tr class="codeline" data-linenumber="4268"><td class="num" id="LN4268">4268</td><td class="line">    <span class='keyword'>return</span> params;</td></tr>
<tr class="codeline" data-linenumber="4269"><td class="num" id="LN4269">4269</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4270"><td class="num" id="LN4270">4270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4271"><td class="num" id="LN4271">4271</td><td class="line"><span class='comment'>/*! ZSTD_getParams() :</span></td></tr>
<tr class="codeline" data-linenumber="4272"><td class="num" id="LN4272">4272</td><td class="line"> <span class='comment'>*  same idea as ZSTD_getCParams()</span></td></tr>
<tr class="codeline" data-linenumber="4273"><td class="num" id="LN4273">4273</td><td class="line"> <span class='comment'>* @return a `ZSTD_parameters` structure (instead of `ZSTD_compressionParameters`).</span></td></tr>
<tr class="codeline" data-linenumber="4274"><td class="num" id="LN4274">4274</td><td class="line"> <span class='comment'>*  Fields of `ZSTD_frameParameters` are set to default values */</span></td></tr>
<tr class="codeline" data-linenumber="4275"><td class="num" id="LN4275">4275</td><td class="line">ZSTD_parameters ZSTD_getParams(<span class='keyword'>int</span> compressionLevel, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> srcSizeHint, size_t dictSize) {</td></tr>
<tr class="codeline" data-linenumber="4276"><td class="num" id="LN4276">4276</td><td class="line">    <span class='keyword'>if</span> (srcSizeHint == 0) srcSizeHint = <span class='macro'>ZSTD_CONTENTSIZE_UNKNOWN<span class='macro_popup'>(0ULL - 1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4277"><td class="num" id="LN4277">4277</td><td class="line">    <span class='keyword'>return</span> ZSTD_getParams_internal(compressionLevel, srcSizeHint, dictSize);</td></tr>
<tr class="codeline" data-linenumber="4278"><td class="num" id="LN4278">4278</td><td class="line">}</td></tr>
</table></body></html>
