
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - [project name]: /tmp/sslab_clang/c_git/git/connected.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> connected.c</p>
<a href="135.html#line-0"> toomanyconfigs 0</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cp">#include</span> <span class="cpf">&quot;cache.h&quot;</span><span class="cp"></span>
<a name="line-2"></a><span class="cp">#include</span> <span class="cpf">&quot;object-store.h&quot;</span><span class="cp"></span>
<a name="line-3"></a><span class="cp">#include</span> <span class="cpf">&quot;run-command.h&quot;</span><span class="cp"></span>
<a name="line-4"></a><span class="cp">#include</span> <span class="cpf">&quot;sigchain.h&quot;</span><span class="cp"></span>
<a name="line-5"></a><span class="cp">#include</span> <span class="cpf">&quot;connected.h&quot;</span><span class="cp"></span>
<a name="line-6"></a><span class="cp">#include</span> <span class="cpf">&quot;transport.h&quot;</span><span class="cp"></span>
<a name="line-7"></a><span class="cp">#include</span> <span class="cpf">&quot;packfile.h&quot;</span><span class="cp"></span>
<a name="line-8"></a><span class="cp">#include</span> <span class="cpf">&quot;promisor-remote.h&quot;</span><span class="cp"></span>
<a name="line-9"></a>
<a name="line-10"></a><span class="cm">/*</span>
<a name="line-11"></a><span class="cm"> * If we feed all the commits we want to verify to this command</span>
<a name="line-12"></a><span class="cm"> *</span>
<a name="line-13"></a><span class="cm"> *  $ git rev-list --objects --stdin --not --all</span>
<a name="line-14"></a><span class="cm"> *</span>
<a name="line-15"></a><span class="cm"> * and if it does not error out, that means everything reachable from</span>
<a name="line-16"></a><span class="cm"> * these commits locally exists and is connected to our existing refs.</span>
<a name="line-17"></a><span class="cm"> * Note that this does _not_ validate the individual objects.</span>
<a name="line-18"></a><span class="cm"> *</span>
<a name="line-19"></a><span class="cm"> * Returns 0 if everything is connected, non-zero otherwise.</span>
<a name="line-20"></a><span class="cm"> */</span>
<a name="line-21"></a><span class="kt">int</span> <span class="nf">check_connected</span><span class="p">(</span><span class="n">oid_iterate_fn</span> <span class="n">fn</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">cb_data</span><span class="p">,</span>
<a name="line-22"></a>		    <span class="k">struct</span> <span class="n">check_connected_options</span> <span class="o">*</span><span class="n">opt</span><span class="p">)</span>
<a name="line-23"></a><span class="p">{</span>
<a name="line-24"></a>	<span class="k">struct</span> <span class="n">child_process</span> <span class="n">rev_list</span> <span class="o">=</span> <span class="n">CHILD_PROCESS_INIT</span><span class="p">;</span>
<a name="line-25"></a>	<span class="kt">FILE</span> <span class="o">*</span><span class="n">rev_list_in</span><span class="p">;</span>
<a name="line-26"></a>	<span class="k">struct</span> <span class="n">check_connected_options</span> <span class="n">defaults</span> <span class="o">=</span> <span class="n">CHECK_CONNECTED_INIT</span><span class="p">;</span>
<a name="line-27"></a>	<span class="k">struct</span> <span class="n">object_id</span> <span class="n">oid</span><span class="p">;</span>
<a name="line-28"></a>	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-29"></a>	<span class="k">struct</span> <span class="n">packed_git</span> <span class="o">*</span><span class="n">new_pack</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-30"></a>	<span class="k">struct</span> <span class="n">transport</span> <span class="o">*</span><span class="n">transport</span><span class="p">;</span>
<a name="line-31"></a>	<span class="kt">size_t</span> <span class="n">base_len</span><span class="p">;</span>
<a name="line-32"></a>
<a name="line-33"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">opt</span><span class="p">)</span>
<a name="line-34"></a>		<span class="n">opt</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">defaults</span><span class="p">;</span>
<a name="line-35"></a>	<span class="n">transport</span> <span class="o">=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">transport</span><span class="p">;</span>
<a name="line-36"></a>
<a name="line-37"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">cb_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">))</span> <span class="p">{</span>
<a name="line-38"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">err_fd</span><span class="p">)</span>
<a name="line-39"></a>			<span class="n">close</span><span class="p">(</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">err_fd</span><span class="p">);</span>
<a name="line-40"></a>		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<a name="line-41"></a>	<span class="p">}</span>
<a name="line-42"></a>
<a name="line-43"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">transport</span> <span class="o">&amp;&amp;</span> <span class="n">transport</span><span class="o">-&gt;</span><span class="n">smart_options</span> <span class="o">&amp;&amp;</span>
<a name="line-44"></a>	    <span class="n">transport</span><span class="o">-&gt;</span><span class="n">smart_options</span><span class="o">-&gt;</span><span class="n">self_contained_and_connected</span> <span class="o">&amp;&amp;</span>
<a name="line-45"></a>	    <span class="n">transport</span><span class="o">-&gt;</span><span class="n">pack_lockfiles</span><span class="p">.</span><span class="n">nr</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
<a name="line-46"></a>	    <span class="n">strip_suffix</span><span class="p">(</span><span class="n">transport</span><span class="o">-&gt;</span><span class="n">pack_lockfiles</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">string</span><span class="p">,</span>
<a name="line-47"></a>			 <span class="s">&quot;.keep&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">base_len</span><span class="p">))</span> <span class="p">{</span>
<a name="line-48"></a>		<span class="k">struct</span> <span class="n">strbuf</span> <span class="n">idx_file</span> <span class="o">=</span> <span class="n">STRBUF_INIT</span><span class="p">;</span>
<a name="line-49"></a>		<span class="n">strbuf_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">idx_file</span><span class="p">,</span> <span class="n">transport</span><span class="o">-&gt;</span><span class="n">pack_lockfiles</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">string</span><span class="p">,</span>
<a name="line-50"></a>			   <span class="n">base_len</span><span class="p">);</span>
<a name="line-51"></a>		<span class="n">strbuf_addstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">idx_file</span><span class="p">,</span> <span class="s">&quot;.idx&quot;</span><span class="p">);</span>
<a name="line-52"></a>		<span class="n">new_pack</span> <span class="o">=</span> <span class="n">add_packed_git</span><span class="p">(</span><span class="n">idx_file</span><span class="p">.</span><span class="n">buf</span><span class="p">,</span> <span class="n">idx_file</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<a name="line-53"></a>		<span class="n">strbuf_release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">idx_file</span><span class="p">);</span>
<a name="line-54"></a>	<span class="p">}</span>
<a name="line-55"></a>
<a name="line-56"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">has_promisor_remote</span><span class="p">())</span> <span class="p">{</span>
<a name="line-57"></a>		<span class="cm">/*</span>
<a name="line-58"></a><span class="cm">		 * For partial clones, we don&#39;t want to have to do a regular</span>
<a name="line-59"></a><span class="cm">		 * connectivity check because we have to enumerate and exclude</span>
<a name="line-60"></a><span class="cm">		 * all promisor objects (slow), and then the connectivity check</span>
<a name="line-61"></a><span class="cm">		 * itself becomes a no-op because in a partial clone every</span>
<a name="line-62"></a><span class="cm">		 * object is a promisor object. Instead, just make sure we</span>
<a name="line-63"></a><span class="cm">		 * received, in a promisor packfile, the objects pointed to by</span>
<a name="line-64"></a><span class="cm">		 * each wanted ref.</span>
<a name="line-65"></a><span class="cm">		 *</span>
<a name="line-66"></a><span class="cm">		 * Before checking for promisor packs, be sure we have the</span>
<a name="line-67"></a><span class="cm">		 * latest pack-files loaded into memory.</span>
<a name="line-68"></a><span class="cm">		 */</span>
<a name="line-69"></a>		<span class="n">reprepare_packed_git</span><span class="p">(</span><span class="n">the_repository</span><span class="p">);</span>
<a name="line-70"></a>		<span class="k">do</span> <span class="p">{</span>
<a name="line-71"></a>			<span class="k">struct</span> <span class="n">packed_git</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
<a name="line-72"></a>
<a name="line-73"></a>			<span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">get_all_packs</span><span class="p">(</span><span class="n">the_repository</span><span class="p">);</span> <span class="n">p</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
<a name="line-74"></a>				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">pack_promisor</span><span class="p">)</span>
<a name="line-75"></a>					<span class="k">continue</span><span class="p">;</span>
<a name="line-76"></a>				<span class="k">if</span> <span class="p">(</span><span class="n">find_pack_entry_one</span><span class="p">(</span><span class="n">oid</span><span class="p">.</span><span class="n">hash</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<a name="line-77"></a>					<span class="k">goto</span> <span class="n">promisor_pack_found</span><span class="p">;</span>
<a name="line-78"></a>			<span class="p">}</span>
<a name="line-79"></a>			<span class="cm">/*</span>
<a name="line-80"></a><span class="cm">			 * Fallback to rev-list with oid and the rest of the</span>
<a name="line-81"></a><span class="cm">			 * object IDs provided by fn.</span>
<a name="line-82"></a><span class="cm">			 */</span>
<a name="line-83"></a>			<span class="k">goto</span> <span class="n">no_promisor_pack_found</span><span class="p">;</span>
<a name="line-84"></a><span class="nl">promisor_pack_found</span><span class="p">:</span>
<a name="line-85"></a>			<span class="p">;</span>
<a name="line-86"></a>		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">fn</span><span class="p">(</span><span class="n">cb_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">));</span>
<a name="line-87"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-88"></a>	<span class="p">}</span>
<a name="line-89"></a>
<a name="line-90"></a><span class="nl">no_promisor_pack_found</span><span class="p">:</span>
<a name="line-91"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">shallow_file</span><span class="p">)</span> <span class="p">{</span>
<a name="line-92"></a>		<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--shallow-file&quot;</span><span class="p">);</span>
<a name="line-93"></a>		<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">shallow_file</span><span class="p">);</span>
<a name="line-94"></a>	<span class="p">}</span>
<a name="line-95"></a>	<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span><span class="s">&quot;rev-list&quot;</span><span class="p">);</span>
<a name="line-96"></a>	<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--objects&quot;</span><span class="p">);</span>
<a name="line-97"></a>	<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--stdin&quot;</span><span class="p">);</span>
<a name="line-98"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">has_promisor_remote</span><span class="p">())</span>
<a name="line-99"></a>		<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--exclude-promisor-objects&quot;</span><span class="p">);</span>
<a name="line-100"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">is_deepening_fetch</span><span class="p">)</span> <span class="p">{</span>
<a name="line-101"></a>		<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--not&quot;</span><span class="p">);</span>
<a name="line-102"></a>		<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--all&quot;</span><span class="p">);</span>
<a name="line-103"></a>	<span class="p">}</span>
<a name="line-104"></a>	<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--quiet&quot;</span><span class="p">);</span>
<a name="line-105"></a>	<span class="n">strvec_push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--alternate-refs&quot;</span><span class="p">);</span>
<a name="line-106"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">progress</span><span class="p">)</span>
<a name="line-107"></a>		<span class="n">strvec_pushf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;--progress=%s&quot;</span><span class="p">,</span>
<a name="line-108"></a>			     <span class="n">_</span><span class="p">(</span><span class="s">&quot;Checking connectivity&quot;</span><span class="p">));</span>
<a name="line-109"></a>
<a name="line-110"></a>	<span class="n">rev_list</span><span class="p">.</span><span class="n">git_cmd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-111"></a>	<span class="n">rev_list</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">env</span><span class="p">;</span>
<a name="line-112"></a>	<span class="n">rev_list</span><span class="p">.</span><span class="n">in</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="line-113"></a>	<span class="n">rev_list</span><span class="p">.</span><span class="n">no_stdout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-114"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">err_fd</span><span class="p">)</span>
<a name="line-115"></a>		<span class="n">rev_list</span><span class="p">.</span><span class="n">err</span> <span class="o">=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">err_fd</span><span class="p">;</span>
<a name="line-116"></a>	<span class="k">else</span>
<a name="line-117"></a>		<span class="n">rev_list</span><span class="p">.</span><span class="n">no_stderr</span> <span class="o">=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">quiet</span><span class="p">;</span>
<a name="line-118"></a>
<a name="line-119"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">start_command</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">))</span>
<a name="line-120"></a>		<span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Could not run &#39;git rev-list&#39;&quot;</span><span class="p">));</span>
<a name="line-121"></a>
<a name="line-122"></a>	<span class="n">sigchain_push</span><span class="p">(</span><span class="n">SIGPIPE</span><span class="p">,</span> <span class="n">SIG_IGN</span><span class="p">);</span>
<a name="line-123"></a>
<a name="line-124"></a>	<span class="n">rev_list_in</span> <span class="o">=</span> <span class="n">xfdopen</span><span class="p">(</span><span class="n">rev_list</span><span class="p">.</span><span class="n">in</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
<a name="line-125"></a>
<a name="line-126"></a>	<span class="k">do</span> <span class="p">{</span>
<a name="line-127"></a>		<span class="cm">/*</span>
<a name="line-128"></a><span class="cm">		 * If index-pack already checked that:</span>
<a name="line-129"></a><span class="cm">		 * - there are no dangling pointers in the new pack</span>
<a name="line-130"></a><span class="cm">		 * - the pack is self contained</span>
<a name="line-131"></a><span class="cm">		 * Then if the updated ref is in the new pack, then we</span>
<a name="line-132"></a><span class="cm">		 * are sure the ref is good and not sending it to</span>
<a name="line-133"></a><span class="cm">		 * rev-list for verification.</span>
<a name="line-134"></a><span class="cm">		 */</span>
<a name="line-135"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">new_pack</span> <span class="o">&amp;&amp;</span> <span class="n">find_pack_entry_one</span><span class="p">(</span><span class="n">oid</span><span class="p">.</span><span class="n">hash</span><span class="p">,</span> <span class="n">new_pack</span><span class="p">))</span>
<a name="line-136"></a>			<span class="k">continue</span><span class="p">;</span>
<a name="line-137"></a>
<a name="line-138"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">fprintf</span><span class="p">(</span><span class="n">rev_list_in</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">oid_to_hex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-139"></a>			<span class="k">break</span><span class="p">;</span>
<a name="line-140"></a>	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">fn</span><span class="p">(</span><span class="n">cb_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">));</span>
<a name="line-141"></a>
<a name="line-142"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">ferror</span><span class="p">(</span><span class="n">rev_list_in</span><span class="p">)</span> <span class="o">||</span> <span class="n">fflush</span><span class="p">(</span><span class="n">rev_list_in</span><span class="p">))</span> <span class="p">{</span>
<a name="line-143"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">EPIPE</span> <span class="o">&amp;&amp;</span> <span class="n">errno</span> <span class="o">!=</span> <span class="n">EINVAL</span><span class="p">)</span>
<a name="line-144"></a>			<span class="n">error_errno</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;failed write to rev-list&quot;</span><span class="p">));</span>
<a name="line-145"></a>		<span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="line-146"></a>	<span class="p">}</span>
<a name="line-147"></a>
<a name="line-148"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">fclose</span><span class="p">(</span><span class="n">rev_list_in</span><span class="p">))</span>
<a name="line-149"></a>		<span class="n">err</span> <span class="o">=</span> <span class="n">error_errno</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;failed to close rev-list&#39;s stdin&quot;</span><span class="p">));</span>
<a name="line-150"></a>
<a name="line-151"></a>	<span class="n">sigchain_pop</span><span class="p">(</span><span class="n">SIGPIPE</span><span class="p">);</span>
<a name="line-152"></a>	<span class="k">return</span> <span class="n">finish_command</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rev_list</span><span class="p">)</span> <span class="o">||</span> <span class="n">err</span><span class="p">;</span>
<a name="line-153"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.2 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
