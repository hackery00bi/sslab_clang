
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - [project name]: /tmp/sslab_clang/c_git/git/reset.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> reset.c</p>
<a href="266.html#line-0"> toomanyconfigs 0</a><a href="266.html#line-132"> varFuncNullUB 132</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cp">#include</span> <span class="cpf">&quot;git-compat-util.h&quot;</span><span class="cp"></span>
<a name="line-2"></a><span class="cp">#include</span> <span class="cpf">&quot;cache-tree.h&quot;</span><span class="cp"></span>
<a name="line-3"></a><span class="cp">#include</span> <span class="cpf">&quot;lockfile.h&quot;</span><span class="cp"></span>
<a name="line-4"></a><span class="cp">#include</span> <span class="cpf">&quot;refs.h&quot;</span><span class="cp"></span>
<a name="line-5"></a><span class="cp">#include</span> <span class="cpf">&quot;reset.h&quot;</span><span class="cp"></span>
<a name="line-6"></a><span class="cp">#include</span> <span class="cpf">&quot;run-command.h&quot;</span><span class="cp"></span>
<a name="line-7"></a><span class="cp">#include</span> <span class="cpf">&quot;tree-walk.h&quot;</span><span class="cp"></span>
<a name="line-8"></a><span class="cp">#include</span> <span class="cpf">&quot;tree.h&quot;</span><span class="cp"></span>
<a name="line-9"></a><span class="cp">#include</span> <span class="cpf">&quot;unpack-trees.h&quot;</span><span class="cp"></span>
<a name="line-10"></a>
<a name="line-11"></a><span class="kt">int</span> <span class="nf">reset_head</span><span class="p">(</span><span class="k">struct</span> <span class="n">repository</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="k">struct</span> <span class="n">object_id</span> <span class="o">*</span><span class="n">oid</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">action</span><span class="p">,</span>
<a name="line-12"></a>	       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">switch_to_branch</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">flags</span><span class="p">,</span>
<a name="line-13"></a>	       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reflog_orig_head</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reflog_head</span><span class="p">,</span>
<a name="line-14"></a>	       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">default_reflog_action</span><span class="p">)</span>
<a name="line-15"></a><span class="p">{</span>
<a name="line-16"></a>	<span class="kt">unsigned</span> <span class="n">detach_head</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">RESET_HEAD_DETACH</span><span class="p">;</span>
<a name="line-17"></a>	<span class="kt">unsigned</span> <span class="n">reset_hard</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">RESET_HEAD_HARD</span><span class="p">;</span>
<a name="line-18"></a>	<span class="kt">unsigned</span> <span class="n">run_hook</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">RESET_HEAD_RUN_POST_CHECKOUT_HOOK</span><span class="p">;</span>
<a name="line-19"></a>	<span class="kt">unsigned</span> <span class="n">refs_only</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">RESET_HEAD_REFS_ONLY</span><span class="p">;</span>
<a name="line-20"></a>	<span class="kt">unsigned</span> <span class="n">update_orig_head</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">RESET_ORIG_HEAD</span><span class="p">;</span>
<a name="line-21"></a>	<span class="k">struct</span> <span class="n">object_id</span> <span class="n">head_oid</span><span class="p">;</span>
<a name="line-22"></a>	<span class="k">struct</span> <span class="n">tree_desc</span> <span class="n">desc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span> <span class="p">{</span> <span class="nb">NULL</span> <span class="p">}</span> <span class="p">};</span>
<a name="line-23"></a>	<span class="k">struct</span> <span class="n">lock_file</span> <span class="n">lock</span> <span class="o">=</span> <span class="n">LOCK_INIT</span><span class="p">;</span>
<a name="line-24"></a>	<span class="k">struct</span> <span class="n">unpack_trees_options</span> <span class="n">unpack_tree_opts</span><span class="p">;</span>
<a name="line-25"></a>	<span class="k">struct</span> <span class="n">tree</span> <span class="o">*</span><span class="n">tree</span><span class="p">;</span>
<a name="line-26"></a>	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reflog_action</span><span class="p">;</span>
<a name="line-27"></a>	<span class="k">struct</span> <span class="n">strbuf</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">STRBUF_INIT</span><span class="p">;</span>
<a name="line-28"></a>	<span class="kt">size_t</span> <span class="n">prefix_len</span><span class="p">;</span>
<a name="line-29"></a>	<span class="k">struct</span> <span class="n">object_id</span> <span class="o">*</span><span class="n">orig</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">oid_orig</span><span class="p">,</span>
<a name="line-30"></a>		<span class="o">*</span><span class="n">old_orig</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">oid_old_orig</span><span class="p">;</span>
<a name="line-31"></a>	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-32"></a>
<a name="line-33"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">switch_to_branch</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">starts_with</span><span class="p">(</span><span class="n">switch_to_branch</span><span class="p">,</span> <span class="s">&quot;refs/&quot;</span><span class="p">))</span>
<a name="line-34"></a>		<span class="n">BUG</span><span class="p">(</span><span class="s">&quot;Not a fully qualified branch: &#39;%s&#39;&quot;</span><span class="p">,</span> <span class="n">switch_to_branch</span><span class="p">);</span>
<a name="line-35"></a>
<a name="line-36"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">refs_only</span> <span class="o">&amp;&amp;</span> <span class="n">repo_hold_locked_index</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lock</span><span class="p">,</span> <span class="n">LOCK_REPORT_ON_ERROR</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-37"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="line-38"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-39"></a>	<span class="p">}</span>
<a name="line-40"></a>
<a name="line-41"></a>	<span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="n">oid</span> <span class="o">||</span> <span class="o">!</span><span class="n">reset_hard</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">get_oid</span><span class="p">(</span><span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">head_oid</span><span class="p">))</span> <span class="p">{</span>
<a name="line-42"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;could not determine HEAD revision&quot;</span><span class="p">));</span>
<a name="line-43"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-44"></a>	<span class="p">}</span>
<a name="line-45"></a>
<a name="line-46"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">oid</span><span class="p">)</span>
<a name="line-47"></a>		<span class="n">oid</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">head_oid</span><span class="p">;</span>
<a name="line-48"></a>
<a name="line-49"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">refs_only</span><span class="p">)</span>
<a name="line-50"></a>		<span class="k">goto</span> <span class="n">reset_head_refs</span><span class="p">;</span>
<a name="line-51"></a>
<a name="line-52"></a>	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unpack_tree_opts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">unpack_tree_opts</span><span class="p">));</span>
<a name="line-53"></a>	<span class="n">setup_unpack_trees_porcelain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unpack_tree_opts</span><span class="p">,</span> <span class="n">action</span><span class="p">);</span>
<a name="line-54"></a>	<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">head_idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-55"></a>	<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">src_index</span> <span class="o">=</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
<a name="line-56"></a>	<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">dst_index</span> <span class="o">=</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
<a name="line-57"></a>	<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">reset_hard</span> <span class="o">?</span> <span class="nl">oneway_merge</span> <span class="p">:</span> <span class="n">twoway_merge</span><span class="p">;</span>
<a name="line-58"></a>	<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">update</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-59"></a>	<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">merge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-60"></a>	<span class="n">init_checkout_metadata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">switch_to_branch</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-61"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">detach_head</span><span class="p">)</span>
<a name="line-62"></a>		<span class="n">unpack_tree_opts</span><span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-63"></a>
<a name="line-64"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">repo_read_index_unmerged</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-65"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;could not read index&quot;</span><span class="p">));</span>
<a name="line-66"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-67"></a>	<span class="p">}</span>
<a name="line-68"></a>
<a name="line-69"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reset_hard</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">fill_tree_descriptor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">desc</span><span class="p">[</span><span class="n">nr</span><span class="o">++</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">head_oid</span><span class="p">))</span> <span class="p">{</span>
<a name="line-70"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;failed to find tree of %s&quot;</span><span class="p">),</span>
<a name="line-71"></a>			    <span class="n">oid_to_hex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head_oid</span><span class="p">));</span>
<a name="line-72"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-73"></a>	<span class="p">}</span>
<a name="line-74"></a>
<a name="line-75"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fill_tree_descriptor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">desc</span><span class="p">[</span><span class="n">nr</span><span class="o">++</span><span class="p">],</span> <span class="n">oid</span><span class="p">))</span> <span class="p">{</span>
<a name="line-76"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;failed to find tree of %s&quot;</span><span class="p">),</span> <span class="n">oid_to_hex</span><span class="p">(</span><span class="n">oid</span><span class="p">));</span>
<a name="line-77"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-78"></a>	<span class="p">}</span>
<a name="line-79"></a>
<a name="line-80"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">unpack_trees</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unpack_tree_opts</span><span class="p">))</span> <span class="p">{</span>
<a name="line-81"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="line-82"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-83"></a>	<span class="p">}</span>
<a name="line-84"></a>
<a name="line-85"></a>	<span class="n">tree</span> <span class="o">=</span> <span class="n">parse_tree_indirect</span><span class="p">(</span><span class="n">oid</span><span class="p">);</span>
<a name="line-86"></a>	<span class="n">prime_cache_tree</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">,</span> <span class="n">tree</span><span class="p">);</span>
<a name="line-87"></a>
<a name="line-88"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">write_locked_index</span><span class="p">(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lock</span><span class="p">,</span> <span class="n">COMMIT_LOCK</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-89"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;could not write index&quot;</span><span class="p">));</span>
<a name="line-90"></a>		<span class="k">goto</span> <span class="n">leave_reset_head</span><span class="p">;</span>
<a name="line-91"></a>	<span class="p">}</span>
<a name="line-92"></a>
<a name="line-93"></a><span class="nl">reset_head_refs</span><span class="p">:</span>
<a name="line-94"></a>	<span class="n">reflog_action</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="n">GIT_REFLOG_ACTION_ENVIRONMENT</span><span class="p">);</span>
<a name="line-95"></a>	<span class="n">strbuf_addf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;%s: &quot;</span><span class="p">,</span> <span class="n">reflog_action</span> <span class="o">?</span> <span class="nl">reflog_action</span> <span class="p">:</span> <span class="n">default_reflog_action</span><span class="p">);</span>
<a name="line-96"></a>	<span class="n">prefix_len</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
<a name="line-97"></a>
<a name="line-98"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">update_orig_head</span><span class="p">)</span> <span class="p">{</span>
<a name="line-99"></a>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">get_oid</span><span class="p">(</span><span class="s">&quot;ORIG_HEAD&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid_old_orig</span><span class="p">))</span>
<a name="line-100"></a>			<span class="n">old_orig</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">oid_old_orig</span><span class="p">;</span>
<a name="line-101"></a>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">get_oid</span><span class="p">(</span><span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid_orig</span><span class="p">))</span> <span class="p">{</span>
<a name="line-102"></a>			<span class="n">orig</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">oid_orig</span><span class="p">;</span>
<a name="line-103"></a>			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reflog_orig_head</span><span class="p">)</span> <span class="p">{</span>
<a name="line-104"></a>				<span class="n">strbuf_addstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;updating ORIG_HEAD&quot;</span><span class="p">);</span>
<a name="line-105"></a>				<span class="n">reflog_orig_head</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">buf</span><span class="p">;</span>
<a name="line-106"></a>			<span class="p">}</span>
<a name="line-107"></a>			<span class="n">update_ref</span><span class="p">(</span><span class="n">reflog_orig_head</span><span class="p">,</span> <span class="s">&quot;ORIG_HEAD&quot;</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span>
<a name="line-108"></a>				   <span class="n">old_orig</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">UPDATE_REFS_MSG_ON_ERR</span><span class="p">);</span>
<a name="line-109"></a>		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">old_orig</span><span class="p">)</span>
<a name="line-110"></a>			<span class="n">delete_ref</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;ORIG_HEAD&quot;</span><span class="p">,</span> <span class="n">old_orig</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-111"></a>	<span class="p">}</span>
<a name="line-112"></a>
<a name="line-113"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reflog_head</span><span class="p">)</span> <span class="p">{</span>
<a name="line-114"></a>		<span class="n">strbuf_setlen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="n">prefix_len</span><span class="p">);</span>
<a name="line-115"></a>		<span class="n">strbuf_addstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;updating HEAD&quot;</span><span class="p">);</span>
<a name="line-116"></a>		<span class="n">reflog_head</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">buf</span><span class="p">;</span>
<a name="line-117"></a>	<span class="p">}</span>
<a name="line-118"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">switch_to_branch</span><span class="p">)</span>
<a name="line-119"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">update_ref</span><span class="p">(</span><span class="n">reflog_head</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span>
<a name="line-120"></a>				 <span class="n">detach_head</span> <span class="o">?</span> <span class="nl">REF_NO_DEREF</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a name="line-121"></a>				 <span class="n">UPDATE_REFS_MSG_ON_ERR</span><span class="p">);</span>
<a name="line-122"></a>	<span class="k">else</span> <span class="p">{</span>
<a name="line-123"></a>		<span class="n">ret</span> <span class="o">=</span> <span class="n">update_ref</span><span class="p">(</span><span class="n">reflog_head</span><span class="p">,</span> <span class="n">switch_to_branch</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span>
<a name="line-124"></a>				 <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">UPDATE_REFS_MSG_ON_ERR</span><span class="p">);</span>
<a name="line-125"></a>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
<a name="line-126"></a>			<span class="n">ret</span> <span class="o">=</span> <span class="n">create_symref</span><span class="p">(</span><span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="n">switch_to_branch</span><span class="p">,</span>
<a name="line-127"></a>					    <span class="n">reflog_head</span><span class="p">);</span>
<a name="line-128"></a>	<span class="p">}</span>
<a name="line-129"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">run_hook</span><span class="p">)</span>
<a name="line-130"></a>		<span class="n">run_hook_le</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;post-checkout&quot;</span><span class="p">,</span>
<a name="line-131"></a>			    <span class="n">oid_to_hex</span><span class="p">(</span><span class="n">orig</span> <span class="o">?</span> <span class="nl">orig</span> <span class="p">:</span> <span class="o">&amp;</span><span class="n">null_oid</span><span class="p">),</span>
<a name="line-132"></a><span class="hll">			    <span class="n">oid_to_hex</span><span class="p">(</span><span class="n">oid</span><span class="p">),</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span><div class="verbose expandable"><span class="error2">&lt;--- Passing NULL after the last typed argument to a variadic function leads to undefined behaviour. <span class="marker">[+]</span></span><div class="content">Passing NULL after the last typed argument to a variadic function leads to undefined behaviour.
The C99 standard, in section 7.15.1.1, states that if the type used by va_arg() is not compatible with the type of the actual next argument (as promoted according to the default argument promotions), the behavior is undefined.
The value of the NULL macro is an implementation-defined null pointer constant (7.17), which can be any integer constant expression with the value 0, or such an expression casted to (void*) (6.3.2.3). This includes values like 0, 0L, or even 0LL.
In practice on common architectures, this will cause real crashes if sizeof(int) != sizeof(void*), and NULL is defined to 0 or any other null pointer constant that promotes to int.
To reproduce you might be able to use this little code example on 64bit platforms. If the output includes &quot;ERROR&quot;, the sentinel had only 4 out of 8 bytes initialized to zero and was not detected as the final argument to stop argument processing via va_arg(). Changing the 0 to (void*)0 or 0L will make the &quot;ERROR&quot; output go away.
#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;

void f(char *s, ...) {
    va_list ap;
    va_start(ap,s);
    for (;;) {
        char *p = va_arg(ap,char*);
        printf(&quot;%018p, %s\n&quot;, p, (long)p &amp; 255 ? p : &quot;&quot;);
        if(!p) break;
    }
    va_end(ap);
}

void g() {
    char *s2 = &quot;x&quot;;
    char *s3 = &quot;ERROR&quot;;

    // changing 0 to 0L for the 7th argument (which is intended to act as sentinel) makes the error go away on x86_64
    f(&quot;first&quot;, s2, s2, s2, s2, s2, 0, s3, (char*)0);
}

void h() {
    int i;
    volatile unsigned char a[1000];
    for (i = 0; i&lt;sizeof(a); i++)
        a[i] = -1;
}

int main() {
    h();
    g();
    return 0;
}</div></div>
</span><a name="line-133"></a>
<a name="line-134"></a><span class="nl">leave_reset_head</span><span class="p">:</span>
<a name="line-135"></a>	<span class="n">strbuf_release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<a name="line-136"></a>	<span class="n">rollback_lock_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span>
<a name="line-137"></a>	<span class="k">while</span> <span class="p">(</span><span class="n">nr</span><span class="p">)</span>
<a name="line-138"></a>		<span class="n">free</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">desc</span><span class="p">[</span><span class="o">--</span><span class="n">nr</span><span class="p">].</span><span class="n">buffer</span><span class="p">);</span>
<a name="line-139"></a>	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<a name="line-140"></a>
<a name="line-141"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.2 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
