
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - [project name]: /tmp/sslab_clang/c_git/git/diffcore-break.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> diffcore-break.c</p>
<a href="153.html#line-0"> toomanyconfigs 0</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/*</span>
<a name="line-2"></a><span class="cm"> * Copyright (C) 2005 Junio C Hamano</span>
<a name="line-3"></a><span class="cm"> */</span>
<a name="line-4"></a><span class="cp">#include</span> <span class="cpf">&quot;cache.h&quot;</span><span class="cp"></span>
<a name="line-5"></a><span class="cp">#include</span> <span class="cpf">&quot;diff.h&quot;</span><span class="cp"></span>
<a name="line-6"></a><span class="cp">#include</span> <span class="cpf">&quot;diffcore.h&quot;</span><span class="cp"></span>
<a name="line-7"></a><span class="cp">#include</span> <span class="cpf">&quot;promisor-remote.h&quot;</span><span class="cp"></span>
<a name="line-8"></a>
<a name="line-9"></a><span class="k">static</span> <span class="kt">int</span> <span class="nf">should_break</span><span class="p">(</span><span class="k">struct</span> <span class="n">repository</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span>
<a name="line-10"></a>			<span class="k">struct</span> <span class="n">diff_filespec</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span>
<a name="line-11"></a>			<span class="k">struct</span> <span class="n">diff_filespec</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
<a name="line-12"></a>			<span class="kt">int</span> <span class="n">break_score</span><span class="p">,</span>
<a name="line-13"></a>			<span class="kt">int</span> <span class="o">*</span><span class="n">merge_score_p</span><span class="p">)</span>
<a name="line-14"></a><span class="p">{</span>
<a name="line-15"></a>	<span class="cm">/* dst is recorded as a modification of src.  Are they so</span>
<a name="line-16"></a><span class="cm">	 * different that we are better off recording this as a pair</span>
<a name="line-17"></a><span class="cm">	 * of delete and create?</span>
<a name="line-18"></a><span class="cm">	 *</span>
<a name="line-19"></a><span class="cm">	 * There are two criteria used in this algorithm.  For the</span>
<a name="line-20"></a><span class="cm">	 * purposes of helping later rename/copy, we take both delete</span>
<a name="line-21"></a><span class="cm">	 * and insert into account and estimate the amount of &quot;edit&quot;.</span>
<a name="line-22"></a><span class="cm">	 * If the edit is very large, we break this pair so that</span>
<a name="line-23"></a><span class="cm">	 * rename/copy can pick the pieces up to match with other</span>
<a name="line-24"></a><span class="cm">	 * files.</span>
<a name="line-25"></a><span class="cm">	 *</span>
<a name="line-26"></a><span class="cm">	 * On the other hand, we would want to ignore inserts for the</span>
<a name="line-27"></a><span class="cm">	 * pure &quot;complete rewrite&quot; detection.  As long as most of the</span>
<a name="line-28"></a><span class="cm">	 * existing contents were removed from the file, it is a</span>
<a name="line-29"></a><span class="cm">	 * complete rewrite, and if sizable chunk from the original</span>
<a name="line-30"></a><span class="cm">	 * still remains in the result, it is not a rewrite.  It does</span>
<a name="line-31"></a><span class="cm">	 * not matter how much or how little new material is added to</span>
<a name="line-32"></a><span class="cm">	 * the file.</span>
<a name="line-33"></a><span class="cm">	 *</span>
<a name="line-34"></a><span class="cm">	 * The score we leave for such a broken filepair uses the</span>
<a name="line-35"></a><span class="cm">	 * latter definition so that later clean-up stage can find the</span>
<a name="line-36"></a><span class="cm">	 * pieces that should not have been broken according to the</span>
<a name="line-37"></a><span class="cm">	 * latter definition after rename/copy runs, and merge the</span>
<a name="line-38"></a><span class="cm">	 * broken pair that have a score lower than given criteria</span>
<a name="line-39"></a><span class="cm">	 * back together.  The break operation itself happens</span>
<a name="line-40"></a><span class="cm">	 * according to the former definition.</span>
<a name="line-41"></a><span class="cm">	 *</span>
<a name="line-42"></a><span class="cm">	 * The minimum_edit parameter tells us when to break (the</span>
<a name="line-43"></a><span class="cm">	 * amount of &quot;edit&quot; required for us to consider breaking the</span>
<a name="line-44"></a><span class="cm">	 * pair).  We leave the amount of deletion in *merge_score_p</span>
<a name="line-45"></a><span class="cm">	 * when we return.</span>
<a name="line-46"></a><span class="cm">	 *</span>
<a name="line-47"></a><span class="cm">	 * The value we return is 1 if we want the pair to be broken,</span>
<a name="line-48"></a><span class="cm">	 * or 0 if we do not.</span>
<a name="line-49"></a><span class="cm">	 */</span>
<a name="line-50"></a>	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">delta_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">;</span>
<a name="line-51"></a>	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">src_copied</span><span class="p">,</span> <span class="n">literal_added</span><span class="p">,</span> <span class="n">src_removed</span><span class="p">;</span>
<a name="line-52"></a>
<a name="line-53"></a>	<span class="k">struct</span> <span class="n">diff_populate_filespec_options</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
<a name="line-54"></a>
<a name="line-55"></a>	<span class="o">*</span><span class="n">merge_score_p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* assume no deletion --- &quot;do not break&quot;</span>
<a name="line-56"></a><span class="cm">			     * is the default.</span>
<a name="line-57"></a><span class="cm">			     */</span>
<a name="line-58"></a>
<a name="line-59"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">S_ISREG</span><span class="p">(</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="o">!=</span> <span class="n">S_ISREG</span><span class="p">(</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">))</span> <span class="p">{</span>
<a name="line-60"></a>		<span class="o">*</span><span class="n">merge_score_p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">MAX_SCORE</span><span class="p">;</span>
<a name="line-61"></a>		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* even their types are different */</span>
<a name="line-62"></a>	<span class="p">}</span>
<a name="line-63"></a>
<a name="line-64"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">oid_valid</span> <span class="o">&amp;&amp;</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">oid_valid</span> <span class="o">&amp;&amp;</span>
<a name="line-65"></a>	    <span class="n">oideq</span><span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">oid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">oid</span><span class="p">))</span>
<a name="line-66"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* they are the same */</span>
<a name="line-67"></a>
<a name="line-68"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="n">the_repository</span> <span class="o">&amp;&amp;</span> <span class="n">has_promisor_remote</span><span class="p">())</span> <span class="p">{</span>
<a name="line-69"></a>		<span class="n">options</span><span class="p">.</span><span class="n">missing_object_cb</span> <span class="o">=</span> <span class="n">diff_queued_diff_prefetch</span><span class="p">;</span>
<a name="line-70"></a>		<span class="n">options</span><span class="p">.</span><span class="n">missing_object_data</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
<a name="line-71"></a>	<span class="p">}</span>
<a name="line-72"></a>
<a name="line-73"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">diff_populate_filespec</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">options</span><span class="p">)</span> <span class="o">||</span>
<a name="line-74"></a>	    <span class="n">diff_populate_filespec</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">options</span><span class="p">))</span>
<a name="line-75"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* error but caught downstream */</span>
<a name="line-76"></a>
<a name="line-77"></a>	<span class="n">max_size</span> <span class="o">=</span> <span class="p">((</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="o">?</span> <span class="n">src</span><span class="o">-&gt;</span><span class="nl">size</span> <span class="p">:</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
<a name="line-78"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">max_size</span> <span class="o">&lt;</span> <span class="n">MINIMUM_BREAK_SIZE</span><span class="p">)</span>
<a name="line-79"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* we do not break too small filepair */</span>
<a name="line-80"></a>
<a name="line-81"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span>
<a name="line-82"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* we do not let empty files get renamed */</span>
<a name="line-83"></a>
<a name="line-84"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">diffcore_count_changes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span>
<a name="line-85"></a>				   <span class="o">&amp;</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">cnt_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">cnt_data</span><span class="p">,</span>
<a name="line-86"></a>				   <span class="o">&amp;</span><span class="n">src_copied</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">literal_added</span><span class="p">))</span>
<a name="line-87"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-88"></a>
<a name="line-89"></a>	<span class="cm">/* sanity */</span>
<a name="line-90"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">src_copied</span><span class="p">)</span>
<a name="line-91"></a>		<span class="n">src_copied</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
<a name="line-92"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">literal_added</span> <span class="o">+</span> <span class="n">src_copied</span><span class="p">)</span> <span class="p">{</span>
<a name="line-93"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">src_copied</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span>
<a name="line-94"></a>			<span class="n">literal_added</span> <span class="o">=</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">src_copied</span><span class="p">;</span>
<a name="line-95"></a>		<span class="k">else</span>
<a name="line-96"></a>			<span class="n">literal_added</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-97"></a>	<span class="p">}</span>
<a name="line-98"></a>	<span class="n">src_removed</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">src_copied</span><span class="p">;</span>
<a name="line-99"></a>
<a name="line-100"></a>	<span class="cm">/* Compute merge-score, which is &quot;how much is removed</span>
<a name="line-101"></a><span class="cm">	 * from the source material&quot;.  The clean-up stage will</span>
<a name="line-102"></a><span class="cm">	 * merge the surviving pair together if the score is</span>
<a name="line-103"></a><span class="cm">	 * less than the minimum, after rename/copy runs.</span>
<a name="line-104"></a><span class="cm">	 */</span>
<a name="line-105"></a>	<span class="o">*</span><span class="n">merge_score_p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">src_removed</span> <span class="o">*</span> <span class="n">MAX_SCORE</span> <span class="o">/</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
<a name="line-106"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">merge_score_p</span> <span class="o">&gt;</span> <span class="n">break_score</span><span class="p">)</span>
<a name="line-107"></a>		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-108"></a>
<a name="line-109"></a>	<span class="cm">/* Extent of damage, which counts both inserts and</span>
<a name="line-110"></a><span class="cm">	 * deletes.</span>
<a name="line-111"></a><span class="cm">	 */</span>
<a name="line-112"></a>	<span class="n">delta_size</span> <span class="o">=</span> <span class="n">src_removed</span> <span class="o">+</span> <span class="n">literal_added</span><span class="p">;</span>
<a name="line-113"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">delta_size</span> <span class="o">*</span> <span class="n">MAX_SCORE</span> <span class="o">/</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="n">break_score</span><span class="p">)</span>
<a name="line-114"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-115"></a>
<a name="line-116"></a>	<span class="cm">/* If you removed a lot without adding new material, that is</span>
<a name="line-117"></a><span class="cm">	 * not really a rewrite.</span>
<a name="line-118"></a><span class="cm">	 */</span>
<a name="line-119"></a>	<span class="k">if</span> <span class="p">((</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">*</span> <span class="n">break_score</span> <span class="o">&lt;</span> <span class="n">src_removed</span> <span class="o">*</span> <span class="n">MAX_SCORE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
<a name="line-120"></a>	    <span class="p">(</span><span class="n">literal_added</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">&lt;</span> <span class="n">src_removed</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
<a name="line-121"></a>	    <span class="p">(</span><span class="n">literal_added</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">&lt;</span> <span class="n">src_copied</span><span class="p">))</span>
<a name="line-122"></a>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-123"></a>
<a name="line-124"></a>	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-125"></a><span class="p">}</span>
<a name="line-126"></a>
<a name="line-127"></a><span class="kt">void</span> <span class="nf">diffcore_break</span><span class="p">(</span><span class="k">struct</span> <span class="n">repository</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">break_score</span><span class="p">)</span>
<a name="line-128"></a><span class="p">{</span>
<a name="line-129"></a>	<span class="k">struct</span> <span class="n">diff_queue_struct</span> <span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">diff_queued_diff</span><span class="p">;</span>
<a name="line-130"></a>	<span class="k">struct</span> <span class="n">diff_queue_struct</span> <span class="n">outq</span><span class="p">;</span>
<a name="line-131"></a>
<a name="line-132"></a>	<span class="cm">/* When the filepair has this much edit (insert and delete),</span>
<a name="line-133"></a><span class="cm">	 * it is first considered to be a rewrite and broken into a</span>
<a name="line-134"></a><span class="cm">	 * create and delete filepair.  This is to help breaking a</span>
<a name="line-135"></a><span class="cm">	 * file that had too much new stuff added, possibly from</span>
<a name="line-136"></a><span class="cm">	 * moving contents from another file, so that rename/copy can</span>
<a name="line-137"></a><span class="cm">	 * match it with the other file.</span>
<a name="line-138"></a><span class="cm">	 *</span>
<a name="line-139"></a><span class="cm">	 * int break_score; we reuse incoming parameter for this.</span>
<a name="line-140"></a><span class="cm">	 */</span>
<a name="line-141"></a>
<a name="line-142"></a>	<span class="cm">/* After a pair is broken according to break_score and</span>
<a name="line-143"></a><span class="cm">	 * subjected to rename/copy, both of them may survive intact,</span>
<a name="line-144"></a><span class="cm">	 * due to lack of suitable rename/copy peer.  Or, the caller</span>
<a name="line-145"></a><span class="cm">	 * may be calling us without using rename/copy.  When that</span>
<a name="line-146"></a><span class="cm">	 * happens, we merge the broken pieces back into one</span>
<a name="line-147"></a><span class="cm">	 * modification together if the pair did not have more than</span>
<a name="line-148"></a><span class="cm">	 * this much delete.  For this computation, we do not take</span>
<a name="line-149"></a><span class="cm">	 * insert into account at all.  If you start from a 100-line</span>
<a name="line-150"></a><span class="cm">	 * file and delete 97 lines of it, it does not matter if you</span>
<a name="line-151"></a><span class="cm">	 * add 27 lines to it to make a new 30-line file or if you add</span>
<a name="line-152"></a><span class="cm">	 * 997 lines to it to make a 1000-line file.  Either way what</span>
<a name="line-153"></a><span class="cm">	 * you did was a rewrite of 97%.  On the other hand, if you</span>
<a name="line-154"></a><span class="cm">	 * delete 3 lines, keeping 97 lines intact, it does not matter</span>
<a name="line-155"></a><span class="cm">	 * if you add 3 lines to it to make a new 100-line file or if</span>
<a name="line-156"></a><span class="cm">	 * you add 903 lines to it to make a new 1000-line file.</span>
<a name="line-157"></a><span class="cm">	 * Either way you did a lot of additions and not a rewrite.</span>
<a name="line-158"></a><span class="cm">	 * This merge happens to catch the latter case.  A merge_score</span>
<a name="line-159"></a><span class="cm">	 * of 80% would be a good default value (a broken pair that</span>
<a name="line-160"></a><span class="cm">	 * has score lower than merge_score will be merged back</span>
<a name="line-161"></a><span class="cm">	 * together).</span>
<a name="line-162"></a><span class="cm">	 */</span>
<a name="line-163"></a>	<span class="kt">int</span> <span class="n">merge_score</span><span class="p">;</span>
<a name="line-164"></a>	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="line-165"></a>
<a name="line-166"></a>	<span class="cm">/* See comment on DEFAULT_BREAK_SCORE and</span>
<a name="line-167"></a><span class="cm">	 * DEFAULT_MERGE_SCORE in diffcore.h</span>
<a name="line-168"></a><span class="cm">	 */</span>
<a name="line-169"></a>	<span class="n">merge_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">break_score</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
<a name="line-170"></a>	<span class="n">break_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">break_score</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">);</span>
<a name="line-171"></a>
<a name="line-172"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">break_score</span><span class="p">)</span>
<a name="line-173"></a>		<span class="n">break_score</span> <span class="o">=</span> <span class="n">DEFAULT_BREAK_SCORE</span><span class="p">;</span>
<a name="line-174"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">merge_score</span><span class="p">)</span>
<a name="line-175"></a>		<span class="n">merge_score</span> <span class="o">=</span> <span class="n">DEFAULT_MERGE_SCORE</span><span class="p">;</span>
<a name="line-176"></a>
<a name="line-177"></a>	<span class="n">DIFF_QUEUE_CLEAR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">);</span>
<a name="line-178"></a>
<a name="line-179"></a>	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-180"></a>		<span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a name="line-181"></a>		<span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
<a name="line-182"></a>
<a name="line-183"></a>		<span class="cm">/*</span>
<a name="line-184"></a><span class="cm">		 * We deal only with in-place edit of blobs.</span>
<a name="line-185"></a><span class="cm">		 * We do not break anything else.</span>
<a name="line-186"></a><span class="cm">		 */</span>
<a name="line-187"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
<a name="line-188"></a>		    <span class="n">object_type</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="o">==</span> <span class="n">OBJ_BLOB</span> <span class="o">&amp;&amp;</span>
<a name="line-189"></a>		    <span class="n">object_type</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="o">==</span> <span class="n">OBJ_BLOB</span> <span class="o">&amp;&amp;</span>
<a name="line-190"></a>		    <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span>
<a name="line-191"></a>			<span class="k">if</span> <span class="p">(</span><span class="n">should_break</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">,</span>
<a name="line-192"></a>					 <span class="n">break_score</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">score</span><span class="p">))</span> <span class="p">{</span>
<a name="line-193"></a>				<span class="cm">/* Split this into delete and create */</span>
<a name="line-194"></a>				<span class="k">struct</span> <span class="n">diff_filespec</span> <span class="o">*</span><span class="n">null_one</span><span class="p">,</span> <span class="o">*</span><span class="n">null_two</span><span class="p">;</span>
<a name="line-195"></a>				<span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>
<a name="line-196"></a>
<a name="line-197"></a>				<span class="cm">/* Set score to 0 for the pair that</span>
<a name="line-198"></a><span class="cm">				 * needs to be merged back together</span>
<a name="line-199"></a><span class="cm">				 * should they survive rename/copy.</span>
<a name="line-200"></a><span class="cm">				 * Also we do not want to break very</span>
<a name="line-201"></a><span class="cm">				 * small files.</span>
<a name="line-202"></a><span class="cm">				 */</span>
<a name="line-203"></a>				<span class="k">if</span> <span class="p">(</span><span class="n">score</span> <span class="o">&lt;</span> <span class="n">merge_score</span><span class="p">)</span>
<a name="line-204"></a>					<span class="n">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-205"></a>
<a name="line-206"></a>				<span class="cm">/* deletion of one */</span>
<a name="line-207"></a>				<span class="n">null_one</span> <span class="o">=</span> <span class="n">alloc_filespec</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>
<a name="line-208"></a>				<span class="n">dp</span> <span class="o">=</span> <span class="n">diff_queue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">,</span> <span class="n">null_one</span><span class="p">);</span>
<a name="line-209"></a>				<span class="n">dp</span><span class="o">-&gt;</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">;</span>
<a name="line-210"></a>				<span class="n">dp</span><span class="o">-&gt;</span><span class="n">broken_pair</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-211"></a>
<a name="line-212"></a>				<span class="cm">/* creation of two */</span>
<a name="line-213"></a>				<span class="n">null_two</span> <span class="o">=</span> <span class="n">alloc_filespec</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>
<a name="line-214"></a>				<span class="n">dp</span> <span class="o">=</span> <span class="n">diff_queue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">,</span> <span class="n">null_two</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">);</span>
<a name="line-215"></a>				<span class="n">dp</span><span class="o">-&gt;</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">;</span>
<a name="line-216"></a>				<span class="n">dp</span><span class="o">-&gt;</span><span class="n">broken_pair</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-217"></a>
<a name="line-218"></a>				<span class="n">diff_free_filespec_blob</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">);</span>
<a name="line-219"></a>				<span class="n">diff_free_filespec_blob</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">);</span>
<a name="line-220"></a>				<span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="cm">/* not diff_free_filepair(), we are</span>
<a name="line-221"></a><span class="cm">					  * reusing one and two here.</span>
<a name="line-222"></a><span class="cm">					  */</span>
<a name="line-223"></a>				<span class="k">continue</span><span class="p">;</span>
<a name="line-224"></a>			<span class="p">}</span>
<a name="line-225"></a>		<span class="p">}</span>
<a name="line-226"></a>		<span class="n">diff_free_filespec_data</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">);</span>
<a name="line-227"></a>		<span class="n">diff_free_filespec_data</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">);</span>
<a name="line-228"></a>		<span class="n">diff_q</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<a name="line-229"></a>	<span class="p">}</span>
<a name="line-230"></a>	<span class="n">free</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">);</span>
<a name="line-231"></a>	<span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="n">outq</span><span class="p">;</span>
<a name="line-232"></a>
<a name="line-233"></a>	<span class="k">return</span><span class="p">;</span>
<a name="line-234"></a><span class="p">}</span>
<a name="line-235"></a>
<a name="line-236"></a><span class="k">static</span> <span class="kt">void</span> <span class="nf">merge_broken</span><span class="p">(</span><span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
<a name="line-237"></a>			 <span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">pp</span><span class="p">,</span>
<a name="line-238"></a>			 <span class="k">struct</span> <span class="n">diff_queue_struct</span> <span class="o">*</span><span class="n">outq</span><span class="p">)</span>
<a name="line-239"></a><span class="p">{</span>
<a name="line-240"></a>	<span class="cm">/* p and pp are broken pairs we want to merge */</span>
<a name="line-241"></a>	<span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">pp</span><span class="p">,</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>
<a name="line-242"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">))</span> <span class="p">{</span>
<a name="line-243"></a>		<span class="cm">/* this must be a delete half */</span>
<a name="line-244"></a>		<span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">pp</span><span class="p">;</span>
<a name="line-245"></a>	<span class="p">}</span>
<a name="line-246"></a>	<span class="cm">/* Sanity check */</span>
<a name="line-247"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">))</span>
<a name="line-248"></a>		<span class="n">die</span><span class="p">(</span><span class="s">&quot;internal error in merge #1&quot;</span><span class="p">);</span>
<a name="line-249"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">))</span>
<a name="line-250"></a>		<span class="n">die</span><span class="p">(</span><span class="s">&quot;internal error in merge #2&quot;</span><span class="p">);</span>
<a name="line-251"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">))</span>
<a name="line-252"></a>		<span class="n">die</span><span class="p">(</span><span class="s">&quot;internal error in merge #3&quot;</span><span class="p">);</span>
<a name="line-253"></a>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">DIFF_FILE_VALID</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">))</span>
<a name="line-254"></a>		<span class="n">die</span><span class="p">(</span><span class="s">&quot;internal error in merge #4&quot;</span><span class="p">);</span>
<a name="line-255"></a>
<a name="line-256"></a>	<span class="n">dp</span> <span class="o">=</span> <span class="n">diff_queue</span><span class="p">(</span><span class="n">outq</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">);</span>
<a name="line-257"></a>	<span class="n">dp</span><span class="o">-&gt;</span><span class="n">score</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">score</span><span class="p">;</span>
<a name="line-258"></a>	<span class="cm">/*</span>
<a name="line-259"></a><span class="cm">	 * We will be one extra user of the same src side of the</span>
<a name="line-260"></a><span class="cm">	 * broken pair, if it was used as the rename source for other</span>
<a name="line-261"></a><span class="cm">	 * paths elsewhere.  Increment to mark that the path stays</span>
<a name="line-262"></a><span class="cm">	 * in the resulting tree.</span>
<a name="line-263"></a><span class="cm">	 */</span>
<a name="line-264"></a>	<span class="n">d</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">rename_used</span><span class="o">++</span><span class="p">;</span>
<a name="line-265"></a>	<span class="n">diff_free_filespec_data</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">two</span><span class="p">);</span>
<a name="line-266"></a>	<span class="n">diff_free_filespec_data</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">);</span>
<a name="line-267"></a>	<span class="n">free</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
<a name="line-268"></a>	<span class="n">free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a name="line-269"></a><span class="p">}</span>
<a name="line-270"></a>
<a name="line-271"></a><span class="kt">void</span> <span class="nf">diffcore_merge_broken</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a name="line-272"></a><span class="p">{</span>
<a name="line-273"></a>	<span class="k">struct</span> <span class="n">diff_queue_struct</span> <span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">diff_queued_diff</span><span class="p">;</span>
<a name="line-274"></a>	<span class="k">struct</span> <span class="n">diff_queue_struct</span> <span class="n">outq</span><span class="p">;</span>
<a name="line-275"></a>	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
<a name="line-276"></a>
<a name="line-277"></a>	<span class="n">DIFF_QUEUE_CLEAR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">);</span>
<a name="line-278"></a>
<a name="line-279"></a>	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-280"></a>		<span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a name="line-281"></a>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span>
<a name="line-282"></a>			<span class="cm">/* we already merged this with its peer */</span>
<a name="line-283"></a>			<span class="k">continue</span><span class="p">;</span>
<a name="line-284"></a>		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">broken_pair</span> <span class="o">&amp;&amp;</span>
<a name="line-285"></a>			 <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">two</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span>
<a name="line-286"></a>			<span class="cm">/* If the peer also survived rename/copy, then</span>
<a name="line-287"></a><span class="cm">			 * we merge them back together.</span>
<a name="line-288"></a><span class="cm">			 */</span>
<a name="line-289"></a>			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-290"></a>				<span class="k">struct</span> <span class="n">diff_filepair</span> <span class="o">*</span><span class="n">pp</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a name="line-291"></a>				<span class="k">if</span> <span class="p">(</span><span class="n">pp</span><span class="o">-&gt;</span><span class="n">broken_pair</span> <span class="o">&amp;&amp;</span>
<a name="line-292"></a>				    <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">pp</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">,</span> <span class="n">pp</span><span class="o">-&gt;</span><span class="n">two</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
<a name="line-293"></a>				    <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">one</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">,</span> <span class="n">pp</span><span class="o">-&gt;</span><span class="n">two</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span>
<a name="line-294"></a>					<span class="cm">/* Peer survived.  Merge them */</span>
<a name="line-295"></a>					<span class="n">merge_broken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outq</span><span class="p">);</span>
<a name="line-296"></a>					<span class="n">q</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-297"></a>					<span class="k">goto</span> <span class="n">next</span><span class="p">;</span>
<a name="line-298"></a>				<span class="p">}</span>
<a name="line-299"></a>			<span class="p">}</span>
<a name="line-300"></a>			<span class="cm">/* The peer did not survive, so we keep</span>
<a name="line-301"></a><span class="cm">			 * it in the output.</span>
<a name="line-302"></a><span class="cm">			 */</span>
<a name="line-303"></a>			<span class="n">diff_q</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<a name="line-304"></a>		<span class="p">}</span>
<a name="line-305"></a>		<span class="k">else</span>
<a name="line-306"></a>			<span class="n">diff_q</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outq</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<a name="line-307"></a><span class="nl">next</span><span class="p">:;</span>
<a name="line-308"></a>	<span class="p">}</span>
<a name="line-309"></a>	<span class="n">free</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">);</span>
<a name="line-310"></a>	<span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="n">outq</span><span class="p">;</span>
<a name="line-311"></a>
<a name="line-312"></a>	<span class="k">return</span><span class="p">;</span>
<a name="line-313"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.2 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
